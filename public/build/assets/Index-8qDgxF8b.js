import{c as p,o as g,a as o,u as ht,r as R,L as G,H as Vt,G as Ce,b as le,D as Jt,E as Ht,e as ye,g as B,w as Zt,h as k,t as b,F as he,j as me,f as Oe,v as je,I as gt,k as ie,n as Ne,l as Kt,J as vt,T as Yt,q as Wt,p as fe}from"./app-CJvcGQv7.js";import{_ as qt}from"./logo-C5fiQHXv.js";import{_ as Xt,u as Qt}from"./_plugin-vue_export-helper-Cmnkwgh0.js";import{r as Ze}from"./XMarkIcon-C1-anYre.js";import{r as eo}from"./MagnifyingGlassIcon-BhaU-2Y3.js";/* empty css            */function to(V,A){return g(),p("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function mt(){const V=(s,h,d,x)=>{const S=s*Math.PI/180,l=d*Math.PI/180,F=(d-s)*Math.PI/180,$=(x-h)*Math.PI/180,E=Math.sin(F/2)*Math.sin(F/2)+Math.cos(S)*Math.cos(l)*Math.sin($/2)*Math.sin($/2);return 6371e3*(2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E)))},A=(s,h,d,x)=>{const L=s*Math.PI/180,S=d*Math.PI/180,l=(x-h)*Math.PI/180,F=Math.sin(l)*Math.cos(S),$=Math.cos(L)*Math.sin(S)-Math.sin(L)*Math.cos(S)*Math.cos(l);return(Math.atan2(F,$)*180/Math.PI+360)%360},u=s=>{const h=[{min:0,max:22.5,text:"north",icon:"‚¨ÜÔ∏è"},{min:22.5,max:67.5,text:"northeast",icon:"‚ÜóÔ∏è"},{min:67.5,max:112.5,text:"east",icon:"‚û°Ô∏è"},{min:112.5,max:157.5,text:"southeast",icon:"‚ÜòÔ∏è"},{min:157.5,max:202.5,text:"south",icon:"‚¨áÔ∏è"},{min:202.5,max:247.5,text:"southwest",icon:"‚ÜôÔ∏è"},{min:247.5,max:292.5,text:"west",icon:"‚¨ÖÔ∏è"},{min:292.5,max:337.5,text:"northwest",icon:"‚ÜñÔ∏è"},{min:337.5,max:360,text:"north",icon:"‚¨ÜÔ∏è"}];for(const d of h)if(s>=d.min&&s<d.max)return d;return h[0]},O=(s,h,d)=>{const x=A(s.lat,s.lng,h.lat,h.lng);let S=A(h.lat,h.lng,d.lat,d.lng)-x;return S>180&&(S-=360),S<-180&&(S+=360),S},ee=s=>Math.abs(s)<20?{text:"Continue straight",icon:"‚¨ÜÔ∏è"}:s>20&&s<70?{text:"Turn slight right",icon:"‚ÜóÔ∏è"}:s>=70&&s<120?{text:"Turn right",icon:"‚û°Ô∏è"}:s>=120?{text:"Turn sharp right",icon:"‚Ü™Ô∏è"}:s<-20&&s>-70?{text:"Turn slight left",icon:"‚ÜñÔ∏è"}:s<=-70&&s>-120?{text:"Turn left",icon:"‚¨ÖÔ∏è"}:s<=-120?{text:"Turn sharp left",icon:"‚Ü©Ô∏è"}:{text:"Continue",icon:"‚¨ÜÔ∏è"},H=(s,h)=>{let d=0,x=1/0;return h.forEach((L,S)=>{const l=V(s.lat,s.lng,L[1],L[0]);l<x&&(x=l,d=S)}),{index:d,coord:h[d],distance:x}},j=(s,h,d=30)=>{let x=null,L=null,S=1/0;return h.forEach(l=>{if(l.geometry.type==="LineString"){const F=l.geometry.coordinates,$=H(s,F);$.distance<S&&(S=$.distance,x=l,L=$)}}),S<=d?{feature:x,point:L}:null},P=async(s,h,d)=>{try{const L=`https://router.project-osrm.org/route/v1/${d==="driving"?"driving":d==="riding"?"cycling":"walking"}/${s.lng},${s.lat};${h.lng},${h.lat}?overview=full&geometries=geojson`,l=await(await fetch(L)).json();if(l.code==="Ok"&&l.routes.length>0)return l.routes[0].geometry.coordinates.map(([$,E])=>({lat:E,lng:$}))}catch(x){console.error("OSRM routing error:",x)}return null},C=s=>{const h=new Map,d=new Map,x=(L,S)=>{const l=`${L.toFixed(6)},${S.toFixed(6)}`;if(!d.has(l)){const F=`node_${d.size}`;d.set(l,F),h.set(F,{id:F,lat:L,lng:S,neighbors:[]})}return d.get(l)};return s.forEach(L=>{if(L.geometry.type!=="LineString")return;const S=L.geometry.coordinates;let l=null;S.forEach(([F,$])=>{const E=x($,F),m=h.get(E);if(l){const K=h.get(l),X=V(K.lat,K.lng,$,F);m.neighbors.some(oe=>oe.id===l)||m.neighbors.push({id:l,cost:X}),K.neighbors.some(oe=>oe.id===E)||K.neighbors.push({id:E,cost:X})}l=E})}),console.log(`Built graph with ${h.size} nodes`),h},W=(s,h,d=100)=>{let x=null,L=1/0;for(const[S,l]of h.entries()){const F=V(s.lat,s.lng,l.lat,l.lng);F<L&&F<=d&&(L=F,x=S)}return x},a=(s,h,d)=>{if(!d.has(s)||!d.has(h))return console.warn("Start or goal node not in graph"),null;if(s===h){const Y=d.get(s);return[{lat:Y.lat,lng:Y.lng}]}const x=new Set,L=new Map,S=new Map,l=new Map;class F{constructor(){this.heap=[]}push(z,i){this.heap.push({item:z,priority:i}),this.bubbleUp(this.heap.length-1)}pop(){if(this.heap.length===0)return null;const z=this.heap[0].item,i=this.heap.pop();return this.heap.length>0&&(this.heap[0]=i,this.bubbleDown(0)),z}bubbleUp(z){for(;z>0;){const i=Math.floor((z-1)/2);if(this.heap[z].priority>=this.heap[i].priority)break;[this.heap[z],this.heap[i]]=[this.heap[i],this.heap[z]],z=i}}bubbleDown(z){for(;;){let i=z;const ae=2*z+1,J=2*z+2;if(ae<this.heap.length&&this.heap[ae].priority<this.heap[i].priority&&(i=ae),J<this.heap.length&&this.heap[J].priority<this.heap[i].priority&&(i=J),i===z)break;[this.heap[z],this.heap[i]]=[this.heap[i],this.heap[z]],z=i}}isEmpty(){return this.heap.length===0}}const $=new F;S.set(s,0);const E=d.get(s),m=d.get(h),K=(Y,z)=>V(Y.lat,Y.lng,z.lat,z.lng)*.95;l.set(s,K(E,m)),$.push(s,l.get(s));let X=0;const oe=d.size*2;for(;!$.isEmpty()&&X<oe;){X++;const Y=$.pop();if(Y===h)return console.log(`‚úÖ Path found in ${X} iterations`),_(L,Y,d);if(x.has(Y))continue;x.add(Y);const z=d.get(Y);if(!z)continue;const i=S.get(Y)||1/0;for(const ae of z.neighbors){const J=ae.id;if(x.has(J))continue;const re=d.get(J);if(!re)continue;const ce=i+ae.cost;if(!S.has(J)||ce<S.get(J)){L.set(J,Y),S.set(J,ce);const _e=ce+K(re,m);l.set(J,_e),$.push(J,_e)}}}return console.warn(`‚ö†Ô∏è No path found after ${X} iterations`),null},_=(s,h,d)=>{const x=[];let L=h;for(;L;){const S=d.get(L);x.unshift({lat:S.lat,lng:S.lng}),L=s.get(L)}return x};return{calculateDistance:V,calculateBearing:A,getDirection:u,calculateTurnAngle:O,getTurnInstruction:ee,getNearestPointOnLine:H,findClickedLineString:j,getPublicRoute:P,buildCampusGraph:C,findNearestNode:W,findPathAStar:a,calculateRouteDistance:s=>{let h=0;for(let d=0;d<s.length-1;d++)h+=V(s[d].lat,s[d].lng,s[d+1].lat,s[d+1].lng);return h},findCampusEntrances:s=>{const h=[];for(const[d,x]of s.entries())h.push({id:d,lat:x.lat,lng:x.lng,node:x});return h},generateEnhancedInstructions:(s,h)=>{if(!s||s.length<2)return[{icon:"üìç",text:"You are at your destination",distance:"0 m"}];const d=[];let x=0;const L=7,S=A(s[0].lat,s[0].lng,s[1].lat,s[1].lng),l=u(S);d.push({icon:"üö∂",text:`Start heading ${l.text}`,distance:"0 m",bearing:S.toFixed(0)+"¬∞"});let F=0;for(let m=0;m<s.length-1;m++)F+=V(s[m].lat,s[m].lng,s[m+1].lat,s[m+1].lng);const $=[];x=0;for(let m=1;m<s.length-1;m++){const K=V(s[m-1].lat,s[m-1].lng,s[m].lat,s[m].lng);x+=K;const X=O(s[m-1],s[m],s[m+1]);if(Math.abs(X)>20){const oe=A(s[m].lat,s[m].lng,s[m+1].lat,s[m+1].lng);$.push({index:m,angle:X,distance:x,bearing:oe})}}if(h&&F>100){const m=F/2;d.push({icon:"üè´",text:"Enter campus grounds",distance:`${Math.round(m)} m`})}const E=L-2-(h?1:0);return $.length>E&&($.sort((m,K)=>Math.abs(K.angle)-Math.abs(m.angle)),$.splice(E),$.sort((m,K)=>m.distance-K.distance)),$.forEach(m=>{const K=ee(m.angle);d.push({icon:K.icon,text:K.text,distance:`${Math.round(m.distance)} m`,bearing:m.bearing.toFixed(0)+"¬∞"})}),d.push({icon:"üéØ",text:"You have arrived at your destination",distance:`${Math.round(F)} m`}),d.length>L?[d[0],...d.slice(-Math.min(5,L-2)),d[d.length-1]].slice(0,L):d}}}function oo(){const V=ht(),{calculateDistance:A}=mt(),u=R(null),O=R(null),ee=R(null),H=R(null),j=(a,_)=>{if(!(!_||!a||!a.accuracy))try{H.value&&_.hasLayer&&_.hasLayer(H.value)&&(_.removeLayer(H.value),H.value=null),a.accuracy<100&&(H.value=G.circle([a.lat,a.lng],{radius:a.accuracy,color:"#3388ff",fillColor:"#3388ff",fillOpacity:.1,weight:1,opacity:.5}).addTo(_),H.value.bindTooltip(`GPS Accuracy: ${Math.round(a.accuracy)}m`,{permanent:!1,direction:"top",offset:[0,-10]}))}catch(T){console.warn("Error updating accuracy circle:",T)}},P=(a,_,T)=>{if(!u.value||!_){console.warn("Cannot update user marker: missing location or map");return}try{if(O.value&&typeof O.value.setLatLng=="function"&&_.hasLayer&&_.hasLayer(O.value)){O.value.setLatLng([u.value.lat,u.value.lng]);const M=`
          <div style="font-size: 13px; color: #1f2937; font-weight: 500;">
            ${a.nickname||"You"}
            ${u.value.accuracy?`<br><small style="color: #6b7280;">Accuracy: ${Math.round(u.value.accuracy)}m</small>`:""}
          </div>
        `;O.value.setPopupContent(M)}else{console.log("Creating new user marker..."),O.value=G.marker([u.value.lat,u.value.lng],{title:a.nickname||"You",draggable:!0,autoPan:!0,zIndexOffset:1e3,icon:G.divIcon({className:"user-location-marker",html:`
              <div style="
                background: #3388ff;
                border: 3px solid white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                animation: pulse 2s infinite;
              "></div>
            `,iconSize:[20,20],iconAnchor:[10,10]})}).addTo(_),O.value.on("dragend",D=>{const h=D.target.getLatLng();u.value={lat:parseFloat(h.lat.toFixed(8)),lng:parseFloat(h.lng.toFixed(8)),accuracy:u.value?.accuracy||10,isManual:!0},console.log("Marker dragged to:",u.value),j(u.value,_),T&&T(u.value),V.info("Location updated manually")});const M=`
          <div style="font-size: 13px; color: #1f2937; font-weight: 500;">
            ${a.nickname||"You"}
            ${u.value.accuracy?`<br><small style="color: #6b7280;">Accuracy: ${Math.round(u.value.accuracy)}m</small>`:""}
            ${u.value.isManual?'<br><small style="color: #f59e0b;">üìç Manually placed</small>':""}
          </div>
        `;O.value.bindPopup(M,{offset:[0,-12],closeButton:!1,autoPan:!1,className:"user-popup"}),a.nickname&&setTimeout(()=>{O.value&&!O.value.isPopupOpen()&&(O.value.openPopup(),setTimeout(()=>O.value.closePopup(),3e3))},1e3)}}catch(M){console.error("Error updating user marker:",M),O.value=null}},C=(a,_,T)=>{if(!navigator.geolocation){console.error("Geolocation not supported"),V.error("Geolocation is not supported by your browser");return}if(!_){console.warn("Cannot start tracking: map not initialized");return}console.log("Starting GPS tracking with real-time updates..."),ee.value=navigator.geolocation.watchPosition(M=>{if(!_){console.warn("Map destroyed during GPS update, stopping tracking"),W(_);return}const D={lat:parseFloat(M.coords.latitude.toFixed(8)),lng:parseFloat(M.coords.longitude.toFixed(8)),accuracy:M.coords.accuracy,heading:M.coords.heading,speed:M.coords.speed};if(console.log("GPS Update:",{position:`${D.lat.toFixed(8)}, ${D.lng.toFixed(8)}`,accuracy:`${Math.round(D.accuracy)}m`,heading:D.heading,speed:D.speed}),u.value){const s=A(u.value.lat,u.value.lng,D.lat,D.lng),h=D.accuracy<u.value.accuracy*.7;(s>2||h)&&(u.value=D,P(a,_,T),j(D,_),T&&T(D))}else u.value=D,P(a,_,T),j(D,_),V.success(`GPS acquired! Accuracy: ${Math.round(D.accuracy)}m`)},M=>{console.error("Geolocation watch error:",M);let D="GPS signal lost";switch(M.code){case M.PERMISSION_DENIED:D="GPS permission denied. Please enable location services.";break;case M.POSITION_UNAVAILABLE:D="GPS position unavailable. Check your location settings.";break;case M.TIMEOUT:D="GPS timeout. Trying to reconnect...",setTimeout(()=>C(a,_,T),2e3);break}console.warn(D),u.value||(u.value={lat:8.169,lng:126.003},P(a,_,T))},{enableHighAccuracy:!0,timeout:5e3,maximumAge:2e3})},W=a=>{if(ee.value!==null&&(navigator.geolocation.clearWatch(ee.value),ee.value=null,console.log("GPS tracking stopped")),H.value&&a&&a.hasLayer&&a.hasLayer(H.value)){try{a.removeLayer(H.value)}catch(_){console.warn("Error removing accuracy circle:",_)}H.value=null}if(O.value&&a&&a.hasLayer&&a.hasLayer(O.value)){try{a.removeLayer(O.value)}catch(_){console.warn("Error removing user marker:",_)}O.value=null}};return{userLocation:u,userMarker:O,watchId:ee,accuracyCircle:H,startTracking:C,stopTracking:W,updateUserMarker:P,updateAccuracyCircle:j}}function ao(){const V=R([]),A=R([]);return{facilityMarkers:V,polygonLayers:A,markerTypeIcons:{academic:"üè´",library:"üìö",laboratory:"üî¨",office:"üè¢",cafeteria:"üçΩÔ∏è",sports:"‚öΩ",dormitory:"üè†",parking:"üÖøÔ∏è",medical:"üè•",building:"üè¢",classroom:"üè´",administration:"üèõÔ∏è",default:"üìç"},addFacilityMarker:(j,P)=>{if(!P||!P.addLayer){console.warn("Cannot add marker: map not ready");return}try{const C=G.marker([j.lat,j.lng],{title:j.name,icon:G.divIcon({className:"facility-marker",html:`
            <div style="
              background: white;
              border: 1px solid #3B82F6;
              border-radius: 50%;
              width: 20px;
              height: 20px;
              display: flex;
              align-items: center;
              justify-content: center;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              font-size: 16px;
            ">
              ${j.icon}
            </div>
          `,iconSize:[40,40],iconAnchor:[20,20]})}).addTo(P);return V.value.push(C),C}catch(C){return console.error("Error adding facility marker:",C),null}},displayPolygons:(j,P)=>{if(!P||!j||!Array.isArray(j)){console.warn("Cannot display polygons: map or data not ready");return}A.value.forEach(C=>{if(P&&P.hasLayer&&P.hasLayer(C))try{P.removeLayer(C)}catch(W){console.warn("Error removing polygon layer:",W)}}),A.value=[],j.forEach(C=>{if(!C.coordinates||!Array.isArray(C.coordinates)){console.warn("Invalid polygon coordinates:",C);return}try{const W=C.coordinates.map(_=>[_.lat,_.lng]),a=G.polygon(W,{color:C.color||"#3B82F6",fillColor:C.fill_color||"#3B82F6",fillOpacity:C.fill_opacity||.3,weight:3,opacity:.9,lineCap:"round",lineJoin:"round"});C.name&&a.bindTooltip(C.name,{permanent:!1,direction:"center",className:"polygon-tooltip",opacity:.9}),a.on("mouseover",function(_){_.target.setStyle({fillOpacity:.5,weight:4})}),a.on("mouseout",function(_){_.target.setStyle({fillOpacity:C.fill_opacity||.3,weight:3})}),P&&P.addLayer&&(a.addTo(P),A.value.push(a))}catch(W){console.error("Error creating polygon:",C,W)}}),console.log(`Displayed ${A.value.length} polygons on map`)},cleanup:j=>{j&&(V.value.forEach(P=>{if(j.hasLayer&&j.hasLayer(P))try{j.removeLayer(P)}catch(C){console.warn("Error removing facility marker:",C)}}),V.value=[],A.value.forEach(P=>{if(j.hasLayer&&j.hasLayer(P))try{j.removeLayer(P)}catch(C){console.warn("Error removing polygon layer:",C)}}),A.value=[])}}}const ro={class:"relative flex h-screen w-full"},so={key:0,class:"z-20 flex flex-col border-gray-200 bg-white shadow-xl fixed bottom-0 left-0 right-0 max-h-[85vh] rounded-t-2xl md:relative md:h-full md:w-full md:max-w-md md:border-r md:rounded-none md:max-h-full"},no={class:"flex items-center justify-between border-b border-gray-200 bg-white px-4 py-3"},lo={class:"min-w-0 pr-3"},io={class:"flex items-center gap-2"},co={class:"text-xl"},uo={class:"truncate text-base font-semibold text-gray-900"},po={class:"mt-1 text-xs text-gray-500"},go={class:"flex-1 overflow-y-auto bg-gray-50"},vo={class:"space-y-4 px-4 py-4 bg-white"},ho={key:0,class:"text-sm leading-relaxed text-gray-600"},mo={class:"flex flex-wrap gap-2"},fo={key:1,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},yo={class:"whitespace-pre-line px-3 py-3 text-sm text-gray-700"},bo={key:2,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},xo={class:"mt-0.5 text-lg"},wo={class:"flex-1"},ko={class:"text-sm font-medium text-gray-800"},_o={class:"text-xs text-gray-500"},So={class:"border-t border-gray-200 px-4 py-4 bg-white"},Mo={class:"mb-3 flex items-center justify-between"},Lo={class:"text-xs text-gray-500"},Eo={class:"space-y-3"},Po={class:"rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-4 text-center hover:border-gray-400 transition"},Co={key:0,class:"space-y-2"},No={key:1,class:"space-y-3"},Io=["src"],Ao={class:"flex justify-end gap-2"},$o=["disabled"],Fo={key:0,class:"space-y-3"},To={class:"grid grid-cols-2 gap-3"},Do=["onClick"],Ro=["src","alt"],Go={class:"space-y-1 px-3 py-2 bg-gray-50"},Oo={class:"text-xs font-medium text-gray-900 truncate"},jo={class:"text-[11px] text-gray-500"},zo={key:1,class:"text-center text-sm text-gray-500"},Bo={class:"border-t border-gray-200 px-4 py-4 space-y-3 bg-white"},Uo={class:"flex items-center justify-between"},Vo={class:"text-xs text-gray-500"},Jo={class:"text-xs text-gray-500 bg-green-50 border border-green-200 rounded-lg px-3 py-2 space-y-1"},Ho={key:0,class:"space-y-2 rounded-lg border border-gray-300 bg-gray-50 p-3 shadow-sm"},Zo={class:"flex justify-end gap-2"},Ko=["disabled"],Yo={key:1},Wo={key:2,class:"space-y-3"},qo={class:"flex items-start justify-between gap-3"},Xo={class:"text-xs font-semibold text-gray-700"},Qo={key:0,class:"text-green-700"},ea={class:"text-xs text-gray-500"},ta=["onClick"],oa={class:"mt-2 text-sm text-gray-800 leading-relaxed"},aa={key:3,class:"text-center text-sm text-gray-500"},ra={class:"border-t border-gray-200 px-4 py-4 space-y-3 bg-white"},sa={class:"flex items-center justify-between"},na={class:"text-xs text-gray-500"},la={key:0,class:"space-y-2 rounded-lg border border-gray-300 bg-gray-50 p-3 shadow-sm"},ia={class:"flex justify-end gap-2"},ca=["disabled"],ua={key:1},da={key:2,class:"space-y-2"},pa={class:"max-h-60 overflow-y-auto space-y-3 pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"},ga={class:"flex items-center justify-between"},va={class:"text-sm font-semibold text-gray-800"},ha={class:"text-xs text-gray-500"},ma={class:"mt-2 text-sm text-gray-700"},fa={key:3,class:"text-sm text-gray-500 text-center"},ya={class:"relative flex-1"},ba={key:0,class:"absolute top-4 left-4 right-4 sm:left-1/2 sm:right-auto sm:-translate-x-1/2 sm:transform z-10 sm:w-full sm:max-w-md sm:px-4"},xa={class:"bg-white rounded-lg shadow-lg"},wa={class:"relative"},ka={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},_a={key:0,class:"mt-1 max-h-48 overflow-y-auto border-t border-gray-200 sm:max-h-60"},Sa={key:0,class:"p-3 text-center text-xs text-gray-500 sm:p-4 sm:text-sm"},Ma={key:1,class:"p-3 text-center text-xs text-gray-500 sm:p-4 sm:text-sm"},La={key:2},Ea=["onClick"],Pa={class:"text-lg sm:text-xl"},Ca={class:"min-w-0 flex-1"},Na={class:"truncate text-xs font-medium text-gray-900 sm:text-sm"},Ia={class:"truncate text-[11px] text-gray-500"},Aa={key:1,class:"absolute bottom-4 left-4 z-10"},$a={class:"flex max-w-[calc(100vw-6rem)] flex-wrap gap-1 rounded-lg bg-white p-1.5 shadow-lg sm:max-w-none sm:p-2"},Fa=["onClick","title"],Ta={class:"text-base sm:text-lg"},Da={class:"hidden text-xs lg:inline"},Ra={key:2,class:"absolute top-4 right-4 z-10"},Ga={class:"flex items-center gap-2 rounded-lg bg-white px-3 py-2 shadow-lg sm:px-4"},Oa={class:"hidden text-left sm:block"},ja={class:"max-w-[120px] truncate text-xs font-semibold text-gray-900"},za={class:"text-xs text-gray-500"},Ba={key:3,class:"absolute left-4 top-20 hidden w-64 rounded-lg border border-gray-200 bg-white shadow-lg sm:block sm:w-72"},Ua={class:"flex items-center justify-between border-b border-gray-200 bg-green-900 px-3 py-2"},Va={class:"max-h-40 overflow-y-auto px-3 py-2 text-xs leading-relaxed text-gray-700"},Ja={key:4,class:"absolute bottom-20 left-4 right-4 z-20 flex max-h-52 flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-lg sm:bottom-4 sm:left-auto sm:w-72"},Ha={class:"flex items-center justify-between border-b border-gray-200 bg-green-900 px-3 py-2"},Za={class:"mt-0.5 text-sm"},Ka={class:"min-w-0 flex-1"},Ya={class:"font-medium text-gray-900"},Wa={class:"text-gray-500"},qa={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 p-4"},Xa={class:"relative w-full max-w-sm rounded-lg bg-white shadow-2xl"},Qa={key:0,class:"p-6 sm:p-8"},er={class:"space-y-4"},tr=["disabled"],or={key:1,class:"p-6 sm:p-8"},ar={class:"mb-6 space-y-3"},rr=["onClick"],sr={class:"text-xl sm:text-2xl"},nr={class:"text-sm font-medium text-gray-900"},lr={class:"space-y-2"},ir=["disabled"],cr={class:"relative bg-white rounded-lg overflow-hidden shadow-2xl"},ur=["src","alt"],dr={class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},pr={key:0,class:"text-sm font-medium text-gray-900 mb-1"},gr={class:"text-xs text-gray-600"},vr={class:"text-xs text-gray-500 mt-1"},ze="localStorage",hr={__name:"GuestMapV2",props:{facilities:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},polygons:{type:Array,default:()=>[]}},setup(V){const A=V,u=ht(),O=Qt(),{isSearching:ee,showSearchResults:H,showGuestModal:j,isGuestInfoComplete:P,showInstructions:C,isSavingFeedback:W,map:a,searchQuery:_,destinationMarker:T,routePolyline:M,routeInfo:D,privateRoutes:s,guestStep:h,selectedMarker:d,feedback:x,message:L,filteredLocations:S,selectedLocation:l,geoJsonLayers:F,navigationInstructions:$}=Vt(O),E=mt(),m=oo(),{addFacilityMarker:K,displayPolygons:X,markerTypeIcons:oe,facilityMarkers:Y,polygonLayers:z}=ao(),i=R({id:null,nickname:"",role:""}),ae=R(null),J=R("walking"),re=R(null),ce=R(null),_e=[{value:"walking",label:"Walking",icon:"üö∂",speed:5},{value:"riding",label:"Riding",icon:"üö¥",speed:15},{value:"driving",label:"Driving",icon:"üöó",speed:40}],ue=R([]),ft=[{value:"student",label:"Student",icon:"üéì"},{value:"faculty",label:"Faculty",icon:"üë®‚Äçüè´"},{value:"visitor",label:"Visitor",icon:"üë§"}],Q=R([]),be=R([]),te=R({}),de=R(!1),Ke=R(!1),Be=R(null),pe=R(null),Ie=R(""),Ue=R(!1),se=R(""),Ve=R(!1),Ae=R(null),Se=R(!1),$e=R(!1),Ye=R(!1),q=R(0),Me=R(!1),Fe=R("navigation"),at=()=>{const e=[];Array.isArray(A.facilities)&&A.facilities.forEach(t=>{const r=t?.marker?.feedbacks;Array.isArray(r)&&r.forEach(c=>{c&&e.push(c)})}),be.value=e},rt=()=>{const e={};Array.isArray(A.facilities)&&A.facilities.forEach(t=>{!t||!t.id||(e[t.id]=Array.isArray(t.photos)?[...t.photos]:[])}),te.value=e};at(),rt();const yt=async e=>{if(e)try{const t=await fe.get(`/facilities/${e}/photos`);te.value={...te.value,[e]:Array.isArray(t.data?.photos)?t.data.photos:[]}}catch(t){console.error("Error fetching facility photos:",t)}};Ce(()=>A.notes,e=>{Q.value=Array.isArray(e)?[...e]:[]},{deep:!0}),Ce(()=>A.facilities,()=>{at(),rt()},{deep:!0});const Le=le(()=>l.value?.id??null),Te=le(()=>l.value?.marker_id??l.value?.marker?.id??null),We=le(()=>{if(!Le.value)return[];const e=te.value[Le.value]||[];return!Me.value&&e.length>2?e.slice(0,2):e}),ne=le(()=>Le.value?te.value[Le.value]||[]:[]),Ee=le(()=>{if(!Le.value)return{displayed:0,total:0};const e=te.value[Le.value]||[];return{displayed:We.value.length,total:e.length}}),De=le(()=>Te.value?Q.value.filter(e=>e.marker_id===Te.value):[]),qe=le(()=>Te.value?be.value.filter(e=>e.marker_id===Te.value):[]),bt=le(()=>!Te.value||!i.value.id?!1:De.value.some(e=>e.guest_id===i.value.id)),xt=((e,t)=>{let r;return(...c)=>{clearTimeout(r),r=setTimeout(()=>e(...c),t)}})(async e=>{if(!(!e.trim()||!i.value.id))try{await fe.post("/search-logs",{guest_id:i.value.id,query:e.trim(),search_at:new Date().toISOString()}),console.log("‚úÖ Search logged successfully")}catch(t){console.error("Failed to log search:",t)}},500);Ce($,()=>{ce.value&&(ce.value.scrollTop=0)},{deep:!0}),Ce(_,e=>{e.length>0&&xt(e),e.length>0?(ee.value=!0,S.value=xe.value.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.department.toLowerCase().includes(e.toLowerCase())||t.category&&t.category.toLowerCase().includes(e.toLowerCase())),H.value=!0):(H.value=!1,S.value=[]),ee.value=!1});const st=()=>{ae.value=setInterval(()=>{const e=sessionStorage.getItem("guestInfo");if(e)try{const t=JSON.parse(e);t.expiresAt&&Date.now()>t.expiresAt&&(console.log("‚è±Ô∏è Session expired, reloading page..."),nt())}catch(t){console.error("Error checking session:",t),nt()}},6e4)},nt=()=>{sessionStorage.removeItem("guestInfo"),window.location.reload()},wt=()=>{const e=sessionStorage.getItem("guestInfo");if(e)try{const t=JSON.parse(e);return t.expiresAt&&Date.now()>t.expiresAt?(console.log("‚è±Ô∏è Session expired, clearing stored data"),sessionStorage.removeItem("guestInfo"),!1):(i.value=t,P.value=!0,j.value=!1,st(),!0)}catch(t){console.error("Error parsing guest info:",t),sessionStorage.removeItem("guestInfo")}return!1},xe=le(()=>!A.facilities||!Array.isArray(A.facilities)?(console.warn("No facilities data"),[]):A.facilities.filter(e=>{const t=e&&e.marker&&e.marker.longitude!==null&&e.marker.latitude!==null&&!isNaN(parseFloat(e.marker.longitude))&&!isNaN(parseFloat(e.marker.latitude));return t||console.warn("Skipping facility with invalid marker:",e),t}).map(e=>{try{const t=e.marker?.type?.toLowerCase()||"default";return{id:e.id,marker_id:e.marker.id,name:e.name||"Unnamed Facility",lng:parseFloat(e.marker.longitude),lat:parseFloat(e.marker.latitude),department:e.marker?.type||"Unknown",markerType:t,category:e.category||"General",description:e.description||"",icon:oe[t]||oe.default,marker:e.marker,photos:Array.isArray(e.photos)?e.photos:[],feedbacks:e.marker?.feedbacks||[]}}catch(t){return console.error("Error processing facility:",e,t),null}}).filter(e=>e!==null)),lt=()=>{if(!i.value.nickname.trim()){u.error("Please enter your nickname");return}h.value=2},kt=()=>{h.value=1},_t=async()=>{if(!i.value.nickname||!i.value.role){u.error("Please complete all steps");return}try{const t=(await fe.post("/guests",{name:i.value.nickname,role:i.value.role})).data;i.value.id=t.id;const r={...i.value,expiresAt:Date.now()+1440*60*1e3};sessionStorage.setItem("guestInfo",JSON.stringify(r)),P.value=!0,j.value=!1,u.success(`Welcome, ${i.value.nickname}!`),st(),a.value?m.userLocation.value?m.updateUserMarker(i.value,a.value,ot):m.startTracking(i.value,a.value,ot):await ut()}catch(e){console.error("Error saving guest info:",e),u.error(e.response?.data?.message||"Failed to save guest information")}},St=e=>{const t=_e.find(n=>n.value===J.value),c=(t?t.speed:5)*1e3/3600,y=e/c,v=Math.ceil(y/60),N=new Date,w=new Date(N.getTime()+y*1e3);return{minutes:v,arrivalTime:w.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}},Mt=(e,t)=>E.generateEnhancedInstructions(e,t),Je=(e,{centerOnMap:t=!0}={})=>{if(!e)return;const r=l.value&&l.value.id===e.id;if(d.value=e,l.value=e,de.value=!0,!r){x.value="",se.value="",Se.value=!1,Re(),Me.value=!1;const c=localStorage,y=`facility_notes_${e.id}`,v=c.getItem(y);if(v)try{const N=JSON.parse(v),w=Date.now(),n=N.filter(I=>!(I.expiresAt&&I.expiresAt<w));n.length!==N.length&&c.setItem(y,JSON.stringify(n));const f=new Set(n.map(I=>I.id)),U=Q.value.filter(I=>!f.has(I.id));Q.value=[...n,...U]}catch(N){console.warn("Error parsing stored notes:",N)}}if(e.id&&yt(e.id),t&&a.value)try{a.value.panTo([e.lat,e.lng],{animate:!0})}catch(c){console.warn("Failed to pan to location:",c)}},Lt=()=>{de.value=!1},Et=()=>{if(!l.value||!a.value){u.error("Select a destination first");return}we(G.latLng(l.value.lat,l.value.lng),l.value)},we=async(e,t=null,r=null)=>{if(!m.userLocation.value){u.error("Waiting for GPS location...");return}if(t?(!l.value||l.value.id!==t.id||!de.value)&&Je(t,{centerOnMap:!1}):(de.value=!1,l.value=null),M.value&&a.value){try{a.value.hasLayer(M.value)&&a.value.removeLayer(M.value)}catch(n){console.warn("Error removing route polyline:",n)}M.value=null}if(T.value&&a.value){try{a.value.hasLayer(T.value)&&a.value.removeLayer(T.value)}catch(n){console.warn("Error removing destination marker:",n)}T.value=null}a.value&&a.value.closePopup();const c={lat:m.userLocation.value.lat,lng:m.userLocation.value.lng},y={lat:e.lat,lng:e.lng};if(re.value={lat:c.lat,lng:c.lng},console.log("üîç Calculating optimal route..."),s.value&&s.value.features){const n=E.findClickedLineString(y,s.value.features,30);if(n){console.log("üéØ User clicked on a campus path! Using hybrid route...");const f=n.feature.geometry.coordinates,U=n.point,I={lat:f[0][1],lng:f[0][0]},Z=await E.getPublicRoute(c,I,J.value);let ve=[];Z&&Z.length>0?ve=[...Z]:ve=[c,I];for(let Pe=0;Pe<=U.index;Pe++){const[He,Ut]=f[Pe];ve.push({lat:Ut,lng:He})}ke(ve,"hybrid",!0,r),console.log("‚úÖ Hybrid route to campus path completed");return}}if(!s.value||!s.value.features||s.value.features.length===0){console.warn("‚ö†Ô∏è No campus paths available, using public route only");const n=await E.getPublicRoute(c,y,J.value);n?ke(n,"public",!1,r):ke([c,y],"direct",!1,r);return}const v=E.buildCampusGraph(s.value.features);if(v.size===0){console.warn("‚ö†Ô∏è Campus graph is empty, using public route only");const n=await E.getPublicRoute(c,y,J.value);n?ke(n,"public",!1,r):ke([c,y],"direct",!1,r);return}const N=[];try{const n=await E.getPublicRoute(c,y,J.value);if(n&&n.length>0){const f=E.calculateRouteDistance(n);N.push({type:"public",route:n,distance:f,isPrivate:!1}),console.log(`üü¢ Public route: ${Math.round(f)}m`)}}catch(n){console.error("‚ùå Public route error:",n)}try{const n=E.findNearestNode(c,v,100),f=E.findNearestNode(y,v,100);if(n&&f){console.log(`üîç Trying A* from ${n} to ${f}`);const U=E.findPathAStar(n,f,v);if(U&&U.length>0){const I=E.calculateRouteDistance(U);N.push({type:"private",route:U,distance:I,isPrivate:!0}),console.log(`üî¥ Campus route: ${Math.round(I)}m`)}}}catch(n){console.error("‚ùå Campus route error:",n)}try{const n=E.findCampusEntrances(v);if(n.length>0){const f=n.reduce((U,I)=>{const Z=E.calculateDistance(y.lat,y.lng,I.lat,I.lng);return Z<U.distance?{entrance:I,distance:Z}:U},{entrance:null,distance:1/0});if(f.entrance&&f.distance<200){const U={lat:f.entrance.lat,lng:f.entrance.lng},I=await E.getPublicRoute(c,U,J.value);if(I&&I.length>0){const Z=E.findNearestNode(y,v,100);if(Z){const ve=E.findPathAStar(f.entrance.id,Z,v);if(ve&&ve.length>0){const Pe=[...I,...ve],He=E.calculateRouteDistance(Pe);N.push({type:"hybrid",route:Pe,distance:He,isPrivate:!0}),console.log(`üîµ Hybrid route: ${Math.round(He)}m`)}}}}}}catch(n){console.error("Hybrid route error:",n)}if(N.length===0){console.warn("‚ö†Ô∏è All routing failed, using direct line"),ke([c,y],"direct",!1);return}const w=N.reduce((n,f)=>f.distance<n.distance?f:n);console.log(`Selected: ${w.type.toUpperCase()} route (${Math.round(w.distance)}m)`),ke(w.route,w.type,w.isPrivate)},ke=(e,t,r,c=null)=>{if(!a.value){console.warn("Cannot draw route: map not initialized");return}if(M.value){try{a.value.hasLayer(M.value)&&a.value.removeLayer(M.value)}catch(Z){console.warn("Error removing old route polyline:",Z)}M.value=null}if(T.value){try{a.value.hasLayer(T.value)&&a.value.removeLayer(T.value)}catch(Z){console.warn("Error removing old destination marker:",Z)}T.value=null}const y=e.map(Z=>[Z.lat,Z.lng]),N=c||{public:"#4CAF50",private:"#FF6B6B",hybrid:"#2196F3",direct:"#9E9E9E"}[t]||"#9E9E9E";M.value=G.polyline(y,{color:N,weight:6,opacity:.8,smoothFactor:1}).addTo(a.value),Ke.value=!0;const w=E.calculateRouteDistance(e),n=w>1e3?`${(w/1e3).toFixed(2)} km`:`${Math.round(w)} m`,f=St(w),U={public:"üü¢ Public Roads",private:"üî¥ Campus Path",hybrid:"üîµ Public ‚Üí Campus",direct:"‚ö™ Direct Line"},I=_e.find(Z=>Z.value===J.value);D.value=`${U[t]}
${I.icon} ${I.label}
üìè ${n}
‚è±Ô∏è ${f.minutes} min
üïê Arrive at ${f.arrivalTime}`,$.value=Mt(e,r),C.value=!0,console.log(`Generated ${$.value.length} navigation instructions`);try{M.value&&a.value.hasLayer(M.value)&&a.value.fitBounds(M.value.getBounds(),{padding:[50,50]})}catch(Z){console.warn("Error fitting bounds:",Z)}u.success(`Route via ${U[t]}`)},Pt=()=>{const e=localStorage,t=[],r=Date.now();for(let c=0;c<e.length;c++){const y=e.key(c);if(y&&y.startsWith("facility_notes_"))try{const v=e.getItem(y);if(v){const N=JSON.parse(v),w=N.filter(n=>!(n.expiresAt&&n.expiresAt<r));w.length!==N.length&&e.setItem(y,JSON.stringify(w)),t.push(...w)}}catch(v){console.warn(`Error parsing notes from ${y}:`,v)}}Q.value=t,console.log(`üìù Loaded ${t.length} notes from ${ze}`)},Ct=()=>{if(!a.value){u.error("Map not initialized");return}if(!m.userLocation.value){u.error("GPS location not available yet");return}const{lat:e,lng:t}=m.userLocation.value;a.value.flyTo([e,t],18,{animate:!0,duration:1.5}),u.success("Centered on your location"),m.userMarker.value&&setTimeout(()=>{m.userMarker.value.openPopup(),setTimeout(()=>m.userMarker.value.closePopup(),2e3)},1500)},Xe=async e=>{try{const t=ze==="localStorage"?localStorage:sessionStorage,r=Q.value.find(v=>v.id===e);if(!r){u.error("Note not found");return}const c=xe.value.find(v=>v.marker_id===r.marker_id);if(c){const v=`facility_notes_${c.id}`,N=t.getItem(v);if(N){let w=JSON.parse(N);w=w.filter(n=>n.id!==e),t.setItem(v,JSON.stringify(w))}}const y=ue.value.findIndex(v=>v.noteId===e);if(y!==-1&&a.value){const v=ue.value[y].marker;if(v)try{v.off(),a.value.hasLayer(v)&&a.value.removeLayer(v)}catch(N){console.warn("Error removing note marker:",N)}ue.value.splice(y,1)}Q.value=Q.value.filter(v=>v.id!==e),u.success("Note deleted successfully!")}catch(t){console.error("Error deleting note:",t),u.error("Failed to delete note")}},Nt=async()=>{if(!se.value.trim()){u.error("Please enter a note before saving");return}if(!i.value.id){u.error("Guest information not found");return}if(!l.value){u.error("Select a destination to attach the note");return}Ve.value=!0;try{const e=ze==="localStorage"?localStorage:sessionStorage,t=`facility_notes_${l.value.id}`,r=`${t}_expiration`,c=e.getItem(t);let y=c?JSON.parse(c):[];const v=Date.now();y=y.filter(f=>!(f.expiresAt&&f.expiresAt<v));const N=y.findIndex(f=>f.guest_id===i.value.id),w=v+1440*60*1e3,n={id:`${ze}_${Date.now()}`,content:se.value.trim(),marker_id:l.value.marker_id,guest_id:i.value.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),expiresAt:w,guest:{id:i.value.id,name:i.value.nickname}};N!==-1?y[N]=n:y.push(n),e.setItem(t,JSON.stringify(y)),Q.value=Q.value.filter(f=>!(f.marker_id===l.value.marker_id&&f.guest_id===i.value.id)),Q.value=[...Q.value,n],window.location.reload()}catch(e){console.error("Error saving note:",e),u.error("Failed to save note")}finally{Ve.value=!1}},It=e=>{const t=e?.target?.files?.[0];t&&(pe.value&&URL.revokeObjectURL(pe.value),Be.value=t,pe.value=URL.createObjectURL(t),e?.target&&(e.target.value=""))},Re=()=>{pe.value&&URL.revokeObjectURL(pe.value),Be.value=null,pe.value=null,Ie.value="",Ae.value&&(Ae.value.value="")},At=()=>{const e=De.value.find(t=>t.guest_id===i.value.id);e?se.value=e.content:se.value="",Se.value=!0},$t=async()=>{if(!l.value){u.error("Select a destination before uploading photos");return}if(!i.value.id){u.error("Guest information not found");return}if(!Be.value){u.error("Choose a photo to upload");return}Ue.value=!0;try{const e=new FormData;e.append("photo",Be.value),e.append("guest_id",i.value.id),Ie.value.trim()&&e.append("caption",Ie.value.trim());const t=await fe.post(`/facilities/${l.value.id}/photos`,e,{headers:{"Content-Type":"multipart/form-data"}}),r=t.data.photo,c=l.value.id;te.value={...te.value,[c]:[r,...te.value[c]||[]]},u.success(t.data.message||"Photo uploaded successfully!"),Re()}catch(e){console.error("Error uploading photo:",e),u.error("Failed to upload photo")}finally{Ue.value=!1}},Ft=()=>{Ae.value&&Ae.value.click()},Ge=e=>{if(!e)return"";try{return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Failed to format timestamp:",t),e}},Qe=()=>{if(!a.value||!a.value._loaded||!Array.isArray(Y.value)){console.warn("displayNotesOnMap: Map or markers not ready");return}if(!i.value||!i.value.id){console.warn("displayNotesOnMap: Guest info not available");return}if(ge||a.value._animatingZoom||a.value._isZooming){console.warn("displayNotesOnMap: BLOCKED - Zoom in progress!");return}if(a.value._zoom!==a.value.getZoom()){console.warn("displayNotesOnMap: Zoom level mismatch, delaying..."),setTimeout(()=>Qe(),300);return}console.log("üìù displayNotesOnMap: Starting (safe to proceed)"),ue.value.forEach(e=>{if(e.marker&&a.value)try{e.marker.off(),a.value.hasLayer(e.marker)&&a.value.removeLayer(e.marker)}catch(t){console.warn("Error removing note marker:",t)}}),ue.value=[],Y.value.forEach((e,t)=>{const r=xe.value[t];if(!r)return;const c=Q.value.find(y=>y.marker_id===r.marker_id&&y.guest_id===i.value.id);if(c)try{const y=n=>{const f=document.createElement("div");return f.textContent=n,f.innerHTML},v=`
          <div class="note-bubble-container" data-note-id="${c.id}" style="
            background: white !important;
            border: 2px solid #E5E7EB !important;
            border-radius: 12px !important;
            padding: 14px 16px !important;
            min-width: 220px !important;
            max-width: 300px !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15), 0 4px 10px rgba(0, 0, 0, 0.08) !important;
            position: relative !important;
            opacity: 1 !important;
            transform: translateY(-100%) !important;
            margin-bottom: 20px !important;
            pointer-events: auto !important;
          ">
            <div class="note-bubble-header" style="
              display: flex !important;
              align-items: flex-start !important;
              gap: 10px !important;
              margin-bottom: 10px !important;
              padding-bottom: 10px !important;
              border-bottom: 1px solid #F3F4F6 !important;
            ">
              <div class="note-bubble-icon" style="font-size: 20px !important; line-height: 1 !important; flex-shrink: 0 !important;">üí¨</div>
              <div class="note-bubble-meta" style="
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 3px !important;
              ">
                <span class="note-bubble-label" style="
                  font-size: 11px !important;
                  font-weight: 700 !important;
                  color: #6366F1 !important;
                  text-transform: uppercase !important;
                  letter-spacing: 0.8px !important;
                ">Your Note</span>
                <span class="note-bubble-time" style="
                  font-size: 10px !important;
                  color: #9CA3AF !important;
                  font-weight: 500 !important;
                ">${Ge(c.created_at)}</span>
              </div>
              <button
                class="note-bubble-delete"
                title="Delete note"
                data-note-id="${c.id}"
                style="
                  background: #FEE2E2 !important;
                  border: none !important;
                  border-radius: 6px !important;
                  width: 24px !important;
                  height: 24px !important;
                  display: flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  cursor: pointer !important;
                  color: #EF4444 !important;
                  transition: all 0.2s ease !important;
                  flex-shrink: 0 !important;
                  padding: 0 !important;
                "
              >
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
            <div class="note-bubble-content" style="
              font-size: 14px !important;
              color: #1F2937 !important;
              line-height: 1.6 !important;
              word-wrap: break-word !important;
              font-weight: 400 !important;
              padding: 0 !important;
            ">${y(c.content)}</div>
            <div class="note-bubble-arrow" style="
              position: absolute !important;
              bottom: -10px !important;
              left: 50% !important;
              transform: translateX(-50%) !important;
              width: 0 !important;
              height: 0 !important;
              border-left: 12px solid transparent !important;
              border-right: 12px solid transparent !important;
              border-top: 12px solid white !important;
              filter: drop-shadow(0 3px 3px rgba(0, 0, 0, 0.1)) !important;
            "></div>
          </div>
        `,N=G.divIcon({className:"note-bubble-marker",html:v,iconSize:[280,"auto"],iconAnchor:[140,70]});if(!a.value||ge||a.value._animatingZoom){console.warn(`Aborting note marker creation for ${r.name} - zoom in progress`);return}const w=G.marker([r.lat,r.lng],{icon:N,interactive:!1,zIndexOffset:-1e3,bubblingMouseEvents:!1});try{w.addTo(a.value)}catch(n){console.error("Failed to add note marker to map:",n);return}ue.value.push({noteId:c.id,marker:w,facilityMarkerId:r.marker_id}),setTimeout(()=>{const n=document.querySelector(`.note-bubble-delete[data-note-id="${c.id}"]`);n&&n.addEventListener("click",f=>{f.stopPropagation(),Xe(c.id)})},150)}catch(y){console.error(`‚ùå Error creating note marker for ${r.name}:`,y)}}),console.log(`üìù Created ${ue.value.length} note bubble markers`)};let et=null,ge=!1;const tt=()=>{if(ge){console.warn("debouncedDisplayNotes: Skipping due to zoom in progress");return}et&&clearTimeout(et),et=setTimeout(()=>{!ge&&a.value&&!a.value._animatingZoom&&Qe()},250)};Ce(Q,()=>{a.value&&!ge&&tt()},{deep:!0}),Ce(()=>A.polygons,()=>{a.value&&X(A.polygons,a.value)},{deep:!0,immediate:!1});const it=async()=>{try{const e=await fe.get("/routes/export/geojson-pub",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});s.value=e.data,a.value&&Tt(),console.log("Loaded routes from database:",s.value)}catch(e){console.error("Error loading routes from database:",e),u.error("Failed to load campus paths")}},Tt=()=>{if(!a.value||!s.value||!s.value.features){console.warn("Cannot refresh private routes: Map or data not ready");return}F.value.forEach(e=>{if(a.value&&a.value.hasLayer&&a.value.hasLayer(e))try{a.value.removeLayer(e)}catch(t){console.warn("Error removing route layer:",t)}}),F.value=[],s.value.features.forEach(e=>{if(e.geometry&&e.geometry.type==="LineString"){const t=e.properties?.color||"#FF6B6B",r=G.geoJSON(e,{style:{color:t,weight:6,opacity:.9,dashArray:"10, 5",lineCap:"round",lineJoin:"round"}}).addTo(a.value);r.on("click",c=>{G.DomEvent.stopPropagation(c),we(c.latlng,null,e.properties?.color)}),F.value.push(r)}}),console.log(`Added ${s.value.features.length} campus path layers`),u.success("Campus paths updated in real-time!")},ct=async()=>{try{const e=await fe.get("/",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});e.data&&e.data.props&&e.data.props.facilities&&(O.facilities=e.data.props.facilities,Y.value.forEach(t=>{if(a.value&&a.value.hasLayer&&a.value.hasLayer(t))try{a.value.removeLayer(t)}catch(r){console.warn("Error removing marker:",r)}}),Y.value=[],O.facilities.forEach(t=>{t.marker&&t.marker.latitude&&t.marker.longitude&&K(t,a.value)}),console.log("‚úì Facilities loaded and markers refreshed:",O.facilities.length))}catch(e){console.error("Error loading facilities:",e),u.error("Failed to load facilities")}},Dt=async()=>{try{const e=await fe.get("/facilities/polygons",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});e.data&&(z.value.forEach(t=>{if(a.value&&a.value.hasLayer&&a.value.hasLayer(t))try{a.value.removeLayer(t)}catch(r){console.warn("Error removing polygon:",r)}}),z.value=[],X(e.data,a.value),console.log("‚úì Polygons loaded and refreshed"))}catch(e){console.error("Error loading polygons:",e),u.error("Failed to load polygons")}},ot=e=>{if(l.value&&Ke.value)if(re.value){const t=E.calculateDistance(re.value.lat,re.value.lng,e.lat,e.lng);t>10?(console.log(`User moved ${Math.round(t)}m since last route calculation, updating route...`),re.value={lat:e.lat,lng:e.lng},u.info("Updating route from new position...",{timeout:2e3}),we(G.latLng(l.value.lat,l.value.lng),l.value)):console.log(`User moved ${Math.round(t)}m (< 10m threshold, keeping current route)`)}else M.value&&(console.log("Initial GPS sync for existing route, recalculating..."),re.value={lat:e.lat,lng:e.lng},we(G.latLng(l.value.lat,l.value.lng),l.value))},ut=async()=>{try{await it(),Pt();const e=G.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}),t=G.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"});a.value=G.map("map",{center:[8.1695,126.001838],zoom:17,layers:[e],zoomControl:!0}),Fe.value="navigation";const r={navigation:{layer:e},satellite:{layer:t}},c=v=>{if(!r[v]||Fe.value===v)return;const N=r[Fe.value]?.layer;N&&a.value.hasLayer(N)&&a.value.removeLayer(N),r[v].layer.addTo(a.value),Fe.value=v},y=G.Control.extend({options:{position:"bottomright"},onAdd:()=>{const v=G.DomUtil.create("div","leaflet-control guest-map-controls");v.innerHTML=`
          <button type="button" class="guest-control-button guest-control-button__locate" data-action="locate" title="Jump to my location">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3" />
              <path d="M12 5V3" />
              <path d="M12 21v-2" />
              <path d="M5 12H3" />
              <path d="M21 12h-2" />
              <path d="M19.071 4.929l-1.414 1.414" />
              <path d="M6.343 17.657l-1.414 1.414" />
              <path d="M4.929 4.929l1.414 1.414" />
              <path d="M17.657 17.657l1.414 1.414" />
            </svg>
          </button>
          <div class="guest-base-toggle">
            <button type="button" class="guest-control-button" data-layer="navigation" title="Navigation view">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 20l-6-2V6l6 2 6-2 6 2v12l-6-2-6 2z" />
                <path d="M9 8v12" />
                <path d="M15 6v12" />
              </svg>
            </button>
            <button type="button" class="guest-control-button" data-layer="satellite" title="Satellite view">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 4h6l10 10-6 6L4 10V4z" />
                <path d="M2 12l4-4" />
                <path d="M12 22l4-4" />
                <path d="M14 10l-4 4" />
              </svg>
            </button>
          </div>
        `;const N=v.querySelector('[data-action="locate"]'),w=v.querySelectorAll("[data-layer]"),n=()=>{w.forEach(f=>{f.classList.toggle("is-active",f.dataset.layer===Fe.value)})};return G.DomEvent.on(N,"click",f=>{G.DomEvent.stopPropagation(f),G.DomEvent.preventDefault(f),Ct()}),w.forEach(f=>{G.DomEvent.on(f,"click",U=>{G.DomEvent.stopPropagation(U),G.DomEvent.preventDefault(U);const I=f.dataset.layer;c(I),n()})}),n(),G.DomEvent.disableClickPropagation(v),G.DomEvent.disableScrollPropagation(v),v}});a.value.addControl(new y),a.value.whenReady(()=>{console.log("Map is fully loaded and ready"),xe.value.length>0&&(console.log(`Adding ${xe.value.length} facility markers`),xe.value.forEach(w=>{const n=K(w,a.value);if(n){typeof n.unbindPopup=="function"&&n.unbindPopup();const f=`
              <div style="padding: 8px; min-width: 200px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                  <span style="font-size: 20px;">${w.icon}</span>
                  <strong style="font-size: 14px; color: #1f2937;">${w.name}</strong>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin: 0;">${w.address||"San Francisco ‚Ä¢ Agusan del Sur"}</p>
                <button
                  onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${w.id} }))"
                  style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                  onmouseover="this.style.background='#2563eb'"
                  onmouseout="this.style.background='#3b82f6'"
                >
                  View Details
                </button>
              </div>
            `;n.bindPopup(f,{closeButton:!1,className:"facility-popup",offset:[0,-15]}),n.on("mouseover",function(){this.openPopup()}),n.on("popupopen",function(){const I=this.getPopup().getElement();I&&(I.addEventListener("mouseenter",()=>{n.openPopup()}),I.addEventListener("mouseleave",()=>{n.closePopup()}))}),n.on("mouseout",function(){const U=this;setTimeout(()=>{const I=U.getPopup();I&&I.getElement()&&(I.getElement().matches(":hover")||U.closePopup())},100)}),n.on("click",()=>{Je(w)})}})),setTimeout(()=>{Qe()},300),A.polygons&&A.polygons.length>0&&X(A.polygons,a.value),s.value&&s.value.features&&s.value.features.forEach(w=>{if(w.geometry&&w.geometry.type==="LineString"){const n=w.properties?.color||"#FF6B6B",f=G.geoJSON(w,{style:{color:n,weight:6,opacity:.9,dashArray:"10, 5",lineCap:"round",lineJoin:"round"}}).addTo(a.value);f.on("click",U=>{G.DomEvent.stopPropagation(U),we(U.latlng,null,w.properties?.color)}),F.value.push(f)}}),a.value.on("click",w=>{we(w.latlng)});let v=!1;a.value.on("zoomstart",()=>{ge=!0,a.value._isZooming=!0}),a.value.on("zoomend",()=>{setTimeout(()=>{ge=!1,a.value._isZooming=!1,v&&(v=!1,tt())},100)});const N=tt;window.addEventListener("notesPending",()=>{ge&&(v=!0)}),setTimeout(()=>{m.startTracking(i.value,a.value,ot)},500)})}catch(e){console.error("Error initializing map:",e),u.error("Failed to initialize map. Please refresh the page.")}},Rt=e=>{Je(e),_.value=e.name,H.value=!1,we(G.latLng(e.lat,e.lng),e),console.log(`Routing to ${e.name}`)},dt=()=>{if(_.value="",l.value=null,d.value=null,H.value=!1,re.value=null,Ke.value=!1,de.value=!1,se.value="",Se.value=!1,x.value="",Re(),M.value&&a.value){try{a.value.hasLayer(M.value)&&a.value.removeLayer(M.value)}catch(e){console.warn("Error removing route polyline:",e)}M.value=null}if(T.value&&a.value){try{a.value.hasLayer(T.value)&&a.value.removeLayer(T.value)}catch(e){console.warn("Error removing destination marker:",e)}T.value=null}D.value=null,C.value=!1,console.log("Route cleared")},Gt=async()=>{if(!x.value.trim()){u.error("Please enter your feedback");return}if(!i.value.id){u.error("Guest information not found");return}if(!l.value){u.error("Select a destination before sending feedback");return}W.value=!0;try{const e=await fe.post("/create/feedback",{guest_id:i.value.id,marker_id:l.value.marker_id,message:x.value.trim()}),t={...e.data.feedback,message:x.value.trim(),marker_id:l.value.marker_id,guest:{id:i.value.id,name:i.value.nickname}};be.value=[...be.value,t],L.value=e.data.message,u.success(L.value||"Feedback saved successfully!"),x.value=""}catch(e){console.error("Error saving feedback:",e),u.error("Failed to save feedback")}finally{W.value=!1}},Ot=e=>{q.value=e,Ye.value=!0},pt=()=>{Ye.value=!1},jt=()=>{q.value<We.value.length-1&&q.value++},zt=()=>{q.value>0&&q.value--},Bt=wt();return Jt(()=>{Bt&&(ut(),console.log(`Welcome back, ${i.value.nickname}!`)),window.addEventListener("open-facility-panel",e=>{const t=e.detail,r=xe.value.find(c=>c.id===t);r&&Je(r)}),window.addEventListener("delete-note",e=>{const t=e.detail;confirm("Are you sure you want to delete this note?")&&Xe(t)}),window.Echo.channel("main-channel").listen(".MainEvent",e=>{if(e.type==="route"&&(it(),console.log("Route event:",e.action)),e.type==="facility"&&(ct(),console.log("Facility event:",e.action)),e.type==="marker"&&(ct(),console.log("Marker event:",e.action)),e.type==="polygon"&&(Dt(),console.log("Polygon event:",e.action)),e.type==="photo"&&e.action==="create"&&e.data){const t=e.data?.facility_id;if(t){const r=te.value[t]||[];r.some(y=>y.id===e.data.id)||(te.value={...te.value,[t]:[e.data,...r]})}}e.type==="feedback"&&e.action==="create"&&e.data&&(be.value.some(r=>r.id===e.data.id)||(be.value=[...be.value,e.data]))})}),Ht(()=>{if(m.stopTracking(a.value),ae.value&&clearInterval(ae.value),Re(),a.value)try{M.value&&a.value.hasLayer(M.value)&&a.value.removeLayer(M.value),T.value&&a.value.hasLayer(T.value)&&a.value.removeLayer(T.value),F.value.forEach(e=>{a.value.hasLayer(e)&&a.value.removeLayer(e)}),ue.value.forEach(e=>{e.marker&&a.value.hasLayer(e.marker)&&a.value.removeLayer(e.marker)})}catch(e){console.warn("Error during cleanup:",e)}console.log("Component unmounted, cleanup complete")}),(e,t)=>(g(),p("div",ro,[ye(Yt,{name:"details-panel"},{default:Zt(()=>[k(P)&&de.value&&k(l)?(g(),p("aside",so,[t[22]||(t[22]=o("div",{class:"md:hidden flex justify-center pt-2 pb-1"},[o("div",{class:"w-12 h-1 bg-gray-300 rounded-full"})],-1)),o("div",no,[o("div",lo,[o("div",io,[o("span",co,b(k(l).icon),1),o("h2",uo,b(k(l).name),1)]),o("p",po,b(k(l).department)+" ‚Ä¢ "+b(k(l).category),1)]),o("button",{onClick:Lt,class:"rounded-md p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-700"},[ye(k(Ze),{class:"h-5 w-5"})])]),o("div",go,[o("section",vo,[k(l).description?(g(),p("p",ho,b(k(l).description),1)):B("",!0),o("div",mo,[o("button",{type:"button",onClick:Et,class:"inline-flex flex-1 items-center justify-center gap-2 rounded-lg bg-green-900 px-3 py-2 text-sm font-semibold text-white transition hover:bg-green-800"}," üß≠ Start Navigation "),k(M)?(g(),p("button",{key:0,type:"button",onClick:dt,class:"inline-flex items-center justify-center gap-2 rounded-lg border border-gray-300 px-3 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-100"}," ‚úñ Clear ")):B("",!0)]),k(D)?(g(),p("div",fo,[t[14]||(t[14]=o("div",{class:"border-b border-gray-200 bg-gray-100 px-3 py-2"},[o("h3",{class:"text-xs font-semibold text-gray-800"},"Route Info")],-1)),o("p",yo,b(k(D)),1)])):B("",!0),k(C)&&k($).length?(g(),p("div",bo,[t[15]||(t[15]=o("div",{class:"border-b border-gray-200 bg-gray-100 px-3 py-2"},[o("h3",{class:"text-xs font-semibold text-gray-800"},"Navigation Steps")],-1)),o("div",{class:"max-h-60 overflow-y-auto",ref_key:"navigationInstructionsContainer",ref:ce},[(g(!0),p(he,null,me(k($),(r,c)=>(g(),p("div",{key:c,class:"flex gap-3 px-3 py-3 border-b border-gray-100 last:border-b-0 hover:bg-gray-50"},[o("span",xo,b(r.icon),1),o("div",wo,[o("p",ko,b(r.text),1),o("p",_o,b(r.distance),1)])]))),128))],512)])):B("",!0)]),o("section",So,[o("div",Mo,[t[16]||(t[16]=o("h3",{class:"text-sm font-semibold text-gray-800"},"Photos",-1)),o("span",Lo,b(Ee.value.total)+" total",1)]),o("div",Eo,[o("div",Po,[o("input",{ref_key:"photoInput",ref:Ae,type:"file",accept:"image/*",class:"hidden",onChange:It},null,544),pe.value?(g(),p("div",No,[o("img",{src:pe.value,alt:"Photo preview",class:"mx-auto max-h-40 rounded-md object-cover shadow-sm"},null,8,Io),Oe(o("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>Ie.value=r),type:"text",maxlength:"255",placeholder:"Add a short caption (optional)",class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white"},null,512),[[je,Ie.value]]),o("div",Ao,[o("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 transition",onClick:Re}," Cancel "),o("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:Ue.value,onClick:$t},b(Ue.value?"Uploading...":"Save Photo"),9,$o)])])):(g(),p("div",Co,[t[17]||(t[17]=o("p",{class:"text-sm text-gray-600"},"üì∏ Click to upload a photo",-1)),o("button",{type:"button",class:"inline-flex items-center justify-center rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white transition hover:bg-green-800",onClick:Ft}," Choose Photo ")]))]),Ee.value.total>0?(g(),p("div",Fo,[o("div",To,[(g(!0),p(he,null,me(We.value,(r,c)=>(g(),p("article",{key:r.id,onClick:y=>Ot(c),class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm cursor-pointer transition hover:shadow-md hover:border-gray-300"},[o("img",{src:r.url,alt:r.caption||k(l).name,class:"h-28 w-full object-cover"},null,8,Ro),o("div",Go,[o("p",Oo,b(r.caption||"Shared photo"),1),o("p",jo,b(r.guest?.name||"Guest")+" ‚Ä¢ "+b(Ge(r.created_at)),1)])],8,Do))),128))]),Ee.value.total>2&&!Me.value?(g(),p("button",{key:0,onClick:t[1]||(t[1]=r=>Me.value=!0),class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-100 hover:border-gray-400"}," + "+b(Ee.value.total-2)+" More Photo"+b(Ee.value.total-2>1?"s":""),1)):B("",!0),Me.value&&Ee.value.total>2?(g(),p("button",{key:1,onClick:t[2]||(t[2]=r=>Me.value=!1),class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-100 hover:border-gray-400"}," Show Less ")):B("",!0)])):(g(),p("p",zo,"Be the first to share a photo for this place."))])]),o("section",Bo,[o("div",Uo,[t[18]||(t[18]=o("h3",{class:"text-sm font-semibold text-gray-800"},"Notes",-1)),o("span",Vo,b(De.value.length)+" total",1)]),o("div",Jo,[o("p",null,"üí° You can add one note that will appear on the map. It expires after 24 hours and is stored in your browser ("+b(ze==="localStorage"?"persists across sessions":"session only")+").",1),t[19]||(t[19]=o("p",{class:"font-semibold text-green-700"},"üìç Notes appear as purple bubbles above markers. Click the ‚úï button to delete!",-1))]),Se.value?(g(),p("div",Ho,[Oe(o("textarea",{"onUpdate:modelValue":t[3]||(t[3]=r=>se.value=r),rows:"3",maxlength:"500",placeholder:"Share a quick note or tip about this spot...",class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white",autofocus:"",onKeydown:t[4]||(t[4]=gt(ie(()=>{},["prevent"]),["enter"]))},null,544),[[je,se.value]]),o("div",Zo,[o("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-100 transition",onClick:t[5]||(t[5]=ie(r=>Se.value=!1,["prevent"]))}," Cancel "),o("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:Ve.value||!se.value.trim(),onClick:ie(Nt,["prevent"])},b(Ve.value?"Saving...":"Save Note"),9,Ko)])])):B("",!0),Se.value?B("",!0):(g(),p("div",Yo,[o("button",{type:"button",class:"w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:border-gray-400 hover:bg-gray-100",onClick:ie(At,["prevent"])},b(bt.value?"‚úèÔ∏è Edit Your Note":"+ Add Note"),1)])),De.value.length?(g(),p("div",Wo,[(g(!0),p(he,null,me(De.value,r=>(g(),p("article",{key:r.id,class:Ne(["rounded-lg p-3 shadow-sm transition",r.guest_id===i.value.id?"ml-8 bg-green-100 border-l-4 border-green-700":"mr-8 bg-gray-100 border-l-4 border-gray-400"])},[o("div",qo,[o("div",null,[o("p",Xo,[Kt(b(r.guest?.name||"Guest")+" ",1),r.guest_id===i.value.id?(g(),p("span",Qo," (You)")):B("",!0)]),o("p",ea,b(Ge(r.created_at)),1)]),r.guest_id===i.value.id?(g(),p("button",{key:0,type:"button",class:"rounded-md p-1 text-gray-400 transition hover:bg-gray-200 hover:text-red-500",onClick:ie(c=>Xe(r.id),["prevent"]),title:"Delete note"},[ye(k(Ze),{class:"h-4 w-4"})],8,ta)):B("",!0)]),o("p",oa,b(r.content),1)],2))),128))])):(g(),p("p",aa,"No notes yet. Be the first to share!"))]),o("section",ra,[o("div",sa,[t[20]||(t[20]=o("h3",{class:"text-sm font-semibold text-gray-800"},"Feedback",-1)),o("span",na,b(qe.value.length)+" total",1)]),$e.value?(g(),p("div",la,[Oe(o("textarea",{"onUpdate:modelValue":t[6]||(t[6]=r=>vt(x)?x.value=r:null),rows:"3",maxlength:"500",placeholder:"How was your experience here?",class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white",autofocus:""},null,512),[[je,k(x)]]),o("div",ia,[o("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-100 transition",onClick:t[7]||(t[7]=ie(r=>$e.value=!1,["prevent"]))}," Cancel "),o("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:k(W)||!k(x).trim(),onClick:ie(Gt,["prevent"])},b(k(W)?"Sending...":"Submit Feedback"),9,ca)])])):B("",!0),$e.value?B("",!0):(g(),p("div",ua,[o("button",{type:"button",class:"w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:border-gray-400 hover:bg-gray-100",onClick:t[8]||(t[8]=ie(r=>$e.value=!$e.value,["prevent"]))}," + Add Feedback ")])),qe.value.length?(g(),p("div",da,[t[21]||(t[21]=o("h4",{class:"text-xs font-semibold text-gray-600 uppercase tracking-wide"},"Recent Feedback",-1)),o("div",pa,[(g(!0),p(he,null,me(qe.value,r=>(g(),p("article",{key:r.id,class:"rounded-lg border border-gray-200 bg-gray-50 px-3 py-3 shadow-sm"},[o("div",ga,[o("p",va,b(r.guest?.name||"Guest"),1),o("p",ha,b(Ge(r.created_at)),1)]),o("p",ma,b(r.message),1)]))),128))])])):(g(),p("p",fa,"No feedback yet. Share your thoughts!"))])])])):B("",!0)]),_:1}),o("div",ya,[o("div",{id:"map",class:Ne(["h-full w-full transition-all duration-300",k(P)?"":"blur-sm pointer-events-none"])},null,2),k(P)?(g(),p("div",ba,[o("div",xa,[o("div",wa,[o("div",ka,[ye(k(eo),{class:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400"})]),Oe(o("input",{"onUpdate:modelValue":t[9]||(t[9]=r=>vt(_)?_.value=r:null),type:"text",placeholder:"Search for facilities...",class:"w-full rounded-lg border-0 py-2.5 pl-9 pr-10 text-xs focus:ring-2 focus:ring-green-900 sm:py-3 sm:pl-10 sm:text-sm"},null,512),[[je,k(_)]]),k(_)?(g(),p("button",{key:0,onClick:dt,class:"absolute inset-y-0 right-0 flex items-center pr-3"},[ye(k(Ze),{class:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400 hover:text-gray-600"})])):B("",!0)]),k(H)?(g(),p("div",_a,[k(ee)?(g(),p("div",Sa," Searching... ")):k(S).length===0?(g(),p("div",Ma," No facilities found ")):(g(),p("div",La,[(g(!0),p(he,null,me(k(S),r=>(g(),p("button",{key:r.id,onClick:c=>Rt(r),class:"flex w-full items-center gap-2 px-3 py-2.5 text-left transition hover:bg-gray-50 sm:px-4 sm:py-3"},[o("span",Pa,b(r.icon),1),o("div",Ca,[o("p",Na,b(r.name),1),o("p",Ia,b(r.markerType)+" ‚Ä¢ "+b(r.category),1)])],8,Ea))),128))]))])):B("",!0)])])):B("",!0),k(P)?(g(),p("div",Aa,[o("div",$a,[(g(),p(he,null,me(_e,r=>o("button",{key:r.value,onClick:c=>J.value=r.value,class:Ne(["min-w-[44px] rounded-md px-2.5 py-2 text-xs font-medium transition sm:px-3 sm:text-sm",J.value===r.value?"bg-green-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),title:r.label},[o("span",Ta,b(r.icon),1),o("span",Da,b(r.label),1)],10,Fa)),64))])])):B("",!0),k(P)?(g(),p("div",Ra,[o("div",Ga,[ye(k(to),{class:"h-5 w-5 text-green-900"}),o("div",Oa,[o("p",ja,b(i.value.nickname),1),o("p",za,b(i.value.role),1)])])])):B("",!0),k(P)&&k(D)&&!de.value?(g(),p("div",Ba,[o("div",Ua,[t[23]||(t[23]=o("h3",{class:"text-xs font-semibold text-white"},"Route Info",-1)),o("button",{onClick:t[10]||(t[10]=r=>D.value=null),class:"flex h-5 w-5 items-center justify-center rounded text-gray-400 transition hover:text-white"}," √ó ")]),o("p",Va,b(k(D)),1)])):B("",!0),k(C)&&!de.value?(g(),p("div",Ja,[o("div",Ha,[t[24]||(t[24]=o("h3",{class:"text-xs font-semibold text-white"},"Navigation",-1)),o("button",{onClick:t[11]||(t[11]=r=>C.value=!1),class:"flex h-5 w-5 items-center justify-center rounded text-gray-400 transition hover:text-white"}," √ó ")]),o("div",{ref_key:"navigationInstructionsContainer",ref:ce,class:"overflow-y-auto"},[(g(!0),p(he,null,me(k($),(r,c)=>(g(),p("div",{key:c,class:"flex items-start gap-2 border-b border-gray-100 px-3 py-2 text-xs last:border-b-0"},[o("span",Za,b(r.icon),1),o("div",Ka,[o("p",Ya,b(r.text),1),o("p",Wa,b(r.distance),1)])]))),128))],512)])):B("",!0)]),k(j)?(g(),p("div",qa,[o("div",Xa,[k(h)===1?(g(),p("div",Qa,[t[25]||(t[25]=Wt('<div class="mb-6 text-center sm:mb-8" data-v-22549670><div class="flex items-center justify-center gap-3 mb-4" data-v-22549670><div class="h-12 w-12 bg-green-900 rounded-full flex items-center justify-center p-1.5 shadow-md" data-v-22549670><img src="'+qt+'" alt="ASSCAT Logo" class="h-full w-full object-contain" data-v-22549670></div><div class="flex flex-col items-start" data-v-22549670><span class="text-lg font-bold text-green-900" data-v-22549670>ASSCAT</span><span class="text-xs font-medium text-gray-600" data-v-22549670>Campus Navigator</span></div></div><h2 class="mb-2 text-xl font-bold text-gray-900 sm:text-2xl" data-v-22549670>Welcome to ASSCAT Campus Navigator</h2><p class="text-xs text-gray-500 sm:text-sm" data-v-22549670>Let&#39;s get started with your nickname</p></div>',1)),o("div",er,[Oe(o("input",{"onUpdate:modelValue":t[12]||(t[12]=r=>i.value.nickname=r),type:"text",placeholder:"Enter your nickname",maxlength:"50",class:"w-full rounded-lg border border-gray-300 px-4 py-3 text-sm text-gray-900 focus:border-green-900 focus:outline-none focus:ring-1 focus:ring-green-900 sm:text-base",onKeyup:gt(lt,["enter"])},null,544),[[je,i.value.nickname]]),o("button",{onClick:lt,disabled:!i.value.nickname.trim(),class:Ne(["w-full rounded-lg px-4 py-3 text-sm font-medium transition",i.value.nickname.trim()?"bg-green-900 text-white hover:bg-green-800":"cursor-not-allowed bg-gray-200 text-gray-400"])}," Continue ",10,tr)])])):k(h)===2?(g(),p("div",or,[t[26]||(t[26]=o("div",{class:"mb-6 text-center sm:mb-8"},[o("h2",{class:"mb-2 text-xl font-bold text-gray-900 sm:text-2xl"},"Select Your Role"),o("p",{class:"text-xs text-gray-500 sm:text-sm"},"How are you visiting our campus?")],-1)),o("div",ar,[(g(),p(he,null,me(ft,r=>o("button",{key:r.value,onClick:c=>i.value.role=r.value,class:Ne(["flex w-full items-center gap-3 rounded-lg border-2 px-4 py-3 transition",i.value.role===r.value?"border-green-700 bg-green-50":"border-gray-200 hover:border-gray-300"])},[o("span",sr,b(r.icon),1),o("span",nr,b(r.label),1)],10,rr)),64))]),o("div",lr,[o("button",{onClick:_t,disabled:!i.value.role,class:Ne(["w-full rounded-lg px-4 py-3 text-sm font-medium transition",i.value.role?"bg-green-900 text-white hover:bg-green-800":"cursor-not-allowed bg-gray-200 text-gray-400"])}," Start Exploring ",10,ir),o("button",{onClick:kt,class:"w-full rounded-lg px-4 py-3 text-sm font-medium text-gray-600 transition hover:text-gray-900"}," Back ")])])):B("",!0)])])):B("",!0),Ye.value?(g(),p("div",{key:1,onClick:pt,class:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 p-4"},[o("div",{onClick:t[13]||(t[13]=ie(()=>{},["stop"])),class:"relative w-full max-w-5xl"},[o("button",{onClick:pt,class:"absolute -top-12 right-0 text-white hover:text-gray-300 transition"},[ye(k(Ze),{class:"h-8 w-8"})]),o("div",cr,[ne.value[q.value]?(g(),p("img",{key:0,src:ne.value[q.value].url,alt:ne.value[q.value].caption||"Photo",class:"w-full max-h-[80vh] object-contain bg-gray-100"},null,8,ur)):B("",!0),o("div",dr,[ne.value[q.value]?.caption?(g(),p("p",pr,b(ne.value[q.value].caption),1)):B("",!0),o("p",gr,b(ne.value[q.value]?.guest?.name||"Guest")+" ‚Ä¢ "+b(Ge(ne.value[q.value]?.created_at)),1),o("p",vr," Photo "+b(q.value+1)+" of "+b(ne.value.length),1)]),q.value>0?(g(),p("button",{key:1,onClick:zt,class:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition"},[...t[27]||(t[27]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})],-1)])])):B("",!0),q.value<ne.value.length-1?(g(),p("button",{key:2,onClick:jt,class:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition"},[...t[28]||(t[28]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-6 h-6"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1)])])):B("",!0)])])])):B("",!0)]))}},mr=Xt(hr,[["__scopeId","data-v-22549670"]]),fr={class:"w-full h-screen overflow-hidden"},Lr={__name:"Index",props:{facilities:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},polygons:{type:Array,default:()=>[]}},setup(V){return(A,u)=>(g(),p("div",null,[o("div",fr,[ye(mr,{facilities:V.facilities,notes:V.notes,polygons:V.polygons},null,8,["facilities","notes","polygons"])])]))}};export{Lr as default};
