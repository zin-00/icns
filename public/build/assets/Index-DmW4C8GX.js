import{c as m,o as f,a,u as ft,r as D,L as R,H as Jt,G as Ce,b as ce,D as Ht,E as Zt,e as be,g as U,w as Kt,h as _,t as x,F as fe,j as he,f as je,v as Oe,I as vt,k as ue,n as $e,l as Yt,J as mt,T as Wt,q as qt,p as ye}from"./app-DVResgUD.js";import{_ as Xt}from"./logo-C5fiQHXv.js";import{_ as Qt,u as eo}from"./_plugin-vue_export-helper-D6tXFltF.js";import{r as Ze}from"./XMarkIcon-fdPOovce.js";import{r as to}from"./MagnifyingGlassIcon-DfZOrS8f.js";/* empty css            */function oo(J,N){return f(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function ht(){const J=(n,y,u,w)=>{const E=n*Math.PI/180,i=u*Math.PI/180,A=(u-n)*Math.PI/180,I=(w-y)*Math.PI/180,L=Math.sin(A/2)*Math.sin(A/2)+Math.cos(E)*Math.cos(i)*Math.sin(I/2)*Math.sin(I/2);return 6371e3*(2*Math.atan2(Math.sqrt(L),Math.sqrt(1-L)))},N=(n,y,u,w)=>{const M=n*Math.PI/180,E=u*Math.PI/180,i=(w-y)*Math.PI/180,A=Math.sin(i)*Math.cos(E),I=Math.cos(M)*Math.sin(E)-Math.sin(M)*Math.cos(E)*Math.cos(i);return(Math.atan2(A,I)*180/Math.PI+360)%360},p=n=>{const y=[{min:0,max:22.5,text:"north",icon:"‚¨ÜÔ∏è"},{min:22.5,max:67.5,text:"northeast",icon:"‚ÜóÔ∏è"},{min:67.5,max:112.5,text:"east",icon:"‚û°Ô∏è"},{min:112.5,max:157.5,text:"southeast",icon:"‚ÜòÔ∏è"},{min:157.5,max:202.5,text:"south",icon:"‚¨áÔ∏è"},{min:202.5,max:247.5,text:"southwest",icon:"‚ÜôÔ∏è"},{min:247.5,max:292.5,text:"west",icon:"‚¨ÖÔ∏è"},{min:292.5,max:337.5,text:"northwest",icon:"‚ÜñÔ∏è"},{min:337.5,max:360,text:"north",icon:"‚¨ÜÔ∏è"}];for(const u of y)if(n>=u.min&&n<u.max)return u;return y[0]},V=(n,y,u)=>{const w=N(n.lat,n.lng,y.lat,y.lng);let E=N(y.lat,y.lng,u.lat,u.lng)-w;return E>180&&(E-=360),E<-180&&(E+=360),E},te=n=>Math.abs(n)<20?{text:"Continue straight",icon:"‚¨ÜÔ∏è"}:n>20&&n<70?{text:"Turn slight right",icon:"‚ÜóÔ∏è"}:n>=70&&n<120?{text:"Turn right",icon:"‚û°Ô∏è"}:n>=120?{text:"Turn sharp right",icon:"‚Ü™Ô∏è"}:n<-20&&n>-70?{text:"Turn slight left",icon:"‚ÜñÔ∏è"}:n<=-70&&n>-120?{text:"Turn left",icon:"‚¨ÖÔ∏è"}:n<=-120?{text:"Turn sharp left",icon:"‚Ü©Ô∏è"}:{text:"Continue",icon:"‚¨ÜÔ∏è"},Z=(n,y)=>{let u=0,w=1/0;return y.forEach((M,E)=>{const i=J(n.lat,n.lng,M[1],M[0]);i<w&&(w=i,u=E)}),{index:u,coord:y[u],distance:w}},j=(n,y,u=30)=>{let w=null,M=null,E=1/0;return y.forEach(i=>{if(i.geometry.type==="LineString"){const A=i.geometry.coordinates,I=Z(n,A);I.distance<E&&(E=I.distance,w=i,M=I)}}),E<=u?{feature:w,point:M}:null},C=async(n,y,u)=>{try{const M=`https://router.project-osrm.org/route/v1/${u==="driving"?"driving":u==="riding"?"cycling":"walking"}/${n.lng},${n.lat};${y.lng},${y.lat}?overview=full&geometries=geojson`,i=await(await fetch(M)).json();if(i.code==="Ok"&&i.routes.length>0)return i.routes[0].geometry.coordinates.map(([I,L])=>({lat:L,lng:I}))}catch(w){console.error("OSRM routing error:",w)}return null},$=n=>{const y=new Map,u=new Map,w=(M,E)=>{const i=`${M.toFixed(6)},${E.toFixed(6)}`;if(!u.has(i)){const A=`node_${u.size}`;u.set(i,A),y.set(A,{id:A,lat:M,lng:E,neighbors:[]})}return u.get(i)};return n.forEach(M=>{if(M.geometry.type!=="LineString")return;const E=M.geometry.coordinates;let i=null;E.forEach(([A,I])=>{const L=w(I,A),b=y.get(L);if(i){const K=y.get(i),Q=J(K.lat,K.lng,I,A);b.neighbors.some(re=>re.id===i)||b.neighbors.push({id:i,cost:Q}),K.neighbors.some(re=>re.id===L)||K.neighbors.push({id:L,cost:Q})}i=L})}),console.log(`Built graph with ${y.size} nodes`),y},q=(n,y,u=100)=>{let w=null,M=1/0;for(const[E,i]of y.entries()){const A=J(n.lat,n.lng,i.lat,i.lng);A<M&&A<=u&&(M=A,w=E)}return w},r=(n,y,u)=>{if(!u.has(n)||!u.has(y))return console.warn("Start or goal node not in graph"),null;if(n===y){const Y=u.get(n);return[{lat:Y.lat,lng:Y.lng}]}const w=new Set,M=new Map,E=new Map,i=new Map;class A{constructor(){this.heap=[]}push(O,c){this.heap.push({item:O,priority:c}),this.bubbleUp(this.heap.length-1)}pop(){if(this.heap.length===0)return null;const O=this.heap[0].item,c=this.heap.pop();return this.heap.length>0&&(this.heap[0]=c,this.bubbleDown(0)),O}bubbleUp(O){for(;O>0;){const c=Math.floor((O-1)/2);if(this.heap[O].priority>=this.heap[c].priority)break;[this.heap[O],this.heap[c]]=[this.heap[c],this.heap[O]],O=c}}bubbleDown(O){for(;;){let c=O;const ne=2*O+1,H=2*O+2;if(ne<this.heap.length&&this.heap[ne].priority<this.heap[c].priority&&(c=ne),H<this.heap.length&&this.heap[H].priority<this.heap[c].priority&&(c=H),c===O)break;[this.heap[O],this.heap[c]]=[this.heap[c],this.heap[O]],O=c}}isEmpty(){return this.heap.length===0}}const I=new A;E.set(n,0);const L=u.get(n),b=u.get(y),K=(Y,O)=>J(Y.lat,Y.lng,O.lat,O.lng)*.95;i.set(n,K(L,b)),I.push(n,i.get(n));let Q=0;const re=u.size*2;for(;!I.isEmpty()&&Q<re;){Q++;const Y=I.pop();if(Y===y)return console.log(`‚úÖ Path found in ${Q} iterations`),S(M,Y,u);if(w.has(Y))continue;w.add(Y);const O=u.get(Y);if(!O)continue;const c=E.get(Y)||1/0;for(const ne of O.neighbors){const H=ne.id;if(w.has(H))continue;const se=u.get(H);if(!se)continue;const de=c+ne.cost;if(!E.has(H)||de<E.get(H)){M.set(H,Y),E.set(H,de);const Se=de+K(se,b);i.set(H,Se),I.push(H,Se)}}}return console.warn(`‚ö†Ô∏è No path found after ${Q} iterations`),null},S=(n,y,u)=>{const w=[];let M=y;for(;M;){const E=u.get(M);w.unshift({lat:E.lat,lng:E.lng}),M=n.get(M)}return w};return{calculateDistance:J,calculateBearing:N,getDirection:p,calculateTurnAngle:V,getTurnInstruction:te,getNearestPointOnLine:Z,findClickedLineString:j,getPublicRoute:C,buildCampusGraph:$,findNearestNode:q,findPathAStar:r,calculateRouteDistance:n=>{let y=0;for(let u=0;u<n.length-1;u++)y+=J(n[u].lat,n[u].lng,n[u+1].lat,n[u+1].lng);return y},findCampusEntrances:n=>{const y=[];for(const[u,w]of n.entries())y.push({id:u,lat:w.lat,lng:w.lng,node:w});return y},generateEnhancedInstructions:(n,y)=>{if(!n||n.length<2)return[{icon:"üìç",text:"You are at your destination",distance:"0 m"}];const u=[];let w=0;const M=7,E=N(n[0].lat,n[0].lng,n[1].lat,n[1].lng),i=p(E);u.push({icon:"üö∂",text:`Start heading ${i.text}`,distance:"0 m",bearing:E.toFixed(0)+"¬∞"});let A=0;for(let b=0;b<n.length-1;b++)A+=J(n[b].lat,n[b].lng,n[b+1].lat,n[b+1].lng);const I=[];w=0;for(let b=1;b<n.length-1;b++){const K=J(n[b-1].lat,n[b-1].lng,n[b].lat,n[b].lng);w+=K;const Q=V(n[b-1],n[b],n[b+1]);if(Math.abs(Q)>20){const re=N(n[b].lat,n[b].lng,n[b+1].lat,n[b+1].lng);I.push({index:b,angle:Q,distance:w,bearing:re})}}if(y&&A>100){const b=A/2;u.push({icon:"üè´",text:"Enter campus grounds",distance:`${Math.round(b)} m`})}const L=M-2-(y?1:0);return I.length>L&&(I.sort((b,K)=>Math.abs(K.angle)-Math.abs(b.angle)),I.splice(L),I.sort((b,K)=>b.distance-K.distance)),I.forEach(b=>{const K=te(b.angle);u.push({icon:K.icon,text:K.text,distance:`${Math.round(b.distance)} m`,bearing:b.bearing.toFixed(0)+"¬∞"})}),u.push({icon:"üéØ",text:"You have arrived at your destination",distance:`${Math.round(A)} m`}),u.length>M?[u[0],...u.slice(-Math.min(5,M-2)),u[u.length-1]].slice(0,M):u}}}function ao(){const J=ft(),{calculateDistance:N}=ht(),p=D(null),V=D(null),te=D(null),Z=D(null),j=(r,S)=>{if(!(!S||!r||!r.accuracy))try{Z.value&&S.hasLayer&&S.hasLayer(Z.value)&&(S.removeLayer(Z.value),Z.value=null),r.accuracy<100&&(Z.value=R.circle([r.lat,r.lng],{radius:r.accuracy,color:"#3388ff",fillColor:"#3388ff",fillOpacity:.1,weight:1,opacity:.5}).addTo(S),Z.value.bindTooltip(`GPS Accuracy: ${Math.round(r.accuracy)}m`,{permanent:!1,direction:"top",offset:[0,-10]}))}catch(T){console.warn("Error updating accuracy circle:",T)}},C=(r,S,T)=>{if(!p.value||!S){console.warn("Cannot update user marker: missing location or map");return}try{if(V.value&&typeof V.value.setLatLng=="function"&&S.hasLayer&&S.hasLayer(V.value)){V.value.setLatLng([p.value.lat,p.value.lng]);const P=`
          <div style="font-size: 13px; color: #1f2937; font-weight: 500;">
            ${r.nickname||"You"}
            ${p.value.accuracy?`<br><small style="color: #6b7280;">Accuracy: ${Math.round(p.value.accuracy)}m</small>`:""}
          </div>
        `;V.value.setPopupContent(P)}else{console.log("Creating new user marker..."),V.value=R.marker([p.value.lat,p.value.lng],{title:r.nickname||"You",draggable:!0,autoPan:!0,zIndexOffset:1e3,icon:R.divIcon({className:"user-location-marker",html:`
              <div style="
                background: #3388ff;
                border: 3px solid white;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                animation: pulse 2s infinite;
              "></div>
            `,iconSize:[20,20],iconAnchor:[10,10]})}).addTo(S),V.value.on("dragend",F=>{const y=F.target.getLatLng();p.value={lat:parseFloat(y.lat.toFixed(8)),lng:parseFloat(y.lng.toFixed(8)),accuracy:p.value?.accuracy||10,isManual:!0},console.log("Marker dragged to:",p.value),j(p.value,S),T&&T(p.value),J.info("Location updated manually")});const P=`
          <div style="font-size: 13px; color: #1f2937; font-weight: 500;">
            ${r.nickname||"You"}
            ${p.value.accuracy?`<br><small style="color: #6b7280;">Accuracy: ${Math.round(p.value.accuracy)}m</small>`:""}
            ${p.value.isManual?'<br><small style="color: #f59e0b;">üìç Manually placed</small>':""}
          </div>
        `;V.value.bindPopup(P,{offset:[0,-12],closeButton:!1,autoPan:!1,className:"user-popup"}),r.nickname&&setTimeout(()=>{V.value&&!V.value.isPopupOpen()&&(V.value.openPopup(),setTimeout(()=>V.value.closePopup(),3e3))},1e3)}}catch(P){console.error("Error updating user marker:",P),V.value=null}},$=(r,S,T)=>{if(!navigator.geolocation){console.error("Geolocation not supported"),J.error("Geolocation is not supported by your browser");return}if(!S){console.warn("Cannot start tracking: map not initialized");return}console.log("Starting GPS tracking with real-time updates..."),te.value=navigator.geolocation.watchPosition(P=>{if(!S){console.warn("Map destroyed during GPS update, stopping tracking"),q(S);return}const F={lat:parseFloat(P.coords.latitude.toFixed(8)),lng:parseFloat(P.coords.longitude.toFixed(8)),accuracy:P.coords.accuracy,heading:P.coords.heading,speed:P.coords.speed};if(console.log("GPS Update:",{position:`${F.lat.toFixed(8)}, ${F.lng.toFixed(8)}`,accuracy:`${Math.round(F.accuracy)}m`,heading:F.heading,speed:F.speed}),p.value){const n=N(p.value.lat,p.value.lng,F.lat,F.lng),y=F.accuracy<p.value.accuracy*.7;(n>2||y)&&(p.value=F,C(r,S,T),j(F,S),T&&T(F))}else p.value=F,C(r,S,T),j(F,S),J.success(`GPS acquired! Accuracy: ${Math.round(F.accuracy)}m`)},P=>{console.error("Geolocation watch error:",P);let F="GPS signal lost";switch(P.code){case P.PERMISSION_DENIED:F="GPS permission denied. Please enable location services.";break;case P.POSITION_UNAVAILABLE:F="GPS position unavailable. Check your location settings.";break;case P.TIMEOUT:F="GPS timeout. Trying to reconnect...",setTimeout(()=>$(r,S,T),2e3);break}console.warn(F),p.value||(p.value={lat:8.169,lng:126.003},C(r,S,T))},{enableHighAccuracy:!0,timeout:5e3,maximumAge:2e3})},q=r=>{if(te.value!==null&&(navigator.geolocation.clearWatch(te.value),te.value=null,console.log("GPS tracking stopped")),Z.value&&r&&r.hasLayer&&r.hasLayer(Z.value)){try{r.removeLayer(Z.value)}catch(S){console.warn("Error removing accuracy circle:",S)}Z.value=null}if(V.value&&r&&r.hasLayer&&r.hasLayer(V.value)){try{r.removeLayer(V.value)}catch(S){console.warn("Error removing user marker:",S)}V.value=null}};return{userLocation:p,userMarker:V,watchId:te,accuracyCircle:Z,startTracking:$,stopTracking:q,updateUserMarker:C,updateAccuracyCircle:j}}function ro(){const J=D([]),N=D([]);return{facilityMarkers:J,polygonLayers:N,markerTypeIcons:{academic:"üéì",library:"üìö",laboratory:"üî¨",office:"üíº",cafeteria:"üçΩÔ∏è",sports:"üèÉ",dormitory:"üõèÔ∏è",parking:"üöó",medical:"‚öïÔ∏è",building:"üèõÔ∏è",classroom:"‚úèÔ∏è",administration:"üìã",auditorium:"üé≠",gymnasium:"üèÄ",theater:"üé¨",studio:"üé®",workshop:"üîß",conference:"üë•",entrance:"üö™",exit:"üö∂",restroom:"üöª",garden:"üå≥",plaza:"üèûÔ∏è",fountain:"‚õ≤",statue:"üóø",gate:"üöß",security:"üîí",it:"üíª",maintenance:"üõ†Ô∏è",storage:"üì¶",default:"üìå"},addFacilityMarker:(j,C)=>{if(!C||!C.addLayer){console.warn("Cannot add marker: map not ready");return}try{const $=R.marker([j.lat,j.lng],{title:j.name,icon:R.divIcon({className:"facility-marker",html:`
            <div style="
              background: white;
              border: 1px solid #3B82F6;
              border-radius: 50%;
              width: 20px;
              height: 20px;
              display: flex;
              align-items: center;
              justify-content: center;
              box-shadow: 0 2px 8px rgba(0,0,0,0.3);
              font-size: 16px;
            ">
              ${j.icon}
            </div>
          `,iconSize:[40,40],iconAnchor:[20,20]})}).addTo(C);return J.value.push($),$}catch($){return console.error("Error adding facility marker:",$),null}},displayPolygons:(j,C)=>{if(!C||!j||!Array.isArray(j)){console.warn("Cannot display polygons: map or data not ready");return}N.value.forEach($=>{if(C&&C.hasLayer&&C.hasLayer($))try{C.removeLayer($)}catch(q){console.warn("Error removing polygon layer:",q)}}),N.value=[],j.forEach($=>{if(!$.coordinates||!Array.isArray($.coordinates)){console.warn("Invalid polygon coordinates:",$);return}try{const q=$.coordinates.map(S=>[S.lat,S.lng]),r=R.polygon(q,{color:$.color||"#3B82F6",fillColor:$.fill_color||"#3B82F6",fillOpacity:$.fill_opacity||.3,weight:3,opacity:.9,lineCap:"round",lineJoin:"round"});$.name&&r.bindTooltip($.name,{permanent:!1,direction:"center",className:"polygon-tooltip",opacity:.9}),r.on("mouseover",function(S){S.target.setStyle({fillOpacity:.5,weight:4})}),r.on("mouseout",function(S){S.target.setStyle({fillOpacity:$.fill_opacity||.3,weight:3})}),C&&C.addLayer&&(r.addTo(C),N.value.push(r))}catch(q){console.error("Error creating polygon:",$,q)}}),console.log(`Displayed ${N.value.length} polygons on map`)},cleanup:j=>{j&&(J.value.forEach(C=>{if(j.hasLayer&&j.hasLayer(C))try{j.removeLayer(C)}catch($){console.warn("Error removing facility marker:",$)}}),J.value=[],N.value.forEach(C=>{if(j.hasLayer&&j.hasLayer(C))try{j.removeLayer(C)}catch($){console.warn("Error removing polygon layer:",$)}}),N.value=[])}}}const no={class:"relative flex h-screen w-full"},so={key:0,class:"z-20 flex flex-col border-gray-200 bg-white shadow-xl fixed bottom-0 left-0 right-0 max-h-[85vh] rounded-t-2xl md:relative md:h-full md:w-full md:max-w-md md:border-r md:rounded-none md:max-h-full"},lo={class:"flex items-center justify-between border-b border-gray-200 bg-white px-4 py-3"},io={class:"min-w-0 pr-3"},co={class:"flex items-center gap-2"},uo={class:"text-xl"},po={class:"truncate text-base font-semibold text-gray-900"},go={class:"mt-1 text-xs text-gray-500"},vo={class:"flex-1 overflow-y-auto bg-gray-50"},mo={class:"space-y-4 px-4 py-4 bg-white"},fo={key:0,class:"text-sm leading-relaxed text-gray-600"},ho={class:"flex flex-wrap gap-2"},yo={key:1,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},bo={class:"whitespace-pre-line px-3 py-3 text-sm text-gray-700"},xo={key:2,class:"rounded-lg border border-gray-200 bg-white shadow-sm"},wo={class:"mt-0.5 text-lg"},ko={class:"flex-1"},_o={class:"text-sm font-medium text-gray-800"},So={class:"text-xs text-gray-500"},Eo={class:"border-t border-gray-200 px-4 py-4 bg-white"},Po={class:"mb-3 flex items-center justify-between"},Mo={class:"text-xs text-gray-500"},Lo={class:"space-y-3"},Co={class:"rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 p-4 text-center hover:border-gray-400 transition"},$o={key:0,class:"space-y-2"},No={key:1,class:"space-y-3"},Io=["src"],Ao={class:"flex justify-end gap-2"},To=["disabled"],Fo={key:0,class:"space-y-3"},Do={class:"grid grid-cols-2 gap-3"},Ro=["onClick"],Go=["src","alt"],zo={class:"space-y-1 px-3 py-2 bg-gray-50"},jo={class:"text-xs font-medium text-gray-900 truncate"},Oo={class:"text-[11px] text-gray-500"},Bo={key:1,class:"text-center text-sm text-gray-500"},Uo={class:"border-t border-gray-200 px-4 py-4 space-y-3 bg-white"},Vo={class:"flex items-center justify-between"},Jo={class:"text-xs text-gray-500"},Ho={class:"text-xs text-gray-500 bg-green-50 border border-green-200 rounded-lg px-3 py-2 space-y-1"},Zo={key:0,class:"space-y-2 rounded-lg border border-gray-300 bg-gray-50 p-3 shadow-sm"},Ko={class:"flex justify-end gap-2"},Yo=["disabled"],Wo={key:1},qo={key:2,class:"space-y-3"},Xo={class:"flex items-start justify-between gap-3"},Qo={class:"text-xs font-semibold text-gray-700"},ea={key:0,class:"text-green-700"},ta={class:"text-xs text-gray-500"},oa=["onClick"],aa={class:"mt-2 text-sm text-gray-800 leading-relaxed"},ra={key:3,class:"text-center text-sm text-gray-500"},na={class:"border-t border-gray-200 px-4 py-4 space-y-3 bg-white"},sa={class:"flex items-center justify-between"},la={class:"text-xs text-gray-500"},ia={key:0,class:"space-y-2 rounded-lg border border-gray-300 bg-gray-50 p-3 shadow-sm"},ca={class:"flex justify-end gap-2"},ua=["disabled"],da={key:1},pa={key:2,class:"space-y-2"},ga={class:"max-h-60 overflow-y-auto space-y-3 pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"},va={class:"flex items-center justify-between"},ma={class:"text-sm font-semibold text-gray-800"},fa={class:"text-xs text-gray-500"},ha={class:"mt-2 text-sm text-gray-700"},ya={key:3,class:"text-sm text-gray-500 text-center"},ba={class:"relative flex-1"},xa={key:0,class:"absolute top-4 left-4 right-4 sm:left-1/2 sm:right-auto sm:-translate-x-1/2 sm:transform z-10 sm:w-full sm:max-w-md sm:px-4"},wa={class:"bg-white rounded-lg shadow-lg"},ka={class:"relative"},_a={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},Sa={key:0,class:"mt-1 max-h-48 overflow-y-auto border-t border-gray-200 sm:max-h-60"},Ea={key:0,class:"p-3 text-center text-xs text-gray-500 sm:p-4 sm:text-sm"},Pa={key:1,class:"p-3 text-center text-xs text-gray-500 sm:p-4 sm:text-sm"},Ma={key:2},La=["onClick"],Ca={class:"text-lg sm:text-xl"},$a={class:"min-w-0 flex-1"},Na={class:"truncate text-xs font-medium text-gray-900 sm:text-sm"},Ia={class:"truncate text-[11px] text-gray-500"},Aa={key:1,class:"absolute bottom-4 left-4 z-10"},Ta={class:"flex max-w-[calc(100vw-6rem)] flex-wrap gap-1 rounded-lg bg-white p-1.5 shadow-lg sm:max-w-none sm:p-2"},Fa=["onClick","title"],Da={class:"text-base sm:text-lg"},Ra={class:"hidden text-xs lg:inline"},Ga={key:2,class:"absolute top-4 right-4 z-10"},za={class:"flex items-center gap-2 rounded-lg bg-white px-3 py-2 shadow-lg sm:px-4"},ja={class:"hidden text-left sm:block"},Oa={class:"max-w-[120px] truncate text-xs font-semibold text-gray-900"},Ba={class:"text-xs text-gray-500"},Ua={key:3,class:"absolute left-4 top-20 hidden w-64 rounded-lg border border-gray-200 bg-white shadow-lg sm:block sm:w-72"},Va={class:"flex items-center justify-between border-b border-gray-200 bg-green-900 px-3 py-2"},Ja={class:"max-h-40 overflow-y-auto px-3 py-2 text-xs leading-relaxed text-gray-700"},Ha={key:4,class:"absolute bottom-20 left-4 right-4 z-20 flex max-h-52 flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-lg sm:bottom-4 sm:left-auto sm:w-72"},Za={class:"flex items-center justify-between border-b border-gray-200 bg-green-900 px-3 py-2"},Ka={class:"mt-0.5 text-sm"},Ya={class:"min-w-0 flex-1"},Wa={class:"font-medium text-gray-900"},qa={class:"text-gray-500"},Xa={key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/60 p-4"},Qa={class:"relative w-full max-w-sm rounded-lg bg-white shadow-2xl"},er={key:0,class:"p-6 sm:p-8"},tr={class:"space-y-4"},or=["disabled"],ar={key:1,class:"p-6 sm:p-8"},rr={class:"mb-6 space-y-3"},nr=["onClick"],sr={class:"text-xl sm:text-2xl"},lr={class:"text-sm font-medium text-gray-900"},ir={class:"space-y-2"},cr=["disabled"],ur={class:"relative bg-white rounded-lg overflow-hidden shadow-2xl"},dr=["src","alt"],pr={class:"bg-gray-50 px-6 py-4 border-t border-gray-200"},gr={key:0,class:"text-sm font-medium text-gray-900 mb-1"},vr={class:"text-xs text-gray-600"},mr={class:"text-xs text-gray-500 mt-1"},Be="localStorage",fr={__name:"GuestMapV2",props:{facilities:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},polygons:{type:Array,default:()=>[]}},setup(J){const N=J,p=ft(),V=eo(),{isSearching:te,showSearchResults:Z,showGuestModal:j,isGuestInfoComplete:C,showInstructions:$,isSavingFeedback:q,map:r,searchQuery:S,destinationMarker:T,routePolyline:P,routeInfo:F,privateRoutes:n,guestStep:y,selectedMarker:u,feedback:w,message:M,filteredLocations:E,selectedLocation:i,geoJsonLayers:A,navigationInstructions:I}=Jt(V),L=ht(),b=ao(),{addFacilityMarker:K,displayPolygons:Q,markerTypeIcons:re,facilityMarkers:Y,polygonLayers:O}=ro(),c=D({id:null,nickname:"",role:""}),ne=D(null),H=D("walking"),se=D(null),de=D(null),Se=[{value:"walking",label:"Walking",icon:"üö∂",speed:5},{value:"riding",label:"Riding",icon:"üö¥",speed:15},{value:"driving",label:"Driving",icon:"üöó",speed:40}],pe=D([]),yt=[{value:"student",label:"Student",icon:"üéì"},{value:"faculty",label:"Faculty",icon:"üë®‚Äçüè´"},{value:"visitor",label:"Visitor",icon:"üë§"}],ee=D([]),xe=D([]),oe=D({}),ge=D(!1),Ke=D(!1),Ue=D(null),ve=D(null),Ne=D(""),Ve=D(!1),le=D(""),Je=D(!1),Ie=D(null),Ee=D(!1),Ae=D(!1),Ye=D(!1),X=D(0),Pe=D(!1),Te=D("navigation"),at=()=>{const e=[];Array.isArray(N.facilities)&&N.facilities.forEach(t=>{const o=t?.marker?.feedbacks;Array.isArray(o)&&o.forEach(s=>{s&&e.push(s)})}),xe.value=e},rt=()=>{const e={};Array.isArray(N.facilities)&&N.facilities.forEach(t=>{!t||!t.id||(e[t.id]=Array.isArray(t.photos)?[...t.photos]:[])}),oe.value=e};at(),rt();const bt=async e=>{if(e)try{const t=await ye.get(`/facilities/${e}/photos`);oe.value={...oe.value,[e]:Array.isArray(t.data?.photos)?t.data.photos:[]}}catch(t){console.error("Error fetching facility photos:",t)}};Ce(()=>N.notes,e=>{ee.value=Array.isArray(e)?[...e]:[]},{deep:!0}),Ce(()=>N.facilities,()=>{at(),rt()},{deep:!0});const Me=ce(()=>i.value?.id??null),Fe=ce(()=>i.value?.marker_id??i.value?.marker?.id??null),We=ce(()=>{if(!Me.value)return[];const e=oe.value[Me.value]||[];return!Pe.value&&e.length>2?e.slice(0,2):e}),ie=ce(()=>Me.value?oe.value[Me.value]||[]:[]),Le=ce(()=>{if(!Me.value)return{displayed:0,total:0};const e=oe.value[Me.value]||[];return{displayed:We.value.length,total:e.length}}),De=ce(()=>Fe.value?ee.value.filter(e=>e.marker_id===Fe.value):[]),qe=ce(()=>Fe.value?xe.value.filter(e=>e.marker_id===Fe.value):[]),xt=ce(()=>!Fe.value||!c.value.id?!1:De.value.some(e=>e.guest_id===c.value.id)),wt=((e,t)=>{let o;return(...s)=>{clearTimeout(o),o=setTimeout(()=>e(...s),t)}})(async e=>{if(!(!e.trim()||!c.value.id))try{await ye.post("/search-logs",{guest_id:c.value.id,query:e.trim(),search_at:new Date().toISOString()}),console.log("‚úÖ Search logged successfully")}catch(t){console.error("Failed to log search:",t)}},500);Ce(I,()=>{de.value&&(de.value.scrollTop=0)},{deep:!0}),Ce(S,e=>{e.length>0&&wt(e),e.length>0?(te.value=!0,E.value=ae.value.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.department.toLowerCase().includes(e.toLowerCase())||t.category&&t.category.toLowerCase().includes(e.toLowerCase())),Z.value=!0):(Z.value=!1,E.value=[]),te.value=!1});const nt=()=>{ne.value=setInterval(()=>{const e=sessionStorage.getItem("guestInfo");if(e)try{const t=JSON.parse(e);t.expiresAt&&Date.now()>t.expiresAt&&(console.log("‚è±Ô∏è Session expired, reloading page..."),st())}catch(t){console.error("Error checking session:",t),st()}},6e4)},st=()=>{sessionStorage.removeItem("guestInfo"),window.location.reload()},kt=()=>{const e=sessionStorage.getItem("guestInfo");if(e)try{const t=JSON.parse(e);return t.expiresAt&&Date.now()>t.expiresAt?(console.log("‚è±Ô∏è Session expired, clearing stored data"),sessionStorage.removeItem("guestInfo"),!1):(c.value=t,C.value=!0,j.value=!1,nt(),!0)}catch(t){console.error("Error parsing guest info:",t),sessionStorage.removeItem("guestInfo")}return!1},ae=ce(()=>!N.facilities||!Array.isArray(N.facilities)?(console.warn("No facilities data"),[]):N.facilities.filter(e=>{const t=e&&e.marker&&e.marker.longitude!==null&&e.marker.latitude!==null&&!isNaN(parseFloat(e.marker.longitude))&&!isNaN(parseFloat(e.marker.latitude));return t||console.warn("Skipping facility with invalid marker:",e),t}).map(e=>{try{const t=e.marker?.type?.toLowerCase()||"default";return{id:e.id,marker_id:e.marker.id,name:e.name||"Unnamed Facility",lng:parseFloat(e.marker.longitude),lat:parseFloat(e.marker.latitude),department:e.marker?.type||"Unknown",markerType:t,category:e.category||"General",description:e.description||"",icon:re[t]||re.default,marker:e.marker,photos:Array.isArray(e.photos)?e.photos:[],feedbacks:e.marker?.feedbacks||[]}}catch(t){return console.error("Error processing facility:",e,t),null}}).filter(e=>e!==null)),lt=()=>{if(!c.value.nickname.trim()){p.error("Please enter your nickname");return}y.value=2},_t=()=>{y.value=1},St=async()=>{if(!c.value.nickname||!c.value.role){p.error("Please complete all steps");return}try{const t=(await ye.post("/guests",{name:c.value.nickname,role:c.value.role})).data;c.value.id=t.id;const o={...c.value,expiresAt:Date.now()+1440*60*1e3};sessionStorage.setItem("guestInfo",JSON.stringify(o)),C.value=!0,j.value=!1,p.success(`Welcome, ${c.value.nickname}!`),nt(),r.value?b.userLocation.value?b.updateUserMarker(c.value,r.value,ot):b.startTracking(c.value,r.value,ot):await dt()}catch(e){console.error("Error saving guest info:",e),p.error(e.response?.data?.message||"Failed to save guest information")}},Et=e=>{const t=Se.find(l=>l.value===H.value),s=(t?t.speed:5)*1e3/3600,v=e/s,d=Math.ceil(v/60),k=new Date,h=new Date(k.getTime()+v*1e3);return{minutes:d,arrivalTime:h.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}},Pt=(e,t)=>L.generateEnhancedInstructions(e,t),Re=(e,{centerOnMap:t=!0}={})=>{if(!e)return;const o=i.value&&i.value.id===e.id;if(u.value=e,i.value=e,ge.value=!0,!o){w.value="",le.value="",Ee.value=!1,Ge(),Pe.value=!1;const s=localStorage,v=`facility_notes_${e.id}`,d=s.getItem(v);if(d)try{const k=JSON.parse(d),h=Date.now(),l=k.filter(G=>!(G.expiresAt&&G.expiresAt<h));l.length!==k.length&&s.setItem(v,JSON.stringify(l));const g=new Set(l.map(G=>G.id)),B=ee.value.filter(G=>!g.has(G.id));ee.value=[...l,...B]}catch(k){console.warn("Error parsing stored notes:",k)}}if(e.id&&bt(e.id),t&&r.value)try{r.value.panTo([e.lat,e.lng],{animate:!0})}catch(s){console.warn("Failed to pan to location:",s)}},Mt=()=>{ge.value=!1},Lt=()=>{if(!i.value||!r.value){p.error("Select a destination first");return}we(R.latLng(i.value.lat,i.value.lng),i.value)},we=async(e,t=null,o=null)=>{if(!b.userLocation.value){p.error("Waiting for GPS location...");return}if(t?(!i.value||i.value.id!==t.id||!ge.value)&&Re(t,{centerOnMap:!1}):(ge.value=!1,i.value=null),P.value&&r.value){try{r.value.hasLayer(P.value)&&r.value.removeLayer(P.value)}catch(l){console.warn("Error removing route polyline:",l)}P.value=null}if(T.value&&r.value){try{r.value.hasLayer(T.value)&&r.value.removeLayer(T.value)}catch(l){console.warn("Error removing destination marker:",l)}T.value=null}r.value&&r.value.closePopup();const s={lat:b.userLocation.value.lat,lng:b.userLocation.value.lng},v={lat:e.lat,lng:e.lng};if(se.value={lat:s.lat,lng:s.lng},console.log("üîç Calculating optimal route..."),n.value&&n.value.features){const l=L.findClickedLineString(v,n.value.features,30);if(l){console.log("üéØ User clicked on a campus path! Using hybrid route...");const g=l.feature.geometry.coordinates,B=l.point,G={lat:g[0][1],lng:g[0][0]},z=await L.getPublicRoute(s,G,H.value);let W=[];z&&z.length>0?W=[...z]:W=[s,G];for(let _e=0;_e<=B.index;_e++){const[He,Vt]=g[_e];W.push({lat:Vt,lng:He})}ke(W,"hybrid",!0,o),console.log("‚úÖ Hybrid route to campus path completed");return}}if(!n.value||!n.value.features||n.value.features.length===0){console.warn("‚ö†Ô∏è No campus paths available, using public route only");const l=await L.getPublicRoute(s,v,H.value);l?ke(l,"public",!1,o):ke([s,v],"direct",!1,o);return}const d=L.buildCampusGraph(n.value.features);if(d.size===0){console.warn("‚ö†Ô∏è Campus graph is empty, using public route only");const l=await L.getPublicRoute(s,v,H.value);l?ke(l,"public",!1,o):ke([s,v],"direct",!1,o);return}const k=[];try{const l=await L.getPublicRoute(s,v,H.value);if(l&&l.length>0){const g=L.calculateRouteDistance(l);k.push({type:"public",route:l,distance:g,isPrivate:!1}),console.log(`üü¢ Public route: ${Math.round(g)}m`)}}catch(l){console.error("‚ùå Public route error:",l)}try{const l=L.findNearestNode(s,d,100),g=L.findNearestNode(v,d,100);if(l&&g){console.log(`üîç Trying A* from ${l} to ${g}`);const B=L.findPathAStar(l,g,d);if(B&&B.length>0){const G=L.calculateRouteDistance(B);k.push({type:"private",route:B,distance:G,isPrivate:!0}),console.log(`üî¥ Campus route: ${Math.round(G)}m`)}}}catch(l){console.error("‚ùå Campus route error:",l)}try{const l=L.findCampusEntrances(d);if(l.length>0){const g=l.reduce((B,G)=>{const z=L.calculateDistance(v.lat,v.lng,G.lat,G.lng);return z<B.distance?{entrance:G,distance:z}:B},{entrance:null,distance:1/0});if(g.entrance&&g.distance<200){const B={lat:g.entrance.lat,lng:g.entrance.lng},G=await L.getPublicRoute(s,B,H.value);if(G&&G.length>0){const z=L.findNearestNode(v,d,100);if(z){const W=L.findPathAStar(g.entrance.id,z,d);if(W&&W.length>0){const _e=[...G,...W],He=L.calculateRouteDistance(_e);k.push({type:"hybrid",route:_e,distance:He,isPrivate:!0}),console.log(`üîµ Hybrid route: ${Math.round(He)}m`)}}}}}}catch(l){console.error("Hybrid route error:",l)}if(k.length===0){console.warn("‚ö†Ô∏è All routing failed, using direct line"),ke([s,v],"direct",!1);return}const h=k.reduce((l,g)=>g.distance<l.distance?g:l);console.log(`Selected: ${h.type.toUpperCase()} route (${Math.round(h.distance)}m)`),ke(h.route,h.type,h.isPrivate)},ke=(e,t,o,s=null)=>{if(!r.value){console.warn("Cannot draw route: map not initialized");return}if(P.value){try{r.value.hasLayer(P.value)&&r.value.removeLayer(P.value)}catch(z){console.warn("Error removing old route polyline:",z)}P.value=null}if(T.value){try{r.value.hasLayer(T.value)&&r.value.removeLayer(T.value)}catch(z){console.warn("Error removing old destination marker:",z)}T.value=null}const v=e.map(z=>[z.lat,z.lng]),k=s||{public:"#4CAF50",private:"#FF6B6B",hybrid:"#2196F3",direct:"#9E9E9E"}[t]||"#9E9E9E";P.value=R.polyline(v,{color:k,weight:6,opacity:.8,smoothFactor:1}).addTo(r.value),Ke.value=!0;const h=L.calculateRouteDistance(e),l=h>1e3?`${(h/1e3).toFixed(2)} km`:`${Math.round(h)} m`,g=Et(h),B={public:"üü¢ Public Roads",private:"üî¥ Campus Path",hybrid:"üîµ Public ‚Üí Campus",direct:"‚ö™ Direct Line"},G=Se.find(z=>z.value===H.value);F.value=`${B[t]}
${G.icon} ${G.label}
üìè ${l}
‚è±Ô∏è ${g.minutes} min
üïê Arrive at ${g.arrivalTime}`,I.value=Pt(e,o),$.value=!0,console.log(`Generated ${I.value.length} navigation instructions`);try{P.value&&r.value.hasLayer(P.value)&&r.value.fitBounds(P.value.getBounds(),{padding:[50,50]})}catch(z){console.warn("Error fitting bounds:",z)}p.success(`Route via ${B[t]}`)},Ct=()=>{const e=localStorage,t=[],o=Date.now();for(let s=0;s<e.length;s++){const v=e.key(s);if(v&&v.startsWith("facility_notes_"))try{const d=e.getItem(v);if(d){const k=JSON.parse(d),h=k.filter(l=>!(l.expiresAt&&l.expiresAt<o));h.length!==k.length&&e.setItem(v,JSON.stringify(h)),t.push(...h)}}catch(d){console.warn(`Error parsing notes from ${v}:`,d)}}ee.value=t,console.log(`üìù Loaded ${t.length} notes from ${Be}`)},$t=()=>{if(!r.value){p.error("Map not initialized");return}if(!b.userLocation.value){p.error("GPS location not available yet");return}const{lat:e,lng:t}=b.userLocation.value;r.value.flyTo([e,t],18,{animate:!0,duration:1.5}),p.success("Centered on your location"),b.userMarker.value&&setTimeout(()=>{b.userMarker.value.openPopup(),setTimeout(()=>b.userMarker.value.closePopup(),2e3)},1500)},Xe=async e=>{try{const t=Be==="localStorage"?localStorage:sessionStorage,o=ee.value.find(d=>d.id===e);if(!o){p.error("Note not found");return}const s=ae.value.find(d=>d.marker_id===o.marker_id);if(s){const d=`facility_notes_${s.id}`,k=t.getItem(d);if(k){let h=JSON.parse(k);h=h.filter(l=>l.id!==e),t.setItem(d,JSON.stringify(h))}}const v=pe.value.findIndex(d=>d.noteId===e);if(v!==-1&&r.value){const d=pe.value[v].marker;if(d)try{d.off(),r.value.hasLayer(d)&&r.value.removeLayer(d)}catch(k){console.warn("Error removing note marker:",k)}pe.value.splice(v,1)}ee.value=ee.value.filter(d=>d.id!==e)}catch(t){console.error("Error deleting note:",t)}},Nt=async()=>{if(!le.value.trim()){p.error("Please enter a note before saving");return}if(!c.value.id){p.error("Guest information not found");return}if(!i.value){p.error("Select a destination to attach the note");return}Je.value=!0;try{const e=Be==="localStorage"?localStorage:sessionStorage,t=`facility_notes_${i.value.id}`,o=`${t}_expiration`,s=e.getItem(t);let v=s?JSON.parse(s):[];const d=Date.now();v=v.filter(g=>!(g.expiresAt&&g.expiresAt<d));const k=v.findIndex(g=>g.guest_id===c.value.id),h=d+1440*60*1e3,l={id:`${Be}_${Date.now()}`,content:le.value.trim(),marker_id:i.value.marker_id,guest_id:c.value.id,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),expiresAt:h,guest:{id:c.value.id,name:c.value.nickname}};k!==-1?v[k]=l:v.push(l),e.setItem(t,JSON.stringify(v)),ee.value=ee.value.filter(g=>!(g.marker_id===i.value.marker_id&&g.guest_id===c.value.id)),ee.value=[...ee.value,l],window.location.reload()}catch(e){console.error("Error saving note:",e),p.error("Failed to save note")}finally{Je.value=!1}},It=e=>{const t=e?.target?.files?.[0];t&&(ve.value&&URL.revokeObjectURL(ve.value),Ue.value=t,ve.value=URL.createObjectURL(t),e?.target&&(e.target.value=""))},Ge=()=>{ve.value&&URL.revokeObjectURL(ve.value),Ue.value=null,ve.value=null,Ne.value="",Ie.value&&(Ie.value.value="")},At=()=>{const e=De.value.find(t=>t.guest_id===c.value.id);e?le.value=e.content:le.value="",Ee.value=!0},Tt=async()=>{if(!i.value){p.error("Select a destination before uploading photos");return}if(!c.value.id){p.error("Guest information not found");return}if(!Ue.value){p.error("Choose a photo to upload");return}Ve.value=!0;try{const e=new FormData;e.append("photo",Ue.value),e.append("guest_id",c.value.id),Ne.value.trim()&&e.append("caption",Ne.value.trim());const t=await ye.post(`/facilities/${i.value.id}/photos`,e,{headers:{"Content-Type":"multipart/form-data"}}),o=t.data.photo,s=i.value.id;oe.value={...oe.value,[s]:[o,...oe.value[s]||[]]},p.success(t.data.message||"Photo uploaded successfully!"),Ge()}catch(e){console.error("Error uploading photo:",e),p.error("Failed to upload photo")}finally{Ve.value=!1}},Ft=()=>{Ie.value&&Ie.value.click()},ze=e=>{if(!e)return"";try{return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return console.warn("Failed to format timestamp:",t),e}},Qe=()=>{if(!r.value||!r.value._loaded||!Array.isArray(Y.value)){console.warn("displayNotesOnMap: Map or markers not ready");return}if(!c.value||!c.value.id){console.warn("displayNotesOnMap: Guest info not available");return}if(me||r.value._animatingZoom||r.value._isZooming){console.warn("displayNotesOnMap: BLOCKED - Zoom in progress!");return}if(r.value._zoom!==r.value.getZoom()){console.warn("displayNotesOnMap: Zoom level mismatch, delaying..."),setTimeout(()=>Qe(),300);return}console.log("üìù displayNotesOnMap: Starting (safe to proceed)"),pe.value.forEach(e=>{if(e.marker&&r.value)try{e.marker.off(),r.value.hasLayer(e.marker)&&r.value.removeLayer(e.marker)}catch(t){console.warn("Error removing note marker:",t)}}),pe.value=[],Y.value.forEach((e,t)=>{const o=ae.value[t];if(!o)return;const s=ee.value.find(v=>v.marker_id===o.marker_id&&v.guest_id===c.value.id);if(s)try{const v=l=>{const g=document.createElement("div");return g.textContent=l,g.innerHTML},d=`
          <div class="note-bubble-container" data-note-id="${s.id}" style="
            background: white !important;
            border: 2px solid #E5E7EB !important;
            border-radius: 12px !important;
            padding: 14px 16px !important;
            min-width: 220px !important;
            max-width: 300px !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15), 0 4px 10px rgba(0, 0, 0, 0.08) !important;
            position: relative !important;
            opacity: 1 !important;
            transform: translateY(-100%) !important;
            margin-bottom: 20px !important;
            pointer-events: auto !important;
          ">
            <div class="note-bubble-header" style="
              display: flex !important;
              align-items: flex-start !important;
              gap: 10px !important;
              margin-bottom: 10px !important;
              padding-bottom: 10px !important;
              border-bottom: 1px solid #F3F4F6 !important;
            ">
              <div class="note-bubble-icon" style="font-size: 20px !important; line-height: 1 !important; flex-shrink: 0 !important;">üí¨</div>
              <div class="note-bubble-meta" style="
                flex: 1 !important;
                display: flex !important;
                flex-direction: column !important;
                gap: 3px !important;
              ">
                <span class="note-bubble-label" style="
                  font-size: 11px !important;
                  font-weight: 700 !important;
                  color: #6366F1 !important;
                  text-transform: uppercase !important;
                  letter-spacing: 0.8px !important;
                ">Your Note</span>
                <span class="note-bubble-time" style="
                  font-size: 10px !important;
                  color: #9CA3AF !important;
                  font-weight: 500 !important;
                ">${ze(s.created_at)}</span>
              </div>
              <button
                class="note-bubble-delete"
                title="Delete note"
                data-note-id="${s.id}"
                style="
                  background: #FEE2E2 !important;
                  border: none !important;
                  border-radius: 6px !important;
                  width: 24px !important;
                  height: 24px !important;
                  display: flex !important;
                  align-items: center !important;
                  justify-content: center !important;
                  cursor: pointer !important;
                  color: #EF4444 !important;
                  transition: all 0.2s ease !important;
                  flex-shrink: 0 !important;
                  padding: 0 !important;
                "
              >
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <path d="M9 3L3 9M3 3L9 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </button>
            </div>
            <div class="note-bubble-content" style="
              font-size: 14px !important;
              color: #1F2937 !important;
              line-height: 1.6 !important;
              word-wrap: break-word !important;
              font-weight: 400 !important;
              padding: 0 !important;
            ">${v(s.content)}</div>
            <div class="note-bubble-arrow" style="
              position: absolute !important;
              bottom: -10px !important;
              left: 50% !important;
              transform: translateX(-50%) !important;
              width: 0 !important;
              height: 0 !important;
              border-left: 12px solid transparent !important;
              border-right: 12px solid transparent !important;
              border-top: 12px solid white !important;
              filter: drop-shadow(0 3px 3px rgba(0, 0, 0, 0.1)) !important;
            "></div>
          </div>
        `,k=R.divIcon({className:"note-bubble-marker",html:d,iconSize:[280,"auto"],iconAnchor:[140,70]});if(!r.value||me||r.value._animatingZoom){console.warn(`Aborting note marker creation for ${o.name} - zoom in progress`);return}const h=R.marker([o.lat,o.lng],{icon:k,interactive:!1,zIndexOffset:-1e3,bubblingMouseEvents:!1});try{h.addTo(r.value)}catch(l){console.error("Failed to add note marker to map:",l);return}pe.value.push({noteId:s.id,marker:h,facilityMarkerId:o.marker_id}),setTimeout(()=>{const l=document.querySelector(`.note-bubble-delete[data-note-id="${s.id}"]`);l&&l.addEventListener("click",g=>{g.stopPropagation(),Xe(s.id)})},150)}catch(v){console.error(`‚ùå Error creating note marker for ${o.name}:`,v)}}),console.log(`üìù Created ${pe.value.length} note bubble markers`)};let et=null,me=!1;const tt=()=>{if(me){console.warn("debouncedDisplayNotes: Skipping due to zoom in progress");return}et&&clearTimeout(et),et=setTimeout(()=>{!me&&r.value&&!r.value._animatingZoom&&Qe()},250)};Ce(ee,()=>{r.value&&!me&&tt()},{deep:!0}),Ce(()=>N.polygons,()=>{r.value&&Q(N.polygons,r.value)},{deep:!0,immediate:!1});const it=async()=>{try{const e=await ye.get("/routes/export/geojson-pub",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});n.value=e.data,r.value&&Dt(),console.log("Loaded routes from database:",n.value)}catch(e){console.error("Error loading routes from database:",e),p.error("Failed to load campus paths")}},Dt=()=>{if(!r.value||!n.value||!n.value.features){console.warn("Cannot refresh private routes: Map or data not ready");return}A.value.forEach(e=>{if(r.value&&r.value.hasLayer&&r.value.hasLayer(e))try{r.value.removeLayer(e)}catch(t){console.warn("Error removing route layer:",t)}}),A.value=[],n.value.features.forEach(e=>{if(e.geometry&&e.geometry.type==="LineString"){const t=e.properties?.color||"#FF6B6B",o=R.geoJSON(e,{style:{color:t,weight:6,opacity:.9,dashArray:"10, 5",lineCap:"round",lineJoin:"round"}}).addTo(r.value);o.on("click",s=>{R.DomEvent.stopPropagation(s),we(s.latlng,null,e.properties?.color)}),A.value.push(o)}}),console.log(`Added ${n.value.features.length} campus path layers`),p.success("Campus paths updated in real-time!")},ct=async()=>{try{const e=await ye.get("/",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(e.data&&e.data.props&&e.data.props.facilities){if(V.facilities=e.data.props.facilities,Y.value.forEach(t=>{if(r.value&&r.value.hasLayer&&r.value.hasLayer(t))try{r.value.removeLayer(t)}catch(o){console.warn("Error removing marker:",o)}}),Y.value=[],ae.value.length>0)for(let t=0;t<ae.value.length;t++){const o=ae.value[t],s=K(o,r.value);if(s){typeof s.unbindPopup=="function"&&s.unbindPopup();let v=o.marker?.label||o.department||"Loading location...",d=`
              <div style="padding: 8px; min-width: 200px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                  <span style="font-size: 20px;">${o.icon}</span>
                  <strong style="font-size: 14px; color: #1f2937;">${o.name}</strong>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin: 0;">${v}</p>
                <button
                  onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${o.id} }))"
                  style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                  onmouseover="this.style.background='#2563eb'"
                  onmouseout="this.style.background='#3b82f6'"
                >
                  View Details
                </button>
              </div>
            `;s.bindPopup(d,{closeButton:!1,className:"facility-popup",offset:[0,-15]}),setTimeout(()=>{console.log(`üåç Geocoding ${o.name} at [${o.lat}, ${o.lng}]`),ut(o.lat,o.lng).then(k=>{k?(v=k,console.log(`‚úÖ Updated popup for ${o.name}: ${v}`),d=`
                      <div style="padding: 8px; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                          <span style="font-size: 20px;">${o.icon}</span>
                          <strong style="font-size: 14px; color: #1f2937;">${o.name}</strong>
                        </div>
                        <p style="font-size: 12px; color: #6b7280; margin: 0;">${v}</p>
                        <button
                          onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${o.id} }))"
                          style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                          onmouseover="this.style.background='#2563eb'"
                          onmouseout="this.style.background='#3b82f6'"
                        >
                          View Details
                        </button>
                      </div>
                    `,s.setPopupContent(d)):console.warn(`‚ö†Ô∏è No geocoded address for ${o.name}, keeping fallback`)}).catch(k=>{console.error(`‚ùå Geocoding failed for ${o.name}:`,k)})},t*1e3),s.on("mouseover",function(){this.openPopup()}),s.on("popupopen",function(){const h=this.getPopup().getElement();h&&(h.addEventListener("mouseenter",()=>{s.openPopup()}),h.addEventListener("mouseleave",()=>{s.closePopup()}))}),s.on("mouseout",function(){const k=this;setTimeout(()=>{const h=k.getPopup();h&&h.getElement()&&(h.getElement().matches(":hover")||k.closePopup())},100)}),s.on("click",()=>{Re(o)})}}console.log("‚úì Facilities loaded and markers refreshed:",ae.value.length)}}catch(e){console.error("Error loading facilities:",e),p.error("Failed to load facilities")}},Rt=async()=>{try{const e=await ye.get("/facilities/polygons",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});e.data&&(O.value.forEach(t=>{if(r.value&&r.value.hasLayer&&r.value.hasLayer(t))try{r.value.removeLayer(t)}catch(o){console.warn("Error removing polygon:",o)}}),O.value=[],Q(e.data,r.value),console.log("‚úì Polygons loaded and refreshed"))}catch(e){console.error("Error loading polygons:",e),p.error("Failed to load polygons")}},ot=e=>{if(i.value&&Ke.value)if(se.value){const t=L.calculateDistance(se.value.lat,se.value.lng,e.lat,e.lng);t>10?(console.log(`User moved ${Math.round(t)}m since last route calculation, updating route...`),se.value={lat:e.lat,lng:e.lng},p.info("Updating route from new position...",{timeout:2e3}),we(R.latLng(i.value.lat,i.value.lng),i.value)):console.log(`User moved ${Math.round(t)}m (< 10m threshold, keeping current route)`)}else P.value&&(console.log("Initial GPS sync for existing route, recalculating..."),se.value={lat:e.lat,lng:e.lng},we(R.latLng(i.value.lat,i.value.lng),i.value))},ut=async(e,t)=>{try{console.log(`üåç Geocoding: ${e}, ${t}`);const o=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&zoom=18&addressdetails=1`,{headers:{"User-Agent":"ICNS-Map-Application"}});if(!o.ok)return console.warn(`‚ùå Geocoding failed with status: ${o.status}`),null;const s=await o.json();if(console.log(`üìç Geocoding response for ${e}, ${t}:`,s.address),s&&s.address){const v=[],d=s.address.municipality||s.address.city||s.address.town||s.address.village;d&&v.push(d);const k=s.address.state||s.address.province;k&&v.push(k);const h=v.length>0?v.join(" ‚Ä¢ "):"Location";return console.log(`‚úÖ Geocoded: ${h}`),h}return console.warn("‚ö†Ô∏è No address data in response"),null}catch(o){return console.error("‚ùå Reverse geocoding error:",o),null}},dt=async()=>{try{await it(),Ct();const e=R.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"&copy; OpenStreetMap contributors"}),t=R.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{maxZoom:19,attribution:"Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"});r.value=R.map("map",{center:[8.1695,126.001838],zoom:17,layers:[e],zoomControl:!0}),Te.value="navigation";const o={navigation:{layer:e},satellite:{layer:t}},s=d=>{if(!o[d]||Te.value===d)return;const k=o[Te.value]?.layer;k&&r.value.hasLayer(k)&&r.value.removeLayer(k),o[d].layer.addTo(r.value),Te.value=d},v=R.Control.extend({options:{position:"bottomright"},onAdd:()=>{const d=R.DomUtil.create("div","leaflet-control guest-map-controls");d.innerHTML=`
          <button type="button" class="guest-control-button guest-control-button__locate" data-action="locate" title="Jump to my location">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3" />
              <path d="M12 5V3" />
              <path d="M12 21v-2" />
              <path d="M5 12H3" />
              <path d="M21 12h-2" />
              <path d="M19.071 4.929l-1.414 1.414" />
              <path d="M6.343 17.657l-1.414 1.414" />
              <path d="M4.929 4.929l1.414 1.414" />
              <path d="M17.657 17.657l1.414 1.414" />
            </svg>
          </button>
          <div class="guest-base-toggle">
            <button type="button" class="guest-control-button" data-layer="navigation" title="Navigation view">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 20l-6-2V6l6 2 6-2 6 2v12l-6-2-6 2z" />
                <path d="M9 8v12" />
                <path d="M15 6v12" />
              </svg>
            </button>
            <button type="button" class="guest-control-button" data-layer="satellite" title="Satellite view">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 4h6l10 10-6 6L4 10V4z" />
                <path d="M2 12l4-4" />
                <path d="M12 22l4-4" />
                <path d="M14 10l-4 4" />
              </svg>
            </button>
          </div>
        `;const k=d.querySelector('[data-action="locate"]'),h=d.querySelectorAll("[data-layer]"),l=()=>{h.forEach(g=>{g.classList.toggle("is-active",g.dataset.layer===Te.value)})};return R.DomEvent.on(k,"click",g=>{R.DomEvent.stopPropagation(g),R.DomEvent.preventDefault(g),$t()}),h.forEach(g=>{R.DomEvent.on(g,"click",B=>{R.DomEvent.stopPropagation(B),R.DomEvent.preventDefault(B);const G=g.dataset.layer;s(G),l()})}),l(),R.DomEvent.disableClickPropagation(d),R.DomEvent.disableScrollPropagation(d),d}});r.value.addControl(new v),r.value.whenReady(()=>{if(console.log("Map is fully loaded and ready"),ae.value.length>0){console.log(`Adding ${ae.value.length} facility markers`);for(let h=0;h<ae.value.length;h++){const l=ae.value[h],g=K(l,r.value);if(g){typeof g.unbindPopup=="function"&&g.unbindPopup();let B=l.marker?.label||l.department||"Loading location...",G=`
              <div style="padding: 8px; min-width: 200px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                  <span style="font-size: 20px;">${l.icon}</span>
                  <strong style="font-size: 14px; color: #1f2937;">${l.name}</strong>
                </div>
                <p style="font-size: 12px; color: #6b7280; margin: 0;">${B}</p>
                <button
                  onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${l.id} }))"
                  style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                  onmouseover="this.style.background='#2563eb'"
                  onmouseout="this.style.background='#3b82f6'"
                >
                  View Details
                </button>
              </div>
            `;g.bindPopup(G,{closeButton:!1,className:"facility-popup",offset:[0,-15]}),setTimeout(()=>{console.log(`üåç Geocoding ${l.name} at [${l.lat}, ${l.lng}]`),ut(l.lat,l.lng).then(z=>{z?(B=z,console.log(`‚úÖ Updated popup for ${l.name}: ${B}`),G=`
                      <div style="padding: 8px; min-width: 200px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                          <span style="font-size: 20px;">${l.icon}</span>
                          <strong style="font-size: 14px; color: #1f2937;">${l.name}</strong>
                        </div>
                        <p style="font-size: 12px; color: #6b7280; margin: 0;">${B}</p>
                        <button
                          onclick="window.dispatchEvent(new CustomEvent('open-facility-panel', { detail: ${l.id} }))"
                          style="margin-top: 8px; width: 100%; background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 500; cursor: pointer;"
                          onmouseover="this.style.background='#2563eb'"
                          onmouseout="this.style.background='#3b82f6'"
                        >
                          View Details
                        </button>
                      </div>
                    `,g.setPopupContent(G)):console.warn(`‚ö†Ô∏è No geocoded address for ${l.name}, keeping fallback`)}).catch(z=>{console.error(`‚ùå Geocoding failed for ${l.name}:`,z)})},h*1e3),g.on("mouseover",function(){this.openPopup()}),g.on("popupopen",function(){const W=this.getPopup().getElement();W&&(W.addEventListener("mouseenter",()=>{g.openPopup()}),W.addEventListener("mouseleave",()=>{g.closePopup()}))}),g.on("mouseout",function(){const z=this;setTimeout(()=>{const W=z.getPopup();W&&W.getElement()&&(W.getElement().matches(":hover")||z.closePopup())},100)}),g.on("click",()=>{Re(l)})}}}setTimeout(()=>{Qe()},300),N.polygons&&N.polygons.length>0&&Q(N.polygons,r.value),n.value&&n.value.features&&n.value.features.forEach(h=>{if(h.geometry&&h.geometry.type==="LineString"){const l=h.properties?.color||"#FF6B6B",g=R.geoJSON(h,{style:{color:l,weight:6,opacity:.9,dashArray:"10, 5",lineCap:"round",lineJoin:"round"}}).addTo(r.value);g.on("click",B=>{R.DomEvent.stopPropagation(B),we(B.latlng,null,h.properties?.color)}),A.value.push(g)}}),r.value.on("click",h=>{we(h.latlng)});let d=!1;r.value.on("zoomstart",()=>{me=!0,r.value._isZooming=!0}),r.value.on("zoomend",()=>{setTimeout(()=>{me=!1,r.value._isZooming=!1,d&&(d=!1,tt())},100)});const k=tt;window.addEventListener("notesPending",()=>{me&&(d=!0)}),setTimeout(()=>{b.startTracking(c.value,r.value,ot)},500)})}catch(e){console.error("Error initializing map:",e),p.error("Failed to initialize map. Please refresh the page.")}},Gt=e=>{Re(e),S.value=e.name,Z.value=!1,we(R.latLng(e.lat,e.lng),e),console.log(`Routing to ${e.name}`)},pt=()=>{if(S.value="",i.value=null,u.value=null,Z.value=!1,se.value=null,Ke.value=!1,ge.value=!1,le.value="",Ee.value=!1,w.value="",Ge(),P.value&&r.value){try{r.value.hasLayer(P.value)&&r.value.removeLayer(P.value)}catch(e){console.warn("Error removing route polyline:",e)}P.value=null}if(T.value&&r.value){try{r.value.hasLayer(T.value)&&r.value.removeLayer(T.value)}catch(e){console.warn("Error removing destination marker:",e)}T.value=null}F.value=null,$.value=!1,console.log("Route cleared")},zt=async()=>{if(!w.value.trim()){p.error("Please enter your feedback");return}if(!c.value.id){p.error("Guest information not found");return}if(!i.value){p.error("Select a destination before sending feedback");return}q.value=!0;try{const e=await ye.post("/create/feedback",{guest_id:c.value.id,marker_id:i.value.marker_id,message:w.value.trim()}),t={...e.data.feedback,message:w.value.trim(),marker_id:i.value.marker_id,guest:{id:c.value.id,name:c.value.nickname}};xe.value=[...xe.value,t],M.value=e.data.message,p.success(M.value||"Feedback saved successfully!"),w.value=""}catch(e){console.error("Error saving feedback:",e),p.error("Failed to save feedback")}finally{q.value=!1}},jt=e=>{X.value=e,Ye.value=!0},gt=()=>{Ye.value=!1},Ot=()=>{X.value<We.value.length-1&&X.value++},Bt=()=>{X.value>0&&X.value--},Ut=kt();return Ht(()=>{Ut&&(dt(),console.log(`Welcome back, ${c.value.nickname}!`)),window.addEventListener("open-facility-panel",e=>{const t=e.detail,o=ae.value.find(s=>s.id===t);o&&Re(o)}),window.addEventListener("delete-note",e=>{const t=e.detail;confirm("Are you sure you want to delete this note?")&&Xe(t)}),window.Echo.channel("main-channel").listen(".MainEvent",e=>{if(e.type==="route"&&(it(),console.log("Route event:",e.action)),e.type==="facility"&&(ct(),console.log("Facility event:",e.action)),e.type==="marker"&&(ct(),console.log("Marker event:",e.action)),e.type==="polygon"&&(Rt(),console.log("Polygon event:",e.action)),e.type==="photo"&&e.action==="create"&&e.data){const t=e.data?.facility_id;if(t){const o=oe.value[t]||[];o.some(v=>v.id===e.data.id)||(oe.value={...oe.value,[t]:[e.data,...o]})}}e.type==="feedback"&&e.action==="create"&&e.data&&(xe.value.some(o=>o.id===e.data.id)||(xe.value=[...xe.value,e.data]))})}),Zt(()=>{if(b.stopTracking(r.value),ne.value&&clearInterval(ne.value),Ge(),r.value)try{P.value&&r.value.hasLayer(P.value)&&r.value.removeLayer(P.value),T.value&&r.value.hasLayer(T.value)&&r.value.removeLayer(T.value),A.value.forEach(e=>{r.value.hasLayer(e)&&r.value.removeLayer(e)}),pe.value.forEach(e=>{e.marker&&r.value.hasLayer(e.marker)&&r.value.removeLayer(e.marker)})}catch(e){console.warn("Error during cleanup:",e)}console.log("Component unmounted, cleanup complete")}),(e,t)=>(f(),m("div",no,[be(Wt,{name:"details-panel"},{default:Kt(()=>[_(C)&&ge.value&&_(i)?(f(),m("aside",so,[t[22]||(t[22]=a("div",{class:"md:hidden flex justify-center pt-2 pb-1"},[a("div",{class:"w-12 h-1 bg-gray-300 rounded-full"})],-1)),a("div",lo,[a("div",io,[a("div",co,[a("span",uo,x(_(i).icon),1),a("h2",po,x(_(i).name),1)]),a("p",go,x(_(i).department)+" ‚Ä¢ "+x(_(i).category),1)]),a("button",{onClick:Mt,class:"rounded-md p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-700"},[be(_(Ze),{class:"h-5 w-5"})])]),a("div",vo,[a("section",mo,[_(i).description?(f(),m("p",fo,x(_(i).description),1)):U("",!0),a("div",ho,[a("button",{type:"button",onClick:Lt,class:"inline-flex flex-1 items-center justify-center gap-2 rounded-lg bg-green-900 px-3 py-2 text-sm font-semibold text-white transition hover:bg-green-800"}," üß≠ Start Navigation "),_(P)?(f(),m("button",{key:0,type:"button",onClick:pt,class:"inline-flex items-center justify-center gap-2 rounded-lg border border-gray-300 px-3 py-2 text-sm font-semibold text-gray-700 transition hover:bg-gray-100"}," ‚úñ Clear ")):U("",!0)]),_(F)?(f(),m("div",yo,[t[14]||(t[14]=a("div",{class:"border-b border-gray-200 bg-gray-100 px-3 py-2"},[a("h3",{class:"text-xs font-semibold text-gray-800"},"Route Info")],-1)),a("p",bo,x(_(F)),1)])):U("",!0),_($)&&_(I).length?(f(),m("div",xo,[t[15]||(t[15]=a("div",{class:"border-b border-gray-200 bg-gray-100 px-3 py-2"},[a("h3",{class:"text-xs font-semibold text-gray-800"},"Navigation Steps")],-1)),a("div",{class:"max-h-60 overflow-y-auto",ref_key:"navigationInstructionsContainer",ref:de},[(f(!0),m(fe,null,he(_(I),(o,s)=>(f(),m("div",{key:s,class:"flex gap-3 px-3 py-3 border-b border-gray-100 last:border-b-0 hover:bg-gray-50"},[a("span",wo,x(o.icon),1),a("div",ko,[a("p",_o,x(o.text),1),a("p",So,x(o.distance),1)])]))),128))],512)])):U("",!0)]),a("section",Eo,[a("div",Po,[t[16]||(t[16]=a("h3",{class:"text-sm font-semibold text-gray-800"},"Photos",-1)),a("span",Mo,x(Le.value.total)+" total",1)]),a("div",Lo,[a("div",Co,[a("input",{ref_key:"photoInput",ref:Ie,type:"file",accept:"image/*",class:"hidden",onChange:It},null,544),ve.value?(f(),m("div",No,[a("img",{src:ve.value,alt:"Photo preview",class:"mx-auto max-h-40 rounded-md object-cover shadow-sm"},null,8,Io),je(a("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>Ne.value=o),type:"text",maxlength:"255",placeholder:"Add a short caption (optional)",class:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white"},null,512),[[Oe,Ne.value]]),a("div",Ao,[a("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 transition",onClick:Ge}," Cancel "),a("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:Ve.value,onClick:Tt},x(Ve.value?"Uploading...":"Save Photo"),9,To)])])):(f(),m("div",$o,[t[17]||(t[17]=a("p",{class:"text-sm text-gray-600"},"üì∏ Click to upload a photo",-1)),a("button",{type:"button",class:"inline-flex items-center justify-center rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white transition hover:bg-green-800",onClick:Ft}," Choose Photo ")]))]),Le.value.total>0?(f(),m("div",Fo,[a("div",Do,[(f(!0),m(fe,null,he(We.value,(o,s)=>(f(),m("article",{key:o.id,onClick:v=>jt(s),class:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm cursor-pointer transition hover:shadow-md hover:border-gray-300"},[a("img",{src:o.url,alt:o.caption||_(i).name,class:"h-28 w-full object-cover"},null,8,Go),a("div",zo,[a("p",jo,x(o.caption||"Shared photo"),1),a("p",Oo,x(o.guest?.name||"Guest")+" ‚Ä¢ "+x(ze(o.created_at)),1)])],8,Ro))),128))]),Le.value.total>2&&!Pe.value?(f(),m("button",{key:0,onClick:t[1]||(t[1]=o=>Pe.value=!0),class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-100 hover:border-gray-400"}," + "+x(Le.value.total-2)+" More Photo"+x(Le.value.total-2>1?"s":""),1)):U("",!0),Pe.value&&Le.value.total>2?(f(),m("button",{key:1,onClick:t[2]||(t[2]=o=>Pe.value=!1),class:"w-full rounded-lg border border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:bg-gray-100 hover:border-gray-400"}," Show Less ")):U("",!0)])):(f(),m("p",Bo,"Be the first to share a photo for this place."))])]),a("section",Uo,[a("div",Vo,[t[18]||(t[18]=a("h3",{class:"text-sm font-semibold text-gray-800"},"Notes",-1)),a("span",Jo,x(De.value.length)+" total",1)]),a("div",Ho,[a("p",null,"You can add one note that will appear on the map. It expires after 24 hours and is stored in your browser ("+x(Be==="localStorage"?"persists across sessions":"session only")+").",1),t[19]||(t[19]=a("p",{class:"font-semibold text-green-700"},"Notes appear as purple bubbles above markers. Click the ‚úï button to delete!",-1))]),Ee.value?(f(),m("div",Zo,[je(a("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>le.value=o),rows:"3",maxlength:"500",placeholder:"Share a quick note or tip about this spot...",class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white",autofocus:"",onKeydown:t[4]||(t[4]=vt(ue(()=>{},["prevent"]),["enter"]))},null,544),[[Oe,le.value]]),a("div",Ko,[a("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-100 transition",onClick:t[5]||(t[5]=ue(o=>Ee.value=!1,["prevent"]))}," Cancel "),a("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:Je.value||!le.value.trim(),onClick:ue(Nt,["prevent"])},x(Je.value?"Saving...":"Save Note"),9,Yo)])])):U("",!0),Ee.value?U("",!0):(f(),m("div",Wo,[a("button",{type:"button",class:"w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:border-gray-400 hover:bg-gray-100",onClick:ue(At,["prevent"])},x(xt.value?"‚úèÔ∏è Edit Your Note":"+ Add Note"),1)])),De.value.length?(f(),m("div",qo,[(f(!0),m(fe,null,he(De.value,o=>(f(),m("article",{key:o.id,class:$e(["rounded-lg p-3 shadow-sm transition",o.guest_id===c.value.id?"ml-8 bg-green-100 border-l-4 border-green-700":"mr-8 bg-gray-100 border-l-4 border-gray-400"])},[a("div",Xo,[a("div",null,[a("p",Qo,[Yt(x(o.guest?.name||"Guest")+" ",1),o.guest_id===c.value.id?(f(),m("span",ea," (You)")):U("",!0)]),a("p",ta,x(ze(o.created_at)),1)]),o.guest_id===c.value.id?(f(),m("button",{key:0,type:"button",class:"rounded-md p-1 text-gray-400 transition hover:bg-gray-200 hover:text-red-500",onClick:ue(s=>Xe(o.id),["prevent"]),title:"Delete note"},[be(_(Ze),{class:"h-4 w-4"})],8,oa)):U("",!0)]),a("p",aa,x(o.content),1)],2))),128))])):(f(),m("p",ra,"No notes yet. Be the first to share!"))]),a("section",na,[a("div",sa,[t[20]||(t[20]=a("h3",{class:"text-sm font-semibold text-gray-800"},"Feedback",-1)),a("span",la,x(qe.value.length)+" total",1)]),Ae.value?(f(),m("div",ia,[je(a("textarea",{"onUpdate:modelValue":t[6]||(t[6]=o=>mt(w)?w.value=o:null),rows:"3",maxlength:"500",placeholder:"How was your experience here?",class:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-gray-400 focus:outline-none focus:ring-1 focus:ring-gray-400 bg-white",autofocus:""},null,512),[[Oe,_(w)]]),a("div",ca,[a("button",{type:"button",class:"rounded-md border border-gray-300 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-100 transition",onClick:t[7]||(t[7]=ue(o=>Ae.value=!1,["prevent"]))}," Cancel "),a("button",{type:"button",class:"rounded-md bg-green-900 px-3 py-2 text-xs font-semibold text-white hover:bg-green-800 transition",disabled:_(q)||!_(w).trim(),onClick:ue(zt,["prevent"])},x(_(q)?"Sending...":"Submit Feedback"),9,ua)])])):U("",!0),Ae.value?U("",!0):(f(),m("div",da,[a("button",{type:"button",class:"w-full rounded-lg border-2 border-dashed border-gray-300 bg-gray-50 px-4 py-2.5 text-sm font-medium text-gray-700 transition hover:border-gray-400 hover:bg-gray-100",onClick:t[8]||(t[8]=ue(o=>Ae.value=!Ae.value,["prevent"]))}," + Add Feedback ")])),qe.value.length?(f(),m("div",pa,[t[21]||(t[21]=a("h4",{class:"text-xs font-semibold text-gray-600 uppercase tracking-wide"},"Recent Feedback",-1)),a("div",ga,[(f(!0),m(fe,null,he(qe.value,o=>(f(),m("article",{key:o.id,class:"rounded-lg border border-gray-200 bg-gray-50 px-3 py-3 shadow-sm"},[a("div",va,[a("p",ma,x(o.guest?.name||"Guest"),1),a("p",fa,x(ze(o.created_at)),1)]),a("p",ha,x(o.message),1)]))),128))])])):(f(),m("p",ya,"No feedback yet. Share your thoughts!"))])])])):U("",!0)]),_:1}),a("div",ba,[a("div",{id:"map",class:$e(["h-full w-full transition-all duration-300",_(C)?"":"blur-sm pointer-events-none"])},null,2),_(C)?(f(),m("div",xa,[a("div",wa,[a("div",ka,[a("div",_a,[be(_(to),{class:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400"})]),je(a("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>mt(S)?S.value=o:null),type:"text",placeholder:"Search for facilities...",class:"w-full rounded-lg border-0 py-2.5 pl-9 pr-10 text-xs focus:ring-2 focus:ring-green-900 sm:py-3 sm:pl-10 sm:text-sm"},null,512),[[Oe,_(S)]]),_(S)?(f(),m("button",{key:0,onClick:pt,class:"absolute inset-y-0 right-0 flex items-center pr-3"},[be(_(Ze),{class:"h-4 w-4 sm:h-5 sm:w-5 text-gray-400 hover:text-gray-600"})])):U("",!0)]),_(Z)?(f(),m("div",Sa,[_(te)?(f(),m("div",Ea," Searching... ")):_(E).length===0?(f(),m("div",Pa," No facilities found ")):(f(),m("div",Ma,[(f(!0),m(fe,null,he(_(E),o=>(f(),m("button",{key:o.id,onClick:s=>Gt(o),class:"flex w-full items-center gap-2 px-3 py-2.5 text-left transition hover:bg-gray-50 sm:px-4 sm:py-3"},[a("span",Ca,x(o.icon),1),a("div",$a,[a("p",Na,x(o.name),1),a("p",Ia,x(o.markerType)+" ‚Ä¢ "+x(o.category),1)])],8,La))),128))]))])):U("",!0)])])):U("",!0),_(C)?(f(),m("div",Aa,[a("div",Ta,[(f(),m(fe,null,he(Se,o=>a("button",{key:o.value,onClick:s=>H.value=o.value,class:$e(["min-w-[44px] rounded-md px-2.5 py-2 text-xs font-medium transition sm:px-3 sm:text-sm",H.value===o.value?"bg-green-900 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"]),title:o.label},[a("span",Da,x(o.icon),1),a("span",Ra,x(o.label),1)],10,Fa)),64))])])):U("",!0),_(C)?(f(),m("div",Ga,[a("div",za,[be(_(oo),{class:"h-5 w-5 text-green-900"}),a("div",ja,[a("p",Oa,x(c.value.nickname),1),a("p",Ba,x(c.value.role),1)])])])):U("",!0),_(C)&&_(F)&&!ge.value?(f(),m("div",Ua,[a("div",Va,[t[23]||(t[23]=a("h3",{class:"text-xs font-semibold text-white"},"Route Info",-1)),a("button",{onClick:t[10]||(t[10]=o=>F.value=null),class:"flex h-5 w-5 items-center justify-center rounded text-gray-400 transition hover:text-white"}," √ó ")]),a("p",Ja,x(_(F)),1)])):U("",!0),_($)&&!ge.value?(f(),m("div",Ha,[a("div",Za,[t[24]||(t[24]=a("h3",{class:"text-xs font-semibold text-white"},"Navigation",-1)),a("button",{onClick:t[11]||(t[11]=o=>$.value=!1),class:"flex h-5 w-5 items-center justify-center rounded text-gray-400 transition hover:text-white"}," √ó ")]),a("div",{ref_key:"navigationInstructionsContainer",ref:de,class:"overflow-y-auto"},[(f(!0),m(fe,null,he(_(I),(o,s)=>(f(),m("div",{key:s,class:"flex items-start gap-2 border-b border-gray-100 px-3 py-2 text-xs last:border-b-0"},[a("span",Ka,x(o.icon),1),a("div",Ya,[a("p",Wa,x(o.text),1),a("p",qa,x(o.distance),1)])]))),128))],512)])):U("",!0)]),_(j)?(f(),m("div",Xa,[a("div",Qa,[_(y)===1?(f(),m("div",er,[t[25]||(t[25]=qt('<div class="mb-6 text-center sm:mb-8" data-v-5efdb5ae><div class="flex items-center justify-center gap-3 mb-4" data-v-5efdb5ae><div class="h-12 w-12 bg-green-900 rounded-full flex items-center justify-center p-1.5 shadow-md" data-v-5efdb5ae><img src="'+Xt+'" alt="ASSCAT Logo" class="h-full w-full object-contain" data-v-5efdb5ae></div><div class="flex flex-col items-start" data-v-5efdb5ae><span class="text-lg font-bold text-green-900" data-v-5efdb5ae>ASSCAT</span><span class="text-xs font-medium text-gray-600" data-v-5efdb5ae>Campus Navigator</span></div></div><h2 class="mb-2 text-xl font-bold text-gray-900 sm:text-2xl" data-v-5efdb5ae>Welcome to ASSCAT Campus Navigator</h2><p class="text-xs text-gray-500 sm:text-sm" data-v-5efdb5ae>Let&#39;s get started with your nickname</p></div>',1)),a("div",tr,[je(a("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>c.value.nickname=o),type:"text",placeholder:"Enter your nickname",maxlength:"50",class:"w-full rounded-lg border border-gray-300 px-4 py-3 text-sm text-gray-900 focus:border-green-900 focus:outline-none focus:ring-1 focus:ring-green-900 sm:text-base",onKeyup:vt(lt,["enter"])},null,544),[[Oe,c.value.nickname]]),a("button",{onClick:lt,disabled:!c.value.nickname.trim(),class:$e(["w-full rounded-lg px-4 py-3 text-sm font-medium transition",c.value.nickname.trim()?"bg-green-900 text-white hover:bg-green-800":"cursor-not-allowed bg-gray-200 text-gray-400"])}," Continue ",10,or)])])):_(y)===2?(f(),m("div",ar,[t[26]||(t[26]=a("div",{class:"mb-6 text-center sm:mb-8"},[a("h2",{class:"mb-2 text-xl font-bold text-gray-900 sm:text-2xl"},"Select Your Role"),a("p",{class:"text-xs text-gray-500 sm:text-sm"},"How are you visiting our campus?")],-1)),a("div",rr,[(f(),m(fe,null,he(yt,o=>a("button",{key:o.value,onClick:s=>c.value.role=o.value,class:$e(["flex w-full items-center gap-3 rounded-lg border-2 px-4 py-3 transition",c.value.role===o.value?"border-green-700 bg-green-50":"border-gray-200 hover:border-gray-300"])},[a("span",sr,x(o.icon),1),a("span",lr,x(o.label),1)],10,nr)),64))]),a("div",ir,[a("button",{onClick:St,disabled:!c.value.role,class:$e(["w-full rounded-lg px-4 py-3 text-sm font-medium transition",c.value.role?"bg-green-900 text-white hover:bg-green-800":"cursor-not-allowed bg-gray-200 text-gray-400"])}," Start Exploring ",10,cr),a("button",{onClick:_t,class:"w-full rounded-lg px-4 py-3 text-sm font-medium text-gray-600 transition hover:text-gray-900"}," Back ")])])):U("",!0)])])):U("",!0),Ye.value?(f(),m("div",{key:1,onClick:gt,class:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 p-4"},[a("div",{onClick:t[13]||(t[13]=ue(()=>{},["stop"])),class:"relative w-full max-w-5xl"},[a("button",{onClick:gt,class:"absolute -top-12 right-0 text-white hover:text-gray-300 transition"},[be(_(Ze),{class:"h-8 w-8"})]),a("div",ur,[ie.value[X.value]?(f(),m("img",{key:0,src:ie.value[X.value].url,alt:ie.value[X.value].caption||"Photo",class:"w-full max-h-[80vh] object-contain bg-gray-100"},null,8,dr)):U("",!0),a("div",pr,[ie.value[X.value]?.caption?(f(),m("p",gr,x(ie.value[X.value].caption),1)):U("",!0),a("p",vr,x(ie.value[X.value]?.guest?.name||"Guest")+" ‚Ä¢ "+x(ze(ie.value[X.value]?.created_at)),1),a("p",mr," Photo "+x(X.value+1)+" of "+x(ie.value.length),1)]),X.value>0?(f(),m("button",{key:1,onClick:Bt,class:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition"},[...t[27]||(t[27]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-6 h-6"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})],-1)])])):U("",!0),X.value<ie.value.length-1?(f(),m("button",{key:2,onClick:Ot,class:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/90 hover:bg-white rounded-full p-3 shadow-lg transition"},[...t[28]||(t[28]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",class:"w-6 h-6"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 4.5l7.5 7.5-7.5 7.5"})],-1)])])):U("",!0)])])])):U("",!0)]))}},hr=Qt(fr,[["__scopeId","data-v-5efdb5ae"]]),yr={class:"w-full h-screen overflow-hidden"},Mr={__name:"Index",props:{facilities:{type:Array,default:()=>[]},notes:{type:Array,default:()=>[]},polygons:{type:Array,default:()=>[]}},setup(J){return(N,p)=>(f(),m("div",null,[a("div",yr,[be(hr,{facilities:J.facilities,notes:J.notes,polygons:J.polygons},null,8,["facilities","notes","polygons"])])]))}};export{Mr as default};
