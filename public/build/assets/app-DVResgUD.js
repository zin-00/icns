const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Facility-K91Zdm22.js","assets/AuthenticatedLayout-Bok9qdk6.js","assets/logo-C5fiQHXv.js","assets/_plugin-vue_export-helper-D6tXFltF.js","assets/AuthenticatedLayout-CLHaxAzo.css","assets/TextInput-DvcpuaST.js","assets/MagnifyingGlassIcon-DfZOrS8f.js","assets/XMarkIcon-fdPOovce.js","assets/ArrowPathIcon-Di9KmBpG.js","assets/PlusIcon-BEIQ63GO.js","assets/EyeIcon-QiIuLpec.js","assets/Facility-CxEczaWO.css","assets/app-C4g6CwMg.css","assets/Index-BmrlDCKw.js","assets/LoginPage-q_Xv03tr.js","assets/loader-circle-_zF6vjq1.js","assets/Register-DzJ3daAE.js","assets/Profile-qHtD3rh1.js","assets/Feedback-BlUMXJ_f.js","assets/Feedback-Dc5FsT5k.css","assets/Index-DmW4C8GX.js","assets/Index-gsYk8J_j.css","assets/SearchLogs-BAVYl9R_.js","assets/SearchLogs-Dfnju4it.css","assets/Map-3y7D33lL.js","assets/Map-C3j3GqLC.css","assets/Notes-CDqL6xhF.js","assets/Notes-BDUID1yK.css","assets/ReportDetail-BZos6XlJ.js","assets/CalendarIcon-BMBBLQ2d.js","assets/ReportDetail-Ck-MaCVr.css","assets/ReportsDashboard-5-4EUktr.js","assets/ReportsDashboard-C1DaD4WI.css"])))=>i.map(i=>d[i]);
/* empty css            */const GD="modulepreload",HD=function(a){return"/build/"+a},HE={},$l=function(d,y,S){let P=Promise.resolve();if(y&&y.length>0){let j=function(H){return Promise.all(H.map(W=>Promise.resolve(W).then(ee=>({status:"fulfilled",value:ee}),ee=>({status:"rejected",reason:ee}))))};document.getElementsByTagName("link");const k=document.querySelector("meta[property=csp-nonce]"),r=k?.nonce||k?.getAttribute("nonce");P=j(y.map(H=>{if(H=HD(H),H in HE)return;HE[H]=!0;const W=H.endsWith(".css"),ee=W?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${H}"]${ee}`))return;const le=document.createElement("link");if(le.rel=W?"stylesheet":GD,W||(le.as="script"),le.crossOrigin="",le.href=H,r&&le.setAttribute("nonce",r),document.head.appendChild(le),W)return new Promise((pe,se)=>{le.addEventListener("load",pe),le.addEventListener("error",()=>se(new Error(`Unable to preload CSS for ${H}`)))})}))}function M(k){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=k,window.dispatchEvent(r),!r.defaultPrevented)throw k}return P.then(k=>{for(const r of k||[])r.status==="rejected"&&M(r.reason);return d().catch(M)})};function FP(a,d){return function(){return a.apply(d,arguments)}}const{toString:ZD}=Object.prototype,{getPrototypeOf:pw}=Object,{iterator:av,toStringTag:BP}=Symbol,lv=(a=>d=>{const y=ZD.call(d);return a[y]||(a[y]=y.slice(8,-1).toLowerCase())})(Object.create(null)),Ac=a=>(a=a.toLowerCase(),d=>lv(d)===a),cv=a=>d=>typeof d===a,{isArray:vp}=Array,fp=cv("undefined");function R_(a){return a!==null&&!fp(a)&&a.constructor!==null&&!fp(a.constructor)&&ul(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const NP=Ac("ArrayBuffer");function WD(a){let d;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?d=ArrayBuffer.isView(a):d=a&&a.buffer&&NP(a.buffer),d}const XD=cv("string"),ul=cv("function"),UP=cv("number"),O_=a=>a!==null&&typeof a=="object",KD=a=>a===!0||a===!1,Py=a=>{if(lv(a)!=="object")return!1;const d=pw(a);return(d===null||d===Object.prototype||Object.getPrototypeOf(d)===null)&&!(BP in a)&&!(av in a)},YD=a=>{if(!O_(a)||R_(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},JD=Ac("Date"),QD=Ac("File"),ez=Ac("Blob"),tz=Ac("FileList"),iz=a=>O_(a)&&ul(a.pipe),nz=a=>{let d;return a&&(typeof FormData=="function"&&a instanceof FormData||ul(a.append)&&((d=lv(a))==="formdata"||d==="object"&&ul(a.toString)&&a.toString()==="[object FormData]"))},rz=Ac("URLSearchParams"),[sz,oz,az,lz]=["ReadableStream","Request","Response","Headers"].map(Ac),cz=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function L_(a,d,{allOwnKeys:y=!1}={}){if(a===null||typeof a>"u")return;let S,P;if(typeof a!="object"&&(a=[a]),vp(a))for(S=0,P=a.length;S<P;S++)d.call(null,a[S],S,a);else{if(R_(a))return;const M=y?Object.getOwnPropertyNames(a):Object.keys(a),k=M.length;let r;for(S=0;S<k;S++)r=M[S],d.call(null,a[r],r,a)}}function VP(a,d){if(R_(a))return null;d=d.toLowerCase();const y=Object.keys(a);let S=y.length,P;for(;S-- >0;)if(P=y[S],d===P.toLowerCase())return P;return null}const Cd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,jP=a=>!fp(a)&&a!==Cd;function kb(){const{caseless:a,skipUndefined:d}=jP(this)&&this||{},y={},S=(P,M)=>{const k=a&&VP(y,M)||M;Py(y[k])&&Py(P)?y[k]=kb(y[k],P):Py(P)?y[k]=kb({},P):vp(P)?y[k]=P.slice():(!d||!fp(P))&&(y[k]=P)};for(let P=0,M=arguments.length;P<M;P++)arguments[P]&&L_(arguments[P],S);return y}const uz=(a,d,y,{allOwnKeys:S}={})=>(L_(d,(P,M)=>{y&&ul(P)?a[M]=FP(P,y):a[M]=P},{allOwnKeys:S}),a),hz=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),dz=(a,d,y,S)=>{a.prototype=Object.create(d.prototype,S),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:d.prototype}),y&&Object.assign(a.prototype,y)},fz=(a,d,y,S)=>{let P,M,k;const r={};if(d=d||{},a==null)return d;do{for(P=Object.getOwnPropertyNames(a),M=P.length;M-- >0;)k=P[M],(!S||S(k,a,d))&&!r[k]&&(d[k]=a[k],r[k]=!0);a=y!==!1&&pw(a)}while(a&&(!y||y(a,d))&&a!==Object.prototype);return d},pz=(a,d,y)=>{a=String(a),(y===void 0||y>a.length)&&(y=a.length),y-=d.length;const S=a.indexOf(d,y);return S!==-1&&S===y},mz=a=>{if(!a)return null;if(vp(a))return a;let d=a.length;if(!UP(d))return null;const y=new Array(d);for(;d-- >0;)y[d]=a[d];return y},_z=(a=>d=>a&&d instanceof a)(typeof Uint8Array<"u"&&pw(Uint8Array)),gz=(a,d)=>{const S=(a&&a[av]).call(a);let P;for(;(P=S.next())&&!P.done;){const M=P.value;d.call(a,M[0],M[1])}},yz=(a,d)=>{let y;const S=[];for(;(y=a.exec(d))!==null;)S.push(y);return S},vz=Ac("HTMLFormElement"),xz=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(y,S,P){return S.toUpperCase()+P}),ZE=(({hasOwnProperty:a})=>(d,y)=>a.call(d,y))(Object.prototype),bz=Ac("RegExp"),$P=(a,d)=>{const y=Object.getOwnPropertyDescriptors(a),S={};L_(y,(P,M)=>{let k;(k=d(P,M,a))!==!1&&(S[M]=k||P)}),Object.defineProperties(a,S)},wz=a=>{$P(a,(d,y)=>{if(ul(a)&&["arguments","caller","callee"].indexOf(y)!==-1)return!1;const S=a[y];if(ul(S)){if(d.enumerable=!1,"writable"in d){d.writable=!1;return}d.set||(d.set=()=>{throw Error("Can not rewrite read-only method '"+y+"'")})}})},Tz=(a,d)=>{const y={},S=P=>{P.forEach(M=>{y[M]=!0})};return vp(a)?S(a):S(String(a).split(d)),y},Sz=()=>{},Ez=(a,d)=>a!=null&&Number.isFinite(a=+a)?a:d;function Az(a){return!!(a&&ul(a.append)&&a[BP]==="FormData"&&a[av])}const Iz=a=>{const d=new Array(10),y=(S,P)=>{if(O_(S)){if(d.indexOf(S)>=0)return;if(R_(S))return S;if(!("toJSON"in S)){d[P]=S;const M=vp(S)?[]:{};return L_(S,(k,r)=>{const j=y(k,P+1);!fp(j)&&(M[r]=j)}),d[P]=void 0,M}}return S};return y(a,0)},Pz=Ac("AsyncFunction"),Cz=a=>a&&(O_(a)||ul(a))&&ul(a.then)&&ul(a.catch),qP=((a,d)=>a?setImmediate:d?((y,S)=>(Cd.addEventListener("message",({source:P,data:M})=>{P===Cd&&M===y&&S.length&&S.shift()()},!1),P=>{S.push(P),Cd.postMessage(y,"*")}))(`axios@${Math.random()}`,[]):y=>setTimeout(y))(typeof setImmediate=="function",ul(Cd.postMessage)),Mz=typeof queueMicrotask<"u"?queueMicrotask.bind(Cd):typeof process<"u"&&process.nextTick||qP,Rz=a=>a!=null&&ul(a[av]),ti={isArray:vp,isArrayBuffer:NP,isBuffer:R_,isFormData:nz,isArrayBufferView:WD,isString:XD,isNumber:UP,isBoolean:KD,isObject:O_,isPlainObject:Py,isEmptyObject:YD,isReadableStream:sz,isRequest:oz,isResponse:az,isHeaders:lz,isUndefined:fp,isDate:JD,isFile:QD,isBlob:ez,isRegExp:bz,isFunction:ul,isStream:iz,isURLSearchParams:rz,isTypedArray:_z,isFileList:tz,forEach:L_,merge:kb,extend:uz,trim:cz,stripBOM:hz,inherits:dz,toFlatObject:fz,kindOf:lv,kindOfTest:Ac,endsWith:pz,toArray:mz,forEachEntry:gz,matchAll:yz,isHTMLForm:vz,hasOwnProperty:ZE,hasOwnProp:ZE,reduceDescriptors:$P,freezeMethods:wz,toObjectSet:Tz,toCamelCase:xz,noop:Sz,toFiniteNumber:Ez,findKey:VP,global:Cd,isContextDefined:jP,isSpecCompliantForm:Az,toJSONObject:Iz,isAsyncFn:Pz,isThenable:Cz,setImmediate:qP,asap:Mz,isIterable:Rz};function Lr(a,d,y,S,P){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",d&&(this.code=d),y&&(this.config=y),S&&(this.request=S),P&&(this.response=P,this.status=P.status?P.status:null)}ti.inherits(Lr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ti.toJSONObject(this.config),code:this.code,status:this.status}}});const GP=Lr.prototype,HP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{HP[a]={value:a}});Object.defineProperties(Lr,HP);Object.defineProperty(GP,"isAxiosError",{value:!0});Lr.from=(a,d,y,S,P,M)=>{const k=Object.create(GP);ti.toFlatObject(a,k,function(W){return W!==Error.prototype},H=>H!=="isAxiosError");const r=a&&a.message?a.message:"Error",j=d==null&&a?a.code:d;return Lr.call(k,r,j,y,S,P),a&&k.cause==null&&Object.defineProperty(k,"cause",{value:a,configurable:!0}),k.name=a&&a.name||"Error",M&&Object.assign(k,M),k};const Oz=null;function Fb(a){return ti.isPlainObject(a)||ti.isArray(a)}function ZP(a){return ti.endsWith(a,"[]")?a.slice(0,-2):a}function WE(a,d,y){return a?a.concat(d).map(function(P,M){return P=ZP(P),!y&&M?"["+P+"]":P}).join(y?".":""):d}function Lz(a){return ti.isArray(a)&&!a.some(Fb)}const Dz=ti.toFlatObject(ti,{},null,function(d){return/^is[A-Z]/.test(d)});function uv(a,d,y){if(!ti.isObject(a))throw new TypeError("target must be an object");d=d||new FormData,y=ti.toFlatObject(y,{metaTokens:!0,dots:!1,indexes:!1},!1,function(he,Te){return!ti.isUndefined(Te[he])});const S=y.metaTokens,P=y.visitor||W,M=y.dots,k=y.indexes,j=(y.Blob||typeof Blob<"u"&&Blob)&&ti.isSpecCompliantForm(d);if(!ti.isFunction(P))throw new TypeError("visitor must be a function");function H(se){if(se===null)return"";if(ti.isDate(se))return se.toISOString();if(ti.isBoolean(se))return se.toString();if(!j&&ti.isBlob(se))throw new Lr("Blob is not supported. Use a Buffer instead.");return ti.isArrayBuffer(se)||ti.isTypedArray(se)?j&&typeof Blob=="function"?new Blob([se]):Buffer.from(se):se}function W(se,he,Te){let Se=se;if(se&&!Te&&typeof se=="object"){if(ti.endsWith(he,"{}"))he=S?he:he.slice(0,-2),se=JSON.stringify(se);else if(ti.isArray(se)&&Lz(se)||(ti.isFileList(se)||ti.endsWith(he,"[]"))&&(Se=ti.toArray(se)))return he=ZP(he),Se.forEach(function(oe,ge){!(ti.isUndefined(oe)||oe===null)&&d.append(k===!0?WE([he],ge,M):k===null?he:he+"[]",H(oe))}),!1}return Fb(se)?!0:(d.append(WE(Te,he,M),H(se)),!1)}const ee=[],le=Object.assign(Dz,{defaultVisitor:W,convertValue:H,isVisitable:Fb});function pe(se,he){if(!ti.isUndefined(se)){if(ee.indexOf(se)!==-1)throw Error("Circular reference detected in "+he.join("."));ee.push(se),ti.forEach(se,function(Se,fe){(!(ti.isUndefined(Se)||Se===null)&&P.call(d,Se,ti.isString(fe)?fe.trim():fe,he,le))===!0&&pe(Se,he?he.concat(fe):[fe])}),ee.pop()}}if(!ti.isObject(a))throw new TypeError("data must be an object");return pe(a),d}function XE(a){const d={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(S){return d[S]})}function mw(a,d){this._pairs=[],a&&uv(a,this,d)}const WP=mw.prototype;WP.append=function(d,y){this._pairs.push([d,y])};WP.toString=function(d){const y=d?function(S){return d.call(this,S,XE)}:XE;return this._pairs.map(function(P){return y(P[0])+"="+y(P[1])},"").join("&")};function zz(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function XP(a,d,y){if(!d)return a;const S=y&&y.encode||zz;ti.isFunction(y)&&(y={serialize:y});const P=y&&y.serialize;let M;if(P?M=P(d,y):M=ti.isURLSearchParams(d)?d.toString():new mw(d,y).toString(S),M){const k=a.indexOf("#");k!==-1&&(a=a.slice(0,k)),a+=(a.indexOf("?")===-1?"?":"&")+M}return a}class KE{constructor(){this.handlers=[]}use(d,y,S){return this.handlers.push({fulfilled:d,rejected:y,synchronous:S?S.synchronous:!1,runWhen:S?S.runWhen:null}),this.handlers.length-1}eject(d){this.handlers[d]&&(this.handlers[d]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(d){ti.forEach(this.handlers,function(S){S!==null&&d(S)})}}const KP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},kz=typeof URLSearchParams<"u"?URLSearchParams:mw,Fz=typeof FormData<"u"?FormData:null,Bz=typeof Blob<"u"?Blob:null,Nz={isBrowser:!0,classes:{URLSearchParams:kz,FormData:Fz,Blob:Bz},protocols:["http","https","file","blob","url","data"]},_w=typeof window<"u"&&typeof document<"u",Bb=typeof navigator=="object"&&navigator||void 0,Uz=_w&&(!Bb||["ReactNative","NativeScript","NS"].indexOf(Bb.product)<0),Vz=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jz=_w&&window.location.href||"http://localhost",$z=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:_w,hasStandardBrowserEnv:Uz,hasStandardBrowserWebWorkerEnv:Vz,navigator:Bb,origin:jz},Symbol.toStringTag,{value:"Module"})),Ua={...$z,...Nz};function qz(a,d){return uv(a,new Ua.classes.URLSearchParams,{visitor:function(y,S,P,M){return Ua.isNode&&ti.isBuffer(y)?(this.append(S,y.toString("base64")),!1):M.defaultVisitor.apply(this,arguments)},...d})}function Gz(a){return ti.matchAll(/\w+|\[(\w*)]/g,a).map(d=>d[0]==="[]"?"":d[1]||d[0])}function Hz(a){const d={},y=Object.keys(a);let S;const P=y.length;let M;for(S=0;S<P;S++)M=y[S],d[M]=a[M];return d}function YP(a){function d(y,S,P,M){let k=y[M++];if(k==="__proto__")return!0;const r=Number.isFinite(+k),j=M>=y.length;return k=!k&&ti.isArray(P)?P.length:k,j?(ti.hasOwnProp(P,k)?P[k]=[P[k],S]:P[k]=S,!r):((!P[k]||!ti.isObject(P[k]))&&(P[k]=[]),d(y,S,P[k],M)&&ti.isArray(P[k])&&(P[k]=Hz(P[k])),!r)}if(ti.isFormData(a)&&ti.isFunction(a.entries)){const y={};return ti.forEachEntry(a,(S,P)=>{d(Gz(S),P,y,0)}),y}return null}function Zz(a,d,y){if(ti.isString(a))try{return(d||JSON.parse)(a),ti.trim(a)}catch(S){if(S.name!=="SyntaxError")throw S}return(y||JSON.stringify)(a)}const D_={transitional:KP,adapter:["xhr","http","fetch"],transformRequest:[function(d,y){const S=y.getContentType()||"",P=S.indexOf("application/json")>-1,M=ti.isObject(d);if(M&&ti.isHTMLForm(d)&&(d=new FormData(d)),ti.isFormData(d))return P?JSON.stringify(YP(d)):d;if(ti.isArrayBuffer(d)||ti.isBuffer(d)||ti.isStream(d)||ti.isFile(d)||ti.isBlob(d)||ti.isReadableStream(d))return d;if(ti.isArrayBufferView(d))return d.buffer;if(ti.isURLSearchParams(d))return y.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),d.toString();let r;if(M){if(S.indexOf("application/x-www-form-urlencoded")>-1)return qz(d,this.formSerializer).toString();if((r=ti.isFileList(d))||S.indexOf("multipart/form-data")>-1){const j=this.env&&this.env.FormData;return uv(r?{"files[]":d}:d,j&&new j,this.formSerializer)}}return M||P?(y.setContentType("application/json",!1),Zz(d)):d}],transformResponse:[function(d){const y=this.transitional||D_.transitional,S=y&&y.forcedJSONParsing,P=this.responseType==="json";if(ti.isResponse(d)||ti.isReadableStream(d))return d;if(d&&ti.isString(d)&&(S&&!this.responseType||P)){const k=!(y&&y.silentJSONParsing)&&P;try{return JSON.parse(d,this.parseReviver)}catch(r){if(k)throw r.name==="SyntaxError"?Lr.from(r,Lr.ERR_BAD_RESPONSE,this,null,this.response):r}}return d}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ua.classes.FormData,Blob:Ua.classes.Blob},validateStatus:function(d){return d>=200&&d<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ti.forEach(["delete","get","head","post","put","patch"],a=>{D_.headers[a]={}});const Wz=ti.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Xz=a=>{const d={};let y,S,P;return a&&a.split(`
`).forEach(function(k){P=k.indexOf(":"),y=k.substring(0,P).trim().toLowerCase(),S=k.substring(P+1).trim(),!(!y||d[y]&&Wz[y])&&(y==="set-cookie"?d[y]?d[y].push(S):d[y]=[S]:d[y]=d[y]?d[y]+", "+S:S)}),d},YE=Symbol("internals");function Qm(a){return a&&String(a).trim().toLowerCase()}function Cy(a){return a===!1||a==null?a:ti.isArray(a)?a.map(Cy):String(a)}function Kz(a){const d=Object.create(null),y=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let S;for(;S=y.exec(a);)d[S[1]]=S[2];return d}const Yz=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function g0(a,d,y,S,P){if(ti.isFunction(S))return S.call(this,d,y);if(P&&(d=y),!!ti.isString(d)){if(ti.isString(S))return d.indexOf(S)!==-1;if(ti.isRegExp(S))return S.test(d)}}function Jz(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(d,y,S)=>y.toUpperCase()+S)}function Qz(a,d){const y=ti.toCamelCase(" "+d);["get","set","has"].forEach(S=>{Object.defineProperty(a,S+y,{value:function(P,M,k){return this[S].call(this,d,P,M,k)},configurable:!0})})}let hl=class{constructor(d){d&&this.set(d)}set(d,y,S){const P=this;function M(r,j,H){const W=Qm(j);if(!W)throw new Error("header name must be a non-empty string");const ee=ti.findKey(P,W);(!ee||P[ee]===void 0||H===!0||H===void 0&&P[ee]!==!1)&&(P[ee||j]=Cy(r))}const k=(r,j)=>ti.forEach(r,(H,W)=>M(H,W,j));if(ti.isPlainObject(d)||d instanceof this.constructor)k(d,y);else if(ti.isString(d)&&(d=d.trim())&&!Yz(d))k(Xz(d),y);else if(ti.isObject(d)&&ti.isIterable(d)){let r={},j,H;for(const W of d){if(!ti.isArray(W))throw TypeError("Object iterator must return a key-value pair");r[H=W[0]]=(j=r[H])?ti.isArray(j)?[...j,W[1]]:[j,W[1]]:W[1]}k(r,y)}else d!=null&&M(y,d,S);return this}get(d,y){if(d=Qm(d),d){const S=ti.findKey(this,d);if(S){const P=this[S];if(!y)return P;if(y===!0)return Kz(P);if(ti.isFunction(y))return y.call(this,P,S);if(ti.isRegExp(y))return y.exec(P);throw new TypeError("parser must be boolean|regexp|function")}}}has(d,y){if(d=Qm(d),d){const S=ti.findKey(this,d);return!!(S&&this[S]!==void 0&&(!y||g0(this,this[S],S,y)))}return!1}delete(d,y){const S=this;let P=!1;function M(k){if(k=Qm(k),k){const r=ti.findKey(S,k);r&&(!y||g0(S,S[r],r,y))&&(delete S[r],P=!0)}}return ti.isArray(d)?d.forEach(M):M(d),P}clear(d){const y=Object.keys(this);let S=y.length,P=!1;for(;S--;){const M=y[S];(!d||g0(this,this[M],M,d,!0))&&(delete this[M],P=!0)}return P}normalize(d){const y=this,S={};return ti.forEach(this,(P,M)=>{const k=ti.findKey(S,M);if(k){y[k]=Cy(P),delete y[M];return}const r=d?Jz(M):String(M).trim();r!==M&&delete y[M],y[r]=Cy(P),S[r]=!0}),this}concat(...d){return this.constructor.concat(this,...d)}toJSON(d){const y=Object.create(null);return ti.forEach(this,(S,P)=>{S!=null&&S!==!1&&(y[P]=d&&ti.isArray(S)?S.join(", "):S)}),y}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([d,y])=>d+": "+y).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(d){return d instanceof this?d:new this(d)}static concat(d,...y){const S=new this(d);return y.forEach(P=>S.set(P)),S}static accessor(d){const S=(this[YE]=this[YE]={accessors:{}}).accessors,P=this.prototype;function M(k){const r=Qm(k);S[r]||(Qz(P,k),S[r]=!0)}return ti.isArray(d)?d.forEach(M):M(d),this}};hl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ti.reduceDescriptors(hl.prototype,({value:a},d)=>{let y=d[0].toUpperCase()+d.slice(1);return{get:()=>a,set(S){this[y]=S}}});ti.freezeMethods(hl);function y0(a,d){const y=this||D_,S=d||y,P=hl.from(S.headers);let M=S.data;return ti.forEach(a,function(r){M=r.call(y,M,P.normalize(),d?d.status:void 0)}),P.normalize(),M}function JP(a){return!!(a&&a.__CANCEL__)}function xp(a,d,y){Lr.call(this,a??"canceled",Lr.ERR_CANCELED,d,y),this.name="CanceledError"}ti.inherits(xp,Lr,{__CANCEL__:!0});function QP(a,d,y){const S=y.config.validateStatus;!y.status||!S||S(y.status)?a(y):d(new Lr("Request failed with status code "+y.status,[Lr.ERR_BAD_REQUEST,Lr.ERR_BAD_RESPONSE][Math.floor(y.status/100)-4],y.config,y.request,y))}function ek(a){const d=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return d&&d[1]||""}function tk(a,d){a=a||10;const y=new Array(a),S=new Array(a);let P=0,M=0,k;return d=d!==void 0?d:1e3,function(j){const H=Date.now(),W=S[M];k||(k=H),y[P]=j,S[P]=H;let ee=M,le=0;for(;ee!==P;)le+=y[ee++],ee=ee%a;if(P=(P+1)%a,P===M&&(M=(M+1)%a),H-k<d)return;const pe=W&&H-W;return pe?Math.round(le*1e3/pe):void 0}}function ik(a,d){let y=0,S=1e3/d,P,M;const k=(H,W=Date.now())=>{y=W,P=null,M&&(clearTimeout(M),M=null),a(...H)};return[(...H)=>{const W=Date.now(),ee=W-y;ee>=S?k(H,W):(P=H,M||(M=setTimeout(()=>{M=null,k(P)},S-ee)))},()=>P&&k(P)]}const Uy=(a,d,y=3)=>{let S=0;const P=tk(50,250);return ik(M=>{const k=M.loaded,r=M.lengthComputable?M.total:void 0,j=k-S,H=P(j),W=k<=r;S=k;const ee={loaded:k,total:r,progress:r?k/r:void 0,bytes:j,rate:H||void 0,estimated:H&&r&&W?(r-k)/H:void 0,event:M,lengthComputable:r!=null,[d?"download":"upload"]:!0};a(ee)},y)},JE=(a,d)=>{const y=a!=null;return[S=>d[0]({lengthComputable:y,total:a,loaded:S}),d[1]]},QE=a=>(...d)=>ti.asap(()=>a(...d)),nk=Ua.hasStandardBrowserEnv?((a,d)=>y=>(y=new URL(y,Ua.origin),a.protocol===y.protocol&&a.host===y.host&&(d||a.port===y.port)))(new URL(Ua.origin),Ua.navigator&&/(msie|trident)/i.test(Ua.navigator.userAgent)):()=>!0,rk=Ua.hasStandardBrowserEnv?{write(a,d,y,S,P,M){const k=[a+"="+encodeURIComponent(d)];ti.isNumber(y)&&k.push("expires="+new Date(y).toGMTString()),ti.isString(S)&&k.push("path="+S),ti.isString(P)&&k.push("domain="+P),M===!0&&k.push("secure"),document.cookie=k.join("; ")},read(a){const d=document.cookie.match(new RegExp("(^|;\\s*)("+a+")=([^;]*)"));return d?decodeURIComponent(d[3]):null},remove(a){this.write(a,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function sk(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function ok(a,d){return d?a.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):a}function e2(a,d,y){let S=!sk(d);return a&&(S||y==!1)?ok(a,d):d}const eA=a=>a instanceof hl?{...a}:a;function Nd(a,d){d=d||{};const y={};function S(H,W,ee,le){return ti.isPlainObject(H)&&ti.isPlainObject(W)?ti.merge.call({caseless:le},H,W):ti.isPlainObject(W)?ti.merge({},W):ti.isArray(W)?W.slice():W}function P(H,W,ee,le){if(ti.isUndefined(W)){if(!ti.isUndefined(H))return S(void 0,H,ee,le)}else return S(H,W,ee,le)}function M(H,W){if(!ti.isUndefined(W))return S(void 0,W)}function k(H,W){if(ti.isUndefined(W)){if(!ti.isUndefined(H))return S(void 0,H)}else return S(void 0,W)}function r(H,W,ee){if(ee in d)return S(H,W);if(ee in a)return S(void 0,H)}const j={url:M,method:M,data:M,baseURL:k,transformRequest:k,transformResponse:k,paramsSerializer:k,timeout:k,timeoutMessage:k,withCredentials:k,withXSRFToken:k,adapter:k,responseType:k,xsrfCookieName:k,xsrfHeaderName:k,onUploadProgress:k,onDownloadProgress:k,decompress:k,maxContentLength:k,maxBodyLength:k,beforeRedirect:k,transport:k,httpAgent:k,httpsAgent:k,cancelToken:k,socketPath:k,responseEncoding:k,validateStatus:r,headers:(H,W,ee)=>P(eA(H),eA(W),ee,!0)};return ti.forEach(Object.keys({...a,...d}),function(W){const ee=j[W]||P,le=ee(a[W],d[W],W);ti.isUndefined(le)&&ee!==r||(y[W]=le)}),y}const t2=a=>{const d=Nd({},a);let{data:y,withXSRFToken:S,xsrfHeaderName:P,xsrfCookieName:M,headers:k,auth:r}=d;if(d.headers=k=hl.from(k),d.url=XP(e2(d.baseURL,d.url,d.allowAbsoluteUrls),a.params,a.paramsSerializer),r&&k.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):""))),ti.isFormData(y)){if(Ua.hasStandardBrowserEnv||Ua.hasStandardBrowserWebWorkerEnv)k.setContentType(void 0);else if(ti.isFunction(y.getHeaders)){const j=y.getHeaders(),H=["content-type","content-length"];Object.entries(j).forEach(([W,ee])=>{H.includes(W.toLowerCase())&&k.set(W,ee)})}}if(Ua.hasStandardBrowserEnv&&(S&&ti.isFunction(S)&&(S=S(d)),S||S!==!1&&nk(d.url))){const j=P&&M&&rk.read(M);j&&k.set(P,j)}return d},ak=typeof XMLHttpRequest<"u",lk=ak&&function(a){return new Promise(function(y,S){const P=t2(a);let M=P.data;const k=hl.from(P.headers).normalize();let{responseType:r,onUploadProgress:j,onDownloadProgress:H}=P,W,ee,le,pe,se;function he(){pe&&pe(),se&&se(),P.cancelToken&&P.cancelToken.unsubscribe(W),P.signal&&P.signal.removeEventListener("abort",W)}let Te=new XMLHttpRequest;Te.open(P.method.toUpperCase(),P.url,!0),Te.timeout=P.timeout;function Se(){if(!Te)return;const oe=hl.from("getAllResponseHeaders"in Te&&Te.getAllResponseHeaders()),Ge={data:!r||r==="text"||r==="json"?Te.responseText:Te.response,status:Te.status,statusText:Te.statusText,headers:oe,config:a,request:Te};QP(function(It){y(It),he()},function(It){S(It),he()},Ge),Te=null}"onloadend"in Te?Te.onloadend=Se:Te.onreadystatechange=function(){!Te||Te.readyState!==4||Te.status===0&&!(Te.responseURL&&Te.responseURL.indexOf("file:")===0)||setTimeout(Se)},Te.onabort=function(){Te&&(S(new Lr("Request aborted",Lr.ECONNABORTED,a,Te)),Te=null)},Te.onerror=function(ge){const Ge=ge&&ge.message?ge.message:"Network Error",xt=new Lr(Ge,Lr.ERR_NETWORK,a,Te);xt.event=ge||null,S(xt),Te=null},Te.ontimeout=function(){let ge=P.timeout?"timeout of "+P.timeout+"ms exceeded":"timeout exceeded";const Ge=P.transitional||KP;P.timeoutErrorMessage&&(ge=P.timeoutErrorMessage),S(new Lr(ge,Ge.clarifyTimeoutError?Lr.ETIMEDOUT:Lr.ECONNABORTED,a,Te)),Te=null},M===void 0&&k.setContentType(null),"setRequestHeader"in Te&&ti.forEach(k.toJSON(),function(ge,Ge){Te.setRequestHeader(Ge,ge)}),ti.isUndefined(P.withCredentials)||(Te.withCredentials=!!P.withCredentials),r&&r!=="json"&&(Te.responseType=P.responseType),H&&([le,se]=Uy(H,!0),Te.addEventListener("progress",le)),j&&Te.upload&&([ee,pe]=Uy(j),Te.upload.addEventListener("progress",ee),Te.upload.addEventListener("loadend",pe)),(P.cancelToken||P.signal)&&(W=oe=>{Te&&(S(!oe||oe.type?new xp(null,a,Te):oe),Te.abort(),Te=null)},P.cancelToken&&P.cancelToken.subscribe(W),P.signal&&(P.signal.aborted?W():P.signal.addEventListener("abort",W)));const fe=ek(P.url);if(fe&&Ua.protocols.indexOf(fe)===-1){S(new Lr("Unsupported protocol "+fe+":",Lr.ERR_BAD_REQUEST,a));return}Te.send(M||null)})},ck=(a,d)=>{const{length:y}=a=a?a.filter(Boolean):[];if(d||y){let S=new AbortController,P;const M=function(H){if(!P){P=!0,r();const W=H instanceof Error?H:this.reason;S.abort(W instanceof Lr?W:new xp(W instanceof Error?W.message:W))}};let k=d&&setTimeout(()=>{k=null,M(new Lr(`timeout ${d} of ms exceeded`,Lr.ETIMEDOUT))},d);const r=()=>{a&&(k&&clearTimeout(k),k=null,a.forEach(H=>{H.unsubscribe?H.unsubscribe(M):H.removeEventListener("abort",M)}),a=null)};a.forEach(H=>H.addEventListener("abort",M));const{signal:j}=S;return j.unsubscribe=()=>ti.asap(r),j}},uk=function*(a,d){let y=a.byteLength;if(y<d){yield a;return}let S=0,P;for(;S<y;)P=S+d,yield a.slice(S,P),S=P},hk=async function*(a,d){for await(const y of dk(a))yield*uk(y,d)},dk=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const d=a.getReader();try{for(;;){const{done:y,value:S}=await d.read();if(y)break;yield S}}finally{await d.cancel()}},tA=(a,d,y,S)=>{const P=hk(a,d);let M=0,k,r=j=>{k||(k=!0,S&&S(j))};return new ReadableStream({async pull(j){try{const{done:H,value:W}=await P.next();if(H){r(),j.close();return}let ee=W.byteLength;if(y){let le=M+=ee;y(le)}j.enqueue(new Uint8Array(W))}catch(H){throw r(H),H}},cancel(j){return r(j),P.return()}},{highWaterMark:2})},iA=64*1024,{isFunction:py}=ti,fk=(({Request:a,Response:d})=>({Request:a,Response:d}))(ti.global),{ReadableStream:nA,TextEncoder:rA}=ti.global,sA=(a,...d)=>{try{return!!a(...d)}catch{return!1}},pk=a=>{a=ti.merge.call({skipUndefined:!0},fk,a);const{fetch:d,Request:y,Response:S}=a,P=d?py(d):typeof fetch=="function",M=py(y),k=py(S);if(!P)return!1;const r=P&&py(nA),j=P&&(typeof rA=="function"?(se=>he=>se.encode(he))(new rA):async se=>new Uint8Array(await new y(se).arrayBuffer())),H=M&&r&&sA(()=>{let se=!1;const he=new y(Ua.origin,{body:new nA,method:"POST",get duplex(){return se=!0,"half"}}).headers.has("Content-Type");return se&&!he}),W=k&&r&&sA(()=>ti.isReadableStream(new S("").body)),ee={stream:W&&(se=>se.body)};P&&["text","arrayBuffer","blob","formData","stream"].forEach(se=>{!ee[se]&&(ee[se]=(he,Te)=>{let Se=he&&he[se];if(Se)return Se.call(he);throw new Lr(`Response type '${se}' is not supported`,Lr.ERR_NOT_SUPPORT,Te)})});const le=async se=>{if(se==null)return 0;if(ti.isBlob(se))return se.size;if(ti.isSpecCompliantForm(se))return(await new y(Ua.origin,{method:"POST",body:se}).arrayBuffer()).byteLength;if(ti.isArrayBufferView(se)||ti.isArrayBuffer(se))return se.byteLength;if(ti.isURLSearchParams(se)&&(se=se+""),ti.isString(se))return(await j(se)).byteLength},pe=async(se,he)=>{const Te=ti.toFiniteNumber(se.getContentLength());return Te??le(he)};return async se=>{let{url:he,method:Te,data:Se,signal:fe,cancelToken:oe,timeout:ge,onDownloadProgress:Ge,onUploadProgress:xt,responseType:It,headers:ot,withCredentials:Be="same-origin",fetchOptions:De}=t2(se),Oe=d||fetch;It=It?(It+"").toLowerCase():"text";let He=ck([fe,oe&&oe.toAbortSignal()],ge),ft=null;const tt=He&&He.unsubscribe&&(()=>{He.unsubscribe()});let At;try{if(xt&&H&&Te!=="get"&&Te!=="head"&&(At=await pe(ot,Se))!==0){let di=new y(he,{method:"POST",body:Se,duplex:"half"}),ki;if(ti.isFormData(Se)&&(ki=di.headers.get("content-type"))&&ot.setContentType(ki),di.body){const[dn,an]=JE(At,Uy(QE(xt)));Se=tA(di.body,iA,dn,an)}}ti.isString(Be)||(Be=Be?"include":"omit");const yt=M&&"credentials"in y.prototype,si={...De,signal:He,method:Te.toUpperCase(),headers:ot.normalize().toJSON(),body:Se,duplex:"half",credentials:yt?Be:void 0};ft=M&&new y(he,si);let wt=await(M?Oe(ft,De):Oe(he,si));const Gi=W&&(It==="stream"||It==="response");if(W&&(Ge||Gi&&tt)){const di={};["status","statusText","headers"].forEach(mt=>{di[mt]=wt[mt]});const ki=ti.toFiniteNumber(wt.headers.get("content-length")),[dn,an]=Ge&&JE(ki,Uy(QE(Ge),!0))||[];wt=new S(tA(wt.body,iA,dn,()=>{an&&an(),tt&&tt()}),di)}It=It||"text";let Ti=await ee[ti.findKey(ee,It)||"text"](wt,se);return!Gi&&tt&&tt(),await new Promise((di,ki)=>{QP(di,ki,{data:Ti,headers:hl.from(wt.headers),status:wt.status,statusText:wt.statusText,config:se,request:ft})})}catch(yt){throw tt&&tt(),yt&&yt.name==="TypeError"&&/Load failed|fetch/i.test(yt.message)?Object.assign(new Lr("Network Error",Lr.ERR_NETWORK,se,ft),{cause:yt.cause||yt}):Lr.from(yt,yt&&yt.code,se,ft)}}},mk=new Map,i2=a=>{let d=a?a.env:{};const{fetch:y,Request:S,Response:P}=d,M=[S,P,y];let k=M.length,r=k,j,H,W=mk;for(;r--;)j=M[r],H=W.get(j),H===void 0&&W.set(j,H=r?new Map:pk(d)),W=H;return H};i2();const Nb={http:Oz,xhr:lk,fetch:{get:i2}};ti.forEach(Nb,(a,d)=>{if(a){try{Object.defineProperty(a,"name",{value:d})}catch{}Object.defineProperty(a,"adapterName",{value:d})}});const oA=a=>`- ${a}`,_k=a=>ti.isFunction(a)||a===null||a===!1,n2={getAdapter:(a,d)=>{a=ti.isArray(a)?a:[a];const{length:y}=a;let S,P;const M={};for(let k=0;k<y;k++){S=a[k];let r;if(P=S,!_k(S)&&(P=Nb[(r=String(S)).toLowerCase()],P===void 0))throw new Lr(`Unknown adapter '${r}'`);if(P&&(ti.isFunction(P)||(P=P.get(d))))break;M[r||"#"+k]=P}if(!P){const k=Object.entries(M).map(([j,H])=>`adapter ${j} `+(H===!1?"is not supported by the environment":"is not available in the build"));let r=y?k.length>1?`since :
`+k.map(oA).join(`
`):" "+oA(k[0]):"as no adapter specified";throw new Lr("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return P},adapters:Nb};function v0(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new xp(null,a)}function aA(a){return v0(a),a.headers=hl.from(a.headers),a.data=y0.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),n2.getAdapter(a.adapter||D_.adapter,a)(a).then(function(S){return v0(a),S.data=y0.call(a,a.transformResponse,S),S.headers=hl.from(S.headers),S},function(S){return JP(S)||(v0(a),S&&S.response&&(S.response.data=y0.call(a,a.transformResponse,S.response),S.response.headers=hl.from(S.response.headers))),Promise.reject(S)})}const r2="1.12.2",hv={};["object","boolean","number","function","string","symbol"].forEach((a,d)=>{hv[a]=function(S){return typeof S===a||"a"+(d<1?"n ":" ")+a}});const lA={};hv.transitional=function(d,y,S){function P(M,k){return"[Axios v"+r2+"] Transitional option '"+M+"'"+k+(S?". "+S:"")}return(M,k,r)=>{if(d===!1)throw new Lr(P(k," has been removed"+(y?" in "+y:"")),Lr.ERR_DEPRECATED);return y&&!lA[k]&&(lA[k]=!0,console.warn(P(k," has been deprecated since v"+y+" and will be removed in the near future"))),d?d(M,k,r):!0}};hv.spelling=function(d){return(y,S)=>(console.warn(`${S} is likely a misspelling of ${d}`),!0)};function gk(a,d,y){if(typeof a!="object")throw new Lr("options must be an object",Lr.ERR_BAD_OPTION_VALUE);const S=Object.keys(a);let P=S.length;for(;P-- >0;){const M=S[P],k=d[M];if(k){const r=a[M],j=r===void 0||k(r,M,a);if(j!==!0)throw new Lr("option "+M+" must be "+j,Lr.ERR_BAD_OPTION_VALUE);continue}if(y!==!0)throw new Lr("Unknown option "+M,Lr.ERR_BAD_OPTION)}}const My={assertOptions:gk,validators:hv},Wc=My.validators;let Ld=class{constructor(d){this.defaults=d||{},this.interceptors={request:new KE,response:new KE}}async request(d,y){try{return await this._request(d,y)}catch(S){if(S instanceof Error){let P={};Error.captureStackTrace?Error.captureStackTrace(P):P=new Error;const M=P.stack?P.stack.replace(/^.+\n/,""):"";try{S.stack?M&&!String(S.stack).endsWith(M.replace(/^.+\n.+\n/,""))&&(S.stack+=`
`+M):S.stack=M}catch{}}throw S}}_request(d,y){typeof d=="string"?(y=y||{},y.url=d):y=d||{},y=Nd(this.defaults,y);const{transitional:S,paramsSerializer:P,headers:M}=y;S!==void 0&&My.assertOptions(S,{silentJSONParsing:Wc.transitional(Wc.boolean),forcedJSONParsing:Wc.transitional(Wc.boolean),clarifyTimeoutError:Wc.transitional(Wc.boolean)},!1),P!=null&&(ti.isFunction(P)?y.paramsSerializer={serialize:P}:My.assertOptions(P,{encode:Wc.function,serialize:Wc.function},!0)),y.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?y.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:y.allowAbsoluteUrls=!0),My.assertOptions(y,{baseUrl:Wc.spelling("baseURL"),withXsrfToken:Wc.spelling("withXSRFToken")},!0),y.method=(y.method||this.defaults.method||"get").toLowerCase();let k=M&&ti.merge(M.common,M[y.method]);M&&ti.forEach(["delete","get","head","post","put","patch","common"],se=>{delete M[se]}),y.headers=hl.concat(k,M);const r=[];let j=!0;this.interceptors.request.forEach(function(he){typeof he.runWhen=="function"&&he.runWhen(y)===!1||(j=j&&he.synchronous,r.unshift(he.fulfilled,he.rejected))});const H=[];this.interceptors.response.forEach(function(he){H.push(he.fulfilled,he.rejected)});let W,ee=0,le;if(!j){const se=[aA.bind(this),void 0];for(se.unshift(...r),se.push(...H),le=se.length,W=Promise.resolve(y);ee<le;)W=W.then(se[ee++],se[ee++]);return W}le=r.length;let pe=y;for(;ee<le;){const se=r[ee++],he=r[ee++];try{pe=se(pe)}catch(Te){he.call(this,Te);break}}try{W=aA.call(this,pe)}catch(se){return Promise.reject(se)}for(ee=0,le=H.length;ee<le;)W=W.then(H[ee++],H[ee++]);return W}getUri(d){d=Nd(this.defaults,d);const y=e2(d.baseURL,d.url,d.allowAbsoluteUrls);return XP(y,d.params,d.paramsSerializer)}};ti.forEach(["delete","get","head","options"],function(d){Ld.prototype[d]=function(y,S){return this.request(Nd(S||{},{method:d,url:y,data:(S||{}).data}))}});ti.forEach(["post","put","patch"],function(d){function y(S){return function(M,k,r){return this.request(Nd(r||{},{method:d,headers:S?{"Content-Type":"multipart/form-data"}:{},url:M,data:k}))}}Ld.prototype[d]=y(),Ld.prototype[d+"Form"]=y(!0)});let yk=class s2{constructor(d){if(typeof d!="function")throw new TypeError("executor must be a function.");let y;this.promise=new Promise(function(M){y=M});const S=this;this.promise.then(P=>{if(!S._listeners)return;let M=S._listeners.length;for(;M-- >0;)S._listeners[M](P);S._listeners=null}),this.promise.then=P=>{let M;const k=new Promise(r=>{S.subscribe(r),M=r}).then(P);return k.cancel=function(){S.unsubscribe(M)},k},d(function(M,k,r){S.reason||(S.reason=new xp(M,k,r),y(S.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(d){if(this.reason){d(this.reason);return}this._listeners?this._listeners.push(d):this._listeners=[d]}unsubscribe(d){if(!this._listeners)return;const y=this._listeners.indexOf(d);y!==-1&&this._listeners.splice(y,1)}toAbortSignal(){const d=new AbortController,y=S=>{d.abort(S)};return this.subscribe(y),d.signal.unsubscribe=()=>this.unsubscribe(y),d.signal}static source(){let d;return{token:new s2(function(P){d=P}),cancel:d}}};function vk(a){return function(y){return a.apply(null,y)}}function xk(a){return ti.isObject(a)&&a.isAxiosError===!0}const Ub={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ub).forEach(([a,d])=>{Ub[d]=a});function o2(a){const d=new Ld(a),y=FP(Ld.prototype.request,d);return ti.extend(y,Ld.prototype,d,{allOwnKeys:!0}),ti.extend(y,d,null,{allOwnKeys:!0}),y.create=function(P){return o2(Nd(a,P))},y}const Io=o2(D_);Io.Axios=Ld;Io.CanceledError=xp;Io.CancelToken=yk;Io.isCancel=JP;Io.VERSION=r2;Io.toFormData=uv;Io.AxiosError=Lr;Io.Cancel=Io.CanceledError;Io.all=function(d){return Promise.all(d)};Io.spread=vk;Io.isAxiosError=xk;Io.mergeConfig=Nd;Io.AxiosHeaders=hl;Io.formToJSON=a=>YP(ti.isHTMLForm(a)?new FormData(a):a);Io.getAdapter=n2.getAdapter;Io.HttpStatusCode=Ub;Io.default=Io;const{Axios:a8,AxiosError:l8,CanceledError:c8,isCancel:u8,CancelToken:h8,VERSION:d8,all:f8,Cancel:p8,isAxiosError:m8,spread:_8,toFormData:g8,AxiosHeaders:y8,HttpStatusCode:v8,formToJSON:x8,getAdapter:b8,mergeConfig:w8}=Io;class gw{constructor(){this.notificationCreatedEvent=".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated"}listenForWhisper(d,y){return this.listen(".client-"+d,y)}notification(d){return this.listen(this.notificationCreatedEvent,d)}stopListeningForNotification(d){return this.stopListening(this.notificationCreatedEvent,d)}stopListeningForWhisper(d,y){return this.stopListening(".client-"+d,y)}}class a2{constructor(d){this.namespace=d}format(d){return[".","\\"].includes(d.charAt(0))?d.substring(1):(this.namespace&&(d=this.namespace+"."+d),d.replace(/\./g,"\\"))}setNamespace(d){this.namespace=d}}function bk(a){try{new a}catch(d){if(d instanceof Error&&d.message.includes("is not a constructor"))return!1}return!0}let yw=class extends gw{constructor(d,y,S){super(),this.name=y,this.pusher=d,this.options=S,this.eventFormatter=new a2(this.options.namespace),this.subscribe()}subscribe(){this.subscription=this.pusher.subscribe(this.name)}unsubscribe(){this.pusher.unsubscribe(this.name)}listen(d,y){return this.on(this.eventFormatter.format(d),y),this}listenToAll(d){return this.subscription.bind_global((y,S)=>{if(y.startsWith("pusher:"))return;let P=String(this.options.namespace??"").replace(/\./g,"\\"),M=y.startsWith(P)?y.substring(P.length+1):"."+y;d(M,S)}),this}stopListening(d,y){return y?this.subscription.unbind(this.eventFormatter.format(d),y):this.subscription.unbind(this.eventFormatter.format(d)),this}stopListeningToAll(d){return d?this.subscription.unbind_global(d):this.subscription.unbind_global(),this}subscribed(d){return this.on("pusher:subscription_succeeded",()=>{d()}),this}error(d){return this.on("pusher:subscription_error",y=>{d(y)}),this}on(d,y){return this.subscription.bind(d,y),this}};class l2 extends yw{whisper(d,y){return this.pusher.channels.channels[this.name].trigger(`client-${d}`,y),this}}class wk extends yw{whisper(d,y){return this.pusher.channels.channels[this.name].trigger(`client-${d}`,y),this}}class Tk extends l2{here(d){return this.on("pusher:subscription_succeeded",y=>{d(Object.keys(y.members).map(S=>y.members[S]))}),this}joining(d){return this.on("pusher:member_added",y=>{d(y.info)}),this}whisper(d,y){return this.pusher.channels.channels[this.name].trigger(`client-${d}`,y),this}leaving(d){return this.on("pusher:member_removed",y=>{d(y.info)}),this}}class c2 extends gw{constructor(d,y,S){super(),this.events={},this.listeners={},this.name=y,this.socket=d,this.options=S,this.eventFormatter=new a2(this.options.namespace),this.subscribe()}subscribe(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}unsubscribe(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}listen(d,y){return this.on(this.eventFormatter.format(d),y),this}stopListening(d,y){return this.unbindEvent(this.eventFormatter.format(d),y),this}subscribed(d){return this.on("connect",y=>{d(y)}),this}error(d){return this}on(d,y){return this.listeners[d]=this.listeners[d]||[],this.events[d]||(this.events[d]=(S,P)=>{this.name===S&&this.listeners[d]&&this.listeners[d].forEach(M=>M(P))},this.socket.on(d,this.events[d])),this.listeners[d].push(y),this}unbind(){Object.keys(this.events).forEach(d=>{this.unbindEvent(d)})}unbindEvent(d,y){this.listeners[d]=this.listeners[d]||[],y&&(this.listeners[d]=this.listeners[d].filter(S=>S!==y)),(!y||this.listeners[d].length===0)&&(this.events[d]&&(this.socket.removeListener(d,this.events[d]),delete this.events[d]),delete this.listeners[d])}}class u2 extends c2{whisper(d,y){return this.socket.emit("client event",{channel:this.name,event:`client-${d}`,data:y}),this}}class Sk extends u2{here(d){return this.on("presence:subscribed",y=>{d(y.map(S=>S.user_info))}),this}joining(d){return this.on("presence:joining",y=>d(y.user_info)),this}whisper(d,y){return this.socket.emit("client event",{channel:this.name,event:`client-${d}`,data:y}),this}leaving(d){return this.on("presence:leaving",y=>d(y.user_info)),this}}let Vy=class extends gw{subscribe(){}unsubscribe(){}listen(d,y){return this}listenToAll(d){return this}stopListening(d,y){return this}subscribed(d){return this}error(d){return this}on(d,y){return this}};class h2 extends Vy{whisper(d,y){return this}}class Ek extends Vy{whisper(d,y){return this}}class Ak extends h2{here(d){return this}joining(d){return this}whisper(d,y){return this}leaving(d){return this}}const d2=class f2{constructor(d){this.setOptions(d),this.connect()}setOptions(d){this.options={...f2._defaultOptions,...d,broadcaster:d.broadcaster};let y=this.csrfToken();y&&(this.options.auth.headers["X-CSRF-TOKEN"]=y,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=y),y=this.options.bearerToken,y&&(this.options.auth.headers.Authorization="Bearer "+y,this.options.userAuthentication.headers.Authorization="Bearer "+y)}csrfToken(){var d,y;return typeof window<"u"&&(d=window.Laravel)!=null&&d.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"?((y=document.querySelector('meta[name="csrf-token"]'))==null?void 0:y.getAttribute("content"))??null:null}};d2._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"};let vw=d2,my=class extends vw{constructor(){super(...arguments),this.channels={}}connect(){if(typeof this.options.client<"u")this.pusher=this.options.client;else if(this.options.Pusher)this.pusher=new this.options.Pusher(this.options.key,this.options);else if(typeof window<"u"&&typeof window.Pusher<"u")this.pusher=new window.Pusher(this.options.key,this.options);else throw new Error("Pusher client not found. Should be globally available or passed via options.client")}signin(){this.pusher.signin()}listen(d,y,S){return this.channel(d).listen(y,S)}channel(d){return this.channels[d]||(this.channels[d]=new yw(this.pusher,d,this.options)),this.channels[d]}privateChannel(d){return this.channels["private-"+d]||(this.channels["private-"+d]=new l2(this.pusher,"private-"+d,this.options)),this.channels["private-"+d]}encryptedPrivateChannel(d){return this.channels["private-encrypted-"+d]||(this.channels["private-encrypted-"+d]=new wk(this.pusher,"private-encrypted-"+d,this.options)),this.channels["private-encrypted-"+d]}presenceChannel(d){return this.channels["presence-"+d]||(this.channels["presence-"+d]=new Tk(this.pusher,"presence-"+d,this.options)),this.channels["presence-"+d]}leave(d){[d,"private-"+d,"private-encrypted-"+d,"presence-"+d].forEach(y=>{this.leaveChannel(y)})}leaveChannel(d){this.channels[d]&&(this.channels[d].unsubscribe(),delete this.channels[d])}socketId(){return this.pusher.connection.socket_id}disconnect(){this.pusher.disconnect()}};class Ik extends vw{constructor(){super(...arguments),this.channels={}}connect(){let d=this.getSocketIO();this.socket=d(this.options.host??void 0,this.options),this.socket.io.on("reconnect",()=>{Object.values(this.channels).forEach(y=>{y.subscribe()})})}getSocketIO(){if(typeof this.options.client<"u")return this.options.client;if(typeof window<"u"&&typeof window.io<"u")return window.io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}listen(d,y,S){return this.channel(d).listen(y,S)}channel(d){return this.channels[d]||(this.channels[d]=new c2(this.socket,d,this.options)),this.channels[d]}privateChannel(d){return this.channels["private-"+d]||(this.channels["private-"+d]=new u2(this.socket,"private-"+d,this.options)),this.channels["private-"+d]}presenceChannel(d){return this.channels["presence-"+d]||(this.channels["presence-"+d]=new Sk(this.socket,"presence-"+d,this.options)),this.channels["presence-"+d]}leave(d){[d,"private-"+d,"presence-"+d].forEach(y=>{this.leaveChannel(y)})}leaveChannel(d){this.channels[d]&&(this.channels[d].unsubscribe(),delete this.channels[d])}socketId(){return this.socket.id}disconnect(){this.socket.disconnect()}}let cA=class extends vw{constructor(){super(...arguments),this.channels={}}connect(){}listen(d,y,S){return new Vy}channel(d){return new Vy}privateChannel(d){return new h2}encryptedPrivateChannel(d){return new Ek}presenceChannel(d){return new Ak}leave(d){}leaveChannel(d){}socketId(){return"fake-socket-id"}disconnect(){}};class Pk{constructor(d){this.options=d,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}channel(d){return this.connector.channel(d)}connect(){if(this.options.broadcaster==="reverb")this.connector=new my({...this.options,cluster:""});else if(this.options.broadcaster==="pusher")this.connector=new my(this.options);else if(this.options.broadcaster==="ably")this.connector=new my({...this.options,cluster:"",broadcaster:"pusher"});else if(this.options.broadcaster==="socket.io")this.connector=new Ik(this.options);else if(this.options.broadcaster==="null")this.connector=new cA(this.options);else if(typeof this.options.broadcaster=="function"&&bk(this.options.broadcaster))this.connector=new this.options.broadcaster(this.options);else throw new Error(`Broadcaster ${typeof this.options.broadcaster} ${String(this.options.broadcaster)} is not supported.`)}disconnect(){this.connector.disconnect()}join(d){return this.connector.presenceChannel(d)}leave(d){this.connector.leave(d)}leaveChannel(d){this.connector.leaveChannel(d)}leaveAllChannels(){for(const d in this.connector.channels)this.leaveChannel(d)}listen(d,y,S){return this.connector.listen(d,y,S)}private(d){return this.connector.privateChannel(d)}encryptedPrivate(d){if(this.connectorSupportsEncryptedPrivateChannels(this.connector))return this.connector.encryptedPrivateChannel(d);throw new Error(`Broadcaster ${typeof this.options.broadcaster} ${String(this.options.broadcaster)} does not support encrypted private channels.`)}connectorSupportsEncryptedPrivateChannels(d){return d instanceof my||d instanceof cA}socketId(){return this.connector.socketId()}registerInterceptors(){typeof Vue<"u"&&Vue!=null&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),typeof Turbo=="object"&&this.registerTurboRequestInterceptor()}registerVueRequestInterceptor(){Vue.http.interceptors.push((d,y)=>{this.socketId()&&d.headers.set("X-Socket-ID",this.socketId()),y()})}registerAxiosRequestInterceptor(){axios.interceptors.request.use(d=>(this.socketId()&&(d.headers["X-Socket-Id"]=this.socketId()),d))}registerjQueryAjaxSetup(){typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter((d,y,S)=>{this.socketId()&&S.setRequestHeader("X-Socket-Id",this.socketId())})}registerTurboRequestInterceptor(){document.addEventListener("turbo:before-fetch-request",d=>{d.detail.fetchOptions.headers["X-Socket-Id"]=this.socketId()})}}var Jc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function dv(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function Ck(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var d=a.default;if(typeof d=="function"){var y=function S(){var P=!1;try{P=this instanceof S}catch{}return P?Reflect.construct(d,arguments,this.constructor):d.apply(this,arguments)};y.prototype=d.prototype}else y={};return Object.defineProperty(y,"__esModule",{value:!0}),Object.keys(a).forEach(function(S){var P=Object.getOwnPropertyDescriptor(a,S);Object.defineProperty(y,S,P.get?P:{enumerable:!0,get:function(){return a[S]}})}),y}var x0={exports:{}};/*!
 * Pusher JavaScript Library v8.4.0
 * https://pusher.com/
 *
 * Copyright 2020, Pusher
 * Released under the MIT licence.
 */var uA;function Mk(){return uA||(uA=1,(function(a,d){(function(S,P){a.exports=P()})(window,function(){return(function(y){var S={};function P(M){if(S[M])return S[M].exports;var k=S[M]={i:M,l:!1,exports:{}};return y[M].call(k.exports,k,k.exports,P),k.l=!0,k.exports}return P.m=y,P.c=S,P.d=function(M,k,r){P.o(M,k)||Object.defineProperty(M,k,{enumerable:!0,get:r})},P.r=function(M){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},P.t=function(M,k){if(k&1&&(M=P(M)),k&8||k&4&&typeof M=="object"&&M&&M.__esModule)return M;var r=Object.create(null);if(P.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:M}),k&2&&typeof M!="string")for(var j in M)P.d(r,j,(function(H){return M[H]}).bind(null,j));return r},P.n=function(M){var k=M&&M.__esModule?function(){return M.default}:function(){return M};return P.d(k,"a",k),k},P.o=function(M,k){return Object.prototype.hasOwnProperty.call(M,k)},P.p="",P(P.s=2)})([(function(y,S,P){var M=this&&this.__extends||(function(){var he=function(Te,Se){return he=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(fe,oe){fe.__proto__=oe}||function(fe,oe){for(var ge in oe)oe.hasOwnProperty(ge)&&(fe[ge]=oe[ge])},he(Te,Se)};return function(Te,Se){he(Te,Se);function fe(){this.constructor=Te}Te.prototype=Se===null?Object.create(Se):(fe.prototype=Se.prototype,new fe)}})();Object.defineProperty(S,"__esModule",{value:!0});var k=256,r=(function(){function he(Te){Te===void 0&&(Te="="),this._paddingCharacter=Te}return he.prototype.encodedLength=function(Te){return this._paddingCharacter?(Te+2)/3*4|0:(Te*8+5)/6|0},he.prototype.encode=function(Te){for(var Se="",fe=0;fe<Te.length-2;fe+=3){var oe=Te[fe]<<16|Te[fe+1]<<8|Te[fe+2];Se+=this._encodeByte(oe>>>18&63),Se+=this._encodeByte(oe>>>12&63),Se+=this._encodeByte(oe>>>6&63),Se+=this._encodeByte(oe>>>0&63)}var ge=Te.length-fe;if(ge>0){var oe=Te[fe]<<16|(ge===2?Te[fe+1]<<8:0);Se+=this._encodeByte(oe>>>18&63),Se+=this._encodeByte(oe>>>12&63),ge===2?Se+=this._encodeByte(oe>>>6&63):Se+=this._paddingCharacter||"",Se+=this._paddingCharacter||""}return Se},he.prototype.maxDecodedLength=function(Te){return this._paddingCharacter?Te/4*3|0:(Te*6+7)/8|0},he.prototype.decodedLength=function(Te){return this.maxDecodedLength(Te.length-this._getPaddingLength(Te))},he.prototype.decode=function(Te){if(Te.length===0)return new Uint8Array(0);for(var Se=this._getPaddingLength(Te),fe=Te.length-Se,oe=new Uint8Array(this.maxDecodedLength(fe)),ge=0,Ge=0,xt=0,It=0,ot=0,Be=0,De=0;Ge<fe-4;Ge+=4)It=this._decodeChar(Te.charCodeAt(Ge+0)),ot=this._decodeChar(Te.charCodeAt(Ge+1)),Be=this._decodeChar(Te.charCodeAt(Ge+2)),De=this._decodeChar(Te.charCodeAt(Ge+3)),oe[ge++]=It<<2|ot>>>4,oe[ge++]=ot<<4|Be>>>2,oe[ge++]=Be<<6|De,xt|=It&k,xt|=ot&k,xt|=Be&k,xt|=De&k;if(Ge<fe-1&&(It=this._decodeChar(Te.charCodeAt(Ge)),ot=this._decodeChar(Te.charCodeAt(Ge+1)),oe[ge++]=It<<2|ot>>>4,xt|=It&k,xt|=ot&k),Ge<fe-2&&(Be=this._decodeChar(Te.charCodeAt(Ge+2)),oe[ge++]=ot<<4|Be>>>2,xt|=Be&k),Ge<fe-3&&(De=this._decodeChar(Te.charCodeAt(Ge+3)),oe[ge++]=Be<<6|De,xt|=De&k),xt!==0)throw new Error("Base64Coder: incorrect characters for decoding");return oe},he.prototype._encodeByte=function(Te){var Se=Te;return Se+=65,Se+=25-Te>>>8&6,Se+=51-Te>>>8&-75,Se+=61-Te>>>8&-15,Se+=62-Te>>>8&3,String.fromCharCode(Se)},he.prototype._decodeChar=function(Te){var Se=k;return Se+=(42-Te&Te-44)>>>8&-k+Te-43+62,Se+=(46-Te&Te-48)>>>8&-k+Te-47+63,Se+=(47-Te&Te-58)>>>8&-k+Te-48+52,Se+=(64-Te&Te-91)>>>8&-k+Te-65+0,Se+=(96-Te&Te-123)>>>8&-k+Te-97+26,Se},he.prototype._getPaddingLength=function(Te){var Se=0;if(this._paddingCharacter){for(var fe=Te.length-1;fe>=0&&Te[fe]===this._paddingCharacter;fe--)Se++;if(Te.length<4||Se>2)throw new Error("Base64Coder: incorrect padding")}return Se},he})();S.Coder=r;var j=new r;function H(he){return j.encode(he)}S.encode=H;function W(he){return j.decode(he)}S.decode=W;var ee=(function(he){M(Te,he);function Te(){return he!==null&&he.apply(this,arguments)||this}return Te.prototype._encodeByte=function(Se){var fe=Se;return fe+=65,fe+=25-Se>>>8&6,fe+=51-Se>>>8&-75,fe+=61-Se>>>8&-13,fe+=62-Se>>>8&49,String.fromCharCode(fe)},Te.prototype._decodeChar=function(Se){var fe=k;return fe+=(44-Se&Se-46)>>>8&-k+Se-45+62,fe+=(94-Se&Se-96)>>>8&-k+Se-95+63,fe+=(47-Se&Se-58)>>>8&-k+Se-48+52,fe+=(64-Se&Se-91)>>>8&-k+Se-65+0,fe+=(96-Se&Se-123)>>>8&-k+Se-97+26,fe},Te})(r);S.URLSafeCoder=ee;var le=new ee;function pe(he){return le.encode(he)}S.encodeURLSafe=pe;function se(he){return le.decode(he)}S.decodeURLSafe=se,S.encodedLength=function(he){return j.encodedLength(he)},S.maxDecodedLength=function(he){return j.maxDecodedLength(he)},S.decodedLength=function(he){return j.decodedLength(he)}}),(function(y,S,P){Object.defineProperty(S,"__esModule",{value:!0});var M="utf8: invalid string",k="utf8: invalid source encoding";function r(W){for(var ee=new Uint8Array(j(W)),le=0,pe=0;pe<W.length;pe++){var se=W.charCodeAt(pe);se<128?ee[le++]=se:se<2048?(ee[le++]=192|se>>6,ee[le++]=128|se&63):se<55296?(ee[le++]=224|se>>12,ee[le++]=128|se>>6&63,ee[le++]=128|se&63):(pe++,se=(se&1023)<<10,se|=W.charCodeAt(pe)&1023,se+=65536,ee[le++]=240|se>>18,ee[le++]=128|se>>12&63,ee[le++]=128|se>>6&63,ee[le++]=128|se&63)}return ee}S.encode=r;function j(W){for(var ee=0,le=0;le<W.length;le++){var pe=W.charCodeAt(le);if(pe<128)ee+=1;else if(pe<2048)ee+=2;else if(pe<55296)ee+=3;else if(pe<=57343){if(le>=W.length-1)throw new Error(M);le++,ee+=4}else throw new Error(M)}return ee}S.encodedLength=j;function H(W){for(var ee=[],le=0;le<W.length;le++){var pe=W[le];if(pe&128){var se=void 0;if(pe<224){if(le>=W.length)throw new Error(k);var he=W[++le];if((he&192)!==128)throw new Error(k);pe=(pe&31)<<6|he&63,se=128}else if(pe<240){if(le>=W.length-1)throw new Error(k);var he=W[++le],Te=W[++le];if((he&192)!==128||(Te&192)!==128)throw new Error(k);pe=(pe&15)<<12|(he&63)<<6|Te&63,se=2048}else if(pe<248){if(le>=W.length-2)throw new Error(k);var he=W[++le],Te=W[++le],Se=W[++le];if((he&192)!==128||(Te&192)!==128||(Se&192)!==128)throw new Error(k);pe=(pe&15)<<18|(he&63)<<12|(Te&63)<<6|Se&63,se=65536}else throw new Error(k);if(pe<se||pe>=55296&&pe<=57343)throw new Error(k);if(pe>=65536){if(pe>1114111)throw new Error(k);pe-=65536,ee.push(String.fromCharCode(55296|pe>>10)),pe=56320|pe&1023}}ee.push(String.fromCharCode(pe))}return ee.join("")}S.decode=H}),(function(y,S,P){y.exports=P(3).default}),(function(y,S,P){P.r(S);class M{constructor(q,re){this.lastId=0,this.prefix=q,this.name=re}create(q){this.lastId++;var re=this.lastId,Ne=this.prefix+re,Qe=this.name+"["+re+"]",fi=!1,Zi=function(){fi||(q.apply(null,arguments),fi=!0)};return this[re]=Zi,{number:re,id:Ne,name:Qe,callback:Zi}}remove(q){delete this[q.number]}}var k=new M("_pusher_script_","Pusher.ScriptReceivers"),r={VERSION:"8.4.0",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},j=r;class H{constructor(q){this.options=q,this.receivers=q.receivers||k,this.loading={}}load(q,re,Ne){var Qe=this;if(Qe.loading[q]&&Qe.loading[q].length>0)Qe.loading[q].push(Ne);else{Qe.loading[q]=[Ne];var fi=Rn.createScriptRequest(Qe.getPath(q,re)),Zi=Qe.receivers.create(function(vn){if(Qe.receivers.remove(Zi),Qe.loading[q]){var Bn=Qe.loading[q];delete Qe.loading[q];for(var Ir=function(Bs){Bs||fi.cleanup()},Pr=0;Pr<Bn.length;Pr++)Bn[Pr](vn,Ir)}});fi.send(Zi)}}getRoot(q){var re,Ne=Rn.getDocument().location.protocol;return q&&q.useTLS||Ne==="https:"?re=this.options.cdn_https:re=this.options.cdn_http,re.replace(/\/*$/,"")+"/"+this.options.version}getPath(q,re){return this.getRoot(re)+"/"+q+this.options.suffix+".js"}}var W=new M("_pusher_dependencies","Pusher.DependenciesReceivers"),ee=new H({cdn_http:j.cdn_http,cdn_https:j.cdn_https,version:j.VERSION,suffix:j.dependency_suffix,receivers:W});const le={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};var se={buildLogSuffix:function(ce){const q="See:",re=le.urls[ce];if(!re)return"";let Ne;return re.fullUrl?Ne=re.fullUrl:re.path&&(Ne=le.baseUrl+re.path),Ne?`${q} ${Ne}`:""}},he;(function(ce){ce.UserAuthentication="user-authentication",ce.ChannelAuthorization="channel-authorization"})(he||(he={}));class Te extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class Se extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class fe extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class oe extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class ge extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class Ge extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class xt extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class It extends Error{constructor(q){super(q),Object.setPrototypeOf(this,new.target.prototype)}}class ot extends Error{constructor(q,re){super(re),this.status=q,Object.setPrototypeOf(this,new.target.prototype)}}var De=function(ce,q,re,Ne,Qe){const fi=Rn.createXHR();fi.open("POST",re.endpoint,!0),fi.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var Zi in re.headers)fi.setRequestHeader(Zi,re.headers[Zi]);if(re.headersProvider!=null){let vn=re.headersProvider();for(var Zi in vn)fi.setRequestHeader(Zi,vn[Zi])}return fi.onreadystatechange=function(){if(fi.readyState===4)if(fi.status===200){let vn,Bn=!1;try{vn=JSON.parse(fi.responseText),Bn=!0}catch{Qe(new ot(200,`JSON returned from ${Ne.toString()} endpoint was invalid, yet status code was 200. Data was: ${fi.responseText}`),null)}Bn&&Qe(null,vn)}else{let vn="";switch(Ne){case he.UserAuthentication:vn=se.buildLogSuffix("authenticationEndpoint");break;case he.ChannelAuthorization:vn=`Clients must be authorized to join private or presence channels. ${se.buildLogSuffix("authorizationEndpoint")}`;break}Qe(new ot(fi.status,`Unable to retrieve auth string from ${Ne.toString()} endpoint - received status: ${fi.status} from ${re.endpoint}. ${vn}`),null)}},fi.send(q),fi};function Oe(ce){return si(At(ce))}var He=String.fromCharCode,ft="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tt=function(ce){var q=ce.charCodeAt(0);return q<128?ce:q<2048?He(192|q>>>6)+He(128|q&63):He(224|q>>>12&15)+He(128|q>>>6&63)+He(128|q&63)},At=function(ce){return ce.replace(/[^\x00-\x7F]/g,tt)},yt=function(ce){var q=[0,2,1][ce.length%3],re=ce.charCodeAt(0)<<16|(ce.length>1?ce.charCodeAt(1):0)<<8|(ce.length>2?ce.charCodeAt(2):0),Ne=[ft.charAt(re>>>18),ft.charAt(re>>>12&63),q>=2?"=":ft.charAt(re>>>6&63),q>=1?"=":ft.charAt(re&63)];return Ne.join("")},si=window.btoa||function(ce){return ce.replace(/[\s\S]{1,3}/g,yt)};class wt{constructor(q,re,Ne,Qe){this.clear=re,this.timer=q(()=>{this.timer&&(this.timer=Qe(this.timer))},Ne)}isRunning(){return this.timer!==null}ensureAborted(){this.timer&&(this.clear(this.timer),this.timer=null)}}var Gi=wt;function Ti(ce){window.clearTimeout(ce)}function di(ce){window.clearInterval(ce)}class ki extends Gi{constructor(q,re){super(setTimeout,Ti,q,function(Ne){return re(),null})}}class dn extends Gi{constructor(q,re){super(setInterval,di,q,function(Ne){return re(),Ne})}}var an={now(){return Date.now?Date.now():new Date().valueOf()},defer(ce){return new ki(0,ce)},method(ce,...q){var re=Array.prototype.slice.call(arguments,1);return function(Ne){return Ne[ce].apply(Ne,re.concat(arguments))}}},mt=an;function Pt(ce,...q){for(var re=0;re<q.length;re++){var Ne=q[re];for(var Qe in Ne)Ne[Qe]&&Ne[Qe].constructor&&Ne[Qe].constructor===Object?ce[Qe]=Pt(ce[Qe]||{},Ne[Qe]):ce[Qe]=Ne[Qe]}return ce}function pi(){for(var ce=["Pusher"],q=0;q<arguments.length;q++)typeof arguments[q]=="string"?ce.push(arguments[q]):ce.push(sn(arguments[q]));return ce.join(" : ")}function Ui(ce,q){var re=Array.prototype.indexOf;if(ce===null)return-1;if(re&&ce.indexOf===re)return ce.indexOf(q);for(var Ne=0,Qe=ce.length;Ne<Qe;Ne++)if(ce[Ne]===q)return Ne;return-1}function ei(ce,q){for(var re in ce)Object.prototype.hasOwnProperty.call(ce,re)&&q(ce[re],re,ce)}function _i(ce){var q=[];return ei(ce,function(re,Ne){q.push(Ne)}),q}function un(ce){var q=[];return ei(ce,function(re){q.push(re)}),q}function Qi(ce,q,re){for(var Ne=0;Ne<ce.length;Ne++)q.call(re||window,ce[Ne],Ne,ce)}function $e(ce,q){for(var re=[],Ne=0;Ne<ce.length;Ne++)re.push(q(ce[Ne],Ne,ce,re));return re}function lt(ce,q){var re={};return ei(ce,function(Ne,Qe){re[Qe]=q(Ne)}),re}function vt(ce,q){q=q||function(Qe){return!!Qe};for(var re=[],Ne=0;Ne<ce.length;Ne++)q(ce[Ne],Ne,ce,re)&&re.push(ce[Ne]);return re}function ai(ce,q){var re={};return ei(ce,function(Ne,Qe){(q&&q(Ne,Qe,ce,re)||Ne)&&(re[Qe]=Ne)}),re}function ii(ce){var q=[];return ei(ce,function(re,Ne){q.push([Ne,re])}),q}function ci(ce,q){for(var re=0;re<ce.length;re++)if(q(ce[re],re,ce))return!0;return!1}function Ei(ce,q){for(var re=0;re<ce.length;re++)if(!q(ce[re],re,ce))return!1;return!0}function bi(ce){return lt(ce,function(q){return typeof q=="object"&&(q=sn(q)),encodeURIComponent(Oe(q.toString()))})}function ui(ce){var q=ai(ce,function(Ne){return Ne!==void 0}),re=$e(ii(bi(q)),mt.method("join","=")).join("&");return re}function vi(ce){var q=[],re=[];return(function Ne(Qe,fi){var Zi,vn,Bn;switch(typeof Qe){case"object":if(!Qe)return null;for(Zi=0;Zi<q.length;Zi+=1)if(q[Zi]===Qe)return{$ref:re[Zi]};if(q.push(Qe),re.push(fi),Object.prototype.toString.apply(Qe)==="[object Array]")for(Bn=[],Zi=0;Zi<Qe.length;Zi+=1)Bn[Zi]=Ne(Qe[Zi],fi+"["+Zi+"]");else{Bn={};for(vn in Qe)Object.prototype.hasOwnProperty.call(Qe,vn)&&(Bn[vn]=Ne(Qe[vn],fi+"["+JSON.stringify(vn)+"]"))}return Bn;case"number":case"string":case"boolean":return Qe}})(ce,"$")}function sn(ce){try{return JSON.stringify(ce)}catch{return JSON.stringify(vi(ce))}}class Hi{constructor(){this.globalLog=q=>{window.console&&window.console.log&&window.console.log(q)}}debug(...q){this.log(this.globalLog,q)}warn(...q){this.log(this.globalLogWarn,q)}error(...q){this.log(this.globalLogError,q)}globalLogWarn(q){window.console&&window.console.warn?window.console.warn(q):this.globalLog(q)}globalLogError(q){window.console&&window.console.error?window.console.error(q):this.globalLogWarn(q)}log(q,...re){var Ne=pi.apply(this,arguments);ja.log?ja.log(Ne):ja.logToConsole&&q.bind(this)(Ne)}}var $i=new Hi,fn=function(ce,q,re,Ne,Qe){(re.headers!==void 0||re.headersProvider!=null)&&$i.warn(`To send headers with the ${Ne.toString()} request, you must use AJAX, rather than JSONP.`);var fi=ce.nextAuthCallbackID.toString();ce.nextAuthCallbackID++;var Zi=ce.getDocument(),vn=Zi.createElement("script");ce.auth_callbacks[fi]=function(Pr){Qe(null,Pr)};var Bn="Pusher.auth_callbacks['"+fi+"']";vn.src=re.endpoint+"?callback="+encodeURIComponent(Bn)+"&"+q;var Ir=Zi.getElementsByTagName("head")[0]||Zi.documentElement;Ir.insertBefore(vn,Ir.firstChild)},Nn=fn;class br{constructor(q){this.src=q}send(q){var re=this,Ne="Error loading "+re.src;re.script=document.createElement("script"),re.script.id=q.id,re.script.src=re.src,re.script.type="text/javascript",re.script.charset="UTF-8",re.script.addEventListener?(re.script.onerror=function(){q.callback(Ne)},re.script.onload=function(){q.callback(null)}):re.script.onreadystatechange=function(){(re.script.readyState==="loaded"||re.script.readyState==="complete")&&q.callback(null)},re.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(re.errorScript=document.createElement("script"),re.errorScript.id=q.id+"_error",re.errorScript.text=q.name+"('"+Ne+"');",re.script.async=re.errorScript.async=!1):re.script.async=!0;var Qe=document.getElementsByTagName("head")[0];Qe.insertBefore(re.script,Qe.firstChild),re.errorScript&&Qe.insertBefore(re.errorScript,re.script.nextSibling)}cleanup(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null}}class Xn{constructor(q,re){this.url=q,this.data=re}send(q){if(!this.request){var re=ui(this.data),Ne=this.url+"/"+q.number+"?"+re;this.request=Rn.createScriptRequest(Ne),this.request.send(q)}}cleanup(){this.request&&this.request.cleanup()}}var is=function(ce,q){return function(re,Ne){var Qe="http"+(q?"s":"")+"://",fi=Qe+(ce.host||ce.options.host)+ce.options.path,Zi=Rn.createJSONPRequest(fi,re),vn=Rn.ScriptReceivers.create(function(Bn,Ir){k.remove(vn),Zi.cleanup(),Ir&&Ir.host&&(ce.host=Ir.host),Ne&&Ne(Bn,Ir)});Zi.send(vn)}},Qn={name:"jsonp",getAgent:is},Wr=Qn;function ns(ce,q,re){var Ne=ce+(q.useTLS?"s":""),Qe=q.useTLS?q.hostTLS:q.hostNonTLS;return Ne+"://"+Qe+re}function Dr(ce,q){var re="/app/"+ce,Ne="?protocol="+j.PROTOCOL+"&client=js&version="+j.VERSION+(q?"&"+q:"");return re+Ne}var ds={getInitial:function(ce,q){var re=(q.httpPath||"")+Dr(ce,"flash=false");return ns("ws",q,re)}},Rt={getInitial:function(ce,q){var re=(q.httpPath||"/pusher")+Dr(ce);return ns("http",q,re)}},Dt={getInitial:function(ce,q){return ns("http",q,q.httpPath||"/pusher")},getPath:function(ce,q){return Dr(ce)}};class en{constructor(){this._callbacks={}}get(q){return this._callbacks[Dn(q)]}add(q,re,Ne){var Qe=Dn(q);this._callbacks[Qe]=this._callbacks[Qe]||[],this._callbacks[Qe].push({fn:re,context:Ne})}remove(q,re,Ne){if(!q&&!re&&!Ne){this._callbacks={};return}var Qe=q?[Dn(q)]:_i(this._callbacks);re||Ne?this.removeCallback(Qe,re,Ne):this.removeAllCallbacks(Qe)}removeCallback(q,re,Ne){Qi(q,function(Qe){this._callbacks[Qe]=vt(this._callbacks[Qe]||[],function(fi){return re&&re!==fi.fn||Ne&&Ne!==fi.context}),this._callbacks[Qe].length===0&&delete this._callbacks[Qe]},this)}removeAllCallbacks(q){Qi(q,function(re){delete this._callbacks[re]},this)}}function Dn(ce){return"_"+ce}class ir{constructor(q){this.callbacks=new en,this.global_callbacks=[],this.failThrough=q}bind(q,re,Ne){return this.callbacks.add(q,re,Ne),this}bind_global(q){return this.global_callbacks.push(q),this}unbind(q,re,Ne){return this.callbacks.remove(q,re,Ne),this}unbind_global(q){return q?(this.global_callbacks=vt(this.global_callbacks||[],re=>re!==q),this):(this.global_callbacks=[],this)}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(q,re,Ne){for(var Qe=0;Qe<this.global_callbacks.length;Qe++)this.global_callbacks[Qe](q,re);var fi=this.callbacks.get(q),Zi=[];if(Ne?Zi.push(re,Ne):re&&Zi.push(re),fi&&fi.length>0)for(var Qe=0;Qe<fi.length;Qe++)fi[Qe].fn.apply(fi[Qe].context||window,Zi);else this.failThrough&&this.failThrough(q,re);return this}}class jn extends ir{constructor(q,re,Ne,Qe,fi){super(),this.initialize=Rn.transportConnectionInitializer,this.hooks=q,this.name=re,this.priority=Ne,this.key=Qe,this.options=fi,this.state="new",this.timeline=fi.timeline,this.activityTimeout=fi.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return!!this.hooks.handlesActivityChecks}supportsPing(){return!!this.hooks.supportsPing}connect(){if(this.socket||this.state!=="initialized")return!1;var q=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(q,this.options)}catch(re){return mt.defer(()=>{this.onError(re),this.changeState("closed")}),!1}return this.bindListeners(),$i.debug("Connecting",{transport:this.name,url:q}),this.changeState("connecting"),!0}close(){return this.socket?(this.socket.close(),!0):!1}send(q){return this.state==="open"?(mt.defer(()=>{this.socket&&this.socket.send(q)}),!0):!1}ping(){this.state==="open"&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0}onError(q){this.emit("error",{type:"WebSocketError",error:q}),this.timeline.error(this.buildTimelineMessage({error:q.toString()}))}onClose(q){q?this.changeState("closed",{code:q.code,reason:q.reason,wasClean:q.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0}onMessage(q){this.emit("message",q)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=q=>{this.onError(q)},this.socket.onclose=q=>{this.onClose(q)},this.socket.onmessage=q=>{this.onMessage(q)},this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))}changeState(q,re){this.state=q,this.timeline.info(this.buildTimelineMessage({state:q,params:re})),this.emit(q,re)}buildTimelineMessage(q){return Pt({cid:this.id},q)}}class rs{constructor(q){this.hooks=q}isSupported(q){return this.hooks.isSupported(q)}createConnection(q,re,Ne,Qe){return new jn(this.hooks,q,re,Ne,Qe)}}var Os=new rs({urls:ds,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!Rn.getWebSocketAPI()},isSupported:function(){return!!Rn.getWebSocketAPI()},getSocket:function(ce){return Rn.createWebSocket(ce)}}),fs={urls:Rt,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},fo=Pt({getSocket:function(ce){return Rn.HTTPFactory.createStreamingSocket(ce)}},fs),kt=Pt({getSocket:function(ce){return Rn.HTTPFactory.createPollingSocket(ce)}},fs),ls={isSupported:function(){return Rn.isXHRSupported()}},Ss=new rs(Pt({},fo,ls)),wo=new rs(Pt({},kt,ls)),Xe={ws:Os,xhr_streaming:Ss,xhr_polling:wo},Q=Xe,ne=new rs({file:"sockjs",urls:Dt,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return window.SockJS!==void 0},getSocket:function(ce,q){return new window.SockJS(ce,null,{js_path:ee.getPath("sockjs",{useTLS:q.useTLS}),ignore_null_origin:q.ignoreNullOrigin})},beforeOpen:function(ce,q){ce.send(JSON.stringify({path:q}))}}),be={isSupported:function(ce){var q=Rn.isXDRSupported(ce.useTLS);return q}},Fe=new rs(Pt({},fo,be)),ve=new rs(Pt({},kt,be));Q.xdr_streaming=Fe,Q.xdr_polling=ve,Q.sockjs=ne;var Le=Q;class rt extends ir{constructor(){super();var q=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){q.emit("online")},!1),window.addEventListener("offline",function(){q.emit("offline")},!1))}isOnline(){return window.navigator.onLine===void 0?!0:window.navigator.onLine}}var je=new rt;class st{constructor(q,re,Ne){this.manager=q,this.transport=re,this.minPingDelay=Ne.minPingDelay,this.maxPingDelay=Ne.maxPingDelay,this.pingDelay=void 0}createConnection(q,re,Ne,Qe){Qe=Pt({},Qe,{activityTimeout:this.pingDelay});var fi=this.transport.createConnection(q,re,Ne,Qe),Zi=null,vn=function(){fi.unbind("open",vn),fi.bind("closed",Bn),Zi=mt.now()},Bn=Ir=>{if(fi.unbind("closed",Bn),Ir.code===1002||Ir.code===1003)this.manager.reportDeath();else if(!Ir.wasClean&&Zi){var Pr=mt.now()-Zi;Pr<2*this.maxPingDelay&&(this.manager.reportDeath(),this.pingDelay=Math.max(Pr/2,this.minPingDelay))}};return fi.bind("open",vn),fi}isSupported(q){return this.manager.isAlive()&&this.transport.isSupported(q)}}const Nt={decodeMessage:function(ce){try{var q=JSON.parse(ce.data),re=q.data;if(typeof re=="string")try{re=JSON.parse(q.data)}catch{}var Ne={event:q.event,channel:q.channel,data:re};return q.user_id&&(Ne.user_id=q.user_id),Ne}catch(Qe){throw{type:"MessageParseError",error:Qe,data:ce.data}}},encodeMessage:function(ce){return JSON.stringify(ce)},processHandshake:function(ce){var q=Nt.decodeMessage(ce);if(q.event==="pusher:connection_established"){if(!q.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:q.data.socket_id,activityTimeout:q.data.activity_timeout*1e3}}else{if(q.event==="pusher:error")return{action:this.getCloseAction(q.data),error:this.getCloseError(q.data)};throw"Invalid handshake"}},getCloseAction:function(ce){return ce.code<4e3?ce.code>=1002&&ce.code<=1004?"backoff":null:ce.code===4e3?"tls_only":ce.code<4100?"refused":ce.code<4200?"backoff":ce.code<4300?"retry":"refused"},getCloseError:function(ce){return ce.code!==1e3&&ce.code!==1001?{type:"PusherError",data:{code:ce.code,message:ce.reason||ce.message}}:null}};var Ct=Nt;class wi extends ir{constructor(q,re){super(),this.id=q,this.transport=re,this.activityTimeout=re.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(q){return this.transport.send(q)}send_event(q,re,Ne){var Qe={event:q,data:re};return Ne&&(Qe.channel=Ne),$i.debug("Event sent",Qe),this.send(Ct.encodeMessage(Qe))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var q={message:Ne=>{var Qe;try{Qe=Ct.decodeMessage(Ne)}catch(fi){this.emit("error",{type:"MessageParseError",error:fi,data:Ne.data})}if(Qe!==void 0){switch($i.debug("Event recd",Qe),Qe.event){case"pusher:error":this.emit("error",{type:"PusherError",data:Qe.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",Qe)}},activity:()=>{this.emit("activity")},error:Ne=>{this.emit("error",Ne)},closed:Ne=>{re(),Ne&&Ne.code&&this.handleCloseEvent(Ne),this.transport=null,this.emit("closed")}},re=()=>{ei(q,(Ne,Qe)=>{this.transport.unbind(Qe,Ne)})};ei(q,(Ne,Qe)=>{this.transport.bind(Qe,Ne)})}handleCloseEvent(q){var re=Ct.getCloseAction(q),Ne=Ct.getCloseError(q);Ne&&this.emit("error",Ne),re&&this.emit(re,{action:re,error:Ne})}}class qi{constructor(q,re){this.transport=q,this.callback=re,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=q=>{this.unbindListeners();var re;try{re=Ct.processHandshake(q)}catch(Ne){this.finish("error",{error:Ne}),this.transport.close();return}re.action==="connected"?this.finish("connected",{connection:new wi(re.id,this.transport),activityTimeout:re.activityTimeout}):(this.finish(re.action,{error:re.error}),this.transport.close())},this.onClosed=q=>{this.unbindListeners();var re=Ct.getCloseAction(q)||"backoff",Ne=Ct.getCloseError(q);this.finish(re,{error:Ne})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(q,re){this.callback(Pt({transport:this.transport,action:q},re))}}class Ki{constructor(q,re){this.timeline=q,this.options=re||{}}send(q,re){this.timeline.isEmpty()||this.timeline.send(Rn.TimelineTransport.getAgent(this,q),re)}}class pn extends ir{constructor(q,re){super(function(Ne,Qe){$i.debug("No callbacks on "+q+" for "+Ne)}),this.name=q,this.pusher=re,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}authorize(q,re){return re(null,{auth:""})}trigger(q,re){if(q.indexOf("client-")!==0)throw new Te("Event '"+q+"' does not start with 'client-'");if(!this.subscribed){var Ne=se.buildLogSuffix("triggeringClientEvents");$i.warn(`Client event triggered before channel 'subscription_succeeded' event . ${Ne}`)}return this.pusher.send_event(q,re,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(q){var re=q.event,Ne=q.data;if(re==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(q);else if(re==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(q);else if(re.indexOf("pusher_internal:")!==0){var Qe={};this.emit(re,Ne,Qe)}}handleSubscriptionSucceededEvent(q){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",q.data)}handleSubscriptionCountEvent(q){q.data.subscription_count&&(this.subscriptionCount=q.data.subscription_count),this.emit("pusher:subscription_count",q.data)}subscribe(){this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(q,re)=>{q?(this.subscriptionPending=!1,$i.error(q.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:q.message},q instanceof ot?{status:q.status}:{}))):this.pusher.send_event("pusher:subscribe",{auth:re.auth,channel_data:re.channel_data,channel:this.name})}))}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class Ji extends pn{authorize(q,re){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:q},re)}}class Mn{constructor(){this.reset()}get(q){return Object.prototype.hasOwnProperty.call(this.members,q)?{id:q,info:this.members[q]}:null}each(q){ei(this.members,(re,Ne)=>{q(this.get(Ne))})}setMyID(q){this.myID=q}onSubscription(q){this.members=q.presence.hash,this.count=q.presence.count,this.me=this.get(this.myID)}addMember(q){return this.get(q.user_id)===null&&this.count++,this.members[q.user_id]=q.user_info,this.get(q.user_id)}removeMember(q){var re=this.get(q.user_id);return re&&(delete this.members[q.user_id],this.count--),re}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}var er=function(ce,q,re,Ne){function Qe(fi){return fi instanceof re?fi:new re(function(Zi){Zi(fi)})}return new(re||(re=Promise))(function(fi,Zi){function vn(Pr){try{Ir(Ne.next(Pr))}catch(Bs){Zi(Bs)}}function Bn(Pr){try{Ir(Ne.throw(Pr))}catch(Bs){Zi(Bs)}}function Ir(Pr){Pr.done?fi(Pr.value):Qe(Pr.value).then(vn,Bn)}Ir((Ne=Ne.apply(ce,q||[])).next())})};class An extends Ji{constructor(q,re){super(q,re),this.members=new Mn}authorize(q,re){super.authorize(q,(Ne,Qe)=>er(this,void 0,void 0,function*(){if(!Ne)if(Qe=Qe,Qe.channel_data!=null){var fi=JSON.parse(Qe.channel_data);this.members.setMyID(fi.user_id)}else if(yield this.pusher.user.signinDonePromise,this.pusher.user.user_data!=null)this.members.setMyID(this.pusher.user.user_data.id);else{let Zi=se.buildLogSuffix("authorizationEndpoint");$i.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${Zi}, or the user should be signed in.`),re("Invalid auth response");return}re(Ne,Qe)}))}handleEvent(q){var re=q.event;if(re.indexOf("pusher_internal:")===0)this.handleInternalEvent(q);else{var Ne=q.data,Qe={};q.user_id&&(Qe.user_id=q.user_id),this.emit(re,Ne,Qe)}}handleInternalEvent(q){var re=q.event,Ne=q.data;switch(re){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(q);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(q);break;case"pusher_internal:member_added":var Qe=this.members.addMember(Ne);this.emit("pusher:member_added",Qe);break;case"pusher_internal:member_removed":var fi=this.members.removeMember(Ne);fi&&this.emit("pusher:member_removed",fi);break}}handleSubscriptionSucceededEvent(q){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(q.data),this.emit("pusher:subscription_succeeded",this.members))}disconnect(){this.members.reset(),super.disconnect()}}var Mr=P(1),ss=P(0);class zr extends Ji{constructor(q,re,Ne){super(q,re),this.key=null,this.nacl=Ne}authorize(q,re){super.authorize(q,(Ne,Qe)=>{if(Ne){re(Ne,Qe);return}let fi=Qe.shared_secret;if(!fi){re(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null);return}this.key=Object(ss.decode)(fi),delete Qe.shared_secret,re(null,Qe)})}trigger(q,re){throw new Ge("Client events are not currently supported for encrypted channels")}handleEvent(q){var re=q.event,Ne=q.data;if(re.indexOf("pusher_internal:")===0||re.indexOf("pusher:")===0){super.handleEvent(q);return}this.handleEncryptedEvent(re,Ne)}handleEncryptedEvent(q,re){if(!this.key){$i.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!re.ciphertext||!re.nonce){$i.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+re);return}let Ne=Object(ss.decode)(re.ciphertext);if(Ne.length<this.nacl.secretbox.overheadLength){$i.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${Ne.length}`);return}let Qe=Object(ss.decode)(re.nonce);if(Qe.length<this.nacl.secretbox.nonceLength){$i.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${Qe.length}`);return}let fi=this.nacl.secretbox.open(Ne,Qe,this.key);if(fi===null){$i.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,(Zi,vn)=>{if(Zi){$i.error(`Failed to make a request to the authEndpoint: ${vn}. Unable to fetch new key, so dropping encrypted event`);return}if(fi=this.nacl.secretbox.open(Ne,Qe,this.key),fi===null){$i.error("Failed to decrypt event with new key. Dropping encrypted event");return}this.emit(q,this.getDataToEmit(fi))});return}this.emit(q,this.getDataToEmit(fi))}getDataToEmit(q){let re=Object(Mr.decode)(q);try{return JSON.parse(re)}catch{return re}}}class rr extends ir{constructor(q,re){super(),this.state="initialized",this.connection=null,this.key=q,this.options=re,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var Ne=Rn.getNetwork();Ne.bind("online",()=>{this.timeline.info({netinfo:"online"}),(this.state==="connecting"||this.state==="unavailable")&&this.retryIn(0)}),Ne.bind("offline",()=>{this.timeline.info({netinfo:"offline"}),this.connection&&this.sendActivityCheck()}),this.updateStrategy()}connect(){if(!(this.connection||this.runner)){if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}}send(q){return this.connection?this.connection.send(q):!1}send_event(q,re,Ne){return this.connection?this.connection.send_event(q,re,Ne):!1}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var q=(re,Ne)=>{re?this.runner=this.strategy.connect(0,q):Ne.action==="error"?(this.emit("error",{type:"HandshakeError",error:Ne.error}),this.timeline.error({handshakeError:Ne.error})):(this.abortConnecting(),this.handshakeCallbacks[Ne.action](Ne))};this.runner=this.strategy.connect(0,q)}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var q=this.abandonConnection();q.close()}}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(q){this.timeline.info({action:"retry",delay:q}),q>0&&this.emit("connecting_in",Math.round(q/1e3)),this.retryTimer=new ki(q||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)}setUnavailableTimer(){this.unavailableTimer=new ki(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new ki(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new ki(this.activityTimeout,()=>{this.sendActivityCheck()}))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(q){return Pt({},q,{message:re=>{this.resetActivityCheck(),this.emit("message",re)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:re=>{this.emit("error",re)},closed:()=>{this.abandonConnection(),this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(q){return Pt({},q,{connected:re=>{this.activityTimeout=Math.min(this.options.activityTimeout,re.activityTimeout,re.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(re.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let q=re=>Ne=>{Ne.error&&this.emit("error",{type:"WebSocketError",error:Ne.error}),re(Ne)};return{tls_only:q(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:q(()=>{this.disconnect()}),backoff:q(()=>{this.retryIn(1e3)}),retry:q(()=>{this.retryIn(0)})}}setConnection(q){this.connection=q;for(var re in this.connectionCallbacks)this.connection.bind(re,this.connectionCallbacks[re]);this.resetActivityCheck()}abandonConnection(){if(this.connection){this.stopActivityCheck();for(var q in this.connectionCallbacks)this.connection.unbind(q,this.connectionCallbacks[q]);var re=this.connection;return this.connection=null,re}}updateState(q,re){var Ne=this.state;if(this.state=q,Ne!==q){var Qe=q;Qe==="connected"&&(Qe+=" with new socket ID "+re.socket_id),$i.debug("State changed",Ne+" -> "+Qe),this.timeline.info({state:q,params:re}),this.emit("state_change",{previous:Ne,current:q}),this.emit(q,re)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}}class Zn{constructor(){this.channels={}}add(q,re){return this.channels[q]||(this.channels[q]=kr(q,re)),this.channels[q]}all(){return un(this.channels)}find(q){return this.channels[q]}remove(q){var re=this.channels[q];return delete this.channels[q],re}disconnect(){ei(this.channels,function(q){q.disconnect()})}}function kr(ce,q){if(ce.indexOf("private-encrypted-")===0){if(q.config.nacl)return Gn.createEncryptedChannel(ce,q,q.config.nacl);let re="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",Ne=se.buildLogSuffix("encryptedChannelSupport");throw new Ge(`${re}. ${Ne}`)}else{if(ce.indexOf("private-")===0)return Gn.createPrivateChannel(ce,q);if(ce.indexOf("presence-")===0)return Gn.createPresenceChannel(ce,q);if(ce.indexOf("#")===0)throw new Se('Cannot create a channel with name "'+ce+'".');return Gn.createChannel(ce,q)}}var Rr={createChannels(){return new Zn},createConnectionManager(ce,q){return new rr(ce,q)},createChannel(ce,q){return new pn(ce,q)},createPrivateChannel(ce,q){return new Ji(ce,q)},createPresenceChannel(ce,q){return new An(ce,q)},createEncryptedChannel(ce,q,re){return new zr(ce,q,re)},createTimelineSender(ce,q){return new Ki(ce,q)},createHandshake(ce,q){return new qi(ce,q)},createAssistantToTheTransportManager(ce,q,re){return new st(ce,q,re)}},Gn=Rr;class ps{constructor(q){this.options=q||{},this.livesLeft=this.options.lives||1/0}getAssistant(q){return Gn.createAssistantToTheTransportManager(this,q,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class gs{constructor(q,re){this.strategies=q,this.loop=!!re.loop,this.failFast=!!re.failFast,this.timeout=re.timeout,this.timeoutLimit=re.timeoutLimit}isSupported(){return ci(this.strategies,mt.method("isSupported"))}connect(q,re){var Ne=this.strategies,Qe=0,fi=this.timeout,Zi=null,vn=(Bn,Ir)=>{Ir?re(null,Ir):(Qe=Qe+1,this.loop&&(Qe=Qe%Ne.length),Qe<Ne.length?(fi&&(fi=fi*2,this.timeoutLimit&&(fi=Math.min(fi,this.timeoutLimit))),Zi=this.tryStrategy(Ne[Qe],q,{timeout:fi,failFast:this.failFast},vn)):re(!0))};return Zi=this.tryStrategy(Ne[Qe],q,{timeout:fi,failFast:this.failFast},vn),{abort:function(){Zi.abort()},forceMinPriority:function(Bn){q=Bn,Zi&&Zi.forceMinPriority(Bn)}}}tryStrategy(q,re,Ne,Qe){var fi=null,Zi=null;return Ne.timeout>0&&(fi=new ki(Ne.timeout,function(){Zi.abort(),Qe(!0)})),Zi=q.connect(re,function(vn,Bn){vn&&fi&&fi.isRunning()&&!Ne.failFast||(fi&&fi.ensureAborted(),Qe(vn,Bn))}),{abort:function(){fi&&fi.ensureAborted(),Zi.abort()},forceMinPriority:function(vn){Zi.forceMinPriority(vn)}}}}class zs{constructor(q){this.strategies=q}isSupported(){return ci(this.strategies,mt.method("isSupported"))}connect(q,re){return Hn(this.strategies,q,function(Ne,Qe){return function(fi,Zi){if(Qe[Ne].error=fi,fi){sr(Qe)&&re(!0);return}Qi(Qe,function(vn){vn.forceMinPriority(Zi.transport.priority)}),re(null,Zi)}})}}function Hn(ce,q,re){var Ne=$e(ce,function(Qe,fi,Zi,vn){return Qe.connect(q,re(fi,vn))});return{abort:function(){Qi(Ne,Wo)},forceMinPriority:function(Qe){Qi(Ne,function(fi){fi.forceMinPriority(Qe)})}}}function sr(ce){return Ei(ce,function(q){return!!q.error})}function Wo(ce){!ce.error&&!ce.aborted&&(ce.abort(),ce.aborted=!0)}class oa{constructor(q,re,Ne){this.strategy=q,this.transports=re,this.ttl=Ne.ttl||1800*1e3,this.usingTLS=Ne.useTLS,this.timeline=Ne.timeline}isSupported(){return this.strategy.isSupported()}connect(q,re){var Ne=this.usingTLS,Qe=aa(Ne),fi=Qe&&Qe.cacheSkipCount?Qe.cacheSkipCount:0,Zi=[this.strategy];if(Qe&&Qe.timestamp+this.ttl>=mt.now()){var vn=this.transports[Qe.transport];vn&&(["ws","wss"].includes(Qe.transport)||fi>3?(this.timeline.info({cached:!0,transport:Qe.transport,latency:Qe.latency}),Zi.push(new gs([vn],{timeout:Qe.latency*2+1e3,failFast:!0}))):fi++)}var Bn=mt.now(),Ir=Zi.pop().connect(q,function Pr(Bs,Ks){Bs?(Br(Ne),Zi.length>0?(Bn=mt.now(),Ir=Zi.pop().connect(q,Pr)):re(Bs)):(Kn(Ne,Ks.transport.name,mt.now()-Bn,fi),re(null,Ks))});return{abort:function(){Ir.abort()},forceMinPriority:function(Pr){q=Pr,Ir&&Ir.forceMinPriority(Pr)}}}}function Xs(ce){return"pusherTransport"+(ce?"TLS":"NonTLS")}function aa(ce){var q=Rn.getLocalStorage();if(q)try{var re=q[Xs(ce)];if(re)return JSON.parse(re)}catch{Br(ce)}return null}function Kn(ce,q,re,Ne){var Qe=Rn.getLocalStorage();if(Qe)try{Qe[Xs(ce)]=sn({timestamp:mt.now(),transport:q,latency:re,cacheSkipCount:Ne})}catch{}}function Br(ce){var q=Rn.getLocalStorage();if(q)try{delete q[Xs(ce)]}catch{}}class po{constructor(q,{delay:re}){this.strategy=q,this.options={delay:re}}isSupported(){return this.strategy.isSupported()}connect(q,re){var Ne=this.strategy,Qe,fi=new ki(this.options.delay,function(){Qe=Ne.connect(q,re)});return{abort:function(){fi.ensureAborted(),Qe&&Qe.abort()},forceMinPriority:function(Zi){q=Zi,Qe&&Qe.forceMinPriority(Zi)}}}}class ks{constructor(q,re,Ne){this.test=q,this.trueBranch=re,this.falseBranch=Ne}isSupported(){var q=this.test()?this.trueBranch:this.falseBranch;return q.isSupported()}connect(q,re){var Ne=this.test()?this.trueBranch:this.falseBranch;return Ne.connect(q,re)}}class Ls{constructor(q){this.strategy=q}isSupported(){return this.strategy.isSupported()}connect(q,re){var Ne=this.strategy.connect(q,function(Qe,fi){fi&&Ne.abort(),re(Qe,fi)});return Ne}}function oo(ce){return function(){return ce.isSupported()}}var Ia=function(ce,q,re){var Ne={};function Qe(Jl,il,Ql,Ra,dl){var vs=re(ce,Jl,il,Ql,Ra,dl);return Ne[Jl]=vs,vs}var fi=Object.assign({},q,{hostNonTLS:ce.wsHost+":"+ce.wsPort,hostTLS:ce.wsHost+":"+ce.wssPort,httpPath:ce.wsPath}),Zi=Object.assign({},fi,{useTLS:!0}),vn=Object.assign({},q,{hostNonTLS:ce.httpHost+":"+ce.httpPort,hostTLS:ce.httpHost+":"+ce.httpsPort,httpPath:ce.httpPath}),Bn={loop:!0,timeout:15e3,timeoutLimit:6e4},Ir=new ps({minPingDelay:1e4,maxPingDelay:ce.activityTimeout}),Pr=new ps({lives:2,minPingDelay:1e4,maxPingDelay:ce.activityTimeout}),Bs=Qe("ws","ws",3,fi,Ir),Ks=Qe("wss","ws",3,Zi,Ir),Ko=Qe("sockjs","sockjs",1,vn),Mo=Qe("xhr_streaming","xhr_streaming",1,vn,Pr),nh=Qe("xdr_streaming","xdr_streaming",1,vn,Pr),el=Qe("xhr_polling","xhr_polling",1,vn),$s=Qe("xdr_polling","xdr_polling",1,vn),As=new gs([Bs],Bn),cn=new gs([Ks],Bn),mi=new gs([Ko],Bn),$o=new gs([new ks(oo(Mo),Mo,nh)],Bn),Xi=new gs([new ks(oo(el),el,$s)],Bn),Yo=new gs([new ks(oo($o),new zs([$o,new po(Xi,{delay:4e3})]),Xi)],Bn),tl=new ks(oo(Yo),Yo,mi),Wi;return q.useTLS?Wi=new zs([As,new po(tl,{delay:2e3})]):Wi=new zs([As,new po(cn,{delay:2e3}),new po(tl,{delay:5e3})]),new oa(new Ls(new ks(oo(Bs),Wi,tl)),Ne,{ttl:18e5,timeline:q.timeline,useTLS:q.useTLS})},Vo=Ia,Or=(function(){var ce=this;ce.timeline.info(ce.buildTimelineMessage({transport:ce.name+(ce.options.useTLS?"s":"")})),ce.hooks.isInitialized()?ce.changeState("initialized"):ce.hooks.file?(ce.changeState("initializing"),ee.load(ce.hooks.file,{useTLS:ce.options.useTLS},function(q,re){ce.hooks.isInitialized()?(ce.changeState("initialized"),re(!0)):(q&&ce.onError(q),ce.onClose(),re(!1))})):ce.onClose()}),Vs={getRequest:function(ce){var q=new window.XDomainRequest;return q.ontimeout=function(){ce.emit("error",new fe),ce.close()},q.onerror=function(re){ce.emit("error",re),ce.close()},q.onprogress=function(){q.responseText&&q.responseText.length>0&&ce.onChunk(200,q.responseText)},q.onload=function(){q.responseText&&q.responseText.length>0&&ce.onChunk(200,q.responseText),ce.emit("finished",200),ce.close()},q},abortRequest:function(ce){ce.ontimeout=ce.onerror=ce.onprogress=ce.onload=null,ce.abort()}},mo=Vs;const ao=256*1024;class js extends ir{constructor(q,re,Ne){super(),this.hooks=q,this.method=re,this.url=Ne}start(q){this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},Rn.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(q)}close(){this.unloader&&(Rn.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)}onChunk(q,re){for(;;){var Ne=this.advanceBuffer(re);if(Ne)this.emit("chunk",{status:q,data:Ne});else break}this.isBufferTooLong(re)&&this.emit("buffer_too_long")}advanceBuffer(q){var re=q.slice(this.position),Ne=re.indexOf(`
`);return Ne!==-1?(this.position+=Ne+1,re.slice(0,Ne)):null}isBufferTooLong(q){return this.position===q.length&&q.length>ao}}var _o;(function(ce){ce[ce.CONNECTING=0]="CONNECTING",ce[ce.OPEN=1]="OPEN",ce[ce.CLOSED=3]="CLOSED"})(_o||(_o={}));var go=_o,To=1;class ko{constructor(q,re){this.hooks=q,this.session=xr(1e3)+"/"+Es(8),this.location=_t(re),this.readyState=go.CONNECTING,this.openStream()}send(q){return this.sendRaw(JSON.stringify([q]))}ping(){this.hooks.sendHeartbeat(this)}close(q,re){this.onClose(q,re,!0)}sendRaw(q){if(this.readyState===go.OPEN)try{return Rn.createSocketRequest("POST",Pi(Jt(this.location,this.session))).start(q),!0}catch{return!1}else return!1}reconnect(){this.closeStream(),this.openStream()}onClose(q,re,Ne){this.closeStream(),this.readyState=go.CLOSED,this.onclose&&this.onclose({code:q,reason:re,wasClean:Ne})}onChunk(q){if(q.status===200){this.readyState===go.OPEN&&this.onActivity();var re,Ne=q.data.slice(0,1);switch(Ne){case"o":re=JSON.parse(q.data.slice(1)||"{}"),this.onOpen(re);break;case"a":re=JSON.parse(q.data.slice(1)||"[]");for(var Qe=0;Qe<re.length;Qe++)this.onEvent(re[Qe]);break;case"m":re=JSON.parse(q.data.slice(1)||"null"),this.onEvent(re);break;case"h":this.hooks.onHeartbeat(this);break;case"c":re=JSON.parse(q.data.slice(1)||"[]"),this.onClose(re[0],re[1],!0);break}}}onOpen(q){this.readyState===go.CONNECTING?(q&&q.hostname&&(this.location.base=Fn(this.location.base,q.hostname)),this.readyState=go.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)}onEvent(q){this.readyState===go.OPEN&&this.onmessage&&this.onmessage({data:q})}onActivity(){this.onactivity&&this.onactivity()}onError(q){this.onerror&&this.onerror(q)}openStream(){this.stream=Rn.createSocketRequest("POST",Pi(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",q=>{this.onChunk(q)}),this.stream.bind("finished",q=>{this.hooks.onFinished(this,q)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(q){mt.defer(()=>{this.onError(q),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)}}function _t(ce){var q=/([^\?]*)\/*(\??.*)/.exec(ce);return{base:q[1],queryString:q[2]}}function Jt(ce,q){return ce.base+"/"+q+"/xhr_send"}function Pi(ce){var q=ce.indexOf("?")===-1?"?":"&";return ce+q+"t="+ +new Date+"&n="+To++}function Fn(ce,q){var re=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(ce);return re[1]+q+re[3]}function xr(ce){return Rn.randomInt(ce)}function Es(ce){for(var q=[],re=0;re<ce;re++)q.push(xr(32).toString(32));return q.join("")}var In=ko,fr={getReceiveURL:function(ce,q){return ce.base+"/"+q+"/xhr_streaming"+ce.queryString},onHeartbeat:function(ce){ce.sendRaw("[]")},sendHeartbeat:function(ce){ce.sendRaw("[]")},onFinished:function(ce,q){ce.onClose(1006,"Connection interrupted ("+q+")",!1)}},pr=fr,Js={getReceiveURL:function(ce,q){return ce.base+"/"+q+"/xhr"+ce.queryString},onHeartbeat:function(){},sendHeartbeat:function(ce){ce.sendRaw("[]")},onFinished:function(ce,q){q===200?ce.reconnect():ce.onClose(1006,"Connection interrupted ("+q+")",!1)}},Pn=Js,Ps={getRequest:function(ce){var q=Rn.getXHRAPI(),re=new q;return re.onreadystatechange=re.onprogress=function(){switch(re.readyState){case 3:re.responseText&&re.responseText.length>0&&ce.onChunk(re.status,re.responseText);break;case 4:re.responseText&&re.responseText.length>0&&ce.onChunk(re.status,re.responseText),ce.emit("finished",re.status),ce.close();break}},re},abortRequest:function(ce){ce.onreadystatechange=null,ce.abort()}},Pa=Ps,la={createStreamingSocket(ce){return this.createSocket(pr,ce)},createPollingSocket(ce){return this.createSocket(Pn,ce)},createSocket(ce,q){return new In(ce,q)},createXHR(ce,q){return this.createRequest(Pa,ce,q)},createRequest(ce,q,re){return new js(ce,q,re)}},jo=la;jo.createXDR=function(ce,q){return this.createRequest(mo,ce,q)};var Qs=jo,ms={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:k,DependenciesReceivers:W,getDefaultStrategy:Vo,Transports:Le,transportConnectionInitializer:Or,HTTPFactory:Qs,TimelineTransport:Wr,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(ce){window.Pusher=ce;var q=()=>{this.onDocumentBody(ce.ready)};window.JSON?q():ee.load("json2",{},q)},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:De,jsonp:Nn}},onDocumentBody(ce){document.body?ce():setTimeout(()=>{this.onDocumentBody(ce)},0)},createJSONPRequest(ce,q){return new Xn(ce,q)},createScriptRequest(ce){return new br(ce)},getLocalStorage(){try{return window.localStorage}catch{return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){var ce=this.getXHRAPI();return new ce},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return je},createWebSocket(ce){var q=this.getWebSocketAPI();return new q(ce)},createSocketRequest(ce,q){if(this.isXHRSupported())return this.HTTPFactory.createXHR(ce,q);if(this.isXDRSupported(q.indexOf("https:")===0))return this.HTTPFactory.createXDR(ce,q);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var ce=this.getXHRAPI();return!!ce&&new ce().withCredentials!==void 0},isXDRSupported(ce){var q=ce?"https:":"http:",re=this.getProtocol();return!!window.XDomainRequest&&re===q},addUnloadListener(ce){window.addEventListener!==void 0?window.addEventListener("unload",ce,!1):window.attachEvent!==void 0&&window.attachEvent("onunload",ce)},removeUnloadListener(ce){window.addEventListener!==void 0?window.removeEventListener("unload",ce,!1):window.detachEvent!==void 0&&window.detachEvent("onunload",ce)},randomInt(ce){return Math.floor(function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)}()*ce)}},Rn=ms,Fo;(function(ce){ce[ce.ERROR=3]="ERROR",ce[ce.INFO=6]="INFO",ce[ce.DEBUG=7]="DEBUG"})(Fo||(Fo={}));var Ca=Fo;class ca{constructor(q,re,Ne){this.key=q,this.session=re,this.events=[],this.options=Ne||{},this.sent=0,this.uniqueID=0}log(q,re){q<=this.options.level&&(this.events.push(Pt({},re,{timestamp:mt.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())}error(q){this.log(Ca.ERROR,q)}info(q){this.log(Ca.INFO,q)}debug(q){this.log(Ca.DEBUG,q)}isEmpty(){return this.events.length===0}send(q,re){var Ne=Pt({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],q(Ne,(Qe,fi)=>{Qe||this.sent++,re&&re(Qe,fi)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class Qa{constructor(q,re,Ne,Qe){this.name=q,this.priority=re,this.transport=Ne,this.options=Qe||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(q,re){if(this.isSupported()){if(this.priority<q)return Ke(new oe,re)}else return Ke(new It,re);var Ne=!1,Qe=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),fi=null,Zi=function(){Qe.unbind("initialized",Zi),Qe.connect()},vn=function(){fi=Gn.createHandshake(Qe,function(Bs){Ne=!0,Pr(),re(null,Bs)})},Bn=function(Bs){Pr(),re(Bs)},Ir=function(){Pr();var Bs;Bs=sn(Qe),re(new ge(Bs))},Pr=function(){Qe.unbind("initialized",Zi),Qe.unbind("open",vn),Qe.unbind("error",Bn),Qe.unbind("closed",Ir)};return Qe.bind("initialized",Zi),Qe.bind("open",vn),Qe.bind("error",Bn),Qe.bind("closed",Ir),Qe.initialize(),{abort:()=>{Ne||(Pr(),fi?fi.close():Qe.close())},forceMinPriority:Bs=>{Ne||this.priority<Bs&&(fi?fi.close():Qe.close())}}}}function Ke(ce,q){return mt.defer(function(){q(ce)}),{abort:function(){},forceMinPriority:function(){}}}const{Transports:Mt}=Rn;var Ai=function(ce,q,re,Ne,Qe,fi){var Zi=Mt[re];if(!Zi)throw new xt(re);var vn=(!ce.enabledTransports||Ui(ce.enabledTransports,q)!==-1)&&(!ce.disabledTransports||Ui(ce.disabledTransports,q)===-1),Bn;return vn?(Qe=Object.assign({ignoreNullOrigin:ce.ignoreNullOrigin},Qe),Bn=new Qa(q,Ne,fi?fi.getAssistant(Zi):Zi,Qe)):Bn=Ii,Bn},Ii={isSupported:function(){return!1},connect:function(ce,q){var re=mt.defer(function(){q(new It)});return{abort:function(){re.ensureAborted()},forceMinPriority:function(){}}}};function Xr(ce){if(ce==null)throw"You must pass an options object";if(ce.cluster==null)throw"Options object must provide a cluster";"disableStats"in ce&&$i.warn("The disableStats option is deprecated in favor of enableStats")}const Un=(ce,q)=>{var re="socket_id="+encodeURIComponent(ce.socketId);for(var Ne in q.params)re+="&"+encodeURIComponent(Ne)+"="+encodeURIComponent(q.params[Ne]);if(q.paramsProvider!=null){let Qe=q.paramsProvider();for(var Ne in Qe)re+="&"+encodeURIComponent(Ne)+"="+encodeURIComponent(Qe[Ne])}return re};var ys=ce=>{if(typeof Rn.getAuthorizers()[ce.transport]>"u")throw`'${ce.transport}' is not a recognized auth transport`;return(q,re)=>{const Ne=Un(q,ce);Rn.getAuthorizers()[ce.transport](Rn,Ne,ce,he.UserAuthentication,re)}};const Kr=(ce,q)=>{var re="socket_id="+encodeURIComponent(ce.socketId);re+="&channel_name="+encodeURIComponent(ce.channelName);for(var Ne in q.params)re+="&"+encodeURIComponent(Ne)+"="+encodeURIComponent(q.params[Ne]);if(q.paramsProvider!=null){let Qe=q.paramsProvider();for(var Ne in Qe)re+="&"+encodeURIComponent(Ne)+"="+encodeURIComponent(Qe[Ne])}return re};var yo=ce=>{if(typeof Rn.getAuthorizers()[ce.transport]>"u")throw`'${ce.transport}' is not a recognized auth transport`;return(q,re)=>{const Ne=Kr(q,ce);Rn.getAuthorizers()[ce.transport](Rn,Ne,ce,he.ChannelAuthorization,re)}};const Po=(ce,q,re)=>{const Ne={authTransport:q.transport,authEndpoint:q.endpoint,auth:{params:q.params,headers:q.headers}};return(Qe,fi)=>{const Zi=ce.channel(Qe.channelName);re(Zi,Ne).authorize(Qe.socketId,fi)}};function Cn(ce,q){let re={activityTimeout:ce.activityTimeout||j.activityTimeout,cluster:ce.cluster,httpPath:ce.httpPath||j.httpPath,httpPort:ce.httpPort||j.httpPort,httpsPort:ce.httpsPort||j.httpsPort,pongTimeout:ce.pongTimeout||j.pongTimeout,statsHost:ce.statsHost||j.stats_host,unavailableTimeout:ce.unavailableTimeout||j.unavailableTimeout,wsPath:ce.wsPath||j.wsPath,wsPort:ce.wsPort||j.wsPort,wssPort:ce.wssPort||j.wssPort,enableStats:va(ce),httpHost:Co(ce),useTLS:Mi(ce),wsHost:So(ce),userAuthenticator:Eo(ce),channelAuthorizer:Ma(ce,q)};return"disabledTransports"in ce&&(re.disabledTransports=ce.disabledTransports),"enabledTransports"in ce&&(re.enabledTransports=ce.enabledTransports),"ignoreNullOrigin"in ce&&(re.ignoreNullOrigin=ce.ignoreNullOrigin),"timelineParams"in ce&&(re.timelineParams=ce.timelineParams),"nacl"in ce&&(re.nacl=ce.nacl),re}function Co(ce){return ce.httpHost?ce.httpHost:ce.cluster?`sockjs-${ce.cluster}.pusher.com`:j.httpHost}function So(ce){return ce.wsHost?ce.wsHost:Xo(ce.cluster)}function Xo(ce){return`ws-${ce}.pusher.com`}function Mi(ce){return Rn.getProtocol()==="https:"?!0:ce.forceTLS!==!1}function va(ce){return"enableStats"in ce?ce.enableStats:"disableStats"in ce?!ce.disableStats:!1}function Eo(ce){const q=Object.assign(Object.assign({},j.userAuthentication),ce.userAuthentication);return"customHandler"in q&&q.customHandler!=null?q.customHandler:ys(q)}function Fs(ce,q){let re;return"channelAuthorization"in ce?re=Object.assign(Object.assign({},j.channelAuthorization),ce.channelAuthorization):(re={transport:ce.authTransport||j.authTransport,endpoint:ce.authEndpoint||j.authEndpoint},"auth"in ce&&("params"in ce.auth&&(re.params=ce.auth.params),"headers"in ce.auth&&(re.headers=ce.auth.headers)),"authorizer"in ce&&(re.customHandler=Po(q,re,ce.authorizer))),re}function Ma(ce,q){const re=Fs(ce,q);return"customHandler"in re&&re.customHandler!=null?re.customHandler:yo(re)}class xa extends ir{constructor(q){super(function(re,Ne){$i.debug(`No callbacks on watchlist events for ${re}`)}),this.pusher=q,this.bindWatchlistInternalEvent()}handleEvent(q){q.data.events.forEach(re=>{this.emit(re.name,re)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",q=>{var re=q.event;re==="pusher_internal:watchlist_events"&&this.handleEvent(q)})}}function Oi(){let ce,q;return{promise:new Promise((Ne,Qe)=>{ce=Ne,q=Qe}),resolve:ce,reject:q}}var or=Oi;class ar extends ir{constructor(q){super(function(re,Ne){$i.debug("No callbacks on user for "+re)}),this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(re,Ne)=>{if(re){$i.warn(`Error during signin: ${re}`),this._cleanup();return}this.pusher.send_event("pusher:signin",{auth:Ne.auth,user_data:Ne.user_data})},this.pusher=q,this.pusher.connection.bind("state_change",({previous:re,current:Ne})=>{re!=="connected"&&Ne==="connected"&&this._signin(),re==="connected"&&Ne!=="connected"&&(this._cleanup(),this._newSigninPromiseIfNeeded())}),this.watchlist=new xa(q),this.pusher.connection.bind("message",re=>{var Ne=re.event;Ne==="pusher:signin_success"&&this._onSigninSuccess(re.data),this.serverToUserChannel&&this.serverToUserChannel.name===re.channel&&this.serverToUserChannel.handleEvent(re)})}signin(){this.signin_requested||(this.signin_requested=!0,this._signin())}_signin(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),this.pusher.connection.state==="connected"&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))}_onSigninSuccess(q){try{this.user_data=JSON.parse(q.user_data)}catch{$i.error(`Failed parsing user data after signin: ${q.user_data}`),this._cleanup();return}if(typeof this.user_data.id!="string"||this.user_data.id===""){$i.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),this._cleanup();return}this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){const q=re=>{re.subscriptionPending&&re.subscriptionCancelled?re.reinstateSubscription():!re.subscriptionPending&&this.pusher.connection.state==="connected"&&re.subscribe()};this.serverToUserChannel=new pn(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((re,Ne)=>{re.indexOf("pusher_internal:")===0||re.indexOf("pusher:")===0||this.emit(re,Ne)}),q(this.serverToUserChannel)}_cleanup(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested||this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:q,resolve:re}=or();q.done=!1;const Ne=()=>{q.done=!0};q.then(Ne).catch(Ne),this.signinDonePromise=q,this._signinDoneResolve=re}}class Yr{static ready(){Yr.isReady=!0;for(var q=0,re=Yr.instances.length;q<re;q++)Yr.instances[q].connect()}static getClientFeatures(){return _i(ai({ws:Rn.Transports.ws},function(q){return q.isSupported({})}))}constructor(q,re){tr(q),Xr(re),this.key=q,this.config=Cn(re,this),this.channels=Gn.createChannels(),this.global_emitter=new ir,this.sessionID=Rn.randomInt(1e9),this.timeline=new ca(this.key,this.sessionID,{cluster:this.config.cluster,features:Yr.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:Ca.INFO,version:j.VERSION}),this.config.enableStats&&(this.timelineSender=Gn.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+Rn.TimelineTransport.name}));var Ne=Qe=>Rn.getDefaultStrategy(this.config,Qe,Ai);this.connection=Gn.createConnectionManager(this.key,{getStrategy:Ne,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",()=>{this.subscribeAll(),this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())}),this.connection.bind("message",Qe=>{var fi=Qe.event,Zi=fi.indexOf("pusher_internal:")===0;if(Qe.channel){var vn=this.channel(Qe.channel);vn&&vn.handleEvent(Qe)}Zi||this.global_emitter.emit(Qe.event,Qe.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",Qe=>{$i.warn(Qe)}),Yr.instances.push(this),this.timeline.info({instances:Yr.instances.length}),this.user=new ar(this),Yr.isReady&&this.connect()}channel(q){return this.channels.find(q)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var q=this.connection.isUsingTLS(),re=this.timelineSender;this.timelineSenderTimer=new dn(6e4,function(){re.send(q)})}}disconnect(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)}bind(q,re,Ne){return this.global_emitter.bind(q,re,Ne),this}unbind(q,re,Ne){return this.global_emitter.unbind(q,re,Ne),this}bind_global(q){return this.global_emitter.bind_global(q),this}unbind_global(q){return this.global_emitter.unbind_global(q),this}unbind_all(q){return this.global_emitter.unbind_all(),this}subscribeAll(){var q;for(q in this.channels.channels)this.channels.channels.hasOwnProperty(q)&&this.subscribe(q)}subscribe(q){var re=this.channels.add(q,this);return re.subscriptionPending&&re.subscriptionCancelled?re.reinstateSubscription():!re.subscriptionPending&&this.connection.state==="connected"&&re.subscribe(),re}unsubscribe(q){var re=this.channels.find(q);re&&re.subscriptionPending?re.cancelSubscription():(re=this.channels.remove(q),re&&re.subscribed&&re.unsubscribe())}send_event(q,re,Ne){return this.connection.send_event(q,re,Ne)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}Yr.instances=[],Yr.isReady=!1,Yr.logToConsole=!1,Yr.Runtime=Rn,Yr.ScriptReceivers=Rn.ScriptReceivers,Yr.DependenciesReceivers=Rn.DependenciesReceivers,Yr.auth_callbacks=Rn.auth_callbacks;var ja=S.default=Yr;function tr(ce){if(ce==null)throw"You must pass your app key when you instantiate Pusher."}Rn.setup(Yr)})])})})(x0)),x0.exports}var Rk=Mk();const Ok=dv(Rk);window.axios=Io;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const hA=document.querySelector('meta[name="csrf-token"]');hA?(window.axios.defaults.headers.common["X-CSRF-TOKEN"]=hA.content,console.log("CSRF token attached")):console.error("CSRF token not found in <meta> tag.");window.Pusher=Ok;window.Echo=new Pk({broadcaster:"pusher",key:"12918a3a267a8c77bd96",cluster:"ap1",forceTLS:!0});/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function xw(a){const d=Object.create(null);for(const y of a.split(","))d[y]=1;return y=>y in d}const Rs={},op=[],iu=()=>{},p2=()=>!1,z_=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&(a.charCodeAt(2)>122||a.charCodeAt(2)<97),bw=a=>a.startsWith("onUpdate:"),sa=Object.assign,ww=(a,d)=>{const y=a.indexOf(d);y>-1&&a.splice(y,1)},Lk=Object.prototype.hasOwnProperty,Ds=(a,d)=>Lk.call(a,d),Jn=Array.isArray,ap=a=>k_(a)==="[object Map]",bp=a=>k_(a)==="[object Set]",dA=a=>k_(a)==="[object Date]",Ar=a=>typeof a=="function",zo=a=>typeof a=="string",Sc=a=>typeof a=="symbol",Ws=a=>a!==null&&typeof a=="object",m2=a=>(Ws(a)||Ar(a))&&Ar(a.then)&&Ar(a.catch),_2=Object.prototype.toString,k_=a=>_2.call(a),Dk=a=>k_(a).slice(8,-1),g2=a=>k_(a)==="[object Object]",Tw=a=>zo(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,lp=xw(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),fv=a=>{const d=Object.create(null);return(y=>d[y]||(d[y]=a(y)))},zk=/-\w/g,Pl=fv(a=>a.replace(zk,d=>d.slice(1).toUpperCase())),kk=/\B([A-Z])/g,Ju=fv(a=>a.replace(kk,"-$1").toLowerCase()),pv=fv(a=>a.charAt(0).toUpperCase()+a.slice(1)),Ry=fv(a=>a?`on${pv(a)}`:""),ll=(a,d)=>!Object.is(a,d),Oy=(a,...d)=>{for(let y=0;y<a.length;y++)a[y](...d)},y2=(a,d,y,S=!1)=>{Object.defineProperty(a,d,{configurable:!0,enumerable:!1,writable:S,value:y})},jy=a=>{const d=parseFloat(a);return isNaN(d)?a:d},Fk=a=>{const d=zo(a)?Number(a):NaN;return isNaN(d)?a:d};let fA;const mv=()=>fA||(fA=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function F_(a){if(Jn(a)){const d={};for(let y=0;y<a.length;y++){const S=a[y],P=zo(S)?Vk(S):F_(S);if(P)for(const M in P)d[M]=P[M]}return d}else if(zo(a)||Ws(a))return a}const Bk=/;(?![^(]*\))/g,Nk=/:([^]+)/,Uk=/\/\*[^]*?\*\//g;function Vk(a){const d={};return a.replace(Uk,"").split(Bk).forEach(y=>{if(y){const S=y.split(Nk);S.length>1&&(d[S[0].trim()]=S[1].trim())}}),d}function jh(a){let d="";if(zo(a))d=a;else if(Jn(a))for(let y=0;y<a.length;y++){const S=jh(a[y]);S&&(d+=S+" ")}else if(Ws(a))for(const y in a)a[y]&&(d+=y+" ");return d.trim()}const jk="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",$k=xw(jk);function v2(a){return!!a||a===""}function qk(a,d){if(a.length!==d.length)return!1;let y=!0;for(let S=0;y&&S<a.length;S++)y=Ud(a[S],d[S]);return y}function Ud(a,d){if(a===d)return!0;let y=dA(a),S=dA(d);if(y||S)return y&&S?a.getTime()===d.getTime():!1;if(y=Sc(a),S=Sc(d),y||S)return a===d;if(y=Jn(a),S=Jn(d),y||S)return y&&S?qk(a,d):!1;if(y=Ws(a),S=Ws(d),y||S){if(!y||!S)return!1;const P=Object.keys(a).length,M=Object.keys(d).length;if(P!==M)return!1;for(const k in a){const r=a.hasOwnProperty(k),j=d.hasOwnProperty(k);if(r&&!j||!r&&j||!Ud(a[k],d[k]))return!1}}return String(a)===String(d)}function Sw(a,d){return a.findIndex(y=>Ud(y,d))}const x2=a=>!!(a&&a.__v_isRef===!0),Ew=a=>zo(a)?a:a==null?"":Jn(a)||Ws(a)&&(a.toString===_2||!Ar(a.toString))?x2(a)?Ew(a.value):JSON.stringify(a,b2,2):String(a),b2=(a,d)=>x2(d)?b2(a,d.value):ap(d)?{[`Map(${d.size})`]:[...d.entries()].reduce((y,[S,P],M)=>(y[b0(S,M)+" =>"]=P,y),{})}:bp(d)?{[`Set(${d.size})`]:[...d.values()].map(y=>b0(y))}:Sc(d)?b0(d):Ws(d)&&!Jn(d)&&!g2(d)?String(d):d,b0=(a,d="")=>{var y;return Sc(a)?`Symbol(${(y=a.description)!=null?y:d})`:a};/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ba;class w2{constructor(d=!1){this.detached=d,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ba,!d&&Ba&&(this.index=(Ba.scopes||(Ba.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let d,y;if(this.scopes)for(d=0,y=this.scopes.length;d<y;d++)this.scopes[d].pause();for(d=0,y=this.effects.length;d<y;d++)this.effects[d].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let d,y;if(this.scopes)for(d=0,y=this.scopes.length;d<y;d++)this.scopes[d].resume();for(d=0,y=this.effects.length;d<y;d++)this.effects[d].resume()}}run(d){if(this._active){const y=Ba;try{return Ba=this,d()}finally{Ba=y}}}on(){++this._on===1&&(this.prevScope=Ba,Ba=this)}off(){this._on>0&&--this._on===0&&(Ba=this.prevScope,this.prevScope=void 0)}stop(d){if(this._active){this._active=!1;let y,S;for(y=0,S=this.effects.length;y<S;y++)this.effects[y].stop();for(this.effects.length=0,y=0,S=this.cleanups.length;y<S;y++)this.cleanups[y]();if(this.cleanups.length=0,this.scopes){for(y=0,S=this.scopes.length;y<S;y++)this.scopes[y].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!d){const P=this.parent.scopes.pop();P&&P!==this&&(this.parent.scopes[this.index]=P,P.index=this.index)}this.parent=void 0}}}function T2(a){return new w2(a)}function S2(){return Ba}function Gk(a,d=!1){Ba&&Ba.cleanups.push(a)}let so;const w0=new WeakSet;class E2{constructor(d){this.fn=d,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ba&&Ba.active&&Ba.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,w0.has(this)&&(w0.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||I2(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,pA(this),P2(this);const d=so,y=Tc;so=this,Tc=!0;try{return this.fn()}finally{C2(this),so=d,Tc=y,this.flags&=-3}}stop(){if(this.flags&1){for(let d=this.deps;d;d=d.nextDep)Pw(d);this.deps=this.depsTail=void 0,pA(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?w0.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Vb(this)&&this.run()}get dirty(){return Vb(this)}}let A2=0,c_,u_;function I2(a,d=!1){if(a.flags|=8,d){a.next=u_,u_=a;return}a.next=c_,c_=a}function Aw(){A2++}function Iw(){if(--A2>0)return;if(u_){let d=u_;for(u_=void 0;d;){const y=d.next;d.next=void 0,d.flags&=-9,d=y}}let a;for(;c_;){let d=c_;for(c_=void 0;d;){const y=d.next;if(d.next=void 0,d.flags&=-9,d.flags&1)try{d.trigger()}catch(S){a||(a=S)}d=y}}if(a)throw a}function P2(a){for(let d=a.deps;d;d=d.nextDep)d.version=-1,d.prevActiveLink=d.dep.activeLink,d.dep.activeLink=d}function C2(a){let d,y=a.depsTail,S=y;for(;S;){const P=S.prevDep;S.version===-1?(S===y&&(y=P),Pw(S),Hk(S)):d=S,S.dep.activeLink=S.prevActiveLink,S.prevActiveLink=void 0,S=P}a.deps=d,a.depsTail=y}function Vb(a){for(let d=a.deps;d;d=d.nextDep)if(d.dep.version!==d.version||d.dep.computed&&(M2(d.dep.computed)||d.dep.version!==d.version))return!0;return!!a._dirty}function M2(a){if(a.flags&4&&!(a.flags&16)||(a.flags&=-17,a.globalVersion===x_)||(a.globalVersion=x_,!a.isSSR&&a.flags&128&&(!a.deps&&!a._dirty||!Vb(a))))return;a.flags|=2;const d=a.dep,y=so,S=Tc;so=a,Tc=!0;try{P2(a);const P=a.fn(a._value);(d.version===0||ll(P,a._value))&&(a.flags|=128,a._value=P,d.version++)}catch(P){throw d.version++,P}finally{so=y,Tc=S,C2(a),a.flags&=-3}}function Pw(a,d=!1){const{dep:y,prevSub:S,nextSub:P}=a;if(S&&(S.nextSub=P,a.prevSub=void 0),P&&(P.prevSub=S,a.nextSub=void 0),y.subs===a&&(y.subs=S,!S&&y.computed)){y.computed.flags&=-5;for(let M=y.computed.deps;M;M=M.nextDep)Pw(M,!0)}!d&&!--y.sc&&y.map&&y.map.delete(y.key)}function Hk(a){const{prevDep:d,nextDep:y}=a;d&&(d.nextDep=y,a.prevDep=void 0),y&&(y.prevDep=d,a.nextDep=void 0)}let Tc=!0;const R2=[];function Xu(){R2.push(Tc),Tc=!1}function Ku(){const a=R2.pop();Tc=a===void 0?!0:a}function pA(a){const{cleanup:d}=a;if(a.cleanup=void 0,d){const y=so;so=void 0;try{d()}finally{so=y}}}let x_=0,Zk=class{constructor(d,y){this.sub=d,this.dep=y,this.version=y.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}};class _v{constructor(d){this.computed=d,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(d){if(!so||!Tc||so===this.computed)return;let y=this.activeLink;if(y===void 0||y.sub!==so)y=this.activeLink=new Zk(so,this),so.deps?(y.prevDep=so.depsTail,so.depsTail.nextDep=y,so.depsTail=y):so.deps=so.depsTail=y,O2(y);else if(y.version===-1&&(y.version=this.version,y.nextDep)){const S=y.nextDep;S.prevDep=y.prevDep,y.prevDep&&(y.prevDep.nextDep=S),y.prevDep=so.depsTail,y.nextDep=void 0,so.depsTail.nextDep=y,so.depsTail=y,so.deps===y&&(so.deps=S)}return y}trigger(d){this.version++,x_++,this.notify(d)}notify(d){Aw();try{for(let y=this.subs;y;y=y.prevSub)y.sub.notify()&&y.sub.dep.notify()}finally{Iw()}}}function O2(a){if(a.dep.sc++,a.sub.flags&4){const d=a.dep.computed;if(d&&!a.dep.subs){d.flags|=20;for(let S=d.deps;S;S=S.nextDep)O2(S)}const y=a.dep.subs;y!==a&&(a.prevSub=y,y&&(y.nextSub=a)),a.dep.subs=a}}const $y=new WeakMap,Dd=Symbol(""),jb=Symbol(""),b_=Symbol("");function Na(a,d,y){if(Tc&&so){let S=$y.get(a);S||$y.set(a,S=new Map);let P=S.get(y);P||(S.set(y,P=new _v),P.map=S,P.key=y),P.track()}}function $u(a,d,y,S,P,M){const k=$y.get(a);if(!k){x_++;return}const r=j=>{j&&j.trigger()};if(Aw(),d==="clear")k.forEach(r);else{const j=Jn(a),H=j&&Tw(y);if(j&&y==="length"){const W=Number(S);k.forEach((ee,le)=>{(le==="length"||le===b_||!Sc(le)&&le>=W)&&r(ee)})}else switch((y!==void 0||k.has(void 0))&&r(k.get(y)),H&&r(k.get(b_)),d){case"add":j?H&&r(k.get("length")):(r(k.get(Dd)),ap(a)&&r(k.get(jb)));break;case"delete":j||(r(k.get(Dd)),ap(a)&&r(k.get(jb)));break;case"set":ap(a)&&r(k.get(Dd));break}}Iw()}function Wk(a,d){const y=$y.get(a);return y&&y.get(d)}function ip(a){const d=hs(a);return d===a?d:(Na(d,"iterate",b_),Xl(a)?d:d.map(Sa))}function gv(a){return Na(a=hs(a),"iterate",b_),a}const Xk={__proto__:null,[Symbol.iterator](){return T0(this,Symbol.iterator,Sa)},concat(...a){return ip(this).concat(...a.map(d=>Jn(d)?ip(d):d))},entries(){return T0(this,"entries",a=>(a[1]=Sa(a[1]),a))},every(a,d){return Nu(this,"every",a,d,void 0,arguments)},filter(a,d){return Nu(this,"filter",a,d,y=>y.map(Sa),arguments)},find(a,d){return Nu(this,"find",a,d,Sa,arguments)},findIndex(a,d){return Nu(this,"findIndex",a,d,void 0,arguments)},findLast(a,d){return Nu(this,"findLast",a,d,Sa,arguments)},findLastIndex(a,d){return Nu(this,"findLastIndex",a,d,void 0,arguments)},forEach(a,d){return Nu(this,"forEach",a,d,void 0,arguments)},includes(...a){return S0(this,"includes",a)},indexOf(...a){return S0(this,"indexOf",a)},join(a){return ip(this).join(a)},lastIndexOf(...a){return S0(this,"lastIndexOf",a)},map(a,d){return Nu(this,"map",a,d,void 0,arguments)},pop(){return e_(this,"pop")},push(...a){return e_(this,"push",a)},reduce(a,...d){return mA(this,"reduce",a,d)},reduceRight(a,...d){return mA(this,"reduceRight",a,d)},shift(){return e_(this,"shift")},some(a,d){return Nu(this,"some",a,d,void 0,arguments)},splice(...a){return e_(this,"splice",a)},toReversed(){return ip(this).toReversed()},toSorted(a){return ip(this).toSorted(a)},toSpliced(...a){return ip(this).toSpliced(...a)},unshift(...a){return e_(this,"unshift",a)},values(){return T0(this,"values",Sa)}};function T0(a,d,y){const S=gv(a),P=S[d]();return S!==a&&!Xl(a)&&(P._next=P.next,P.next=()=>{const M=P._next();return M.done||(M.value=y(M.value)),M}),P}const Kk=Array.prototype;function Nu(a,d,y,S,P,M){const k=gv(a),r=k!==a&&!Xl(a),j=k[d];if(j!==Kk[d]){const ee=j.apply(a,M);return r?Sa(ee):ee}let H=y;k!==a&&(r?H=function(ee,le){return y.call(this,Sa(ee),le,a)}:y.length>2&&(H=function(ee,le){return y.call(this,ee,le,a)}));const W=j.call(k,H,S);return r&&P?P(W):W}function mA(a,d,y,S){const P=gv(a);let M=y;return P!==a&&(Xl(a)?y.length>3&&(M=function(k,r,j){return y.call(this,k,r,j,a)}):M=function(k,r,j){return y.call(this,k,Sa(r),j,a)}),P[d](M,...S)}function S0(a,d,y){const S=hs(a);Na(S,"iterate",b_);const P=S[d](...y);return(P===-1||P===!1)&&Rw(y[0])?(y[0]=hs(y[0]),S[d](...y)):P}function e_(a,d,y=[]){Xu(),Aw();const S=hs(a)[d].apply(a,y);return Iw(),Ku(),S}const Yk=xw("__proto__,__v_isRef,__isVue"),L2=new Set(Object.getOwnPropertyNames(Symbol).filter(a=>a!=="arguments"&&a!=="caller").map(a=>Symbol[a]).filter(Sc));function Jk(a){Sc(a)||(a=String(a));const d=hs(this);return Na(d,"has",a),d.hasOwnProperty(a)}class D2{constructor(d=!1,y=!1){this._isReadonly=d,this._isShallow=y}get(d,y,S){if(y==="__v_skip")return d.__v_skip;const P=this._isReadonly,M=this._isShallow;if(y==="__v_isReactive")return!P;if(y==="__v_isReadonly")return P;if(y==="__v_isShallow")return M;if(y==="__v_raw")return S===(P?M?lF:B2:M?F2:k2).get(d)||Object.getPrototypeOf(d)===Object.getPrototypeOf(S)?d:void 0;const k=Jn(d);if(!P){let j;if(k&&(j=Xk[y]))return j;if(y==="hasOwnProperty")return Jk}const r=Reflect.get(d,y,Uo(d)?d:S);if((Sc(y)?L2.has(y):Yk(y))||(P||Na(d,"get",y),M))return r;if(Uo(r)){const j=k&&Tw(y)?r:r.value;return P&&Ws(j)?qb(j):j}return Ws(r)?P?qb(r):B_(r):r}}class z2 extends D2{constructor(d=!1){super(!1,d)}set(d,y,S,P){let M=d[y];if(!this._isShallow){const j=$h(M);if(!Xl(S)&&!$h(S)&&(M=hs(M),S=hs(S)),!Jn(d)&&Uo(M)&&!Uo(S))return j||(M.value=S),!0}const k=Jn(d)&&Tw(y)?Number(y)<d.length:Ds(d,y),r=Reflect.set(d,y,S,Uo(d)?d:P);return d===hs(P)&&(k?ll(S,M)&&$u(d,"set",y,S):$u(d,"add",y,S)),r}deleteProperty(d,y){const S=Ds(d,y);d[y];const P=Reflect.deleteProperty(d,y);return P&&S&&$u(d,"delete",y,void 0),P}has(d,y){const S=Reflect.has(d,y);return(!Sc(y)||!L2.has(y))&&Na(d,"has",y),S}ownKeys(d){return Na(d,"iterate",Jn(d)?"length":Dd),Reflect.ownKeys(d)}}class Qk extends D2{constructor(d=!1){super(!0,d)}set(d,y){return!0}deleteProperty(d,y){return!0}}const eF=new z2,tF=new Qk,iF=new z2(!0);const $b=a=>a,_y=a=>Reflect.getPrototypeOf(a);function nF(a,d,y){return function(...S){const P=this.__v_raw,M=hs(P),k=ap(M),r=a==="entries"||a===Symbol.iterator&&k,j=a==="keys"&&k,H=P[a](...S),W=y?$b:d?qy:Sa;return!d&&Na(M,"iterate",j?jb:Dd),{next(){const{value:ee,done:le}=H.next();return le?{value:ee,done:le}:{value:r?[W(ee[0]),W(ee[1])]:W(ee),done:le}},[Symbol.iterator](){return this}}}}function gy(a){return function(...d){return a==="delete"?!1:a==="clear"?void 0:this}}function rF(a,d){const y={get(P){const M=this.__v_raw,k=hs(M),r=hs(P);a||(ll(P,r)&&Na(k,"get",P),Na(k,"get",r));const{has:j}=_y(k),H=d?$b:a?qy:Sa;if(j.call(k,P))return H(M.get(P));if(j.call(k,r))return H(M.get(r));M!==k&&M.get(P)},get size(){const P=this.__v_raw;return!a&&Na(hs(P),"iterate",Dd),P.size},has(P){const M=this.__v_raw,k=hs(M),r=hs(P);return a||(ll(P,r)&&Na(k,"has",P),Na(k,"has",r)),P===r?M.has(P):M.has(P)||M.has(r)},forEach(P,M){const k=this,r=k.__v_raw,j=hs(r),H=d?$b:a?qy:Sa;return!a&&Na(j,"iterate",Dd),r.forEach((W,ee)=>P.call(M,H(W),H(ee),k))}};return sa(y,a?{add:gy("add"),set:gy("set"),delete:gy("delete"),clear:gy("clear")}:{add(P){!d&&!Xl(P)&&!$h(P)&&(P=hs(P));const M=hs(this);return _y(M).has.call(M,P)||(M.add(P),$u(M,"add",P,P)),this},set(P,M){!d&&!Xl(M)&&!$h(M)&&(M=hs(M));const k=hs(this),{has:r,get:j}=_y(k);let H=r.call(k,P);H||(P=hs(P),H=r.call(k,P));const W=j.call(k,P);return k.set(P,M),H?ll(M,W)&&$u(k,"set",P,M):$u(k,"add",P,M),this},delete(P){const M=hs(this),{has:k,get:r}=_y(M);let j=k.call(M,P);j||(P=hs(P),j=k.call(M,P)),r&&r.call(M,P);const H=M.delete(P);return j&&$u(M,"delete",P,void 0),H},clear(){const P=hs(this),M=P.size!==0,k=P.clear();return M&&$u(P,"clear",void 0,void 0),k}}),["keys","values","entries",Symbol.iterator].forEach(P=>{y[P]=nF(P,a,d)}),y}function Cw(a,d){const y=rF(a,d);return(S,P,M)=>P==="__v_isReactive"?!a:P==="__v_isReadonly"?a:P==="__v_raw"?S:Reflect.get(Ds(y,P)&&P in S?y:S,P,M)}const sF={get:Cw(!1,!1)},oF={get:Cw(!1,!0)},aF={get:Cw(!0,!1)};const k2=new WeakMap,F2=new WeakMap,B2=new WeakMap,lF=new WeakMap;function cF(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function uF(a){return a.__v_skip||!Object.isExtensible(a)?0:cF(Dk(a))}function B_(a){return $h(a)?a:Mw(a,!1,eF,sF,k2)}function hF(a){return Mw(a,!1,iF,oF,F2)}function qb(a){return Mw(a,!0,tF,aF,B2)}function Mw(a,d,y,S,P){if(!Ws(a)||a.__v_raw&&!(d&&a.__v_isReactive))return a;const M=uF(a);if(M===0)return a;const k=P.get(a);if(k)return k;const r=new Proxy(a,M===2?S:y);return P.set(a,r),r}function Hu(a){return $h(a)?Hu(a.__v_raw):!!(a&&a.__v_isReactive)}function $h(a){return!!(a&&a.__v_isReadonly)}function Xl(a){return!!(a&&a.__v_isShallow)}function Rw(a){return a?!!a.__v_raw:!1}function hs(a){const d=a&&a.__v_raw;return d?hs(d):a}function w_(a){return!Ds(a,"__v_skip")&&Object.isExtensible(a)&&y2(a,"__v_skip",!0),a}const Sa=a=>Ws(a)?B_(a):a,qy=a=>Ws(a)?qb(a):a;function Uo(a){return a?a.__v_isRef===!0:!1}function Vd(a){return N2(a,!1)}function dF(a){return N2(a,!0)}function N2(a,d){return Uo(a)?a:new fF(a,d)}class fF{constructor(d,y){this.dep=new _v,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=y?d:hs(d),this._value=y?d:Sa(d),this.__v_isShallow=y}get value(){return this.dep.track(),this._value}set value(d){const y=this._rawValue,S=this.__v_isShallow||Xl(d)||$h(d);d=S?d:hs(d),ll(d,y)&&(this._rawValue=d,this._value=S?d:Sa(d),this.dep.trigger())}}function U2(a){return Uo(a)?a.value:a}const pF={get:(a,d,y)=>d==="__v_raw"?a:U2(Reflect.get(a,d,y)),set:(a,d,y,S)=>{const P=a[d];return Uo(P)&&!Uo(y)?(P.value=y,!0):Reflect.set(a,d,y,S)}};function V2(a){return Hu(a)?a:new Proxy(a,pF)}class mF{constructor(d){this.__v_isRef=!0,this._value=void 0;const y=this.dep=new _v,{get:S,set:P}=d(y.track.bind(y),y.trigger.bind(y));this._get=S,this._set=P}get value(){return this._value=this._get()}set value(d){this._set(d)}}function _F(a){return new mF(a)}function gF(a){const d=Jn(a)?new Array(a.length):{};for(const y in a)d[y]=vF(a,y);return d}class yF{constructor(d,y,S){this._object=d,this._key=y,this._defaultValue=S,this.__v_isRef=!0,this._value=void 0}get value(){const d=this._object[this._key];return this._value=d===void 0?this._defaultValue:d}set value(d){this._object[this._key]=d}get dep(){return Wk(hs(this._object),this._key)}}function vF(a,d,y){const S=a[d];return Uo(S)?S:new yF(a,d,y)}class xF{constructor(d,y,S){this.fn=d,this.setter=y,this._value=void 0,this.dep=new _v(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=x_-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!y,this.isSSR=S}notify(){if(this.flags|=16,!(this.flags&8)&&so!==this)return I2(this,!0),!0}get value(){const d=this.dep.track();return M2(this),d&&(d.version=this.dep.version),this._value}set value(d){this.setter&&this.setter(d)}}function bF(a,d,y=!1){let S,P;return Ar(a)?S=a:(S=a.get,P=a.set),new xF(S,P,y)}const yy={},Gy=new WeakMap;let Ad;function wF(a,d=!1,y=Ad){if(y){let S=Gy.get(y);S||Gy.set(y,S=[]),S.push(a)}}function TF(a,d,y=Rs){const{immediate:S,deep:P,once:M,scheduler:k,augmentJob:r,call:j}=y,H=ge=>P?ge:Xl(ge)||P===!1||P===0?qu(ge,1):qu(ge);let W,ee,le,pe,se=!1,he=!1;if(Uo(a)?(ee=()=>a.value,se=Xl(a)):Hu(a)?(ee=()=>H(a),se=!0):Jn(a)?(he=!0,se=a.some(ge=>Hu(ge)||Xl(ge)),ee=()=>a.map(ge=>{if(Uo(ge))return ge.value;if(Hu(ge))return H(ge);if(Ar(ge))return j?j(ge,2):ge()})):Ar(a)?d?ee=j?()=>j(a,2):a:ee=()=>{if(le){Xu();try{le()}finally{Ku()}}const ge=Ad;Ad=W;try{return j?j(a,3,[pe]):a(pe)}finally{Ad=ge}}:ee=iu,d&&P){const ge=ee,Ge=P===!0?1/0:P;ee=()=>qu(ge(),Ge)}const Te=S2(),Se=()=>{W.stop(),Te&&Te.active&&ww(Te.effects,W)};if(M&&d){const ge=d;d=(...Ge)=>{ge(...Ge),Se()}}let fe=he?new Array(a.length).fill(yy):yy;const oe=ge=>{if(!(!(W.flags&1)||!W.dirty&&!ge))if(d){const Ge=W.run();if(P||se||(he?Ge.some((xt,It)=>ll(xt,fe[It])):ll(Ge,fe))){le&&le();const xt=Ad;Ad=W;try{const It=[Ge,fe===yy?void 0:he&&fe[0]===yy?[]:fe,pe];fe=Ge,j?j(d,3,It):d(...It)}finally{Ad=xt}}}else W.run()};return r&&r(oe),W=new E2(ee),W.scheduler=k?()=>k(oe,!1):oe,pe=ge=>wF(ge,!1,W),le=W.onStop=()=>{const ge=Gy.get(W);if(ge){if(j)j(ge,4);else for(const Ge of ge)Ge();Gy.delete(W)}},d?S?oe(!0):fe=W.run():k?k(oe.bind(null,!0),!0):W.run(),Se.pause=W.pause.bind(W),Se.resume=W.resume.bind(W),Se.stop=Se,Se}function qu(a,d=1/0,y){if(d<=0||!Ws(a)||a.__v_skip||(y=y||new Map,(y.get(a)||0)>=d))return a;if(y.set(a,d),d--,Uo(a))qu(a.value,d,y);else if(Jn(a))for(let S=0;S<a.length;S++)qu(a[S],d,y);else if(bp(a)||ap(a))a.forEach(S=>{qu(S,d,y)});else if(g2(a)){for(const S in a)qu(a[S],d,y);for(const S of Object.getOwnPropertySymbols(a))Object.prototype.propertyIsEnumerable.call(a,S)&&qu(a[S],d,y)}return a}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function N_(a,d,y,S){try{return S?a(...S):a()}catch(P){yv(P,d,y)}}function Ec(a,d,y,S){if(Ar(a)){const P=N_(a,d,y,S);return P&&m2(P)&&P.catch(M=>{yv(M,d,y)}),P}if(Jn(a)){const P=[];for(let M=0;M<a.length;M++)P.push(Ec(a[M],d,y,S));return P}}function yv(a,d,y,S=!0){const P=d?d.vnode:null,{errorHandler:M,throwUnhandledErrorInProduction:k}=d&&d.appContext.config||Rs;if(d){let r=d.parent;const j=d.proxy,H=`https://vuejs.org/error-reference/#runtime-${y}`;for(;r;){const W=r.ec;if(W){for(let ee=0;ee<W.length;ee++)if(W[ee](a,j,H)===!1)return}r=r.parent}if(M){Xu(),N_(M,null,10,[a,j,H]),Ku();return}}SF(a,y,P,S,k)}function SF(a,d,y,S=!0,P=!1){if(P)throw a;console.error(a)}const Ya=[];let Qc=-1;const cp=[];let Nh=null,sp=0;const j2=Promise.resolve();let Hy=null;function vv(a){const d=Hy||j2;return a?d.then(this?a.bind(this):a):d}function EF(a){let d=Qc+1,y=Ya.length;for(;d<y;){const S=d+y>>>1,P=Ya[S],M=T_(P);M<a||M===a&&P.flags&2?d=S+1:y=S}return d}function Ow(a){if(!(a.flags&1)){const d=T_(a),y=Ya[Ya.length-1];!y||!(a.flags&2)&&d>=T_(y)?Ya.push(a):Ya.splice(EF(d),0,a),a.flags|=1,$2()}}function $2(){Hy||(Hy=j2.then(q2))}function AF(a){Jn(a)?cp.push(...a):Nh&&a.id===-1?Nh.splice(sp+1,0,a):a.flags&1||(cp.push(a),a.flags|=1),$2()}function _A(a,d,y=Qc+1){for(;y<Ya.length;y++){const S=Ya[y];if(S&&S.flags&2){if(a&&S.id!==a.uid)continue;Ya.splice(y,1),y--,S.flags&4&&(S.flags&=-2),S(),S.flags&4||(S.flags&=-2)}}}function Zy(a){if(cp.length){const d=[...new Set(cp)].sort((y,S)=>T_(y)-T_(S));if(cp.length=0,Nh){Nh.push(...d);return}for(Nh=d,sp=0;sp<Nh.length;sp++){const y=Nh[sp];y.flags&4&&(y.flags&=-2),y.flags&8||y(),y.flags&=-2}Nh=null,sp=0}}const T_=a=>a.id==null?a.flags&2?-1:1/0:a.id;function q2(a){try{for(Qc=0;Qc<Ya.length;Qc++){const d=Ya[Qc];d&&!(d.flags&8)&&(d.flags&4&&(d.flags&=-2),N_(d,d.i,d.i?15:14),d.flags&4||(d.flags&=-2))}}finally{for(;Qc<Ya.length;Qc++){const d=Ya[Qc];d&&(d.flags&=-2)}Qc=-1,Ya.length=0,Zy(),Hy=null,(Ya.length||cp.length)&&q2()}}let Aa=null,G2=null;function Wy(a){const d=Aa;return Aa=a,G2=a&&a.type.__scopeId||null,d}function U_(a,d=Aa,y){if(!d||a._n)return a;const S=(...P)=>{S._d&&Yy(-1);const M=Wy(d);let k;try{k=a(...P)}finally{Wy(M),S._d&&Yy(1)}return k};return S._n=!0,S._c=!0,S._d=!0,S}function P8(a,d){if(Aa===null)return a;const y=Sv(Aa),S=a.dirs||(a.dirs=[]);for(let P=0;P<d.length;P++){let[M,k,r,j=Rs]=d[P];M&&(Ar(M)&&(M={mounted:M,updated:M}),M.deep&&qu(k),S.push({dir:M,instance:y,value:k,oldValue:void 0,arg:r,modifiers:j}))}return a}function eu(a,d,y,S){const P=a.dirs,M=d&&d.dirs;for(let k=0;k<P.length;k++){const r=P[k];M&&(r.oldValue=M[k].value);let j=r.dir[S];j&&(Xu(),Ec(j,y,8,[a.el,r,a,d]),Ku())}}const IF=Symbol("_vte"),H2=a=>a.__isTeleport,ju=Symbol("_leaveCb"),vy=Symbol("_enterCb");function Z2(){const a={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Dw(()=>{a.isMounted=!0}),tC(()=>{a.isUnmounting=!0}),a}const ql=[Function,Array],W2={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ql,onEnter:ql,onAfterEnter:ql,onEnterCancelled:ql,onBeforeLeave:ql,onLeave:ql,onAfterLeave:ql,onLeaveCancelled:ql,onBeforeAppear:ql,onAppear:ql,onAfterAppear:ql,onAppearCancelled:ql},X2=a=>{const d=a.subTree;return d.component?X2(d.component):d},PF={name:"BaseTransition",props:W2,setup(a,{slots:d}){const y=wp(),S=Z2();return()=>{const P=d.default&&Lw(d.default(),!0);if(!P||!P.length)return;const M=K2(P),k=hs(a),{mode:r}=k;if(S.isLeaving)return E0(M);const j=gA(M);if(!j)return E0(M);let H=S_(j,k,S,y,ee=>H=ee);j.type!==Ea&&jd(j,H);let W=y.subTree&&gA(y.subTree);if(W&&W.type!==Ea&&!Id(W,j)&&X2(y).type!==Ea){let ee=S_(W,k,S,y);if(jd(W,ee),r==="out-in"&&j.type!==Ea)return S.isLeaving=!0,ee.afterLeave=()=>{S.isLeaving=!1,y.job.flags&8||y.update(),delete ee.afterLeave,W=void 0},E0(M);r==="in-out"&&j.type!==Ea?ee.delayLeave=(le,pe,se)=>{const he=Y2(S,W);he[String(W.key)]=W,le[ju]=()=>{pe(),le[ju]=void 0,delete H.delayedLeave,W=void 0},H.delayedLeave=()=>{se(),delete H.delayedLeave,W=void 0}}:W=void 0}else W&&(W=void 0);return M}}};function K2(a){let d=a[0];if(a.length>1){for(const y of a)if(y.type!==Ea){d=y;break}}return d}const CF=PF;function Y2(a,d){const{leavingVNodes:y}=a;let S=y.get(d.type);return S||(S=Object.create(null),y.set(d.type,S)),S}function S_(a,d,y,S,P){const{appear:M,mode:k,persisted:r=!1,onBeforeEnter:j,onEnter:H,onAfterEnter:W,onEnterCancelled:ee,onBeforeLeave:le,onLeave:pe,onAfterLeave:se,onLeaveCancelled:he,onBeforeAppear:Te,onAppear:Se,onAfterAppear:fe,onAppearCancelled:oe}=d,ge=String(a.key),Ge=Y2(y,a),xt=(Be,De)=>{Be&&Ec(Be,S,9,De)},It=(Be,De)=>{const Oe=De[1];xt(Be,De),Jn(Be)?Be.every(He=>He.length<=1)&&Oe():Be.length<=1&&Oe()},ot={mode:k,persisted:r,beforeEnter(Be){let De=j;if(!y.isMounted)if(M)De=Te||j;else return;Be[ju]&&Be[ju](!0);const Oe=Ge[ge];Oe&&Id(a,Oe)&&Oe.el[ju]&&Oe.el[ju](),xt(De,[Be])},enter(Be){let De=H,Oe=W,He=ee;if(!y.isMounted)if(M)De=Se||H,Oe=fe||W,He=oe||ee;else return;let ft=!1;const tt=Be[vy]=At=>{ft||(ft=!0,At?xt(He,[Be]):xt(Oe,[Be]),ot.delayedLeave&&ot.delayedLeave(),Be[vy]=void 0)};De?It(De,[Be,tt]):tt()},leave(Be,De){const Oe=String(a.key);if(Be[vy]&&Be[vy](!0),y.isUnmounting)return De();xt(le,[Be]);let He=!1;const ft=Be[ju]=tt=>{He||(He=!0,De(),tt?xt(he,[Be]):xt(se,[Be]),Be[ju]=void 0,Ge[Oe]===a&&delete Ge[Oe])};Ge[Oe]=a,pe?It(pe,[Be,ft]):ft()},clone(Be){const De=S_(Be,d,y,S,P);return P&&P(De),De}};return ot}function E0(a){if(xv(a))return a=qh(a),a.children=null,a}function gA(a){if(!xv(a))return H2(a.type)&&a.children?K2(a.children):a;if(a.component)return a.component.subTree;const{shapeFlag:d,children:y}=a;if(y){if(d&16)return y[0];if(d&32&&Ar(y.default))return y.default()}}function jd(a,d){a.shapeFlag&6&&a.component?(a.transition=d,jd(a.component.subTree,d)):a.shapeFlag&128?(a.ssContent.transition=d.clone(a.ssContent),a.ssFallback.transition=d.clone(a.ssFallback)):a.transition=d}function Lw(a,d=!1,y){let S=[],P=0;for(let M=0;M<a.length;M++){let k=a[M];const r=y==null?k.key:String(y)+String(k.key!=null?k.key:M);k.type===na?(k.patchFlag&128&&P++,S=S.concat(Lw(k.children,d,r))):(d||k.type!==Ea)&&S.push(r!=null?qh(k,{key:r}):k)}if(P>1)for(let M=0;M<S.length;M++)S[M].patchFlag=-2;return S}function Qu(a,d){return Ar(a)?sa({name:a.name},d,{setup:a}):a}function J2(a){a.ids=[a.ids[0]+a.ids[2]+++"-",0,0]}const Xy=new WeakMap;function up(a,d,y,S,P=!1){if(Jn(a)){a.forEach((se,he)=>up(se,d&&(Jn(d)?d[he]:d),y,S,P));return}if(zd(S)&&!P){S.shapeFlag&512&&S.type.__asyncResolved&&S.component.subTree.component&&up(a,d,y,S.component.subTree);return}const M=S.shapeFlag&4?Sv(S.component):S.el,k=P?null:M,{i:r,r:j}=a,H=d&&d.r,W=r.refs===Rs?r.refs={}:r.refs,ee=r.setupState,le=hs(ee),pe=ee===Rs?p2:se=>Ds(le,se);if(H!=null&&H!==j){if(yA(d),zo(H))W[H]=null,pe(H)&&(ee[H]=null);else if(Uo(H)){H.value=null;const se=d;se.k&&(W[se.k]=null)}}if(Ar(j))N_(j,r,12,[k,W]);else{const se=zo(j),he=Uo(j);if(se||he){const Te=()=>{if(a.f){const Se=se?pe(j)?ee[j]:W[j]:j.value;if(P)Jn(Se)&&ww(Se,M);else if(Jn(Se))Se.includes(M)||Se.push(M);else if(se)W[j]=[M],pe(j)&&(ee[j]=W[j]);else{const fe=[M];j.value=fe,a.k&&(W[a.k]=fe)}}else se?(W[j]=k,pe(j)&&(ee[j]=k)):he&&(j.value=k,a.k&&(W[a.k]=k))};if(k){const Se=()=>{Te(),Xy.delete(a)};Se.id=-1,Xy.set(a,Se),Tl(Se,y)}else yA(a),Te()}}}function yA(a){const d=Xy.get(a);d&&(d.flags|=8,Xy.delete(a))}let vA=!1;const np=()=>{vA||(console.error("Hydration completed but contains mismatches."),vA=!0)},MF=a=>a.namespaceURI.includes("svg")&&a.tagName!=="foreignObject",RF=a=>a.namespaceURI.includes("MathML"),xy=a=>{if(a.nodeType===1){if(MF(a))return"svg";if(RF(a))return"mathml"}},by=a=>a.nodeType===8;function OF(a){const{mt:d,p:y,o:{patchProp:S,createText:P,nextSibling:M,parentNode:k,remove:r,insert:j,createComment:H}}=a,W=(oe,ge)=>{if(!ge.hasChildNodes()){y(null,oe,ge),Zy(),ge._vnode=oe;return}ee(ge.firstChild,oe,null,null,null),Zy(),ge._vnode=oe},ee=(oe,ge,Ge,xt,It,ot=!1)=>{ot=ot||!!ge.dynamicChildren;const Be=by(oe)&&oe.data==="[",De=()=>he(oe,ge,Ge,xt,It,Be),{type:Oe,ref:He,shapeFlag:ft,patchFlag:tt}=ge;let At=oe.nodeType;ge.el=oe,tt===-2&&(ot=!1,ge.dynamicChildren=null);let yt=null;switch(Oe){case Fd:At!==3?ge.children===""?(j(ge.el=P(""),k(oe),oe),yt=oe):yt=De():(oe.data!==ge.children&&(np(),oe.data=ge.children),yt=M(oe));break;case Ea:fe(oe)?(yt=M(oe),Se(ge.el=oe.content.firstChild,oe,Ge)):At!==8||Be?yt=De():yt=M(oe);break;case p_:if(Be&&(oe=M(oe),At=oe.nodeType),At===1||At===3){yt=oe;const si=!ge.children.length;for(let wt=0;wt<ge.staticCount;wt++)si&&(ge.children+=yt.nodeType===1?yt.outerHTML:yt.data),wt===ge.staticCount-1&&(ge.anchor=yt),yt=M(yt);return Be?M(yt):yt}else De();break;case na:Be?yt=se(oe,ge,Ge,xt,It,ot):yt=De();break;default:if(ft&1)(At!==1||ge.type.toLowerCase()!==oe.tagName.toLowerCase())&&!fe(oe)?yt=De():yt=le(oe,ge,Ge,xt,It,ot);else if(ft&6){ge.slotScopeIds=It;const si=k(oe);if(Be?yt=Te(oe):by(oe)&&oe.data==="teleport start"?yt=Te(oe,oe.data,"teleport end"):yt=M(oe),d(ge,si,null,Ge,xt,xy(si),ot),zd(ge)&&!ge.type.__asyncResolved){let wt;Be?(wt=ra(na),wt.anchor=yt?yt.previousSibling:si.lastChild):wt=oe.nodeType===3?V_(""):ra("div"),wt.el=oe,ge.component.subTree=wt}}else ft&64?At!==8?yt=De():yt=ge.type.hydrate(oe,ge,Ge,xt,It,ot,a,pe):ft&128&&(yt=ge.type.hydrate(oe,ge,Ge,xt,xy(k(oe)),It,ot,a,ee))}return He!=null&&up(He,null,xt,ge),yt},le=(oe,ge,Ge,xt,It,ot)=>{ot=ot||!!ge.dynamicChildren;const{type:Be,props:De,patchFlag:Oe,shapeFlag:He,dirs:ft,transition:tt}=ge,At=Be==="input"||Be==="option";if(At||Oe!==-1){ft&&eu(ge,null,Ge,"created");let yt=!1;if(fe(oe)){yt=yC(null,tt)&&Ge&&Ge.vnode.props&&Ge.vnode.props.appear;const wt=oe.content.firstChild;if(yt){const Gi=wt.getAttribute("class");Gi&&(wt.$cls=Gi),tt.beforeEnter(wt)}Se(wt,oe,Ge),ge.el=oe=wt}if(He&16&&!(De&&(De.innerHTML||De.textContent))){let wt=pe(oe.firstChild,ge,oe,Ge,xt,It,ot);for(;wt;){wy(oe,1)||np();const Gi=wt;wt=wt.nextSibling,r(Gi)}}else if(He&8){let wt=ge.children;wt[0]===`
`&&(oe.tagName==="PRE"||oe.tagName==="TEXTAREA")&&(wt=wt.slice(1)),oe.textContent!==wt&&(wy(oe,0)||np(),oe.textContent=ge.children)}if(De){if(At||!ot||Oe&48){const wt=oe.tagName.includes("-");for(const Gi in De)(At&&(Gi.endsWith("value")||Gi==="indeterminate")||z_(Gi)&&!lp(Gi)||Gi[0]==="."||wt)&&S(oe,Gi,null,De[Gi],void 0,Ge)}else if(De.onClick)S(oe,"onClick",null,De.onClick,void 0,Ge);else if(Oe&4&&Hu(De.style))for(const wt in De.style)De.style[wt]}let si;(si=De&&De.onVnodeBeforeMount)&&Gl(si,Ge,ge),ft&&eu(ge,null,Ge,"beforeMount"),((si=De&&De.onVnodeMounted)||ft||yt)&&AC(()=>{si&&Gl(si,Ge,ge),yt&&tt.enter(oe),ft&&eu(ge,null,Ge,"mounted")},xt)}return oe.nextSibling},pe=(oe,ge,Ge,xt,It,ot,Be)=>{Be=Be||!!ge.dynamicChildren;const De=ge.children,Oe=De.length;for(let He=0;He<Oe;He++){const ft=Be?De[He]:De[He]=Zl(De[He]),tt=ft.type===Fd;oe?(tt&&!Be&&He+1<Oe&&Zl(De[He+1]).type===Fd&&(j(P(oe.data.slice(ft.children.length)),Ge,M(oe)),oe.data=ft.children),oe=ee(oe,ft,xt,It,ot,Be)):tt&&!ft.children?j(ft.el=P(""),Ge):(wy(Ge,1)||np(),y(null,ft,Ge,null,xt,It,xy(Ge),ot))}return oe},se=(oe,ge,Ge,xt,It,ot)=>{const{slotScopeIds:Be}=ge;Be&&(It=It?It.concat(Be):Be);const De=k(oe),Oe=pe(M(oe),ge,De,Ge,xt,It,ot);return Oe&&by(Oe)&&Oe.data==="]"?M(ge.anchor=Oe):(np(),j(ge.anchor=H("]"),De,Oe),Oe)},he=(oe,ge,Ge,xt,It,ot)=>{if(wy(oe.parentElement,1)||np(),ge.el=null,ot){const Oe=Te(oe);for(;;){const He=M(oe);if(He&&He!==Oe)r(He);else break}}const Be=M(oe),De=k(oe);return r(oe),y(null,ge,De,Be,Ge,xt,xy(De),It),Ge&&(Ge.vnode.el=ge.el,SC(Ge,ge.el)),Be},Te=(oe,ge="[",Ge="]")=>{let xt=0;for(;oe;)if(oe=M(oe),oe&&by(oe)&&(oe.data===ge&&xt++,oe.data===Ge)){if(xt===0)return M(oe);xt--}return oe},Se=(oe,ge,Ge)=>{const xt=ge.parentNode;xt&&xt.replaceChild(oe,ge);let It=Ge;for(;It;)It.vnode.el===ge&&(It.vnode.el=It.subTree.el=oe),It=It.parent},fe=oe=>oe.nodeType===1&&oe.tagName==="TEMPLATE";return[W,ee]}const xA="data-allow-mismatch",LF={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function wy(a,d){if(d===0||d===1)for(;a&&!a.hasAttribute(xA);)a=a.parentElement;const y=a&&a.getAttribute(xA);if(y==null)return!1;if(y==="")return!0;{const S=y.split(",");return d===0&&S.includes("children")?!0:S.includes(LF[d])}}mv().requestIdleCallback;mv().cancelIdleCallback;const zd=a=>!!a.type.__asyncLoader,xv=a=>a.type.__isKeepAlive;function DF(a,d){Q2(a,"a",d)}function zF(a,d){Q2(a,"da",d)}function Q2(a,d,y=Va){const S=a.__wdc||(a.__wdc=()=>{let P=y;for(;P;){if(P.isDeactivated)return;P=P.parent}return a()});if(bv(d,S,y),y){let P=y.parent;for(;P&&P.parent;)xv(P.parent.vnode)&&kF(S,d,y,P),P=P.parent}}function kF(a,d,y,S){const P=bv(d,a,S,!0);zw(()=>{ww(S[d],P)},y)}function bv(a,d,y=Va,S=!1){if(y){const P=y[a]||(y[a]=[]),M=d.__weh||(d.__weh=(...k)=>{Xu();const r=j_(y),j=Ec(d,y,a,k);return r(),Ku(),j});return S?P.unshift(M):P.push(M),M}}const eh=a=>(d,y=Va)=>{(!I_||a==="sp")&&bv(a,(...S)=>d(...S),y)},FF=eh("bm"),Dw=eh("m"),BF=eh("bu"),eC=eh("u"),tC=eh("bum"),zw=eh("um"),NF=eh("sp"),UF=eh("rtg"),VF=eh("rtc");function jF(a,d=Va){bv("ec",a,d)}const iC="components";function h_(a,d){return rC(iC,a,!0,d)||a}const nC=Symbol.for("v-ndc");function kw(a){return zo(a)?rC(iC,a,!1)||a:a||nC}function rC(a,d,y=!0,S=!1){const P=Aa||Va;if(P){const M=P.type;{const r=CB(M,!1);if(r&&(r===d||r===Pl(d)||r===pv(Pl(d))))return M}const k=bA(P[a]||M[a],d)||bA(P.appContext[a],d);return!k&&S?M:k}}function bA(a,d){return a&&(a[d]||a[Pl(d)]||a[pv(Pl(d))])}function wA(a,d,y,S){let P;const M=y,k=Jn(a);if(k||zo(a)){const r=k&&Hu(a);let j=!1,H=!1;r&&(j=!Xl(a),H=$h(a),a=gv(a)),P=new Array(a.length);for(let W=0,ee=a.length;W<ee;W++)P[W]=d(j?H?qy(Sa(a[W])):Sa(a[W]):a[W],W,void 0,M)}else if(typeof a=="number"){P=new Array(a);for(let r=0;r<a;r++)P[r]=d(r+1,r,void 0,M)}else if(Ws(a))if(a[Symbol.iterator])P=Array.from(a,(r,j)=>d(r,j,void 0,M));else{const r=Object.keys(a);P=new Array(r.length);for(let j=0,H=r.length;j<H;j++){const W=r[j];P[j]=d(a[W],W,j,M)}}else P=[];return P}function $F(a,d,y={},S,P){if(Aa.ce||Aa.parent&&zd(Aa.parent)&&Aa.parent.ce){const H=Object.keys(y).length>0;return d!=="default"&&(y.name=d),Do(),bc(na,null,[ra("slot",y,S)],H?-2:64)}let M=a[d];M&&M._c&&(M._d=!1),Do();const k=M&&sC(M(y)),r=y.key||k&&k.key,j=bc(na,{key:(r&&!Sc(r)?r:`_${d}`)+(!k&&S?"_fb":"")},k||[],k&&a._===1?64:-2);return!P&&j.scopeId&&(j.slotScopeIds=[j.scopeId+"-s"]),M&&M._c&&(M._d=!0),j}function sC(a){return a.some(d=>A_(d)?!(d.type===Ea||d.type===na&&!sC(d.children)):!0)?a:null}function qF(a,d){const y={};for(const S in a)y[Ry(S)]=a[S];return y}const Gb=a=>a?CC(a)?Sv(a):Gb(a.parent):null,d_=sa(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>Gb(a.parent),$root:a=>Gb(a.root),$host:a=>a.ce,$emit:a=>a.emit,$options:a=>aC(a),$forceUpdate:a=>a.f||(a.f=()=>{Ow(a.update)}),$nextTick:a=>a.n||(a.n=vv.bind(a.proxy)),$watch:a=>fB.bind(a)}),A0=(a,d)=>a!==Rs&&!a.__isScriptSetup&&Ds(a,d),GF={get({_:a},d){if(d==="__v_skip")return!0;const{ctx:y,setupState:S,data:P,props:M,accessCache:k,type:r,appContext:j}=a;let H;if(d[0]!=="$"){const pe=k[d];if(pe!==void 0)switch(pe){case 1:return S[d];case 2:return P[d];case 4:return y[d];case 3:return M[d]}else{if(A0(S,d))return k[d]=1,S[d];if(P!==Rs&&Ds(P,d))return k[d]=2,P[d];if((H=a.propsOptions[0])&&Ds(H,d))return k[d]=3,M[d];if(y!==Rs&&Ds(y,d))return k[d]=4,y[d];Hb&&(k[d]=0)}}const W=d_[d];let ee,le;if(W)return d==="$attrs"&&Na(a.attrs,"get",""),W(a);if((ee=r.__cssModules)&&(ee=ee[d]))return ee;if(y!==Rs&&Ds(y,d))return k[d]=4,y[d];if(le=j.config.globalProperties,Ds(le,d))return le[d]},set({_:a},d,y){const{data:S,setupState:P,ctx:M}=a;return A0(P,d)?(P[d]=y,!0):S!==Rs&&Ds(S,d)?(S[d]=y,!0):Ds(a.props,d)||d[0]==="$"&&d.slice(1)in a?!1:(M[d]=y,!0)},has({_:{data:a,setupState:d,accessCache:y,ctx:S,appContext:P,propsOptions:M,type:k}},r){let j,H;return!!(y[r]||a!==Rs&&r[0]!=="$"&&Ds(a,r)||A0(d,r)||(j=M[0])&&Ds(j,r)||Ds(S,r)||Ds(d_,r)||Ds(P.config.globalProperties,r)||(H=k.__cssModules)&&H[r])},defineProperty(a,d,y){return y.get!=null?a._.accessCache[d]=0:Ds(y,"value")&&this.set(a,d,y.value,null),Reflect.defineProperty(a,d,y)}};function TA(a){return Jn(a)?a.reduce((d,y)=>(d[y]=null,d),{}):a}let Hb=!0;function HF(a){const d=aC(a),y=a.proxy,S=a.ctx;Hb=!1,d.beforeCreate&&SA(d.beforeCreate,a,"bc");const{data:P,computed:M,methods:k,watch:r,provide:j,inject:H,created:W,beforeMount:ee,mounted:le,beforeUpdate:pe,updated:se,activated:he,deactivated:Te,beforeDestroy:Se,beforeUnmount:fe,destroyed:oe,unmounted:ge,render:Ge,renderTracked:xt,renderTriggered:It,errorCaptured:ot,serverPrefetch:Be,expose:De,inheritAttrs:Oe,components:He,directives:ft,filters:tt}=d;if(H&&ZF(H,S,null),k)for(const si in k){const wt=k[si];Ar(wt)&&(S[si]=wt.bind(y))}if(P){const si=P.call(y,y);Ws(si)&&(a.data=B_(si))}if(Hb=!0,M)for(const si in M){const wt=M[si],Gi=Ar(wt)?wt.bind(y,y):Ar(wt.get)?wt.get.bind(y,y):iu,Ti=!Ar(wt)&&Ar(wt.set)?wt.set.bind(y):iu,di=Hl({get:Gi,set:Ti});Object.defineProperty(S,si,{enumerable:!0,configurable:!0,get:()=>di.value,set:ki=>di.value=ki})}if(r)for(const si in r)oC(r[si],S,y,si);if(j){const si=Ar(j)?j.call(y):j;Reflect.ownKeys(si).forEach(wt=>{QF(wt,si[wt])})}W&&SA(W,a,"c");function yt(si,wt){Jn(wt)?wt.forEach(Gi=>si(Gi.bind(y))):wt&&si(wt.bind(y))}if(yt(FF,ee),yt(Dw,le),yt(BF,pe),yt(eC,se),yt(DF,he),yt(zF,Te),yt(jF,ot),yt(VF,xt),yt(UF,It),yt(tC,fe),yt(zw,ge),yt(NF,Be),Jn(De))if(De.length){const si=a.exposed||(a.exposed={});De.forEach(wt=>{Object.defineProperty(si,wt,{get:()=>y[wt],set:Gi=>y[wt]=Gi,enumerable:!0})})}else a.exposed||(a.exposed={});Ge&&a.render===iu&&(a.render=Ge),Oe!=null&&(a.inheritAttrs=Oe),He&&(a.components=He),ft&&(a.directives=ft),Be&&J2(a)}function ZF(a,d,y=iu){Jn(a)&&(a=Zb(a));for(const S in a){const P=a[S];let M;Ws(P)?"default"in P?M=hp(P.from||S,P.default,!0):M=hp(P.from||S):M=hp(P),Uo(M)?Object.defineProperty(d,S,{enumerable:!0,configurable:!0,get:()=>M.value,set:k=>M.value=k}):d[S]=M}}function SA(a,d,y){Ec(Jn(a)?a.map(S=>S.bind(d.proxy)):a.bind(d.proxy),d,y)}function oC(a,d,y,S){let P=S.includes(".")?bC(y,S):()=>y[S];if(zo(a)){const M=d[a];Ar(M)&&f_(P,M)}else if(Ar(a))f_(P,a.bind(y));else if(Ws(a))if(Jn(a))a.forEach(M=>oC(M,d,y,S));else{const M=Ar(a.handler)?a.handler.bind(y):d[a.handler];Ar(M)&&f_(P,M,a)}}function aC(a){const d=a.type,{mixins:y,extends:S}=d,{mixins:P,optionsCache:M,config:{optionMergeStrategies:k}}=a.appContext,r=M.get(d);let j;return r?j=r:!P.length&&!y&&!S?j=d:(j={},P.length&&P.forEach(H=>Ky(j,H,k,!0)),Ky(j,d,k)),Ws(d)&&M.set(d,j),j}function Ky(a,d,y,S=!1){const{mixins:P,extends:M}=d;M&&Ky(a,M,y,!0),P&&P.forEach(k=>Ky(a,k,y,!0));for(const k in d)if(!(S&&k==="expose")){const r=WF[k]||y&&y[k];a[k]=r?r(a[k],d[k]):d[k]}return a}const WF={data:EA,props:AA,emits:AA,methods:s_,computed:s_,beforeCreate:Ka,created:Ka,beforeMount:Ka,mounted:Ka,beforeUpdate:Ka,updated:Ka,beforeDestroy:Ka,beforeUnmount:Ka,destroyed:Ka,unmounted:Ka,activated:Ka,deactivated:Ka,errorCaptured:Ka,serverPrefetch:Ka,components:s_,directives:s_,watch:KF,provide:EA,inject:XF};function EA(a,d){return d?a?function(){return sa(Ar(a)?a.call(this,this):a,Ar(d)?d.call(this,this):d)}:d:a}function XF(a,d){return s_(Zb(a),Zb(d))}function Zb(a){if(Jn(a)){const d={};for(let y=0;y<a.length;y++)d[a[y]]=a[y];return d}return a}function Ka(a,d){return a?[...new Set([].concat(a,d))]:d}function s_(a,d){return a?sa(Object.create(null),a,d):d}function AA(a,d){return a?Jn(a)&&Jn(d)?[...new Set([...a,...d])]:sa(Object.create(null),TA(a),TA(d??{})):d}function KF(a,d){if(!a)return d;if(!d)return a;const y=sa(Object.create(null),a);for(const S in d)y[S]=Ka(a[S],d[S]);return y}function lC(){return{app:null,config:{isNativeTag:p2,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let YF=0;function JF(a,d){return function(S,P=null){Ar(S)||(S=sa({},S)),P!=null&&!Ws(P)&&(P=null);const M=lC(),k=new WeakSet,r=[];let j=!1;const H=M.app={_uid:YF++,_component:S,_props:P,_container:null,_context:M,_instance:null,version:RB,get config(){return M.config},set config(W){},use(W,...ee){return k.has(W)||(W&&Ar(W.install)?(k.add(W),W.install(H,...ee)):Ar(W)&&(k.add(W),W(H,...ee))),H},mixin(W){return M.mixins.includes(W)||M.mixins.push(W),H},component(W,ee){return ee?(M.components[W]=ee,H):M.components[W]},directive(W,ee){return ee?(M.directives[W]=ee,H):M.directives[W]},mount(W,ee,le){if(!j){const pe=H._ceVNode||ra(S,P);return pe.appContext=M,le===!0?le="svg":le===!1&&(le=void 0),ee&&d?d(pe,W):a(pe,W,le),j=!0,H._container=W,W.__vue_app__=H,Sv(pe.component)}},onUnmount(W){r.push(W)},unmount(){j&&(Ec(r,H._instance,16),a(null,H._container),delete H._container.__vue_app__)},provide(W,ee){return M.provides[W]=ee,H},runWithContext(W){const ee=kd;kd=H;try{return W()}finally{kd=ee}}};return H}}let kd=null;function QF(a,d){if(Va){let y=Va.provides;const S=Va.parent&&Va.parent.provides;S===y&&(y=Va.provides=Object.create(S)),y[a]=d}}function hp(a,d,y=!1){const S=wp();if(S||kd){let P=kd?kd._context.provides:S?S.parent==null||S.ce?S.vnode.appContext&&S.vnode.appContext.provides:S.parent.provides:void 0;if(P&&a in P)return P[a];if(arguments.length>1)return y&&Ar(d)?d.call(S&&S.proxy):d}}function eB(){return!!(wp()||kd)}const cC={},uC=()=>Object.create(cC),hC=a=>Object.getPrototypeOf(a)===cC;function tB(a,d,y,S=!1){const P={},M=uC();a.propsDefaults=Object.create(null),dC(a,d,P,M);for(const k in a.propsOptions[0])k in P||(P[k]=void 0);y?a.props=S?P:hF(P):a.type.props?a.props=P:a.props=M,a.attrs=M}function iB(a,d,y,S){const{props:P,attrs:M,vnode:{patchFlag:k}}=a,r=hs(P),[j]=a.propsOptions;let H=!1;if((S||k>0)&&!(k&16)){if(k&8){const W=a.vnode.dynamicProps;for(let ee=0;ee<W.length;ee++){let le=W[ee];if(wv(a.emitsOptions,le))continue;const pe=d[le];if(j)if(Ds(M,le))pe!==M[le]&&(M[le]=pe,H=!0);else{const se=Pl(le);P[se]=Wb(j,r,se,pe,a,!1)}else pe!==M[le]&&(M[le]=pe,H=!0)}}}else{dC(a,d,P,M)&&(H=!0);let W;for(const ee in r)(!d||!Ds(d,ee)&&((W=Ju(ee))===ee||!Ds(d,W)))&&(j?y&&(y[ee]!==void 0||y[W]!==void 0)&&(P[ee]=Wb(j,r,ee,void 0,a,!0)):delete P[ee]);if(M!==r)for(const ee in M)(!d||!Ds(d,ee))&&(delete M[ee],H=!0)}H&&$u(a.attrs,"set","")}function dC(a,d,y,S){const[P,M]=a.propsOptions;let k=!1,r;if(d)for(let j in d){if(lp(j))continue;const H=d[j];let W;P&&Ds(P,W=Pl(j))?!M||!M.includes(W)?y[W]=H:(r||(r={}))[W]=H:wv(a.emitsOptions,j)||(!(j in S)||H!==S[j])&&(S[j]=H,k=!0)}if(M){const j=hs(y),H=r||Rs;for(let W=0;W<M.length;W++){const ee=M[W];y[ee]=Wb(P,j,ee,H[ee],a,!Ds(H,ee))}}return k}function Wb(a,d,y,S,P,M){const k=a[y];if(k!=null){const r=Ds(k,"default");if(r&&S===void 0){const j=k.default;if(k.type!==Function&&!k.skipFactory&&Ar(j)){const{propsDefaults:H}=P;if(y in H)S=H[y];else{const W=j_(P);S=H[y]=j.call(null,d),W()}}else S=j;P.ce&&P.ce._setProp(y,S)}k[0]&&(M&&!r?S=!1:k[1]&&(S===""||S===Ju(y))&&(S=!0))}return S}const nB=new WeakMap;function fC(a,d,y=!1){const S=y?nB:d.propsCache,P=S.get(a);if(P)return P;const M=a.props,k={},r=[];let j=!1;if(!Ar(a)){const W=ee=>{j=!0;const[le,pe]=fC(ee,d,!0);sa(k,le),pe&&r.push(...pe)};!y&&d.mixins.length&&d.mixins.forEach(W),a.extends&&W(a.extends),a.mixins&&a.mixins.forEach(W)}if(!M&&!j)return Ws(a)&&S.set(a,op),op;if(Jn(M))for(let W=0;W<M.length;W++){const ee=Pl(M[W]);IA(ee)&&(k[ee]=Rs)}else if(M)for(const W in M){const ee=Pl(W);if(IA(ee)){const le=M[W],pe=k[ee]=Jn(le)||Ar(le)?{type:le}:sa({},le),se=pe.type;let he=!1,Te=!0;if(Jn(se))for(let Se=0;Se<se.length;++Se){const fe=se[Se],oe=Ar(fe)&&fe.name;if(oe==="Boolean"){he=!0;break}else oe==="String"&&(Te=!1)}else he=Ar(se)&&se.name==="Boolean";pe[0]=he,pe[1]=Te,(he||Ds(pe,"default"))&&r.push(ee)}}const H=[k,r];return Ws(a)&&S.set(a,H),H}function IA(a){return a[0]!=="$"&&!lp(a)}const Fw=a=>a==="_"||a==="_ctx"||a==="$stable",Bw=a=>Jn(a)?a.map(Zl):[Zl(a)],rB=(a,d,y)=>{if(d._n)return d;const S=U_((...P)=>Bw(d(...P)),y);return S._c=!1,S},pC=(a,d,y)=>{const S=a._ctx;for(const P in a){if(Fw(P))continue;const M=a[P];if(Ar(M))d[P]=rB(P,M,S);else if(M!=null){const k=Bw(M);d[P]=()=>k}}},mC=(a,d)=>{const y=Bw(d);a.slots.default=()=>y},_C=(a,d,y)=>{for(const S in d)(y||!Fw(S))&&(a[S]=d[S])},sB=(a,d,y)=>{const S=a.slots=uC();if(a.vnode.shapeFlag&32){const P=d._;P?(_C(S,d,y),y&&y2(S,"_",P,!0)):pC(d,S)}else d&&mC(a,d)},oB=(a,d,y)=>{const{vnode:S,slots:P}=a;let M=!0,k=Rs;if(S.shapeFlag&32){const r=d._;r?y&&r===1?M=!1:_C(P,d,y):(M=!d.$stable,pC(d,P)),k=d}else d&&(mC(a,d),k={default:1});if(M)for(const r in P)!Fw(r)&&k[r]==null&&delete P[r]},Tl=AC;function aB(a){return gC(a)}function lB(a){return gC(a,OF)}function gC(a,d){const y=mv();y.__VUE__=!0;const{insert:S,remove:P,patchProp:M,createElement:k,createText:r,createComment:j,setText:H,setElementText:W,parentNode:ee,nextSibling:le,setScopeId:pe=iu,insertStaticContent:se}=a,he=($e,lt,vt,ai=null,ii=null,ci=null,Ei=void 0,bi=null,ui=!!lt.dynamicChildren)=>{if($e===lt)return;$e&&!Id($e,lt)&&(ai=pi($e),ki($e,ii,ci,!0),$e=null),lt.patchFlag===-2&&(ui=!1,lt.dynamicChildren=null);const{type:vi,ref:sn,shapeFlag:Hi}=lt;switch(vi){case Fd:Te($e,lt,vt,ai);break;case Ea:Se($e,lt,vt,ai);break;case p_:$e==null&&fe(lt,vt,ai,Ei);break;case na:He($e,lt,vt,ai,ii,ci,Ei,bi,ui);break;default:Hi&1?Ge($e,lt,vt,ai,ii,ci,Ei,bi,ui):Hi&6?ft($e,lt,vt,ai,ii,ci,Ei,bi,ui):(Hi&64||Hi&128)&&vi.process($e,lt,vt,ai,ii,ci,Ei,bi,ui,_i)}sn!=null&&ii?up(sn,$e&&$e.ref,ci,lt||$e,!lt):sn==null&&$e&&$e.ref!=null&&up($e.ref,null,ci,$e,!0)},Te=($e,lt,vt,ai)=>{if($e==null)S(lt.el=r(lt.children),vt,ai);else{const ii=lt.el=$e.el;lt.children!==$e.children&&H(ii,lt.children)}},Se=($e,lt,vt,ai)=>{$e==null?S(lt.el=j(lt.children||""),vt,ai):lt.el=$e.el},fe=($e,lt,vt,ai)=>{[$e.el,$e.anchor]=se($e.children,lt,vt,ai,$e.el,$e.anchor)},oe=({el:$e,anchor:lt},vt,ai)=>{let ii;for(;$e&&$e!==lt;)ii=le($e),S($e,vt,ai),$e=ii;S(lt,vt,ai)},ge=({el:$e,anchor:lt})=>{let vt;for(;$e&&$e!==lt;)vt=le($e),P($e),$e=vt;P(lt)},Ge=($e,lt,vt,ai,ii,ci,Ei,bi,ui)=>{lt.type==="svg"?Ei="svg":lt.type==="math"&&(Ei="mathml"),$e==null?xt(lt,vt,ai,ii,ci,Ei,bi,ui):Be($e,lt,ii,ci,Ei,bi,ui)},xt=($e,lt,vt,ai,ii,ci,Ei,bi)=>{let ui,vi;const{props:sn,shapeFlag:Hi,transition:$i,dirs:fn}=$e;if(ui=$e.el=k($e.type,ci,sn&&sn.is,sn),Hi&8?W(ui,$e.children):Hi&16&&ot($e.children,ui,null,ai,ii,I0($e,ci),Ei,bi),fn&&eu($e,null,ai,"created"),It(ui,$e,$e.scopeId,Ei,ai),sn){for(const br in sn)br!=="value"&&!lp(br)&&M(ui,br,null,sn[br],ci,ai);"value"in sn&&M(ui,"value",null,sn.value,ci),(vi=sn.onVnodeBeforeMount)&&Gl(vi,ai,$e)}fn&&eu($e,null,ai,"beforeMount");const Nn=yC(ii,$i);Nn&&$i.beforeEnter(ui),S(ui,lt,vt),((vi=sn&&sn.onVnodeMounted)||Nn||fn)&&Tl(()=>{vi&&Gl(vi,ai,$e),Nn&&$i.enter(ui),fn&&eu($e,null,ai,"mounted")},ii)},It=($e,lt,vt,ai,ii)=>{if(vt&&pe($e,vt),ai)for(let ci=0;ci<ai.length;ci++)pe($e,ai[ci]);if(ii){let ci=ii.subTree;if(lt===ci||EC(ci.type)&&(ci.ssContent===lt||ci.ssFallback===lt)){const Ei=ii.vnode;It($e,Ei,Ei.scopeId,Ei.slotScopeIds,ii.parent)}}},ot=($e,lt,vt,ai,ii,ci,Ei,bi,ui=0)=>{for(let vi=ui;vi<$e.length;vi++){const sn=$e[vi]=bi?Uh($e[vi]):Zl($e[vi]);he(null,sn,lt,vt,ai,ii,ci,Ei,bi)}},Be=($e,lt,vt,ai,ii,ci,Ei)=>{const bi=lt.el=$e.el;let{patchFlag:ui,dynamicChildren:vi,dirs:sn}=lt;ui|=$e.patchFlag&16;const Hi=$e.props||Rs,$i=lt.props||Rs;let fn;if(vt&&Sd(vt,!1),(fn=$i.onVnodeBeforeUpdate)&&Gl(fn,vt,lt,$e),sn&&eu(lt,$e,vt,"beforeUpdate"),vt&&Sd(vt,!0),(Hi.innerHTML&&$i.innerHTML==null||Hi.textContent&&$i.textContent==null)&&W(bi,""),vi?De($e.dynamicChildren,vi,bi,vt,ai,I0(lt,ii),ci):Ei||wt($e,lt,bi,null,vt,ai,I0(lt,ii),ci,!1),ui>0){if(ui&16)Oe(bi,Hi,$i,vt,ii);else if(ui&2&&Hi.class!==$i.class&&M(bi,"class",null,$i.class,ii),ui&4&&M(bi,"style",Hi.style,$i.style,ii),ui&8){const Nn=lt.dynamicProps;for(let br=0;br<Nn.length;br++){const Xn=Nn[br],is=Hi[Xn],Qn=$i[Xn];(Qn!==is||Xn==="value")&&M(bi,Xn,is,Qn,ii,vt)}}ui&1&&$e.children!==lt.children&&W(bi,lt.children)}else!Ei&&vi==null&&Oe(bi,Hi,$i,vt,ii);((fn=$i.onVnodeUpdated)||sn)&&Tl(()=>{fn&&Gl(fn,vt,lt,$e),sn&&eu(lt,$e,vt,"updated")},ai)},De=($e,lt,vt,ai,ii,ci,Ei)=>{for(let bi=0;bi<lt.length;bi++){const ui=$e[bi],vi=lt[bi],sn=ui.el&&(ui.type===na||!Id(ui,vi)||ui.shapeFlag&198)?ee(ui.el):vt;he(ui,vi,sn,null,ai,ii,ci,Ei,!0)}},Oe=($e,lt,vt,ai,ii)=>{if(lt!==vt){if(lt!==Rs)for(const ci in lt)!lp(ci)&&!(ci in vt)&&M($e,ci,lt[ci],null,ii,ai);for(const ci in vt){if(lp(ci))continue;const Ei=vt[ci],bi=lt[ci];Ei!==bi&&ci!=="value"&&M($e,ci,bi,Ei,ii,ai)}"value"in vt&&M($e,"value",lt.value,vt.value,ii)}},He=($e,lt,vt,ai,ii,ci,Ei,bi,ui)=>{const vi=lt.el=$e?$e.el:r(""),sn=lt.anchor=$e?$e.anchor:r("");let{patchFlag:Hi,dynamicChildren:$i,slotScopeIds:fn}=lt;fn&&(bi=bi?bi.concat(fn):fn),$e==null?(S(vi,vt,ai),S(sn,vt,ai),ot(lt.children||[],vt,sn,ii,ci,Ei,bi,ui)):Hi>0&&Hi&64&&$i&&$e.dynamicChildren?(De($e.dynamicChildren,$i,vt,ii,ci,Ei,bi),(lt.key!=null||ii&&lt===ii.subTree)&&vC($e,lt,!0)):wt($e,lt,vt,sn,ii,ci,Ei,bi,ui)},ft=($e,lt,vt,ai,ii,ci,Ei,bi,ui)=>{lt.slotScopeIds=bi,$e==null?lt.shapeFlag&512?ii.ctx.activate(lt,vt,ai,Ei,ui):tt(lt,vt,ai,ii,ci,Ei,ui):At($e,lt,ui)},tt=($e,lt,vt,ai,ii,ci,Ei)=>{const bi=$e.component=SB($e,ai,ii);if(xv($e)&&(bi.ctx.renderer=_i),EB(bi,!1,Ei),bi.asyncDep){if(ii&&ii.registerDep(bi,yt,Ei),!$e.el){const ui=bi.subTree=ra(Ea);Se(null,ui,lt,vt),$e.placeholder=ui.el}}else yt(bi,$e,lt,vt,ii,ci,Ei)},At=($e,lt,vt)=>{const ai=lt.component=$e.component;if(yB($e,lt,vt))if(ai.asyncDep&&!ai.asyncResolved){si(ai,lt,vt);return}else ai.next=lt,ai.update();else lt.el=$e.el,ai.vnode=lt},yt=($e,lt,vt,ai,ii,ci,Ei)=>{const bi=()=>{if($e.isMounted){let{next:Hi,bu:$i,u:fn,parent:Nn,vnode:br}=$e;{const ns=xC($e);if(ns){Hi&&(Hi.el=br.el,si($e,Hi,Ei)),ns.asyncDep.then(()=>{$e.isUnmounted||bi()});return}}let Xn=Hi,is;Sd($e,!1),Hi?(Hi.el=br.el,si($e,Hi,Ei)):Hi=br,$i&&Oy($i),(is=Hi.props&&Hi.props.onVnodeBeforeUpdate)&&Gl(is,Nn,Hi,br),Sd($e,!0);const Qn=P0($e),Wr=$e.subTree;$e.subTree=Qn,he(Wr,Qn,ee(Wr.el),pi(Wr),$e,ii,ci),Hi.el=Qn.el,Xn===null&&SC($e,Qn.el),fn&&Tl(fn,ii),(is=Hi.props&&Hi.props.onVnodeUpdated)&&Tl(()=>Gl(is,Nn,Hi,br),ii)}else{let Hi;const{el:$i,props:fn}=lt,{bm:Nn,m:br,parent:Xn,root:is,type:Qn}=$e,Wr=zd(lt);if(Sd($e,!1),Nn&&Oy(Nn),!Wr&&(Hi=fn&&fn.onVnodeBeforeMount)&&Gl(Hi,Xn,lt),Sd($e,!0),$i&&Qi){const ns=()=>{$e.subTree=P0($e),Qi($i,$e.subTree,$e,ii,null)};Wr&&Qn.__asyncHydrate?Qn.__asyncHydrate($i,$e,ns):ns()}else{is.ce&&is.ce._def.shadowRoot!==!1&&is.ce._injectChildStyle(Qn);const ns=$e.subTree=P0($e);he(null,ns,vt,ai,$e,ii,ci),lt.el=ns.el}if(br&&Tl(br,ii),!Wr&&(Hi=fn&&fn.onVnodeMounted)){const ns=lt;Tl(()=>Gl(Hi,Xn,ns),ii)}(lt.shapeFlag&256||Xn&&zd(Xn.vnode)&&Xn.vnode.shapeFlag&256)&&$e.a&&Tl($e.a,ii),$e.isMounted=!0,lt=vt=ai=null}};$e.scope.on();const ui=$e.effect=new E2(bi);$e.scope.off();const vi=$e.update=ui.run.bind(ui),sn=$e.job=ui.runIfDirty.bind(ui);sn.i=$e,sn.id=$e.uid,ui.scheduler=()=>Ow(sn),Sd($e,!0),vi()},si=($e,lt,vt)=>{lt.component=$e;const ai=$e.vnode.props;$e.vnode=lt,$e.next=null,iB($e,lt.props,ai,vt),oB($e,lt.children,vt),Xu(),_A($e),Ku()},wt=($e,lt,vt,ai,ii,ci,Ei,bi,ui=!1)=>{const vi=$e&&$e.children,sn=$e?$e.shapeFlag:0,Hi=lt.children,{patchFlag:$i,shapeFlag:fn}=lt;if($i>0){if($i&128){Ti(vi,Hi,vt,ai,ii,ci,Ei,bi,ui);return}else if($i&256){Gi(vi,Hi,vt,ai,ii,ci,Ei,bi,ui);return}}fn&8?(sn&16&&Pt(vi,ii,ci),Hi!==vi&&W(vt,Hi)):sn&16?fn&16?Ti(vi,Hi,vt,ai,ii,ci,Ei,bi,ui):Pt(vi,ii,ci,!0):(sn&8&&W(vt,""),fn&16&&ot(Hi,vt,ai,ii,ci,Ei,bi,ui))},Gi=($e,lt,vt,ai,ii,ci,Ei,bi,ui)=>{$e=$e||op,lt=lt||op;const vi=$e.length,sn=lt.length,Hi=Math.min(vi,sn);let $i;for($i=0;$i<Hi;$i++){const fn=lt[$i]=ui?Uh(lt[$i]):Zl(lt[$i]);he($e[$i],fn,vt,null,ii,ci,Ei,bi,ui)}vi>sn?Pt($e,ii,ci,!0,!1,Hi):ot(lt,vt,ai,ii,ci,Ei,bi,ui,Hi)},Ti=($e,lt,vt,ai,ii,ci,Ei,bi,ui)=>{let vi=0;const sn=lt.length;let Hi=$e.length-1,$i=sn-1;for(;vi<=Hi&&vi<=$i;){const fn=$e[vi],Nn=lt[vi]=ui?Uh(lt[vi]):Zl(lt[vi]);if(Id(fn,Nn))he(fn,Nn,vt,null,ii,ci,Ei,bi,ui);else break;vi++}for(;vi<=Hi&&vi<=$i;){const fn=$e[Hi],Nn=lt[$i]=ui?Uh(lt[$i]):Zl(lt[$i]);if(Id(fn,Nn))he(fn,Nn,vt,null,ii,ci,Ei,bi,ui);else break;Hi--,$i--}if(vi>Hi){if(vi<=$i){const fn=$i+1,Nn=fn<sn?lt[fn].el:ai;for(;vi<=$i;)he(null,lt[vi]=ui?Uh(lt[vi]):Zl(lt[vi]),vt,Nn,ii,ci,Ei,bi,ui),vi++}}else if(vi>$i)for(;vi<=Hi;)ki($e[vi],ii,ci,!0),vi++;else{const fn=vi,Nn=vi,br=new Map;for(vi=Nn;vi<=$i;vi++){const Rt=lt[vi]=ui?Uh(lt[vi]):Zl(lt[vi]);Rt.key!=null&&br.set(Rt.key,vi)}let Xn,is=0;const Qn=$i-Nn+1;let Wr=!1,ns=0;const Dr=new Array(Qn);for(vi=0;vi<Qn;vi++)Dr[vi]=0;for(vi=fn;vi<=Hi;vi++){const Rt=$e[vi];if(is>=Qn){ki(Rt,ii,ci,!0);continue}let Dt;if(Rt.key!=null)Dt=br.get(Rt.key);else for(Xn=Nn;Xn<=$i;Xn++)if(Dr[Xn-Nn]===0&&Id(Rt,lt[Xn])){Dt=Xn;break}Dt===void 0?ki(Rt,ii,ci,!0):(Dr[Dt-Nn]=vi+1,Dt>=ns?ns=Dt:Wr=!0,he(Rt,lt[Dt],vt,null,ii,ci,Ei,bi,ui),is++)}const ds=Wr?cB(Dr):op;for(Xn=ds.length-1,vi=Qn-1;vi>=0;vi--){const Rt=Nn+vi,Dt=lt[Rt],en=lt[Rt+1],Dn=Rt+1<sn?en.el||en.placeholder:ai;Dr[vi]===0?he(null,Dt,vt,Dn,ii,ci,Ei,bi,ui):Wr&&(Xn<0||vi!==ds[Xn]?di(Dt,vt,Dn,2):Xn--)}}},di=($e,lt,vt,ai,ii=null)=>{const{el:ci,type:Ei,transition:bi,children:ui,shapeFlag:vi}=$e;if(vi&6){di($e.component.subTree,lt,vt,ai);return}if(vi&128){$e.suspense.move(lt,vt,ai);return}if(vi&64){Ei.move($e,lt,vt,_i);return}if(Ei===na){S(ci,lt,vt);for(let Hi=0;Hi<ui.length;Hi++)di(ui[Hi],lt,vt,ai);S($e.anchor,lt,vt);return}if(Ei===p_){oe($e,lt,vt);return}if(ai!==2&&vi&1&&bi)if(ai===0)bi.beforeEnter(ci),S(ci,lt,vt),Tl(()=>bi.enter(ci),ii);else{const{leave:Hi,delayLeave:$i,afterLeave:fn}=bi,Nn=()=>{$e.ctx.isUnmounted?P(ci):S(ci,lt,vt)},br=()=>{ci._isLeaving&&ci[ju](!0),Hi(ci,()=>{Nn(),fn&&fn()})};$i?$i(ci,Nn,br):br()}else S(ci,lt,vt)},ki=($e,lt,vt,ai=!1,ii=!1)=>{const{type:ci,props:Ei,ref:bi,children:ui,dynamicChildren:vi,shapeFlag:sn,patchFlag:Hi,dirs:$i,cacheIndex:fn}=$e;if(Hi===-2&&(ii=!1),bi!=null&&(Xu(),up(bi,null,vt,$e,!0),Ku()),fn!=null&&(lt.renderCache[fn]=void 0),sn&256){lt.ctx.deactivate($e);return}const Nn=sn&1&&$i,br=!zd($e);let Xn;if(br&&(Xn=Ei&&Ei.onVnodeBeforeUnmount)&&Gl(Xn,lt,$e),sn&6)mt($e.component,vt,ai);else{if(sn&128){$e.suspense.unmount(vt,ai);return}Nn&&eu($e,null,lt,"beforeUnmount"),sn&64?$e.type.remove($e,lt,vt,_i,ai):vi&&!vi.hasOnce&&(ci!==na||Hi>0&&Hi&64)?Pt(vi,lt,vt,!1,!0):(ci===na&&Hi&384||!ii&&sn&16)&&Pt(ui,lt,vt),ai&&dn($e)}(br&&(Xn=Ei&&Ei.onVnodeUnmounted)||Nn)&&Tl(()=>{Xn&&Gl(Xn,lt,$e),Nn&&eu($e,null,lt,"unmounted")},vt)},dn=$e=>{const{type:lt,el:vt,anchor:ai,transition:ii}=$e;if(lt===na){an(vt,ai);return}if(lt===p_){ge($e);return}const ci=()=>{P(vt),ii&&!ii.persisted&&ii.afterLeave&&ii.afterLeave()};if($e.shapeFlag&1&&ii&&!ii.persisted){const{leave:Ei,delayLeave:bi}=ii,ui=()=>Ei(vt,ci);bi?bi($e.el,ci,ui):ui()}else ci()},an=($e,lt)=>{let vt;for(;$e!==lt;)vt=le($e),P($e),$e=vt;P(lt)},mt=($e,lt,vt)=>{const{bum:ai,scope:ii,job:ci,subTree:Ei,um:bi,m:ui,a:vi}=$e;PA(ui),PA(vi),ai&&Oy(ai),ii.stop(),ci&&(ci.flags|=8,ki(Ei,$e,lt,vt)),bi&&Tl(bi,lt),Tl(()=>{$e.isUnmounted=!0},lt)},Pt=($e,lt,vt,ai=!1,ii=!1,ci=0)=>{for(let Ei=ci;Ei<$e.length;Ei++)ki($e[Ei],lt,vt,ai,ii)},pi=$e=>{if($e.shapeFlag&6)return pi($e.component.subTree);if($e.shapeFlag&128)return $e.suspense.next();const lt=le($e.anchor||$e.el),vt=lt&&lt[IF];return vt?le(vt):lt};let Ui=!1;const ei=($e,lt,vt)=>{$e==null?lt._vnode&&ki(lt._vnode,null,null,!0):he(lt._vnode||null,$e,lt,null,null,null,vt),lt._vnode=$e,Ui||(Ui=!0,_A(),Zy(),Ui=!1)},_i={p:he,um:ki,m:di,r:dn,mt:tt,mc:ot,pc:wt,pbc:De,n:pi,o:a};let un,Qi;return d&&([un,Qi]=d(_i)),{render:ei,hydrate:un,createApp:JF(ei,un)}}function I0({type:a,props:d},y){return y==="svg"&&a==="foreignObject"||y==="mathml"&&a==="annotation-xml"&&d&&d.encoding&&d.encoding.includes("html")?void 0:y}function Sd({effect:a,job:d},y){y?(a.flags|=32,d.flags|=4):(a.flags&=-33,d.flags&=-5)}function yC(a,d){return(!a||a&&!a.pendingBranch)&&d&&!d.persisted}function vC(a,d,y=!1){const S=a.children,P=d.children;if(Jn(S)&&Jn(P))for(let M=0;M<S.length;M++){const k=S[M];let r=P[M];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=P[M]=Uh(P[M]),r.el=k.el),!y&&r.patchFlag!==-2&&vC(k,r)),r.type===Fd&&r.patchFlag!==-1&&(r.el=k.el),r.type===Ea&&!r.el&&(r.el=k.el)}}function cB(a){const d=a.slice(),y=[0];let S,P,M,k,r;const j=a.length;for(S=0;S<j;S++){const H=a[S];if(H!==0){if(P=y[y.length-1],a[P]<H){d[S]=P,y.push(S);continue}for(M=0,k=y.length-1;M<k;)r=M+k>>1,a[y[r]]<H?M=r+1:k=r;H<a[y[M]]&&(M>0&&(d[S]=y[M-1]),y[M]=S)}}for(M=y.length,k=y[M-1];M-- >0;)y[M]=k,k=d[k];return y}function xC(a){const d=a.subTree.component;if(d)return d.asyncDep&&!d.asyncResolved?d:xC(d)}function PA(a){if(a)for(let d=0;d<a.length;d++)a[d].flags|=8}const uB=Symbol.for("v-scx"),hB=()=>hp(uB);function dB(a,d){return Nw(a,null,{flush:"sync"})}function f_(a,d,y){return Nw(a,d,y)}function Nw(a,d,y=Rs){const{immediate:S,deep:P,flush:M,once:k}=y,r=sa({},y),j=d&&S||!d&&M!=="post";let H;if(I_){if(M==="sync"){const pe=hB();H=pe.__watcherHandles||(pe.__watcherHandles=[])}else if(!j){const pe=()=>{};return pe.stop=iu,pe.resume=iu,pe.pause=iu,pe}}const W=Va;r.call=(pe,se,he)=>Ec(pe,W,se,he);let ee=!1;M==="post"?r.scheduler=pe=>{Tl(pe,W&&W.suspense)}:M!=="sync"&&(ee=!0,r.scheduler=(pe,se)=>{se?pe():Ow(pe)}),r.augmentJob=pe=>{d&&(pe.flags|=4),ee&&(pe.flags|=2,W&&(pe.id=W.uid,pe.i=W))};const le=TF(a,d,r);return I_&&(H?H.push(le):j&&le()),le}function fB(a,d,y){const S=this.proxy,P=zo(a)?a.includes(".")?bC(S,a):()=>S[a]:a.bind(S,S);let M;Ar(d)?M=d:(M=d.handler,y=d);const k=j_(this),r=Nw(P,M.bind(S),y);return k(),r}function bC(a,d){const y=d.split(".");return()=>{let S=a;for(let P=0;P<y.length&&S;P++)S=S[y[P]];return S}}function C8(a,d,y=Rs){const S=wp(),P=Pl(d),M=Ju(d),k=wC(a,P),r=_F((j,H)=>{let W,ee=Rs,le;return dB(()=>{const pe=a[P];ll(W,pe)&&(W=pe,H())}),{get(){return j(),y.get?y.get(W):W},set(pe){const se=y.set?y.set(pe):pe;if(!ll(se,W)&&!(ee!==Rs&&ll(pe,ee)))return;const he=S.vnode.props;he&&(d in he||P in he||M in he)&&(`onUpdate:${d}`in he||`onUpdate:${P}`in he||`onUpdate:${M}`in he)||(W=pe,H()),S.emit(`update:${d}`,se),ll(pe,se)&&ll(pe,ee)&&!ll(se,le)&&H(),ee=pe,le=se}}});return r[Symbol.iterator]=()=>{let j=0;return{next(){return j<2?{value:j++?k||Rs:r,done:!1}:{done:!0}}}},r}const wC=(a,d)=>d==="modelValue"||d==="model-value"?a.modelModifiers:a[`${d}Modifiers`]||a[`${Pl(d)}Modifiers`]||a[`${Ju(d)}Modifiers`];function pB(a,d,...y){if(a.isUnmounted)return;const S=a.vnode.props||Rs;let P=y;const M=d.startsWith("update:"),k=M&&wC(S,d.slice(7));k&&(k.trim&&(P=y.map(W=>zo(W)?W.trim():W)),k.number&&(P=y.map(jy)));let r,j=S[r=Ry(d)]||S[r=Ry(Pl(d))];!j&&M&&(j=S[r=Ry(Ju(d))]),j&&Ec(j,a,6,P);const H=S[r+"Once"];if(H){if(!a.emitted)a.emitted={};else if(a.emitted[r])return;a.emitted[r]=!0,Ec(H,a,6,P)}}const mB=new WeakMap;function TC(a,d,y=!1){const S=y?mB:d.emitsCache,P=S.get(a);if(P!==void 0)return P;const M=a.emits;let k={},r=!1;if(!Ar(a)){const j=H=>{const W=TC(H,d,!0);W&&(r=!0,sa(k,W))};!y&&d.mixins.length&&d.mixins.forEach(j),a.extends&&j(a.extends),a.mixins&&a.mixins.forEach(j)}return!M&&!r?(Ws(a)&&S.set(a,null),null):(Jn(M)?M.forEach(j=>k[j]=null):sa(k,M),Ws(a)&&S.set(a,k),k)}function wv(a,d){return!a||!z_(d)?!1:(d=d.slice(2).replace(/Once$/,""),Ds(a,d[0].toLowerCase()+d.slice(1))||Ds(a,Ju(d))||Ds(a,d))}function P0(a){const{type:d,vnode:y,proxy:S,withProxy:P,propsOptions:[M],slots:k,attrs:r,emit:j,render:H,renderCache:W,props:ee,data:le,setupState:pe,ctx:se,inheritAttrs:he}=a,Te=Wy(a);let Se,fe;try{if(y.shapeFlag&4){const ge=P||S,Ge=ge;Se=Zl(H.call(Ge,ge,W,ee,pe,le,se)),fe=r}else{const ge=d;Se=Zl(ge.length>1?ge(ee,{attrs:r,slots:k,emit:j}):ge(ee,null)),fe=d.props?r:_B(r)}}catch(ge){m_.length=0,yv(ge,a,1),Se=ra(Ea)}let oe=Se;if(fe&&he!==!1){const ge=Object.keys(fe),{shapeFlag:Ge}=oe;ge.length&&Ge&7&&(M&&ge.some(bw)&&(fe=gB(fe,M)),oe=qh(oe,fe,!1,!0))}return y.dirs&&(oe=qh(oe,null,!1,!0),oe.dirs=oe.dirs?oe.dirs.concat(y.dirs):y.dirs),y.transition&&jd(oe,y.transition),Se=oe,Wy(Te),Se}const _B=a=>{let d;for(const y in a)(y==="class"||y==="style"||z_(y))&&((d||(d={}))[y]=a[y]);return d},gB=(a,d)=>{const y={};for(const S in a)(!bw(S)||!(S.slice(9)in d))&&(y[S]=a[S]);return y};function yB(a,d,y){const{props:S,children:P,component:M}=a,{props:k,children:r,patchFlag:j}=d,H=M.emitsOptions;if(d.dirs||d.transition)return!0;if(y&&j>=0){if(j&1024)return!0;if(j&16)return S?CA(S,k,H):!!k;if(j&8){const W=d.dynamicProps;for(let ee=0;ee<W.length;ee++){const le=W[ee];if(k[le]!==S[le]&&!wv(H,le))return!0}}}else return(P||r)&&(!r||!r.$stable)?!0:S===k?!1:S?k?CA(S,k,H):!0:!!k;return!1}function CA(a,d,y){const S=Object.keys(d);if(S.length!==Object.keys(a).length)return!0;for(let P=0;P<S.length;P++){const M=S[P];if(d[M]!==a[M]&&!wv(y,M))return!0}return!1}function SC({vnode:a,parent:d},y){for(;d;){const S=d.subTree;if(S.suspense&&S.suspense.activeBranch===a&&(S.el=a.el),S===a)(a=d.vnode).el=y,d=d.parent;else break}}const EC=a=>a.__isSuspense;function AC(a,d){d&&d.pendingBranch?Jn(a)?d.effects.push(...a):d.effects.push(a):AF(a)}const na=Symbol.for("v-fgt"),Fd=Symbol.for("v-txt"),Ea=Symbol.for("v-cmt"),p_=Symbol.for("v-stc"),m_=[];let Il=null;function Do(a=!1){m_.push(Il=a?null:[])}function vB(){m_.pop(),Il=m_[m_.length-1]||null}let E_=1;function Yy(a,d=!1){E_+=a,a<0&&Il&&d&&(Il.hasOnce=!0)}function IC(a){return a.dynamicChildren=E_>0?Il||op:null,vB(),E_>0&&Il&&Il.push(a),a}function xc(a,d,y,S,P,M){return IC(qd(a,d,y,S,P,M,!0))}function bc(a,d,y,S,P){return IC(ra(a,d,y,S,P,!0))}function A_(a){return a?a.__v_isVNode===!0:!1}function Id(a,d){return a.type===d.type&&a.key===d.key}const PC=({key:a})=>a??null,Ly=({ref:a,ref_key:d,ref_for:y})=>(typeof a=="number"&&(a=""+a),a!=null?zo(a)||Uo(a)||Ar(a)?{i:Aa,r:a,k:d,f:!!y}:a:null);function qd(a,d=null,y=null,S=0,P=null,M=a===na?0:1,k=!1,r=!1){const j={__v_isVNode:!0,__v_skip:!0,type:a,props:d,key:d&&PC(d),ref:d&&Ly(d),scopeId:G2,slotScopeIds:null,children:y,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:M,patchFlag:S,dynamicProps:P,dynamicChildren:null,appContext:null,ctx:Aa};return r?(Uw(j,y),M&128&&a.normalize(j)):y&&(j.shapeFlag|=zo(y)?8:16),E_>0&&!k&&Il&&(j.patchFlag>0||M&6)&&j.patchFlag!==32&&Il.push(j),j}const ra=xB;function xB(a,d=null,y=null,S=0,P=null,M=!1){if((!a||a===nC)&&(a=Ea),A_(a)){const r=qh(a,d,!0);return y&&Uw(r,y),E_>0&&!M&&Il&&(r.shapeFlag&6?Il[Il.indexOf(a)]=r:Il.push(r)),r.patchFlag=-2,r}if(MB(a)&&(a=a.__vccOpts),d){d=bB(d);let{class:r,style:j}=d;r&&!zo(r)&&(d.class=jh(r)),Ws(j)&&(Rw(j)&&!Jn(j)&&(j=sa({},j)),d.style=F_(j))}const k=zo(a)?1:EC(a)?128:H2(a)?64:Ws(a)?4:Ar(a)?2:0;return qd(a,d,y,S,P,k,M,!0)}function bB(a){return a?Rw(a)||hC(a)?sa({},a):a:null}function qh(a,d,y=!1,S=!1){const{props:P,ref:M,patchFlag:k,children:r,transition:j}=a,H=d?Tv(P||{},d):P,W={__v_isVNode:!0,__v_skip:!0,type:a.type,props:H,key:H&&PC(H),ref:d&&d.ref?y&&M?Jn(M)?M.concat(Ly(d)):[M,Ly(d)]:Ly(d):M,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:r,target:a.target,targetStart:a.targetStart,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:d&&a.type!==na?k===-1?16:k|16:k,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:j,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&qh(a.ssContent),ssFallback:a.ssFallback&&qh(a.ssFallback),placeholder:a.placeholder,el:a.el,anchor:a.anchor,ctx:a.ctx,ce:a.ce};return j&&S&&jd(W,j.clone(W)),W}function V_(a=" ",d=0){return ra(Fd,null,a,d)}function M8(a,d){const y=ra(p_,null,a);return y.staticCount=d,y}function C0(a="",d=!1){return d?(Do(),bc(Ea,null,a)):ra(Ea,null,a)}function Zl(a){return a==null||typeof a=="boolean"?ra(Ea):Jn(a)?ra(na,null,a.slice()):A_(a)?Uh(a):ra(Fd,null,String(a))}function Uh(a){return a.el===null&&a.patchFlag!==-1||a.memo?a:qh(a)}function Uw(a,d){let y=0;const{shapeFlag:S}=a;if(d==null)d=null;else if(Jn(d))y=16;else if(typeof d=="object")if(S&65){const P=d.default;P&&(P._c&&(P._d=!1),Uw(a,P()),P._c&&(P._d=!0));return}else{y=32;const P=d._;!P&&!hC(d)?d._ctx=Aa:P===3&&Aa&&(Aa.slots._===1?d._=1:(d._=2,a.patchFlag|=1024))}else Ar(d)?(d={default:d,_ctx:Aa},y=32):(d=String(d),S&64?(y=16,d=[V_(d)]):y=8);a.children=d,a.shapeFlag|=y}function Tv(...a){const d={};for(let y=0;y<a.length;y++){const S=a[y];for(const P in S)if(P==="class")d.class!==S.class&&(d.class=jh([d.class,S.class]));else if(P==="style")d.style=F_([d.style,S.style]);else if(z_(P)){const M=d[P],k=S[P];k&&M!==k&&!(Jn(M)&&M.includes(k))&&(d[P]=M?[].concat(M,k):k)}else P!==""&&(d[P]=S[P])}return d}function Gl(a,d,y,S=null){Ec(a,d,7,[y,S])}const wB=lC();let TB=0;function SB(a,d,y){const S=a.type,P=(d?d.appContext:a.appContext)||wB,M={uid:TB++,vnode:a,type:S,parent:d,appContext:P,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new w2(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:d?d.provides:Object.create(P.provides),ids:d?d.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:fC(S,P),emitsOptions:TC(S,P),emit:null,emitted:null,propsDefaults:Rs,inheritAttrs:S.inheritAttrs,ctx:Rs,data:Rs,props:Rs,attrs:Rs,slots:Rs,refs:Rs,setupState:Rs,setupContext:null,suspense:y,suspenseId:y?y.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return M.ctx={_:M},M.root=d?d.root:M,M.emit=pB.bind(null,M),a.ce&&a.ce(M),M}let Va=null;const wp=()=>Va||Aa;let Jy,Xb;{const a=mv(),d=(y,S)=>{let P;return(P=a[y])||(P=a[y]=[]),P.push(S),M=>{P.length>1?P.forEach(k=>k(M)):P[0](M)}};Jy=d("__VUE_INSTANCE_SETTERS__",y=>Va=y),Xb=d("__VUE_SSR_SETTERS__",y=>I_=y)}const j_=a=>{const d=Va;return Jy(a),a.scope.on(),()=>{a.scope.off(),Jy(d)}},MA=()=>{Va&&Va.scope.off(),Jy(null)};function CC(a){return a.vnode.shapeFlag&4}let I_=!1;function EB(a,d=!1,y=!1){d&&Xb(d);const{props:S,children:P}=a.vnode,M=CC(a);tB(a,S,M,d),sB(a,P,y||d);const k=M?AB(a,d):void 0;return d&&Xb(!1),k}function AB(a,d){const y=a.type;a.accessCache=Object.create(null),a.proxy=new Proxy(a.ctx,GF);const{setup:S}=y;if(S){Xu();const P=a.setupContext=S.length>1?PB(a):null,M=j_(a),k=N_(S,a,0,[a.props,P]),r=m2(k);if(Ku(),M(),(r||a.sp)&&!zd(a)&&J2(a),r){if(k.then(MA,MA),d)return k.then(j=>{RA(a,j)}).catch(j=>{yv(j,a,0)});a.asyncDep=k}else RA(a,k)}else MC(a)}function RA(a,d,y){Ar(d)?a.type.__ssrInlineRender?a.ssrRender=d:a.render=d:Ws(d)&&(a.setupState=V2(d)),MC(a)}function MC(a,d,y){const S=a.type;a.render||(a.render=S.render||iu);{const P=j_(a);Xu();try{HF(a)}finally{Ku(),P()}}}const IB={get(a,d){return Na(a,"get",""),a[d]}};function PB(a){const d=y=>{a.exposed=y||{}};return{attrs:new Proxy(a.attrs,IB),slots:a.slots,emit:a.emit,expose:d}}function Sv(a){return a.exposed?a.exposeProxy||(a.exposeProxy=new Proxy(V2(w_(a.exposed)),{get(d,y){if(y in d)return d[y];if(y in d_)return d_[y](a)},has(d,y){return y in d||y in d_}})):a.proxy}function CB(a,d=!0){return Ar(a)?a.displayName||a.name:a.name||d&&a.__name}function MB(a){return Ar(a)&&"__vccOpts"in a}const Hl=(a,d)=>bF(a,d,I_);function Bd(a,d,y){try{Yy(-1);const S=arguments.length;return S===2?Ws(d)&&!Jn(d)?A_(d)?ra(a,null,[d]):ra(a,d):ra(a,null,d):(S>3?y=Array.prototype.slice.call(arguments,2):S===3&&A_(y)&&(y=[y]),ra(a,d,y))}finally{Yy(1)}}const RB="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Kb;const OA=typeof window<"u"&&window.trustedTypes;if(OA)try{Kb=OA.createPolicy("vue",{createHTML:a=>a})}catch{}const RC=Kb?a=>Kb.createHTML(a):a=>a,OB="http://www.w3.org/2000/svg",LB="http://www.w3.org/1998/Math/MathML",Vu=typeof document<"u"?document:null,LA=Vu&&Vu.createElement("template"),DB={insert:(a,d,y)=>{d.insertBefore(a,y||null)},remove:a=>{const d=a.parentNode;d&&d.removeChild(a)},createElement:(a,d,y,S)=>{const P=d==="svg"?Vu.createElementNS(OB,a):d==="mathml"?Vu.createElementNS(LB,a):y?Vu.createElement(a,{is:y}):Vu.createElement(a);return a==="select"&&S&&S.multiple!=null&&P.setAttribute("multiple",S.multiple),P},createText:a=>Vu.createTextNode(a),createComment:a=>Vu.createComment(a),setText:(a,d)=>{a.nodeValue=d},setElementText:(a,d)=>{a.textContent=d},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Vu.querySelector(a),setScopeId(a,d){a.setAttribute(d,"")},insertStaticContent(a,d,y,S,P,M){const k=y?y.previousSibling:d.lastChild;if(P&&(P===M||P.nextSibling))for(;d.insertBefore(P.cloneNode(!0),y),!(P===M||!(P=P.nextSibling)););else{LA.innerHTML=RC(S==="svg"?`<svg>${a}</svg>`:S==="mathml"?`<math>${a}</math>`:a);const r=LA.content;if(S==="svg"||S==="mathml"){const j=r.firstChild;for(;j.firstChild;)r.appendChild(j.firstChild);r.removeChild(j)}d.insertBefore(r,y)}return[k?k.nextSibling:d.firstChild,y?y.previousSibling:d.lastChild]}},kh="transition",t_="animation",pp=Symbol("_vtc"),OC={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},LC=sa({},W2,OC),zB=a=>(a.displayName="Transition",a.props=LC,a),R8=zB((a,{slots:d})=>Bd(CF,DC(a),d)),Ed=(a,d=[])=>{Jn(a)?a.forEach(y=>y(...d)):a&&a(...d)},DA=a=>a?Jn(a)?a.some(d=>d.length>1):a.length>1:!1;function DC(a){const d={};for(const He in a)He in OC||(d[He]=a[He]);if(a.css===!1)return d;const{name:y="v",type:S,duration:P,enterFromClass:M=`${y}-enter-from`,enterActiveClass:k=`${y}-enter-active`,enterToClass:r=`${y}-enter-to`,appearFromClass:j=M,appearActiveClass:H=k,appearToClass:W=r,leaveFromClass:ee=`${y}-leave-from`,leaveActiveClass:le=`${y}-leave-active`,leaveToClass:pe=`${y}-leave-to`}=a,se=kB(P),he=se&&se[0],Te=se&&se[1],{onBeforeEnter:Se,onEnter:fe,onEnterCancelled:oe,onLeave:ge,onLeaveCancelled:Ge,onBeforeAppear:xt=Se,onAppear:It=fe,onAppearCancelled:ot=oe}=d,Be=(He,ft,tt,At)=>{He._enterCancelled=At,Fh(He,ft?W:r),Fh(He,ft?H:k),tt&&tt()},De=(He,ft)=>{He._isLeaving=!1,Fh(He,ee),Fh(He,pe),Fh(He,le),ft&&ft()},Oe=He=>(ft,tt)=>{const At=He?It:fe,yt=()=>Be(ft,He,tt);Ed(At,[ft,yt]),zA(()=>{Fh(ft,He?j:M),Yc(ft,He?W:r),DA(At)||kA(ft,S,he,yt)})};return sa(d,{onBeforeEnter(He){Ed(Se,[He]),Yc(He,M),Yc(He,k)},onBeforeAppear(He){Ed(xt,[He]),Yc(He,j),Yc(He,H)},onEnter:Oe(!1),onAppear:Oe(!0),onLeave(He,ft){He._isLeaving=!0;const tt=()=>De(He,ft);Yc(He,ee),He._enterCancelled?(Yc(He,le),Yb(He)):(Yb(He),Yc(He,le)),zA(()=>{He._isLeaving&&(Fh(He,ee),Yc(He,pe),DA(ge)||kA(He,S,Te,tt))}),Ed(ge,[He,tt])},onEnterCancelled(He){Be(He,!1,void 0,!0),Ed(oe,[He])},onAppearCancelled(He){Be(He,!0,void 0,!0),Ed(ot,[He])},onLeaveCancelled(He){De(He),Ed(Ge,[He])}})}function kB(a){if(a==null)return null;if(Ws(a))return[M0(a.enter),M0(a.leave)];{const d=M0(a);return[d,d]}}function M0(a){return Fk(a)}function Yc(a,d){d.split(/\s+/).forEach(y=>y&&a.classList.add(y)),(a[pp]||(a[pp]=new Set)).add(d)}function Fh(a,d){d.split(/\s+/).forEach(S=>S&&a.classList.remove(S));const y=a[pp];y&&(y.delete(d),y.size||(a[pp]=void 0))}function zA(a){requestAnimationFrame(()=>{requestAnimationFrame(a)})}let FB=0;function kA(a,d,y,S){const P=a._endId=++FB,M=()=>{P===a._endId&&S()};if(y!=null)return setTimeout(M,y);const{type:k,timeout:r,propCount:j}=zC(a,d);if(!k)return S();const H=k+"end";let W=0;const ee=()=>{a.removeEventListener(H,le),M()},le=pe=>{pe.target===a&&++W>=j&&ee()};setTimeout(()=>{W<j&&ee()},r+1),a.addEventListener(H,le)}function zC(a,d){const y=window.getComputedStyle(a),S=se=>(y[se]||"").split(", "),P=S(`${kh}Delay`),M=S(`${kh}Duration`),k=FA(P,M),r=S(`${t_}Delay`),j=S(`${t_}Duration`),H=FA(r,j);let W=null,ee=0,le=0;d===kh?k>0&&(W=kh,ee=k,le=M.length):d===t_?H>0&&(W=t_,ee=H,le=j.length):(ee=Math.max(k,H),W=ee>0?k>H?kh:t_:null,le=W?W===kh?M.length:j.length:0);const pe=W===kh&&/\b(?:transform|all)(?:,|$)/.test(S(`${kh}Property`).toString());return{type:W,timeout:ee,propCount:le,hasTransform:pe}}function FA(a,d){for(;a.length<d.length;)a=a.concat(a);return Math.max(...d.map((y,S)=>BA(y)+BA(a[S])))}function BA(a){return a==="auto"?0:Number(a.slice(0,-1).replace(",","."))*1e3}function Yb(a){return(a?a.ownerDocument:document).body.offsetHeight}function BB(a,d,y){const S=a[pp];S&&(d=(d?[d,...S]:[...S]).join(" ")),d==null?a.removeAttribute("class"):y?a.setAttribute("class",d):a.className=d}const Qy=Symbol("_vod"),kC=Symbol("_vsh"),O8={name:"show",beforeMount(a,{value:d},{transition:y}){a[Qy]=a.style.display==="none"?"":a.style.display,y&&d?y.beforeEnter(a):i_(a,d)},mounted(a,{value:d},{transition:y}){y&&d&&y.enter(a)},updated(a,{value:d,oldValue:y},{transition:S}){!d!=!y&&(S?d?(S.beforeEnter(a),i_(a,!0),S.enter(a)):S.leave(a,()=>{i_(a,!1)}):i_(a,d))},beforeUnmount(a,{value:d}){i_(a,d)}};function i_(a,d){a.style.display=d?a[Qy]:"none",a[kC]=!d}const NB=Symbol(""),UB=/(?:^|;)\s*display\s*:/;function VB(a,d,y){const S=a.style,P=zo(y);let M=!1;if(y&&!P){if(d)if(zo(d))for(const k of d.split(";")){const r=k.slice(0,k.indexOf(":")).trim();y[r]==null&&Dy(S,r,"")}else for(const k in d)y[k]==null&&Dy(S,k,"");for(const k in y)k==="display"&&(M=!0),Dy(S,k,y[k])}else if(P){if(d!==y){const k=S[NB];k&&(y+=";"+k),S.cssText=y,M=UB.test(y)}}else d&&a.removeAttribute("style");Qy in a&&(a[Qy]=M?S.display:"",a[kC]&&(S.display="none"))}const NA=/\s*!important$/;function Dy(a,d,y){if(Jn(y))y.forEach(S=>Dy(a,d,S));else if(y==null&&(y=""),d.startsWith("--"))a.setProperty(d,y);else{const S=jB(a,d);NA.test(y)?a.setProperty(Ju(S),y.replace(NA,""),"important"):a[S]=y}}const UA=["Webkit","Moz","ms"],R0={};function jB(a,d){const y=R0[d];if(y)return y;let S=Pl(d);if(S!=="filter"&&S in a)return R0[d]=S;S=pv(S);for(let P=0;P<UA.length;P++){const M=UA[P]+S;if(M in a)return R0[d]=M}return d}const VA="http://www.w3.org/1999/xlink";function jA(a,d,y,S,P,M=$k(d)){S&&d.startsWith("xlink:")?y==null?a.removeAttributeNS(VA,d.slice(6,d.length)):a.setAttributeNS(VA,d,y):y==null||M&&!v2(y)?a.removeAttribute(d):a.setAttribute(d,M?"":Sc(y)?String(y):y)}function $A(a,d,y,S,P){if(d==="innerHTML"||d==="textContent"){y!=null&&(a[d]=d==="innerHTML"?RC(y):y);return}const M=a.tagName;if(d==="value"&&M!=="PROGRESS"&&!M.includes("-")){const r=M==="OPTION"?a.getAttribute("value")||"":a.value,j=y==null?a.type==="checkbox"?"on":"":String(y);(r!==j||!("_value"in a))&&(a.value=j),y==null&&a.removeAttribute(d),a._value=y;return}let k=!1;if(y===""||y==null){const r=typeof a[d];r==="boolean"?y=v2(y):y==null&&r==="string"?(y="",k=!0):r==="number"&&(y=0,k=!0)}try{a[d]=y}catch{}k&&a.removeAttribute(P||d)}function Gu(a,d,y,S){a.addEventListener(d,y,S)}function $B(a,d,y,S){a.removeEventListener(d,y,S)}const qA=Symbol("_vei");function qB(a,d,y,S,P=null){const M=a[qA]||(a[qA]={}),k=M[d];if(S&&k)k.value=S;else{const[r,j]=GB(d);if(S){const H=M[d]=WB(S,P);Gu(a,r,H,j)}else k&&($B(a,r,k,j),M[d]=void 0)}}const GA=/(?:Once|Passive|Capture)$/;function GB(a){let d;if(GA.test(a)){d={};let S;for(;S=a.match(GA);)a=a.slice(0,a.length-S[0].length),d[S[0].toLowerCase()]=!0}return[a[2]===":"?a.slice(3):Ju(a.slice(2)),d]}let O0=0;const HB=Promise.resolve(),ZB=()=>O0||(HB.then(()=>O0=0),O0=Date.now());function WB(a,d){const y=S=>{if(!S._vts)S._vts=Date.now();else if(S._vts<=y.attached)return;Ec(XB(S,y.value),d,5,[S])};return y.value=a,y.attached=ZB(),y}function XB(a,d){if(Jn(d)){const y=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{y.call(a),a._stopped=!0},d.map(S=>P=>!P._stopped&&S&&S(P))}else return d}const HA=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)>96&&a.charCodeAt(2)<123,KB=(a,d,y,S,P,M)=>{const k=P==="svg";d==="class"?BB(a,S,k):d==="style"?VB(a,y,S):z_(d)?bw(d)||qB(a,d,y,S,M):(d[0]==="."?(d=d.slice(1),!0):d[0]==="^"?(d=d.slice(1),!1):YB(a,d,S,k))?($A(a,d,S),!a.tagName.includes("-")&&(d==="value"||d==="checked"||d==="selected")&&jA(a,d,S,k,M,d!=="value")):a._isVueCE&&(/[A-Z]/.test(d)||!zo(S))?$A(a,Pl(d),S,M,d):(d==="true-value"?a._trueValue=S:d==="false-value"&&(a._falseValue=S),jA(a,d,S,k))};function YB(a,d,y,S){if(S)return!!(d==="innerHTML"||d==="textContent"||d in a&&HA(d)&&Ar(y));if(d==="spellcheck"||d==="draggable"||d==="translate"||d==="autocorrect"||d==="form"||d==="list"&&a.tagName==="INPUT"||d==="type"&&a.tagName==="TEXTAREA")return!1;if(d==="width"||d==="height"){const P=a.tagName;if(P==="IMG"||P==="VIDEO"||P==="CANVAS"||P==="SOURCE")return!1}return HA(d)&&zo(y)?!1:d in a}const FC=new WeakMap,BC=new WeakMap,ev=Symbol("_moveCb"),ZA=Symbol("_enterCb"),JB=a=>(delete a.props.mode,a),QB=JB({name:"TransitionGroup",props:sa({},LC,{tag:String,moveClass:String}),setup(a,{slots:d}){const y=wp(),S=Z2();let P,M;return eC(()=>{if(!P.length)return;const k=a.moveClass||`${a.name||"v"}-move`;if(!r3(P[0].el,y.vnode.el,k)){P=[];return}P.forEach(t3),P.forEach(i3);const r=P.filter(n3);Yb(y.vnode.el),r.forEach(j=>{const H=j.el,W=H.style;Yc(H,k),W.transform=W.webkitTransform=W.transitionDuration="";const ee=H[ev]=le=>{le&&le.target!==H||(!le||le.propertyName.endsWith("transform"))&&(H.removeEventListener("transitionend",ee),H[ev]=null,Fh(H,k))};H.addEventListener("transitionend",ee)}),P=[]}),()=>{const k=hs(a),r=DC(k);let j=k.tag||na;if(P=[],M)for(let H=0;H<M.length;H++){const W=M[H];W.el&&W.el instanceof Element&&(P.push(W),jd(W,S_(W,r,S,y)),FC.set(W,W.el.getBoundingClientRect()))}M=d.default?Lw(d.default()):[];for(let H=0;H<M.length;H++){const W=M[H];W.key!=null&&jd(W,S_(W,r,S,y))}return ra(j,null,M)}}}),e3=QB;function t3(a){const d=a.el;d[ev]&&d[ev](),d[ZA]&&d[ZA]()}function i3(a){BC.set(a,a.el.getBoundingClientRect())}function n3(a){const d=FC.get(a),y=BC.get(a),S=d.left-y.left,P=d.top-y.top;if(S||P){const M=a.el.style;return M.transform=M.webkitTransform=`translate(${S}px,${P}px)`,M.transitionDuration="0s",a}}function r3(a,d,y){const S=a.cloneNode(),P=a[pp];P&&P.forEach(r=>{r.split(/\s+/).forEach(j=>j&&S.classList.remove(j))}),y.split(/\s+/).forEach(r=>r&&S.classList.add(r)),S.style.display="none";const M=d.nodeType===1?d:d.parentNode;M.appendChild(S);const{hasTransform:k}=zC(S);return M.removeChild(S),k}const Gh=a=>{const d=a.props["onUpdate:modelValue"]||!1;return Jn(d)?y=>Oy(d,y):d};function s3(a){a.target.composing=!0}function WA(a){const d=a.target;d.composing&&(d.composing=!1,d.dispatchEvent(new Event("input")))}const Kl=Symbol("_assign"),XA={created(a,{modifiers:{lazy:d,trim:y,number:S}},P){a[Kl]=Gh(P);const M=S||P.props&&P.props.type==="number";Gu(a,d?"change":"input",k=>{if(k.target.composing)return;let r=a.value;y&&(r=r.trim()),M&&(r=jy(r)),a[Kl](r)}),y&&Gu(a,"change",()=>{a.value=a.value.trim()}),d||(Gu(a,"compositionstart",s3),Gu(a,"compositionend",WA),Gu(a,"change",WA))},mounted(a,{value:d}){a.value=d??""},beforeUpdate(a,{value:d,oldValue:y,modifiers:{lazy:S,trim:P,number:M}},k){if(a[Kl]=Gh(k),a.composing)return;const r=(M||a.type==="number")&&!/^0\d/.test(a.value)?jy(a.value):a.value,j=d??"";r!==j&&(document.activeElement===a&&a.type!=="range"&&(S&&d===y||P&&a.value.trim()===j)||(a.value=j))}},o3={deep:!0,created(a,d,y){a[Kl]=Gh(y),Gu(a,"change",()=>{const S=a._modelValue,P=mp(a),M=a.checked,k=a[Kl];if(Jn(S)){const r=Sw(S,P),j=r!==-1;if(M&&!j)k(S.concat(P));else if(!M&&j){const H=[...S];H.splice(r,1),k(H)}}else if(bp(S)){const r=new Set(S);M?r.add(P):r.delete(P),k(r)}else k(NC(a,M))})},mounted:KA,beforeUpdate(a,d,y){a[Kl]=Gh(y),KA(a,d,y)}};function KA(a,{value:d,oldValue:y},S){a._modelValue=d;let P;if(Jn(d))P=Sw(d,S.props.value)>-1;else if(bp(d))P=d.has(S.props.value);else{if(d===y)return;P=Ud(d,NC(a,!0))}a.checked!==P&&(a.checked=P)}const a3={created(a,{value:d},y){a.checked=Ud(d,y.props.value),a[Kl]=Gh(y),Gu(a,"change",()=>{a[Kl](mp(a))})},beforeUpdate(a,{value:d,oldValue:y},S){a[Kl]=Gh(S),d!==y&&(a.checked=Ud(d,S.props.value))}},l3={deep:!0,created(a,{value:d,modifiers:{number:y}},S){const P=bp(d);Gu(a,"change",()=>{const M=Array.prototype.filter.call(a.options,k=>k.selected).map(k=>y?jy(mp(k)):mp(k));a[Kl](a.multiple?P?new Set(M):M:M[0]),a._assigning=!0,vv(()=>{a._assigning=!1})}),a[Kl]=Gh(S)},mounted(a,{value:d}){YA(a,d)},beforeUpdate(a,d,y){a[Kl]=Gh(y)},updated(a,{value:d}){a._assigning||YA(a,d)}};function YA(a,d){const y=a.multiple,S=Jn(d);if(!(y&&!S&&!bp(d))){for(let P=0,M=a.options.length;P<M;P++){const k=a.options[P],r=mp(k);if(y)if(S){const j=typeof r;j==="string"||j==="number"?k.selected=d.some(H=>String(H)===String(r)):k.selected=Sw(d,r)>-1}else k.selected=d.has(r);else if(Ud(mp(k),d)){a.selectedIndex!==P&&(a.selectedIndex=P);return}}!y&&a.selectedIndex!==-1&&(a.selectedIndex=-1)}}function mp(a){return"_value"in a?a._value:a.value}function NC(a,d){const y=d?"_trueValue":"_falseValue";return y in a?a[y]:d}const L8={created(a,d,y){Ty(a,d,y,null,"created")},mounted(a,d,y){Ty(a,d,y,null,"mounted")},beforeUpdate(a,d,y,S){Ty(a,d,y,S,"beforeUpdate")},updated(a,d,y,S){Ty(a,d,y,S,"updated")}};function c3(a,d){switch(a){case"SELECT":return l3;case"TEXTAREA":return XA;default:switch(d){case"checkbox":return o3;case"radio":return a3;default:return XA}}}function Ty(a,d,y,S,P){const k=c3(a.tagName,y.props&&y.props.type)[P];k&&k(a,d,y,S)}const u3=["ctrl","shift","alt","meta"],h3={stop:a=>a.stopPropagation(),prevent:a=>a.preventDefault(),self:a=>a.target!==a.currentTarget,ctrl:a=>!a.ctrlKey,shift:a=>!a.shiftKey,alt:a=>!a.altKey,meta:a=>!a.metaKey,left:a=>"button"in a&&a.button!==0,middle:a=>"button"in a&&a.button!==1,right:a=>"button"in a&&a.button!==2,exact:(a,d)=>u3.some(y=>a[`${y}Key`]&&!d.includes(y))},d3=(a,d)=>{const y=a._withMods||(a._withMods={}),S=d.join(".");return y[S]||(y[S]=((P,...M)=>{for(let k=0;k<d.length;k++){const r=h3[d[k]];if(r&&r(P,d))return}return a(P,...M)}))},f3={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},D8=(a,d)=>{const y=a._withKeys||(a._withKeys={}),S=d.join(".");return y[S]||(y[S]=(P=>{if(!("key"in P))return;const M=Ju(P.key);if(d.some(k=>k===M||f3[k]===M))return a(P)}))},UC=sa({patchProp:KB},DB);let __,JA=!1;function p3(){return __||(__=aB(UC))}function m3(){return __=JA?__:lB(UC),JA=!0,__}const VC=((...a)=>{const d=p3().createApp(...a),{mount:y}=d;return d.mount=S=>{const P=$C(S);if(!P)return;const M=d._component;!Ar(M)&&!M.render&&!M.template&&(M.template=P.innerHTML),P.nodeType===1&&(P.textContent="");const k=y(P,!1,jC(P));return P instanceof Element&&(P.removeAttribute("v-cloak"),P.setAttribute("data-v-app","")),k},d}),_3=((...a)=>{const d=m3().createApp(...a),{mount:y}=d;return d.mount=S=>{const P=$C(S);if(P)return y(P,!0,jC(P))},d});function jC(a){if(a instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&a instanceof MathMLElement)return"mathml"}function $C(a){return zo(a)?document.querySelector(a):a}var qC=typeof global=="object"&&global&&global.Object===Object&&global,g3=typeof self=="object"&&self&&self.Object===Object&&self,su=qC||g3||Function("return this")(),ru=su.Symbol,GC=Object.prototype,y3=GC.hasOwnProperty,v3=GC.toString,n_=ru?ru.toStringTag:void 0;function x3(a){var d=y3.call(a,n_),y=a[n_];try{a[n_]=void 0;var S=!0}catch{}var P=v3.call(a);return S&&(d?a[n_]=y:delete a[n_]),P}var b3=Object.prototype,w3=b3.toString;function T3(a){return w3.call(a)}var S3="[object Null]",E3="[object Undefined]",QA=ru?ru.toStringTag:void 0;function Tp(a){return a==null?a===void 0?E3:S3:QA&&QA in Object(a)?x3(a):T3(a)}function Hh(a){return a!=null&&typeof a=="object"}var A3="[object Symbol]";function Vw(a){return typeof a=="symbol"||Hh(a)&&Tp(a)==A3}function I3(a,d){for(var y=-1,S=a==null?0:a.length,P=Array(S);++y<S;)P[y]=d(a[y],y,a);return P}var Yu=Array.isArray,eI=ru?ru.prototype:void 0,tI=eI?eI.toString:void 0;function HC(a){if(typeof a=="string")return a;if(Yu(a))return I3(a,HC)+"";if(Vw(a))return tI?tI.call(a):"";var d=a+"";return d=="0"&&1/a==-1/0?"-0":d}function _p(a){var d=typeof a;return a!=null&&(d=="object"||d=="function")}var P3="[object AsyncFunction]",C3="[object Function]",M3="[object GeneratorFunction]",R3="[object Proxy]";function ZC(a){if(!_p(a))return!1;var d=Tp(a);return d==C3||d==M3||d==P3||d==R3}var L0=su["__core-js_shared__"],iI=(function(){var a=/[^.]+$/.exec(L0&&L0.keys&&L0.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""})();function O3(a){return!!iI&&iI in a}var L3=Function.prototype,D3=L3.toString;function Gd(a){if(a!=null){try{return D3.call(a)}catch{}try{return a+""}catch{}}return""}var z3=/[\\^$.*+?()[\]{}|]/g,k3=/^\[object .+?Constructor\]$/,F3=Function.prototype,B3=Object.prototype,N3=F3.toString,U3=B3.hasOwnProperty,V3=RegExp("^"+N3.call(U3).replace(z3,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function j3(a){if(!_p(a)||O3(a))return!1;var d=ZC(a)?V3:k3;return d.test(Gd(a))}function $3(a,d){return a?.[d]}function Hd(a,d){var y=$3(a,d);return j3(y)?y:void 0}var Jb=Hd(su,"WeakMap"),nI=Object.create,q3=(function(){function a(){}return function(d){if(!_p(d))return{};if(nI)return nI(d);a.prototype=d;var y=new a;return a.prototype=void 0,y}})(),rI=(function(){try{var a=Hd(Object,"defineProperty");return a({},"",{}),a}catch{}})();function G3(a,d){for(var y=-1,S=a==null?0:a.length;++y<S&&d(a[y],y,a)!==!1;);return a}var H3=9007199254740991,Z3=/^(?:0|[1-9]\d*)$/;function jw(a,d){var y=typeof a;return d=d??H3,!!d&&(y=="number"||y!="symbol"&&Z3.test(a))&&a>-1&&a%1==0&&a<d}function W3(a,d,y){d=="__proto__"&&rI?rI(a,d,{configurable:!0,enumerable:!0,value:y,writable:!0}):a[d]=y}function $w(a,d){return a===d||a!==a&&d!==d}var X3=Object.prototype,K3=X3.hasOwnProperty;function WC(a,d,y){var S=a[d];(!(K3.call(a,d)&&$w(S,y))||y===void 0&&!(d in a))&&W3(a,d,y)}var Y3=9007199254740991;function qw(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=Y3}function J3(a){return a!=null&&qw(a.length)&&!ZC(a)}var Q3=Object.prototype;function XC(a){var d=a&&a.constructor,y=typeof d=="function"&&d.prototype||Q3;return a===y}function eN(a,d){for(var y=-1,S=Array(a);++y<a;)S[y]=d(y);return S}var tN="[object Arguments]";function sI(a){return Hh(a)&&Tp(a)==tN}var KC=Object.prototype,iN=KC.hasOwnProperty,nN=KC.propertyIsEnumerable,YC=sI((function(){return arguments})())?sI:function(a){return Hh(a)&&iN.call(a,"callee")&&!nN.call(a,"callee")};function rN(){return!1}var JC=typeof exports=="object"&&exports&&!exports.nodeType&&exports,oI=JC&&typeof module=="object"&&module&&!module.nodeType&&module,sN=oI&&oI.exports===JC,aI=sN?su.Buffer:void 0,oN=aI?aI.isBuffer:void 0,tv=oN||rN,aN="[object Arguments]",lN="[object Array]",cN="[object Boolean]",uN="[object Date]",hN="[object Error]",dN="[object Function]",fN="[object Map]",pN="[object Number]",mN="[object Object]",_N="[object RegExp]",gN="[object Set]",yN="[object String]",vN="[object WeakMap]",xN="[object ArrayBuffer]",bN="[object DataView]",wN="[object Float32Array]",TN="[object Float64Array]",SN="[object Int8Array]",EN="[object Int16Array]",AN="[object Int32Array]",IN="[object Uint8Array]",PN="[object Uint8ClampedArray]",CN="[object Uint16Array]",MN="[object Uint32Array]",ho={};ho[wN]=ho[TN]=ho[SN]=ho[EN]=ho[AN]=ho[IN]=ho[PN]=ho[CN]=ho[MN]=!0;ho[aN]=ho[lN]=ho[xN]=ho[cN]=ho[bN]=ho[uN]=ho[hN]=ho[dN]=ho[fN]=ho[pN]=ho[mN]=ho[_N]=ho[gN]=ho[yN]=ho[vN]=!1;function RN(a){return Hh(a)&&qw(a.length)&&!!ho[Tp(a)]}function Gw(a){return function(d){return a(d)}}var QC=typeof exports=="object"&&exports&&!exports.nodeType&&exports,g_=QC&&typeof module=="object"&&module&&!module.nodeType&&module,ON=g_&&g_.exports===QC,D0=ON&&qC.process,gp=(function(){try{var a=g_&&g_.require&&g_.require("util").types;return a||D0&&D0.binding&&D0.binding("util")}catch{}})(),lI=gp&&gp.isTypedArray,eM=lI?Gw(lI):RN,LN=Object.prototype,DN=LN.hasOwnProperty;function zN(a,d){var y=Yu(a),S=!y&&YC(a),P=!y&&!S&&tv(a),M=!y&&!S&&!P&&eM(a),k=y||S||P||M,r=k?eN(a.length,String):[],j=r.length;for(var H in a)DN.call(a,H)&&!(k&&(H=="length"||P&&(H=="offset"||H=="parent")||M&&(H=="buffer"||H=="byteLength"||H=="byteOffset")||jw(H,j)))&&r.push(H);return r}function tM(a,d){return function(y){return a(d(y))}}var kN=tM(Object.keys,Object),FN=Object.prototype,BN=FN.hasOwnProperty;function NN(a){if(!XC(a))return kN(a);var d=[];for(var y in Object(a))BN.call(a,y)&&y!="constructor"&&d.push(y);return d}function UN(a){return J3(a)?zN(a):NN(a)}var VN=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jN=/^\w*$/;function $N(a,d){if(Yu(a))return!1;var y=typeof a;return y=="number"||y=="symbol"||y=="boolean"||a==null||Vw(a)?!0:jN.test(a)||!VN.test(a)||d!=null&&a in Object(d)}var P_=Hd(Object,"create");function qN(){this.__data__=P_?P_(null):{},this.size=0}function GN(a){var d=this.has(a)&&delete this.__data__[a];return this.size-=d?1:0,d}var HN="__lodash_hash_undefined__",ZN=Object.prototype,WN=ZN.hasOwnProperty;function XN(a){var d=this.__data__;if(P_){var y=d[a];return y===HN?void 0:y}return WN.call(d,a)?d[a]:void 0}var KN=Object.prototype,YN=KN.hasOwnProperty;function JN(a){var d=this.__data__;return P_?d[a]!==void 0:YN.call(d,a)}var QN="__lodash_hash_undefined__";function e4(a,d){var y=this.__data__;return this.size+=this.has(a)?0:1,y[a]=P_&&d===void 0?QN:d,this}function $d(a){var d=-1,y=a==null?0:a.length;for(this.clear();++d<y;){var S=a[d];this.set(S[0],S[1])}}$d.prototype.clear=qN;$d.prototype.delete=GN;$d.prototype.get=XN;$d.prototype.has=JN;$d.prototype.set=e4;function t4(){this.__data__=[],this.size=0}function Ev(a,d){for(var y=a.length;y--;)if($w(a[y][0],d))return y;return-1}var i4=Array.prototype,n4=i4.splice;function r4(a){var d=this.__data__,y=Ev(d,a);if(y<0)return!1;var S=d.length-1;return y==S?d.pop():n4.call(d,y,1),--this.size,!0}function s4(a){var d=this.__data__,y=Ev(d,a);return y<0?void 0:d[y][1]}function o4(a){return Ev(this.__data__,a)>-1}function a4(a,d){var y=this.__data__,S=Ev(y,a);return S<0?(++this.size,y.push([a,d])):y[S][1]=d,this}function th(a){var d=-1,y=a==null?0:a.length;for(this.clear();++d<y;){var S=a[d];this.set(S[0],S[1])}}th.prototype.clear=t4;th.prototype.delete=r4;th.prototype.get=s4;th.prototype.has=o4;th.prototype.set=a4;var C_=Hd(su,"Map");function l4(){this.size=0,this.__data__={hash:new $d,map:new(C_||th),string:new $d}}function c4(a){var d=typeof a;return d=="string"||d=="number"||d=="symbol"||d=="boolean"?a!=="__proto__":a===null}function Av(a,d){var y=a.__data__;return c4(d)?y[typeof d=="string"?"string":"hash"]:y.map}function u4(a){var d=Av(this,a).delete(a);return this.size-=d?1:0,d}function h4(a){return Av(this,a).get(a)}function d4(a){return Av(this,a).has(a)}function f4(a,d){var y=Av(this,a),S=y.size;return y.set(a,d),this.size+=y.size==S?0:1,this}function ih(a){var d=-1,y=a==null?0:a.length;for(this.clear();++d<y;){var S=a[d];this.set(S[0],S[1])}}ih.prototype.clear=l4;ih.prototype.delete=u4;ih.prototype.get=h4;ih.prototype.has=d4;ih.prototype.set=f4;var p4="Expected a function";function Hw(a,d){if(typeof a!="function"||d!=null&&typeof d!="function")throw new TypeError(p4);var y=function(){var S=arguments,P=d?d.apply(this,S):S[0],M=y.cache;if(M.has(P))return M.get(P);var k=a.apply(this,S);return y.cache=M.set(P,k)||M,k};return y.cache=new(Hw.Cache||ih),y}Hw.Cache=ih;var m4=500;function _4(a){var d=Hw(a,function(S){return y.size===m4&&y.clear(),S}),y=d.cache;return d}var g4=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,y4=/\\(\\)?/g,v4=_4(function(a){var d=[];return a.charCodeAt(0)===46&&d.push(""),a.replace(g4,function(y,S,P,M){d.push(P?M.replace(y4,"$1"):S||y)}),d});function x4(a){return a==null?"":HC(a)}function Zw(a,d){return Yu(a)?a:$N(a,d)?[a]:v4(x4(a))}function Ww(a){if(typeof a=="string"||Vw(a))return a;var d=a+"";return d=="0"&&1/a==-1/0?"-0":d}function b4(a,d){d=Zw(d,a);for(var y=0,S=d.length;a!=null&&y<S;)a=a[Ww(d[y++])];return y&&y==S?a:void 0}function dp(a,d,y){var S=a==null?void 0:b4(a,d);return S===void 0?y:S}function w4(a,d){for(var y=-1,S=d.length,P=a.length;++y<S;)a[P+y]=d[y];return a}var T4=tM(Object.getPrototypeOf,Object);function S4(){this.__data__=new th,this.size=0}function E4(a){var d=this.__data__,y=d.delete(a);return this.size=d.size,y}function A4(a){return this.__data__.get(a)}function I4(a){return this.__data__.has(a)}var P4=200;function C4(a,d){var y=this.__data__;if(y instanceof th){var S=y.__data__;if(!C_||S.length<P4-1)return S.push([a,d]),this.size=++y.size,this;y=this.__data__=new ih(S)}return y.set(a,d),this.size=y.size,this}function Zu(a){var d=this.__data__=new th(a);this.size=d.size}Zu.prototype.clear=S4;Zu.prototype.delete=E4;Zu.prototype.get=A4;Zu.prototype.has=I4;Zu.prototype.set=C4;var iM=typeof exports=="object"&&exports&&!exports.nodeType&&exports,cI=iM&&typeof module=="object"&&module&&!module.nodeType&&module,M4=cI&&cI.exports===iM,uI=M4?su.Buffer:void 0;uI&&uI.allocUnsafe;function R4(a,d){return a.slice()}function O4(a,d){for(var y=-1,S=a==null?0:a.length,P=0,M=[];++y<S;){var k=a[y];d(k,y,a)&&(M[P++]=k)}return M}function L4(){return[]}var D4=Object.prototype,z4=D4.propertyIsEnumerable,hI=Object.getOwnPropertySymbols,k4=hI?function(a){return a==null?[]:(a=Object(a),O4(hI(a),function(d){return z4.call(a,d)}))}:L4;function F4(a,d,y){var S=d(a);return Yu(a)?S:w4(S,y(a))}function Qb(a){return F4(a,UN,k4)}var ew=Hd(su,"DataView"),tw=Hd(su,"Promise"),iw=Hd(su,"Set"),dI="[object Map]",B4="[object Object]",fI="[object Promise]",pI="[object Set]",mI="[object WeakMap]",_I="[object DataView]",N4=Gd(ew),U4=Gd(C_),V4=Gd(tw),j4=Gd(iw),$4=Gd(Jb),gc=Tp;(ew&&gc(new ew(new ArrayBuffer(1)))!=_I||C_&&gc(new C_)!=dI||tw&&gc(tw.resolve())!=fI||iw&&gc(new iw)!=pI||Jb&&gc(new Jb)!=mI)&&(gc=function(a){var d=Tp(a),y=d==B4?a.constructor:void 0,S=y?Gd(y):"";if(S)switch(S){case N4:return _I;case U4:return dI;case V4:return fI;case j4:return pI;case $4:return mI}return d});var q4=Object.prototype,G4=q4.hasOwnProperty;function H4(a){var d=a.length,y=new a.constructor(d);return d&&typeof a[0]=="string"&&G4.call(a,"index")&&(y.index=a.index,y.input=a.input),y}var iv=su.Uint8Array;function Xw(a){var d=new a.constructor(a.byteLength);return new iv(d).set(new iv(a)),d}function Z4(a,d){var y=Xw(a.buffer);return new a.constructor(y,a.byteOffset,a.byteLength)}var W4=/\w*$/;function X4(a){var d=new a.constructor(a.source,W4.exec(a));return d.lastIndex=a.lastIndex,d}var gI=ru?ru.prototype:void 0,yI=gI?gI.valueOf:void 0;function K4(a){return yI?Object(yI.call(a)):{}}function Y4(a,d){var y=Xw(a.buffer);return new a.constructor(y,a.byteOffset,a.length)}var J4="[object Boolean]",Q4="[object Date]",e5="[object Map]",t5="[object Number]",i5="[object RegExp]",n5="[object Set]",r5="[object String]",s5="[object Symbol]",o5="[object ArrayBuffer]",a5="[object DataView]",l5="[object Float32Array]",c5="[object Float64Array]",u5="[object Int8Array]",h5="[object Int16Array]",d5="[object Int32Array]",f5="[object Uint8Array]",p5="[object Uint8ClampedArray]",m5="[object Uint16Array]",_5="[object Uint32Array]";function g5(a,d,y){var S=a.constructor;switch(d){case o5:return Xw(a);case J4:case Q4:return new S(+a);case a5:return Z4(a);case l5:case c5:case u5:case h5:case d5:case f5:case p5:case m5:case _5:return Y4(a);case e5:return new S;case t5:case r5:return new S(a);case i5:return X4(a);case n5:return new S;case s5:return K4(a)}}function y5(a){return typeof a.constructor=="function"&&!XC(a)?q3(T4(a)):{}}var v5="[object Map]";function x5(a){return Hh(a)&&gc(a)==v5}var vI=gp&&gp.isMap,b5=vI?Gw(vI):x5,w5="[object Set]";function T5(a){return Hh(a)&&gc(a)==w5}var xI=gp&&gp.isSet,S5=xI?Gw(xI):T5,nM="[object Arguments]",E5="[object Array]",A5="[object Boolean]",I5="[object Date]",P5="[object Error]",rM="[object Function]",C5="[object GeneratorFunction]",M5="[object Map]",R5="[object Number]",sM="[object Object]",O5="[object RegExp]",L5="[object Set]",D5="[object String]",z5="[object Symbol]",k5="[object WeakMap]",F5="[object ArrayBuffer]",B5="[object DataView]",N5="[object Float32Array]",U5="[object Float64Array]",V5="[object Int8Array]",j5="[object Int16Array]",$5="[object Int32Array]",q5="[object Uint8Array]",G5="[object Uint8ClampedArray]",H5="[object Uint16Array]",Z5="[object Uint32Array]",ro={};ro[nM]=ro[E5]=ro[F5]=ro[B5]=ro[A5]=ro[I5]=ro[N5]=ro[U5]=ro[V5]=ro[j5]=ro[$5]=ro[M5]=ro[R5]=ro[sM]=ro[O5]=ro[L5]=ro[D5]=ro[z5]=ro[q5]=ro[G5]=ro[H5]=ro[Z5]=!0;ro[P5]=ro[rM]=ro[k5]=!1;function zy(a,d,y,S,P,M){var k;if(k!==void 0)return k;if(!_p(a))return a;var r=Yu(a);if(r)k=H4(a);else{var j=gc(a),H=j==rM||j==C5;if(tv(a))return R4(a);if(j==sM||j==nM||H&&!P)k=H?{}:y5(a);else{if(!ro[j])return P?a:{};k=g5(a,j)}}M||(M=new Zu);var W=M.get(a);if(W)return W;M.set(a,k),S5(a)?a.forEach(function(pe){k.add(zy(pe,d,y,pe,a,M))}):b5(a)&&a.forEach(function(pe,se){k.set(se,zy(pe,d,y,se,a,M))});var ee=Qb,le=r?void 0:ee(a);return G3(le||a,function(pe,se){le&&(se=pe,pe=a[se]),WC(k,se,zy(pe,d,y,se,a,M))}),k}var W5=1,X5=4;function al(a){return zy(a,W5|X5)}var K5="__lodash_hash_undefined__";function Y5(a){return this.__data__.set(a,K5),this}function J5(a){return this.__data__.has(a)}function nv(a){var d=-1,y=a==null?0:a.length;for(this.__data__=new ih;++d<y;)this.add(a[d])}nv.prototype.add=nv.prototype.push=Y5;nv.prototype.has=J5;function Q5(a,d){for(var y=-1,S=a==null?0:a.length;++y<S;)if(d(a[y],y,a))return!0;return!1}function eU(a,d){return a.has(d)}var tU=1,iU=2;function oM(a,d,y,S,P,M){var k=y&tU,r=a.length,j=d.length;if(r!=j&&!(k&&j>r))return!1;var H=M.get(a),W=M.get(d);if(H&&W)return H==d&&W==a;var ee=-1,le=!0,pe=y&iU?new nv:void 0;for(M.set(a,d),M.set(d,a);++ee<r;){var se=a[ee],he=d[ee];if(S)var Te=k?S(he,se,ee,d,a,M):S(se,he,ee,a,d,M);if(Te!==void 0){if(Te)continue;le=!1;break}if(pe){if(!Q5(d,function(Se,fe){if(!eU(pe,fe)&&(se===Se||P(se,Se,y,S,M)))return pe.push(fe)})){le=!1;break}}else if(!(se===he||P(se,he,y,S,M))){le=!1;break}}return M.delete(a),M.delete(d),le}function nU(a){var d=-1,y=Array(a.size);return a.forEach(function(S,P){y[++d]=[P,S]}),y}function rU(a){var d=-1,y=Array(a.size);return a.forEach(function(S){y[++d]=S}),y}var sU=1,oU=2,aU="[object Boolean]",lU="[object Date]",cU="[object Error]",uU="[object Map]",hU="[object Number]",dU="[object RegExp]",fU="[object Set]",pU="[object String]",mU="[object Symbol]",_U="[object ArrayBuffer]",gU="[object DataView]",bI=ru?ru.prototype:void 0,z0=bI?bI.valueOf:void 0;function yU(a,d,y,S,P,M,k){switch(y){case gU:if(a.byteLength!=d.byteLength||a.byteOffset!=d.byteOffset)return!1;a=a.buffer,d=d.buffer;case _U:return!(a.byteLength!=d.byteLength||!M(new iv(a),new iv(d)));case aU:case lU:case hU:return $w(+a,+d);case cU:return a.name==d.name&&a.message==d.message;case dU:case pU:return a==d+"";case uU:var r=nU;case fU:var j=S&sU;if(r||(r=rU),a.size!=d.size&&!j)return!1;var H=k.get(a);if(H)return H==d;S|=oU,k.set(a,d);var W=oM(r(a),r(d),S,P,M,k);return k.delete(a),W;case mU:if(z0)return z0.call(a)==z0.call(d)}return!1}var vU=1,xU=Object.prototype,bU=xU.hasOwnProperty;function wU(a,d,y,S,P,M){var k=y&vU,r=Qb(a),j=r.length,H=Qb(d),W=H.length;if(j!=W&&!k)return!1;for(var ee=j;ee--;){var le=r[ee];if(!(k?le in d:bU.call(d,le)))return!1}var pe=M.get(a),se=M.get(d);if(pe&&se)return pe==d&&se==a;var he=!0;M.set(a,d),M.set(d,a);for(var Te=k;++ee<j;){le=r[ee];var Se=a[le],fe=d[le];if(S)var oe=k?S(fe,Se,le,d,a,M):S(Se,fe,le,a,d,M);if(!(oe===void 0?Se===fe||P(Se,fe,y,S,M):oe)){he=!1;break}Te||(Te=le=="constructor")}if(he&&!Te){var ge=a.constructor,Ge=d.constructor;ge!=Ge&&"constructor"in a&&"constructor"in d&&!(typeof ge=="function"&&ge instanceof ge&&typeof Ge=="function"&&Ge instanceof Ge)&&(he=!1)}return M.delete(a),M.delete(d),he}var TU=1,wI="[object Arguments]",TI="[object Array]",Sy="[object Object]",SU=Object.prototype,SI=SU.hasOwnProperty;function EU(a,d,y,S,P,M){var k=Yu(a),r=Yu(d),j=k?TI:gc(a),H=r?TI:gc(d);j=j==wI?Sy:j,H=H==wI?Sy:H;var W=j==Sy,ee=H==Sy,le=j==H;if(le&&tv(a)){if(!tv(d))return!1;k=!0,W=!1}if(le&&!W)return M||(M=new Zu),k||eM(a)?oM(a,d,y,S,P,M):yU(a,d,j,y,S,P,M);if(!(y&TU)){var pe=W&&SI.call(a,"__wrapped__"),se=ee&&SI.call(d,"__wrapped__");if(pe||se){var he=pe?a.value():a,Te=se?d.value():d;return M||(M=new Zu),P(he,Te,y,S,M)}}return le?(M||(M=new Zu),wU(a,d,y,S,P,M)):!1}function aM(a,d,y,S,P){return a===d?!0:a==null||d==null||!Hh(a)&&!Hh(d)?a!==a&&d!==d:EU(a,d,y,S,aM,P)}function AU(a,d,y){d=Zw(d,a);for(var S=-1,P=d.length,M=!1;++S<P;){var k=Ww(d[S]);if(!(M=a!=null&&y(a,k)))break;a=a[k]}return M||++S!=P?M:(P=a==null?0:a.length,!!P&&qw(P)&&jw(k,P)&&(Yu(a)||YC(a)))}var IU=Object.prototype,PU=IU.hasOwnProperty;function CU(a,d){return a!=null&&PU.call(a,d)}function MU(a,d){return a!=null&&AU(a,d,CU)}function RU(a,d){return aM(a,d)}function OU(a,d,y,S){if(!_p(a))return a;d=Zw(d,a);for(var P=-1,M=d.length,k=M-1,r=a;r!=null&&++P<M;){var j=Ww(d[P]),H=y;if(j==="__proto__"||j==="constructor"||j==="prototype")return a;if(P!=k){var W=r[j];H=void 0,H===void 0&&(H=_p(W)?W:jw(d[P+1])?[]:{})}WC(r,j,H),r=r[j]}return a}function Md(a,d,y){return a==null?a:OU(a,d,y)}var k0,EI;function Sp(){return EI||(EI=1,k0=TypeError),k0}const LU={},DU=Object.freeze(Object.defineProperty({__proto__:null,default:LU},Symbol.toStringTag,{value:"Module"})),zU=Ck(DU);var F0,AI;function Iv(){if(AI)return F0;AI=1;var a=typeof Map=="function"&&Map.prototype,d=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,y=a&&d&&typeof d.get=="function"?d.get:null,S=a&&Map.prototype.forEach,P=typeof Set=="function"&&Set.prototype,M=Object.getOwnPropertyDescriptor&&P?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,k=P&&M&&typeof M.get=="function"?M.get:null,r=P&&Set.prototype.forEach,j=typeof WeakMap=="function"&&WeakMap.prototype,H=j?WeakMap.prototype.has:null,W=typeof WeakSet=="function"&&WeakSet.prototype,ee=W?WeakSet.prototype.has:null,le=typeof WeakRef=="function"&&WeakRef.prototype,pe=le?WeakRef.prototype.deref:null,se=Boolean.prototype.valueOf,he=Object.prototype.toString,Te=Function.prototype.toString,Se=String.prototype.match,fe=String.prototype.slice,oe=String.prototype.replace,ge=String.prototype.toUpperCase,Ge=String.prototype.toLowerCase,xt=RegExp.prototype.test,It=Array.prototype.concat,ot=Array.prototype.join,Be=Array.prototype.slice,De=Math.floor,Oe=typeof BigInt=="function"?BigInt.prototype.valueOf:null,He=Object.getOwnPropertySymbols,ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,tt=typeof Symbol=="function"&&typeof Symbol.iterator=="object",At=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===tt||!0)?Symbol.toStringTag:null,yt=Object.prototype.propertyIsEnumerable,si=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(Rt){return Rt.__proto__}:null);function wt(Rt,Dt){if(Rt===1/0||Rt===-1/0||Rt!==Rt||Rt&&Rt>-1e3&&Rt<1e3||xt.call(/e/,Dt))return Dt;var en=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof Rt=="number"){var Dn=Rt<0?-De(-Rt):De(Rt);if(Dn!==Rt){var ir=String(Dn),jn=fe.call(Dt,ir.length+1);return oe.call(ir,en,"$&_")+"."+oe.call(oe.call(jn,/([0-9]{3})/g,"$&_"),/_$/,"")}}return oe.call(Dt,en,"$&_")}var Gi=zU,Ti=Gi.custom,di=lt(Ti)?Ti:null,ki={__proto__:null,double:'"',single:"'"},dn={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};F0=function Rt(Dt,en,Dn,ir){var jn=en||{};if(ii(jn,"quoteStyle")&&!ii(ki,jn.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(ii(jn,"maxStringLength")&&(typeof jn.maxStringLength=="number"?jn.maxStringLength<0&&jn.maxStringLength!==1/0:jn.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var rs=ii(jn,"customInspect")?jn.customInspect:!0;if(typeof rs!="boolean"&&rs!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(ii(jn,"indent")&&jn.indent!==null&&jn.indent!=="	"&&!(parseInt(jn.indent,10)===jn.indent&&jn.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(ii(jn,"numericSeparator")&&typeof jn.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Os=jn.numericSeparator;if(typeof Dt>"u")return"undefined";if(Dt===null)return"null";if(typeof Dt=="boolean")return Dt?"true":"false";if(typeof Dt=="string")return Nn(Dt,jn);if(typeof Dt=="number"){if(Dt===0)return 1/0/Dt>0?"0":"-0";var fs=String(Dt);return Os?wt(Dt,fs):fs}if(typeof Dt=="bigint"){var fo=String(Dt)+"n";return Os?wt(Dt,fo):fo}var kt=typeof jn.depth>"u"?5:jn.depth;if(typeof Dn>"u"&&(Dn=0),Dn>=kt&&kt>0&&typeof Dt=="object")return pi(Dt)?"[Array]":"[Object]";var ls=ns(jn,Dn);if(typeof ir>"u")ir=[];else if(bi(ir,Dt)>=0)return"[Circular]";function Ss(pn,Ji,Mn){if(Ji&&(ir=Be.call(ir),ir.push(Ji)),Mn){var er={depth:jn.depth};return ii(jn,"quoteStyle")&&(er.quoteStyle=jn.quoteStyle),Rt(pn,er,Dn+1,ir)}return Rt(pn,jn,Dn+1,ir)}if(typeof Dt=="function"&&!ei(Dt)){var wo=Ei(Dt),Xe=ds(Dt,Ss);return"[Function"+(wo?": "+wo:" (anonymous)")+"]"+(Xe.length>0?" { "+ot.call(Xe,", ")+" }":"")}if(lt(Dt)){var Q=tt?oe.call(String(Dt),/^(Symbol\(.*\))_[^)]*$/,"$1"):ft.call(Dt);return typeof Dt=="object"&&!tt?Xn(Q):Q}if(fn(Dt)){for(var ne="<"+Ge.call(String(Dt.nodeName)),be=Dt.attributes||[],Fe=0;Fe<be.length;Fe++)ne+=" "+be[Fe].name+"="+an(mt(be[Fe].value),"double",jn);return ne+=">",Dt.childNodes&&Dt.childNodes.length&&(ne+="..."),ne+="</"+Ge.call(String(Dt.nodeName))+">",ne}if(pi(Dt)){if(Dt.length===0)return"[]";var ve=ds(Dt,Ss);return ls&&!Wr(ve)?"["+Dr(ve,ls)+"]":"[ "+ot.call(ve,", ")+" ]"}if(_i(Dt)){var Le=ds(Dt,Ss);return!("cause"in Error.prototype)&&"cause"in Dt&&!yt.call(Dt,"cause")?"{ ["+String(Dt)+"] "+ot.call(It.call("[cause]: "+Ss(Dt.cause),Le),", ")+" }":Le.length===0?"["+String(Dt)+"]":"{ ["+String(Dt)+"] "+ot.call(Le,", ")+" }"}if(typeof Dt=="object"&&rs){if(di&&typeof Dt[di]=="function"&&Gi)return Gi(Dt,{depth:kt-Dn});if(rs!=="symbol"&&typeof Dt.inspect=="function")return Dt.inspect()}if(ui(Dt)){var rt=[];return S&&S.call(Dt,function(pn,Ji){rt.push(Ss(Ji,Dt,!0)+" => "+Ss(pn,Dt))}),Qn("Map",y.call(Dt),rt,ls)}if(Hi(Dt)){var je=[];return r&&r.call(Dt,function(pn){je.push(Ss(pn,Dt))}),Qn("Set",k.call(Dt),je,ls)}if(vi(Dt))return is("WeakMap");if($i(Dt))return is("WeakSet");if(sn(Dt))return is("WeakRef");if(Qi(Dt))return Xn(Ss(Number(Dt)));if(vt(Dt))return Xn(Ss(Oe.call(Dt)));if($e(Dt))return Xn(se.call(Dt));if(un(Dt))return Xn(Ss(String(Dt)));if(typeof window<"u"&&Dt===window)return"{ [object Window] }";if(typeof globalThis<"u"&&Dt===globalThis||typeof Jc<"u"&&Dt===Jc)return"{ [object globalThis] }";if(!Ui(Dt)&&!ei(Dt)){var st=ds(Dt,Ss),Nt=si?si(Dt)===Object.prototype:Dt instanceof Object||Dt.constructor===Object,Ct=Dt instanceof Object?"":"null prototype",wi=!Nt&&At&&Object(Dt)===Dt&&At in Dt?fe.call(ci(Dt),8,-1):Ct?"Object":"",qi=Nt||typeof Dt.constructor!="function"?"":Dt.constructor.name?Dt.constructor.name+" ":"",Ki=qi+(wi||Ct?"["+ot.call(It.call([],wi||[],Ct||[]),": ")+"] ":"");return st.length===0?Ki+"{}":ls?Ki+"{"+Dr(st,ls)+"}":Ki+"{ "+ot.call(st,", ")+" }"}return String(Dt)};function an(Rt,Dt,en){var Dn=en.quoteStyle||Dt,ir=ki[Dn];return ir+Rt+ir}function mt(Rt){return oe.call(String(Rt),/"/g,"&quot;")}function Pt(Rt){return!At||!(typeof Rt=="object"&&(At in Rt||typeof Rt[At]<"u"))}function pi(Rt){return ci(Rt)==="[object Array]"&&Pt(Rt)}function Ui(Rt){return ci(Rt)==="[object Date]"&&Pt(Rt)}function ei(Rt){return ci(Rt)==="[object RegExp]"&&Pt(Rt)}function _i(Rt){return ci(Rt)==="[object Error]"&&Pt(Rt)}function un(Rt){return ci(Rt)==="[object String]"&&Pt(Rt)}function Qi(Rt){return ci(Rt)==="[object Number]"&&Pt(Rt)}function $e(Rt){return ci(Rt)==="[object Boolean]"&&Pt(Rt)}function lt(Rt){if(tt)return Rt&&typeof Rt=="object"&&Rt instanceof Symbol;if(typeof Rt=="symbol")return!0;if(!Rt||typeof Rt!="object"||!ft)return!1;try{return ft.call(Rt),!0}catch{}return!1}function vt(Rt){if(!Rt||typeof Rt!="object"||!Oe)return!1;try{return Oe.call(Rt),!0}catch{}return!1}var ai=Object.prototype.hasOwnProperty||function(Rt){return Rt in this};function ii(Rt,Dt){return ai.call(Rt,Dt)}function ci(Rt){return he.call(Rt)}function Ei(Rt){if(Rt.name)return Rt.name;var Dt=Se.call(Te.call(Rt),/^function\s*([\w$]+)/);return Dt?Dt[1]:null}function bi(Rt,Dt){if(Rt.indexOf)return Rt.indexOf(Dt);for(var en=0,Dn=Rt.length;en<Dn;en++)if(Rt[en]===Dt)return en;return-1}function ui(Rt){if(!y||!Rt||typeof Rt!="object")return!1;try{y.call(Rt);try{k.call(Rt)}catch{return!0}return Rt instanceof Map}catch{}return!1}function vi(Rt){if(!H||!Rt||typeof Rt!="object")return!1;try{H.call(Rt,H);try{ee.call(Rt,ee)}catch{return!0}return Rt instanceof WeakMap}catch{}return!1}function sn(Rt){if(!pe||!Rt||typeof Rt!="object")return!1;try{return pe.call(Rt),!0}catch{}return!1}function Hi(Rt){if(!k||!Rt||typeof Rt!="object")return!1;try{k.call(Rt);try{y.call(Rt)}catch{return!0}return Rt instanceof Set}catch{}return!1}function $i(Rt){if(!ee||!Rt||typeof Rt!="object")return!1;try{ee.call(Rt,ee);try{H.call(Rt,H)}catch{return!0}return Rt instanceof WeakSet}catch{}return!1}function fn(Rt){return!Rt||typeof Rt!="object"?!1:typeof HTMLElement<"u"&&Rt instanceof HTMLElement?!0:typeof Rt.nodeName=="string"&&typeof Rt.getAttribute=="function"}function Nn(Rt,Dt){if(Rt.length>Dt.maxStringLength){var en=Rt.length-Dt.maxStringLength,Dn="... "+en+" more character"+(en>1?"s":"");return Nn(fe.call(Rt,0,Dt.maxStringLength),Dt)+Dn}var ir=dn[Dt.quoteStyle||"single"];ir.lastIndex=0;var jn=oe.call(oe.call(Rt,ir,"\\$1"),/[\x00-\x1f]/g,br);return an(jn,"single",Dt)}function br(Rt){var Dt=Rt.charCodeAt(0),en={8:"b",9:"t",10:"n",12:"f",13:"r"}[Dt];return en?"\\"+en:"\\x"+(Dt<16?"0":"")+ge.call(Dt.toString(16))}function Xn(Rt){return"Object("+Rt+")"}function is(Rt){return Rt+" { ? }"}function Qn(Rt,Dt,en,Dn){var ir=Dn?Dr(en,Dn):ot.call(en,", ");return Rt+" ("+Dt+") {"+ir+"}"}function Wr(Rt){for(var Dt=0;Dt<Rt.length;Dt++)if(bi(Rt[Dt],`
`)>=0)return!1;return!0}function ns(Rt,Dt){var en;if(Rt.indent==="	")en="	";else if(typeof Rt.indent=="number"&&Rt.indent>0)en=ot.call(Array(Rt.indent+1)," ");else return null;return{base:en,prev:ot.call(Array(Dt+1),en)}}function Dr(Rt,Dt){if(Rt.length===0)return"";var en=`
`+Dt.prev+Dt.base;return en+ot.call(Rt,","+en)+`
`+Dt.prev}function ds(Rt,Dt){var en=pi(Rt),Dn=[];if(en){Dn.length=Rt.length;for(var ir=0;ir<Rt.length;ir++)Dn[ir]=ii(Rt,ir)?Dt(Rt[ir],Rt):""}var jn=typeof He=="function"?He(Rt):[],rs;if(tt){rs={};for(var Os=0;Os<jn.length;Os++)rs["$"+jn[Os]]=jn[Os]}for(var fs in Rt)ii(Rt,fs)&&(en&&String(Number(fs))===fs&&fs<Rt.length||tt&&rs["$"+fs]instanceof Symbol||(xt.call(/[^\w$]/,fs)?Dn.push(Dt(fs,Rt)+": "+Dt(Rt[fs],Rt)):Dn.push(fs+": "+Dt(Rt[fs],Rt))));if(typeof He=="function")for(var fo=0;fo<jn.length;fo++)yt.call(Rt,jn[fo])&&Dn.push("["+Dt(jn[fo])+"]: "+Dt(Rt[jn[fo]],Rt));return Dn}return F0}var B0,II;function kU(){if(II)return B0;II=1;var a=Iv(),d=Sp(),y=function(r,j,H){for(var W=r,ee;(ee=W.next)!=null;W=ee)if(ee.key===j)return W.next=ee.next,H||(ee.next=r.next,r.next=ee),ee},S=function(r,j){if(r){var H=y(r,j);return H&&H.value}},P=function(r,j,H){var W=y(r,j);W?W.value=H:r.next={key:j,next:r.next,value:H}},M=function(r,j){return r?!!y(r,j):!1},k=function(r,j){if(r)return y(r,j,!0)};return B0=function(){var j,H={assert:function(W){if(!H.has(W))throw new d("Side channel does not contain "+a(W))},delete:function(W){var ee=j&&j.next,le=k(j,W);return le&&ee&&ee===le&&(j=void 0),!!le},get:function(W){return S(j,W)},has:function(W){return M(j,W)},set:function(W,ee){j||(j={next:void 0}),P(j,W,ee)}};return H},B0}var N0,PI;function lM(){return PI||(PI=1,N0=Object),N0}var U0,CI;function FU(){return CI||(CI=1,U0=Error),U0}var V0,MI;function BU(){return MI||(MI=1,V0=EvalError),V0}var j0,RI;function NU(){return RI||(RI=1,j0=RangeError),j0}var $0,OI;function UU(){return OI||(OI=1,$0=ReferenceError),$0}var q0,LI;function VU(){return LI||(LI=1,q0=SyntaxError),q0}var G0,DI;function jU(){return DI||(DI=1,G0=URIError),G0}var H0,zI;function $U(){return zI||(zI=1,H0=Math.abs),H0}var Z0,kI;function qU(){return kI||(kI=1,Z0=Math.floor),Z0}var W0,FI;function GU(){return FI||(FI=1,W0=Math.max),W0}var X0,BI;function HU(){return BI||(BI=1,X0=Math.min),X0}var K0,NI;function ZU(){return NI||(NI=1,K0=Math.pow),K0}var Y0,UI;function WU(){return UI||(UI=1,Y0=Math.round),Y0}var J0,VI;function XU(){return VI||(VI=1,J0=Number.isNaN||function(d){return d!==d}),J0}var Q0,jI;function KU(){if(jI)return Q0;jI=1;var a=XU();return Q0=function(y){return a(y)||y===0?y:y<0?-1:1},Q0}var eb,$I;function YU(){return $I||($I=1,eb=Object.getOwnPropertyDescriptor),eb}var tb,qI;function cM(){if(qI)return tb;qI=1;var a=YU();if(a)try{a([],"length")}catch{a=null}return tb=a,tb}var ib,GI;function JU(){if(GI)return ib;GI=1;var a=Object.defineProperty||!1;if(a)try{a({},"a",{value:1})}catch{a=!1}return ib=a,ib}var nb,HI;function QU(){return HI||(HI=1,nb=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var d={},y=Symbol("test"),S=Object(y);if(typeof y=="string"||Object.prototype.toString.call(y)!=="[object Symbol]"||Object.prototype.toString.call(S)!=="[object Symbol]")return!1;var P=42;d[y]=P;for(var M in d)return!1;if(typeof Object.keys=="function"&&Object.keys(d).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(d).length!==0)return!1;var k=Object.getOwnPropertySymbols(d);if(k.length!==1||k[0]!==y||!Object.prototype.propertyIsEnumerable.call(d,y))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var r=Object.getOwnPropertyDescriptor(d,y);if(r.value!==P||r.enumerable!==!0)return!1}return!0}),nb}var rb,ZI;function eV(){if(ZI)return rb;ZI=1;var a=typeof Symbol<"u"&&Symbol,d=QU();return rb=function(){return typeof a!="function"||typeof Symbol!="function"||typeof a("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:d()},rb}var sb,WI;function uM(){return WI||(WI=1,sb=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),sb}var ob,XI;function hM(){if(XI)return ob;XI=1;var a=lM();return ob=a.getPrototypeOf||null,ob}var ab,KI;function tV(){if(KI)return ab;KI=1;var a="Function.prototype.bind called on incompatible ",d=Object.prototype.toString,y=Math.max,S="[object Function]",P=function(j,H){for(var W=[],ee=0;ee<j.length;ee+=1)W[ee]=j[ee];for(var le=0;le<H.length;le+=1)W[le+j.length]=H[le];return W},M=function(j,H){for(var W=[],ee=H,le=0;ee<j.length;ee+=1,le+=1)W[le]=j[ee];return W},k=function(r,j){for(var H="",W=0;W<r.length;W+=1)H+=r[W],W+1<r.length&&(H+=j);return H};return ab=function(j){var H=this;if(typeof H!="function"||d.apply(H)!==S)throw new TypeError(a+H);for(var W=M(arguments,1),ee,le=function(){if(this instanceof ee){var Se=H.apply(this,P(W,arguments));return Object(Se)===Se?Se:this}return H.apply(j,P(W,arguments))},pe=y(0,H.length-W.length),se=[],he=0;he<pe;he++)se[he]="$"+he;if(ee=Function("binder","return function ("+k(se,",")+"){ return binder.apply(this,arguments); }")(le),H.prototype){var Te=function(){};Te.prototype=H.prototype,ee.prototype=new Te,Te.prototype=null}return ee},ab}var lb,YI;function Pv(){if(YI)return lb;YI=1;var a=tV();return lb=Function.prototype.bind||a,lb}var cb,JI;function Kw(){return JI||(JI=1,cb=Function.prototype.call),cb}var ub,QI;function dM(){return QI||(QI=1,ub=Function.prototype.apply),ub}var hb,eP;function iV(){return eP||(eP=1,hb=typeof Reflect<"u"&&Reflect&&Reflect.apply),hb}var db,tP;function nV(){if(tP)return db;tP=1;var a=Pv(),d=dM(),y=Kw(),S=iV();return db=S||a.call(y,d),db}var fb,iP;function fM(){if(iP)return fb;iP=1;var a=Pv(),d=Sp(),y=Kw(),S=nV();return fb=function(M){if(M.length<1||typeof M[0]!="function")throw new d("a function is required");return S(a,y,M)},fb}var pb,nP;function rV(){if(nP)return pb;nP=1;var a=fM(),d=cM(),y;try{y=[].__proto__===Array.prototype}catch(k){if(!k||typeof k!="object"||!("code"in k)||k.code!=="ERR_PROTO_ACCESS")throw k}var S=!!y&&d&&d(Object.prototype,"__proto__"),P=Object,M=P.getPrototypeOf;return pb=S&&typeof S.get=="function"?a([S.get]):typeof M=="function"?function(r){return M(r==null?r:P(r))}:!1,pb}var mb,rP;function sV(){if(rP)return mb;rP=1;var a=uM(),d=hM(),y=rV();return mb=a?function(P){return a(P)}:d?function(P){if(!P||typeof P!="object"&&typeof P!="function")throw new TypeError("getProto: not an object");return d(P)}:y?function(P){return y(P)}:null,mb}var _b,sP;function oV(){if(sP)return _b;sP=1;var a=Function.prototype.call,d=Object.prototype.hasOwnProperty,y=Pv();return _b=y.call(a,d),_b}var gb,oP;function Yw(){if(oP)return gb;oP=1;var a,d=lM(),y=FU(),S=BU(),P=NU(),M=UU(),k=VU(),r=Sp(),j=jU(),H=$U(),W=qU(),ee=GU(),le=HU(),pe=ZU(),se=WU(),he=KU(),Te=Function,Se=function(ei){try{return Te('"use strict"; return ('+ei+").constructor;")()}catch{}},fe=cM(),oe=JU(),ge=function(){throw new r},Ge=fe?(function(){try{return arguments.callee,ge}catch{try{return fe(arguments,"callee").get}catch{return ge}}})():ge,xt=eV()(),It=sV(),ot=hM(),Be=uM(),De=dM(),Oe=Kw(),He={},ft=typeof Uint8Array>"u"||!It?a:It(Uint8Array),tt={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?a:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?a:ArrayBuffer,"%ArrayIteratorPrototype%":xt&&It?It([][Symbol.iterator]()):a,"%AsyncFromSyncIteratorPrototype%":a,"%AsyncFunction%":He,"%AsyncGenerator%":He,"%AsyncGeneratorFunction%":He,"%AsyncIteratorPrototype%":He,"%Atomics%":typeof Atomics>"u"?a:Atomics,"%BigInt%":typeof BigInt>"u"?a:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?a:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?a:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?a:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":y,"%eval%":eval,"%EvalError%":S,"%Float16Array%":typeof Float16Array>"u"?a:Float16Array,"%Float32Array%":typeof Float32Array>"u"?a:Float32Array,"%Float64Array%":typeof Float64Array>"u"?a:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?a:FinalizationRegistry,"%Function%":Te,"%GeneratorFunction%":He,"%Int8Array%":typeof Int8Array>"u"?a:Int8Array,"%Int16Array%":typeof Int16Array>"u"?a:Int16Array,"%Int32Array%":typeof Int32Array>"u"?a:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":xt&&It?It(It([][Symbol.iterator]())):a,"%JSON%":typeof JSON=="object"?JSON:a,"%Map%":typeof Map>"u"?a:Map,"%MapIteratorPrototype%":typeof Map>"u"||!xt||!It?a:It(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":d,"%Object.getOwnPropertyDescriptor%":fe,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?a:Promise,"%Proxy%":typeof Proxy>"u"?a:Proxy,"%RangeError%":P,"%ReferenceError%":M,"%Reflect%":typeof Reflect>"u"?a:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?a:Set,"%SetIteratorPrototype%":typeof Set>"u"||!xt||!It?a:It(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?a:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":xt&&It?It(""[Symbol.iterator]()):a,"%Symbol%":xt?Symbol:a,"%SyntaxError%":k,"%ThrowTypeError%":Ge,"%TypedArray%":ft,"%TypeError%":r,"%Uint8Array%":typeof Uint8Array>"u"?a:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?a:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?a:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?a:Uint32Array,"%URIError%":j,"%WeakMap%":typeof WeakMap>"u"?a:WeakMap,"%WeakRef%":typeof WeakRef>"u"?a:WeakRef,"%WeakSet%":typeof WeakSet>"u"?a:WeakSet,"%Function.prototype.call%":Oe,"%Function.prototype.apply%":De,"%Object.defineProperty%":oe,"%Object.getPrototypeOf%":ot,"%Math.abs%":H,"%Math.floor%":W,"%Math.max%":ee,"%Math.min%":le,"%Math.pow%":pe,"%Math.round%":se,"%Math.sign%":he,"%Reflect.getPrototypeOf%":Be};if(It)try{null.error}catch(ei){var At=It(It(ei));tt["%Error.prototype%"]=At}var yt=function ei(_i){var un;if(_i==="%AsyncFunction%")un=Se("async function () {}");else if(_i==="%GeneratorFunction%")un=Se("function* () {}");else if(_i==="%AsyncGeneratorFunction%")un=Se("async function* () {}");else if(_i==="%AsyncGenerator%"){var Qi=ei("%AsyncGeneratorFunction%");Qi&&(un=Qi.prototype)}else if(_i==="%AsyncIteratorPrototype%"){var $e=ei("%AsyncGenerator%");$e&&It&&(un=It($e.prototype))}return tt[_i]=un,un},si={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},wt=Pv(),Gi=oV(),Ti=wt.call(Oe,Array.prototype.concat),di=wt.call(De,Array.prototype.splice),ki=wt.call(Oe,String.prototype.replace),dn=wt.call(Oe,String.prototype.slice),an=wt.call(Oe,RegExp.prototype.exec),mt=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Pt=/\\(\\)?/g,pi=function(_i){var un=dn(_i,0,1),Qi=dn(_i,-1);if(un==="%"&&Qi!=="%")throw new k("invalid intrinsic syntax, expected closing `%`");if(Qi==="%"&&un!=="%")throw new k("invalid intrinsic syntax, expected opening `%`");var $e=[];return ki(_i,mt,function(lt,vt,ai,ii){$e[$e.length]=ai?ki(ii,Pt,"$1"):vt||lt}),$e},Ui=function(_i,un){var Qi=_i,$e;if(Gi(si,Qi)&&($e=si[Qi],Qi="%"+$e[0]+"%"),Gi(tt,Qi)){var lt=tt[Qi];if(lt===He&&(lt=yt(Qi)),typeof lt>"u"&&!un)throw new r("intrinsic "+_i+" exists, but is not available. Please file an issue!");return{alias:$e,name:Qi,value:lt}}throw new k("intrinsic "+_i+" does not exist!")};return gb=function(_i,un){if(typeof _i!="string"||_i.length===0)throw new r("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof un!="boolean")throw new r('"allowMissing" argument must be a boolean');if(an(/^%?[^%]*%?$/,_i)===null)throw new k("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Qi=pi(_i),$e=Qi.length>0?Qi[0]:"",lt=Ui("%"+$e+"%",un),vt=lt.name,ai=lt.value,ii=!1,ci=lt.alias;ci&&($e=ci[0],di(Qi,Ti([0,1],ci)));for(var Ei=1,bi=!0;Ei<Qi.length;Ei+=1){var ui=Qi[Ei],vi=dn(ui,0,1),sn=dn(ui,-1);if((vi==='"'||vi==="'"||vi==="`"||sn==='"'||sn==="'"||sn==="`")&&vi!==sn)throw new k("property names with quotes must have matching quotes");if((ui==="constructor"||!bi)&&(ii=!0),$e+="."+ui,vt="%"+$e+"%",Gi(tt,vt))ai=tt[vt];else if(ai!=null){if(!(ui in ai)){if(!un)throw new r("base intrinsic for "+_i+" exists, but the property is not available.");return}if(fe&&Ei+1>=Qi.length){var Hi=fe(ai,ui);bi=!!Hi,bi&&"get"in Hi&&!("originalValue"in Hi.get)?ai=Hi.get:ai=ai[ui]}else bi=Gi(ai,ui),ai=ai[ui];bi&&!ii&&(tt[vt]=ai)}}return ai},gb}var yb,aP;function pM(){if(aP)return yb;aP=1;var a=Yw(),d=fM(),y=d([a("%String.prototype.indexOf%")]);return yb=function(P,M){var k=a(P,!!M);return typeof k=="function"&&y(P,".prototype.")>-1?d([k]):k},yb}var vb,lP;function mM(){if(lP)return vb;lP=1;var a=Yw(),d=pM(),y=Iv(),S=Sp(),P=a("%Map%",!0),M=d("Map.prototype.get",!0),k=d("Map.prototype.set",!0),r=d("Map.prototype.has",!0),j=d("Map.prototype.delete",!0),H=d("Map.prototype.size",!0);return vb=!!P&&function(){var ee,le={assert:function(pe){if(!le.has(pe))throw new S("Side channel does not contain "+y(pe))},delete:function(pe){if(ee){var se=j(ee,pe);return H(ee)===0&&(ee=void 0),se}return!1},get:function(pe){if(ee)return M(ee,pe)},has:function(pe){return ee?r(ee,pe):!1},set:function(pe,se){ee||(ee=new P),k(ee,pe,se)}};return le},vb}var xb,cP;function aV(){if(cP)return xb;cP=1;var a=Yw(),d=pM(),y=Iv(),S=mM(),P=Sp(),M=a("%WeakMap%",!0),k=d("WeakMap.prototype.get",!0),r=d("WeakMap.prototype.set",!0),j=d("WeakMap.prototype.has",!0),H=d("WeakMap.prototype.delete",!0);return xb=M?function(){var ee,le,pe={assert:function(se){if(!pe.has(se))throw new P("Side channel does not contain "+y(se))},delete:function(se){if(M&&se&&(typeof se=="object"||typeof se=="function")){if(ee)return H(ee,se)}else if(S&&le)return le.delete(se);return!1},get:function(se){return M&&se&&(typeof se=="object"||typeof se=="function")&&ee?k(ee,se):le&&le.get(se)},has:function(se){return M&&se&&(typeof se=="object"||typeof se=="function")&&ee?j(ee,se):!!le&&le.has(se)},set:function(se,he){M&&se&&(typeof se=="object"||typeof se=="function")?(ee||(ee=new M),r(ee,se,he)):S&&(le||(le=S()),le.set(se,he))}};return pe}:S,xb}var bb,uP;function lV(){if(uP)return bb;uP=1;var a=Sp(),d=Iv(),y=kU(),S=mM(),P=aV(),M=P||S||y;return bb=function(){var r,j={assert:function(H){if(!j.has(H))throw new a("Side channel does not contain "+d(H))},delete:function(H){return!!r&&r.delete(H)},get:function(H){return r&&r.get(H)},has:function(H){return!!r&&r.has(H)},set:function(H,W){r||(r=M()),r.set(H,W)}};return j},bb}var wb,hP;function Jw(){if(hP)return wb;hP=1;var a=String.prototype.replace,d=/%20/g,y={RFC1738:"RFC1738",RFC3986:"RFC3986"};return wb={default:y.RFC3986,formatters:{RFC1738:function(S){return a.call(S,d,"+")},RFC3986:function(S){return String(S)}},RFC1738:y.RFC1738,RFC3986:y.RFC3986},wb}var Tb,dP;function _M(){if(dP)return Tb;dP=1;var a=Jw(),d=Object.prototype.hasOwnProperty,y=Array.isArray,S=(function(){for(var Te=[],Se=0;Se<256;++Se)Te.push("%"+((Se<16?"0":"")+Se.toString(16)).toUpperCase());return Te})(),P=function(Se){for(;Se.length>1;){var fe=Se.pop(),oe=fe.obj[fe.prop];if(y(oe)){for(var ge=[],Ge=0;Ge<oe.length;++Ge)typeof oe[Ge]<"u"&&ge.push(oe[Ge]);fe.obj[fe.prop]=ge}}},M=function(Se,fe){for(var oe=fe&&fe.plainObjects?{__proto__:null}:{},ge=0;ge<Se.length;++ge)typeof Se[ge]<"u"&&(oe[ge]=Se[ge]);return oe},k=function Te(Se,fe,oe){if(!fe)return Se;if(typeof fe!="object"&&typeof fe!="function"){if(y(Se))Se.push(fe);else if(Se&&typeof Se=="object")(oe&&(oe.plainObjects||oe.allowPrototypes)||!d.call(Object.prototype,fe))&&(Se[fe]=!0);else return[Se,fe];return Se}if(!Se||typeof Se!="object")return[Se].concat(fe);var ge=Se;return y(Se)&&!y(fe)&&(ge=M(Se,oe)),y(Se)&&y(fe)?(fe.forEach(function(Ge,xt){if(d.call(Se,xt)){var It=Se[xt];It&&typeof It=="object"&&Ge&&typeof Ge=="object"?Se[xt]=Te(It,Ge,oe):Se.push(Ge)}else Se[xt]=Ge}),Se):Object.keys(fe).reduce(function(Ge,xt){var It=fe[xt];return d.call(Ge,xt)?Ge[xt]=Te(Ge[xt],It,oe):Ge[xt]=It,Ge},ge)},r=function(Se,fe){return Object.keys(fe).reduce(function(oe,ge){return oe[ge]=fe[ge],oe},Se)},j=function(Te,Se,fe){var oe=Te.replace(/\+/g," ");if(fe==="iso-8859-1")return oe.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(oe)}catch{return oe}},H=1024,W=function(Se,fe,oe,ge,Ge){if(Se.length===0)return Se;var xt=Se;if(typeof Se=="symbol"?xt=Symbol.prototype.toString.call(Se):typeof Se!="string"&&(xt=String(Se)),oe==="iso-8859-1")return escape(xt).replace(/%u[0-9a-f]{4}/gi,function(ft){return"%26%23"+parseInt(ft.slice(2),16)+"%3B"});for(var It="",ot=0;ot<xt.length;ot+=H){for(var Be=xt.length>=H?xt.slice(ot,ot+H):xt,De=[],Oe=0;Oe<Be.length;++Oe){var He=Be.charCodeAt(Oe);if(He===45||He===46||He===95||He===126||He>=48&&He<=57||He>=65&&He<=90||He>=97&&He<=122||Ge===a.RFC1738&&(He===40||He===41)){De[De.length]=Be.charAt(Oe);continue}if(He<128){De[De.length]=S[He];continue}if(He<2048){De[De.length]=S[192|He>>6]+S[128|He&63];continue}if(He<55296||He>=57344){De[De.length]=S[224|He>>12]+S[128|He>>6&63]+S[128|He&63];continue}Oe+=1,He=65536+((He&1023)<<10|Be.charCodeAt(Oe)&1023),De[De.length]=S[240|He>>18]+S[128|He>>12&63]+S[128|He>>6&63]+S[128|He&63]}It+=De.join("")}return It},ee=function(Se){for(var fe=[{obj:{o:Se},prop:"o"}],oe=[],ge=0;ge<fe.length;++ge)for(var Ge=fe[ge],xt=Ge.obj[Ge.prop],It=Object.keys(xt),ot=0;ot<It.length;++ot){var Be=It[ot],De=xt[Be];typeof De=="object"&&De!==null&&oe.indexOf(De)===-1&&(fe.push({obj:xt,prop:Be}),oe.push(De))}return P(fe),Se},le=function(Se){return Object.prototype.toString.call(Se)==="[object RegExp]"},pe=function(Se){return!Se||typeof Se!="object"?!1:!!(Se.constructor&&Se.constructor.isBuffer&&Se.constructor.isBuffer(Se))},se=function(Se,fe){return[].concat(Se,fe)},he=function(Se,fe){if(y(Se)){for(var oe=[],ge=0;ge<Se.length;ge+=1)oe.push(fe(Se[ge]));return oe}return fe(Se)};return Tb={arrayToObject:M,assign:r,combine:se,compact:ee,decode:j,encode:W,isBuffer:pe,isRegExp:le,maybeMap:he,merge:k},Tb}var Sb,fP;function cV(){if(fP)return Sb;fP=1;var a=lV(),d=_M(),y=Jw(),S=Object.prototype.hasOwnProperty,P={brackets:function(Te){return Te+"[]"},comma:"comma",indices:function(Te,Se){return Te+"["+Se+"]"},repeat:function(Te){return Te}},M=Array.isArray,k=Array.prototype.push,r=function(he,Te){k.apply(he,M(Te)?Te:[Te])},j=Date.prototype.toISOString,H=y.default,W={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:d.encode,encodeValuesOnly:!1,filter:void 0,format:H,formatter:y.formatters[H],indices:!1,serializeDate:function(Te){return j.call(Te)},skipNulls:!1,strictNullHandling:!1},ee=function(Te){return typeof Te=="string"||typeof Te=="number"||typeof Te=="boolean"||typeof Te=="symbol"||typeof Te=="bigint"},le={},pe=function he(Te,Se,fe,oe,ge,Ge,xt,It,ot,Be,De,Oe,He,ft,tt,At,yt,si){for(var wt=Te,Gi=si,Ti=0,di=!1;(Gi=Gi.get(le))!==void 0&&!di;){var ki=Gi.get(Te);if(Ti+=1,typeof ki<"u"){if(ki===Ti)throw new RangeError("Cyclic object value");di=!0}typeof Gi.get(le)>"u"&&(Ti=0)}if(typeof Be=="function"?wt=Be(Se,wt):wt instanceof Date?wt=He(wt):fe==="comma"&&M(wt)&&(wt=d.maybeMap(wt,function(vt){return vt instanceof Date?He(vt):vt})),wt===null){if(Ge)return ot&&!At?ot(Se,W.encoder,yt,"key",ft):Se;wt=""}if(ee(wt)||d.isBuffer(wt)){if(ot){var dn=At?Se:ot(Se,W.encoder,yt,"key",ft);return[tt(dn)+"="+tt(ot(wt,W.encoder,yt,"value",ft))]}return[tt(Se)+"="+tt(String(wt))]}var an=[];if(typeof wt>"u")return an;var mt;if(fe==="comma"&&M(wt))At&&ot&&(wt=d.maybeMap(wt,ot)),mt=[{value:wt.length>0?wt.join(",")||null:void 0}];else if(M(Be))mt=Be;else{var Pt=Object.keys(wt);mt=De?Pt.sort(De):Pt}var pi=It?String(Se).replace(/\./g,"%2E"):String(Se),Ui=oe&&M(wt)&&wt.length===1?pi+"[]":pi;if(ge&&M(wt)&&wt.length===0)return Ui+"[]";for(var ei=0;ei<mt.length;++ei){var _i=mt[ei],un=typeof _i=="object"&&_i&&typeof _i.value<"u"?_i.value:wt[_i];if(!(xt&&un===null)){var Qi=Oe&&It?String(_i).replace(/\./g,"%2E"):String(_i),$e=M(wt)?typeof fe=="function"?fe(Ui,Qi):Ui:Ui+(Oe?"."+Qi:"["+Qi+"]");si.set(Te,Ti);var lt=a();lt.set(le,si),r(an,he(un,$e,fe,oe,ge,Ge,xt,It,fe==="comma"&&At&&M(wt)?null:ot,Be,De,Oe,He,ft,tt,At,yt,lt))}}return an},se=function(Te){if(!Te)return W;if(typeof Te.allowEmptyArrays<"u"&&typeof Te.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof Te.encodeDotInKeys<"u"&&typeof Te.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(Te.encoder!==null&&typeof Te.encoder<"u"&&typeof Te.encoder!="function")throw new TypeError("Encoder has to be a function.");var Se=Te.charset||W.charset;if(typeof Te.charset<"u"&&Te.charset!=="utf-8"&&Te.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var fe=y.default;if(typeof Te.format<"u"){if(!S.call(y.formatters,Te.format))throw new TypeError("Unknown format option provided.");fe=Te.format}var oe=y.formatters[fe],ge=W.filter;(typeof Te.filter=="function"||M(Te.filter))&&(ge=Te.filter);var Ge;if(Te.arrayFormat in P?Ge=Te.arrayFormat:"indices"in Te?Ge=Te.indices?"indices":"repeat":Ge=W.arrayFormat,"commaRoundTrip"in Te&&typeof Te.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var xt=typeof Te.allowDots>"u"?Te.encodeDotInKeys===!0?!0:W.allowDots:!!Te.allowDots;return{addQueryPrefix:typeof Te.addQueryPrefix=="boolean"?Te.addQueryPrefix:W.addQueryPrefix,allowDots:xt,allowEmptyArrays:typeof Te.allowEmptyArrays=="boolean"?!!Te.allowEmptyArrays:W.allowEmptyArrays,arrayFormat:Ge,charset:Se,charsetSentinel:typeof Te.charsetSentinel=="boolean"?Te.charsetSentinel:W.charsetSentinel,commaRoundTrip:!!Te.commaRoundTrip,delimiter:typeof Te.delimiter>"u"?W.delimiter:Te.delimiter,encode:typeof Te.encode=="boolean"?Te.encode:W.encode,encodeDotInKeys:typeof Te.encodeDotInKeys=="boolean"?Te.encodeDotInKeys:W.encodeDotInKeys,encoder:typeof Te.encoder=="function"?Te.encoder:W.encoder,encodeValuesOnly:typeof Te.encodeValuesOnly=="boolean"?Te.encodeValuesOnly:W.encodeValuesOnly,filter:ge,format:fe,formatter:oe,serializeDate:typeof Te.serializeDate=="function"?Te.serializeDate:W.serializeDate,skipNulls:typeof Te.skipNulls=="boolean"?Te.skipNulls:W.skipNulls,sort:typeof Te.sort=="function"?Te.sort:null,strictNullHandling:typeof Te.strictNullHandling=="boolean"?Te.strictNullHandling:W.strictNullHandling}};return Sb=function(he,Te){var Se=he,fe=se(Te),oe,ge;typeof fe.filter=="function"?(ge=fe.filter,Se=ge("",Se)):M(fe.filter)&&(ge=fe.filter,oe=ge);var Ge=[];if(typeof Se!="object"||Se===null)return"";var xt=P[fe.arrayFormat],It=xt==="comma"&&fe.commaRoundTrip;oe||(oe=Object.keys(Se)),fe.sort&&oe.sort(fe.sort);for(var ot=a(),Be=0;Be<oe.length;++Be){var De=oe[Be],Oe=Se[De];fe.skipNulls&&Oe===null||r(Ge,pe(Oe,De,xt,It,fe.allowEmptyArrays,fe.strictNullHandling,fe.skipNulls,fe.encodeDotInKeys,fe.encode?fe.encoder:null,fe.filter,fe.sort,fe.allowDots,fe.serializeDate,fe.format,fe.formatter,fe.encodeValuesOnly,fe.charset,ot))}var He=Ge.join(fe.delimiter),ft=fe.addQueryPrefix===!0?"?":"";return fe.charsetSentinel&&(fe.charset==="iso-8859-1"?ft+="utf8=%26%2310003%3B&":ft+="utf8=%E2%9C%93&"),He.length>0?ft+He:""},Sb}var Eb,pP;function uV(){if(pP)return Eb;pP=1;var a=_M(),d=Object.prototype.hasOwnProperty,y=Array.isArray,S={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:a.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},P=function(le){return le.replace(/&#(\d+);/g,function(pe,se){return String.fromCharCode(parseInt(se,10))})},M=function(le,pe,se){if(le&&typeof le=="string"&&pe.comma&&le.indexOf(",")>-1)return le.split(",");if(pe.throwOnLimitExceeded&&se>=pe.arrayLimit)throw new RangeError("Array limit exceeded. Only "+pe.arrayLimit+" element"+(pe.arrayLimit===1?"":"s")+" allowed in an array.");return le},k="utf8=%26%2310003%3B",r="utf8=%E2%9C%93",j=function(pe,se){var he={__proto__:null},Te=se.ignoreQueryPrefix?pe.replace(/^\?/,""):pe;Te=Te.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var Se=se.parameterLimit===1/0?void 0:se.parameterLimit,fe=Te.split(se.delimiter,se.throwOnLimitExceeded?Se+1:Se);if(se.throwOnLimitExceeded&&fe.length>Se)throw new RangeError("Parameter limit exceeded. Only "+Se+" parameter"+(Se===1?"":"s")+" allowed.");var oe=-1,ge,Ge=se.charset;if(se.charsetSentinel)for(ge=0;ge<fe.length;++ge)fe[ge].indexOf("utf8=")===0&&(fe[ge]===r?Ge="utf-8":fe[ge]===k&&(Ge="iso-8859-1"),oe=ge,ge=fe.length);for(ge=0;ge<fe.length;++ge)if(ge!==oe){var xt=fe[ge],It=xt.indexOf("]="),ot=It===-1?xt.indexOf("="):It+1,Be,De;ot===-1?(Be=se.decoder(xt,S.decoder,Ge,"key"),De=se.strictNullHandling?null:""):(Be=se.decoder(xt.slice(0,ot),S.decoder,Ge,"key"),De=a.maybeMap(M(xt.slice(ot+1),se,y(he[Be])?he[Be].length:0),function(He){return se.decoder(He,S.decoder,Ge,"value")})),De&&se.interpretNumericEntities&&Ge==="iso-8859-1"&&(De=P(String(De))),xt.indexOf("[]=")>-1&&(De=y(De)?[De]:De);var Oe=d.call(he,Be);Oe&&se.duplicates==="combine"?he[Be]=a.combine(he[Be],De):(!Oe||se.duplicates==="last")&&(he[Be]=De)}return he},H=function(le,pe,se,he){var Te=0;if(le.length>0&&le[le.length-1]==="[]"){var Se=le.slice(0,-1).join("");Te=Array.isArray(pe)&&pe[Se]?pe[Se].length:0}for(var fe=he?pe:M(pe,se,Te),oe=le.length-1;oe>=0;--oe){var ge,Ge=le[oe];if(Ge==="[]"&&se.parseArrays)ge=se.allowEmptyArrays&&(fe===""||se.strictNullHandling&&fe===null)?[]:a.combine([],fe);else{ge=se.plainObjects?{__proto__:null}:{};var xt=Ge.charAt(0)==="["&&Ge.charAt(Ge.length-1)==="]"?Ge.slice(1,-1):Ge,It=se.decodeDotInKeys?xt.replace(/%2E/g,"."):xt,ot=parseInt(It,10);!se.parseArrays&&It===""?ge={0:fe}:!isNaN(ot)&&Ge!==It&&String(ot)===It&&ot>=0&&se.parseArrays&&ot<=se.arrayLimit?(ge=[],ge[ot]=fe):It!=="__proto__"&&(ge[It]=fe)}fe=ge}return fe},W=function(pe,se,he,Te){if(pe){var Se=he.allowDots?pe.replace(/\.([^.[]+)/g,"[$1]"):pe,fe=/(\[[^[\]]*])/,oe=/(\[[^[\]]*])/g,ge=he.depth>0&&fe.exec(Se),Ge=ge?Se.slice(0,ge.index):Se,xt=[];if(Ge){if(!he.plainObjects&&d.call(Object.prototype,Ge)&&!he.allowPrototypes)return;xt.push(Ge)}for(var It=0;he.depth>0&&(ge=oe.exec(Se))!==null&&It<he.depth;){if(It+=1,!he.plainObjects&&d.call(Object.prototype,ge[1].slice(1,-1))&&!he.allowPrototypes)return;xt.push(ge[1])}if(ge){if(he.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+he.depth+" and strictDepth is true");xt.push("["+Se.slice(ge.index)+"]")}return H(xt,se,he,Te)}},ee=function(pe){if(!pe)return S;if(typeof pe.allowEmptyArrays<"u"&&typeof pe.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof pe.decodeDotInKeys<"u"&&typeof pe.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(pe.decoder!==null&&typeof pe.decoder<"u"&&typeof pe.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof pe.charset<"u"&&pe.charset!=="utf-8"&&pe.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof pe.throwOnLimitExceeded<"u"&&typeof pe.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var se=typeof pe.charset>"u"?S.charset:pe.charset,he=typeof pe.duplicates>"u"?S.duplicates:pe.duplicates;if(he!=="combine"&&he!=="first"&&he!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var Te=typeof pe.allowDots>"u"?pe.decodeDotInKeys===!0?!0:S.allowDots:!!pe.allowDots;return{allowDots:Te,allowEmptyArrays:typeof pe.allowEmptyArrays=="boolean"?!!pe.allowEmptyArrays:S.allowEmptyArrays,allowPrototypes:typeof pe.allowPrototypes=="boolean"?pe.allowPrototypes:S.allowPrototypes,allowSparse:typeof pe.allowSparse=="boolean"?pe.allowSparse:S.allowSparse,arrayLimit:typeof pe.arrayLimit=="number"?pe.arrayLimit:S.arrayLimit,charset:se,charsetSentinel:typeof pe.charsetSentinel=="boolean"?pe.charsetSentinel:S.charsetSentinel,comma:typeof pe.comma=="boolean"?pe.comma:S.comma,decodeDotInKeys:typeof pe.decodeDotInKeys=="boolean"?pe.decodeDotInKeys:S.decodeDotInKeys,decoder:typeof pe.decoder=="function"?pe.decoder:S.decoder,delimiter:typeof pe.delimiter=="string"||a.isRegExp(pe.delimiter)?pe.delimiter:S.delimiter,depth:typeof pe.depth=="number"||pe.depth===!1?+pe.depth:S.depth,duplicates:he,ignoreQueryPrefix:pe.ignoreQueryPrefix===!0,interpretNumericEntities:typeof pe.interpretNumericEntities=="boolean"?pe.interpretNumericEntities:S.interpretNumericEntities,parameterLimit:typeof pe.parameterLimit=="number"?pe.parameterLimit:S.parameterLimit,parseArrays:pe.parseArrays!==!1,plainObjects:typeof pe.plainObjects=="boolean"?pe.plainObjects:S.plainObjects,strictDepth:typeof pe.strictDepth=="boolean"?!!pe.strictDepth:S.strictDepth,strictNullHandling:typeof pe.strictNullHandling=="boolean"?pe.strictNullHandling:S.strictNullHandling,throwOnLimitExceeded:typeof pe.throwOnLimitExceeded=="boolean"?pe.throwOnLimitExceeded:!1}};return Eb=function(le,pe){var se=ee(pe);if(le===""||le===null||typeof le>"u")return se.plainObjects?{__proto__:null}:{};for(var he=typeof le=="string"?j(le,se):le,Te=se.plainObjects?{__proto__:null}:{},Se=Object.keys(he),fe=0;fe<Se.length;++fe){var oe=Se[fe],ge=W(oe,he[oe],se,typeof le=="string");Te=a.merge(Te,ge,se)}return se.allowSparse===!0?Te:a.compact(Te)},Eb}var Ab,mP;function hV(){if(mP)return Ab;mP=1;var a=cV(),d=uV(),y=Jw();return Ab={formats:y,parse:d,stringify:a},Ab}var _P=hV();function nw(a,d){let y;return function(...S){clearTimeout(y),y=setTimeout(()=>a.apply(this,S),d)}}function Yl(a,d){return document.dispatchEvent(new CustomEvent(`inertia:${a}`,d))}var gP=a=>Yl("before",{cancelable:!0,detail:{visit:a}}),dV=a=>Yl("error",{detail:{errors:a}}),fV=a=>Yl("exception",{cancelable:!0,detail:{exception:a}}),pV=a=>Yl("finish",{detail:{visit:a}}),mV=a=>Yl("invalid",{cancelable:!0,detail:{response:a}}),_V=a=>Yl("beforeUpdate",{detail:{page:a}}),y_=a=>Yl("navigate",{detail:{page:a}}),gV=a=>Yl("progress",{detail:{progress:a}}),yV=a=>Yl("start",{detail:{visit:a}}),vV=a=>Yl("success",{detail:{page:a}}),xV=(a,d)=>Yl("prefetched",{detail:{fetchedAt:Date.now(),response:a.data,visit:d}}),bV=a=>Yl("prefetching",{detail:{visit:a}}),Ja=class{static set(a,d){typeof window<"u"&&window.sessionStorage.setItem(a,JSON.stringify(d))}static get(a){if(typeof window<"u")return JSON.parse(window.sessionStorage.getItem(a)||"null")}static merge(a,d){const y=this.get(a);y===null?this.set(a,d):this.set(a,{...y,...d})}static remove(a){typeof window<"u"&&window.sessionStorage.removeItem(a)}static removeNested(a,d){const y=this.get(a);y!==null&&(delete y[d],this.set(a,y))}static exists(a){try{return this.get(a)!==null}catch{return!1}}static clear(){typeof window<"u"&&window.sessionStorage.clear()}};Ja.locationVisitKey="inertiaLocationVisit";var wV=async a=>{if(typeof window>"u")throw new Error("Unable to encrypt history");const d=gM(),y=await yM(),S=await PV(y);if(!S)throw new Error("Unable to encrypt history");return await SV(d,S,a)},yp={key:"historyKey",iv:"historyIv"},TV=async a=>{const d=gM(),y=await yM();if(!y)throw new Error("Unable to decrypt history");return await EV(d,y,a)},SV=async(a,d,y)=>{if(typeof window>"u")throw new Error("Unable to encrypt history");if(typeof window.crypto.subtle>"u")return console.warn("Encryption is not supported in this environment. SSL is required."),Promise.resolve(y);const S=new TextEncoder,P=JSON.stringify(y),M=new Uint8Array(P.length*3),k=S.encodeInto(P,M);return window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},d,M.subarray(0,k.written))},EV=async(a,d,y)=>{if(typeof window.crypto.subtle>"u")return console.warn("Decryption is not supported in this environment. SSL is required."),Promise.resolve(y);const S=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:a},d,y);return JSON.parse(new TextDecoder().decode(S))},gM=()=>{const a=Ja.get(yp.iv);if(a)return new Uint8Array(a);const d=window.crypto.getRandomValues(new Uint8Array(12));return Ja.set(yp.iv,Array.from(d)),d},AV=async()=>typeof window.crypto.subtle>"u"?(console.warn("Encryption is not supported in this environment. SSL is required."),Promise.resolve(null)):window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),IV=async a=>{if(typeof window.crypto.subtle>"u")return console.warn("Encryption is not supported in this environment. SSL is required."),Promise.resolve();const d=await window.crypto.subtle.exportKey("raw",a);Ja.set(yp.key,Array.from(new Uint8Array(d)))},PV=async a=>{if(a)return a;const d=await AV();return d?(await IV(d),d):null},yM=async()=>{const a=Ja.get(yp.key);return a?await window.crypto.subtle.importKey("raw",new Uint8Array(a),{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]):null},yc=class{static save(){Ts.saveScrollPositions(Array.from(this.regions()).map(a=>({top:a.scrollTop,left:a.scrollLeft})))}static regions(){return document.querySelectorAll("[scroll-region]")}static reset(){const a=typeof window<"u"?window.location.hash:null;a||window.scrollTo(0,0),this.regions().forEach(d=>{typeof d.scrollTo=="function"?d.scrollTo(0,0):(d.scrollTop=0,d.scrollLeft=0)}),this.save(),a&&setTimeout(()=>{const d=document.getElementById(a.slice(1));d?d.scrollIntoView():window.scrollTo(0,0)})}static restore(a){typeof window>"u"||window.requestAnimationFrame(()=>{this.restoreDocument(),this.regions().forEach((d,y)=>{const S=a[y];S&&(typeof d.scrollTo=="function"?d.scrollTo(S.left,S.top):(d.scrollTop=S.top,d.scrollLeft=S.left))})})}static restoreDocument(){const a=Ts.getDocumentScrollPosition();window.scrollTo(a.left,a.top)}static onScroll(a){const d=a.target;typeof d.hasAttribute=="function"&&d.hasAttribute("scroll-region")&&this.save()}static onWindowScroll(){Ts.saveDocumentScrollPosition({top:window.scrollY,left:window.scrollX})}};function rw(a){return a instanceof File||a instanceof Blob||a instanceof FileList&&a.length>0||a instanceof FormData&&Array.from(a.values()).some(d=>rw(d))||typeof a=="object"&&a!==null&&Object.values(a).some(d=>rw(d))}var sw=a=>a instanceof FormData;function vM(a,d=new FormData,y=null){a=a||{};for(const S in a)Object.prototype.hasOwnProperty.call(a,S)&&bM(d,xM(y,S),a[S]);return d}function xM(a,d){return a?a+"["+d+"]":d}function bM(a,d,y){if(Array.isArray(y))return Array.from(y.keys()).forEach(S=>bM(a,xM(d,S.toString()),y[S]));if(y instanceof Date)return a.append(d,y.toISOString());if(y instanceof File)return a.append(d,y,y.name);if(y instanceof Blob)return a.append(d,y);if(typeof y=="boolean")return a.append(d,y?"1":"0");if(typeof y=="string")return a.append(d,y);if(typeof y=="number")return a.append(d,`${y}`);if(y==null)return a.append(d,"");vM(y,a,d)}function Vh(a){return new URL(a.toString(),typeof window>"u"?void 0:window.location.toString())}var CV=(a,d,y,S,P)=>{let M=typeof a=="string"?Vh(a):a;if((rw(d)||S)&&!sw(d)&&(d=vM(d)),sw(d))return[M,d];const[k,r]=wM(y,M,d,P);return[Vh(k),r]};function wM(a,d,y,S="brackets"){const P=a==="get"&&!sw(y)&&Object.keys(y).length>0,M=/^[a-z][a-z0-9+.-]*:\/\//i.test(d.toString()),k=M||d.toString().startsWith("/")||d.toString()==="",r=!k&&!d.toString().startsWith("#")&&!d.toString().startsWith("?"),j=/^[.]{1,2}([/]|$)/.test(d.toString()),H=d.toString().includes("?")||P,W=d.toString().includes("#"),ee=new URL(d.toString(),typeof window>"u"?"http://localhost":window.location.toString());if(P){const le={ignoreQueryPrefix:!0,parseArrays:!1};ee.search=_P.stringify({..._P.parse(ee.search,le),...y},{encodeValuesOnly:!0,arrayFormat:S})}return[[M?`${ee.protocol}//${ee.host}`:"",k?ee.pathname:"",r?ee.pathname.substring(j?0:1):"",H?ee.search:"",W?ee.hash:""].join(""),P?{}:y]}function rv(a){return a=new URL(a.href),a.hash="",a}var yP=(a,d)=>{a.hash&&!d.hash&&rv(a).href===d.href&&(d.hash=a.hash)},ow=(a,d)=>rv(a).href===rv(d).href;function sv(a){return a!==null&&typeof a=="object"&&a!==void 0&&"url"in a&&"method"in a}var MV=class{constructor(){this.componentId={},this.listeners=[],this.isFirstPageLoad=!0,this.cleared=!1,this.pendingDeferredProps=null}init({initialPage:a,swapComponent:d,resolveComponent:y}){return this.page=a,this.swapComponent=d,this.resolveComponent=y,this}set(a,{replace:d=!1,preserveScroll:y=!1,preserveState:S=!1}={}){Object.keys(a.deferredProps||{}).length&&(this.pendingDeferredProps={deferredProps:a.deferredProps,component:a.component,url:a.url}),this.componentId={};const P=this.componentId;return a.clearHistory&&Ts.clear(),this.resolve(a.component).then(M=>{if(P!==this.componentId)return;a.rememberedState??(a.rememberedState={});const k=typeof window<"u"?window.location:new URL(a.url);return d=d||ow(Vh(a.url),k),new Promise(r=>{d?Ts.replaceState(a,()=>r(null)):Ts.pushState(a,()=>r(null))}).then(()=>{const r=!this.isTheSame(a);return this.page=a,this.cleared=!1,r&&this.fireEventsFor("newComponent"),this.isFirstPageLoad&&this.fireEventsFor("firstLoad"),this.isFirstPageLoad=!1,this.swap({component:M,page:a,preserveState:S}).then(()=>{y||yc.reset(),this.pendingDeferredProps&&this.pendingDeferredProps.component===a.component&&this.pendingDeferredProps.url===a.url&&Rd.fireInternalEvent("loadDeferredProps",this.pendingDeferredProps.deferredProps),this.pendingDeferredProps=null,d||y_(a)})})})}setQuietly(a,{preserveState:d=!1}={}){return this.resolve(a.component).then(y=>(this.page=a,this.cleared=!1,Ts.setCurrent(a),this.swap({component:y,page:a,preserveState:d})))}clear(){this.cleared=!0}isCleared(){return this.cleared}get(){return this.page}merge(a){this.page={...this.page,...a}}setUrlHash(a){this.page.url.includes(a)||(this.page.url+=a)}remember(a){this.page.rememberedState=a}swap({component:a,page:d,preserveState:y}){return this.swapComponent({component:a,page:d,preserveState:y})}resolve(a){return Promise.resolve(this.resolveComponent(a))}isTheSame(a){return this.page.component===a.component}on(a,d){return this.listeners.push({event:a,callback:d}),()=>{this.listeners=this.listeners.filter(y=>y.event!==a&&y.callback!==d)}}fireEventsFor(a){this.listeners.filter(d=>d.event===a).forEach(d=>d.callback())}},hr=new MV,TM=class{constructor(){this.items=[],this.processingPromise=null}add(a){return this.items.push(a),this.process()}process(){return this.processingPromise??(this.processingPromise=this.processNext().finally(()=>{this.processingPromise=null})),this.processingPromise}processNext(){const a=this.items.shift();return a?Promise.resolve(a()).then(()=>this.processNext()):Promise.resolve()}},o_=typeof window>"u",r_=new TM,vP=!o_&&/CriOS/.test(window.navigator.userAgent),RV=class{constructor(){this.rememberedState="rememberedState",this.scrollRegions="scrollRegions",this.preserveUrl=!1,this.current={},this.initialState=null}remember(a,d){this.replaceState({...hr.get(),rememberedState:{...hr.get()?.rememberedState??{},[d]:a}})}restore(a){if(!o_)return this.current[this.rememberedState]?this.current[this.rememberedState]?.[a]:this.initialState?.[this.rememberedState]?.[a]}pushState(a,d=null){if(!o_){if(this.preserveUrl){d&&d();return}this.current=a,r_.add(()=>this.getPageData(a).then(y=>{const S=()=>{this.doPushState({page:y},a.url),d&&d()};vP?setTimeout(S):S()}))}}getPageData(a){return new Promise(d=>a.encryptHistory?wV(a).then(d):d(a))}processQueue(){return r_.process()}decrypt(a=null){if(o_)return Promise.resolve(a??hr.get());const d=a??window.history.state?.page;return this.decryptPageData(d).then(y=>{if(!y)throw new Error("Unable to decrypt history");return this.initialState===null?this.initialState=y??void 0:this.current=y??{},y})}decryptPageData(a){return a instanceof ArrayBuffer?TV(a):Promise.resolve(a)}saveScrollPositions(a){r_.add(()=>Promise.resolve().then(()=>{window.history.state?.page&&this.doReplaceState({page:window.history.state.page,scrollRegions:a})}))}saveDocumentScrollPosition(a){r_.add(()=>Promise.resolve().then(()=>{window.history.state?.page&&this.doReplaceState({page:window.history.state.page,documentScrollPosition:a})}))}getScrollRegions(){return window.history.state?.scrollRegions||[]}getDocumentScrollPosition(){return window.history.state?.documentScrollPosition||{top:0,left:0}}replaceState(a,d=null){if(hr.merge(a),!o_){if(this.preserveUrl){d&&d();return}this.current=a,r_.add(()=>this.getPageData(a).then(y=>{const S=()=>{this.doReplaceState({page:y},a.url),d&&d()};vP?setTimeout(S):S()}))}}doReplaceState(a,d){window.history.replaceState({...a,scrollRegions:a.scrollRegions??window.history.state?.scrollRegions,documentScrollPosition:a.documentScrollPosition??window.history.state?.documentScrollPosition},"",d)}doPushState(a,d){window.history.pushState(a,"",d)}getState(a,d){return this.current?.[a]??d}deleteState(a){this.current[a]!==void 0&&(delete this.current[a],this.replaceState(this.current))}clearInitialState(a){this.initialState&&this.initialState[a]!==void 0&&delete this.initialState[a]}hasAnyState(){return!!this.getAllState()}clear(){Ja.remove(yp.key),Ja.remove(yp.iv)}setCurrent(a){this.current=a}isValidState(a){return!!a.page}getAllState(){return this.current}};typeof window<"u"&&window.history.scrollRestoration&&(window.history.scrollRestoration="manual");var Ts=new RV,OV=class{constructor(){this.internalListeners=[]}init(){typeof window<"u"&&(window.addEventListener("popstate",this.handlePopstateEvent.bind(this)),window.addEventListener("scroll",nw(yc.onWindowScroll.bind(yc),100),!0)),typeof document<"u"&&document.addEventListener("scroll",nw(yc.onScroll.bind(yc),100),!0)}onGlobalEvent(a,d){const y=(S=>{const P=d(S);S.cancelable&&!S.defaultPrevented&&P===!1&&S.preventDefault()});return this.registerListener(`inertia:${a}`,y)}on(a,d){return this.internalListeners.push({event:a,listener:d}),()=>{this.internalListeners=this.internalListeners.filter(y=>y.listener!==d)}}onMissingHistoryItem(){hr.clear(),this.fireInternalEvent("missingHistoryItem")}fireInternalEvent(a,...d){this.internalListeners.filter(y=>y.event===a).forEach(y=>y.listener(...d))}registerListener(a,d){return document.addEventListener(a,d),()=>document.removeEventListener(a,d)}handlePopstateEvent(a){const d=a.state||null;if(d===null){const y=Vh(hr.get().url);y.hash=window.location.hash,Ts.replaceState({...hr.get(),url:y.href}),yc.reset();return}if(!Ts.isValidState(d))return this.onMissingHistoryItem();Ts.decrypt(d.page).then(y=>{if(hr.get().version!==y.version){this.onMissingHistoryItem();return}ya.cancelAll(),hr.setQuietly(y,{preserveState:!1}).then(()=>{yc.restore(Ts.getScrollRegions()),y_(hr.get())})}).catch(()=>{this.onMissingHistoryItem()})}},Rd=new OV,LV=class{constructor(){this.type=this.resolveType()}resolveType(){return typeof window>"u"?"navigate":window.performance&&window.performance.getEntriesByType&&window.performance.getEntriesByType("navigation").length>0?window.performance.getEntriesByType("navigation")[0].type:"navigate"}get(){return this.type}isBackForward(){return this.type==="back_forward"}isReload(){return this.type==="reload"}},Ib=new LV,DV=class{static handle(){this.clearRememberedStateOnReload(),[this.handleBackForward,this.handleLocation,this.handleDefault].find(d=>d.bind(this)())}static clearRememberedStateOnReload(){Ib.isReload()&&(Ts.deleteState(Ts.rememberedState),Ts.clearInitialState(Ts.rememberedState))}static handleBackForward(){if(!Ib.isBackForward()||!Ts.hasAnyState())return!1;const a=Ts.getScrollRegions();return Ts.decrypt().then(d=>{hr.set(d,{preserveScroll:!0,preserveState:!0}).then(()=>{yc.restore(a),y_(hr.get())})}).catch(()=>{Rd.onMissingHistoryItem()}),!0}static handleLocation(){if(!Ja.exists(Ja.locationVisitKey))return!1;const a=Ja.get(Ja.locationVisitKey)||{};return Ja.remove(Ja.locationVisitKey),typeof window<"u"&&hr.setUrlHash(window.location.hash),Ts.decrypt(hr.get()).then(()=>{const d=Ts.getState(Ts.rememberedState,{}),y=Ts.getScrollRegions();hr.remember(d),hr.set(hr.get(),{preserveScroll:a.preserveScroll,preserveState:!0}).then(()=>{a.preserveScroll&&yc.restore(y),y_(hr.get())})}).catch(()=>{Rd.onMissingHistoryItem()}),!0}static handleDefault(){typeof window<"u"&&hr.setUrlHash(window.location.hash),hr.set(hr.get(),{preserveScroll:!0,preserveState:!0}).then(()=>{Ib.isReload()&&yc.restore(Ts.getScrollRegions()),y_(hr.get())})}},zV=class{constructor(a,d,y){this.id=null,this.throttle=!1,this.keepAlive=!1,this.cbCount=0,this.keepAlive=y.keepAlive??!1,this.cb=d,this.interval=a,(y.autoStart??!0)&&this.start()}stop(){this.id&&clearInterval(this.id)}start(){typeof window>"u"||(this.stop(),this.id=window.setInterval(()=>{(!this.throttle||this.cbCount%10===0)&&this.cb(),this.throttle&&this.cbCount++},this.interval))}isInBackground(a){this.throttle=this.keepAlive?!1:a,this.throttle&&(this.cbCount=0)}},kV=class{constructor(){this.polls=[],this.setupVisibilityListener()}add(a,d,y){const S=new zV(a,d,y);return this.polls.push(S),{stop:()=>S.stop(),start:()=>S.start()}}clear(){this.polls.forEach(a=>a.stop()),this.polls=[]}setupVisibilityListener(){typeof document>"u"||document.addEventListener("visibilitychange",()=>{this.polls.forEach(a=>a.isInBackground(document.hidden))},!1)}},FV=new kV,SM=(a,d,y)=>{if(a===d)return!0;for(const S in a)if(!y.includes(S)&&a[S]!==d[S]&&!BV(a[S],d[S]))return!1;return!0},BV=(a,d)=>{switch(typeof a){case"object":return SM(a,d,[]);case"function":return a.toString()===d.toString();default:return a===d}},NV={ms:1,s:1e3,m:1e3*60,h:1e3*60*60,d:1e3*60*60*24},xP=a=>{if(typeof a=="number")return a;for(const[d,y]of Object.entries(NV))if(a.endsWith(d))return parseFloat(a)*y;return parseInt(a)},UV=class{constructor(){this.cached=[],this.inFlightRequests=[],this.removalTimers=[],this.currentUseId=null}add(a,d,{cacheFor:y,cacheTags:S}){if(this.findInFlight(a))return Promise.resolve();const M=this.findCached(a);if(!a.fresh&&M&&M.staleTimestamp>Date.now())return Promise.resolve();const[k,r]=this.extractStaleValues(y),j=new Promise((H,W)=>{d({...a,onCancel:()=>{this.remove(a),a.onCancel(),W()},onError:ee=>{this.remove(a),a.onError(ee),W()},onPrefetching(ee){a.onPrefetching(ee)},onPrefetched(ee,le){a.onPrefetched(ee,le)},onPrefetchResponse(ee){H(ee)},onPrefetchError(ee){Uu.removeFromInFlight(a),W(ee)}})}).then(H=>(this.remove(a),this.cached.push({params:{...a},staleTimestamp:Date.now()+k,response:j,singleUse:r===0,timestamp:Date.now(),inFlight:!1,tags:Array.isArray(S)?S:[S]}),this.scheduleForRemoval(a,r),this.removeFromInFlight(a),H.handlePrefetch(),H));return this.inFlightRequests.push({params:{...a},response:j,staleTimestamp:null,inFlight:!0}),j}removeAll(){this.cached=[],this.removalTimers.forEach(a=>{clearTimeout(a.timer)}),this.removalTimers=[]}removeByTags(a){this.cached=this.cached.filter(d=>!d.tags.some(y=>a.includes(y)))}remove(a){this.cached=this.cached.filter(d=>!this.paramsAreEqual(d.params,a)),this.clearTimer(a)}removeFromInFlight(a){this.inFlightRequests=this.inFlightRequests.filter(d=>!this.paramsAreEqual(d.params,a))}extractStaleValues(a){const[d,y]=this.cacheForToStaleAndExpires(a);return[xP(d),xP(y)]}cacheForToStaleAndExpires(a){if(!Array.isArray(a))return[a,a];switch(a.length){case 0:return[0,0];case 1:return[a[0],a[0]];default:return[a[0],a[1]]}}clearTimer(a){const d=this.removalTimers.find(y=>this.paramsAreEqual(y.params,a));d&&(clearTimeout(d.timer),this.removalTimers=this.removalTimers.filter(y=>y!==d))}scheduleForRemoval(a,d){if(!(typeof window>"u")&&(this.clearTimer(a),d>0)){const y=window.setTimeout(()=>this.remove(a),d);this.removalTimers.push({params:a,timer:y})}}get(a){return this.findCached(a)||this.findInFlight(a)}use(a,d){const y=`${d.url.pathname}-${Date.now()}-${Math.random().toString(36).substring(7)}`;return this.currentUseId=y,a.response.then(S=>{if(this.currentUseId===y)return S.mergeParams({...d,onPrefetched:()=>{}}),this.removeSingleUseItems(d),S.handle()})}removeSingleUseItems(a){this.cached=this.cached.filter(d=>this.paramsAreEqual(d.params,a)?!d.singleUse:!0)}findCached(a){return this.cached.find(d=>this.paramsAreEqual(d.params,a))||null}findInFlight(a){return this.inFlightRequests.find(d=>this.paramsAreEqual(d.params,a))||null}withoutPurposePrefetchHeader(a){const d=al(a);return d.headers.Purpose==="prefetch"&&delete d.headers.Purpose,d}paramsAreEqual(a,d){return SM(this.withoutPurposePrefetchHeader(a),this.withoutPurposePrefetchHeader(d),["showProgress","replace","prefetch","onBefore","onBeforeUpdate","onStart","onProgress","onFinish","onCancel","onSuccess","onError","onPrefetched","onCancelToken","onPrefetching","async"])}},Uu=new UV,VV=class EM{constructor(d){if(this.callbacks=[],!d.prefetch)this.params=d;else{const y={onBefore:this.wrapCallback(d,"onBefore"),onBeforeUpdate:this.wrapCallback(d,"onBeforeUpdate"),onStart:this.wrapCallback(d,"onStart"),onProgress:this.wrapCallback(d,"onProgress"),onFinish:this.wrapCallback(d,"onFinish"),onCancel:this.wrapCallback(d,"onCancel"),onSuccess:this.wrapCallback(d,"onSuccess"),onError:this.wrapCallback(d,"onError"),onCancelToken:this.wrapCallback(d,"onCancelToken"),onPrefetched:this.wrapCallback(d,"onPrefetched"),onPrefetching:this.wrapCallback(d,"onPrefetching")};this.params={...d,...y,onPrefetchResponse:d.onPrefetchResponse||(()=>{}),onPrefetchError:d.onPrefetchError||(()=>{})}}}static create(d){return new EM(d)}data(){return this.params.method==="get"?null:this.params.data}queryParams(){return this.params.method==="get"?this.params.data:{}}isPartial(){return this.params.only.length>0||this.params.except.length>0||this.params.reset.length>0}onCancelToken(d){this.params.onCancelToken({cancel:d})}markAsFinished(){this.params.completed=!0,this.params.cancelled=!1,this.params.interrupted=!1}markAsCancelled({cancelled:d=!0,interrupted:y=!1}){this.params.onCancel(),this.params.completed=!1,this.params.cancelled=d,this.params.interrupted=y}wasCancelledAtAll(){return this.params.cancelled||this.params.interrupted}onFinish(){this.params.onFinish(this.params)}onStart(){this.params.onStart(this.params)}onPrefetching(){this.params.onPrefetching(this.params)}onPrefetchResponse(d){this.params.onPrefetchResponse&&this.params.onPrefetchResponse(d)}onPrefetchError(d){this.params.onPrefetchError&&this.params.onPrefetchError(d)}all(){return this.params}headers(){const d={...this.params.headers};this.isPartial()&&(d["X-Inertia-Partial-Component"]=hr.get().component);const y=this.params.only.concat(this.params.reset);return y.length>0&&(d["X-Inertia-Partial-Data"]=y.join(",")),this.params.except.length>0&&(d["X-Inertia-Partial-Except"]=this.params.except.join(",")),this.params.reset.length>0&&(d["X-Inertia-Reset"]=this.params.reset.join(",")),this.params.errorBag&&this.params.errorBag.length>0&&(d["X-Inertia-Error-Bag"]=this.params.errorBag),d}setPreserveOptions(d){this.params.preserveScroll=this.resolvePreserveOption(this.params.preserveScroll,d),this.params.preserveState=this.resolvePreserveOption(this.params.preserveState,d)}runCallbacks(){this.callbacks.forEach(({name:d,args:y})=>{this.params[d](...y)})}merge(d){this.params={...this.params,...d}}wrapCallback(d,y){return(...S)=>{this.recordCallback(y,S),d[y](...S)}}recordCallback(d,y){this.callbacks.push({name:d,args:y})}resolvePreserveOption(d,y){return typeof d=="function"?d(y):d==="errors"?Object.keys(y.props.errors||{}).length>0:d}},jV={modal:null,listener:null,show(a){typeof a=="object"&&(a=`All Inertia requests must receive a valid Inertia response, however a plain JSON response was received.<hr>${JSON.stringify(a)}`);const d=document.createElement("html");d.innerHTML=a,d.querySelectorAll("a").forEach(S=>S.setAttribute("target","_top")),this.modal=document.createElement("div"),this.modal.style.position="fixed",this.modal.style.width="100vw",this.modal.style.height="100vh",this.modal.style.padding="50px",this.modal.style.boxSizing="border-box",this.modal.style.backgroundColor="rgba(0, 0, 0, .6)",this.modal.style.zIndex=2e5,this.modal.addEventListener("click",()=>this.hide());const y=document.createElement("iframe");if(y.style.backgroundColor="white",y.style.borderRadius="5px",y.style.width="100%",y.style.height="100%",this.modal.appendChild(y),document.body.prepend(this.modal),document.body.style.overflow="hidden",!y.contentWindow)throw new Error("iframe not yet ready.");y.contentWindow.document.open(),y.contentWindow.document.write(d.outerHTML),y.contentWindow.document.close(),this.listener=this.hideOnEscape.bind(this),document.addEventListener("keydown",this.listener)},hide(){this.modal.outerHTML="",this.modal=null,document.body.style.overflow="visible",document.removeEventListener("keydown",this.listener)},hideOnEscape(a){a.keyCode===27&&this.hide()}},$V=new TM,bP=class AM{constructor(d,y,S){this.requestParams=d,this.response=y,this.originatingPage=S,this.wasPrefetched=!1}static create(d,y,S){return new AM(d,y,S)}async handlePrefetch(){ow(this.requestParams.all().url,window.location)&&this.handle()}async handle(){return $V.add(()=>this.process())}async process(){if(this.requestParams.all().prefetch)return this.wasPrefetched=!0,this.requestParams.all().prefetch=!1,this.requestParams.all().onPrefetched(this.response,this.requestParams.all()),xV(this.response,this.requestParams.all()),Promise.resolve();if(this.requestParams.runCallbacks(),!this.isInertiaResponse())return this.handleNonInertiaResponse();await Ts.processQueue(),Ts.preserveUrl=this.requestParams.all().preserveUrl,await this.setPage();const d=hr.get().props.errors||{};if(Object.keys(d).length>0){const y=this.getScopedErrors(d);return dV(y),this.requestParams.all().onError(y)}ya.flushByCacheTags(this.requestParams.all().invalidateCacheTags||[]),this.wasPrefetched||ya.flush(hr.get().url),vV(hr.get()),await this.requestParams.all().onSuccess(hr.get()),Ts.preserveUrl=!1}mergeParams(d){this.requestParams.merge(d)}async handleNonInertiaResponse(){if(this.isLocationVisit()){const y=Vh(this.getHeader("x-inertia-location"));return yP(this.requestParams.all().url,y),this.locationVisit(y)}const d={...this.response,data:this.getDataFromResponse(this.response.data)};if(mV(d))return jV.show(d.data)}isInertiaResponse(){return this.hasHeader("x-inertia")}hasStatus(d){return this.response.status===d}getHeader(d){return this.response.headers[d]}hasHeader(d){return this.getHeader(d)!==void 0}isLocationVisit(){return this.hasStatus(409)&&this.hasHeader("x-inertia-location")}locationVisit(d){try{if(Ja.set(Ja.locationVisitKey,{preserveScroll:this.requestParams.all().preserveScroll===!0}),typeof window>"u")return;ow(window.location,d)?window.location.reload():window.location.href=d.href}catch{return!1}}async setPage(){const d=this.getDataFromResponse(this.response.data);return this.shouldSetPage(d)?(this.mergeProps(d),await this.setRememberedState(d),this.requestParams.setPreserveOptions(d),d.url=Ts.preserveUrl?hr.get().url:this.pageUrl(d),this.requestParams.all().onBeforeUpdate(d),_V(d),hr.set(d,{replace:this.requestParams.all().replace,preserveScroll:this.requestParams.all().preserveScroll,preserveState:this.requestParams.all().preserveState})):Promise.resolve()}getDataFromResponse(d){if(typeof d!="string")return d;try{return JSON.parse(d)}catch{return d}}shouldSetPage(d){if(!this.requestParams.all().async||this.originatingPage.component!==d.component)return!0;if(this.originatingPage.component!==hr.get().component)return!1;const y=Vh(this.originatingPage.url),S=Vh(hr.get().url);return y.origin===S.origin&&y.pathname===S.pathname}pageUrl(d){const y=Vh(d.url);return yP(this.requestParams.all().url,y),y.pathname+y.search+y.hash}mergeProps(d){if(!this.requestParams.isPartial()||d.component!==hr.get().component)return;const y=d.mergeProps||[],S=d.prependProps||[],P=d.deepMergeProps||[],M=d.matchPropsOn||[],k=(r,j)=>{const H=dp(hr.get().props,r),W=dp(d.props,r);if(Array.isArray(W)){const ee=this.mergeOrMatchItems(H||[],W,r,M,j);Md(d.props,r,ee)}else if(typeof W=="object"&&W!==null){const ee={...H||{},...W};Md(d.props,r,ee)}};y.forEach(r=>k(r,!0)),S.forEach(r=>k(r,!1)),P.forEach(r=>{const j=hr.get().props[r],H=d.props[r],W=(ee,le,pe)=>Array.isArray(le)?this.mergeOrMatchItems(ee,le,pe,M):typeof le=="object"&&le!==null?Object.keys(le).reduce((se,he)=>(se[he]=W(ee?ee[he]:void 0,le[he],`${pe}.${he}`),se),{...ee}):le;d.props[r]=W(j,H,r)}),d.props={...hr.get().props,...d.props},hr.get().scrollProps&&(d.scrollProps={...hr.get().scrollProps||{},...d.scrollProps||{}})}mergeOrMatchItems(d,y,S,P,M=!0){const k=Array.isArray(d)?d:[],r=P.find(W=>W.split(".").slice(0,-1).join(".")===S);if(!r)return M?[...k,...y]:[...y,...k];const j=r.split(".").pop()||"",H=new Map;return y.forEach(W=>{this.hasUniqueProperty(W,j)&&H.set(W[j],W)}),M?this.appendWithMatching(k,y,H,j):this.prependWithMatching(k,y,H,j)}appendWithMatching(d,y,S,P){const M=d.map(r=>this.hasUniqueProperty(r,P)&&S.has(r[P])?S.get(r[P]):r),k=y.filter(r=>this.hasUniqueProperty(r,P)?!d.some(j=>this.hasUniqueProperty(j,P)&&j[P]===r[P]):!0);return[...M,...k]}prependWithMatching(d,y,S,P){const M=d.filter(k=>this.hasUniqueProperty(k,P)?!S.has(k[P]):!0);return[...y,...M]}hasUniqueProperty(d,y){return d&&typeof d=="object"&&y in d}async setRememberedState(d){const y=await Ts.getState(Ts.rememberedState,{});this.requestParams.all().preserveState&&y&&d.component===hr.get().component&&(d.rememberedState=y)}getScopedErrors(d){return this.requestParams.all().errorBag?d[this.requestParams.all().errorBag||""]||{}:d}},wP=class IM{constructor(d,y){this.page=y,this.requestHasFinished=!1,this.requestParams=VV.create(d),this.cancelToken=new AbortController}static create(d,y){return new IM(d,y)}async send(){this.requestParams.onCancelToken(()=>this.cancel({cancelled:!0})),yV(this.requestParams.all()),this.requestParams.onStart(),this.requestParams.all().prefetch&&(this.requestParams.onPrefetching(),bV(this.requestParams.all()));const d=this.requestParams.all().prefetch;return Io({method:this.requestParams.all().method,url:rv(this.requestParams.all().url).href,data:this.requestParams.data(),params:this.requestParams.queryParams(),signal:this.cancelToken.signal,headers:this.getHeaders(),onUploadProgress:this.onProgress.bind(this),responseType:"text"}).then(y=>(this.response=bP.create(this.requestParams,y,this.page),this.response.handle())).catch(y=>y?.response?(this.response=bP.create(this.requestParams,y.response,this.page),this.response.handle()):Promise.reject(y)).catch(y=>{if(!Io.isCancel(y)&&fV(y))return d&&this.requestParams.onPrefetchError(y),Promise.reject(y)}).finally(()=>{this.finish(),d&&this.response&&this.requestParams.onPrefetchResponse(this.response)})}finish(){this.requestParams.wasCancelledAtAll()||(this.requestParams.markAsFinished(),this.fireFinishEvents())}fireFinishEvents(){this.requestHasFinished||(this.requestHasFinished=!0,pV(this.requestParams.all()),this.requestParams.onFinish())}cancel({cancelled:d=!1,interrupted:y=!1}){this.requestHasFinished||(this.cancelToken.abort(),this.requestParams.markAsCancelled({cancelled:d,interrupted:y}),this.fireFinishEvents())}onProgress(d){this.requestParams.data()instanceof FormData&&(d.percentage=d.progress?Math.round(d.progress*100):0,gV(d),this.requestParams.all().onProgress(d))}getHeaders(){const d={...this.requestParams.headers(),Accept:"text/html, application/xhtml+xml","X-Requested-With":"XMLHttpRequest","X-Inertia":!0};return hr.get().version&&(d["X-Inertia-Version"]=hr.get().version),d}},TP=class{constructor({maxConcurrent:a,interruptible:d}){this.requests=[],this.maxConcurrent=a,this.interruptible=d}send(a){this.requests.push(a),a.send().then(()=>{this.requests=this.requests.filter(d=>d!==a)})}interruptInFlight(){this.cancel({interrupted:!0},!1)}cancelInFlight(){this.cancel({cancelled:!0},!0)}cancel({cancelled:a=!1,interrupted:d=!1}={},y){if(!this.shouldCancel(y))return;this.requests.shift()?.cancel({interrupted:d,cancelled:a})}shouldCancel(a){return a?!0:this.interruptible&&this.requests.length>=this.maxConcurrent}},qV=class{constructor(){this.syncRequestStream=new TP({maxConcurrent:1,interruptible:!0}),this.asyncRequestStream=new TP({maxConcurrent:1/0,interruptible:!1})}init({initialPage:a,resolveComponent:d,swapComponent:y}){hr.init({initialPage:a,resolveComponent:d,swapComponent:y}),DV.handle(),Rd.init(),Rd.on("missingHistoryItem",()=>{typeof window<"u"&&this.visit(window.location.href,{preserveState:!0,preserveScroll:!0,replace:!0})}),Rd.on("loadDeferredProps",S=>{this.loadDeferredProps(S)})}get(a,d={},y={}){return this.visit(a,{...y,method:"get",data:d})}post(a,d={},y={}){return this.visit(a,{preserveState:!0,...y,method:"post",data:d})}put(a,d={},y={}){return this.visit(a,{preserveState:!0,...y,method:"put",data:d})}patch(a,d={},y={}){return this.visit(a,{preserveState:!0,...y,method:"patch",data:d})}delete(a,d={}){return this.visit(a,{preserveState:!0,...d,method:"delete"})}reload(a={}){if(!(typeof window>"u"))return this.visit(window.location.href,{...a,preserveScroll:!0,preserveState:!0,async:!0,headers:{...a.headers||{},"Cache-Control":"no-cache"}})}remember(a,d="default"){Ts.remember(a,d)}restore(a="default"){return Ts.restore(a)}on(a,d){return typeof window>"u"?()=>{}:Rd.onGlobalEvent(a,d)}cancel(){this.syncRequestStream.cancelInFlight()}cancelAll(){this.asyncRequestStream.cancelInFlight(),this.syncRequestStream.cancelInFlight()}poll(a,d={},y={}){return FV.add(a,()=>this.reload(d),{autoStart:y.autoStart??!0,keepAlive:y.keepAlive??!1})}visit(a,d={}){const y=this.getPendingVisit(a,{...d,showProgress:d.showProgress??!d.async}),S=this.getVisitEvents(d);if(S.onBefore(y)===!1||!gP(y))return;const P=y.async?this.asyncRequestStream:this.syncRequestStream;P.interruptInFlight(),!hr.isCleared()&&!y.preserveUrl&&yc.save();const M={...y,...S},k=Uu.get(M);k?(cl.reveal(k.inFlight),Uu.use(k,M)):(cl.reveal(!0),P.send(wP.create(M,hr.get())))}getCached(a,d={}){return Uu.findCached(this.getPrefetchParams(a,d))}flush(a,d={}){Uu.remove(this.getPrefetchParams(a,d))}flushAll(){Uu.removeAll()}flushByCacheTags(a){Uu.removeByTags(Array.isArray(a)?a:[a])}getPrefetching(a,d={}){return Uu.findInFlight(this.getPrefetchParams(a,d))}prefetch(a,d={},y={}){if((d.method??(sv(a)?a.method:"get"))!=="get")throw new Error("Prefetch requests must use the GET method");const P=this.getPendingVisit(a,{...d,async:!0,showProgress:!1,prefetch:!0}),M=P.url.origin+P.url.pathname+P.url.search,k=window.location.origin+window.location.pathname+window.location.search;if(M===k)return;const r=this.getVisitEvents(d);if(r.onBefore(P)===!1||!gP(P))return;cl.hide(),this.asyncRequestStream.interruptInFlight();const j={...P,...r};new Promise(W=>{const ee=()=>{hr.get()?W():setTimeout(ee,50)};ee()}).then(()=>{Uu.add(j,W=>{this.asyncRequestStream.send(wP.create(W,hr.get()))},{cacheFor:3e4,cacheTags:[],...y})})}clearHistory(){Ts.clear()}decryptHistory(){return Ts.decrypt()}resolveComponent(a){return hr.resolve(a)}replace(a){this.clientVisit(a,{replace:!0})}replaceProp(a,d,y){this.replace({preserveScroll:!0,preserveState:!0,props(S){const P=typeof d=="function"?d(dp(S,a),S):d;return Md(al(S),a,P)},...y||{}})}appendToProp(a,d,y){this.replaceProp(a,(S,P)=>{const M=typeof d=="function"?d(S,P):d;return Array.isArray(S)||(S=S!==void 0?[S]:[]),[...S,M]},y)}prependToProp(a,d,y){this.replaceProp(a,(S,P)=>{const M=typeof d=="function"?d(S,P):d;return Array.isArray(S)||(S=S!==void 0?[S]:[]),[M,...S]},y)}push(a){this.clientVisit(a)}clientVisit(a,{replace:d=!1}={}){const y=hr.get(),S=typeof a.props=="function"?a.props(y.props):a.props??y.props,{onError:P,onFinish:M,onSuccess:k,...r}=a;hr.set({...y,...r,props:S},{replace:d,preserveScroll:a.preserveScroll,preserveState:a.preserveState}).then(()=>{const j=hr.get().props.errors||{};if(Object.keys(j).length===0)return k?.(hr.get());const H=a.errorBag?j[a.errorBag||""]||{}:j;return P?.(H)}).finally(()=>M?.(a))}getPrefetchParams(a,d){return{...this.getPendingVisit(a,{...d,async:!0,showProgress:!1,prefetch:!0}),...this.getVisitEvents(d)}}getPendingVisit(a,d,y={}){if(sv(a)){const r=a;a=r.url,d.method=d.method??r.method}const S={method:"get",data:{},replace:!1,preserveScroll:!1,preserveState:!1,only:[],except:[],headers:{},errorBag:"",forceFormData:!1,queryStringArrayFormat:"brackets",async:!1,showProgress:!0,fresh:!1,reset:[],preserveUrl:!1,prefetch:!1,invalidateCacheTags:[],...d},[P,M]=CV(a,S.data,S.method,S.forceFormData,S.queryStringArrayFormat),k={cancelled:!1,completed:!1,interrupted:!1,...S,...y,url:P,data:M};return k.prefetch&&(k.headers.Purpose="prefetch"),k}getVisitEvents(a){return{onCancelToken:a.onCancelToken||(()=>{}),onBefore:a.onBefore||(()=>{}),onBeforeUpdate:a.onBeforeUpdate||(()=>{}),onStart:a.onStart||(()=>{}),onProgress:a.onProgress||(()=>{}),onFinish:a.onFinish||(()=>{}),onCancel:a.onCancel||(()=>{}),onSuccess:a.onSuccess||(()=>{}),onError:a.onError||(()=>{}),onPrefetched:a.onPrefetched||(()=>{}),onPrefetching:a.onPrefetching||(()=>{})}}loadDeferredProps(a){a&&Object.entries(a).forEach(([d,y])=>{this.reload({only:y})})}},GV={buildDOMElement(a){const d=document.createElement("template");d.innerHTML=a;const y=d.content.firstChild;if(!a.startsWith("<script "))return y;const S=document.createElement("script");return S.innerHTML=y.innerHTML,y.getAttributeNames().forEach(P=>{S.setAttribute(P,y.getAttribute(P)||"")}),S},isInertiaManagedElement(a){return a.nodeType===Node.ELEMENT_NODE&&a.getAttribute("inertia")!==null},findMatchingElementIndex(a,d){const y=a.getAttribute("inertia");return y!==null?d.findIndex(S=>S.getAttribute("inertia")===y):-1},update:nw(function(a){const d=a.map(S=>this.buildDOMElement(S));Array.from(document.head.childNodes).filter(S=>this.isInertiaManagedElement(S)).forEach(S=>{const P=this.findMatchingElementIndex(S,d);if(P===-1){S?.parentNode?.removeChild(S);return}const M=d.splice(P,1)[0];M&&!S.isEqualNode(M)&&S?.parentNode?.replaceChild(M,S)}),d.forEach(S=>document.head.appendChild(S))},1)};function HV(a,d,y){const S={};let P=0;function M(){const ee=P+=1;return S[ee]=[],ee.toString()}function k(ee){ee===null||Object.keys(S).indexOf(ee)===-1||(delete S[ee],W())}function r(ee){Object.keys(S).indexOf(ee)===-1&&(S[ee]=[])}function j(ee,le=[]){ee!==null&&Object.keys(S).indexOf(ee)>-1&&(S[ee]=le),W()}function H(){const ee=d(""),le={...ee?{title:`<title inertia="">${ee}</title>`}:{}},pe=Object.values(S).reduce((se,he)=>se.concat(he),[]).reduce((se,he)=>{if(he.indexOf("<")===-1)return se;if(he.indexOf("<title ")===0){const Se=he.match(/(<title [^>]+>)(.*?)(<\/title>)/);return se.title=Se?`${Se[1]}${d(Se[2])}${Se[3]}`:he,se}const Te=he.match(/ inertia="[^"]+"/);return Te?se[Te[0]]=he:se[Object.keys(se).length]=he,se},le);return Object.values(pe)}function W(){a?y(H()):GV.update(H())}return W(),{forceUpdate:W,createProvider:function(){const ee=M();return{reconnect:()=>r(ee),update:le=>j(ee,le),disconnect:()=>k(ee)}}}}function Ey(a){const d=a.currentTarget.tagName.toLowerCase()==="a";return!(a.target&&(a?.target).isContentEditable||a.defaultPrevented||d&&a.altKey||d&&a.ctrlKey||d&&a.metaKey||d&&a.shiftKey||d&&"button"in a&&a.button!==0)}function SP(a){const d=a.currentTarget.tagName.toLowerCase()==="button";return a.key==="Enter"||d&&a.key===" "}var ia="nprogress",Wl,ga={minimum:.08,easing:"linear",positionUsing:"translate3d",speed:200,trickle:!0,trickleSpeed:200,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",color:"#29d",includeCSS:!0,template:['<div class="bar" role="bar">','<div class="peg"></div>',"</div>",'<div class="spinner" role="spinner">','<div class="spinner-icon"></div>',"</div>"].join("")},Zh=null,ZV=a=>{Object.assign(ga,a),ga.includeCSS&&QV(ga.color),Wl=document.createElement("div"),Wl.id=ia,Wl.innerHTML=ga.template},Cv=a=>{const d=PM();a=LM(a,ga.minimum,1),Zh=a===1?null:a;const y=XV(!d),S=y.querySelector(ga.barSelector),P=ga.speed,M=ga.easing;y.offsetWidth,JV(k=>{const r=ga.positionUsing==="translate3d"?{transition:`all ${P}ms ${M}`,transform:`translate3d(${ky(a)}%,0,0)`}:ga.positionUsing==="translate"?{transition:`all ${P}ms ${M}`,transform:`translate(${ky(a)}%,0)`}:{marginLeft:`${ky(a)}%`};for(const j in r)S.style[j]=r[j];if(a!==1)return setTimeout(k,P);y.style.transition="none",y.style.opacity="1",y.offsetWidth,setTimeout(()=>{y.style.transition=`all ${P}ms linear`,y.style.opacity="0",setTimeout(()=>{OM(),y.style.transition="",y.style.opacity="",k()},P)},P)})},PM=()=>typeof Zh=="number",CM=()=>{Zh||Cv(0);const a=function(){setTimeout(function(){Zh&&(MM(),a())},ga.trickleSpeed)};ga.trickle&&a()},WV=a=>{!a&&!Zh||(MM(.3+.5*Math.random()),Cv(1))},MM=a=>{const d=Zh;if(d===null)return CM();if(!(d>1))return a=typeof a=="number"?a:(()=>{const y={.1:[0,.2],.04:[.2,.5],.02:[.5,.8],.005:[.8,.99]};for(const S in y)if(d>=y[S][0]&&d<y[S][1])return parseFloat(S);return 0})(),Cv(LM(d+a,0,.994))},XV=a=>{if(KV())return document.getElementById(ia);document.documentElement.classList.add(`${ia}-busy`);const d=Wl.querySelector(ga.barSelector),y=a?"-100":ky(Zh||0),S=RM();return d.style.transition="all 0 linear",d.style.transform=`translate3d(${y}%,0,0)`,ga.showSpinner||Wl.querySelector(ga.spinnerSelector)?.remove(),S!==document.body&&S.classList.add(`${ia}-custom-parent`),S.appendChild(Wl),Wl},RM=()=>YV(ga.parent)?ga.parent:document.querySelector(ga.parent),OM=()=>{document.documentElement.classList.remove(`${ia}-busy`),RM().classList.remove(`${ia}-custom-parent`),Wl?.remove()},KV=()=>document.getElementById(ia)!==null,YV=a=>typeof HTMLElement=="object"?a instanceof HTMLElement:a&&typeof a=="object"&&a.nodeType===1&&typeof a.nodeName=="string";function LM(a,d,y){return a<d?d:a>y?y:a}var ky=a=>(-1+a)*100,JV=(()=>{const a=[],d=()=>{const y=a.shift();y&&y(d)};return y=>{a.push(y),a.length===1&&d()}})(),QV=a=>{const d=document.createElement("style");d.textContent=`
    #${ia} {
      pointer-events: none;
    }

    #${ia} .bar {
      background: ${a};

      position: fixed;
      z-index: 1031;
      top: 0;
      left: 0;

      width: 100%;
      height: 2px;
    }

    #${ia} .peg {
      display: block;
      position: absolute;
      right: 0px;
      width: 100px;
      height: 100%;
      box-shadow: 0 0 10px ${a}, 0 0 5px ${a};
      opacity: 1.0;

      transform: rotate(3deg) translate(0px, -4px);
    }

    #${ia} .spinner {
      display: block;
      position: fixed;
      z-index: 1031;
      top: 15px;
      right: 15px;
    }

    #${ia} .spinner-icon {
      width: 18px;
      height: 18px;
      box-sizing: border-box;

      border: solid 2px transparent;
      border-top-color: ${a};
      border-left-color: ${a};
      border-radius: 50%;

      animation: ${ia}-spinner 400ms linear infinite;
    }

    .${ia}-custom-parent {
      overflow: hidden;
      position: relative;
    }

    .${ia}-custom-parent #${ia} .spinner,
    .${ia}-custom-parent #${ia} .bar {
      position: absolute;
    }

    @keyframes ${ia}-spinner {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `,document.head.appendChild(d)},ej=()=>{Wl&&(Wl.style.display="")},tj=()=>{Wl&&(Wl.style.display="none")},_c={configure:ZV,isStarted:PM,done:WV,set:Cv,remove:OM,start:CM,status:Zh,show:ej,hide:tj},ij=class{constructor(){this.hideCount=0}start(){_c.start()}reveal(a=!1){this.hideCount=Math.max(0,this.hideCount-1),(a||this.hideCount===0)&&_c.show()}hide(){this.hideCount++,_c.hide()}set(a){_c.set(Math.max(0,Math.min(1,a)))}finish(){_c.done()}reset(){_c.set(0)}remove(){_c.done(),_c.remove()}isStarted(){return _c.isStarted()}getStatus(){return _c.status}},cl=new ij;cl.reveal;cl.hide;function nj(a){document.addEventListener("inertia:start",d=>rj(d,a)),document.addEventListener("inertia:progress",sj)}function rj(a,d){a.detail.visit.showProgress||cl.hide();const y=setTimeout(()=>cl.start(),d);document.addEventListener("inertia:finish",S=>oj(S,y),{once:!0})}function sj(a){cl.isStarted()&&a.detail.progress?.percentage&&cl.set(Math.max(cl.getStatus(),a.detail.progress.percentage/100*.9))}function oj(a,d){clearTimeout(d),cl.isStarted()&&(a.detail.visit.completed?cl.finish():a.detail.visit.interrupted?cl.reset():a.detail.visit.cancelled&&cl.remove())}function aj({delay:a=250,color:d="#29d",includeCSS:y=!0,showSpinner:S=!1}={}){nj(a),_c.configure({showSpinner:S,includeCSS:y,color:d})}var ya=new qV;/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */var lj={created(){if(!this.$options.remember)return;Array.isArray(this.$options.remember)&&(this.$options.remember={data:this.$options.remember}),typeof this.$options.remember=="string"&&(this.$options.remember={data:[this.$options.remember]}),typeof this.$options.remember.data=="string"&&(this.$options.remember={data:[this.$options.remember.data]});const a=this.$options.remember.key instanceof Function?this.$options.remember.key.call(this):this.$options.remember.key,d=ya.restore(a),y=this.$options.remember.data.filter(P=>!(this[P]!==null&&typeof this[P]=="object"&&this[P].__rememberable===!1)),S=P=>this[P]!==null&&typeof this[P]=="object"&&typeof this[P].__remember=="function"&&typeof this[P].__restore=="function";y.forEach(P=>{this[P]!==void 0&&d!==void 0&&d[P]!==void 0&&(S(P)?this[P].__restore(d[P]):this[P]=d[P]),this.$watch(P,()=>{ya.remember(y.reduce((M,k)=>({...M,[k]:al(S(k)?this[k].__remember():this[k])}),{}),a)},{immediate:!0,deep:!0})})}},cj=lj;function uj(a,d){const y=typeof a=="string"?a:null,S=(typeof a=="string"?d:a)??{},P=y?ya.restore(y):null;let M=al(typeof S=="function"?S():S),k=null,r=null,j=ee=>ee,H=!1;const W=B_({...P?P.data:al(M),isDirty:!1,errors:P?P.errors:{},hasErrors:!1,processing:!1,progress:null,wasSuccessful:!1,recentlySuccessful:!1,data(){return Object.keys(M).reduce((ee,le)=>Md(ee,le,dp(this,le)),{})},transform(ee){return j=ee,this},defaults(ee,le){if(typeof S=="function")throw new Error("You cannot call `defaults()` when using a function to define your form data.");return H=!0,typeof ee>"u"?(M=al(this.data()),this.isDirty=!1):M=typeof ee=="string"?Md(al(M),ee,le):Object.assign({},al(M),ee),this},reset(...ee){const le=al(typeof S=="function"?S():M),pe=al(le);return ee.length===0?(M=pe,Object.assign(this,le)):ee.filter(se=>MU(pe,se)).forEach(se=>{Md(M,se,dp(pe,se)),Md(this,se,dp(le,se))}),this},setError(ee,le){return Object.assign(this.errors,typeof ee=="string"?{[ee]:le}:ee),this.hasErrors=Object.keys(this.errors).length>0,this},clearErrors(...ee){return this.errors=Object.keys(this.errors).reduce((le,pe)=>({...le,...ee.length>0&&!ee.includes(pe)?{[pe]:this.errors[pe]}:{}}),{}),this.hasErrors=Object.keys(this.errors).length>0,this},resetAndClearErrors(...ee){return this.reset(...ee),this.clearErrors(...ee),this},submit(...ee){const le=ee[0]!==null&&typeof ee[0]=="object",pe=le?ee[0].method:ee[0],se=le?ee[0].url:ee[1],he=(le?ee[1]:ee[2])??{};H=!1;const Te=j(this.data()),Se={...he,onCancelToken:fe=>{if(k=fe,he.onCancelToken)return he.onCancelToken(fe)},onBefore:fe=>{if(this.wasSuccessful=!1,this.recentlySuccessful=!1,clearTimeout(r),he.onBefore)return he.onBefore(fe)},onStart:fe=>{if(this.processing=!0,he.onStart)return he.onStart(fe)},onProgress:fe=>{if(this.progress=fe,he.onProgress)return he.onProgress(fe)},onSuccess:async fe=>{this.processing=!1,this.progress=null,this.clearErrors(),this.wasSuccessful=!0,this.recentlySuccessful=!0,r=setTimeout(()=>this.recentlySuccessful=!1,2e3);const oe=he.onSuccess?await he.onSuccess(fe):null;return H||(M=al(this.data()),this.isDirty=!1),oe},onError:fe=>{if(this.processing=!1,this.progress=null,this.clearErrors().setError(fe),he.onError)return he.onError(fe)},onCancel:()=>{if(this.processing=!1,this.progress=null,he.onCancel)return he.onCancel()},onFinish:fe=>{if(this.processing=!1,this.progress=null,k=null,he.onFinish)return he.onFinish(fe)}};pe==="delete"?ya.delete(se,{...Se,data:Te}):ya[pe](se,Te,Se)},get(ee,le){this.submit("get",ee,le)},post(ee,le){this.submit("post",ee,le)},put(ee,le){this.submit("put",ee,le)},patch(ee,le){this.submit("patch",ee,le)},delete(ee,le){this.submit("delete",ee,le)},cancel(){k&&k.cancel()},__rememberable:y===null,__remember(){return{data:this.data(),errors:this.errors}},__restore(ee){Object.assign(this,ee.data),this.setError(ee.errors)}});return f_(W,ee=>{W.isDirty=!RU(W.data(),M),y&&ya.remember(al(ee.__remember()),y)},{immediate:!0,deep:!0}),W}var wl=Vd(null),a_=Vd(null),Pb=dF(null),Ay=Vd(null),aw=null,hj=Qu({name:"Inertia",props:{initialPage:{type:Object,required:!0},initialComponent:{type:Object,required:!1},resolveComponent:{type:Function,required:!1},titleCallback:{type:Function,required:!1,default:a=>a},onHeadUpdate:{type:Function,required:!1,default:()=>()=>{}}},setup({initialPage:a,initialComponent:d,resolveComponent:y,titleCallback:S,onHeadUpdate:P}){wl.value=d?w_(d):null,a_.value=a,Ay.value=null;const M=typeof window>"u";return aw=HV(M,S,P),M||(ya.init({initialPage:a,resolveComponent:y,swapComponent:async k=>{wl.value=w_(k.component),a_.value=k.page,Ay.value=k.preserveState?Ay.value:Date.now()}}),ya.on("navigate",()=>aw.forceUpdate())),()=>{if(wl.value){wl.value.inheritAttrs=!!wl.value.inheritAttrs;const k=Bd(wl.value,{...a_.value.props,key:Ay.value});return Pb.value&&(wl.value.layout=Pb.value,Pb.value=null),wl.value.layout?typeof wl.value.layout=="function"?wl.value.layout(Bd,k):(Array.isArray(wl.value.layout)?wl.value.layout:[wl.value.layout]).concat(k).reverse().reduce((r,j)=>(j.inheritAttrs=!!j.inheritAttrs,Bd(j,{...a_.value.props},()=>r))):k}}}}),dj=hj,fj={install(a){ya.form=uj,Object.defineProperty(a.config.globalProperties,"$inertia",{get:()=>ya}),Object.defineProperty(a.config.globalProperties,"$page",{get:()=>a_.value}),Object.defineProperty(a.config.globalProperties,"$headManager",{get:()=>aw}),a.mixin(cj)}};async function pj({id:a="app",resolve:d,setup:y,title:S,progress:P={},page:M,render:k}){const r=typeof window>"u",j=r?null:document.getElementById(a),H=M||JSON.parse(j.dataset.page),W=pe=>Promise.resolve(d(pe)).then(se=>se.default||se);let ee=[];const le=await Promise.all([W(H.component),ya.decryptHistory().catch(()=>{})]).then(([pe])=>y({el:j,App:dj,props:{initialPage:H,initialComponent:pe,resolveComponent:W,titleCallback:S,onHeadUpdate:r?se=>ee=se:null},plugin:fj}));if(!r&&P&&aj(P),r){const pe=await k(_3({render:()=>Bd("div",{id:a,"data-page":JSON.stringify(H),innerHTML:le?k(le):""})}));return{head:ee,body:pe}}}var Xc=()=>{},mj=Qu({name:"Link",props:{as:{type:[String,Object],default:"a"},data:{type:Object,default:()=>({})},href:{type:[String,Object],default:""},method:{type:String,default:"get"},replace:{type:Boolean,default:!1},preserveScroll:{type:Boolean,default:!1},preserveState:{type:Boolean,default:null},preserveUrl:{type:Boolean,default:!1},only:{type:Array,default:()=>[]},except:{type:Array,default:()=>[]},headers:{type:Object,default:()=>({})},queryStringArrayFormat:{type:String,default:"brackets"},async:{type:Boolean,default:!1},prefetch:{type:[Boolean,String,Array],default:!1},cacheFor:{type:[Number,String,Array],default:0},onStart:{type:Function,default:Xc},onProgress:{type:Function,default:Xc},onFinish:{type:Function,default:Xc},onBefore:{type:Function,default:Xc},onCancel:{type:Function,default:Xc},onSuccess:{type:Function,default:Xc},onError:{type:Function,default:Xc},onCancelToken:{type:Function,default:Xc},onPrefetching:{type:Function,default:Xc},onPrefetched:{type:Function,default:Xc},cacheTags:{type:[String,Array],default:()=>[]}},setup(a,{slots:d,attrs:y}){const S=Vd(0),P=Vd(null),M=Hl(()=>a.prefetch===!0?["hover"]:a.prefetch===!1?[]:Array.isArray(a.prefetch)?a.prefetch:[a.prefetch]),k=Hl(()=>a.cacheFor!==0?a.cacheFor:M.value.length===1&&M.value[0]==="click"?0:3e4);Dw(()=>{M.value.includes("mount")&&he()}),zw(()=>{clearTimeout(P.value)});const r=Hl(()=>sv(a.href)?a.href.method:a.method.toLowerCase()),j=Hl(()=>typeof a.as!="string"||a.as.toLowerCase()!=="a"?a.as:r.value!=="get"?"button":a.as.toLowerCase()),H=Hl(()=>wM(r.value,sv(a.href)?a.href.url:a.href,a.data,a.queryStringArrayFormat)),W=Hl(()=>H.value[0]),ee=Hl(()=>H.value[1]),le=Hl(()=>j.value==="button"?{type:"button"}:j.value==="a"||typeof j.value!="string"?{href:W.value}:{}),pe=Hl(()=>({data:ee.value,method:r.value,replace:a.replace,preserveScroll:a.preserveScroll,preserveState:a.preserveState??r.value!=="get",preserveUrl:a.preserveUrl,only:a.only,except:a.except,headers:a.headers,async:a.async})),se=Hl(()=>({...pe.value,onCancelToken:a.onCancelToken,onBefore:a.onBefore,onStart:oe=>{S.value++,a.onStart(oe)},onProgress:a.onProgress,onFinish:oe=>{S.value--,a.onFinish(oe)},onCancel:a.onCancel,onSuccess:a.onSuccess,onError:a.onError})),he=()=>{ya.prefetch(W.value,{...pe.value,onPrefetching:a.onPrefetching,onPrefetched:a.onPrefetched},{cacheFor:k.value,cacheTags:a.cacheTags})},Te={onClick:oe=>{Ey(oe)&&(oe.preventDefault(),ya.visit(W.value,se.value))}},Se={onMouseenter:()=>{P.value=setTimeout(()=>{he()},75)},onMouseleave:()=>{clearTimeout(P.value)},onClick:Te.onClick},fe={onMousedown:oe=>{Ey(oe)&&(oe.preventDefault(),he())},onKeydown:oe=>{Ey(oe)&&SP(oe)&&(oe.preventDefault(),he())},onMouseup:oe=>{oe.preventDefault(),ya.visit(W.value,se.value)},onKeyup:oe=>{SP(oe)&&(oe.preventDefault(),ya.visit(W.value,se.value))},onClick:oe=>{Ey(oe)&&oe.preventDefault()}};return()=>Bd(j.value,{...y,...le.value,"data-loading":S.value>0?"":void 0,...M.value.includes("hover")?Se:M.value.includes("click")?fe:Te},d)}}),z8=mj;async function _j(a,d){for(const y of Array.isArray(a)?a:[a]){const S=d[y];if(!(typeof S>"u"))return typeof S=="function"?S():S}throw new Error(`Page not found: ${a}`)}/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let DM;const Mv=a=>DM=a,zM=Symbol();function lw(a){return a&&typeof a=="object"&&Object.prototype.toString.call(a)==="[object Object]"&&typeof a.toJSON!="function"}var v_;(function(a){a.direct="direct",a.patchObject="patch object",a.patchFunction="patch function"})(v_||(v_={}));function gj(){const a=T2(!0),d=a.run(()=>Vd({}));let y=[],S=[];const P=w_({install(M){Mv(P),P._a=M,M.provide(zM,P),M.config.globalProperties.$pinia=P,S.forEach(k=>y.push(k)),S=[]},use(M){return this._a?y.push(M):S.push(M),this},_p:y,_a:null,_e:a,_s:new Map,state:d});return P}const kM=()=>{};function EP(a,d,y,S=kM){a.push(d);const P=()=>{const M=a.indexOf(d);M>-1&&(a.splice(M,1),S())};return!y&&S2()&&Gk(P),P}function rp(a,...d){a.slice().forEach(y=>{y(...d)})}const yj=a=>a(),AP=Symbol(),Cb=Symbol();function cw(a,d){a instanceof Map&&d instanceof Map?d.forEach((y,S)=>a.set(S,y)):a instanceof Set&&d instanceof Set&&d.forEach(a.add,a);for(const y in d){if(!d.hasOwnProperty(y))continue;const S=d[y],P=a[y];lw(P)&&lw(S)&&a.hasOwnProperty(y)&&!Uo(S)&&!Hu(S)?a[y]=cw(P,S):a[y]=S}return a}const vj=Symbol();function xj(a){return!lw(a)||!Object.prototype.hasOwnProperty.call(a,vj)}const{assign:Bh}=Object;function bj(a){return!!(Uo(a)&&a.effect)}function wj(a,d,y,S){const{state:P,actions:M,getters:k}=d,r=y.state.value[a];let j;function H(){r||(y.state.value[a]=P?P():{});const W=gF(y.state.value[a]);return Bh(W,M,Object.keys(k||{}).reduce((ee,le)=>(ee[le]=w_(Hl(()=>{Mv(y);const pe=y._s.get(a);return k[le].call(pe,pe)})),ee),{}))}return j=FM(a,H,d,y,S,!0),j}function FM(a,d,y={},S,P,M){let k;const r=Bh({actions:{}},y),j={deep:!0};let H,W,ee=[],le=[],pe;const se=S.state.value[a];!M&&!se&&(S.state.value[a]={}),Vd({});let he;function Te(ot){let Be;H=W=!1,typeof ot=="function"?(ot(S.state.value[a]),Be={type:v_.patchFunction,storeId:a,events:pe}):(cw(S.state.value[a],ot),Be={type:v_.patchObject,payload:ot,storeId:a,events:pe});const De=he=Symbol();vv().then(()=>{he===De&&(H=!0)}),W=!0,rp(ee,Be,S.state.value[a])}const Se=M?function(){const{state:Be}=y,De=Be?Be():{};this.$patch(Oe=>{Bh(Oe,De)})}:kM;function fe(){k.stop(),ee=[],le=[],S._s.delete(a)}const oe=(ot,Be="")=>{if(AP in ot)return ot[Cb]=Be,ot;const De=function(){Mv(S);const Oe=Array.from(arguments),He=[],ft=[];function tt(si){He.push(si)}function At(si){ft.push(si)}rp(le,{args:Oe,name:De[Cb],store:Ge,after:tt,onError:At});let yt;try{yt=ot.apply(this&&this.$id===a?this:Ge,Oe)}catch(si){throw rp(ft,si),si}return yt instanceof Promise?yt.then(si=>(rp(He,si),si)).catch(si=>(rp(ft,si),Promise.reject(si))):(rp(He,yt),yt)};return De[AP]=!0,De[Cb]=Be,De},ge={_p:S,$id:a,$onAction:EP.bind(null,le),$patch:Te,$reset:Se,$subscribe(ot,Be={}){const De=EP(ee,ot,Be.detached,()=>Oe()),Oe=k.run(()=>f_(()=>S.state.value[a],He=>{(Be.flush==="sync"?W:H)&&ot({storeId:a,type:v_.direct,events:pe},He)},Bh({},j,Be)));return De},$dispose:fe},Ge=B_(ge);S._s.set(a,Ge);const It=(S._a&&S._a.runWithContext||yj)(()=>S._e.run(()=>(k=T2()).run(()=>d({action:oe}))));for(const ot in It){const Be=It[ot];if(Uo(Be)&&!bj(Be)||Hu(Be))M||(se&&xj(Be)&&(Uo(Be)?Be.value=se[ot]:cw(Be,se[ot])),S.state.value[a][ot]=Be);else if(typeof Be=="function"){const De=oe(Be,ot);It[ot]=De,r.actions[ot]=Be}}return Bh(Ge,It),Bh(hs(Ge),It),Object.defineProperty(Ge,"$state",{get:()=>S.state.value[a],set:ot=>{Te(Be=>{Bh(Be,ot)})}}),S._p.forEach(ot=>{Bh(Ge,k.run(()=>ot({store:Ge,app:S._a,pinia:S,options:r})))}),se&&M&&y.hydrate&&y.hydrate(Ge.$state,se),H=!0,W=!0,Ge}/*! #__NO_SIDE_EFFECTS__ */function k8(a,d,y){let S;const P=typeof d=="function";S=P?y:d;function M(k,r){const j=eB();return k=k||(j?hp(zM,null):null),k&&Mv(k),k=DM,k._s.has(a)||(P?FM(a,d,S,k):wj(a,S,k)),k._s.get(a)}return M.$id=a,M}var Tj=Object.defineProperty,IP=Object.getOwnPropertySymbols,Sj=Object.prototype.hasOwnProperty,Ej=Object.prototype.propertyIsEnumerable,PP=(a,d,y)=>d in a?Tj(a,d,{enumerable:!0,configurable:!0,writable:!0,value:y}):a[d]=y,BM=(a,d)=>{for(var y in d||(d={}))Sj.call(d,y)&&PP(a,y,d[y]);if(IP)for(var y of IP(d))Ej.call(d,y)&&PP(a,y,d[y]);return a},Rv=a=>typeof a=="function",Ov=a=>typeof a=="string",NM=a=>Ov(a)&&a.trim().length>0,Aj=a=>typeof a=="number",Od=a=>typeof a>"u",M_=a=>typeof a=="object"&&a!==null,Ij=a=>nu(a,"tag")&&NM(a.tag),UM=a=>window.TouchEvent&&a instanceof TouchEvent,VM=a=>nu(a,"component")&&jM(a.component),Pj=a=>Rv(a)||M_(a),jM=a=>!Od(a)&&(Ov(a)||Pj(a)||VM(a)),CP=a=>M_(a)&&["height","width","right","left","top","bottom"].every(d=>Aj(a[d])),nu=(a,d)=>(M_(a)||Rv(a))&&d in a,Cj=(a=>()=>a++)(0);function Mb(a){return UM(a)?a.targetTouches[0].clientX:a.clientX}function MP(a){return UM(a)?a.targetTouches[0].clientY:a.clientY}var Mj=a=>{Od(a.remove)?a.parentNode&&a.parentNode.removeChild(a):a.remove()},$_=a=>VM(a)?$_(a.component):Ij(a)?Qu({render(){return a}}):typeof a=="string"?a:hs(U2(a)),Rj=a=>{if(typeof a=="string")return a;const d=nu(a,"props")&&M_(a.props)?a.props:{},y=nu(a,"listeners")&&M_(a.listeners)?a.listeners:{};return{component:$_(a),props:d,listeners:y}},Oj=()=>typeof window<"u",Qw=class{constructor(){this.allHandlers={}}getHandlers(a){return this.allHandlers[a]||[]}on(a,d){const y=this.getHandlers(a);y.push(d),this.allHandlers[a]=y}off(a,d){const y=this.getHandlers(a);y.splice(y.indexOf(d)>>>0,1)}emit(a,d){this.getHandlers(a).forEach(S=>S(d))}},Lj=a=>["on","off","emit"].every(d=>nu(a,d)&&Rv(a[d])),El;(function(a){a.SUCCESS="success",a.ERROR="error",a.WARNING="warning",a.INFO="info",a.DEFAULT="default"})(El||(El={}));var ov;(function(a){a.TOP_LEFT="top-left",a.TOP_CENTER="top-center",a.TOP_RIGHT="top-right",a.BOTTOM_LEFT="bottom-left",a.BOTTOM_CENTER="bottom-center",a.BOTTOM_RIGHT="bottom-right"})(ov||(ov={}));var Al;(function(a){a.ADD="add",a.DISMISS="dismiss",a.UPDATE="update",a.CLEAR="clear",a.UPDATE_DEFAULTS="update_defaults"})(Al||(Al={}));var wc="Vue-Toastification",vc={type:{type:String,default:El.DEFAULT},classNames:{type:[String,Array],default:()=>[]},trueBoolean:{type:Boolean,default:!0}},$M={type:vc.type,customIcon:{type:[String,Boolean,Object,Function],default:!0}},Fy={component:{type:[String,Object,Function,Boolean],default:"button"},classNames:vc.classNames,showOnHover:{type:Boolean,default:!1},ariaLabel:{type:String,default:"close"}},uw={timeout:{type:[Number,Boolean],default:5e3},hideProgressBar:{type:Boolean,default:!1},isRunning:{type:Boolean,default:!1}},qM={transition:{type:[Object,String],default:`${wc}__bounce`}},Dj={position:{type:String,default:ov.TOP_RIGHT},draggable:vc.trueBoolean,draggablePercent:{type:Number,default:.6},pauseOnFocusLoss:vc.trueBoolean,pauseOnHover:vc.trueBoolean,closeOnClick:vc.trueBoolean,timeout:uw.timeout,hideProgressBar:uw.hideProgressBar,toastClassName:vc.classNames,bodyClassName:vc.classNames,icon:$M.customIcon,closeButton:Fy.component,closeButtonClassName:Fy.classNames,showCloseButtonOnHover:Fy.showOnHover,accessibility:{type:Object,default:()=>({toastRole:"alert",closeButtonLabel:"close"})},rtl:{type:Boolean,default:!1},eventBus:{type:Object,required:!1,default:()=>new Qw}},zj={id:{type:[String,Number],required:!0,default:0},type:vc.type,content:{type:[String,Object,Function],required:!0,default:""},onClick:{type:Function,default:void 0},onClose:{type:Function,default:void 0}},kj={container:{type:[Object,Function],default:()=>document.body},newestOnTop:vc.trueBoolean,maxToasts:{type:Number,default:20},transition:qM.transition,toastDefaults:Object,filterBeforeCreate:{type:Function,default:a=>a},filterToasts:{type:Function,default:a=>a},containerClassName:vc.classNames,onMounted:Function,shareAppContext:[Boolean,Object]},Wu={CORE_TOAST:Dj,TOAST:zj,CONTAINER:kj,PROGRESS_BAR:uw,ICON:$M,TRANSITION:qM,CLOSE_BUTTON:Fy},GM=Qu({name:"VtProgressBar",props:Wu.PROGRESS_BAR,data(){return{hasClass:!0}},computed:{style(){return{animationDuration:`${this.timeout}ms`,animationPlayState:this.isRunning?"running":"paused",opacity:this.hideProgressBar?0:1}},cpClass(){return this.hasClass?`${wc}__progress-bar`:""}},watch:{timeout(){this.hasClass=!1,this.$nextTick(()=>this.hasClass=!0)}},mounted(){this.$el.addEventListener("animationend",this.animationEnded)},beforeUnmount(){this.$el.removeEventListener("animationend",this.animationEnded)},methods:{animationEnded(){this.$emit("close-toast")}}});function Fj(a,d){return Do(),xc("div",{style:F_(a.style),class:jh(a.cpClass)},null,6)}GM.render=Fj;var Bj=GM,HM=Qu({name:"VtCloseButton",props:Wu.CLOSE_BUTTON,computed:{buttonComponent(){return this.component!==!1?$_(this.component):"button"},classes(){const a=[`${wc}__close-button`];return this.showOnHover&&a.push("show-on-hover"),a.concat(this.classNames)}}}),Nj=V_("  ");function Uj(a,d){return Do(),bc(kw(a.buttonComponent),Tv({"aria-label":a.ariaLabel,class:a.classes},a.$attrs),{default:U_(()=>[Nj]),_:1},16,["aria-label","class"])}HM.render=Uj;var Vj=HM,ZM={},jj={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"check-circle",class:"svg-inline--fa fa-check-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},$j=qd("path",{fill:"currentColor",d:"M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"},null,-1),qj=[$j];function Gj(a,d){return Do(),xc("svg",jj,qj)}ZM.render=Gj;var Hj=ZM,WM={},Zj={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"info-circle",class:"svg-inline--fa fa-info-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},Wj=qd("path",{fill:"currentColor",d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"},null,-1),Xj=[Wj];function Kj(a,d){return Do(),xc("svg",Zj,Xj)}WM.render=Kj;var RP=WM,XM={},Yj={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"exclamation-circle",class:"svg-inline--fa fa-exclamation-circle fa-w-16",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},Jj=qd("path",{fill:"currentColor",d:"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},null,-1),Qj=[Jj];function e6(a,d){return Do(),xc("svg",Yj,Qj)}XM.render=e6;var t6=XM,KM={},i6={"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"exclamation-triangle",class:"svg-inline--fa fa-exclamation-triangle fa-w-18",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 576 512"},n6=qd("path",{fill:"currentColor",d:"M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"},null,-1),r6=[n6];function s6(a,d){return Do(),xc("svg",i6,r6)}KM.render=s6;var o6=KM,YM=Qu({name:"VtIcon",props:Wu.ICON,computed:{customIconChildren(){return nu(this.customIcon,"iconChildren")?this.trimValue(this.customIcon.iconChildren):""},customIconClass(){return Ov(this.customIcon)?this.trimValue(this.customIcon):nu(this.customIcon,"iconClass")?this.trimValue(this.customIcon.iconClass):""},customIconTag(){return nu(this.customIcon,"iconTag")?this.trimValue(this.customIcon.iconTag,"i"):"i"},hasCustomIcon(){return this.customIconClass.length>0},component(){return this.hasCustomIcon?this.customIconTag:jM(this.customIcon)?$_(this.customIcon):this.iconTypeComponent},iconTypeComponent(){return{[El.DEFAULT]:RP,[El.INFO]:RP,[El.SUCCESS]:Hj,[El.ERROR]:o6,[El.WARNING]:t6}[this.type]},iconClasses(){const a=[`${wc}__icon`];return this.hasCustomIcon?a.concat(this.customIconClass):a}},methods:{trimValue(a,d=""){return NM(a)?a.trim():d}}});function a6(a,d){return Do(),bc(kw(a.component),{class:jh(a.iconClasses)},{default:U_(()=>[V_(Ew(a.customIconChildren),1)]),_:1},8,["class"])}YM.render=a6;var l6=YM,JM=Qu({name:"VtToast",components:{ProgressBar:Bj,CloseButton:Vj,Icon:l6},inheritAttrs:!1,props:Object.assign({},Wu.CORE_TOAST,Wu.TOAST),data(){return{isRunning:!0,disableTransitions:!1,beingDragged:!1,dragStart:0,dragPos:{x:0,y:0},dragRect:{}}},computed:{classes(){const a=[`${wc}__toast`,`${wc}__toast--${this.type}`,`${this.position}`].concat(this.toastClassName);return this.disableTransitions&&a.push("disable-transition"),this.rtl&&a.push(`${wc}__toast--rtl`),a},bodyClasses(){return[`${wc}__toast-${Ov(this.content)?"body":"component-body"}`].concat(this.bodyClassName)},draggableStyle(){return this.dragStart===this.dragPos.x?{}:this.beingDragged?{transform:`translateX(${this.dragDelta}px)`,opacity:1-Math.abs(this.dragDelta/this.removalDistance)}:{transition:"transform 0.2s, opacity 0.2s",transform:"translateX(0)",opacity:1}},dragDelta(){return this.beingDragged?this.dragPos.x-this.dragStart:0},removalDistance(){return CP(this.dragRect)?(this.dragRect.right-this.dragRect.left)*this.draggablePercent:0}},mounted(){this.draggable&&this.draggableSetup(),this.pauseOnFocusLoss&&this.focusSetup()},beforeUnmount(){this.draggable&&this.draggableCleanup(),this.pauseOnFocusLoss&&this.focusCleanup()},methods:{hasProp:nu,getVueComponentFromObj:$_,closeToast(){this.eventBus.emit(Al.DISMISS,this.id)},clickHandler(){this.onClick&&this.onClick(this.closeToast),this.closeOnClick&&(!this.beingDragged||this.dragStart===this.dragPos.x)&&this.closeToast()},timeoutHandler(){this.closeToast()},hoverPause(){this.pauseOnHover&&(this.isRunning=!1)},hoverPlay(){this.pauseOnHover&&(this.isRunning=!0)},focusPause(){this.isRunning=!1},focusPlay(){this.isRunning=!0},focusSetup(){addEventListener("blur",this.focusPause),addEventListener("focus",this.focusPlay)},focusCleanup(){removeEventListener("blur",this.focusPause),removeEventListener("focus",this.focusPlay)},draggableSetup(){const a=this.$el;a.addEventListener("touchstart",this.onDragStart,{passive:!0}),a.addEventListener("mousedown",this.onDragStart),addEventListener("touchmove",this.onDragMove,{passive:!1}),addEventListener("mousemove",this.onDragMove),addEventListener("touchend",this.onDragEnd),addEventListener("mouseup",this.onDragEnd)},draggableCleanup(){const a=this.$el;a.removeEventListener("touchstart",this.onDragStart),a.removeEventListener("mousedown",this.onDragStart),removeEventListener("touchmove",this.onDragMove),removeEventListener("mousemove",this.onDragMove),removeEventListener("touchend",this.onDragEnd),removeEventListener("mouseup",this.onDragEnd)},onDragStart(a){this.beingDragged=!0,this.dragPos={x:Mb(a),y:MP(a)},this.dragStart=Mb(a),this.dragRect=this.$el.getBoundingClientRect()},onDragMove(a){this.beingDragged&&(a.preventDefault(),this.isRunning&&(this.isRunning=!1),this.dragPos={x:Mb(a),y:MP(a)})},onDragEnd(){this.beingDragged&&(Math.abs(this.dragDelta)>=this.removalDistance?(this.disableTransitions=!0,this.$nextTick(()=>this.closeToast())):setTimeout(()=>{this.beingDragged=!1,CP(this.dragRect)&&this.pauseOnHover&&this.dragRect.bottom>=this.dragPos.y&&this.dragPos.y>=this.dragRect.top&&this.dragRect.left<=this.dragPos.x&&this.dragPos.x<=this.dragRect.right?this.isRunning=!1:this.isRunning=!0}))}}}),c6=["role"];function u6(a,d){const y=h_("Icon"),S=h_("CloseButton"),P=h_("ProgressBar");return Do(),xc("div",{class:jh(a.classes),style:F_(a.draggableStyle),onClick:d[0]||(d[0]=(...M)=>a.clickHandler&&a.clickHandler(...M)),onMouseenter:d[1]||(d[1]=(...M)=>a.hoverPause&&a.hoverPause(...M)),onMouseleave:d[2]||(d[2]=(...M)=>a.hoverPlay&&a.hoverPlay(...M))},[a.icon?(Do(),bc(y,{key:0,"custom-icon":a.icon,type:a.type},null,8,["custom-icon","type"])):C0("v-if",!0),qd("div",{role:a.accessibility.toastRole||"alert",class:jh(a.bodyClasses)},[typeof a.content=="string"?(Do(),xc(na,{key:0},[V_(Ew(a.content),1)],2112)):(Do(),bc(kw(a.getVueComponentFromObj(a.content)),Tv({key:1,"toast-id":a.id},a.hasProp(a.content,"props")?a.content.props:{},qF(a.hasProp(a.content,"listeners")?a.content.listeners:{}),{onCloseToast:a.closeToast}),null,16,["toast-id","onCloseToast"]))],10,c6),a.closeButton?(Do(),bc(S,{key:1,component:a.closeButton,"class-names":a.closeButtonClassName,"show-on-hover":a.showCloseButtonOnHover,"aria-label":a.accessibility.closeButtonLabel,onClick:d3(a.closeToast,["stop"])},null,8,["component","class-names","show-on-hover","aria-label","onClick"])):C0("v-if",!0),a.timeout?(Do(),bc(P,{key:2,"is-running":a.isRunning,"hide-progress-bar":a.hideProgressBar,timeout:a.timeout,onCloseToast:a.timeoutHandler},null,8,["is-running","hide-progress-bar","timeout","onCloseToast"])):C0("v-if",!0)],38)}JM.render=u6;var h6=JM,QM=Qu({name:"VtTransition",props:Wu.TRANSITION,emits:["leave"],methods:{hasProp:nu,leave(a){a instanceof HTMLElement&&(a.style.left=a.offsetLeft+"px",a.style.top=a.offsetTop+"px",a.style.width=getComputedStyle(a).width,a.style.position="absolute")}}});function d6(a,d){return Do(),bc(e3,{tag:"div","enter-active-class":a.transition.enter?a.transition.enter:`${a.transition}-enter-active`,"move-class":a.transition.move?a.transition.move:`${a.transition}-move`,"leave-active-class":a.transition.leave?a.transition.leave:`${a.transition}-leave-active`,onLeave:a.leave},{default:U_(()=>[$F(a.$slots,"default")]),_:3},8,["enter-active-class","move-class","leave-active-class","onLeave"])}QM.render=d6;var f6=QM,eR=Qu({name:"VueToastification",devtools:{hide:!0},components:{Toast:h6,VtTransition:f6},props:Object.assign({},Wu.CORE_TOAST,Wu.CONTAINER,Wu.TRANSITION),data(){return{count:0,positions:Object.values(ov),toasts:{},defaults:{}}},computed:{toastArray(){return Object.values(this.toasts)},filteredToasts(){return this.defaults.filterToasts(this.toastArray)}},beforeMount(){const a=this.eventBus;a.on(Al.ADD,this.addToast),a.on(Al.CLEAR,this.clearToasts),a.on(Al.DISMISS,this.dismissToast),a.on(Al.UPDATE,this.updateToast),a.on(Al.UPDATE_DEFAULTS,this.updateDefaults),this.defaults=this.$props},mounted(){this.setup(this.container)},methods:{async setup(a){Rv(a)&&(a=await a()),Mj(this.$el),a.appendChild(this.$el)},setToast(a){Od(a.id)||(this.toasts[a.id]=a)},addToast(a){a.content=Rj(a.content);const d=Object.assign({},this.defaults,a.type&&this.defaults.toastDefaults&&this.defaults.toastDefaults[a.type],a),y=this.defaults.filterBeforeCreate(d,this.toastArray);y&&this.setToast(y)},dismissToast(a){const d=this.toasts[a];!Od(d)&&!Od(d.onClose)&&d.onClose(),delete this.toasts[a]},clearToasts(){Object.keys(this.toasts).forEach(a=>{this.dismissToast(a)})},getPositionToasts(a){const d=this.filteredToasts.filter(y=>y.position===a).slice(0,this.defaults.maxToasts);return this.defaults.newestOnTop?d.reverse():d},updateDefaults(a){Od(a.container)||this.setup(a.container),this.defaults=Object.assign({},this.defaults,a)},updateToast({id:a,options:d,create:y}){this.toasts[a]?(d.timeout&&d.timeout===this.toasts[a].timeout&&d.timeout++,this.setToast(Object.assign({},this.toasts[a],d))):y&&this.addToast(Object.assign({},{id:a},d))},getClasses(a){return[`${wc}__container`,a].concat(this.defaults.containerClassName)}}});function p6(a,d){const y=h_("Toast"),S=h_("VtTransition");return Do(),xc("div",null,[(Do(!0),xc(na,null,wA(a.positions,P=>(Do(),xc("div",{key:P},[ra(S,{transition:a.defaults.transition,class:jh(a.getClasses(P))},{default:U_(()=>[(Do(!0),xc(na,null,wA(a.getPositionToasts(P),M=>(Do(),bc(y,Tv({key:M.id},M),null,16))),128))]),_:2},1032,["transition","class"])]))),128))])}eR.render=p6;var m6=eR,OP=(a={},d=!0)=>{const y=a.eventBus=a.eventBus||new Qw;d&&vv(()=>{const M=VC(m6,BM({},a)),k=M.mount(document.createElement("div")),r=a.onMounted;if(Od(r)||r(k,M),a.shareAppContext){const j=a.shareAppContext;j===!0?console.warn(`[${wc}] App to share context with was not provided.`):(M._context.components=j._context.components,M._context.directives=j._context.directives,M._context.mixins=j._context.mixins,M._context.provides=j._context.provides,M.config.globalProperties=j.config.globalProperties)}});const S=(M,k)=>{const r=Object.assign({},{id:Cj(),type:El.DEFAULT},k,{content:M});return y.emit(Al.ADD,r),r.id};S.clear=()=>y.emit(Al.CLEAR,void 0),S.updateDefaults=M=>{y.emit(Al.UPDATE_DEFAULTS,M)},S.dismiss=M=>{y.emit(Al.DISMISS,M)};function P(M,{content:k,options:r},j=!1){const H=Object.assign({},r,{content:k});y.emit(Al.UPDATE,{id:M,options:H,create:j})}return S.update=P,S.success=(M,k)=>S(M,Object.assign({},k,{type:El.SUCCESS})),S.info=(M,k)=>S(M,Object.assign({},k,{type:El.INFO})),S.error=(M,k)=>S(M,Object.assign({},k,{type:El.ERROR})),S.warning=(M,k)=>S(M,Object.assign({},k,{type:El.WARNING})),S},_6=()=>{const a=()=>console.warn(`[${wc}] This plugin does not support SSR!`);return new Proxy(a,{get(){return a}})};function tR(a){return Oj()?Lj(a)?OP({eventBus:a},!1):OP(a,!0):_6()}var iR=Symbol("VueToastification"),nR=new Qw,g6=(a,d)=>{d?.shareAppContext===!0&&(d.shareAppContext=a);const y=tR(BM({eventBus:nR},d));a.provide(iR,y)},F8=a=>{const d=wp()?hp(iR,void 0):void 0;return d||tR(nR)},y6=g6,l_={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var v6=l_.exports,LP;function x6(){return LP||(LP=1,(function(a,d){(function(y,S){S(d)})(v6,(function(y){var S="1.9.4";function P(_){var E,z,$,te;for(z=1,$=arguments.length;z<$;z++){te=arguments[z];for(E in te)_[E]=te[E]}return _}var M=Object.create||(function(){function _(){}return function(E){return _.prototype=E,new _}})();function k(_,E){var z=Array.prototype.slice;if(_.bind)return _.bind.apply(_,z.call(arguments,1));var $=z.call(arguments,2);return function(){return _.apply(E,$.length?$.concat(z.call(arguments)):arguments)}}var r=0;function j(_){return"_leaflet_id"in _||(_._leaflet_id=++r),_._leaflet_id}function H(_,E,z){var $,te,Ce,dt;return dt=function(){$=!1,te&&(Ce.apply(z,te),te=!1)},Ce=function(){$?te=arguments:(_.apply(z,arguments),setTimeout(dt,E),$=!0)},Ce}function W(_,E,z){var $=E[1],te=E[0],Ce=$-te;return _===$&&z?_:((_-te)%Ce+Ce)%Ce+te}function ee(){return!1}function le(_,E){if(E===!1)return _;var z=Math.pow(10,E===void 0?6:E);return Math.round(_*z)/z}function pe(_){return _.trim?_.trim():_.replace(/^\s+|\s+$/g,"")}function se(_){return pe(_).split(/\s+/)}function he(_,E){Object.prototype.hasOwnProperty.call(_,"options")||(_.options=_.options?M(_.options):{});for(var z in E)_.options[z]=E[z];return _.options}function Te(_,E,z){var $=[];for(var te in _)$.push(encodeURIComponent(z?te.toUpperCase():te)+"="+encodeURIComponent(_[te]));return(!E||E.indexOf("?")===-1?"?":"&")+$.join("&")}var Se=/\{ *([\w_ -]+) *\}/g;function fe(_,E){return _.replace(Se,function(z,$){var te=E[$];if(te===void 0)throw new Error("No value provided for variable "+z);return typeof te=="function"&&(te=te(E)),te})}var oe=Array.isArray||function(_){return Object.prototype.toString.call(_)==="[object Array]"};function ge(_,E){for(var z=0;z<_.length;z++)if(_[z]===E)return z;return-1}var Ge="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function xt(_){return window["webkit"+_]||window["moz"+_]||window["ms"+_]}var It=0;function ot(_){var E=+new Date,z=Math.max(0,16-(E-It));return It=E+z,window.setTimeout(_,z)}var Be=window.requestAnimationFrame||xt("RequestAnimationFrame")||ot,De=window.cancelAnimationFrame||xt("CancelAnimationFrame")||xt("CancelRequestAnimationFrame")||function(_){window.clearTimeout(_)};function Oe(_,E,z){if(z&&Be===ot)_.call(E);else return Be.call(window,k(_,E))}function He(_){_&&De.call(window,_)}var ft={__proto__:null,extend:P,create:M,bind:k,get lastId(){return r},stamp:j,throttle:H,wrapNum:W,falseFn:ee,formatNum:le,trim:pe,splitWords:se,setOptions:he,getParamString:Te,template:fe,isArray:oe,indexOf:ge,emptyImageUrl:Ge,requestFn:Be,cancelFn:De,requestAnimFrame:Oe,cancelAnimFrame:He};function tt(){}tt.extend=function(_){var E=function(){he(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},z=E.__super__=this.prototype,$=M(z);$.constructor=E,E.prototype=$;for(var te in this)Object.prototype.hasOwnProperty.call(this,te)&&te!=="prototype"&&te!=="__super__"&&(E[te]=this[te]);return _.statics&&P(E,_.statics),_.includes&&(At(_.includes),P.apply(null,[$].concat(_.includes))),P($,_),delete $.statics,delete $.includes,$.options&&($.options=z.options?M(z.options):{},P($.options,_.options)),$._initHooks=[],$.callInitHooks=function(){if(!this._initHooksCalled){z.callInitHooks&&z.callInitHooks.call(this),this._initHooksCalled=!0;for(var Ce=0,dt=$._initHooks.length;Ce<dt;Ce++)$._initHooks[Ce].call(this)}},E},tt.include=function(_){var E=this.prototype.options;return P(this.prototype,_),_.options&&(this.prototype.options=E,this.mergeOptions(_.options)),this},tt.mergeOptions=function(_){return P(this.prototype.options,_),this},tt.addInitHook=function(_){var E=Array.prototype.slice.call(arguments,1),z=typeof _=="function"?_:function(){this[_].apply(this,E)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(z),this};function At(_){if(!(typeof L>"u"||!L||!L.Mixin)){_=oe(_)?_:[_];for(var E=0;E<_.length;E++)_[E]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var yt={on:function(_,E,z){if(typeof _=="object")for(var $ in _)this._on($,_[$],E);else{_=se(_);for(var te=0,Ce=_.length;te<Ce;te++)this._on(_[te],E,z)}return this},off:function(_,E,z){if(!arguments.length)delete this._events;else if(typeof _=="object")for(var $ in _)this._off($,_[$],E);else{_=se(_);for(var te=arguments.length===1,Ce=0,dt=_.length;Ce<dt;Ce++)te?this._off(_[Ce]):this._off(_[Ce],E,z)}return this},_on:function(_,E,z,$){if(typeof E!="function"){console.warn("wrong listener type: "+typeof E);return}if(this._listens(_,E,z)===!1){z===this&&(z=void 0);var te={fn:E,ctx:z};$&&(te.once=!0),this._events=this._events||{},this._events[_]=this._events[_]||[],this._events[_].push(te)}},_off:function(_,E,z){var $,te,Ce;if(this._events&&($=this._events[_],!!$)){if(arguments.length===1){if(this._firingCount)for(te=0,Ce=$.length;te<Ce;te++)$[te].fn=ee;delete this._events[_];return}if(typeof E!="function"){console.warn("wrong listener type: "+typeof E);return}var dt=this._listens(_,E,z);if(dt!==!1){var Vt=$[dt];this._firingCount&&(Vt.fn=ee,this._events[_]=$=$.slice()),$.splice(dt,1)}}},fire:function(_,E,z){if(!this.listens(_,z))return this;var $=P({},E,{type:_,target:this,sourceTarget:E&&E.sourceTarget||this});if(this._events){var te=this._events[_];if(te){this._firingCount=this._firingCount+1||1;for(var Ce=0,dt=te.length;Ce<dt;Ce++){var Vt=te[Ce],Qt=Vt.fn;Vt.once&&this.off(_,Qt,Vt.ctx),Qt.call(Vt.ctx||this,$)}this._firingCount--}}return z&&this._propagateEvent($),this},listens:function(_,E,z,$){typeof _!="string"&&console.warn('"string" type argument expected');var te=E;typeof E!="function"&&($=!!E,te=void 0,z=void 0);var Ce=this._events&&this._events[_];if(Ce&&Ce.length&&this._listens(_,te,z)!==!1)return!0;if($){for(var dt in this._eventParents)if(this._eventParents[dt].listens(_,E,z,$))return!0}return!1},_listens:function(_,E,z){if(!this._events)return!1;var $=this._events[_]||[];if(!E)return!!$.length;z===this&&(z=void 0);for(var te=0,Ce=$.length;te<Ce;te++)if($[te].fn===E&&$[te].ctx===z)return te;return!1},once:function(_,E,z){if(typeof _=="object")for(var $ in _)this._on($,_[$],E,!0);else{_=se(_);for(var te=0,Ce=_.length;te<Ce;te++)this._on(_[te],E,z,!0)}return this},addEventParent:function(_){return this._eventParents=this._eventParents||{},this._eventParents[j(_)]=_,this},removeEventParent:function(_){return this._eventParents&&delete this._eventParents[j(_)],this},_propagateEvent:function(_){for(var E in this._eventParents)this._eventParents[E].fire(_.type,P({layer:_.target,propagatedFrom:_.target},_),!0)}};yt.addEventListener=yt.on,yt.removeEventListener=yt.clearAllEventListeners=yt.off,yt.addOneTimeEventListener=yt.once,yt.fireEvent=yt.fire,yt.hasEventListeners=yt.listens;var si=tt.extend(yt);function wt(_,E,z){this.x=z?Math.round(_):_,this.y=z?Math.round(E):E}var Gi=Math.trunc||function(_){return _>0?Math.floor(_):Math.ceil(_)};wt.prototype={clone:function(){return new wt(this.x,this.y)},add:function(_){return this.clone()._add(Ti(_))},_add:function(_){return this.x+=_.x,this.y+=_.y,this},subtract:function(_){return this.clone()._subtract(Ti(_))},_subtract:function(_){return this.x-=_.x,this.y-=_.y,this},divideBy:function(_){return this.clone()._divideBy(_)},_divideBy:function(_){return this.x/=_,this.y/=_,this},multiplyBy:function(_){return this.clone()._multiplyBy(_)},_multiplyBy:function(_){return this.x*=_,this.y*=_,this},scaleBy:function(_){return new wt(this.x*_.x,this.y*_.y)},unscaleBy:function(_){return new wt(this.x/_.x,this.y/_.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Gi(this.x),this.y=Gi(this.y),this},distanceTo:function(_){_=Ti(_);var E=_.x-this.x,z=_.y-this.y;return Math.sqrt(E*E+z*z)},equals:function(_){return _=Ti(_),_.x===this.x&&_.y===this.y},contains:function(_){return _=Ti(_),Math.abs(_.x)<=Math.abs(this.x)&&Math.abs(_.y)<=Math.abs(this.y)},toString:function(){return"Point("+le(this.x)+", "+le(this.y)+")"}};function Ti(_,E,z){return _ instanceof wt?_:oe(_)?new wt(_[0],_[1]):_==null?_:typeof _=="object"&&"x"in _&&"y"in _?new wt(_.x,_.y):new wt(_,E,z)}function di(_,E){if(_)for(var z=E?[_,E]:_,$=0,te=z.length;$<te;$++)this.extend(z[$])}di.prototype={extend:function(_){var E,z;if(!_)return this;if(_ instanceof wt||typeof _[0]=="number"||"x"in _)E=z=Ti(_);else if(_=ki(_),E=_.min,z=_.max,!E||!z)return this;return!this.min&&!this.max?(this.min=E.clone(),this.max=z.clone()):(this.min.x=Math.min(E.x,this.min.x),this.max.x=Math.max(z.x,this.max.x),this.min.y=Math.min(E.y,this.min.y),this.max.y=Math.max(z.y,this.max.y)),this},getCenter:function(_){return Ti((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,_)},getBottomLeft:function(){return Ti(this.min.x,this.max.y)},getTopRight:function(){return Ti(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(_){var E,z;return typeof _[0]=="number"||_ instanceof wt?_=Ti(_):_=ki(_),_ instanceof di?(E=_.min,z=_.max):E=z=_,E.x>=this.min.x&&z.x<=this.max.x&&E.y>=this.min.y&&z.y<=this.max.y},intersects:function(_){_=ki(_);var E=this.min,z=this.max,$=_.min,te=_.max,Ce=te.x>=E.x&&$.x<=z.x,dt=te.y>=E.y&&$.y<=z.y;return Ce&&dt},overlaps:function(_){_=ki(_);var E=this.min,z=this.max,$=_.min,te=_.max,Ce=te.x>E.x&&$.x<z.x,dt=te.y>E.y&&$.y<z.y;return Ce&&dt},isValid:function(){return!!(this.min&&this.max)},pad:function(_){var E=this.min,z=this.max,$=Math.abs(E.x-z.x)*_,te=Math.abs(E.y-z.y)*_;return ki(Ti(E.x-$,E.y-te),Ti(z.x+$,z.y+te))},equals:function(_){return _?(_=ki(_),this.min.equals(_.getTopLeft())&&this.max.equals(_.getBottomRight())):!1}};function ki(_,E){return!_||_ instanceof di?_:new di(_,E)}function dn(_,E){if(_)for(var z=E?[_,E]:_,$=0,te=z.length;$<te;$++)this.extend(z[$])}dn.prototype={extend:function(_){var E=this._southWest,z=this._northEast,$,te;if(_ instanceof mt)$=_,te=_;else if(_ instanceof dn){if($=_._southWest,te=_._northEast,!$||!te)return this}else return _?this.extend(Pt(_)||an(_)):this;return!E&&!z?(this._southWest=new mt($.lat,$.lng),this._northEast=new mt(te.lat,te.lng)):(E.lat=Math.min($.lat,E.lat),E.lng=Math.min($.lng,E.lng),z.lat=Math.max(te.lat,z.lat),z.lng=Math.max(te.lng,z.lng)),this},pad:function(_){var E=this._southWest,z=this._northEast,$=Math.abs(E.lat-z.lat)*_,te=Math.abs(E.lng-z.lng)*_;return new dn(new mt(E.lat-$,E.lng-te),new mt(z.lat+$,z.lng+te))},getCenter:function(){return new mt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new mt(this.getNorth(),this.getWest())},getSouthEast:function(){return new mt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(_){typeof _[0]=="number"||_ instanceof mt||"lat"in _?_=Pt(_):_=an(_);var E=this._southWest,z=this._northEast,$,te;return _ instanceof dn?($=_.getSouthWest(),te=_.getNorthEast()):$=te=_,$.lat>=E.lat&&te.lat<=z.lat&&$.lng>=E.lng&&te.lng<=z.lng},intersects:function(_){_=an(_);var E=this._southWest,z=this._northEast,$=_.getSouthWest(),te=_.getNorthEast(),Ce=te.lat>=E.lat&&$.lat<=z.lat,dt=te.lng>=E.lng&&$.lng<=z.lng;return Ce&&dt},overlaps:function(_){_=an(_);var E=this._southWest,z=this._northEast,$=_.getSouthWest(),te=_.getNorthEast(),Ce=te.lat>E.lat&&$.lat<z.lat,dt=te.lng>E.lng&&$.lng<z.lng;return Ce&&dt},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(_,E){return _?(_=an(_),this._southWest.equals(_.getSouthWest(),E)&&this._northEast.equals(_.getNorthEast(),E)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function an(_,E){return _ instanceof dn?_:new dn(_,E)}function mt(_,E,z){if(isNaN(_)||isNaN(E))throw new Error("Invalid LatLng object: ("+_+", "+E+")");this.lat=+_,this.lng=+E,z!==void 0&&(this.alt=+z)}mt.prototype={equals:function(_,E){if(!_)return!1;_=Pt(_);var z=Math.max(Math.abs(this.lat-_.lat),Math.abs(this.lng-_.lng));return z<=(E===void 0?1e-9:E)},toString:function(_){return"LatLng("+le(this.lat,_)+", "+le(this.lng,_)+")"},distanceTo:function(_){return Ui.distance(this,Pt(_))},wrap:function(){return Ui.wrapLatLng(this)},toBounds:function(_){var E=180*_/40075017,z=E/Math.cos(Math.PI/180*this.lat);return an([this.lat-E,this.lng-z],[this.lat+E,this.lng+z])},clone:function(){return new mt(this.lat,this.lng,this.alt)}};function Pt(_,E,z){return _ instanceof mt?_:oe(_)&&typeof _[0]!="object"?_.length===3?new mt(_[0],_[1],_[2]):_.length===2?new mt(_[0],_[1]):null:_==null?_:typeof _=="object"&&"lat"in _?new mt(_.lat,"lng"in _?_.lng:_.lon,_.alt):E===void 0?null:new mt(_,E,z)}var pi={latLngToPoint:function(_,E){var z=this.projection.project(_),$=this.scale(E);return this.transformation._transform(z,$)},pointToLatLng:function(_,E){var z=this.scale(E),$=this.transformation.untransform(_,z);return this.projection.unproject($)},project:function(_){return this.projection.project(_)},unproject:function(_){return this.projection.unproject(_)},scale:function(_){return 256*Math.pow(2,_)},zoom:function(_){return Math.log(_/256)/Math.LN2},getProjectedBounds:function(_){if(this.infinite)return null;var E=this.projection.bounds,z=this.scale(_),$=this.transformation.transform(E.min,z),te=this.transformation.transform(E.max,z);return new di($,te)},infinite:!1,wrapLatLng:function(_){var E=this.wrapLng?W(_.lng,this.wrapLng,!0):_.lng,z=this.wrapLat?W(_.lat,this.wrapLat,!0):_.lat,$=_.alt;return new mt(z,E,$)},wrapLatLngBounds:function(_){var E=_.getCenter(),z=this.wrapLatLng(E),$=E.lat-z.lat,te=E.lng-z.lng;if($===0&&te===0)return _;var Ce=_.getSouthWest(),dt=_.getNorthEast(),Vt=new mt(Ce.lat-$,Ce.lng-te),Qt=new mt(dt.lat-$,dt.lng-te);return new dn(Vt,Qt)}},Ui=P({},pi,{wrapLng:[-180,180],R:6371e3,distance:function(_,E){var z=Math.PI/180,$=_.lat*z,te=E.lat*z,Ce=Math.sin((E.lat-_.lat)*z/2),dt=Math.sin((E.lng-_.lng)*z/2),Vt=Ce*Ce+Math.cos($)*Math.cos(te)*dt*dt,Qt=2*Math.atan2(Math.sqrt(Vt),Math.sqrt(1-Vt));return this.R*Qt}}),ei=6378137,_i={R:ei,MAX_LATITUDE:85.0511287798,project:function(_){var E=Math.PI/180,z=this.MAX_LATITUDE,$=Math.max(Math.min(z,_.lat),-z),te=Math.sin($*E);return new wt(this.R*_.lng*E,this.R*Math.log((1+te)/(1-te))/2)},unproject:function(_){var E=180/Math.PI;return new mt((2*Math.atan(Math.exp(_.y/this.R))-Math.PI/2)*E,_.x*E/this.R)},bounds:(function(){var _=ei*Math.PI;return new di([-_,-_],[_,_])})()};function un(_,E,z,$){if(oe(_)){this._a=_[0],this._b=_[1],this._c=_[2],this._d=_[3];return}this._a=_,this._b=E,this._c=z,this._d=$}un.prototype={transform:function(_,E){return this._transform(_.clone(),E)},_transform:function(_,E){return E=E||1,_.x=E*(this._a*_.x+this._b),_.y=E*(this._c*_.y+this._d),_},untransform:function(_,E){return E=E||1,new wt((_.x/E-this._b)/this._a,(_.y/E-this._d)/this._c)}};function Qi(_,E,z,$){return new un(_,E,z,$)}var $e=P({},Ui,{code:"EPSG:3857",projection:_i,transformation:(function(){var _=.5/(Math.PI*_i.R);return Qi(_,.5,-_,.5)})()}),lt=P({},$e,{code:"EPSG:900913"});function vt(_){return document.createElementNS("http://www.w3.org/2000/svg",_)}function ai(_,E){var z="",$,te,Ce,dt,Vt,Qt;for($=0,Ce=_.length;$<Ce;$++){for(Vt=_[$],te=0,dt=Vt.length;te<dt;te++)Qt=Vt[te],z+=(te?"L":"M")+Qt.x+" "+Qt.y;z+=E?ve.svg?"z":"x":""}return z||"M0 0"}var ii=document.documentElement.style,ci="ActiveXObject"in window,Ei=ci&&!document.addEventListener,bi="msLaunchUri"in navigator&&!("documentMode"in document),ui=Fe("webkit"),vi=Fe("android"),sn=Fe("android 2")||Fe("android 3"),Hi=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),$i=vi&&Fe("Google")&&Hi<537&&!("AudioNode"in window),fn=!!window.opera,Nn=!bi&&Fe("chrome"),br=Fe("gecko")&&!ui&&!fn&&!ci,Xn=!Nn&&Fe("safari"),is=Fe("phantom"),Qn="OTransition"in ii,Wr=navigator.platform.indexOf("Win")===0,ns=ci&&"transition"in ii,Dr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!sn,ds="MozPerspective"in ii,Rt=!window.L_DISABLE_3D&&(ns||Dr||ds)&&!Qn&&!is,Dt=typeof orientation<"u"||Fe("mobile"),en=Dt&&ui,Dn=Dt&&Dr,ir=!window.PointerEvent&&window.MSPointerEvent,jn=!!(window.PointerEvent||ir),rs="ontouchstart"in window||!!window.TouchEvent,Os=!window.L_NO_TOUCH&&(rs||jn),fs=Dt&&fn,fo=Dt&&br,kt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,ls=(function(){var _=!1;try{var E=Object.defineProperty({},"passive",{get:function(){_=!0}});window.addEventListener("testPassiveEventSupport",ee,E),window.removeEventListener("testPassiveEventSupport",ee,E)}catch{}return _})(),Ss=(function(){return!!document.createElement("canvas").getContext})(),wo=!!(document.createElementNS&&vt("svg").createSVGRect),Xe=!!wo&&(function(){var _=document.createElement("div");return _.innerHTML="<svg/>",(_.firstChild&&_.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Q=!wo&&(function(){try{var _=document.createElement("div");_.innerHTML='<v:shape adj="1"/>';var E=_.firstChild;return E.style.behavior="url(#default#VML)",E&&typeof E.adj=="object"}catch{return!1}})(),ne=navigator.platform.indexOf("Mac")===0,be=navigator.platform.indexOf("Linux")===0;function Fe(_){return navigator.userAgent.toLowerCase().indexOf(_)>=0}var ve={ie:ci,ielt9:Ei,edge:bi,webkit:ui,android:vi,android23:sn,androidStock:$i,opera:fn,chrome:Nn,gecko:br,safari:Xn,phantom:is,opera12:Qn,win:Wr,ie3d:ns,webkit3d:Dr,gecko3d:ds,any3d:Rt,mobile:Dt,mobileWebkit:en,mobileWebkit3d:Dn,msPointer:ir,pointer:jn,touch:Os,touchNative:rs,mobileOpera:fs,mobileGecko:fo,retina:kt,passiveEvents:ls,canvas:Ss,svg:wo,vml:Q,inlineSvg:Xe,mac:ne,linux:be},Le=ve.msPointer?"MSPointerDown":"pointerdown",rt=ve.msPointer?"MSPointerMove":"pointermove",je=ve.msPointer?"MSPointerUp":"pointerup",st=ve.msPointer?"MSPointerCancel":"pointercancel",Nt={touchstart:Le,touchmove:rt,touchend:je,touchcancel:st},Ct={touchstart:ss,touchmove:Mr,touchend:Mr,touchcancel:Mr},wi={},qi=!1;function Ki(_,E,z){return E==="touchstart"&&An(),Ct[E]?(z=Ct[E].bind(this,z),_.addEventListener(Nt[E],z,!1),z):(console.warn("wrong event specified:",E),ee)}function pn(_,E,z){if(!Nt[E]){console.warn("wrong event specified:",E);return}_.removeEventListener(Nt[E],z,!1)}function Ji(_){wi[_.pointerId]=_}function Mn(_){wi[_.pointerId]&&(wi[_.pointerId]=_)}function er(_){delete wi[_.pointerId]}function An(){qi||(document.addEventListener(Le,Ji,!0),document.addEventListener(rt,Mn,!0),document.addEventListener(je,er,!0),document.addEventListener(st,er,!0),qi=!0)}function Mr(_,E){if(E.pointerType!==(E.MSPOINTER_TYPE_MOUSE||"mouse")){E.touches=[];for(var z in wi)E.touches.push(wi[z]);E.changedTouches=[E],_(E)}}function ss(_,E){E.MSPOINTER_TYPE_TOUCH&&E.pointerType===E.MSPOINTER_TYPE_TOUCH&&ms(E),Mr(_,E)}function zr(_){var E={},z,$;for($ in _)z=_[$],E[$]=z&&z.bind?z.bind(_):z;return _=E,E.type="dblclick",E.detail=2,E.isTrusted=!1,E._simulated=!0,E}var rr=200;function Zn(_,E){_.addEventListener("dblclick",E);var z=0,$;function te(Ce){if(Ce.detail!==1){$=Ce.detail;return}if(!(Ce.pointerType==="mouse"||Ce.sourceCapabilities&&!Ce.sourceCapabilities.firesTouchEvents)){var dt=Fo(Ce);if(!(dt.some(function(Qt){return Qt instanceof HTMLLabelElement&&Qt.attributes.for})&&!dt.some(function(Qt){return Qt instanceof HTMLInputElement||Qt instanceof HTMLSelectElement}))){var Vt=Date.now();Vt-z<=rr?($++,$===2&&E(zr(Ce))):$=1,z=Vt}}}return _.addEventListener("click",te),{dblclick:E,simDblclick:te}}function kr(_,E){_.removeEventListener("dblclick",E.dblclick),_.removeEventListener("click",E.simDblclick)}var Rr=Ia(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Gn=Ia(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ps=Gn==="webkitTransition"||Gn==="OTransition"?Gn+"End":"transitionend";function gs(_){return typeof _=="string"?document.getElementById(_):_}function zs(_,E){var z=_.style[E]||_.currentStyle&&_.currentStyle[E];if((!z||z==="auto")&&document.defaultView){var $=document.defaultView.getComputedStyle(_,null);z=$?$[E]:null}return z==="auto"?null:z}function Hn(_,E,z){var $=document.createElement(_);return $.className=E||"",z&&z.appendChild($),$}function sr(_){var E=_.parentNode;E&&E.removeChild(_)}function Wo(_){for(;_.firstChild;)_.removeChild(_.firstChild)}function oa(_){var E=_.parentNode;E&&E.lastChild!==_&&E.appendChild(_)}function Xs(_){var E=_.parentNode;E&&E.firstChild!==_&&E.insertBefore(_,E.firstChild)}function aa(_,E){if(_.classList!==void 0)return _.classList.contains(E);var z=ks(_);return z.length>0&&new RegExp("(^|\\s)"+E+"(\\s|$)").test(z)}function Kn(_,E){if(_.classList!==void 0)for(var z=se(E),$=0,te=z.length;$<te;$++)_.classList.add(z[$]);else if(!aa(_,E)){var Ce=ks(_);po(_,(Ce?Ce+" ":"")+E)}}function Br(_,E){_.classList!==void 0?_.classList.remove(E):po(_,pe((" "+ks(_)+" ").replace(" "+E+" "," ")))}function po(_,E){_.className.baseVal===void 0?_.className=E:_.className.baseVal=E}function ks(_){return _.correspondingElement&&(_=_.correspondingElement),_.className.baseVal===void 0?_.className:_.className.baseVal}function Ls(_,E){"opacity"in _.style?_.style.opacity=E:"filter"in _.style&&oo(_,E)}function oo(_,E){var z=!1,$="DXImageTransform.Microsoft.Alpha";try{z=_.filters.item($)}catch{if(E===1)return}E=Math.round(E*100),z?(z.Enabled=E!==100,z.Opacity=E):_.style.filter+=" progid:"+$+"(opacity="+E+")"}function Ia(_){for(var E=document.documentElement.style,z=0;z<_.length;z++)if(_[z]in E)return _[z];return!1}function Vo(_,E,z){var $=E||new wt(0,0);_.style[Rr]=(ve.ie3d?"translate("+$.x+"px,"+$.y+"px)":"translate3d("+$.x+"px,"+$.y+"px,0)")+(z?" scale("+z+")":"")}function Or(_,E){_._leaflet_pos=E,ve.any3d?Vo(_,E):(_.style.left=E.x+"px",_.style.top=E.y+"px")}function Vs(_){return _._leaflet_pos||new wt(0,0)}var mo,ao,js;if("onselectstart"in document)mo=function(){In(window,"selectstart",ms)},ao=function(){pr(window,"selectstart",ms)};else{var _o=Ia(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);mo=function(){if(_o){var _=document.documentElement.style;js=_[_o],_[_o]="none"}},ao=function(){_o&&(document.documentElement.style[_o]=js,js=void 0)}}function go(){In(window,"dragstart",ms)}function To(){pr(window,"dragstart",ms)}var ko,_t;function Jt(_){for(;_.tabIndex===-1;)_=_.parentNode;_.style&&(Pi(),ko=_,_t=_.style.outlineStyle,_.style.outlineStyle="none",In(window,"keydown",Pi))}function Pi(){ko&&(ko.style.outlineStyle=_t,ko=void 0,_t=void 0,pr(window,"keydown",Pi))}function Fn(_){do _=_.parentNode;while((!_.offsetWidth||!_.offsetHeight)&&_!==document.body);return _}function xr(_){var E=_.getBoundingClientRect();return{x:E.width/_.offsetWidth||1,y:E.height/_.offsetHeight||1,boundingClientRect:E}}var Es={__proto__:null,TRANSFORM:Rr,TRANSITION:Gn,TRANSITION_END:ps,get:gs,getStyle:zs,create:Hn,remove:sr,empty:Wo,toFront:oa,toBack:Xs,hasClass:aa,addClass:Kn,removeClass:Br,setClass:po,getClass:ks,setOpacity:Ls,testProp:Ia,setTransform:Vo,setPosition:Or,getPosition:Vs,get disableTextSelection(){return mo},get enableTextSelection(){return ao},disableImageDrag:go,enableImageDrag:To,preventOutline:Jt,restoreOutline:Pi,getSizedParentNode:Fn,getScale:xr};function In(_,E,z,$){if(E&&typeof E=="object")for(var te in E)Ps(_,te,E[te],z);else{E=se(E);for(var Ce=0,dt=E.length;Ce<dt;Ce++)Ps(_,E[Ce],z,$)}return this}var fr="_leaflet_events";function pr(_,E,z,$){if(arguments.length===1)Js(_),delete _[fr];else if(E&&typeof E=="object")for(var te in E)Pa(_,te,E[te],z);else if(E=se(E),arguments.length===2)Js(_,function(Vt){return ge(E,Vt)!==-1});else for(var Ce=0,dt=E.length;Ce<dt;Ce++)Pa(_,E[Ce],z,$);return this}function Js(_,E){for(var z in _[fr]){var $=z.split(/\d/)[0];(!E||E($))&&Pa(_,$,null,null,z)}}var Pn={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ps(_,E,z,$){var te=E+j(z)+($?"_"+j($):"");if(_[fr]&&_[fr][te])return this;var Ce=function(Vt){return z.call($||_,Vt||window.event)},dt=Ce;!ve.touchNative&&ve.pointer&&E.indexOf("touch")===0?Ce=Ki(_,E,Ce):ve.touch&&E==="dblclick"?Ce=Zn(_,Ce):"addEventListener"in _?E==="touchstart"||E==="touchmove"||E==="wheel"||E==="mousewheel"?_.addEventListener(Pn[E]||E,Ce,ve.passiveEvents?{passive:!1}:!1):E==="mouseenter"||E==="mouseleave"?(Ce=function(Vt){Vt=Vt||window.event,Ke(_,Vt)&&dt(Vt)},_.addEventListener(Pn[E],Ce,!1)):_.addEventListener(E,dt,!1):_.attachEvent("on"+E,Ce),_[fr]=_[fr]||{},_[fr][te]=Ce}function Pa(_,E,z,$,te){te=te||E+j(z)+($?"_"+j($):"");var Ce=_[fr]&&_[fr][te];if(!Ce)return this;!ve.touchNative&&ve.pointer&&E.indexOf("touch")===0?pn(_,E,Ce):ve.touch&&E==="dblclick"?kr(_,Ce):"removeEventListener"in _?_.removeEventListener(Pn[E]||E,Ce,!1):_.detachEvent("on"+E,Ce),_[fr][te]=null}function la(_){return _.stopPropagation?_.stopPropagation():_.originalEvent?_.originalEvent._stopped=!0:_.cancelBubble=!0,this}function jo(_){return Ps(_,"wheel",la),this}function Qs(_){return In(_,"mousedown touchstart dblclick contextmenu",la),_._leaflet_disable_click=!0,this}function ms(_){return _.preventDefault?_.preventDefault():_.returnValue=!1,this}function Rn(_){return ms(_),la(_),this}function Fo(_){if(_.composedPath)return _.composedPath();for(var E=[],z=_.target;z;)E.push(z),z=z.parentNode;return E}function Ca(_,E){if(!E)return new wt(_.clientX,_.clientY);var z=xr(E),$=z.boundingClientRect;return new wt((_.clientX-$.left)/z.x-E.clientLeft,(_.clientY-$.top)/z.y-E.clientTop)}var ca=ve.linux&&ve.chrome?window.devicePixelRatio:ve.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Qa(_){return ve.edge?_.wheelDeltaY/2:_.deltaY&&_.deltaMode===0?-_.deltaY/ca:_.deltaY&&_.deltaMode===1?-_.deltaY*20:_.deltaY&&_.deltaMode===2?-_.deltaY*60:_.deltaX||_.deltaZ?0:_.wheelDelta?(_.wheelDeltaY||_.wheelDelta)/2:_.detail&&Math.abs(_.detail)<32765?-_.detail*20:_.detail?_.detail/-32765*60:0}function Ke(_,E){var z=E.relatedTarget;if(!z)return!0;try{for(;z&&z!==_;)z=z.parentNode}catch{return!1}return z!==_}var Mt={__proto__:null,on:In,off:pr,stopPropagation:la,disableScrollPropagation:jo,disableClickPropagation:Qs,preventDefault:ms,stop:Rn,getPropagationPath:Fo,getMousePosition:Ca,getWheelDelta:Qa,isExternalTarget:Ke,addListener:In,removeListener:pr},Ai=si.extend({run:function(_,E,z,$){this.stop(),this._el=_,this._inProgress=!0,this._duration=z||.25,this._easeOutPower=1/Math.max($||.5,.2),this._startPos=Vs(_),this._offset=E.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Oe(this._animate,this),this._step()},_step:function(_){var E=+new Date-this._startTime,z=this._duration*1e3;E<z?this._runFrame(this._easeOut(E/z),_):(this._runFrame(1),this._complete())},_runFrame:function(_,E){var z=this._startPos.add(this._offset.multiplyBy(_));E&&z._round(),Or(this._el,z),this.fire("step")},_complete:function(){He(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(_){return 1-Math.pow(1-_,this._easeOutPower)}}),Ii=si.extend({options:{crs:$e,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(_,E){E=he(this,E),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(_),this._initLayout(),this._onResize=k(this._onResize,this),this._initEvents(),E.maxBounds&&this.setMaxBounds(E.maxBounds),E.zoom!==void 0&&(this._zoom=this._limitZoom(E.zoom)),E.center&&E.zoom!==void 0&&this.setView(Pt(E.center),E.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Gn&&ve.any3d&&!ve.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),In(this._proxy,ps,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(_,E,z){if(E=E===void 0?this._zoom:this._limitZoom(E),_=this._limitCenter(Pt(_),E,this.options.maxBounds),z=z||{},this._stop(),this._loaded&&!z.reset&&z!==!0){z.animate!==void 0&&(z.zoom=P({animate:z.animate},z.zoom),z.pan=P({animate:z.animate,duration:z.duration},z.pan));var $=this._zoom!==E?this._tryAnimatedZoom&&this._tryAnimatedZoom(_,E,z.zoom):this._tryAnimatedPan(_,z.pan);if($)return clearTimeout(this._sizeTimer),this}return this._resetView(_,E,z.pan&&z.pan.noMoveStart),this},setZoom:function(_,E){return this._loaded?this.setView(this.getCenter(),_,{zoom:E}):(this._zoom=_,this)},zoomIn:function(_,E){return _=_||(ve.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+_,E)},zoomOut:function(_,E){return _=_||(ve.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-_,E)},setZoomAround:function(_,E,z){var $=this.getZoomScale(E),te=this.getSize().divideBy(2),Ce=_ instanceof wt?_:this.latLngToContainerPoint(_),dt=Ce.subtract(te).multiplyBy(1-1/$),Vt=this.containerPointToLatLng(te.add(dt));return this.setView(Vt,E,{zoom:z})},_getBoundsCenterZoom:function(_,E){E=E||{},_=_.getBounds?_.getBounds():an(_);var z=Ti(E.paddingTopLeft||E.padding||[0,0]),$=Ti(E.paddingBottomRight||E.padding||[0,0]),te=this.getBoundsZoom(_,!1,z.add($));if(te=typeof E.maxZoom=="number"?Math.min(E.maxZoom,te):te,te===1/0)return{center:_.getCenter(),zoom:te};var Ce=$.subtract(z).divideBy(2),dt=this.project(_.getSouthWest(),te),Vt=this.project(_.getNorthEast(),te),Qt=this.unproject(dt.add(Vt).divideBy(2).add(Ce),te);return{center:Qt,zoom:te}},fitBounds:function(_,E){if(_=an(_),!_.isValid())throw new Error("Bounds are not valid.");var z=this._getBoundsCenterZoom(_,E);return this.setView(z.center,z.zoom,E)},fitWorld:function(_){return this.fitBounds([[-90,-180],[90,180]],_)},panTo:function(_,E){return this.setView(_,this._zoom,{pan:E})},panBy:function(_,E){if(_=Ti(_).round(),E=E||{},!_.x&&!_.y)return this.fire("moveend");if(E.animate!==!0&&!this.getSize().contains(_))return this._resetView(this.unproject(this.project(this.getCenter()).add(_)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Ai,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),E.noMoveStart||this.fire("movestart"),E.animate!==!1){Kn(this._mapPane,"leaflet-pan-anim");var z=this._getMapPanePos().subtract(_).round();this._panAnim.run(this._mapPane,z,E.duration||.25,E.easeLinearity)}else this._rawPanBy(_),this.fire("move").fire("moveend");return this},flyTo:function(_,E,z){if(z=z||{},z.animate===!1||!ve.any3d)return this.setView(_,E,z);this._stop();var $=this.project(this.getCenter()),te=this.project(_),Ce=this.getSize(),dt=this._zoom;_=Pt(_),E=E===void 0?dt:E;var Vt=Math.max(Ce.x,Ce.y),Qt=Vt*this.getZoomScale(dt,E),Li=te.distanceTo($)||1,mn=1.42,$n=mn*mn;function _r(Hs){var yu=Hs?-1:1,ef=Hs?Qt:Vt,tf=Qt*Qt-Vt*Vt+yu*$n*$n*Li*Li,Dl=2*ef*$n*Li,hh=tf/Dl,Jh=Math.sqrt(hh*hh+1)-hh,Ip=Jh<1e-9?-18:Math.log(Jh);return Ip}function Ro(Hs){return(Math.exp(Hs)-Math.exp(-Hs))/2}function lo(Hs){return(Math.exp(Hs)+Math.exp(-Hs))/2}function Bo(Hs){return Ro(Hs)/lo(Hs)}var Jo=_r(0);function Ll(Hs){return Vt*(lo(Jo)/lo(Jo+mn*Hs))}function Qd(Hs){return Vt*(lo(Jo)*Bo(Jo+mn*Hs)-Ro(Jo))/$n}function Cc(Hs){return 1-Math.pow(1-Hs,1.5)}var uh=Date.now(),_u=(_r(1)-Jo)/mn,Yh=z.duration?1e3*z.duration:1e3*_u*.8;function gu(){var Hs=(Date.now()-uh)/Yh,yu=Cc(Hs)*_u;Hs<=1?(this._flyToFrame=Oe(gu,this),this._move(this.unproject($.add(te.subtract($).multiplyBy(Qd(yu)/Li)),dt),this.getScaleZoom(Vt/Ll(yu),dt),{flyTo:!0})):this._move(_,E)._moveEnd(!0)}return this._moveStart(!0,z.noMoveStart),gu.call(this),this},flyToBounds:function(_,E){var z=this._getBoundsCenterZoom(_,E);return this.flyTo(z.center,z.zoom,E)},setMaxBounds:function(_){return _=an(_),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),_.isValid()?(this.options.maxBounds=_,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(_){var E=this.options.minZoom;return this.options.minZoom=_,this._loaded&&E!==_&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(_):this},setMaxZoom:function(_){var E=this.options.maxZoom;return this.options.maxZoom=_,this._loaded&&E!==_&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(_):this},panInsideBounds:function(_,E){this._enforcingBounds=!0;var z=this.getCenter(),$=this._limitCenter(z,this._zoom,an(_));return z.equals($)||this.panTo($,E),this._enforcingBounds=!1,this},panInside:function(_,E){E=E||{};var z=Ti(E.paddingTopLeft||E.padding||[0,0]),$=Ti(E.paddingBottomRight||E.padding||[0,0]),te=this.project(this.getCenter()),Ce=this.project(_),dt=this.getPixelBounds(),Vt=ki([dt.min.add(z),dt.max.subtract($)]),Qt=Vt.getSize();if(!Vt.contains(Ce)){this._enforcingBounds=!0;var Li=Ce.subtract(Vt.getCenter()),mn=Vt.extend(Ce).getSize().subtract(Qt);te.x+=Li.x<0?-mn.x:mn.x,te.y+=Li.y<0?-mn.y:mn.y,this.panTo(this.unproject(te),E),this._enforcingBounds=!1}return this},invalidateSize:function(_){if(!this._loaded)return this;_=P({animate:!1,pan:!0},_===!0?{animate:!0}:_);var E=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var z=this.getSize(),$=E.divideBy(2).round(),te=z.divideBy(2).round(),Ce=$.subtract(te);return!Ce.x&&!Ce.y?this:(_.animate&&_.pan?this.panBy(Ce):(_.pan&&this._rawPanBy(Ce),this.fire("move"),_.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(k(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:E,newSize:z}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(_){if(_=this._locateOptions=P({timeout:1e4,watch:!1},_),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var E=k(this._handleGeolocationResponse,this),z=k(this._handleGeolocationError,this);return _.watch?this._locationWatchId=navigator.geolocation.watchPosition(E,z,_):navigator.geolocation.getCurrentPosition(E,z,_),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(_){if(this._container._leaflet_id){var E=_.code,z=_.message||(E===1?"permission denied":E===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:E,message:"Geolocation error: "+z+"."})}},_handleGeolocationResponse:function(_){if(this._container._leaflet_id){var E=_.coords.latitude,z=_.coords.longitude,$=new mt(E,z),te=$.toBounds(_.coords.accuracy*2),Ce=this._locateOptions;if(Ce.setView){var dt=this.getBoundsZoom(te);this.setView($,Ce.maxZoom?Math.min(dt,Ce.maxZoom):dt)}var Vt={latlng:$,bounds:te,timestamp:_.timestamp};for(var Qt in _.coords)typeof _.coords[Qt]=="number"&&(Vt[Qt]=_.coords[Qt]);this.fire("locationfound",Vt)}},addHandler:function(_,E){if(!E)return this;var z=this[_]=new E(this);return this._handlers.push(z),this.options[_]&&z.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),sr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(He(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var _;for(_ in this._layers)this._layers[_].remove();for(_ in this._panes)sr(this._panes[_]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(_,E){var z="leaflet-pane"+(_?" leaflet-"+_.replace("Pane","")+"-pane":""),$=Hn("div",z,E||this._mapPane);return _&&(this._panes[_]=$),$},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var _=this.getPixelBounds(),E=this.unproject(_.getBottomLeft()),z=this.unproject(_.getTopRight());return new dn(E,z)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(_,E,z){_=an(_),z=Ti(z||[0,0]);var $=this.getZoom()||0,te=this.getMinZoom(),Ce=this.getMaxZoom(),dt=_.getNorthWest(),Vt=_.getSouthEast(),Qt=this.getSize().subtract(z),Li=ki(this.project(Vt,$),this.project(dt,$)).getSize(),mn=ve.any3d?this.options.zoomSnap:1,$n=Qt.x/Li.x,_r=Qt.y/Li.y,Ro=E?Math.max($n,_r):Math.min($n,_r);return $=this.getScaleZoom(Ro,$),mn&&($=Math.round($/(mn/100))*(mn/100),$=E?Math.ceil($/mn)*mn:Math.floor($/mn)*mn),Math.max(te,Math.min(Ce,$))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new wt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(_,E){var z=this._getTopLeftPoint(_,E);return new di(z,z.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(_){return this.options.crs.getProjectedBounds(_===void 0?this.getZoom():_)},getPane:function(_){return typeof _=="string"?this._panes[_]:_},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(_,E){var z=this.options.crs;return E=E===void 0?this._zoom:E,z.scale(_)/z.scale(E)},getScaleZoom:function(_,E){var z=this.options.crs;E=E===void 0?this._zoom:E;var $=z.zoom(_*z.scale(E));return isNaN($)?1/0:$},project:function(_,E){return E=E===void 0?this._zoom:E,this.options.crs.latLngToPoint(Pt(_),E)},unproject:function(_,E){return E=E===void 0?this._zoom:E,this.options.crs.pointToLatLng(Ti(_),E)},layerPointToLatLng:function(_){var E=Ti(_).add(this.getPixelOrigin());return this.unproject(E)},latLngToLayerPoint:function(_){var E=this.project(Pt(_))._round();return E._subtract(this.getPixelOrigin())},wrapLatLng:function(_){return this.options.crs.wrapLatLng(Pt(_))},wrapLatLngBounds:function(_){return this.options.crs.wrapLatLngBounds(an(_))},distance:function(_,E){return this.options.crs.distance(Pt(_),Pt(E))},containerPointToLayerPoint:function(_){return Ti(_).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(_){return Ti(_).add(this._getMapPanePos())},containerPointToLatLng:function(_){var E=this.containerPointToLayerPoint(Ti(_));return this.layerPointToLatLng(E)},latLngToContainerPoint:function(_){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Pt(_)))},mouseEventToContainerPoint:function(_){return Ca(_,this._container)},mouseEventToLayerPoint:function(_){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(_))},mouseEventToLatLng:function(_){return this.layerPointToLatLng(this.mouseEventToLayerPoint(_))},_initContainer:function(_){var E=this._container=gs(_);if(E){if(E._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");In(E,"scroll",this._onScroll,this),this._containerId=j(E)},_initLayout:function(){var _=this._container;this._fadeAnimated=this.options.fadeAnimation&&ve.any3d,Kn(_,"leaflet-container"+(ve.touch?" leaflet-touch":"")+(ve.retina?" leaflet-retina":"")+(ve.ielt9?" leaflet-oldie":"")+(ve.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var E=zs(_,"position");E!=="absolute"&&E!=="relative"&&E!=="fixed"&&E!=="sticky"&&(_.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var _=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Or(this._mapPane,new wt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Kn(_.markerPane,"leaflet-zoom-hide"),Kn(_.shadowPane,"leaflet-zoom-hide"))},_resetView:function(_,E,z){Or(this._mapPane,new wt(0,0));var $=!this._loaded;this._loaded=!0,E=this._limitZoom(E),this.fire("viewprereset");var te=this._zoom!==E;this._moveStart(te,z)._move(_,E)._moveEnd(te),this.fire("viewreset"),$&&this.fire("load")},_moveStart:function(_,E){return _&&this.fire("zoomstart"),E||this.fire("movestart"),this},_move:function(_,E,z,$){E===void 0&&(E=this._zoom);var te=this._zoom!==E;return this._zoom=E,this._lastCenter=_,this._pixelOrigin=this._getNewPixelOrigin(_),$?z&&z.pinch&&this.fire("zoom",z):((te||z&&z.pinch)&&this.fire("zoom",z),this.fire("move",z)),this},_moveEnd:function(_){return _&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return He(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(_){Or(this._mapPane,this._getMapPanePos().subtract(_))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(_){this._targets={},this._targets[j(this._container)]=this;var E=_?pr:In;E(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&E(window,"resize",this._onResize,this),ve.any3d&&this.options.transform3DLimit&&(_?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){He(this._resizeRequest),this._resizeRequest=Oe(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var _=this._getMapPanePos();Math.max(Math.abs(_.x),Math.abs(_.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(_,E){for(var z=[],$,te=E==="mouseout"||E==="mouseover",Ce=_.target||_.srcElement,dt=!1;Ce;){if($=this._targets[j(Ce)],$&&(E==="click"||E==="preclick")&&this._draggableMoved($)){dt=!0;break}if($&&$.listens(E,!0)&&(te&&!Ke(Ce,_)||(z.push($),te))||Ce===this._container)break;Ce=Ce.parentNode}return!z.length&&!dt&&!te&&this.listens(E,!0)&&(z=[this]),z},_isClickDisabled:function(_){for(;_&&_!==this._container;){if(_._leaflet_disable_click)return!0;_=_.parentNode}},_handleDOMEvent:function(_){var E=_.target||_.srcElement;if(!(!this._loaded||E._leaflet_disable_events||_.type==="click"&&this._isClickDisabled(E))){var z=_.type;z==="mousedown"&&Jt(E),this._fireDOMEvent(_,z)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(_,E,z){if(_.type==="click"){var $=P({},_);$.type="preclick",this._fireDOMEvent($,$.type,z)}var te=this._findEventTargets(_,E);if(z){for(var Ce=[],dt=0;dt<z.length;dt++)z[dt].listens(E,!0)&&Ce.push(z[dt]);te=Ce.concat(te)}if(te.length){E==="contextmenu"&&ms(_);var Vt=te[0],Qt={originalEvent:_};if(_.type!=="keypress"&&_.type!=="keydown"&&_.type!=="keyup"){var Li=Vt.getLatLng&&(!Vt._radius||Vt._radius<=10);Qt.containerPoint=Li?this.latLngToContainerPoint(Vt.getLatLng()):this.mouseEventToContainerPoint(_),Qt.layerPoint=this.containerPointToLayerPoint(Qt.containerPoint),Qt.latlng=Li?Vt.getLatLng():this.layerPointToLatLng(Qt.layerPoint)}for(dt=0;dt<te.length;dt++)if(te[dt].fire(E,Qt,!0),Qt.originalEvent._stopped||te[dt].options.bubblingMouseEvents===!1&&ge(this._mouseEvents,E)!==-1)return}},_draggableMoved:function(_){return _=_.dragging&&_.dragging.enabled()?_:this,_.dragging&&_.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var _=0,E=this._handlers.length;_<E;_++)this._handlers[_].disable()},whenReady:function(_,E){return this._loaded?_.call(E||this,{target:this}):this.on("load",_,E),this},_getMapPanePos:function(){return Vs(this._mapPane)||new wt(0,0)},_moved:function(){var _=this._getMapPanePos();return _&&!_.equals([0,0])},_getTopLeftPoint:function(_,E){var z=_&&E!==void 0?this._getNewPixelOrigin(_,E):this.getPixelOrigin();return z.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(_,E){var z=this.getSize()._divideBy(2);return this.project(_,E)._subtract(z)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(_,E,z){var $=this._getNewPixelOrigin(z,E);return this.project(_,E)._subtract($)},_latLngBoundsToNewLayerBounds:function(_,E,z){var $=this._getNewPixelOrigin(z,E);return ki([this.project(_.getSouthWest(),E)._subtract($),this.project(_.getNorthWest(),E)._subtract($),this.project(_.getSouthEast(),E)._subtract($),this.project(_.getNorthEast(),E)._subtract($)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(_){return this.latLngToLayerPoint(_).subtract(this._getCenterLayerPoint())},_limitCenter:function(_,E,z){if(!z)return _;var $=this.project(_,E),te=this.getSize().divideBy(2),Ce=new di($.subtract(te),$.add(te)),dt=this._getBoundsOffset(Ce,z,E);return Math.abs(dt.x)<=1&&Math.abs(dt.y)<=1?_:this.unproject($.add(dt),E)},_limitOffset:function(_,E){if(!E)return _;var z=this.getPixelBounds(),$=new di(z.min.add(_),z.max.add(_));return _.add(this._getBoundsOffset($,E))},_getBoundsOffset:function(_,E,z){var $=ki(this.project(E.getNorthEast(),z),this.project(E.getSouthWest(),z)),te=$.min.subtract(_.min),Ce=$.max.subtract(_.max),dt=this._rebound(te.x,-Ce.x),Vt=this._rebound(te.y,-Ce.y);return new wt(dt,Vt)},_rebound:function(_,E){return _+E>0?Math.round(_-E)/2:Math.max(0,Math.ceil(_))-Math.max(0,Math.floor(E))},_limitZoom:function(_){var E=this.getMinZoom(),z=this.getMaxZoom(),$=ve.any3d?this.options.zoomSnap:1;return $&&(_=Math.round(_/$)*$),Math.max(E,Math.min(z,_))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Br(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(_,E){var z=this._getCenterOffset(_)._trunc();return(E&&E.animate)!==!0&&!this.getSize().contains(z)?!1:(this.panBy(z,E),!0)},_createAnimProxy:function(){var _=this._proxy=Hn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(_),this.on("zoomanim",function(E){var z=Rr,$=this._proxy.style[z];Vo(this._proxy,this.project(E.center,E.zoom),this.getZoomScale(E.zoom,1)),$===this._proxy.style[z]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){sr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var _=this.getCenter(),E=this.getZoom();Vo(this._proxy,this.project(_,E),this.getZoomScale(E,1))},_catchTransitionEnd:function(_){this._animatingZoom&&_.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(_,E,z){if(this._animatingZoom)return!0;if(z=z||{},!this._zoomAnimated||z.animate===!1||this._nothingToAnimate()||Math.abs(E-this._zoom)>this.options.zoomAnimationThreshold)return!1;var $=this.getZoomScale(E),te=this._getCenterOffset(_)._divideBy(1-1/$);return z.animate!==!0&&!this.getSize().contains(te)?!1:(Oe(function(){this._moveStart(!0,z.noMoveStart||!1)._animateZoom(_,E,!0)},this),!0)},_animateZoom:function(_,E,z,$){this._mapPane&&(z&&(this._animatingZoom=!0,this._animateToCenter=_,this._animateToZoom=E,Kn(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:_,zoom:E,noUpdate:$}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(k(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Br(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Xr(_,E){return new Ii(_,E)}var Un=tt.extend({options:{position:"topright"},initialize:function(_){he(this,_)},getPosition:function(){return this.options.position},setPosition:function(_){var E=this._map;return E&&E.removeControl(this),this.options.position=_,E&&E.addControl(this),this},getContainer:function(){return this._container},addTo:function(_){this.remove(),this._map=_;var E=this._container=this.onAdd(_),z=this.getPosition(),$=_._controlCorners[z];return Kn(E,"leaflet-control"),z.indexOf("bottom")!==-1?$.insertBefore(E,$.firstChild):$.appendChild(E),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(sr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(_){this._map&&_&&_.screenX>0&&_.screenY>0&&this._map.getContainer().focus()}}),wr=function(_){return new Un(_)};Ii.include({addControl:function(_){return _.addTo(this),this},removeControl:function(_){return _.remove(),this},_initControlPos:function(){var _=this._controlCorners={},E="leaflet-",z=this._controlContainer=Hn("div",E+"control-container",this._container);function $(te,Ce){var dt=E+te+" "+E+Ce;_[te+Ce]=Hn("div",dt,z)}$("top","left"),$("top","right"),$("bottom","left"),$("bottom","right")},_clearControlPos:function(){for(var _ in this._controlCorners)sr(this._controlCorners[_]);sr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ys=Un.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(_,E,z,$){return z<$?-1:$<z?1:0}},initialize:function(_,E,z){he(this,z),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var $ in _)this._addLayer(_[$],$);for($ in E)this._addLayer(E[$],$,!0)},onAdd:function(_){this._initLayout(),this._update(),this._map=_,_.on("zoomend",this._checkDisabledLayers,this);for(var E=0;E<this._layers.length;E++)this._layers[E].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(_){return Un.prototype.addTo.call(this,_),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var _=0;_<this._layers.length;_++)this._layers[_].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(_,E){return this._addLayer(_,E),this._map?this._update():this},addOverlay:function(_,E){return this._addLayer(_,E,!0),this._map?this._update():this},removeLayer:function(_){_.off("add remove",this._onLayerChange,this);var E=this._getLayer(j(_));return E&&this._layers.splice(this._layers.indexOf(E),1),this._map?this._update():this},expand:function(){Kn(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var _=this._map.getSize().y-(this._container.offsetTop+50);return _<this._section.clientHeight?(Kn(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=_+"px"):Br(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Br(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var _="leaflet-control-layers",E=this._container=Hn("div",_),z=this.options.collapsed;E.setAttribute("aria-haspopup",!0),Qs(E),jo(E);var $=this._section=Hn("section",_+"-list");z&&(this._map.on("click",this.collapse,this),In(E,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var te=this._layersLink=Hn("a",_+"-toggle",E);te.href="#",te.title="Layers",te.setAttribute("role","button"),In(te,{keydown:function(Ce){Ce.keyCode===13&&this._expandSafely()},click:function(Ce){ms(Ce),this._expandSafely()}},this),z||this.expand(),this._baseLayersList=Hn("div",_+"-base",$),this._separator=Hn("div",_+"-separator",$),this._overlaysList=Hn("div",_+"-overlays",$),E.appendChild($)},_getLayer:function(_){for(var E=0;E<this._layers.length;E++)if(this._layers[E]&&j(this._layers[E].layer)===_)return this._layers[E]},_addLayer:function(_,E,z){this._map&&_.on("add remove",this._onLayerChange,this),this._layers.push({layer:_,name:E,overlay:z}),this.options.sortLayers&&this._layers.sort(k(function($,te){return this.options.sortFunction($.layer,te.layer,$.name,te.name)},this)),this.options.autoZIndex&&_.setZIndex&&(this._lastZIndex++,_.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Wo(this._baseLayersList),Wo(this._overlaysList),this._layerControlInputs=[];var _,E,z,$,te=0;for(z=0;z<this._layers.length;z++)$=this._layers[z],this._addItem($),E=E||$.overlay,_=_||!$.overlay,te+=$.overlay?0:1;return this.options.hideSingleBase&&(_=_&&te>1,this._baseLayersList.style.display=_?"":"none"),this._separator.style.display=E&&_?"":"none",this},_onLayerChange:function(_){this._handlingClick||this._update();var E=this._getLayer(j(_.target)),z=E.overlay?_.type==="add"?"overlayadd":"overlayremove":_.type==="add"?"baselayerchange":null;z&&this._map.fire(z,E)},_createRadioElement:function(_,E){var z='<input type="radio" class="leaflet-control-layers-selector" name="'+_+'"'+(E?' checked="checked"':"")+"/>",$=document.createElement("div");return $.innerHTML=z,$.firstChild},_addItem:function(_){var E=document.createElement("label"),z=this._map.hasLayer(_.layer),$;_.overlay?($=document.createElement("input"),$.type="checkbox",$.className="leaflet-control-layers-selector",$.defaultChecked=z):$=this._createRadioElement("leaflet-base-layers_"+j(this),z),this._layerControlInputs.push($),$.layerId=j(_.layer),In($,"click",this._onInputClick,this);var te=document.createElement("span");te.innerHTML=" "+_.name;var Ce=document.createElement("span");E.appendChild(Ce),Ce.appendChild($),Ce.appendChild(te);var dt=_.overlay?this._overlaysList:this._baseLayersList;return dt.appendChild(E),this._checkDisabledLayers(),E},_onInputClick:function(){if(!this._preventClick){var _=this._layerControlInputs,E,z,$=[],te=[];this._handlingClick=!0;for(var Ce=_.length-1;Ce>=0;Ce--)E=_[Ce],z=this._getLayer(E.layerId).layer,E.checked?$.push(z):E.checked||te.push(z);for(Ce=0;Ce<te.length;Ce++)this._map.hasLayer(te[Ce])&&this._map.removeLayer(te[Ce]);for(Ce=0;Ce<$.length;Ce++)this._map.hasLayer($[Ce])||this._map.addLayer($[Ce]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var _=this._layerControlInputs,E,z,$=this._map.getZoom(),te=_.length-1;te>=0;te--)E=_[te],z=this._getLayer(E.layerId).layer,E.disabled=z.options.minZoom!==void 0&&$<z.options.minZoom||z.options.maxZoom!==void 0&&$>z.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var _=this._section;this._preventClick=!0,In(_,"click",ms),this.expand();var E=this;setTimeout(function(){pr(_,"click",ms),E._preventClick=!1})}}),Kr=function(_,E,z){return new ys(_,E,z)},_s=Un.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(_){var E="leaflet-control-zoom",z=Hn("div",E+" leaflet-bar"),$=this.options;return this._zoomInButton=this._createButton($.zoomInText,$.zoomInTitle,E+"-in",z,this._zoomIn),this._zoomOutButton=this._createButton($.zoomOutText,$.zoomOutTitle,E+"-out",z,this._zoomOut),this._updateDisabled(),_.on("zoomend zoomlevelschange",this._updateDisabled,this),z},onRemove:function(_){_.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(_){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(_.shiftKey?3:1))},_zoomOut:function(_){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(_.shiftKey?3:1))},_createButton:function(_,E,z,$,te){var Ce=Hn("a",z,$);return Ce.innerHTML=_,Ce.href="#",Ce.title=E,Ce.setAttribute("role","button"),Ce.setAttribute("aria-label",E),Qs(Ce),In(Ce,"click",Rn),In(Ce,"click",te,this),In(Ce,"click",this._refocusOnMap,this),Ce},_updateDisabled:function(){var _=this._map,E="leaflet-disabled";Br(this._zoomInButton,E),Br(this._zoomOutButton,E),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||_._zoom===_.getMinZoom())&&(Kn(this._zoomOutButton,E),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||_._zoom===_.getMaxZoom())&&(Kn(this._zoomInButton,E),this._zoomInButton.setAttribute("aria-disabled","true"))}});Ii.mergeOptions({zoomControl:!0}),Ii.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new _s,this.addControl(this.zoomControl))});var yo=function(_){return new _s(_)},Po=Un.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(_){var E="leaflet-control-scale",z=Hn("div",E),$=this.options;return this._addScales($,E+"-line",z),_.on($.updateWhenIdle?"moveend":"move",this._update,this),_.whenReady(this._update,this),z},onRemove:function(_){_.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(_,E,z){_.metric&&(this._mScale=Hn("div",E,z)),_.imperial&&(this._iScale=Hn("div",E,z))},_update:function(){var _=this._map,E=_.getSize().y/2,z=_.distance(_.containerPointToLatLng([0,E]),_.containerPointToLatLng([this.options.maxWidth,E]));this._updateScales(z)},_updateScales:function(_){this.options.metric&&_&&this._updateMetric(_),this.options.imperial&&_&&this._updateImperial(_)},_updateMetric:function(_){var E=this._getRoundNum(_),z=E<1e3?E+" m":E/1e3+" km";this._updateScale(this._mScale,z,E/_)},_updateImperial:function(_){var E=_*3.2808399,z,$,te;E>5280?(z=E/5280,$=this._getRoundNum(z),this._updateScale(this._iScale,$+" mi",$/z)):(te=this._getRoundNum(E),this._updateScale(this._iScale,te+" ft",te/E))},_updateScale:function(_,E,z){_.style.width=Math.round(this.options.maxWidth*z)+"px",_.innerHTML=E},_getRoundNum:function(_){var E=Math.pow(10,(Math.floor(_)+"").length-1),z=_/E;return z=z>=10?10:z>=5?5:z>=3?3:z>=2?2:1,E*z}}),Cn=function(_){return new Po(_)},Co='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',So=Un.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ve.inlineSvg?Co+" ":"")+"Leaflet</a>"},initialize:function(_){he(this,_),this._attributions={}},onAdd:function(_){_.attributionControl=this,this._container=Hn("div","leaflet-control-attribution"),Qs(this._container);for(var E in _._layers)_._layers[E].getAttribution&&this.addAttribution(_._layers[E].getAttribution());return this._update(),_.on("layeradd",this._addAttribution,this),this._container},onRemove:function(_){_.off("layeradd",this._addAttribution,this)},_addAttribution:function(_){_.layer.getAttribution&&(this.addAttribution(_.layer.getAttribution()),_.layer.once("remove",function(){this.removeAttribution(_.layer.getAttribution())},this))},setPrefix:function(_){return this.options.prefix=_,this._update(),this},addAttribution:function(_){return _?(this._attributions[_]||(this._attributions[_]=0),this._attributions[_]++,this._update(),this):this},removeAttribution:function(_){return _?(this._attributions[_]&&(this._attributions[_]--,this._update()),this):this},_update:function(){if(this._map){var _=[];for(var E in this._attributions)this._attributions[E]&&_.push(E);var z=[];this.options.prefix&&z.push(this.options.prefix),_.length&&z.push(_.join(", ")),this._container.innerHTML=z.join(' <span aria-hidden="true">|</span> ')}}});Ii.mergeOptions({attributionControl:!0}),Ii.addInitHook(function(){this.options.attributionControl&&new So().addTo(this)});var Xo=function(_){return new So(_)};Un.Layers=ys,Un.Zoom=_s,Un.Scale=Po,Un.Attribution=So,wr.layers=Kr,wr.zoom=yo,wr.scale=Cn,wr.attribution=Xo;var Mi=tt.extend({initialize:function(_){this._map=_},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Mi.addTo=function(_,E){return _.addHandler(E,this),this};var va={Events:yt},Eo=ve.touch?"touchstart mousedown":"mousedown",Fs=si.extend({options:{clickTolerance:3},initialize:function(_,E,z,$){he(this,$),this._element=_,this._dragStartTarget=E||_,this._preventOutline=z},enable:function(){this._enabled||(In(this._dragStartTarget,Eo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Fs._dragging===this&&this.finishDrag(!0),pr(this._dragStartTarget,Eo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(_){if(this._enabled&&(this._moved=!1,!aa(this._element,"leaflet-zoom-anim"))){if(_.touches&&_.touches.length!==1){Fs._dragging===this&&this.finishDrag();return}if(!(Fs._dragging||_.shiftKey||_.which!==1&&_.button!==1&&!_.touches)&&(Fs._dragging=this,this._preventOutline&&Jt(this._element),go(),mo(),!this._moving)){this.fire("down");var E=_.touches?_.touches[0]:_,z=Fn(this._element);this._startPoint=new wt(E.clientX,E.clientY),this._startPos=Vs(this._element),this._parentScale=xr(z);var $=_.type==="mousedown";In(document,$?"mousemove":"touchmove",this._onMove,this),In(document,$?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(_){if(this._enabled){if(_.touches&&_.touches.length>1){this._moved=!0;return}var E=_.touches&&_.touches.length===1?_.touches[0]:_,z=new wt(E.clientX,E.clientY)._subtract(this._startPoint);!z.x&&!z.y||Math.abs(z.x)+Math.abs(z.y)<this.options.clickTolerance||(z.x/=this._parentScale.x,z.y/=this._parentScale.y,ms(_),this._moved||(this.fire("dragstart"),this._moved=!0,Kn(document.body,"leaflet-dragging"),this._lastTarget=_.target||_.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Kn(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(z),this._moving=!0,this._lastEvent=_,this._updatePosition())}},_updatePosition:function(){var _={originalEvent:this._lastEvent};this.fire("predrag",_),Or(this._element,this._newPos),this.fire("drag",_)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(_){Br(document.body,"leaflet-dragging"),this._lastTarget&&(Br(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),pr(document,"mousemove touchmove",this._onMove,this),pr(document,"mouseup touchend touchcancel",this._onUp,this),To(),ao();var E=this._moved&&this._moving;this._moving=!1,Fs._dragging=!1,E&&this.fire("dragend",{noInertia:_,distance:this._newPos.distanceTo(this._startPos)})}});function Ma(_,E,z){var $,te=[1,4,2,8],Ce,dt,Vt,Qt,Li,mn,$n,_r;for(Ce=0,mn=_.length;Ce<mn;Ce++)_[Ce]._code=fi(_[Ce],E);for(Vt=0;Vt<4;Vt++){for($n=te[Vt],$=[],Ce=0,mn=_.length,dt=mn-1;Ce<mn;dt=Ce++)Qt=_[Ce],Li=_[dt],Qt._code&$n?Li._code&$n||(_r=Qe(Li,Qt,$n,E,z),_r._code=fi(_r,E),$.push(_r)):(Li._code&$n&&(_r=Qe(Li,Qt,$n,E,z),_r._code=fi(_r,E),$.push(_r)),$.push(Qt));_=$}return _}function xa(_,E){var z,$,te,Ce,dt,Vt,Qt,Li,mn;if(!_||_.length===0)throw new Error("latlngs not passed");Bn(_)||(console.warn("latlngs are not flat! Only the first ring will be used"),_=_[0]);var $n=Pt([0,0]),_r=an(_),Ro=_r.getNorthWest().distanceTo(_r.getSouthWest())*_r.getNorthEast().distanceTo(_r.getNorthWest());Ro<1700&&($n=Oi(_));var lo=_.length,Bo=[];for(z=0;z<lo;z++){var Jo=Pt(_[z]);Bo.push(E.project(Pt([Jo.lat-$n.lat,Jo.lng-$n.lng])))}for(Vt=Qt=Li=0,z=0,$=lo-1;z<lo;$=z++)te=Bo[z],Ce=Bo[$],dt=te.y*Ce.x-Ce.y*te.x,Qt+=(te.x+Ce.x)*dt,Li+=(te.y+Ce.y)*dt,Vt+=dt*3;Vt===0?mn=Bo[0]:mn=[Qt/Vt,Li/Vt];var Ll=E.unproject(Ti(mn));return Pt([Ll.lat+$n.lat,Ll.lng+$n.lng])}function Oi(_){for(var E=0,z=0,$=0,te=0;te<_.length;te++){var Ce=Pt(_[te]);E+=Ce.lat,z+=Ce.lng,$++}return Pt([E/$,z/$])}var or={__proto__:null,clipPolygon:Ma,polygonCenter:xa,centroid:Oi};function ar(_,E){if(!E||!_.length)return _.slice();var z=E*E;return _=q(_,z),_=tr(_,z),_}function Yr(_,E,z){return Math.sqrt(vn(_,E,z,!0))}function ja(_,E,z){return vn(_,E,z)}function tr(_,E){var z=_.length,$=typeof Uint8Array<"u"?Uint8Array:Array,te=new $(z);te[0]=te[z-1]=1,ce(_,te,E,0,z-1);var Ce,dt=[];for(Ce=0;Ce<z;Ce++)te[Ce]&&dt.push(_[Ce]);return dt}function ce(_,E,z,$,te){var Ce=0,dt,Vt,Qt;for(Vt=$+1;Vt<=te-1;Vt++)Qt=vn(_[Vt],_[$],_[te],!0),Qt>Ce&&(dt=Vt,Ce=Qt);Ce>z&&(E[dt]=1,ce(_,E,z,$,dt),ce(_,E,z,dt,te))}function q(_,E){for(var z=[_[0]],$=1,te=0,Ce=_.length;$<Ce;$++)Zi(_[$],_[te])>E&&(z.push(_[$]),te=$);return te<Ce-1&&z.push(_[Ce-1]),z}var re;function Ne(_,E,z,$,te){var Ce=$?re:fi(_,z),dt=fi(E,z),Vt,Qt,Li;for(re=dt;;){if(!(Ce|dt))return[_,E];if(Ce&dt)return!1;Vt=Ce||dt,Qt=Qe(_,E,Vt,z,te),Li=fi(Qt,z),Vt===Ce?(_=Qt,Ce=Li):(E=Qt,dt=Li)}}function Qe(_,E,z,$,te){var Ce=E.x-_.x,dt=E.y-_.y,Vt=$.min,Qt=$.max,Li,mn;return z&8?(Li=_.x+Ce*(Qt.y-_.y)/dt,mn=Qt.y):z&4?(Li=_.x+Ce*(Vt.y-_.y)/dt,mn=Vt.y):z&2?(Li=Qt.x,mn=_.y+dt*(Qt.x-_.x)/Ce):z&1&&(Li=Vt.x,mn=_.y+dt*(Vt.x-_.x)/Ce),new wt(Li,mn,te)}function fi(_,E){var z=0;return _.x<E.min.x?z|=1:_.x>E.max.x&&(z|=2),_.y<E.min.y?z|=4:_.y>E.max.y&&(z|=8),z}function Zi(_,E){var z=E.x-_.x,$=E.y-_.y;return z*z+$*$}function vn(_,E,z,$){var te=E.x,Ce=E.y,dt=z.x-te,Vt=z.y-Ce,Qt=dt*dt+Vt*Vt,Li;return Qt>0&&(Li=((_.x-te)*dt+(_.y-Ce)*Vt)/Qt,Li>1?(te=z.x,Ce=z.y):Li>0&&(te+=dt*Li,Ce+=Vt*Li)),dt=_.x-te,Vt=_.y-Ce,$?dt*dt+Vt*Vt:new wt(te,Ce)}function Bn(_){return!oe(_[0])||typeof _[0][0]!="object"&&typeof _[0][0]<"u"}function Ir(_){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Bn(_)}function Pr(_,E){var z,$,te,Ce,dt,Vt,Qt,Li;if(!_||_.length===0)throw new Error("latlngs not passed");Bn(_)||(console.warn("latlngs are not flat! Only the first ring will be used"),_=_[0]);var mn=Pt([0,0]),$n=an(_),_r=$n.getNorthWest().distanceTo($n.getSouthWest())*$n.getNorthEast().distanceTo($n.getNorthWest());_r<1700&&(mn=Oi(_));var Ro=_.length,lo=[];for(z=0;z<Ro;z++){var Bo=Pt(_[z]);lo.push(E.project(Pt([Bo.lat-mn.lat,Bo.lng-mn.lng])))}for(z=0,$=0;z<Ro-1;z++)$+=lo[z].distanceTo(lo[z+1])/2;if($===0)Li=lo[0];else for(z=0,Ce=0;z<Ro-1;z++)if(dt=lo[z],Vt=lo[z+1],te=dt.distanceTo(Vt),Ce+=te,Ce>$){Qt=(Ce-$)/te,Li=[Vt.x-Qt*(Vt.x-dt.x),Vt.y-Qt*(Vt.y-dt.y)];break}var Jo=E.unproject(Ti(Li));return Pt([Jo.lat+mn.lat,Jo.lng+mn.lng])}var Bs={__proto__:null,simplify:ar,pointToSegmentDistance:Yr,closestPointOnSegment:ja,clipSegment:Ne,_getEdgeIntersection:Qe,_getBitCode:fi,_sqClosestPointOnSegment:vn,isFlat:Bn,_flat:Ir,polylineCenter:Pr},Ks={project:function(_){return new wt(_.lng,_.lat)},unproject:function(_){return new mt(_.y,_.x)},bounds:new di([-180,-90],[180,90])},Ko={R:6378137,R_MINOR:6356752314245179e-9,bounds:new di([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(_){var E=Math.PI/180,z=this.R,$=_.lat*E,te=this.R_MINOR/z,Ce=Math.sqrt(1-te*te),dt=Ce*Math.sin($),Vt=Math.tan(Math.PI/4-$/2)/Math.pow((1-dt)/(1+dt),Ce/2);return $=-z*Math.log(Math.max(Vt,1e-10)),new wt(_.lng*E*z,$)},unproject:function(_){for(var E=180/Math.PI,z=this.R,$=this.R_MINOR/z,te=Math.sqrt(1-$*$),Ce=Math.exp(-_.y/z),dt=Math.PI/2-2*Math.atan(Ce),Vt=0,Qt=.1,Li;Vt<15&&Math.abs(Qt)>1e-7;Vt++)Li=te*Math.sin(dt),Li=Math.pow((1-Li)/(1+Li),te/2),Qt=Math.PI/2-2*Math.atan(Ce*Li)-dt,dt+=Qt;return new mt(dt*E,_.x*E/z)}},Mo={__proto__:null,LonLat:Ks,Mercator:Ko,SphericalMercator:_i},nh=P({},Ui,{code:"EPSG:3395",projection:Ko,transformation:(function(){var _=.5/(Math.PI*Ko.R);return Qi(_,.5,-_,.5)})()}),el=P({},Ui,{code:"EPSG:4326",projection:Ks,transformation:Qi(1/180,1,-1/180,.5)}),$s=P({},pi,{projection:Ks,transformation:Qi(1,0,-1,0),scale:function(_){return Math.pow(2,_)},zoom:function(_){return Math.log(_)/Math.LN2},distance:function(_,E){var z=E.lng-_.lng,$=E.lat-_.lat;return Math.sqrt(z*z+$*$)},infinite:!0});pi.Earth=Ui,pi.EPSG3395=nh,pi.EPSG3857=$e,pi.EPSG900913=lt,pi.EPSG4326=el,pi.Simple=$s;var As=si.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(_){return _.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(_){return _&&_.removeLayer(this),this},getPane:function(_){return this._map.getPane(_?this.options[_]||_:this.options.pane)},addInteractiveTarget:function(_){return this._map._targets[j(_)]=this,this},removeInteractiveTarget:function(_){return delete this._map._targets[j(_)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(_){var E=_.target;if(E.hasLayer(this)){if(this._map=E,this._zoomAnimated=E._zoomAnimated,this.getEvents){var z=this.getEvents();E.on(z,this),this.once("remove",function(){E.off(z,this)},this)}this.onAdd(E),this.fire("add"),E.fire("layeradd",{layer:this})}}});Ii.include({addLayer:function(_){if(!_._layerAdd)throw new Error("The provided object is not a Layer.");var E=j(_);return this._layers[E]?this:(this._layers[E]=_,_._mapToAdd=this,_.beforeAdd&&_.beforeAdd(this),this.whenReady(_._layerAdd,_),this)},removeLayer:function(_){var E=j(_);return this._layers[E]?(this._loaded&&_.onRemove(this),delete this._layers[E],this._loaded&&(this.fire("layerremove",{layer:_}),_.fire("remove")),_._map=_._mapToAdd=null,this):this},hasLayer:function(_){return j(_)in this._layers},eachLayer:function(_,E){for(var z in this._layers)_.call(E,this._layers[z]);return this},_addLayers:function(_){_=_?oe(_)?_:[_]:[];for(var E=0,z=_.length;E<z;E++)this.addLayer(_[E])},_addZoomLimit:function(_){(!isNaN(_.options.maxZoom)||!isNaN(_.options.minZoom))&&(this._zoomBoundLayers[j(_)]=_,this._updateZoomLevels())},_removeZoomLimit:function(_){var E=j(_);this._zoomBoundLayers[E]&&(delete this._zoomBoundLayers[E],this._updateZoomLevels())},_updateZoomLevels:function(){var _=1/0,E=-1/0,z=this._getZoomSpan();for(var $ in this._zoomBoundLayers){var te=this._zoomBoundLayers[$].options;_=te.minZoom===void 0?_:Math.min(_,te.minZoom),E=te.maxZoom===void 0?E:Math.max(E,te.maxZoom)}this._layersMaxZoom=E===-1/0?void 0:E,this._layersMinZoom=_===1/0?void 0:_,z!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var cn=As.extend({initialize:function(_,E){he(this,E),this._layers={};var z,$;if(_)for(z=0,$=_.length;z<$;z++)this.addLayer(_[z])},addLayer:function(_){var E=this.getLayerId(_);return this._layers[E]=_,this._map&&this._map.addLayer(_),this},removeLayer:function(_){var E=_ in this._layers?_:this.getLayerId(_);return this._map&&this._layers[E]&&this._map.removeLayer(this._layers[E]),delete this._layers[E],this},hasLayer:function(_){var E=typeof _=="number"?_:this.getLayerId(_);return E in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(_){var E=Array.prototype.slice.call(arguments,1),z,$;for(z in this._layers)$=this._layers[z],$[_]&&$[_].apply($,E);return this},onAdd:function(_){this.eachLayer(_.addLayer,_)},onRemove:function(_){this.eachLayer(_.removeLayer,_)},eachLayer:function(_,E){for(var z in this._layers)_.call(E,this._layers[z]);return this},getLayer:function(_){return this._layers[_]},getLayers:function(){var _=[];return this.eachLayer(_.push,_),_},setZIndex:function(_){return this.invoke("setZIndex",_)},getLayerId:function(_){return j(_)}}),mi=function(_,E){return new cn(_,E)},$o=cn.extend({addLayer:function(_){return this.hasLayer(_)?this:(_.addEventParent(this),cn.prototype.addLayer.call(this,_),this.fire("layeradd",{layer:_}))},removeLayer:function(_){return this.hasLayer(_)?(_ in this._layers&&(_=this._layers[_]),_.removeEventParent(this),cn.prototype.removeLayer.call(this,_),this.fire("layerremove",{layer:_})):this},setStyle:function(_){return this.invoke("setStyle",_)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var _=new dn;for(var E in this._layers){var z=this._layers[E];_.extend(z.getBounds?z.getBounds():z.getLatLng())}return _}}),Xi=function(_,E){return new $o(_,E)},Yo=tt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(_){he(this,_)},createIcon:function(_){return this._createIcon("icon",_)},createShadow:function(_){return this._createIcon("shadow",_)},_createIcon:function(_,E){var z=this._getIconUrl(_);if(!z){if(_==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var $=this._createImg(z,E&&E.tagName==="IMG"?E:null);return this._setIconStyles($,_),(this.options.crossOrigin||this.options.crossOrigin==="")&&($.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),$},_setIconStyles:function(_,E){var z=this.options,$=z[E+"Size"];typeof $=="number"&&($=[$,$]);var te=Ti($),Ce=Ti(E==="shadow"&&z.shadowAnchor||z.iconAnchor||te&&te.divideBy(2,!0));_.className="leaflet-marker-"+E+" "+(z.className||""),Ce&&(_.style.marginLeft=-Ce.x+"px",_.style.marginTop=-Ce.y+"px"),te&&(_.style.width=te.x+"px",_.style.height=te.y+"px")},_createImg:function(_,E){return E=E||document.createElement("img"),E.src=_,E},_getIconUrl:function(_){return ve.retina&&this.options[_+"RetinaUrl"]||this.options[_+"Url"]}});function tl(_){return new Yo(_)}var Wi=Yo.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(_){return typeof Wi.imagePath!="string"&&(Wi.imagePath=this._detectIconPath()),(this.options.imagePath||Wi.imagePath)+Yo.prototype._getIconUrl.call(this,_)},_stripUrl:function(_){var E=function(z,$,te){var Ce=$.exec(z);return Ce&&Ce[te]};return _=E(_,/^url\((['"])?(.+)\1\)$/,2),_&&E(_,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var _=Hn("div","leaflet-default-icon-path",document.body),E=zs(_,"background-image")||zs(_,"backgroundImage");if(document.body.removeChild(_),E=this._stripUrl(E),E)return E;var z=document.querySelector('link[href$="leaflet.css"]');return z?z.href.substring(0,z.href.length-11-1):""}}),Jl=Mi.extend({initialize:function(_){this._marker=_},addHooks:function(){var _=this._marker._icon;this._draggable||(this._draggable=new Fs(_,_,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Kn(_,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Br(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(_){var E=this._marker,z=E._map,$=this._marker.options.autoPanSpeed,te=this._marker.options.autoPanPadding,Ce=Vs(E._icon),dt=z.getPixelBounds(),Vt=z.getPixelOrigin(),Qt=ki(dt.min._subtract(Vt).add(te),dt.max._subtract(Vt).subtract(te));if(!Qt.contains(Ce)){var Li=Ti((Math.max(Qt.max.x,Ce.x)-Qt.max.x)/(dt.max.x-Qt.max.x)-(Math.min(Qt.min.x,Ce.x)-Qt.min.x)/(dt.min.x-Qt.min.x),(Math.max(Qt.max.y,Ce.y)-Qt.max.y)/(dt.max.y-Qt.max.y)-(Math.min(Qt.min.y,Ce.y)-Qt.min.y)/(dt.min.y-Qt.min.y)).multiplyBy($);z.panBy(Li,{animate:!1}),this._draggable._newPos._add(Li),this._draggable._startPos._add(Li),Or(E._icon,this._draggable._newPos),this._onDrag(_),this._panRequest=Oe(this._adjustPan.bind(this,_))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(_){this._marker.options.autoPan&&(He(this._panRequest),this._panRequest=Oe(this._adjustPan.bind(this,_)))},_onDrag:function(_){var E=this._marker,z=E._shadow,$=Vs(E._icon),te=E._map.layerPointToLatLng($);z&&Or(z,$),E._latlng=te,_.latlng=te,_.oldLatLng=this._oldLatLng,E.fire("move",_).fire("drag",_)},_onDragEnd:function(_){He(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",_)}}),il=As.extend({options:{icon:new Wi,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(_,E){he(this,E),this._latlng=Pt(_)},onAdd:function(_){this._zoomAnimated=this._zoomAnimated&&_.options.markerZoomAnimation,this._zoomAnimated&&_.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(_){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&_.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(_){var E=this._latlng;return this._latlng=Pt(_),this.update(),this.fire("move",{oldLatLng:E,latlng:this._latlng})},setZIndexOffset:function(_){return this.options.zIndexOffset=_,this.update()},getIcon:function(){return this.options.icon},setIcon:function(_){return this.options.icon=_,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var _=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(_)}return this},_initIcon:function(){var _=this.options,E="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),z=_.icon.createIcon(this._icon),$=!1;z!==this._icon&&(this._icon&&this._removeIcon(),$=!0,_.title&&(z.title=_.title),z.tagName==="IMG"&&(z.alt=_.alt||"")),Kn(z,E),_.keyboard&&(z.tabIndex="0",z.setAttribute("role","button")),this._icon=z,_.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&In(z,"focus",this._panOnFocus,this);var te=_.icon.createShadow(this._shadow),Ce=!1;te!==this._shadow&&(this._removeShadow(),Ce=!0),te&&(Kn(te,E),te.alt=""),this._shadow=te,_.opacity<1&&this._updateOpacity(),$&&this.getPane().appendChild(this._icon),this._initInteraction(),te&&Ce&&this.getPane(_.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&pr(this._icon,"focus",this._panOnFocus,this),sr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&sr(this._shadow),this._shadow=null},_setPos:function(_){this._icon&&Or(this._icon,_),this._shadow&&Or(this._shadow,_),this._zIndex=_.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(_){this._icon&&(this._icon.style.zIndex=this._zIndex+_)},_animateZoom:function(_){var E=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center).round();this._setPos(E)},_initInteraction:function(){if(this.options.interactive&&(Kn(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Jl)){var _=this.options.draggable;this.dragging&&(_=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Jl(this),_&&this.dragging.enable()}},setOpacity:function(_){return this.options.opacity=_,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var _=this.options.opacity;this._icon&&Ls(this._icon,_),this._shadow&&Ls(this._shadow,_)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var _=this._map;if(_){var E=this.options.icon.options,z=E.iconSize?Ti(E.iconSize):Ti(0,0),$=E.iconAnchor?Ti(E.iconAnchor):Ti(0,0);_.panInside(this._latlng,{paddingTopLeft:$,paddingBottomRight:z.subtract($)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ql(_,E){return new il(_,E)}var Ra=As.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(_){this._renderer=_.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(_){return he(this,_),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&_&&Object.prototype.hasOwnProperty.call(_,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),dl=Ra.extend({options:{fill:!0,radius:10},initialize:function(_,E){he(this,E),this._latlng=Pt(_),this._radius=this.options.radius},setLatLng:function(_){var E=this._latlng;return this._latlng=Pt(_),this.redraw(),this.fire("move",{oldLatLng:E,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(_){return this.options.radius=this._radius=_,this.redraw()},getRadius:function(){return this._radius},setStyle:function(_){var E=_&&_.radius||this._radius;return Ra.prototype.setStyle.call(this,_),this.setRadius(E),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var _=this._radius,E=this._radiusY||_,z=this._clickTolerance(),$=[_+z,E+z];this._pxBounds=new di(this._point.subtract($),this._point.add($))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(_){return _.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function vs(_,E){return new dl(_,E)}var ou=dl.extend({initialize:function(_,E,z){if(typeof E=="number"&&(E=P({},z,{radius:E})),he(this,E),this._latlng=Pt(_),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(_){return this._mRadius=_,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var _=[this._radius,this._radiusY||this._radius];return new dn(this._map.layerPointToLatLng(this._point.subtract(_)),this._map.layerPointToLatLng(this._point.add(_)))},setStyle:Ra.prototype.setStyle,_project:function(){var _=this._latlng.lng,E=this._latlng.lat,z=this._map,$=z.options.crs;if($.distance===Ui.distance){var te=Math.PI/180,Ce=this._mRadius/Ui.R/te,dt=z.project([E+Ce,_]),Vt=z.project([E-Ce,_]),Qt=dt.add(Vt).divideBy(2),Li=z.unproject(Qt).lat,mn=Math.acos((Math.cos(Ce*te)-Math.sin(E*te)*Math.sin(Li*te))/(Math.cos(E*te)*Math.cos(Li*te)))/te;(isNaN(mn)||mn===0)&&(mn=Ce/Math.cos(Math.PI/180*E)),this._point=Qt.subtract(z.getPixelOrigin()),this._radius=isNaN(mn)?0:Qt.x-z.project([Li,_-mn]).x,this._radiusY=Qt.y-dt.y}else{var $n=$.unproject($.project(this._latlng).subtract([this._mRadius,0]));this._point=z.latLngToLayerPoint(this._latlng),this._radius=this._point.x-z.latLngToLayerPoint($n).x}this._updateBounds()}});function fl(_,E,z){return new ou(_,E,z)}var qs=Ra.extend({options:{smoothFactor:1,noClip:!1},initialize:function(_,E){he(this,E),this._setLatLngs(_)},getLatLngs:function(){return this._latlngs},setLatLngs:function(_){return this._setLatLngs(_),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(_){for(var E=1/0,z=null,$=vn,te,Ce,dt=0,Vt=this._parts.length;dt<Vt;dt++)for(var Qt=this._parts[dt],Li=1,mn=Qt.length;Li<mn;Li++){te=Qt[Li-1],Ce=Qt[Li];var $n=$(_,te,Ce,!0);$n<E&&(E=$n,z=$(_,te,Ce))}return z&&(z.distance=Math.sqrt(E)),z},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Pr(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(_,E){return E=E||this._defaultShape(),_=Pt(_),E.push(_),this._bounds.extend(_),this.redraw()},_setLatLngs:function(_){this._bounds=new dn,this._latlngs=this._convertLatLngs(_)},_defaultShape:function(){return Bn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(_){for(var E=[],z=Bn(_),$=0,te=_.length;$<te;$++)z?(E[$]=Pt(_[$]),this._bounds.extend(E[$])):E[$]=this._convertLatLngs(_[$]);return E},_project:function(){var _=new di;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,_),this._bounds.isValid()&&_.isValid()&&(this._rawPxBounds=_,this._updateBounds())},_updateBounds:function(){var _=this._clickTolerance(),E=new wt(_,_);this._rawPxBounds&&(this._pxBounds=new di([this._rawPxBounds.min.subtract(E),this._rawPxBounds.max.add(E)]))},_projectLatlngs:function(_,E,z){var $=_[0]instanceof mt,te=_.length,Ce,dt;if($){for(dt=[],Ce=0;Ce<te;Ce++)dt[Ce]=this._map.latLngToLayerPoint(_[Ce]),z.extend(dt[Ce]);E.push(dt)}else for(Ce=0;Ce<te;Ce++)this._projectLatlngs(_[Ce],E,z)},_clipPoints:function(){var _=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(_))){if(this.options.noClip){this._parts=this._rings;return}var E=this._parts,z,$,te,Ce,dt,Vt,Qt;for(z=0,te=0,Ce=this._rings.length;z<Ce;z++)for(Qt=this._rings[z],$=0,dt=Qt.length;$<dt-1;$++)Vt=Ne(Qt[$],Qt[$+1],_,$,!0),Vt&&(E[te]=E[te]||[],E[te].push(Vt[0]),(Vt[1]!==Qt[$+1]||$===dt-2)&&(E[te].push(Vt[1]),te++))}},_simplifyPoints:function(){for(var _=this._parts,E=this.options.smoothFactor,z=0,$=_.length;z<$;z++)_[z]=ar(_[z],E)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(_,E){var z,$,te,Ce,dt,Vt,Qt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(_))return!1;for(z=0,Ce=this._parts.length;z<Ce;z++)for(Vt=this._parts[z],$=0,dt=Vt.length,te=dt-1;$<dt;te=$++)if(!(!E&&$===0)&&Yr(_,Vt[te],Vt[$])<=Qt)return!0;return!1}});function Cl(_,E){return new qs(_,E)}qs._flat=Ir;var Gs=qs.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return xa(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(_){var E=qs.prototype._convertLatLngs.call(this,_),z=E.length;return z>=2&&E[0]instanceof mt&&E[0].equals(E[z-1])&&E.pop(),E},_setLatLngs:function(_){qs.prototype._setLatLngs.call(this,_),Bn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Bn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var _=this._renderer._bounds,E=this.options.weight,z=new wt(E,E);if(_=new di(_.min.subtract(z),_.max.add(z)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(_))){if(this.options.noClip){this._parts=this._rings;return}for(var $=0,te=this._rings.length,Ce;$<te;$++)Ce=Ma(this._rings[$],_,!0),Ce.length&&this._parts.push(Ce)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(_){var E=!1,z,$,te,Ce,dt,Vt,Qt,Li;if(!this._pxBounds||!this._pxBounds.contains(_))return!1;for(Ce=0,Qt=this._parts.length;Ce<Qt;Ce++)for(z=this._parts[Ce],dt=0,Li=z.length,Vt=Li-1;dt<Li;Vt=dt++)$=z[dt],te=z[Vt],$.y>_.y!=te.y>_.y&&_.x<(te.x-$.x)*(_.y-$.y)/(te.y-$.y)+$.x&&(E=!E);return E||qs.prototype._containsPoint.call(this,_,!0)}});function Zd(_,E){return new Gs(_,E)}var ba=$o.extend({initialize:function(_,E){he(this,E),this._layers={},_&&this.addData(_)},addData:function(_){var E=oe(_)?_:_.features,z,$,te;if(E){for(z=0,$=E.length;z<$;z++)te=E[z],(te.geometries||te.geometry||te.features||te.coordinates)&&this.addData(te);return this}var Ce=this.options;if(Ce.filter&&!Ce.filter(_))return this;var dt=rh(_,Ce);return dt?(dt.feature=tc(_),dt.defaultOptions=dt.options,this.resetStyle(dt),Ce.onEachFeature&&Ce.onEachFeature(_,dt),this.addLayer(dt)):this},resetStyle:function(_){return _===void 0?this.eachLayer(this.resetStyle,this):(_.options=P({},_.defaultOptions),this._setLayerStyle(_,this.options.style),this)},setStyle:function(_){return this.eachLayer(function(E){this._setLayerStyle(E,_)},this)},_setLayerStyle:function(_,E){_.setStyle&&(typeof E=="function"&&(E=E(_.feature)),_.setStyle(E))}});function rh(_,E){var z=_.type==="Feature"?_.geometry:_,$=z?z.coordinates:null,te=[],Ce=E&&E.pointToLayer,dt=E&&E.coordsToLatLng||Ml,Vt,Qt,Li,mn;if(!$&&!z)return null;switch(z.type){case"Point":return Vt=dt($),au(Ce,_,Vt,E);case"MultiPoint":for(Li=0,mn=$.length;Li<mn;Li++)Vt=dt($[Li]),te.push(au(Ce,_,Vt,E));return new $o(te);case"LineString":case"MultiLineString":return Qt=ua($,z.type==="LineString"?0:1,dt),new qs(Qt,E);case"Polygon":case"MultiPolygon":return Qt=ua($,z.type==="Polygon"?1:2,dt),new Gs(Qt,E);case"GeometryCollection":for(Li=0,mn=z.geometries.length;Li<mn;Li++){var $n=rh({geometry:z.geometries[Li],type:"Feature",properties:_.properties},E);$n&&te.push($n)}return new $o(te);case"FeatureCollection":for(Li=0,mn=z.features.length;Li<mn;Li++){var _r=rh(z.features[Li],E);_r&&te.push(_r)}return new $o(te);default:throw new Error("Invalid GeoJSON object.")}}function au(_,E,z,$){return _?_(E,z):new il(z,$&&$.markersInheritOptions&&$)}function Ml(_){return new mt(_[1],_[0],_[2])}function ua(_,E,z){for(var $=[],te=0,Ce=_.length,dt;te<Ce;te++)dt=E?ua(_[te],E-1,z):(z||Ml)(_[te]),$.push(dt);return $}function Wh(_,E){return _=Pt(_),_.alt!==void 0?[le(_.lng,E),le(_.lat,E),le(_.alt,E)]:[le(_.lng,E),le(_.lat,E)]}function pl(_,E,z,$){for(var te=[],Ce=0,dt=_.length;Ce<dt;Ce++)te.push(E?pl(_[Ce],Bn(_[Ce])?0:E-1,z,$):Wh(_[Ce],$));return!E&&z&&te.length>0&&te.push(te[0].slice()),te}function ec(_,E){return _.feature?P({},_.feature,{geometry:E}):tc(E)}function tc(_){return _.type==="Feature"||_.type==="FeatureCollection"?_:{type:"Feature",properties:{},geometry:_}}var Ic={toGeoJSON:function(_){return ec(this,{type:"Point",coordinates:Wh(this.getLatLng(),_)})}};il.include(Ic),ou.include(Ic),dl.include(Ic),qs.include({toGeoJSON:function(_){var E=!Bn(this._latlngs),z=pl(this._latlngs,E?1:0,!1,_);return ec(this,{type:(E?"Multi":"")+"LineString",coordinates:z})}}),Gs.include({toGeoJSON:function(_){var E=!Bn(this._latlngs),z=E&&!Bn(this._latlngs[0]),$=pl(this._latlngs,z?2:E?1:0,!0,_);return E||($=[$]),ec(this,{type:(z?"Multi":"")+"Polygon",coordinates:$})}}),cn.include({toMultiPoint:function(_){var E=[];return this.eachLayer(function(z){E.push(z.toGeoJSON(_).geometry.coordinates)}),ec(this,{type:"MultiPoint",coordinates:E})},toGeoJSON:function(_){var E=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(E==="MultiPoint")return this.toMultiPoint(_);var z=E==="GeometryCollection",$=[];return this.eachLayer(function(te){if(te.toGeoJSON){var Ce=te.toGeoJSON(_);if(z)$.push(Ce.geometry);else{var dt=tc(Ce);dt.type==="FeatureCollection"?$.push.apply($,dt.features):$.push(dt)}}}),z?ec(this,{geometries:$,type:"GeometryCollection"}):{type:"FeatureCollection",features:$}}});function ml(_,E){return new ba(_,E)}var ic=ml,sh=As.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(_,E,z){this._url=_,this._bounds=an(E),he(this,z)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Kn(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){sr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(_){return this.options.opacity=_,this._image&&this._updateOpacity(),this},setStyle:function(_){return _.opacity&&this.setOpacity(_.opacity),this},bringToFront:function(){return this._map&&oa(this._image),this},bringToBack:function(){return this._map&&Xs(this._image),this},setUrl:function(_){return this._url=_,this._image&&(this._image.src=_),this},setBounds:function(_){return this._bounds=an(_),this._map&&this._reset(),this},getEvents:function(){var _={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},setZIndex:function(_){return this.options.zIndex=_,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var _=this._url.tagName==="IMG",E=this._image=_?this._url:Hn("img");if(Kn(E,"leaflet-image-layer"),this._zoomAnimated&&Kn(E,"leaflet-zoom-animated"),this.options.className&&Kn(E,this.options.className),E.onselectstart=ee,E.onmousemove=ee,E.onload=k(this.fire,this,"load"),E.onerror=k(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(E.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),_){this._url=E.src;return}E.src=this._url,E.alt=this.options.alt},_animateZoom:function(_){var E=this._map.getZoomScale(_.zoom),z=this._map._latLngBoundsToNewLayerBounds(this._bounds,_.zoom,_.center).min;Vo(this._image,z,E)},_reset:function(){var _=this._image,E=new di(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),z=E.getSize();Or(_,E.min),_.style.width=z.x+"px",_.style.height=z.y+"px"},_updateOpacity:function(){Ls(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var _=this.options.errorOverlayUrl;_&&this._url!==_&&(this._url=_,this._image.src=_)},getCenter:function(){return this._bounds.getCenter()}}),Ep=function(_,E,z){return new sh(_,E,z)},lu=sh.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var _=this._url.tagName==="VIDEO",E=this._image=_?this._url:Hn("video");if(Kn(E,"leaflet-image-layer"),this._zoomAnimated&&Kn(E,"leaflet-zoom-animated"),this.options.className&&Kn(E,this.options.className),E.onselectstart=ee,E.onmousemove=ee,E.onloadeddata=k(this.fire,this,"load"),_){for(var z=E.getElementsByTagName("source"),$=[],te=0;te<z.length;te++)$.push(z[te].src);this._url=z.length>0?$:[E.src];return}oe(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(E.style,"objectFit")&&(E.style.objectFit="fill"),E.autoplay=!!this.options.autoplay,E.loop=!!this.options.loop,E.muted=!!this.options.muted,E.playsInline=!!this.options.playsInline;for(var Ce=0;Ce<this._url.length;Ce++){var dt=Hn("source");dt.src=this._url[Ce],E.appendChild(dt)}}});function Wd(_,E,z){return new lu(_,E,z)}var cu=sh.extend({_initImage:function(){var _=this._image=this._url;Kn(_,"leaflet-image-layer"),this._zoomAnimated&&Kn(_,"leaflet-zoom-animated"),this.options.className&&Kn(_,this.options.className),_.onselectstart=ee,_.onmousemove=ee}});function Oa(_,E,z){return new cu(_,E,z)}var $a=As.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(_,E){_&&(_ instanceof mt||oe(_))?(this._latlng=Pt(_),he(this,E)):(he(this,_),this._source=E),this.options.content&&(this._content=this.options.content)},openOn:function(_){return _=arguments.length?_:this._source._map,_.hasLayer(this)||_.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(_){return this._map?this.close():(arguments.length?this._source=_:_=this._source,this._prepareOpen(),this.openOn(_._map)),this},onAdd:function(_){this._zoomAnimated=_._zoomAnimated,this._container||this._initLayout(),_._fadeAnimated&&Ls(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),_._fadeAnimated&&Ls(this._container,1),this.bringToFront(),this.options.interactive&&(Kn(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(_){_._fadeAnimated?(Ls(this._container,0),this._removeTimeout=setTimeout(k(sr,void 0,this._container),200)):sr(this._container),this.options.interactive&&(Br(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(_){return this._latlng=Pt(_),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(_){return this._content=_,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var _={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&oa(this._container),this},bringToBack:function(){return this._map&&Xs(this._container),this},_prepareOpen:function(_){var E=this._source;if(!E._map)return!1;if(E instanceof $o){E=null;var z=this._source._layers;for(var $ in z)if(z[$]._map){E=z[$];break}if(!E)return!1;this._source=E}if(!_)if(E.getCenter)_=E.getCenter();else if(E.getLatLng)_=E.getLatLng();else if(E.getBounds)_=E.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(_),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var _=this._contentNode,E=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof E=="string")_.innerHTML=E;else{for(;_.hasChildNodes();)_.removeChild(_.firstChild);_.appendChild(E)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var _=this._map.latLngToLayerPoint(this._latlng),E=Ti(this.options.offset),z=this._getAnchor();this._zoomAnimated?Or(this._container,_.add(z)):E=E.add(_).add(z);var $=this._containerBottom=-E.y,te=this._containerLeft=-Math.round(this._containerWidth/2)+E.x;this._container.style.bottom=$+"px",this._container.style.left=te+"px"}},_getAnchor:function(){return[0,0]}});Ii.include({_initOverlay:function(_,E,z,$){var te=E;return te instanceof _||(te=new _($).setContent(E)),z&&te.setLatLng(z),te}}),As.include({_initOverlay:function(_,E,z,$){var te=z;return te instanceof _?(he(te,$),te._source=this):(te=E&&!$?E:new _($,this),te.setContent(z)),te}});var uu=$a.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(_){return _=arguments.length?_:this._source._map,!_.hasLayer(this)&&_._popup&&_._popup.options.autoClose&&_.removeLayer(_._popup),_._popup=this,$a.prototype.openOn.call(this,_)},onAdd:function(_){$a.prototype.onAdd.call(this,_),_.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ra||this._source.on("preclick",la))},onRemove:function(_){$a.prototype.onRemove.call(this,_),_.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ra||this._source.off("preclick",la))},getEvents:function(){var _=$a.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(_.preclick=this.close),this.options.keepInView&&(_.moveend=this._adjustPan),_},_initLayout:function(){var _="leaflet-popup",E=this._container=Hn("div",_+" "+(this.options.className||"")+" leaflet-zoom-animated"),z=this._wrapper=Hn("div",_+"-content-wrapper",E);if(this._contentNode=Hn("div",_+"-content",z),Qs(E),jo(this._contentNode),In(E,"contextmenu",la),this._tipContainer=Hn("div",_+"-tip-container",E),this._tip=Hn("div",_+"-tip",this._tipContainer),this.options.closeButton){var $=this._closeButton=Hn("a",_+"-close-button",E);$.setAttribute("role","button"),$.setAttribute("aria-label","Close popup"),$.href="#close",$.innerHTML='<span aria-hidden="true">&#215;</span>',In($,"click",function(te){ms(te),this.close()},this)}},_updateLayout:function(){var _=this._contentNode,E=_.style;E.width="",E.whiteSpace="nowrap";var z=_.offsetWidth;z=Math.min(z,this.options.maxWidth),z=Math.max(z,this.options.minWidth),E.width=z+1+"px",E.whiteSpace="",E.height="";var $=_.offsetHeight,te=this.options.maxHeight,Ce="leaflet-popup-scrolled";te&&$>te?(E.height=te+"px",Kn(_,Ce)):Br(_,Ce),this._containerWidth=this._container.offsetWidth},_animateZoom:function(_){var E=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center),z=this._getAnchor();Or(this._container,E.add(z))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var _=this._map,E=parseInt(zs(this._container,"marginBottom"),10)||0,z=this._container.offsetHeight+E,$=this._containerWidth,te=new wt(this._containerLeft,-z-this._containerBottom);te._add(Vs(this._container));var Ce=_.layerPointToContainerPoint(te),dt=Ti(this.options.autoPanPadding),Vt=Ti(this.options.autoPanPaddingTopLeft||dt),Qt=Ti(this.options.autoPanPaddingBottomRight||dt),Li=_.getSize(),mn=0,$n=0;Ce.x+$+Qt.x>Li.x&&(mn=Ce.x+$-Li.x+Qt.x),Ce.x-mn-Vt.x<0&&(mn=Ce.x-Vt.x),Ce.y+z+Qt.y>Li.y&&($n=Ce.y+z-Li.y+Qt.y),Ce.y-$n-Vt.y<0&&($n=Ce.y-Vt.y),(mn||$n)&&(this.options.keepInView&&(this._autopanning=!0),_.fire("autopanstart").panBy([mn,$n]))}},_getAnchor:function(){return Ti(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Xd=function(_,E){return new uu(_,E)};Ii.mergeOptions({closePopupOnClick:!0}),Ii.include({openPopup:function(_,E,z){return this._initOverlay(uu,_,E,z).openOn(this),this},closePopup:function(_){return _=arguments.length?_:this._popup,_&&_.close(),this}}),As.include({bindPopup:function(_,E){return this._popup=this._initOverlay(uu,this._popup,_,E),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(_){return this._popup&&(this instanceof $o||(this._popup._source=this),this._popup._prepareOpen(_||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(_){return this._popup&&this._popup.setContent(_),this},getPopup:function(){return this._popup},_openPopup:function(_){if(!(!this._popup||!this._map)){Rn(_);var E=_.layer||_.target;if(this._popup._source===E&&!(E instanceof Ra)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(_.latlng);return}this._popup._source=E,this.openPopup(_.latlng)}},_movePopup:function(_){this._popup.setLatLng(_.latlng)},_onKeyPress:function(_){_.originalEvent.keyCode===13&&this._openPopup(_)}});var nl=$a.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(_){$a.prototype.onAdd.call(this,_),this.setOpacity(this.options.opacity),_.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(_){$a.prototype.onRemove.call(this,_),_.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var _=$a.prototype.getEvents.call(this);return this.options.permanent||(_.preclick=this.close),_},_initLayout:function(){var _="leaflet-tooltip",E=_+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Hn("div",E),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+j(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(_){var E,z,$=this._map,te=this._container,Ce=$.latLngToContainerPoint($.getCenter()),dt=$.layerPointToContainerPoint(_),Vt=this.options.direction,Qt=te.offsetWidth,Li=te.offsetHeight,mn=Ti(this.options.offset),$n=this._getAnchor();Vt==="top"?(E=Qt/2,z=Li):Vt==="bottom"?(E=Qt/2,z=0):Vt==="center"?(E=Qt/2,z=Li/2):Vt==="right"?(E=0,z=Li/2):Vt==="left"?(E=Qt,z=Li/2):dt.x<Ce.x?(Vt="right",E=0,z=Li/2):(Vt="left",E=Qt+(mn.x+$n.x)*2,z=Li/2),_=_.subtract(Ti(E,z,!0)).add(mn).add($n),Br(te,"leaflet-tooltip-right"),Br(te,"leaflet-tooltip-left"),Br(te,"leaflet-tooltip-top"),Br(te,"leaflet-tooltip-bottom"),Kn(te,"leaflet-tooltip-"+Vt),Or(te,_)},_updatePosition:function(){var _=this._map.latLngToLayerPoint(this._latlng);this._setPosition(_)},setOpacity:function(_){this.options.opacity=_,this._container&&Ls(this._container,_)},_animateZoom:function(_){var E=this._map._latLngToNewLayerPoint(this._latlng,_.zoom,_.center);this._setPosition(E)},_getAnchor:function(){return Ti(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),hu=function(_,E){return new nl(_,E)};Ii.include({openTooltip:function(_,E,z){return this._initOverlay(nl,_,E,z).openOn(this),this},closeTooltip:function(_){return _.close(),this}}),As.include({bindTooltip:function(_,E){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(nl,this._tooltip,_,E),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(_){if(!(!_&&this._tooltipHandlersAdded)){var E=_?"off":"on",z={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?z.add=this._openTooltip:(z.mouseover=this._openTooltip,z.mouseout=this.closeTooltip,z.click=this._openTooltip,this._map?this._addFocusListeners():z.add=this._addFocusListeners),this._tooltip.options.sticky&&(z.mousemove=this._moveTooltip),this[E](z),this._tooltipHandlersAdded=!_}},openTooltip:function(_){return this._tooltip&&(this instanceof $o||(this._tooltip._source=this),this._tooltip._prepareOpen(_)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(_){return this._tooltip&&this._tooltip.setContent(_),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(_){var E=typeof _.getElement=="function"&&_.getElement();E&&(In(E,"focus",function(){this._tooltip._source=_,this.openTooltip()},this),In(E,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(_){var E=typeof _.getElement=="function"&&_.getElement();E&&E.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(_){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var E=this;this._map.once("moveend",function(){E._openOnceFlag=!1,E._openTooltip(_)});return}this._tooltip._source=_.layer||_.target,this.openTooltip(this._tooltip.options.sticky?_.latlng:void 0)}},_moveTooltip:function(_){var E=_.latlng,z,$;this._tooltip.options.sticky&&_.originalEvent&&(z=this._map.mouseEventToContainerPoint(_.originalEvent),$=this._map.containerPointToLayerPoint(z),E=this._map.layerPointToLatLng($)),this._tooltip.setLatLng(E)}});var oh=Yo.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(_){var E=_&&_.tagName==="DIV"?_:document.createElement("div"),z=this.options;if(z.html instanceof Element?(Wo(E),E.appendChild(z.html)):E.innerHTML=z.html!==!1?z.html:"",z.bgPos){var $=Ti(z.bgPos);E.style.backgroundPosition=-$.x+"px "+-$.y+"px"}return this._setIconStyles(E,"icon"),E},createShadow:function(){return null}});function Xh(_){return new oh(_)}Yo.Default=Wi;var rl=As.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ve.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(_){he(this,_)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(_){_._addZoomLimit(this)},onRemove:function(_){this._removeAllTiles(),sr(this._container),_._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(oa(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Xs(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(_){return this.options.opacity=_,this._updateOpacity(),this},setZIndex:function(_){return this.options.zIndex=_,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var _=this._clampZoom(this._map.getZoom());_!==this._tileZoom&&(this._tileZoom=_,this._updateLevels()),this._update()}return this},getEvents:function(){var _={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=H(this._onMoveEnd,this.options.updateInterval,this)),_.move=this._onMove),this._zoomAnimated&&(_.zoomanim=this._animateZoom),_},createTile:function(){return document.createElement("div")},getTileSize:function(){var _=this.options.tileSize;return _ instanceof wt?_:new wt(_,_)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(_){for(var E=this.getPane().children,z=-_(-1/0,1/0),$=0,te=E.length,Ce;$<te;$++)Ce=E[$].style.zIndex,E[$]!==this._container&&Ce&&(z=_(z,+Ce));isFinite(z)&&(this.options.zIndex=z+_(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ve.ielt9){Ls(this._container,this.options.opacity);var _=+new Date,E=!1,z=!1;for(var $ in this._tiles){var te=this._tiles[$];if(!(!te.current||!te.loaded)){var Ce=Math.min(1,(_-te.loaded)/200);Ls(te.el,Ce),Ce<1?E=!0:(te.active?z=!0:this._onOpaqueTile(te),te.active=!0)}}z&&!this._noPrune&&this._pruneTiles(),E&&(He(this._fadeFrame),this._fadeFrame=Oe(this._updateOpacity,this))}},_onOpaqueTile:ee,_initContainer:function(){this._container||(this._container=Hn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var _=this._tileZoom,E=this.options.maxZoom;if(_!==void 0){for(var z in this._levels)z=Number(z),this._levels[z].el.children.length||z===_?(this._levels[z].el.style.zIndex=E-Math.abs(_-z),this._onUpdateLevel(z)):(sr(this._levels[z].el),this._removeTilesAtZoom(z),this._onRemoveLevel(z),delete this._levels[z]);var $=this._levels[_],te=this._map;return $||($=this._levels[_]={},$.el=Hn("div","leaflet-tile-container leaflet-zoom-animated",this._container),$.el.style.zIndex=E,$.origin=te.project(te.unproject(te.getPixelOrigin()),_).round(),$.zoom=_,this._setZoomTransform($,te.getCenter(),te.getZoom()),ee($.el.offsetWidth),this._onCreateLevel($)),this._level=$,$}},_onUpdateLevel:ee,_onRemoveLevel:ee,_onCreateLevel:ee,_pruneTiles:function(){if(this._map){var _,E,z=this._map.getZoom();if(z>this.options.maxZoom||z<this.options.minZoom){this._removeAllTiles();return}for(_ in this._tiles)E=this._tiles[_],E.retain=E.current;for(_ in this._tiles)if(E=this._tiles[_],E.current&&!E.active){var $=E.coords;this._retainParent($.x,$.y,$.z,$.z-5)||this._retainChildren($.x,$.y,$.z,$.z+2)}for(_ in this._tiles)this._tiles[_].retain||this._removeTile(_)}},_removeTilesAtZoom:function(_){for(var E in this._tiles)this._tiles[E].coords.z===_&&this._removeTile(E)},_removeAllTiles:function(){for(var _ in this._tiles)this._removeTile(_)},_invalidateAll:function(){for(var _ in this._levels)sr(this._levels[_].el),this._onRemoveLevel(Number(_)),delete this._levels[_];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(_,E,z,$){var te=Math.floor(_/2),Ce=Math.floor(E/2),dt=z-1,Vt=new wt(+te,+Ce);Vt.z=+dt;var Qt=this._tileCoordsToKey(Vt),Li=this._tiles[Qt];return Li&&Li.active?(Li.retain=!0,!0):(Li&&Li.loaded&&(Li.retain=!0),dt>$?this._retainParent(te,Ce,dt,$):!1)},_retainChildren:function(_,E,z,$){for(var te=2*_;te<2*_+2;te++)for(var Ce=2*E;Ce<2*E+2;Ce++){var dt=new wt(te,Ce);dt.z=z+1;var Vt=this._tileCoordsToKey(dt),Qt=this._tiles[Vt];if(Qt&&Qt.active){Qt.retain=!0;continue}else Qt&&Qt.loaded&&(Qt.retain=!0);z+1<$&&this._retainChildren(te,Ce,z+1,$)}},_resetView:function(_){var E=_&&(_.pinch||_.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),E,E)},_animateZoom:function(_){this._setView(_.center,_.zoom,!0,_.noUpdate)},_clampZoom:function(_){var E=this.options;return E.minNativeZoom!==void 0&&_<E.minNativeZoom?E.minNativeZoom:E.maxNativeZoom!==void 0&&E.maxNativeZoom<_?E.maxNativeZoom:_},_setView:function(_,E,z,$){var te=Math.round(E);this.options.maxZoom!==void 0&&te>this.options.maxZoom||this.options.minZoom!==void 0&&te<this.options.minZoom?te=void 0:te=this._clampZoom(te);var Ce=this.options.updateWhenZooming&&te!==this._tileZoom;(!$||Ce)&&(this._tileZoom=te,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),te!==void 0&&this._update(_),z||this._pruneTiles(),this._noPrune=!!z),this._setZoomTransforms(_,E)},_setZoomTransforms:function(_,E){for(var z in this._levels)this._setZoomTransform(this._levels[z],_,E)},_setZoomTransform:function(_,E,z){var $=this._map.getZoomScale(z,_.zoom),te=_.origin.multiplyBy($).subtract(this._map._getNewPixelOrigin(E,z)).round();ve.any3d?Vo(_.el,te,$):Or(_.el,te)},_resetGrid:function(){var _=this._map,E=_.options.crs,z=this._tileSize=this.getTileSize(),$=this._tileZoom,te=this._map.getPixelWorldBounds(this._tileZoom);te&&(this._globalTileRange=this._pxBoundsToTileRange(te)),this._wrapX=E.wrapLng&&!this.options.noWrap&&[Math.floor(_.project([0,E.wrapLng[0]],$).x/z.x),Math.ceil(_.project([0,E.wrapLng[1]],$).x/z.y)],this._wrapY=E.wrapLat&&!this.options.noWrap&&[Math.floor(_.project([E.wrapLat[0],0],$).y/z.x),Math.ceil(_.project([E.wrapLat[1],0],$).y/z.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(_){var E=this._map,z=E._animatingZoom?Math.max(E._animateToZoom,E.getZoom()):E.getZoom(),$=E.getZoomScale(z,this._tileZoom),te=E.project(_,this._tileZoom).floor(),Ce=E.getSize().divideBy($*2);return new di(te.subtract(Ce),te.add(Ce))},_update:function(_){var E=this._map;if(E){var z=this._clampZoom(E.getZoom());if(_===void 0&&(_=E.getCenter()),this._tileZoom!==void 0){var $=this._getTiledPixelBounds(_),te=this._pxBoundsToTileRange($),Ce=te.getCenter(),dt=[],Vt=this.options.keepBuffer,Qt=new di(te.getBottomLeft().subtract([Vt,-Vt]),te.getTopRight().add([Vt,-Vt]));if(!(isFinite(te.min.x)&&isFinite(te.min.y)&&isFinite(te.max.x)&&isFinite(te.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Li in this._tiles){var mn=this._tiles[Li].coords;(mn.z!==this._tileZoom||!Qt.contains(new wt(mn.x,mn.y)))&&(this._tiles[Li].current=!1)}if(Math.abs(z-this._tileZoom)>1){this._setView(_,z);return}for(var $n=te.min.y;$n<=te.max.y;$n++)for(var _r=te.min.x;_r<=te.max.x;_r++){var Ro=new wt(_r,$n);if(Ro.z=this._tileZoom,!!this._isValidTile(Ro)){var lo=this._tiles[this._tileCoordsToKey(Ro)];lo?lo.current=!0:dt.push(Ro)}}if(dt.sort(function(Jo,Ll){return Jo.distanceTo(Ce)-Ll.distanceTo(Ce)}),dt.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Bo=document.createDocumentFragment();for(_r=0;_r<dt.length;_r++)this._addTile(dt[_r],Bo);this._level.el.appendChild(Bo)}}}},_isValidTile:function(_){var E=this._map.options.crs;if(!E.infinite){var z=this._globalTileRange;if(!E.wrapLng&&(_.x<z.min.x||_.x>z.max.x)||!E.wrapLat&&(_.y<z.min.y||_.y>z.max.y))return!1}if(!this.options.bounds)return!0;var $=this._tileCoordsToBounds(_);return an(this.options.bounds).overlaps($)},_keyToBounds:function(_){return this._tileCoordsToBounds(this._keyToTileCoords(_))},_tileCoordsToNwSe:function(_){var E=this._map,z=this.getTileSize(),$=_.scaleBy(z),te=$.add(z),Ce=E.unproject($,_.z),dt=E.unproject(te,_.z);return[Ce,dt]},_tileCoordsToBounds:function(_){var E=this._tileCoordsToNwSe(_),z=new dn(E[0],E[1]);return this.options.noWrap||(z=this._map.wrapLatLngBounds(z)),z},_tileCoordsToKey:function(_){return _.x+":"+_.y+":"+_.z},_keyToTileCoords:function(_){var E=_.split(":"),z=new wt(+E[0],+E[1]);return z.z=+E[2],z},_removeTile:function(_){var E=this._tiles[_];E&&(sr(E.el),delete this._tiles[_],this.fire("tileunload",{tile:E.el,coords:this._keyToTileCoords(_)}))},_initTile:function(_){Kn(_,"leaflet-tile");var E=this.getTileSize();_.style.width=E.x+"px",_.style.height=E.y+"px",_.onselectstart=ee,_.onmousemove=ee,ve.ielt9&&this.options.opacity<1&&Ls(_,this.options.opacity)},_addTile:function(_,E){var z=this._getTilePos(_),$=this._tileCoordsToKey(_),te=this.createTile(this._wrapCoords(_),k(this._tileReady,this,_));this._initTile(te),this.createTile.length<2&&Oe(k(this._tileReady,this,_,null,te)),Or(te,z),this._tiles[$]={el:te,coords:_,current:!0},E.appendChild(te),this.fire("tileloadstart",{tile:te,coords:_})},_tileReady:function(_,E,z){E&&this.fire("tileerror",{error:E,tile:z,coords:_});var $=this._tileCoordsToKey(_);z=this._tiles[$],z&&(z.loaded=+new Date,this._map._fadeAnimated?(Ls(z.el,0),He(this._fadeFrame),this._fadeFrame=Oe(this._updateOpacity,this)):(z.active=!0,this._pruneTiles()),E||(Kn(z.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:z.el,coords:_})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ve.ielt9||!this._map._fadeAnimated?Oe(this._pruneTiles,this):setTimeout(k(this._pruneTiles,this),250)))},_getTilePos:function(_){return _.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(_){var E=new wt(this._wrapX?W(_.x,this._wrapX):_.x,this._wrapY?W(_.y,this._wrapY):_.y);return E.z=_.z,E},_pxBoundsToTileRange:function(_){var E=this.getTileSize();return new di(_.min.unscaleBy(E).floor(),_.max.unscaleBy(E).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var _ in this._tiles)if(!this._tiles[_].loaded)return!1;return!0}});function Pc(_){return new rl(_)}var Rl=rl.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(_,E){this._url=_,E=he(this,E),E.detectRetina&&ve.retina&&E.maxZoom>0?(E.tileSize=Math.floor(E.tileSize/2),E.zoomReverse?(E.zoomOffset--,E.minZoom=Math.min(E.maxZoom,E.minZoom+1)):(E.zoomOffset++,E.maxZoom=Math.max(E.minZoom,E.maxZoom-1)),E.minZoom=Math.max(0,E.minZoom)):E.zoomReverse?E.minZoom=Math.min(E.maxZoom,E.minZoom):E.maxZoom=Math.max(E.minZoom,E.maxZoom),typeof E.subdomains=="string"&&(E.subdomains=E.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(_,E){return this._url===_&&E===void 0&&(E=!0),this._url=_,E||this.redraw(),this},createTile:function(_,E){var z=document.createElement("img");return In(z,"load",k(this._tileOnLoad,this,E,z)),In(z,"error",k(this._tileOnError,this,E,z)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(z.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(z.referrerPolicy=this.options.referrerPolicy),z.alt="",z.src=this.getTileUrl(_),z},getTileUrl:function(_){var E={r:ve.retina?"@2x":"",s:this._getSubdomain(_),x:_.x,y:_.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var z=this._globalTileRange.max.y-_.y;this.options.tms&&(E.y=z),E["-y"]=z}return fe(this._url,P(E,this.options))},_tileOnLoad:function(_,E){ve.ielt9?setTimeout(k(_,this,null,E),0):_(null,E)},_tileOnError:function(_,E,z){var $=this.options.errorTileUrl;$&&E.getAttribute("src")!==$&&(E.src=$),_(z,E)},_onTileRemove:function(_){_.tile.onload=null},_getZoomForUrl:function(){var _=this._tileZoom,E=this.options.maxZoom,z=this.options.zoomReverse,$=this.options.zoomOffset;return z&&(_=E-_),_+$},_getSubdomain:function(_){var E=Math.abs(_.x+_.y)%this.options.subdomains.length;return this.options.subdomains[E]},_abortLoading:function(){var _,E;for(_ in this._tiles)if(this._tiles[_].coords.z!==this._tileZoom&&(E=this._tiles[_].el,E.onload=ee,E.onerror=ee,!E.complete)){E.src=Ge;var z=this._tiles[_].coords;sr(E),delete this._tiles[_],this.fire("tileabort",{tile:E,coords:z})}},_removeTile:function(_){var E=this._tiles[_];if(E)return E.el.setAttribute("src",Ge),rl.prototype._removeTile.call(this,_)},_tileReady:function(_,E,z){if(!(!this._map||z&&z.getAttribute("src")===Ge))return rl.prototype._tileReady.call(this,_,E,z)}});function du(_,E){return new Rl(_,E)}var ha=Rl.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(_,E){this._url=_;var z=P({},this.defaultWmsParams);for(var $ in E)$ in this.options||(z[$]=E[$]);E=he(this,E);var te=E.detectRetina&&ve.retina?2:1,Ce=this.getTileSize();z.width=Ce.x*te,z.height=Ce.y*te,this.wmsParams=z},onAdd:function(_){this._crs=this.options.crs||_.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var E=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[E]=this._crs.code,Rl.prototype.onAdd.call(this,_)},getTileUrl:function(_){var E=this._tileCoordsToNwSe(_),z=this._crs,$=ki(z.project(E[0]),z.project(E[1])),te=$.min,Ce=$.max,dt=(this._wmsVersion>=1.3&&this._crs===el?[te.y,te.x,Ce.y,Ce.x]:[te.x,te.y,Ce.x,Ce.y]).join(","),Vt=Rl.prototype.getTileUrl.call(this,_);return Vt+Te(this.wmsParams,Vt,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+dt},setParams:function(_,E){return P(this.wmsParams,_),E||this.redraw(),this}});function ah(_,E){return new ha(_,E)}Rl.WMS=ha,du.wms=ah;var Zt=As.extend({options:{padding:.1},initialize:function(_){he(this,_),j(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Kn(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var _={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(_.zoomanim=this._onAnimZoom),_},_onAnimZoom:function(_){this._updateTransform(_.center,_.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(_,E){var z=this._map.getZoomScale(E,this._zoom),$=this._map.getSize().multiplyBy(.5+this.options.padding),te=this._map.project(this._center,E),Ce=$.multiplyBy(-z).add(te).subtract(this._map._getNewPixelOrigin(_,E));ve.any3d?Vo(this._container,Ce,z):Or(this._container,Ce)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var _ in this._layers)this._layers[_]._reset()},_onZoomEnd:function(){for(var _ in this._layers)this._layers[_]._project()},_updatePaths:function(){for(var _ in this._layers)this._layers[_]._update()},_update:function(){var _=this.options.padding,E=this._map.getSize(),z=this._map.containerPointToLayerPoint(E.multiplyBy(-_)).round();this._bounds=new di(z,z.add(E.multiplyBy(1+_*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),lh=Zt.extend({options:{tolerance:0},getEvents:function(){var _=Zt.prototype.getEvents.call(this);return _.viewprereset=this._onViewPreReset,_},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Zt.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var _=this._container=document.createElement("canvas");In(_,"mousemove",this._onMouseMove,this),In(_,"click dblclick mousedown mouseup contextmenu",this._onClick,this),In(_,"mouseout",this._handleMouseOut,this),_._leaflet_disable_events=!0,this._ctx=_.getContext("2d")},_destroyContainer:function(){He(this._redrawRequest),delete this._ctx,sr(this._container),pr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var _;this._redrawBounds=null;for(var E in this._layers)_=this._layers[E],_._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Zt.prototype._update.call(this);var _=this._bounds,E=this._container,z=_.getSize(),$=ve.retina?2:1;Or(E,_.min),E.width=$*z.x,E.height=$*z.y,E.style.width=z.x+"px",E.style.height=z.y+"px",ve.retina&&this._ctx.scale(2,2),this._ctx.translate(-_.min.x,-_.min.y),this.fire("update")}},_reset:function(){Zt.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(_){this._updateDashArray(_),this._layers[j(_)]=_;var E=_._order={layer:_,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=E),this._drawLast=E,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(_){this._requestRedraw(_)},_removePath:function(_){var E=_._order,z=E.next,$=E.prev;z?z.prev=$:this._drawLast=$,$?$.next=z:this._drawFirst=z,delete _._order,delete this._layers[j(_)],this._requestRedraw(_)},_updatePath:function(_){this._extendRedrawBounds(_),_._project(),_._update(),this._requestRedraw(_)},_updateStyle:function(_){this._updateDashArray(_),this._requestRedraw(_)},_updateDashArray:function(_){if(typeof _.options.dashArray=="string"){var E=_.options.dashArray.split(/[, ]+/),z=[],$,te;for(te=0;te<E.length;te++){if($=Number(E[te]),isNaN($))return;z.push($)}_.options._dashArray=z}else _.options._dashArray=_.options.dashArray},_requestRedraw:function(_){this._map&&(this._extendRedrawBounds(_),this._redrawRequest=this._redrawRequest||Oe(this._redraw,this))},_extendRedrawBounds:function(_){if(_._pxBounds){var E=(_.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new di,this._redrawBounds.extend(_._pxBounds.min.subtract([E,E])),this._redrawBounds.extend(_._pxBounds.max.add([E,E]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var _=this._redrawBounds;if(_){var E=_.getSize();this._ctx.clearRect(_.min.x,_.min.y,E.x,E.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var _,E=this._redrawBounds;if(this._ctx.save(),E){var z=E.getSize();this._ctx.beginPath(),this._ctx.rect(E.min.x,E.min.y,z.x,z.y),this._ctx.clip()}this._drawing=!0;for(var $=this._drawFirst;$;$=$.next)_=$.layer,(!E||_._pxBounds&&_._pxBounds.intersects(E))&&_._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(_,E){if(this._drawing){var z,$,te,Ce,dt=_._parts,Vt=dt.length,Qt=this._ctx;if(Vt){for(Qt.beginPath(),z=0;z<Vt;z++){for($=0,te=dt[z].length;$<te;$++)Ce=dt[z][$],Qt[$?"lineTo":"moveTo"](Ce.x,Ce.y);E&&Qt.closePath()}this._fillStroke(Qt,_)}}},_updateCircle:function(_){if(!(!this._drawing||_._empty())){var E=_._point,z=this._ctx,$=Math.max(Math.round(_._radius),1),te=(Math.max(Math.round(_._radiusY),1)||$)/$;te!==1&&(z.save(),z.scale(1,te)),z.beginPath(),z.arc(E.x,E.y/te,$,0,Math.PI*2,!1),te!==1&&z.restore(),this._fillStroke(z,_)}},_fillStroke:function(_,E){var z=E.options;z.fill&&(_.globalAlpha=z.fillOpacity,_.fillStyle=z.fillColor||z.color,_.fill(z.fillRule||"evenodd")),z.stroke&&z.weight!==0&&(_.setLineDash&&_.setLineDash(E.options&&E.options._dashArray||[]),_.globalAlpha=z.opacity,_.lineWidth=z.weight,_.strokeStyle=z.color,_.lineCap=z.lineCap,_.lineJoin=z.lineJoin,_.stroke())},_onClick:function(_){for(var E=this._map.mouseEventToLayerPoint(_),z,$,te=this._drawFirst;te;te=te.next)z=te.layer,z.options.interactive&&z._containsPoint(E)&&(!(_.type==="click"||_.type==="preclick")||!this._map._draggableMoved(z))&&($=z);this._fireEvent($?[$]:!1,_)},_onMouseMove:function(_){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var E=this._map.mouseEventToLayerPoint(_);this._handleMouseHover(_,E)}},_handleMouseOut:function(_){var E=this._hoveredLayer;E&&(Br(this._container,"leaflet-interactive"),this._fireEvent([E],_,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(_,E){if(!this._mouseHoverThrottled){for(var z,$,te=this._drawFirst;te;te=te.next)z=te.layer,z.options.interactive&&z._containsPoint(E)&&($=z);$!==this._hoveredLayer&&(this._handleMouseOut(_),$&&(Kn(this._container,"leaflet-interactive"),this._fireEvent([$],_,"mouseover"),this._hoveredLayer=$)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,_),this._mouseHoverThrottled=!0,setTimeout(k(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(_,E,z){this._map._fireDOMEvent(E,z||E.type,_)},_bringToFront:function(_){var E=_._order;if(E){var z=E.next,$=E.prev;if(z)z.prev=$;else return;$?$.next=z:z&&(this._drawFirst=z),E.prev=this._drawLast,this._drawLast.next=E,E.next=null,this._drawLast=E,this._requestRedraw(_)}},_bringToBack:function(_){var E=_._order;if(E){var z=E.next,$=E.prev;if($)$.next=z;else return;z?z.prev=$:$&&(this._drawLast=$),E.prev=null,E.next=this._drawFirst,this._drawFirst.prev=E,this._drawFirst=E,this._requestRedraw(_)}}});function nc(_){return ve.canvas?new lh(_):null}var sl=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(_){return document.createElement("<lvml:"+_+' class="lvml">')}}catch{}return function(_){return document.createElement("<"+_+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),fu={_initContainer:function(){this._container=Hn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Zt.prototype._update.call(this),this.fire("update"))},_initPath:function(_){var E=_._container=sl("shape");Kn(E,"leaflet-vml-shape "+(this.options.className||"")),E.coordsize="1 1",_._path=sl("path"),E.appendChild(_._path),this._updateStyle(_),this._layers[j(_)]=_},_addPath:function(_){var E=_._container;this._container.appendChild(E),_.options.interactive&&_.addInteractiveTarget(E)},_removePath:function(_){var E=_._container;sr(E),_.removeInteractiveTarget(E),delete this._layers[j(_)]},_updateStyle:function(_){var E=_._stroke,z=_._fill,$=_.options,te=_._container;te.stroked=!!$.stroke,te.filled=!!$.fill,$.stroke?(E||(E=_._stroke=sl("stroke")),te.appendChild(E),E.weight=$.weight+"px",E.color=$.color,E.opacity=$.opacity,$.dashArray?E.dashStyle=oe($.dashArray)?$.dashArray.join(" "):$.dashArray.replace(/( *, *)/g," "):E.dashStyle="",E.endcap=$.lineCap.replace("butt","flat"),E.joinstyle=$.lineJoin):E&&(te.removeChild(E),_._stroke=null),$.fill?(z||(z=_._fill=sl("fill")),te.appendChild(z),z.color=$.fillColor||$.color,z.opacity=$.fillOpacity):z&&(te.removeChild(z),_._fill=null)},_updateCircle:function(_){var E=_._point.round(),z=Math.round(_._radius),$=Math.round(_._radiusY||z);this._setPath(_,_._empty()?"M0 0":"AL "+E.x+","+E.y+" "+z+","+$+" 0,"+65535*360)},_setPath:function(_,E){_._path.v=E},_bringToFront:function(_){oa(_._container)},_bringToBack:function(_){Xs(_._container)}},Ol=ve.vml?sl:vt,da=Zt.extend({_initContainer:function(){this._container=Ol("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Ol("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){sr(this._container),pr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Zt.prototype._update.call(this);var _=this._bounds,E=_.getSize(),z=this._container;(!this._svgSize||!this._svgSize.equals(E))&&(this._svgSize=E,z.setAttribute("width",E.x),z.setAttribute("height",E.y)),Or(z,_.min),z.setAttribute("viewBox",[_.min.x,_.min.y,E.x,E.y].join(" ")),this.fire("update")}},_initPath:function(_){var E=_._path=Ol("path");_.options.className&&Kn(E,_.options.className),_.options.interactive&&Kn(E,"leaflet-interactive"),this._updateStyle(_),this._layers[j(_)]=_},_addPath:function(_){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(_._path),_.addInteractiveTarget(_._path)},_removePath:function(_){sr(_._path),_.removeInteractiveTarget(_._path),delete this._layers[j(_)]},_updatePath:function(_){_._project(),_._update()},_updateStyle:function(_){var E=_._path,z=_.options;E&&(z.stroke?(E.setAttribute("stroke",z.color),E.setAttribute("stroke-opacity",z.opacity),E.setAttribute("stroke-width",z.weight),E.setAttribute("stroke-linecap",z.lineCap),E.setAttribute("stroke-linejoin",z.lineJoin),z.dashArray?E.setAttribute("stroke-dasharray",z.dashArray):E.removeAttribute("stroke-dasharray"),z.dashOffset?E.setAttribute("stroke-dashoffset",z.dashOffset):E.removeAttribute("stroke-dashoffset")):E.setAttribute("stroke","none"),z.fill?(E.setAttribute("fill",z.fillColor||z.color),E.setAttribute("fill-opacity",z.fillOpacity),E.setAttribute("fill-rule",z.fillRule||"evenodd")):E.setAttribute("fill","none"))},_updatePoly:function(_,E){this._setPath(_,ai(_._parts,E))},_updateCircle:function(_){var E=_._point,z=Math.max(Math.round(_._radius),1),$=Math.max(Math.round(_._radiusY),1)||z,te="a"+z+","+$+" 0 1,0 ",Ce=_._empty()?"M0 0":"M"+(E.x-z)+","+E.y+te+z*2+",0 "+te+-z*2+",0 ";this._setPath(_,Ce)},_setPath:function(_,E){_._path.setAttribute("d",E)},_bringToFront:function(_){oa(_._path)},_bringToBack:function(_){Xs(_._path)}});ve.vml&&da.include(fu);function pu(_){return ve.svg||ve.vml?new da(_):null}Ii.include({getRenderer:function(_){var E=_.options.renderer||this._getPaneRenderer(_.options.pane)||this.options.renderer||this._renderer;return E||(E=this._renderer=this._createRenderer()),this.hasLayer(E)||this.addLayer(E),E},_getPaneRenderer:function(_){if(_==="overlayPane"||_===void 0)return!1;var E=this._paneRenderers[_];return E===void 0&&(E=this._createRenderer({pane:_}),this._paneRenderers[_]=E),E},_createRenderer:function(_){return this.options.preferCanvas&&nc(_)||pu(_)}});var wa=Gs.extend({initialize:function(_,E){Gs.prototype.initialize.call(this,this._boundsToLatLngs(_),E)},setBounds:function(_){return this.setLatLngs(this._boundsToLatLngs(_))},_boundsToLatLngs:function(_){return _=an(_),[_.getSouthWest(),_.getNorthWest(),_.getNorthEast(),_.getSouthEast()]}});function Vn(_,E){return new wa(_,E)}da.create=Ol,da.pointsToPath=ai,ba.geometryToLayer=rh,ba.coordsToLatLng=Ml,ba.coordsToLatLngs=ua,ba.latLngToCoords=Wh,ba.latLngsToCoords=pl,ba.getFeature=ec,ba.asFeature=tc,Ii.mergeOptions({boxZoom:!0});var rc=Mi.extend({initialize:function(_){this._map=_,this._container=_._container,this._pane=_._panes.overlayPane,this._resetStateTimeout=0,_.on("unload",this._destroy,this)},addHooks:function(){In(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){pr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){sr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(_){if(!_.shiftKey||_.which!==1&&_.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),mo(),go(),this._startPoint=this._map.mouseEventToContainerPoint(_),In(document,{contextmenu:Rn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(_){this._moved||(this._moved=!0,this._box=Hn("div","leaflet-zoom-box",this._container),Kn(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(_);var E=new di(this._point,this._startPoint),z=E.getSize();Or(this._box,E.min),this._box.style.width=z.x+"px",this._box.style.height=z.y+"px"},_finish:function(){this._moved&&(sr(this._box),Br(this._container,"leaflet-crosshair")),ao(),To(),pr(document,{contextmenu:Rn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(_){if(!(_.which!==1&&_.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(k(this._resetState,this),0);var E=new dn(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(E).fire("boxzoomend",{boxZoomBounds:E})}},_onKeyDown:function(_){_.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Ii.addInitHook("addHandler","boxZoom",rc),Ii.mergeOptions({doubleClickZoom:!0});var Kd=Mi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(_){var E=this._map,z=E.getZoom(),$=E.options.zoomDelta,te=_.originalEvent.shiftKey?z-$:z+$;E.options.doubleClickZoom==="center"?E.setZoom(te):E.setZoomAround(_.containerPoint,te)}});Ii.addInitHook("addHandler","doubleClickZoom",Kd),Ii.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Yd=Mi.extend({addHooks:function(){if(!this._draggable){var _=this._map;this._draggable=new Fs(_._mapPane,_._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),_.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),_.on("zoomend",this._onZoomEnd,this),_.whenReady(this._onZoomEnd,this))}Kn(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Br(this._map._container,"leaflet-grab"),Br(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var _=this._map;if(_._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var E=an(this._map.options.maxBounds);this._offsetLimit=ki(this._map.latLngToContainerPoint(E.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(E.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;_.fire("movestart").fire("dragstart"),_.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(_){if(this._map.options.inertia){var E=this._lastTime=+new Date,z=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(z),this._times.push(E),this._prunePositions(E)}this._map.fire("move",_).fire("drag",_)},_prunePositions:function(_){for(;this._positions.length>1&&_-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var _=this._map.getSize().divideBy(2),E=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=E.subtract(_).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(_,E){return _-(_-E)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var _=this._draggable._newPos.subtract(this._draggable._startPos),E=this._offsetLimit;_.x<E.min.x&&(_.x=this._viscousLimit(_.x,E.min.x)),_.y<E.min.y&&(_.y=this._viscousLimit(_.y,E.min.y)),_.x>E.max.x&&(_.x=this._viscousLimit(_.x,E.max.x)),_.y>E.max.y&&(_.y=this._viscousLimit(_.y,E.max.y)),this._draggable._newPos=this._draggable._startPos.add(_)}},_onPreDragWrap:function(){var _=this._worldWidth,E=Math.round(_/2),z=this._initialWorldOffset,$=this._draggable._newPos.x,te=($-E+z)%_+E-z,Ce=($+E+z)%_-E-z,dt=Math.abs(te+z)<Math.abs(Ce+z)?te:Ce;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=dt},_onDragEnd:function(_){var E=this._map,z=E.options,$=!z.inertia||_.noInertia||this._times.length<2;if(E.fire("dragend",_),$)E.fire("moveend");else{this._prunePositions(+new Date);var te=this._lastPos.subtract(this._positions[0]),Ce=(this._lastTime-this._times[0])/1e3,dt=z.easeLinearity,Vt=te.multiplyBy(dt/Ce),Qt=Vt.distanceTo([0,0]),Li=Math.min(z.inertiaMaxSpeed,Qt),mn=Vt.multiplyBy(Li/Qt),$n=Li/(z.inertiaDeceleration*dt),_r=mn.multiplyBy(-$n/2).round();!_r.x&&!_r.y?E.fire("moveend"):(_r=E._limitOffset(_r,E.options.maxBounds),Oe(function(){E.panBy(_r,{duration:$n,easeLinearity:dt,noMoveStart:!0,animate:!0})}))}}});Ii.addInitHook("addHandler","dragging",Yd),Ii.mergeOptions({keyboard:!0,keyboardPanDelta:80});var mu=Mi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(_){this._map=_,this._setPanDelta(_.options.keyboardPanDelta),this._setZoomDelta(_.options.zoomDelta)},addHooks:function(){var _=this._map._container;_.tabIndex<=0&&(_.tabIndex="0"),In(_,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),pr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var _=document.body,E=document.documentElement,z=_.scrollTop||E.scrollTop,$=_.scrollLeft||E.scrollLeft;this._map._container.focus(),window.scrollTo($,z)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(_){var E=this._panKeys={},z=this.keyCodes,$,te;for($=0,te=z.left.length;$<te;$++)E[z.left[$]]=[-1*_,0];for($=0,te=z.right.length;$<te;$++)E[z.right[$]]=[_,0];for($=0,te=z.down.length;$<te;$++)E[z.down[$]]=[0,_];for($=0,te=z.up.length;$<te;$++)E[z.up[$]]=[0,-1*_]},_setZoomDelta:function(_){var E=this._zoomKeys={},z=this.keyCodes,$,te;for($=0,te=z.zoomIn.length;$<te;$++)E[z.zoomIn[$]]=_;for($=0,te=z.zoomOut.length;$<te;$++)E[z.zoomOut[$]]=-_},_addHooks:function(){In(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){pr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(_){if(!(_.altKey||_.ctrlKey||_.metaKey)){var E=_.keyCode,z=this._map,$;if(E in this._panKeys){if(!z._panAnim||!z._panAnim._inProgress)if($=this._panKeys[E],_.shiftKey&&($=Ti($).multiplyBy(3)),z.options.maxBounds&&($=z._limitOffset(Ti($),z.options.maxBounds)),z.options.worldCopyJump){var te=z.wrapLatLng(z.unproject(z.project(z.getCenter()).add($)));z.panTo(te)}else z.panBy($)}else if(E in this._zoomKeys)z.setZoom(z.getZoom()+(_.shiftKey?3:1)*this._zoomKeys[E]);else if(E===27&&z._popup&&z._popup.options.closeOnEscapeKey)z.closePopup();else return;Rn(_)}}});Ii.addInitHook("addHandler","keyboard",mu),Ii.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Jd=Mi.extend({addHooks:function(){In(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){pr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(_){var E=Qa(_),z=this._map.options.wheelDebounceTime;this._delta+=E,this._lastMousePos=this._map.mouseEventToContainerPoint(_),this._startTime||(this._startTime=+new Date);var $=Math.max(z-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(k(this._performZoom,this),$),Rn(_)},_performZoom:function(){var _=this._map,E=_.getZoom(),z=this._map.options.zoomSnap||0;_._stop();var $=this._delta/(this._map.options.wheelPxPerZoomLevel*4),te=4*Math.log(2/(1+Math.exp(-Math.abs($))))/Math.LN2,Ce=z?Math.ceil(te/z)*z:te,dt=_._limitZoom(E+(this._delta>0?Ce:-Ce))-E;this._delta=0,this._startTime=null,dt&&(_.options.scrollWheelZoom==="center"?_.setZoom(E+dt):_.setZoomAround(this._lastMousePos,E+dt))}});Ii.addInitHook("addHandler","scrollWheelZoom",Jd);var Jr=600;Ii.mergeOptions({tapHold:ve.touchNative&&ve.safari&&ve.mobile,tapTolerance:15});var Kh=Mi.extend({addHooks:function(){In(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){pr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(_){if(clearTimeout(this._holdTimeout),_.touches.length===1){var E=_.touches[0];this._startPos=this._newPos=new wt(E.clientX,E.clientY),this._holdTimeout=setTimeout(k(function(){this._cancel(),this._isTapValid()&&(In(document,"touchend",ms),In(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",E))},this),Jr),In(document,"touchend touchcancel contextmenu",this._cancel,this),In(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function _(){pr(document,"touchend",ms),pr(document,"touchend touchcancel",_)},_cancel:function(){clearTimeout(this._holdTimeout),pr(document,"touchend touchcancel contextmenu",this._cancel,this),pr(document,"touchmove",this._onMove,this)},_onMove:function(_){var E=_.touches[0];this._newPos=new wt(E.clientX,E.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(_,E){var z=new MouseEvent(_,{bubbles:!0,cancelable:!0,view:window,screenX:E.screenX,screenY:E.screenY,clientX:E.clientX,clientY:E.clientY});z._simulated=!0,E.target.dispatchEvent(z)}});Ii.addInitHook("addHandler","tapHold",Kh),Ii.mergeOptions({touchZoom:ve.touch,bounceAtZoomLimits:!0});var ch=Mi.extend({addHooks:function(){Kn(this._map._container,"leaflet-touch-zoom"),In(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Br(this._map._container,"leaflet-touch-zoom"),pr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(_){var E=this._map;if(!(!_.touches||_.touches.length!==2||E._animatingZoom||this._zooming)){var z=E.mouseEventToContainerPoint(_.touches[0]),$=E.mouseEventToContainerPoint(_.touches[1]);this._centerPoint=E.getSize()._divideBy(2),this._startLatLng=E.containerPointToLatLng(this._centerPoint),E.options.touchZoom!=="center"&&(this._pinchStartLatLng=E.containerPointToLatLng(z.add($)._divideBy(2))),this._startDist=z.distanceTo($),this._startZoom=E.getZoom(),this._moved=!1,this._zooming=!0,E._stop(),In(document,"touchmove",this._onTouchMove,this),In(document,"touchend touchcancel",this._onTouchEnd,this),ms(_)}},_onTouchMove:function(_){if(!(!_.touches||_.touches.length!==2||!this._zooming)){var E=this._map,z=E.mouseEventToContainerPoint(_.touches[0]),$=E.mouseEventToContainerPoint(_.touches[1]),te=z.distanceTo($)/this._startDist;if(this._zoom=E.getScaleZoom(te,this._startZoom),!E.options.bounceAtZoomLimits&&(this._zoom<E.getMinZoom()&&te<1||this._zoom>E.getMaxZoom()&&te>1)&&(this._zoom=E._limitZoom(this._zoom)),E.options.touchZoom==="center"){if(this._center=this._startLatLng,te===1)return}else{var Ce=z._add($)._divideBy(2)._subtract(this._centerPoint);if(te===1&&Ce.x===0&&Ce.y===0)return;this._center=E.unproject(E.project(this._pinchStartLatLng,this._zoom).subtract(Ce),this._zoom)}this._moved||(E._moveStart(!0,!1),this._moved=!0),He(this._animRequest);var dt=k(E._move,E,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Oe(dt,this,!0),ms(_)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,He(this._animRequest),pr(document,"touchmove",this._onTouchMove,this),pr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Ii.addInitHook("addHandler","touchZoom",ch),Ii.BoxZoom=rc,Ii.DoubleClickZoom=Kd,Ii.Drag=Yd,Ii.Keyboard=mu,Ii.ScrollWheelZoom=Jd,Ii.TapHold=Kh,Ii.TouchZoom=ch,y.Bounds=di,y.Browser=ve,y.CRS=pi,y.Canvas=lh,y.Circle=ou,y.CircleMarker=dl,y.Class=tt,y.Control=Un,y.DivIcon=oh,y.DivOverlay=$a,y.DomEvent=Mt,y.DomUtil=Es,y.Draggable=Fs,y.Evented=si,y.FeatureGroup=$o,y.GeoJSON=ba,y.GridLayer=rl,y.Handler=Mi,y.Icon=Yo,y.ImageOverlay=sh,y.LatLng=mt,y.LatLngBounds=dn,y.Layer=As,y.LayerGroup=cn,y.LineUtil=Bs,y.Map=Ii,y.Marker=il,y.Mixin=va,y.Path=Ra,y.Point=wt,y.PolyUtil=or,y.Polygon=Gs,y.Polyline=qs,y.Popup=uu,y.PosAnimation=Ai,y.Projection=Mo,y.Rectangle=wa,y.Renderer=Zt,y.SVG=da,y.SVGOverlay=cu,y.TileLayer=Rl,y.Tooltip=nl,y.Transformation=un,y.Util=ft,y.VideoOverlay=lu,y.bind=k,y.bounds=ki,y.canvas=nc,y.circle=fl,y.circleMarker=vs,y.control=wr,y.divIcon=Xh,y.extend=P,y.featureGroup=Xi,y.geoJSON=ml,y.geoJson=ic,y.gridLayer=Pc,y.icon=tl,y.imageOverlay=Ep,y.latLng=Pt,y.latLngBounds=an,y.layerGroup=mi,y.map=Xr,y.marker=Ql,y.point=Ti,y.polygon=Zd,y.polyline=Cl,y.popup=Xd,y.rectangle=Vn,y.setOptions=he,y.stamp=j,y.svg=pu,y.svgOverlay=Oa,y.tileLayer=du,y.tooltip=hu,y.transformation=Qi,y.version=S,y.videoOverlay=Wd;var Ap=window.L;y.noConflict=function(){return window.L=Ap,this},window.L=y}))})(l_,l_.exports)),l_.exports}var b6=x6();const rR=dv(b6);var By={exports:{}},w6=By.exports,DP;function T6(){return DP||(DP=1,(function(a,d){(function(y,S){a.exports=S()})(w6,(function(){var y,S,P;function M(r,j){if(!y)y=j;else if(!S)S=j;else{var H="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+y+")(sharedChunk); ("+S+")(sharedChunk); self.onerror = null;",W={};y(W),P=j(W),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(P.workerUrl=window.URL.createObjectURL(new Blob([H],{type:"text/javascript"})))}}M(["exports"],(function(r){var j=1e-6,H=typeof Float32Array<"u"?Float32Array:Array;function W(n,e){var i=e[0],o=e[1],c=e[2],f=e[3],p=i*f-c*o;return p?(n[0]=f*(p=1/p),n[1]=-o*p,n[2]=-c*p,n[3]=i*p,n):null}function ee(){var n=new H(9);return H!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function le(n,e){var i=e[0],o=e[1],c=e[2],f=e[3],p=e[4],v=e[5],b=e[6],T=e[7],I=e[8];return n[0]=p*I-v*T,n[1]=c*T-o*I,n[2]=o*v-c*p,n[3]=v*b-f*I,n[4]=i*I-c*b,n[5]=c*f-i*v,n[6]=f*T-p*b,n[7]=o*b-i*T,n[8]=i*p-o*f,n}function pe(n,e,i){var o=e[0],c=e[1],f=e[2],p=e[3],v=e[4],b=e[5],T=e[6],I=e[7],C=e[8],O=i[0],B=i[1],N=i[2],X=i[3],K=i[4],Y=i[5],ue=i[6],de=i[7],_e=i[8];return n[0]=O*o+B*p+N*T,n[1]=O*c+B*v+N*I,n[2]=O*f+B*b+N*C,n[3]=X*o+K*p+Y*T,n[4]=X*c+K*v+Y*I,n[5]=X*f+K*b+Y*C,n[6]=ue*o+de*p+_e*T,n[7]=ue*c+de*v+_e*I,n[8]=ue*f+de*b+_e*C,n}function se(){var n=new H(16);return H!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function he(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Te(n,e){var i=e[0],o=e[1],c=e[2],f=e[3],p=e[4],v=e[5],b=e[6],T=e[7],I=e[8],C=e[9],O=e[10],B=e[11],N=e[12],X=e[13],K=e[14],Y=e[15],ue=i*v-o*p,de=i*b-c*p,_e=i*T-f*p,ze=o*b-c*v,ke=o*T-f*v,Ue=c*T-f*b,qe=I*X-C*N,Ze=I*K-O*N,Et=I*Y-B*N,Je=C*K-O*X,Ot=C*Y-B*X,jt=O*Y-B*K,Lt=ue*jt-de*Ot+_e*Je+ze*Et-ke*Ze+Ue*qe;return Lt?(n[0]=(v*jt-b*Ot+T*Je)*(Lt=1/Lt),n[1]=(c*Ot-o*jt-f*Je)*Lt,n[2]=(X*Ue-K*ke+Y*ze)*Lt,n[3]=(O*ke-C*Ue-B*ze)*Lt,n[4]=(b*Et-p*jt-T*Ze)*Lt,n[5]=(i*jt-c*Et+f*Ze)*Lt,n[6]=(K*_e-N*Ue-Y*de)*Lt,n[7]=(I*Ue-O*_e+B*de)*Lt,n[8]=(p*Ot-v*Et+T*qe)*Lt,n[9]=(o*Et-i*Ot-f*qe)*Lt,n[10]=(N*ke-X*_e+Y*ue)*Lt,n[11]=(C*_e-I*ke-B*ue)*Lt,n[12]=(v*Ze-p*Je-b*qe)*Lt,n[13]=(i*Je-o*Ze+c*qe)*Lt,n[14]=(X*de-N*ze-K*ue)*Lt,n[15]=(I*ze-C*de+O*ue)*Lt,n):null}function Se(n,e,i){var o=e[0],c=e[1],f=e[2],p=e[3],v=e[4],b=e[5],T=e[6],I=e[7],C=e[8],O=e[9],B=e[10],N=e[11],X=e[12],K=e[13],Y=e[14],ue=e[15],de=i[0],_e=i[1],ze=i[2],ke=i[3];return n[0]=de*o+_e*v+ze*C+ke*X,n[1]=de*c+_e*b+ze*O+ke*K,n[2]=de*f+_e*T+ze*B+ke*Y,n[3]=de*p+_e*I+ze*N+ke*ue,n[4]=(de=i[4])*o+(_e=i[5])*v+(ze=i[6])*C+(ke=i[7])*X,n[5]=de*c+_e*b+ze*O+ke*K,n[6]=de*f+_e*T+ze*B+ke*Y,n[7]=de*p+_e*I+ze*N+ke*ue,n[8]=(de=i[8])*o+(_e=i[9])*v+(ze=i[10])*C+(ke=i[11])*X,n[9]=de*c+_e*b+ze*O+ke*K,n[10]=de*f+_e*T+ze*B+ke*Y,n[11]=de*p+_e*I+ze*N+ke*ue,n[12]=(de=i[12])*o+(_e=i[13])*v+(ze=i[14])*C+(ke=i[15])*X,n[13]=de*c+_e*b+ze*O+ke*K,n[14]=de*f+_e*T+ze*B+ke*Y,n[15]=de*p+_e*I+ze*N+ke*ue,n}function fe(n,e,i){var o,c,f,p,v,b,T,I,C,O,B,N,X=i[0],K=i[1],Y=i[2];return e===n?(n[12]=e[0]*X+e[4]*K+e[8]*Y+e[12],n[13]=e[1]*X+e[5]*K+e[9]*Y+e[13],n[14]=e[2]*X+e[6]*K+e[10]*Y+e[14],n[15]=e[3]*X+e[7]*K+e[11]*Y+e[15]):(c=e[1],f=e[2],p=e[3],v=e[4],b=e[5],T=e[6],I=e[7],C=e[8],O=e[9],B=e[10],N=e[11],n[0]=o=e[0],n[1]=c,n[2]=f,n[3]=p,n[4]=v,n[5]=b,n[6]=T,n[7]=I,n[8]=C,n[9]=O,n[10]=B,n[11]=N,n[12]=o*X+v*K+C*Y+e[12],n[13]=c*X+b*K+O*Y+e[13],n[14]=f*X+T*K+B*Y+e[14],n[15]=p*X+I*K+N*Y+e[15]),n}function oe(n,e,i){var o=i[0],c=i[1],f=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function ge(n,e,i){var o=Math.sin(i),c=Math.cos(i),f=e[4],p=e[5],v=e[6],b=e[7],T=e[8],I=e[9],C=e[10],O=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*c+T*o,n[5]=p*c+I*o,n[6]=v*c+C*o,n[7]=b*c+O*o,n[8]=T*c-f*o,n[9]=I*c-p*o,n[10]=C*c-v*o,n[11]=O*c-b*o,n}function Ge(n,e,i){var o=Math.sin(i),c=Math.cos(i),f=e[0],p=e[1],v=e[2],b=e[3],T=e[8],I=e[9],C=e[10],O=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*c-T*o,n[1]=p*c-I*o,n[2]=v*c-C*o,n[3]=b*c-O*o,n[8]=f*o+T*c,n[9]=p*o+I*c,n[10]=v*o+C*c,n[11]=b*o+O*c,n}function xt(n,e,i){var o=Math.sin(i),c=Math.cos(i),f=e[0],p=e[1],v=e[2],b=e[3],T=e[4],I=e[5],C=e[6],O=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*c+T*o,n[1]=p*c+I*o,n[2]=v*c+C*o,n[3]=b*c+O*o,n[4]=T*c-f*o,n[5]=I*c-p*o,n[6]=C*c-v*o,n[7]=O*c-b*o,n}function It(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ot(n,e,i){var o,c,f,p=i[0],v=i[1],b=i[2],T=Math.sqrt(p*p+v*v+b*b);return T<j?null:(p*=T=1/T,v*=T,b*=T,o=Math.sin(e),c=Math.cos(e),n[0]=p*p*(f=1-c)+c,n[1]=v*p*f+b*o,n[2]=b*p*f-v*o,n[3]=0,n[4]=p*v*f-b*o,n[5]=v*v*f+c,n[6]=b*v*f+p*o,n[7]=0,n[8]=p*b*f+v*o,n[9]=v*b*f-p*o,n[10]=b*b*f+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Be(n,e){var i=e[0],o=e[1],c=e[2],f=e[3],p=i+i,v=o+o,b=c+c,T=i*p,I=o*p,C=o*v,O=c*p,B=c*v,N=c*b,X=f*p,K=f*v,Y=f*b;return n[0]=1-C-N,n[1]=I+Y,n[2]=O-K,n[3]=0,n[4]=I-Y,n[5]=1-T-N,n[6]=B+X,n[7]=0,n[8]=O+K,n[9]=B-X,n[10]=1-T-C,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var De=Se;function Oe(){var n=new H(3);return H!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function He(n){var e=new H(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function ft(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function tt(n,e,i){var o=new H(3);return o[0]=n,o[1]=e,o[2]=i,o}function At(n,e,i,o){return n[0]=e,n[1]=i,n[2]=o,n}function yt(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function si(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function wt(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Gi(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Ti(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function di(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function ki(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n}function dn(n,e){var i=e[0]-n[0],o=e[1]-n[1],c=e[2]-n[2];return i*i+o*o+c*c}function an(n){var e=n[0],i=n[1],o=n[2];return e*e+i*i+o*o}function mt(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Pt(n,e){var i=e[0],o=e[1],c=e[2],f=i*i+o*o+c*c;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function pi(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Ui(n,e,i){var o=e[0],c=e[1],f=e[2],p=i[0],v=i[1],b=i[2];return n[0]=c*b-f*v,n[1]=f*p-o*b,n[2]=o*v-c*p,n}function ei(n,e,i,o){var c=e[0],f=e[1],p=e[2];return n[0]=c+o*(i[0]-c),n[1]=f+o*(i[1]-f),n[2]=p+o*(i[2]-p),n}function _i(n,e,i){var o=e[0],c=e[1],f=e[2],p=i[3]*o+i[7]*c+i[11]*f+i[15];return n[0]=(i[0]*o+i[4]*c+i[8]*f+i[12])/(p=p||1),n[1]=(i[1]*o+i[5]*c+i[9]*f+i[13])/p,n[2]=(i[2]*o+i[6]*c+i[10]*f+i[14])/p,n}function un(n,e,i){var o=e[0],c=e[1],f=e[2];return n[0]=o*i[0]+c*i[3]+f*i[6],n[1]=o*i[1]+c*i[4]+f*i[7],n[2]=o*i[2]+c*i[5]+f*i[8],n}function Qi(n,e,i){var o=i[0],c=i[1],f=i[2],p=i[3],v=e[0],b=e[1],T=e[2],I=c*T-f*b,C=f*v-o*T,O=o*b-c*v;return n[0]=v+p*(I+=I)+c*(O+=O)-f*(C+=C),n[1]=b+p*C+f*I-o*O,n[2]=T+p*O+o*C-c*I,n}function $e(n){return n[0]=0,n[1]=0,n[2]=0,n}function lt(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var vt=si,ai=wt,ii=ft;function ci(){var n=new H(4);return H!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Ei(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function bi(n,e){var i=e[0],o=e[1],c=e[2],f=e[3],p=i*i+o*o+c*c+f*f;return p>0&&(p=1/Math.sqrt(p)),n[0]=i*p,n[1]=o*p,n[2]=c*p,n[3]=f*p,n}function ui(n,e,i){var o=e[0],c=e[1],f=e[2],p=e[3];return n[0]=i[0]*o+i[4]*c+i[8]*f+i[12]*p,n[1]=i[1]*o+i[5]*c+i[9]*f+i[13]*p,n[2]=i[2]*o+i[6]*c+i[10]*f+i[14]*p,n[3]=i[3]*o+i[7]*c+i[11]*f+i[15]*p,n}function vi(){var n=new H(4);return H!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function sn(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Hi(n,e,i){i*=.5;var o=e[0],c=e[1],f=e[2],p=e[3],v=Math.sin(i),b=Math.cos(i);return n[0]=o*b+p*v,n[1]=c*b+f*v,n[2]=f*b-c*v,n[3]=p*b-o*v,n}function $i(n,e,i){i*=.5;var o=e[0],c=e[1],f=e[2],p=e[3],v=Math.sin(i),b=Math.cos(i);return n[0]=o*b-f*v,n[1]=c*b+p*v,n[2]=f*b+o*v,n[3]=p*b-c*v,n}Oe(),ci();var fn,Nn,br,Xn=bi,is=(fn=Oe(),Nn=tt(1,0,0),br=tt(0,1,0),function(n,e,i){var o=pi(e,i);return o<-.999999?(Ui(fn,Nn,e),ii(fn)<1e-6&&Ui(fn,br,e),Pt(fn,fn),(function(c,f,p){p*=.5;var v=Math.sin(p);c[0]=v*f[0],c[1]=v*f[1],c[2]=v*f[2],c[3]=Math.cos(p)})(n,fn,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Ui(fn,e,i),n[0]=fn[0],n[1]=fn[1],n[2]=fn[2],n[3]=1+o,Xn(n,n))});function Qn(){var n=new H(2);return H!=Float32Array&&(n[0]=0,n[1]=0),n}function Wr(n,e){var i=new H(2);return i[0]=n,i[1]=e,i}function ns(n,e,i){return n[0]=e,n[1]=i,n}function Dr(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function ds(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function Rt(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function Dt(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)}function en(n,e){var i=e[0],o=e[1],c=i*i+o*o;return c>0&&(c=1/Math.sqrt(c)),n[0]=e[0]*c,n[1]=e[1]*c,n}function Dn(n,e){return n[0]*e[0]+n[1]*e[1]}vi(),vi(),ee();var ir,jn,rs=ds;function Os(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Qn();var fs=(function(){if(jn)return ir;function n(e,i,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=c}return jn=1,ir=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var v=0,b=1;for(o=e,c=0;c<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));c++)e>f?v=o:b=o,o=.5*(b-v)+v;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ir})(),fo=Os(fs);function kt(n,e){this.x=n,this.y=e}function ls(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!ls(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!ls(n[i],e[i]))return!1;return!0}return n===e}kt.prototype={clone(){return new kt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),c=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:kt},kt.convert=function(n){if(n instanceof kt)return n;if(Array.isArray(n))return new kt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new kt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ss=Math.PI/180,wo=180/Math.PI;function Xe(n){return n*Ss}function Q(n){return n*wo}const ne=[[0,0],[1,0],[1,1],[0,1]];function be(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Fe(n,e,i,o){const c=new fo(n,e,i,o);return function(f){return c.solve(f)}}const ve=Fe(.25,.1,.25,1);function Le(n,e,i){return Math.min(i,Math.max(e,n))}function rt(n,e,i){return(i=Le((i-n)/(e-n),0,1))*i*(3-2*i)}function je(n,e,i){const o=i-e,c=((n-e)%o+o)%o+e;return c===e?i:c}function st(n,e,i){if(!n.length)return i(null,[]);let o=n.length;const c=new Array(n.length);let f=null;n.forEach(((p,v)=>{e(p,((b,T)=>{b&&(f=b),c[v]=T,--o==0&&i(f,c)}))}))}let Nt=1;function Ct(){return Nt++}function wi(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function qi(n,e){n.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function Ki(n,e,i){const o={};for(const c in n)o[c]=e.call(this,n[c],c,n);return o}function pn(n,e,i){const o={};for(const c in n)e.call(this,n[c],c,n)&&(o[c]=n[c]);return o}function Ji(n){return Array.isArray(n)?n.map(Ji):typeof n=="object"&&n?Ki(n,Ji):n}function Mn(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const er={};function An(n){er[n]||(typeof console<"u"&&console.warn(n),er[n]=!0)}function Mr(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ss(n){let e=0;for(let i,o,c=0,f=n.length,p=f-1;c<f;p=c++)i=n[c],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}function zr([n,e,i]){const o=Xe(e+90),c=Xe(i);return{x:n*Math.cos(o)*Math.sin(c),y:n*Math.sin(o)*Math.sin(c),z:n*Math.cos(c),azimuthal:e,polar:i}}function rr(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Zn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,c,f)=>{const p=c||f;return e[o]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let kr=null;function Rr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Gn(n,e,i,o){for(;e<i;){const c=e+i>>1;n[c]<o?e=c+1:i=c}return e}function ps(n,e,i,o){for(;e<i;){const c=e+i>>1;n[c]<=o?e=c+1:i=c}return e}function gs(n){return n>0?1/(1.001-n):1+n}function zs(n){return n>0?1-1/(1.001-n):-n}function Hn(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const sr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!sr.API_URL)return null;try{const n=new URL(sr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Wo(n){return sr.API_URL_REGEX.test(n)}function oa(n){return sr.API_SPRITE_REGEX.test(n)}let Xs,aa,Kn,Br,po,ks;function Ls(){return Xs==null&&(Xs=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Xs}const oo={now:()=>Br!==void 0?Br:performance.now(),setNow(n){Br=n},restoreNow(){Br=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:o}=n;po||(po=document.createElement("canvas"));const c=po.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>po.width||o>po.height)&&(po.width=i,po.height=o),c.clearRect(-e,-e,i+2*e,o+2*e),c.drawImage(n,0,0,i,o),c.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:n=>(aa||(aa=document.createElement("a")),aa.href=n,aa.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Kn==null&&(Kn=window.matchMedia("(prefers-reduced-motion: reduce)")),Kn.matches)},hasCanvasFingerprintNoise(){if(ks!==void 0)return ks;if(!Ls())return ks=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<n.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const o=e.getImageData(0,0,n.width,n.height);i=0;for(let c=0;c<o.data.length;++c)if(c%4!=3&&i++!==o.data[c])return ks=!0,!0;return ks=!1,!1}};function Ia(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(n.slice(i));for(const c in e)o.set(c,e[c]);return`${n.slice(0,i)}?${o.toString()}`}function Vo(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const o=new URLSearchParams,c=new URLSearchParams(n.slice(i));for(const p of e.persistentParams){const v=c.get(p);v&&o.set(p,v)}const f=o.toString();return`${n.slice(0,i)}${f.length>0?`?${f}`:""}`}const Or="mapbox-tiles";let Vs=500,mo=50;const ao=["language","worldview","jobid"];let js,_o;function go(){try{return caches}catch{}}function To(){const n=go();n&&js==null&&(js=n.open(Or))}let ko=1/0;const _t={supported:!1,testSupport:function(n){!Fn&&Pi&&(xr?In(n):Jt=n)}};let Jt,Pi,Fn=!1,xr=!1;const Es=typeof self<"u"?self:{};function In(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Pi),n.isContextLost())return;_t.supported=!0}catch{}n.deleteTexture(e),Fn=!0}Es.document&&(Pi=Es.document.createElement("img"),Pi.onload=function(){Jt&&In(Jt),Jt=null,xr=!0},Pi.onerror=function(){Fn=!0,Jt=null},Pi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const fr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(fr);class pr extends Error{constructor(e,i,o){i===401&&Wo(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Js=rr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Pn=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Js())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(o,c){const f=new AbortController,p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:Js(),referrerPolicy:o.referrerPolicy,signal:f.signal});let v=!1,b=!1;const T=(I=p.url).indexOf("sku=")>0&&Wo(I);var I;o.type==="json"&&p.headers.set("Accept","application/json");const C=(B,N,X)=>{if(b)return;if(B&&B.message!=="SecurityError"&&An(B.toString()),N&&X)return O(N);const K=Date.now();fetch(p).then((Y=>{if(Y.ok){const ue=T?Y.clone():null;return O(Y,ue,K)}return c(new pr(Y.statusText,Y.status,o.url))})).catch((Y=>{Y.name!=="AbortError"&&c(new Error(`${Y.message} ${o.url}`))}))},O=(B,N,X)=>{(o.type==="arrayBuffer"?B.arrayBuffer():o.type==="json"?B.json():B.text()).then((K=>{b||(N&&X&&(function(Y,ue,de){if(To(),js==null)return;const _e=Zn(ue.headers.get("Cache-Control")||"");if(_e["no-store"])return;const ze={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach(((qe,Ze)=>ze.headers.set(Ze,qe))),_e["max-age"]&&ze.headers.set("Expires",new Date(de+1e3*_e["max-age"]).toUTCString());const ke=ze.headers.get("Expires");if(!ke||new Date(ke).getTime()-de<42e4)return;let Ue=Vo(Y.url,{persistentParams:ao});if(ue.status===206){const qe=Y.headers.get("Range");if(!qe)return;ze.status=200,Ue=Ia(Ue,{range:qe})}(function(qe,Ze){if(_o===void 0)try{new Response(new ReadableStream),_o=!0}catch{_o=!1}_o?Ze(qe.body):qe.blob().then(Ze).catch((Et=>An(Et.message)))})(ue,(qe=>{const Ze=new Response((Et=ue.status)!==200&&Et!==404&&[101,103,204,205,304].includes(Et)?null:qe,ze);var Et;To(),js?.then((Je=>Je.put(Ue,Ze))).catch((Je=>An(Je.message)))}))})(p,N,X),v=!0,c(null,K,B.headers.get("Cache-Control"),B.headers.get("Expires")))})).catch((K=>{b||c(new Error(K.message))}))};return T?(function(B,N){if(To(),js==null)return N(null);js.then((X=>{let K=Vo(B.url,{persistentParams:ao});const Y=B.headers.get("Range");Y&&(K=Ia(K,{range:Y})),X.match(K).then((ue=>{const de=(function(_e){if(!_e)return!1;const ze=new Date(_e.headers.get("Expires")||0),ke=Zn(_e.headers.get("Cache-Control")||"");return Number(ze)>Date.now()&&!ke["no-cache"]})(ue);X.delete(K).catch(N),de&&X.put(K,ue.clone()).catch(N),N(null,ue,de)})).catch(N)})).catch(N)})(p,C):C(null,null),{cancel:()=>{b=!0,v||f.abort()}}})(n,e);if(rr(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return(function(o,c){const f=new XMLHttpRequest;f.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const p in o.headers)f.setRequestHeader(p,o.headers[p]);return o.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=o.credentials==="include",f.onerror=()=>{c(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let p=f.response;if(o.type==="json")try{p=JSON.parse(f.response)}catch(v){return c(v)}c(null,p,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else c(new pr(f.statusText,f.status,o.url))},f.send(o.body),{cancel:()=>f.abort()}})(n,e)},Ps=function(n,e){return Pn(Object.assign(n,{type:"arrayBuffer"}),e)};function Pa(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const la="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let jo,Qs;jo=[],Qs=0;const ms=function(n,e){if(_t.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Qs>=sr.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return jo.push(f),f}Qs++;let i=!1;const o=()=>{if(!i)for(i=!0,Qs--;jo.length&&Qs<sr.MAX_PARALLEL_IMAGE_REQUESTS;){const f=jo.shift(),{requestParameters:p,callback:v,cancelled:b}=f;b||(f.cancel=ms(p,v).cancel)}},c=Ps(n,((f,p,v,b)=>{o(),f?e(f):p&&(self.createImageBitmap?(function(T,I){const C=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(C).then((O=>{I(null,O)})).catch((O=>{I(new Error(`Could not load image because of ${O.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(p,((T,I)=>e(T,I,v,b))):(function(T,I){const C=new Image;C.onload=()=>{I(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame((()=>{C.src=la}))},C.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new Blob([new Uint8Array(T)],{type:"image/png"});C.src=T.byteLength?URL.createObjectURL(O):la})(p,((T,I)=>e(T,I,v,b))))}));return{cancel:()=>{c.cancel(),o()}}};var Rn,Fo,Ca,ca={exports:{}},Qa={exports:{}},Ke={exports:{}},Mt=(function(){if(Ca)return ca.exports;Ca=1;var n=(Rn||(Rn=1,Qa.exports=function(i,o){var c,f,p,v,b,T,I,C;for(f=i.length-(c=3&i.length),p=o,b=3432918353,T=461845907,C=0;C<f;)I=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,p=27492+(65535&(v=5*(65535&(p=(p^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&i.charCodeAt(C+2))<<16;case 2:I^=(255&i.charCodeAt(C+1))<<8;case 1:p^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(C)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Qa.exports),e=(Fo||(Fo=1,Ke.exports=function(i,o){for(var c,f=i.length,p=o^f,v=0;f>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(c>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:p^=(255&i.charCodeAt(v+2))<<16;case 2:p^=(255&i.charCodeAt(v+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(v)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Ke.exports);return ca.exports=n,ca.exports.murmur3=n,ca.exports.murmur2=e,ca.exports})(),Ai=Os(Mt);class Ii{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Xr extends Ii{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function Un(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function wr(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class ys{on(e,i){return this._listeners=this._listeners||{},Un(e,i,this._listeners),this}off(e,i){return wr(e,i,this._listeners),wr(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Un(e,i,this._oneTimeListeners),this):new Promise((o=>{this.once(e,o)}))}fire(e,i){const o=typeof e=="string"?new Ii(e,i):e,c=o.type;if(this.listens(c)){o.target=this;const f=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const b of f)b.call(this,o);const p=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const b of p)wr(c,b,this._oneTimeListeners),b.call(this,o);const v=this._eventedParent;if(v){const b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(o,b),v.fire(o)}}else o instanceof Xr&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Kr{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Kr(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,o]=e.split("");return new Kr({name:i,iconsetId:o})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Kr.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var _s,yo={},Po=(function(){if(_s)return yo;_s=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function i(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function o(f){return(p=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:p>1?1:p;var p}function c(f,p,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?f+(p-f)*v*6:2*v<1?p:3*v<2?f+(p-f)*(2/3-v)*6:f}try{yo.parseCSSColor=function(f){var p,v=f.replace(/ /g,"").toLowerCase();if(v in n)return n[v].slice();if(v[0]==="#")return v.length===4?(p=parseInt(v.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:v.length===7&&(p=parseInt(v.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var b=v.indexOf("("),T=v.indexOf(")");if(b!==-1&&T+1===v.length){var I=v.substr(0,b),C=v.substr(b+1,T-(b+1)).split(","),O=1;switch(I){case"rgba":if(C.length!==4)return null;O=o(C.pop());case"rgb":return C.length!==3?null:[i(C[0]),i(C[1]),i(C[2]),O];case"hsla":if(C.length!==4)return null;O=o(C.pop());case"hsl":if(C.length!==3)return null;var B=(parseFloat(C[0])%360+360)%360/360,N=o(C[1]),X=o(C[2]),K=X<=.5?X*(N+1):X+N-X*N,Y=2*X-K;return[e(255*c(Y,K,B+1/3)),e(255*c(Y,K,B)),e(255*c(Y,K,B-1/3)),O];default:return null}}return null}}catch{}return yo})();class Cn{constructor(e,i,o,c=1){this.r=e,this.g=i,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof Cn)return e;if(typeof e!="string")return;const i=Po.parseCSSColor(e);return i?new Cn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,o,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${c})`}toNonPremultipliedRenderColor(e){const{r:i,g:o,b:c,a:f}=this;return new So(e,i,o,c,f)}toPremultipliedRenderColor(e){const{r:i,g:o,b:c,a:f}=this;return new Xo(e,i*f,o*f,c*f,f)}clone(){return new Cn(this.r,this.g,this.b,this.a)}}class Co{constructor(e,i,o,c,f,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){const v=e.image.height,b=v*v;this.premultiplied?(i=f===0?0:i/f*(v-1),o=f===0?0:o/f*(v-1),c=f===0?0:c/f*(v-1)):(i*=v-1,o*=v-1,c*=v-1);const T=Math.floor(i),I=Math.floor(o),C=Math.floor(c),O=Math.ceil(i),B=Math.ceil(o),N=Math.ceil(c),X=i-T,K=o-I,Y=c-C,ue=e.image.data,de=4*(T+I*b+C*v),_e=4*(T+I*b+N*v),ze=4*(T+B*b+C*v),ke=4*(T+B*b+N*v),Ue=4*(O+I*b+C*v),qe=4*(O+I*b+N*v),Ze=4*(O+B*b+C*v),Et=4*(O+B*b+N*v);if(de<0||Et>=ue.length)throw new Error("out of range");this.r=Mi(Mi(Mi(ue[de],ue[_e],Y),Mi(ue[ze],ue[ke],Y),K),Mi(Mi(ue[Ue],ue[qe],Y),Mi(ue[Ze],ue[Et],Y),K),X)/255*(this.premultiplied?f:1),this.g=Mi(Mi(Mi(ue[de+1],ue[_e+1],Y),Mi(ue[ze+1],ue[ke+1],Y),K),Mi(Mi(ue[Ue+1],ue[qe+1],Y),Mi(ue[Ze+1],ue[Et+1],Y),K),X)/255*(this.premultiplied?f:1),this.b=Mi(Mi(Mi(ue[de+2],ue[_e+2],Y),Mi(ue[ze+2],ue[ke+2],Y),K),Mi(Mi(ue[Ue+2],ue[qe+2],Y),Mi(ue[Ze+2],ue[Et+2],Y),K),X)/255*(this.premultiplied?f:1),this.a=f}else this.r=i,this.g=o,this.b=c,this.a=f}toArray(){const{r:e,g:i,b:o,a:c}=this;return[255*e,255*i,255*o,c]}toHslaArray(){let{r:e,g:i,b:o,a:c}=this;if(this.premultiplied){if(c===0)return[0,0,0,0];const N=1/c;e*=N,i*=N,o*=N}const f=Math.min(Math.max(e,0),1),p=Math.min(Math.max(i,0),1),v=Math.min(Math.max(o,0),1),b=Math.min(f,p,v),T=Math.max(f,p,v),I=T-b,C=.5*(b+T);if(I===0)return[0,0,100*C,c];const O=C>.5?I/(2-T-b):I/(T+b);let B;switch(T){case f:B=60*((p-v)/I+(p<v?6:0));break;case p:B=60*((v-f)/I+2);break;default:B=60*((f-p)/I+4)}return[B,100*O,100*C,c]}toArray01(){const{r:e,g:i,b:o,a:c}=this;return[e,i,o,c]}toArray01Scaled(e){const{r:i,g:o,b:c}=this;return[i*e,o*e,c*e]}toArray01Linear(){const{r:e,g:i,b:o,a:c}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(o,2.2),c]}}class So extends Co{constructor(e,i,o,c,f){super(e,i,o,c,f,!1)}}class Xo extends Co{constructor(e,i,o,c,f){super(e,i,o,c,f,!0)}}function Mi(n,e,i){return n*(1-i)+e*i}function va(n,e,i){return n.map(((o,c)=>Mi(o,e[c],i)))}Cn.black=new Cn(0,0,0,1),Cn.white=new Cn(1,1,1,1),Cn.transparent=new Cn(0,0,0,0),Cn.red=new Cn(1,0,0,1),Cn.blue=new Cn(0,0,1,1);var Eo=Object.freeze({__proto__:null,array:va,color:function(n,e,i){return new Cn(Mi(n.r,e.r,i),Mi(n.g,e.g,i),Mi(n.b,e.b,i),Mi(n.a,e.a,i))},number:Mi});class Fs extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Ma{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,c]of i)this.bindings[o]=c}concat(e){return new Ma(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const xa={kind:"null"},Oi={kind:"number"},or={kind:"string"},ar={kind:"boolean"},Yr={kind:"color"},ja={kind:"object"},tr={kind:"value"},ce={kind:"collator"},q={kind:"formatted"},re={kind:"resolvedImage"};function Ne(n,e){return{kind:"array",itemType:n,N:e}}function Qe(n){if(n.kind==="array"){const e=Qe(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const fi=[xa,Oi,or,ar,Yr,q,ja,Ne(tr),re];function Zi(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Zi(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of fi)if(!Zi(i,e))return null}}return`Expected ${Qe(n)} but found ${Qe(e)} instead.`}function vn(n,e){return e.some((i=>i.kind===n.kind))}function Bn(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function Ir(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&Ir(n.itemType,e.itemType):n.kind===e.kind}class Pr{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bs{constructor(e,i,o,c,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=c,this.textColor=f}}class Ks{constructor(e){this.sections=e}static fromString(e){return new Ks([new Bs(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof Ks?e:Ks.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const c=i.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(o)}return e}}class Ko{constructor(e,i={}){if(this.id=Kr.from(e),this.options=Object.assign({},i),i.transform){const{a:o,b:c,c:f,d:p,e:v,f:b}=i.transform;this.options.transform=new DOMMatrix([o,c,f,p,v,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:o,d:c,e:f,f:p}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:o,d:c,e:f,f:p}})}static parse(e){let i,o,c,f;try{({name:i,iconsetId:o,params:c,transform:f}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:p,b:v,c:b,d:T,e:I,f:C}=f||{};return new Ko({name:i,iconsetId:o},{params:c,transform:new DOMMatrix([p,v,b,T,I,C])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Mo{constructor(e,i,o,c,f=!1){this.primaryId=Kr.from(e),this.primaryOptions=i,o&&(this.secondaryId=Kr.from(o)),this.secondaryOptions=c,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ko(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ko(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Mo.build({name:e}):e}static build(e,i,o,c){return!e||typeof e=="object"&&!("name"in e)?null:new Mo(e,o,i,c)}}function nh(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function el(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Cn||n instanceof Pr||n instanceof Ks||n instanceof Mo)return!0;if(Array.isArray(n)){for(const e of n)if(!el(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!el(n[e]))return!1;return!0}return!1}function $s(n){if(n===null)return xa;if(typeof n=="string")return or;if(typeof n=="boolean")return ar;if(typeof n=="number")return Oi;if(n instanceof Cn)return Yr;if(n instanceof Pr)return ce;if(n instanceof Ks)return q;if(n instanceof Mo)return re;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const c=$s(o);if(i){if(i===c)continue;i=tr;break}i=c}return Ne(i||tr,e)}return ja}function As(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ks||n instanceof Mo||n instanceof Cn?n.toString():JSON.stringify(n)}class cn{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!el(e[1]))return i.error("invalid value");const o=e[1];let c=$s(o);const f=i.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new cn(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Cn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ks?this.value.serialize():this.value}}class mi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const $o={string:or,number:Oi,boolean:ar,object:ja};class Xi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,c=1;const f=e[0];if(f==="array"){let v,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in $o)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=$o[T],c++}else v=tr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}o=Ne(v,b)}else o=$o[f];const p=[];for(;c<e.length;c++){const v=i.parse(e[c],c,tr);if(!v)return null;p.push(v)}return new Xi(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Zi(this.type,$s(o)))return o;if(i===this.args.length-1)throw new mi(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Qe($s(o))} but was expected to be of type ${Qe(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map((o=>o.serialize())))}}class Yo{constructor(e){this.type=q,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const c=[];let f=!1;for(let p=1;p<=e.length-1;++p){const v=e[p];if(f&&typeof v=="object"&&!Array.isArray(v)){f=!1;let b=null;if(v["font-scale"]&&(b=i.parseObjectValue(v["font-scale"],p,"font-scale",Oi),!b))return null;let T=null;if(v["text-font"]&&(T=i.parseObjectValue(v["text-font"],p,"text-font",Ne(or)),!T))return null;let I=null;if(v["text-color"]&&(I=i.parseObjectValue(v["text-color"],p,"text-color",Yr),!I))return null;const C=c[c.length-1];C.scale=b,C.font=T,C.textColor=I}else{const b=i.parse(e[p],p,tr);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new Yo(c)}evaluate(e){return new Ks(this.sections.map((i=>{const o=i.content.evaluate(e);return Ir($s(o),re)?new Bs("",o,null,null,null):new Bs(As(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class tl{constructor(e,i,o,c){this._imageWarnHistory={},this.type=re,this.namePrimary=e,this.nameSecondary=i,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const c=[];function f(){if(o<e.length){const v=i.parse(e[o],o++,or);return v?(c.push({image:v,options:{}}),!0):(i.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(o<e.length){const b=e[o];if((v=b)===null||typeof v!="object"||Array.isArray(v))return!0;const T=b.params,I=b.iconset,C=i.concat(o);if(!T&&!I)return o++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const O={},B=C.concat(void 0,"params");for(const N in T){if(!N)return B.error("Image parameter name should be non-empty"),!1;const X=B.concat(void 0,N).parse(T[N],void 0,Yr,void 0,{typeAnnotation:"coerce"});if(!X)return!1;O[N]=X}c[c.length-1].options.params=O}if(I){if(typeof I!="object"||I.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!I.id)return C.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=I}return o++,!0}var v;return!0}for(let v=0;v<2;v++)if(!f()||!p())return;return new tl(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const c in i)if(i[c])try{o[c]=i[c].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=Mo.build(i,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const f=c.getPrimary().id;if(c.available=e.availableImages.some((p=>Kr.isEqual(p,f))),c.available){const p=c.getSecondary()?c.getSecondary().id:null;p&&(c.available=e.availableImages.some((v=>Kr.isEqual(v,p))))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const o={};if(i&&(o.iconset={id:i}),e){o.params={};for(const c in e)e[c]&&(o.params[c]=e[c].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Wi(n){return il(n)?"string":Ql(n)?"number":Ra(n)?"boolean":Array.isArray(n)?"array":n===null?"null":Jl(n)?"object":typeof n}function Jl(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function il(n){return typeof n=="string"||n instanceof String}function Ql(n){return typeof n=="number"||n instanceof Number}function Ra(n){return typeof n=="boolean"||n instanceof Boolean}const dl={"to-boolean":ar,"to-color":Yr,"to-number":Oi,"to-string":or};class vs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],c=[];let f=xa;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);f=Ne(i.expectedType.itemType,p)}else{if(!(p>0&&el(e[1][0])))return null;f=Ne($s(e[1][0]),p)}for(let v=0;v<p;v++){const b=e[1][v];let T;if(Array.isArray(b))T=i.parse(b,void 0,f.itemType);else{const I=Wi(b);if(I!==f.itemType.kind)return i.error(`Expected ${f.itemType.kind} but found ${I}.`);T=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!T)return null;c.push(T)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");f=dl[o];for(let p=1;p<e.length;p++){const v=i.parse(e[p],p,tr);if(!v)return null;c.push(v)}}return new vs(f,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const c of this.args){if(i=c.evaluate(e),o=null,i instanceof Cn)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:nh(i[0],i[1],i[2],i[3]),!o))return new Cn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new mi(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new mi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Ks.fromString(As(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Mo.build(As(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):As(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Yo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new tl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const ou=["Unknown","Point","LineString","Polygon"];class fl{constructor(e,i,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ou[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Cn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class qs{constructor(e,i,o,c,f){this.name=e,this.type=i,this._evaluate=o,this.args=c,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const i=qs.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const o=e[0],c=qs.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,v=[];let b=null,T=-1;for(const[I,C]of p){if(Array.isArray(I)&&I.length!==e.length-1)continue;v.push(I),T++,b=new _u(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const O=[];let B=!1;for(let N=1;N<e.length;N++){const X=e[N],K=Array.isArray(I)?I[N-1]:I.type,Y=b.parse(X,1+O.length,K);if(!Y){B=!0;break}O.push(Y)}if(!B)if(Array.isArray(I)&&I.length!==O.length)b.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let N=0;N<O.length;N++){const X=Array.isArray(I)?I[N]:I.type,K=O[N];b.concat(N+1).checkSubtype(X,K.type)}if(b.errors.length===0)return new qs(o,f,C,O,T)}}if(v.length===1)i.errors.push(...b.errors);else{const I=(v.length?v:p.map((([O])=>O))).map(Cl).join(" | "),C=[];for(let O=1;O<e.length;O++){const B=i.parse(e[O],1+C.length);if(!B)return null;C.push(Qe(B.type))}i.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(e,i){qs.definitions=i;for(const o in i)e[o]=qs}}function Cl(n){return Array.isArray(n)?`(${n.map(Qe).join(", ")})`:`(${Qe(n.type)}...)`}class Gs{constructor(e,i,o){this.type=ce,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const c=o["case-sensitive"]===void 0?i.parse(!1,1,ar):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",ar);if(!c)return null;const f=o["diacritic-sensitive"]===void 0?i.parse(!1,1,ar):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",ar);if(!f)return null;let p=null;return o.locale&&(p=i.parseObjectValue(o.locale,1,"locale",or),!p)?null:new Gs(c,f,p)}evaluate(e){return new Pr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Zd(n,e,i=0,o=n.length-1,c=rh){for(;o>i;){if(o-i>600){const b=o-i+1,T=e-i+1,I=Math.log(b),C=.5*Math.exp(2*I/3),O=.5*Math.sqrt(I*C*(b-C)/b)*(T-b/2<0?-1:1);Zd(n,e,Math.max(i,Math.floor(e-T*C/b+O)),Math.min(o,Math.floor(e+(b-T)*C/b+O)),c)}const f=n[e];let p=i,v=o;for(ba(n,i,e),c(n[o],f)>0&&ba(n,i,o);p<v;){for(ba(n,p,v),p++,v--;c(n[p],f)<0;)p++;for(;c(n[v],f)>0;)v--}c(n[i],f)===0?ba(n,i,v):(v++,ba(n,v,o)),v<=e&&(i=v+1),e<=v&&(o=v-1)}}function ba(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function rh(n,e){return n<e?-1:n>e?1:0}function au(n){let e=0;for(let i,o,c=0,f=n.length,p=f-1;c<f;p=c++)i=n[c],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}function Ml(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function ua(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Wh(n,e,i){const o=n[0]-e[0],c=n[1]-e[1],f=n[0]-i[0],p=n[1]-i[1];return o*p-f*c==0&&o*f<=0&&c*p<=0}function pl(n,e,i=!1){let o=!1;for(let v=0,b=e.length;v<b;v++){const T=e[v];for(let I=0,C=T.length,O=C-1;I<C;O=I++){const B=T[O],N=T[I];if(Wh(n,B,N))return i;(f=B)[1]>(c=n)[1]!=(p=N)[1]>c[1]&&c[0]<(p[0]-f[0])*(c[1]-f[1])/(p[1]-f[1])+f[0]&&(o=!o)}}var c,f,p;return o}function ec(n,e,i,o){const c=o[0]-i[0],f=o[1]-i[1],p=(n[0]-i[0])*f-c*(n[1]-i[1]),v=(e[0]-i[0])*f-c*(e[1]-i[1]);return p>0&&v<0||p<0&&v>0}function tc(n,e,i,o){return(c=[o[0]-i[0],o[1]-i[1]])[0]*(f=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*f[0]!=0&&!(!ec(n,e,i,o)||!ec(i,o,n,e));var c,f}function Ic(n){const e=new kt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new kt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of n[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),i.x<o.x&&(i.x=o.x),i.y<o.y&&(i.y=o.y);return{min:e,max:i}}const ml=8192;function ic(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*ml),Math.round(o*c*ml)]}function sh(n,e){for(let i=0;i<e.length;i++)if(pl(n,e[i]))return!0;return!1}function Ep(n,e,i){for(const o of i)for(let c=0,f=o.length,p=f-1;c<f;p=c++)if(tc(n,e,o[p],o[c]))return!0;return!1}function lu(n,e){for(let i=0;i<n.length;++i)if(!pl(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Ep(n[i],n[i+1],e))return!1;return!0}function Wd(n,e){for(let i=0;i<e.length;i++)if(lu(n,e[i]))return!0;return!1}function cu(n,e,i){const o=[];for(let c=0;c<n.length;c++){const f=[];for(let p=0;p<n[c].length;p++){const v=ic(n[c][p],i);Ml(e,v),f.push(v)}o.push(f)}return o}function Oa(n,e,i){const o=[];for(let c=0;c<n.length;c++){const f=cu(n[c],e,i);o.push(f)}return o}function $a(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const c=.5*o;let f=n[0]-i[0]>c?-o:i[0]-n[0]>c?o:0;f===0&&(f=n[0]-i[2]>c?-o:i[2]-n[0]>c?o:0),n[0]+=f}Ml(e,n)}function uu(n,e,i,o){const c=Math.pow(2,o.z)*ml,f=[o.x*ml,o.y*ml],p=[];if(!n)return p;for(const v of n)for(const b of v){const T=[b.x+f[0],b.y+f[1]];$a(T,e,i,c),p.push(T)}return p}function Xd(n,e,i,o){const c=Math.pow(2,o.z)*ml,f=[o.x*ml,o.y*ml],p=[];if(!n)return p;for(const b of n){const T=[];for(const I of b){const C=[I.x+f[0],I.y+f[1]];Ml(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=c/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of p)for(const T of b)$a(T,e,i,c)}var v;return p}class nl{constructor(e,i){this.type=ar,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(el(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const f=o.features[c].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new nl(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new nl(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new nl(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(o.type==="Polygon"){const v=cu(o.coordinates,f,p),b=uu(i.geometry(),c,f,p);if(!ua(c,f))return!1;for(const T of b)if(!pl(T,v))return!1}if(o.type==="MultiPolygon"){const v=Oa(o.coordinates,f,p),b=uu(i.geometry(),c,f,p);if(!ua(c,f))return!1;for(const T of b)if(!sh(T,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(o.type==="Polygon"){const v=cu(o.coordinates,f,p),b=Xd(i.geometry(),c,f,p);if(!ua(c,f))return!1;for(const T of b)if(!lu(T,v))return!1}if(o.type==="MultiPolygon"){const v=Oa(o.coordinates,f,p),b=Xd(i.geometry(),c,f,p);if(!ua(c,f))return!1;for(const T of b)if(!Wd(T,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const hu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},oh=1/298.257223563,Xh=oh*(2-oh),rl=Math.PI/180;class Pc{static fromTile(e,i,o){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),f=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/rl;return new Pc(f,o)}static get units(){return hu}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!hu[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(hu).join(", ")}`);const o=6378.137*rl*(i?hu[i]:1),c=Math.cos(e*rl),f=1/(1-Xh*(1-c*c)),p=Math.sqrt(f);this.kx=o*p*c,this.ky=o*p*f*(1-Xh)}distance(e,i){const o=ha(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+c*c)}bearing(e,i){const o=ha(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/rl}destination(e,i,o){const c=o*rl;return this.offset(e,Math.sin(c)*i,Math.cos(c)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const c=e[o];for(let f=0,p=c.length,v=p-1;f<p;v=f++)i+=ha(c[f][0]-c[v][0])*(c[f][1]+c[v][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let c=0;c<e.length-1;c++){const f=e[c],p=e[c+1],v=this.distance(f,p);if(o+=v,o>i)return du(f,p,(i-(o-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[c,f]=i,p=ha(o[0]-c)*this.kx,v=(o[1]-f)*this.ky;if(p!==0||v!==0){const b=(ha(e[0]-c)*this.kx*p+(e[1]-f)*this.ky*v)/(p*p+v*v);b>1?(c=o[0],f=o[1]):b>0&&(c+=p/this.kx*b,f+=v/this.ky*b)}return p=ha(e[0]-c)*this.kx,v=(e[1]-f)*this.ky,Math.sqrt(p*p+v*v)}pointOnLine(e,i){let o=1/0,c=e[0][0],f=e[0][1],p=0,v=0;for(let b=0;b<e.length-1;b++){let T=e[b][0],I=e[b][1],C=ha(e[b+1][0]-T)*this.kx,O=(e[b+1][1]-I)*this.ky,B=0;C===0&&O===0||(B=(ha(i[0]-T)*this.kx*C+(i[1]-I)*this.ky*O)/(C*C+O*O),B>1?(T=e[b+1][0],I=e[b+1][1]):B>0&&(T+=C/this.kx*B,I+=O/this.ky*B)),C=ha(i[0]-T)*this.kx,O=(i[1]-I)*this.ky;const N=C*C+O*O;N<o&&(o=N,c=T,f=I,p=b,v=B)}return{point:[c,f],index:p,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,o){let c=this.pointOnLine(o,e),f=this.pointOnLine(o,i);if(c.index>f.index||c.index===f.index&&c.t>f.t){const T=c;c=f,f=T}const p=[c.point],v=c.index+1,b=f.index;!Rl(o[v],p[0])&&v<=b&&p.push(o[v]);for(let T=v+1;T<=b;T++)p.push(o[T]);return Rl(o[b],f.point)||p.push(f.point),p}lineSliceAlong(e,i,o){let c=0;const f=[];for(let p=0;p<o.length-1;p++){const v=o[p],b=o[p+1],T=this.distance(v,b);if(c+=T,c>e&&f.length===0&&f.push(du(v,b,(e-(c-T))/T)),c>=i)return f.push(du(v,b,(i-(c-T))/T)),f;c>e&&f.push(b)}return f}bufferPoint(e,i){const o=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-o,e[0]+c,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-o,e[2]+c,e[3]+o]}insideBBox(e,i){return ha(e[0]-i[0])>=0&&ha(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Rl(n,e){return n[0]===e[0]&&n[1]===e[1]}function du(n,e,i){const o=ha(e[0]-n[0]);return[n[0]+o*i,n[1]+(e[1]-n[1])*i]}function ha(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class ah{constructor(e=[],i=((o,c)=>o<c?-1:o>c?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,c=i[e];for(;e>0;){const f=e-1>>1,p=i[f];if(o(c,p)>=0)break;i[e]=p,e=f}i[e]=c}_down(e){const{data:i,compare:o}=this,c=this.length>>1,f=i[e];for(;e<c;){let p=1+(e<<1);const v=p+1;if(v<this.length&&o(i[v],i[p])<0&&(p=v),o(i[p],f)>=0)break;i[e]=i[p],e=p}i[e]=f}}var Zt=8192;function lh(n,e){return e.dist-n.dist}const nc=100,sl=50;function fu(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Ol(n){return n[1]-n[0]+1}function da(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function pu(n,e){if(n[0]>n[1])return[null,null];const i=Ol(n);if(e){if(i===2)return[n,null];const o=Math.floor(i/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}{if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}}function wa(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!da(e,n.length))return i;for(let o=e[0];o<=e[1];++o)Ml(i,n[o]);return i}function Vn(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let o=0;o<n[i].length;++o)Ml(e,n[i][o]);return e}function rc(n,e,i){if(fu(n)||fu(e))return NaN;let o=0,c=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),i.distance([0,0],[o,c])}function Kd(n){return 360*n-180}function Yd(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function mu(n,e){const i=Math.pow(2,e.z),o=(n.y/Zt+e.y)/i;return[Kd((n.x/Zt+e.x)/i),Yd(o)]}function Jd(n,e){const i=[];for(let o=0;o<n.length;++o)i.push(mu(n[o],e));return i}function Jr(n,e,i){const o=i.pointOnLine(e,n).point;return i.distance(n,o)}function Kh(n,e,i,o,c){const f=i.slice(o[0],o[1]+1);let p=1/0;for(let v=e[0];v<=e[1];++v)if((p=Math.min(p,Jr(n[v],f,c)))===0)return 0;return p}function ch(n,e,i,o,c){const f=Math.min(c.pointToSegmentDistance(n,i,o),c.pointToSegmentDistance(e,i,o)),p=Math.min(c.pointToSegmentDistance(i,n,e),c.pointToSegmentDistance(o,n,e));return Math.min(f,p)}function Ap(n,e,i,o,c){if(!da(e,n.length)||!da(o,i.length))return NaN;let f=1/0;for(let p=e[0];p<e[1];++p)for(let v=o[0];v<o[1];++v){if(tc(n[p],n[p+1],i[v],i[v+1]))return 0;f=Math.min(f,ch(n[p],n[p+1],i[v],i[v+1],c))}return f}function _(n,e,i,o,c){if(!da(e,n.length)||!da(o,i.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let v=o[0];v<=o[1];++v)if((f=Math.min(f,c.distance(n[p],i[v])))===0)return f;return f}function E(n,e,i){if(pl(n,e,!0))return 0;let o=1/0;for(const c of e){const f=c.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[f-1]&&(o=Math.min(o,i.pointToSegmentDistance(n,c[f-1],c[0])))===0||(o=Math.min(o,Jr(n,c,i)))===0)return o}return o}function z(n,e,i,o){if(!da(e,n.length))return NaN;for(let f=e[0];f<=e[1];++f)if(pl(n[f],i,!0))return 0;let c=1/0;for(let f=e[0];f<e[1];++f)for(const p of i)for(let v=0,b=p.length,T=b-1;v<b;T=v++){if(tc(n[f],n[f+1],p[T],p[v]))return 0;c=Math.min(c,ch(n[f],n[f+1],p[T],p[v],o))}return c}function $(n,e){for(const i of n)for(let o=0;o<=i.length-1;++o)if(pl(i[o],e,!0))return!0;return!1}function te(n,e,i,o=1/0){const c=Vn(n),f=Vn(e);if(o!==1/0&&rc(c,f,i)>=o)return o;if(ua(c,f)){if($(n,e))return 0}else if($(e,n))return 0;let p=o;for(const v of n)for(let b=0,T=v.length,I=T-1;b<T;I=b++)for(const C of e)for(let O=0,B=C.length,N=B-1;O<B;N=O++){if(tc(v[I],v[b],C[N],C[O]))return 0;p=Math.min(p,ch(v[I],v[b],C[N],C[O],i))}return p}function Ce(n,e,i,o,c,f,p){if(f===null||p===null)return;const v=rc(wa(o,f),wa(c,p),i);v<e&&n.push({dist:v,range1:f,range2:p})}function dt(n,e,i,o,c=1/0){let f=Math.min(o.distance(n[0],i[0][0]),c);if(f===0)return f;const p=new ah([{dist:0,range1:[0,n.length-1],range2:[0,0]}],lh),v=e?sl:nc,b=Vn(i);for(;p.length;){const T=p.pop();if(T.dist>=f)continue;const I=T.range1;if(Ol(I)<=v){if(!da(I,n.length))return NaN;if(e){const C=z(n,I,i,o);if((f=Math.min(f,C))===0)return f}else for(let C=I[0];C<=I[1];++C){const O=E(n[C],i,o);if((f=Math.min(f,O))===0)return f}}else{const C=pu(I,e);if(C[0]!==null){const O=rc(wa(n,C[0]),b,o);O<f&&p.push({dist:O,range1:C[0],range2:[0,0]})}if(C[1]!==null){const O=rc(wa(n,C[1]),b,o);O<f&&p.push({dist:O,range1:C[1],range2:[0,0]})}}}return f}function Vt(n,e,i,o,c,f=1/0){let p=Math.min(f,c.distance(n[0],i[0]));if(p===0)return p;const v=new ah([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],lh),b=e?sl:nc,T=o?sl:nc;for(;v.length;){const I=v.pop();if(I.dist>=p)continue;const C=I.range1,O=I.range2;if(Ol(C)<=b&&Ol(O)<=T){if(!da(C,n.length)||!da(O,i.length))return NaN;if(e&&o?p=Math.min(p,Ap(n,C,i,O,c)):e||o?e&&!o?p=Math.min(p,Kh(i,O,n,C,c)):!e&&o&&(p=Math.min(p,Kh(n,C,i,O,c))):p=Math.min(p,_(n,C,i,O,c)),p===0)return p}else{const B=pu(C,e),N=pu(O,o);Ce(v,p,c,n,i,B[0],N[0]),Ce(v,p,c,n,i,B[0],N[1]),Ce(v,p,c,n,i,B[1],N[0]),Ce(v,p,c,n,i,B[1],N[1])}}return p}function Qt(n,e,i,o,c=1/0){let f=c;const p=wa(n,[0,n.length-1]);for(const v of i)if(!(f!==1/0&&rc(p,wa(v,[0,v.length-1]),o)>=f)&&(f=Math.min(f,Vt(n,e,v,!0,o,f)),f===0))return f;return f}function Li(n,e,i,o,c=1/0){let f=c;const p=wa(n,[0,n.length-1]);for(const v of i){if(f!==1/0&&rc(p,Vn(v),o)>=f)continue;const b=dt(n,e,v,o,f);if(isNaN(b))return b;if((f=Math.min(f,b))===0)return f}return f}function mn(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class $n{constructor(e,i){this.type=Oi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(el(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let c=0;c<o.features.length;++c)if(mn(o.features[c].geometry.type))return new $n(o,o.features[c].geometry)}else if(o.type==="Feature"){if(mn(o.geometry.type))return new $n(o,o.geometry)}else if(mn(o.type))return new $n(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return(function(c,f,p){const v=[];for(const T of c)for(const I of T)v.push(mu(I,f));const b=new Pc(v[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Vt(v,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",b):p.type==="MultiLineString"?Qt(v,!1,p.coordinates,b):p.type==="Polygon"||p.type==="MultiPolygon"?Li(v,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,b):null})(i,o,this.geometries);if(e.geometryType()==="LineString")return(function(c,f,p){const v=[];for(const T of c){const I=[];for(const C of T)I.push(mu(C,f));v.push(I)}const b=new Pc(v[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Qt(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,b);if(p.type==="MultiLineString"){let T=1/0;for(let I=0;I<p.coordinates.length;I++){const C=Qt(p.coordinates[I],!0,v,b,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}if(p.type==="Polygon"||p.type==="MultiPolygon"){let T=1/0;for(let I=0;I<v.length;I++){const C=Li(v[I],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,b,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return null})(i,o,this.geometries);if(e.geometryType()==="Polygon")return(function(c,f,p){const v=[];for(const T of(function(I,C){const O=I.length;if(O<=1)return[I];const B=[];let N,X;for(let K=0;K<O;K++){const Y=au(I[K]);Y!==0&&(I[K].area=Math.abs(Y),X===void 0&&(X=Y<0),X===Y<0?(N&&B.push(N),N=[I[K]]):N.push(I[K]))}return N&&B.push(N),B})(c)){const I=[];for(let C=0;C<T.length;++C)I.push(Jd(T[C],f));v.push(I)}const b=new Pc(v[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Li(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",v,b);if(p.type==="MultiLineString"){let T=1/0;for(let I=0;I<p.coordinates.length;I++){const C=Li(p.coordinates[I],!0,v,b,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return p.type==="Polygon"||p.type==="MultiPolygon"?(function(T,I,C){let O=1/0;for(const B of T)for(const N of I){const X=te(B,N,C,O);if(isNaN(X))return X;if((O=Math.min(O,X))===0)return O}return O})(p.type==="Polygon"?[p.coordinates]:p.coordinates,v,b):null})(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function _r(n){if(n instanceof qs&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof nl||n instanceof $n)return!1;if(n instanceof Cc)return n.featureConstant;let e=!0;return n.eachChild((i=>{e&&!_r(i)&&(e=!1)})),e}function Ro(n){if(n instanceof qs&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!Ro(i)&&(e=!1)})),e}function lo(n){if(n instanceof Cc)return new Set([n.key]);let e=new Set;return n.eachChild((i=>{e=new Set([...e,...lo(i)])})),e}function Bo(n,e){if(n instanceof qs&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!Bo(o,e)&&(i=!1)})),i}function Jo(n,e,i){return[n,e,i].filter(Boolean).join("")}function Ll(n,e){switch(n){case"string":return As(e);case"number":return+e;case"boolean":return!!e;case"color":return Cn.parse(e);case"formatted":return Ks.fromString(As(e));case"resolvedImage":return Mo.build(As(e))}return e}function Qd(n,e,i,o){return o!==void 0&&(n=o*Math.round(n/o)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Cc{constructor(e,i,o,c=!1){this.type=e,this.key=i,this.scope=o,this.featureConstant=c}static parse(e,i){let o=i.expectedType;if(o==null&&(o=tr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof cn))return i.error("Key name of 'config' expression must be a string literal.");let f,p=!0;const v=As(c.value);if(e.length>=3){const b=i.parse(e[2],2);if(!(b instanceof cn))return i.error("Scope of 'config' expression must be a string literal.");f=As(b.value)}if(i.options){const b=Jo(v,f,i._scope),T=i.options.get(b);T&&(p=_r(T.value||T.default))}return new Cc(o,v,f,p)}evaluate(e){const i=Jo(this.key,this.scope,e.scope),o=e.getConfig(i);if(!o)return null;const{type:c,value:f,values:p,minValue:v,maxValue:b,stepValue:T}=o,I=o.default.evaluate(e);let C=I;if(f){const O=e.scope;e.scope=(O||"").split("").slice(1).join(""),C=f.evaluate(e),e.scope=O}return c&&(C=Ll(c,C)),C===void 0||v===void 0&&b===void 0&&T===void 0||(typeof C=="number"?C=Qd(C,v,b,T):Array.isArray(C)&&(C=C.map((O=>typeof O=="number"?Qd(O,v,b,T):O)))),f!==void 0&&C!==void 0&&p&&!p.includes(C)&&(C=I,c&&(C=Ll(c,C))),(c&&c!==this.type||C!==void 0&&!Ir($s(C),this.type))&&(C=Ll(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class uh{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new uh(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class _u{constructor(e,i=[],o,c=new Ma,f=[],p,v,b){this.registry=e,this.path=i,this.key=i.map((T=>typeof T=="string"?`['${T}']`:`[${T}]`)).join(""),this.scope=c,this.errors=f,this.expectedType=o,this._scope=p,this.options=v,this.iconImageUseTheme=b}parse(e,i,o,c,f={}){return i||o?this.concat(i,null,o,c)._parse(e,f):this._parse(e,f)}parseObjectValue(e,i,o,c,f,p={}){return this.concat(i,o,c,f)._parse(e,p)}_parse(e,i){function o(c,f,p){return p==="assert"?new Xi(f,[c]):p==="coerce"?new vs(f,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let f=c.parse(e,this);if(!f)return null;if(this.expectedType){const p=this.expectedType,v=f.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||v.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(p,v))return null}else f=o(f,p,i.typeAnnotation||"coerce");else f=o(f,p,i.typeAnnotation||"assert")}if(!(f instanceof cn)&&f.type.kind!=="resolvedImage"&&Yh(f)){const p=new fl(this._scope,this.options,this.iconImageUseTheme);try{f=new cn(f.type,f.evaluate(p))}catch(v){return this.error(v.message),null}}return f}return vs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,c){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof i=="string"?f.concat(i):f;const p=c?this.scope.concat(c):this.scope;return new _u(this.registry,f,o||null,p,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const o=`${this.key}${i.map((c=>`[${c}]`)).join("")}`;this.errors.push(new Fs(o,e))}checkSubtype(e,i){const o=Zi(e,i);return o&&this.error(o),o}}function Yh(n){if(n instanceof uh)return Yh(n.boundExpression);if(n instanceof qs&&n.name==="error"||n instanceof Gs||n instanceof nl||n instanceof $n||n instanceof Cc)return!1;const e=n instanceof vs||n instanceof Xi;let i=!0;return n.eachChild((o=>{i=e?i&&Yh(o):i&&o instanceof cn})),!!i&&_r(n)&&Bo(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function gu(n,e){const i=n.length-1;let o,c,f=0,p=i,v=0;for(;f<=p;)if(v=Math.floor((f+p)/2),o=n[v],c=n[v+1],o<=e){if(v===i||e<c)return v;f=v+1}else{if(!(o>e))throw new mi("Input is not a number.");p=v-1}return 0}class Hs{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,f]of o)this.labels.push(c),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,Oi);if(!o)return null;const c=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let p=1;p<e.length;p+=2){const v=p===1?-1/0:e[p],b=e[p+1],T=p,I=p+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(b,I,f);if(!C)return null;f=f||C.type,c.push([v,C])}return new Hs(f,o,c)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const f=i.length;return c>=i[f-1]?o[f-1].evaluate(e):o[gu(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const yu=.95047,ef=1.08883,tf=4/29,Dl=6/29,hh=3*Dl*Dl,Jh=Dl*Dl*Dl,Ip=Math.PI/180,Lv=180/Math.PI;function Pp(n){return n>Jh?Math.pow(n,1/3):n/hh+tf}function nf(n){return n>Dl?n*n*n:hh*(n-tf)}function rf(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Mc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Cp(n){const e=Mc(n.r),i=Mc(n.g),o=Mc(n.b),c=Pp((.4124564*e+.3575761*i+.1804375*o)/yu),f=Pp((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*f-16,a:500*(c-f),b:200*(f-Pp((.0193339*e+.119192*i+.9503041*o)/ef)),alpha:n.a}}function Mp(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*nf(e),i=yu*nf(i),o=ef*nf(o),new Cn(rf(3.2404542*i-1.5371385*e-.4985314*o),rf(-.969266*i+1.8760108*e+.041556*o),rf(.0556434*i-.2040259*e+1.0572252*o),n.alpha)}function Dv(n,e,i){const o=e-n;return n+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const vu={forward:Cp,reverse:Mp,interpolate:function(n,e,i){return{l:Mi(n.l,e.l,i),a:Mi(n.a,e.a,i),b:Mi(n.b,e.b,i),alpha:Mi(n.alpha,e.alpha,i)}}},xu={forward:function(n){const{l:e,a:i,b:o}=Cp(n),c=Math.atan2(o,i)*Lv;return{h:c<0?c+360:c,c:Math.sqrt(i*i+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Ip,i=n.c;return Mp({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Dv(n.h,e.h,i),c:Mi(n.c,e.c,i),l:Mi(n.l,e.l,i),alpha:Mi(n.alpha,e.alpha,i)}}};var q_=Object.freeze({__proto__:null,hcl:xu,lab:vu});class qa{constructor(e,i,o,c,f){this.type=e,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[p,v]of f)this.labels.push(p),this.outputs.push(v)}static interpolationFactor(e,i,o,c){let f=0;if(e.name==="exponential")f=sf(i,e.base,o,c);else if(e.name==="linear")f=sf(i,1,o,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new fo(p[0],p[1],p[2],p[3]).solve(sf(i,1,o,c))}return f}static parse(e,i){let[o,c,f,...p]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some((I=>typeof I!="number"||I<0||I>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Oi),!f)return null;const v=[];let b=null;o==="interpolate-hcl"||o==="interpolate-lab"?b=Yr:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let T=0;T<p.length;T+=2){const I=p[T],C=p[T+1],O=T+3,B=T+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const N=i.parse(C,B,b);if(!N)return null;b=b||N.type,v.push([I,N])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new qa(b,o,c,f,v):i.error(`Type ${Qe(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const f=i.length;if(c>=i[f-1])return o[f-1].evaluate(e);const p=gu(i,c),v=qa.interpolationFactor(this.interpolation,c,i[p],i[p+1]),b=o[p].evaluate(e),T=o[p+1].evaluate(e);return this.operator==="interpolate"?Eo[this.type.kind.toLowerCase()](b,T,v):this.operator==="interpolate-hcl"?xu.reverse(xu.interpolate(xu.forward(b),xu.forward(T),v)):vu.reverse(vu.interpolate(vu.forward(b),vu.forward(T),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function sf(n,e,i,o){const c=o-i,f=n-i;return c===0?0:e===1?f/c:(Math.pow(e,f)-1)/(Math.pow(e,c)-1)}class Qh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const c=i.expectedType;c&&c.kind!=="value"&&(o=c);const f=[];for(const v of e.slice(1)){const b=i.parse(v,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!b)return null;o=o||b.type,f.push(b)}const p=c&&f.some((v=>Zi(c,v.type)));return new Qh(p?tr:o,f)}evaluate(e){let i,o=null,c=0;for(const f of this.args){if(c++,o=f.evaluate(e),o&&o instanceof Mo&&!o.available&&(i||(i=o),o=null,c===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class of{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const v=i.parse(e[f+1],f+1);if(!v)return null;o.push([p,v])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return c?new of(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class Rp{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Oi),c=i.parse(e[2],2,Ne(i.expectedType||tr));return o&&c?new Rp(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new mi("Array index out of bounds: negative index");if(i>=o.length)throw new mi("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new mi("Array index must be an integer. Use at-interpolated for fractional indices");return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Op{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Oi),c=i.parse(e[2],2,Ne(i.expectedType||tr));return o&&c?new Op(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new mi(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new mi(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const c=Math.floor(i),f=Math.ceil(i),p=o[c],v=o[f];if(typeof p!="number"||typeof v!="number")throw new mi(`Cannot interpolate between non-number values at index ${i}.`);const b=i-c;return p*(1-b)+v*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class af{constructor(e,i){this.type=ar,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,tr),c=i.parse(e[2],2,tr);return o&&c?vn(o.type,[ar,or,Oi,xa,tr])?new af(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Bn(i,["boolean","string","number","null"]))throw new mi(`Expected first argument to be of type boolean, string, number or null, but found ${Qe($s(i))} instead.`);if(!Bn(o,["string","array"]))throw new mi(`Expected second argument to be of type array or string, but found ${Qe($s(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ed{constructor(e,i,o){this.type=Oi,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,tr),c=i.parse(e[2],2,tr);if(!o||!c)return null;if(!vn(o.type,[ar,or,Oi,xa,tr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Qe(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Oi);return f?new ed(o,c,f):null}return new ed(o,c)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Bn(i,["boolean","string","number","null"]))throw new mi(`Expected first argument to be of type boolean, string, number or null, but found ${Qe($s(i))} instead.`);if(!Bn(o,["string","array"]))throw new mi(`Expected second argument to be of type array or string, but found ${Qe($s(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(i,c)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class dh{constructor(e,i,o,c,f,p){this.inputType=e,this.type=i,this.input=o,this.cases=c,this.outputs=f,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let I=e[T];const C=e[T+1];Array.isArray(I)||(I=[I]);const O=i.concat(T);if(I.length===0)return O.error("Expected at least one branch label.");for(const N of I){if(typeof N!="number"&&typeof N!="string")return O.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return O.error("Numeric branch labels must be integer values.");if(o){if(O.checkSubtype(o,$s(N)))return null}else o=$s(N);if(f[String(N)]!==void 0)return O.error("Branch labels must be unique.");f[String(N)]=p.length}const B=i.parse(C,T,c);if(!B)return null;c=c||B.type,p.push(B)}const v=i.parse(e[1],1,tr);if(!v)return null;const b=i.parse(e[e.length-1],e.length-1,c);return b?v.type.kind!=="value"&&i.concat(1).checkSubtype(o,v.type)?null:new dh(o,c,v,f,p,b):null}evaluate(e){const i=this.input.evaluate(e);return(Ir($s(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],c={};for(const p of i){const v=c[this.cases[p]];v===void 0?(c[this.cases[p]]=o.length,o.push([this.cases[p],[p]])):o[v][1].push(p)}const f=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,v]of o)e.push(v.length===1?f(v[0]):v.map(f)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Lp{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const v=i.parse(e[p],p,ar);if(!v)return null;const b=i.parse(e[p+1],p+1,o);if(!b)return null;c.push([v,b]),o=o||b.type}const f=i.parse(e[e.length-1],e.length-1,o);return f?new Lp(o,c,f):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class td{constructor(e,i,o,c){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,tr),c=i.parse(e[2],2,Oi);if(!o||!c)return null;if(!vn(o.type,[Ne(tr),or,tr]))return i.error(`Expected first argument to be of type array or string, but found ${Qe(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Oi);return f?new td(o.type,o,c,f):null}return new td(o.type,o,c)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Bn(i,["string","array"]))throw new mi(`Expected first argument to be of type array or string, but found ${Qe($s(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(o,c)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Dp{constructor(e,i){this.type=Ne(or),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,or),c=i.parse(e[2],2,or);return o&&c?new Dp(o,c):void 0}evaluate(e){const i=this.str.evaluate(e),o=this.delimiter.evaluate(e);return i.split(o)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function G_(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function zp(n,e,i,o){return o.compare(e,i)===0}function bu(n,e,i){const o=n!=="=="&&n!=="!=";return class sR{constructor(f,p,v){this.type=ar,this.lhs=f,this.rhs=p,this.collator=v,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const v=f[0];let b=p.parse(f[1],1,tr);if(!b)return null;if(!G_(v,b.type))return p.concat(1).error(`"${v}" comparisons are not supported for type '${Qe(b.type)}'.`);let T=p.parse(f[2],2,tr);if(!T)return null;if(!G_(v,T.type))return p.concat(2).error(`"${v}" comparisons are not supported for type '${Qe(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${Qe(b.type)}' and '${Qe(T.type)}'.`);o&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new Xi(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new Xi(b.type,[T])));let I=null;if(f.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(I=p.parse(f[3],3,ce),!I)return null}return new sR(b,T,I)}evaluate(f){const p=this.lhs.evaluate(f),v=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const b=$s(p),T=$s(v);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new mi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const b=$s(p),T=$s(v);if(b.kind!=="string"||T.kind!=="string")return e(f,p,v)}return this.collator?i(f,p,v,this.collator.evaluate(f)):e(f,p,v)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild((p=>{f.push(p.serialize())})),f}}}const zv=bu("==",(function(n,e,i){return e===i}),zp),kv=bu("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!zp(0,e,i,o)})),Fv=bu("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),lf=bu(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),Bv=bu("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),Nv=bu(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class kp{constructor(e,i,o,c,f,p){this.type=or,this.number=e,this.locale=i,this.currency=o,this.unit=c,this.minFractionDigits=f,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Oi);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=i.parseObjectValue(c.locale,2,"locale",or),!f))return null;let p=null;if(c.currency&&(p=i.parseObjectValue(c.currency,2,"currency",or),!p))return null;let v=null;if(c.unit&&(v=i.parseObjectValue(c.unit,2,"unit",or),!v))return null;let b=null;if(c["min-fraction-digits"]&&(b=i.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",Oi),!b))return null;let T=null;return c["max-fraction-digits"]&&(T=i.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",Oi),!T)?null:new kp(o,f,p,v,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Fp{constructor(e){this.type=Oi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Qe(o.type)} instead.`):new Fp(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new mi(`Expected value to be of type string or array, but found ${Qe($s(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function Bp(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const fh={"==":zv,"!=":kv,">":lf,"<":Fv,">=":Nv,"<=":Bv,array:Xi,at:Rp,"at-interpolated":Op,boolean:Xi,case:Lp,coalesce:Qh,collator:Gs,format:Yo,image:tl,in:af,"index-of":ed,interpolate:qa,"interpolate-hcl":qa,"interpolate-lab":qa,length:Fp,let:of,literal:cn,match:dh,number:Xi,"number-format":kp,object:Xi,slice:td,step:Hs,string:Xi,"to-boolean":vs,"to-color":vs,"to-number":vs,"to-string":vs,var:uh,within:nl,distance:$n,config:Cc,split:Dp};function H_(n,[e,i,o,c]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const f=c?c.evaluate(n):1,p=nh(e,i,o,f);if(p)throw new mi(p);return new Cn(e/255,i/255,o/255,f)}function Np(n,[e,i,o,c]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const f=c?c.evaluate(n):1,p=(function(T,I,C,O){return typeof T=="number"&&T>=0&&T<=360?typeof I=="number"&&I>=0&&I<=100&&typeof C=="number"&&C>=0&&C<=100?O===void 0||typeof O=="number"&&O>=0&&O<=1?null:`Invalid hsla value [${[T,I,C,O].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof O=="number"?[T,I,C,O]:[T,I,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof O=="number"?[T,I,C,O]:[T,I,C]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,o,f);if(p)throw new mi(p);const v=`hsla(${e}, ${i}%, ${o}%, ${f})`,b=Cn.parse(v);if(!b)throw new mi(`Failed to parse HSLA color: ${v}`);return b}function Up(n,e){return n in e}function cf(n,e){const i=e[n];return i===void 0?null:i}function wu(n){return{type:n}}function Tu(n){return{result:"success",value:n}}function Rc(n){return{result:"error",value:n}}function Vp(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function uf(n){return n["property-type"]==="data-driven"}function jp(n){return Vp(n.expression,"measure-light")}function $p(n){return Vp(n.expression,"zoom")}function hf(n){return!!n.expression&&n.expression.interpolated}function df(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function qp(n){return n}function ff(n,e){const i=e.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",c=o||!(o||n.property!==void 0),f=n.type||(hf(e)?"exponential":"interval");if(i&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map((T=>[T[0],Cn.parse(T[1])]))),n.default=Cn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!q_[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let p,v,b;if(f==="exponential")p=Z_;else if(f==="interval")p=Oc;else if(f==="categorical"){p=Uv,v=Object.create(null);for(const T of n.stops)v[T[0]]=T[1];b=typeof n.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);p=Vv}if(o){const T={},I=[];for(let B=0;B<n.stops.length;B++){const N=n.stops[B],X=N[0].zoom;T[X]===void 0&&(T[X]={zoom:X,type:n.type,property:n.property,default:n.default,stops:[]},I.push(X)),T[X].stops.push([N[0].value,N[1]])}const C=[];for(const B of I)C.push([T[B].zoom,ff(T[B],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:qa.interpolationFactor.bind(void 0,O),zoomStops:C.map((B=>B[0])),evaluate:({zoom:B},N)=>Z_({stops:C,base:n.base},e,B).evaluate(B,N)}}if(c){const T=f==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:qa.interpolationFactor.bind(void 0,T),zoomStops:n.stops.map((I=>I[0])),evaluate:({zoom:I})=>p(n,e,I,v,b)}}return{kind:"source",evaluate(T,I){const C=I&&I.properties?I.properties[n.property]:void 0;return C===void 0?ph(n.default,e.default):p(n,e,C,v,b)}}}function ph(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Uv(n,e,i,o,c){return ph(typeof i===c?o[i]:void 0,n.default,e.default)}function Oc(n,e,i){if(!Ql(i))return ph(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const c=gu(n.stops.map((f=>f[0])),i);return n.stops[c][1]}function Z_(n,e,i){const o=n.base!==void 0?n.base:1;if(!Ql(i))return ph(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const f=gu(n.stops.map((I=>I[0])),i),p=(function(I,C,O,B){const N=B-O,X=I-O;return N===0?0:C===1?X/N:(Math.pow(C,X)-1)/(Math.pow(C,N)-1)})(i,o,n.stops[f][0],n.stops[f+1][0]),v=n.stops[f][1],b=n.stops[f+1][1];let T=Eo[e.type]||qp;if(n.colorSpace&&n.colorSpace!=="rgb"){const I=q_[n.colorSpace];T=(C,O)=>I.reverse(I.interpolate(I.forward(C),I.forward(O),p))}return typeof v.evaluate=="function"?{evaluate(...I){const C=v.evaluate.apply(void 0,I),O=b.evaluate.apply(void 0,I);if(C!==void 0&&O!==void 0)return T(C,O,p)}}:T(v,b,p)}function Vv(n,e,i){return e.type==="color"?i=Cn.parse(i):e.type==="formatted"?i=Ks.fromString(i.toString()):e.type==="resolvedImage"?i=Mo.build(i.toString()):Wi(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ph(i,n.default,e.default)}qs.register(fh,{error:[{kind:"error"},[or],(n,[e])=>{throw new mi(e.evaluate(n))}],typeof:[or,[tr],(n,[e])=>Qe($s(e.evaluate(n)))],"to-rgba":[Ne(Oi,4),[Yr],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ne(Oi,4),[Yr],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Yr,[Oi,Oi,Oi],H_],rgba:[Yr,[Oi,Oi,Oi,Oi],H_],hsl:[Yr,[Oi,Oi,Oi],Np],hsla:[Yr,[Oi,Oi,Oi,Oi],Np],has:{type:ar,overloads:[[[or],(n,[e])=>Up(e.evaluate(n),n.properties())],[[or,ja],(n,[e,i])=>Up(e.evaluate(n),i.evaluate(n))]]},get:{type:tr,overloads:[[[or],(n,[e])=>cf(e.evaluate(n),n.properties())],[[or,ja],(n,[e,i])=>cf(e.evaluate(n),i.evaluate(n))]]},"feature-state":[tr,[or],(n,[e])=>cf(e.evaluate(n),n.featureState||{})],properties:[ja,[],n=>n.properties()],"geometry-type":[or,[],n=>n.geometryType()],worldview:[or,[],n=>n.globals.worldview||""],id:[tr,[],n=>n.id()],zoom:[Oi,[],n=>n.globals.zoom],pitch:[Oi,[],n=>n.globals.pitch||0],"distance-from-center":[Oi,[],n=>n.distanceFromCenter()],"measure-light":[Oi,[or],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Oi,[],n=>n.globals.heatmapDensity||0],"line-progress":[Oi,[],n=>n.globals.lineProgress||0],"raster-value":[Oi,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Oi,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Oi,[],n=>n.globals.skyRadialProgress||0],accumulated:[tr,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Oi,wu(Oi),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[Oi,wu(Oi),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:Oi,overloads:[[[Oi,Oi],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Oi],(n,[e])=>-e.evaluate(n)]]},"/":[Oi,[Oi,Oi],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Oi,[Oi,Oi],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Oi,[],()=>Math.LN2],pi:[Oi,[],()=>Math.PI],e:[Oi,[],()=>Math.E],"^":[Oi,[Oi,Oi],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Oi,[Oi],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Oi,[Oi],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Oi,[Oi],(n,[e])=>Math.log(e.evaluate(n))],log2:[Oi,[Oi],(n,[e])=>Math.log2(e.evaluate(n))],sin:[Oi,[Oi],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Oi,[Oi],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Oi,[Oi],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Oi,[Oi],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Oi,[Oi],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Oi,[Oi],(n,[e])=>Math.atan(e.evaluate(n))],min:[Oi,wu(Oi),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[Oi,wu(Oi),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[Oi,[Oi],(n,[e])=>Math.abs(e.evaluate(n))],round:[Oi,[Oi],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Oi,[Oi],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Oi,[Oi],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[ar,[or,tr],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[ar,[tr],(n,[e])=>n.id()===e.value],"filter-type-==":[ar,[or],(n,[e])=>n.geometryType()===e.value],"filter-<":[ar,[or,tr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[ar,[tr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[ar,[or,tr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[ar,[tr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[ar,[or,tr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[ar,[tr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[ar,[or,tr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[ar,[tr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[ar,[tr],(n,[e])=>e.value in n.properties()],"filter-has-id":[ar,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[ar,[Ne(or)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[ar,[Ne(tr)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[ar,[or,Ne(tr)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[ar,[or,Ne(tr)],(n,[e,i])=>(function(o,c,f,p){for(;f<=p;){const v=f+p>>1;if(c[v]===o)return!0;c[v]>o?p=v-1:f=v+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ar,overloads:[[[ar,ar],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[wu(ar),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:ar,overloads:[[[ar,ar],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[wu(ar),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[ar,[ar],(n,[e])=>!e.evaluate(n)],"is-supported-script":[ar,[or],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[or,[or],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[or,[or],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[or,wu(tr),(n,e)=>e.map((i=>As(i.evaluate(n)))).join("")],"resolved-locale":[or,[ce],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Oi,[Oi,Oi,tr],(n,e)=>{const[i,o,c]=e.map((p=>p.evaluate(n)));if(i>o||i===o)return i;let f;if(typeof c=="string")f=(function(p){let v=0;if(p.length===0)return v;for(let b=0;b<p.length;b++)v=(v<<5)-v+p.charCodeAt(b),v|=0;return v})(c);else{if(typeof c!="number")throw new mi(`Invalid seed input: ${c}`);f=c}return i+Bp(f)()*(o-i)}]});class pf{constructor(e,i,o,c,f){this.expression=e,this._warningHistory={},this._evaluator=new fl(o,c,f),this._defaultValue=i?(function(p){return p.type==="color"&&(df(p.default)||Array.isArray(p.default))?new Cn(0,0,0,0):p.type==="color"?Cn.parse(p.default)||null:p.default===void 0?null:p.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=lo(e)}evaluateWithoutErrorHandling(e,i,o,c,f,p,v,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,c,f,p,v,b,T){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=T||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new mi(`Expected value to be one of ${Object.keys(this._enumValues).map((C=>JSON.stringify(C))).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${I.message}`)),this._defaultValue}}}function Gp(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in fh}function zl(n,e,i,o,c){const f=new _u(fh,[],e?(function(v){const b={color:Yr,string:or,number:Oi,enum:or,boolean:ar,formatted:q,resolvedImage:re};return v.type==="array"?Ne(b[v.value]||tr,v.length):b[v.type]})(e):void 0,void 0,void 0,i,o,c),p=f.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Tu(new pf(p,e,i,o,c)):Rc(f.errors)}class id{constructor(e,i,o,c){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!Ro(i.expression),this.configDependencies=lo(i.expression)}evaluateWithoutErrorHandling(e,i,o,c,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,f,p)}evaluate(e,i,o,c,f,p,v){return this._styleExpression.evaluate(e,i,o,c,f,p,void 0,void 0,v)}}class Lc{constructor(e,i,o,c,f,p){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Ro(i.expression),this.isLightConstant=f,this.isLineProgressConstant=p,this.configDependencies=lo(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,o,c,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,f,p)}evaluate(e,i,o,c,f,p){return this._styleExpression.evaluate(e,i,o,c,f,p)}interpolationFactor(e,i,o){return this.interpolationType?qa.interpolationFactor(this.interpolationType,e,i,o):0}}function Hp(n,e,i,o,c){if((n=zl(n,e,i,o,c)).result==="error")return n;const f=n.value.expression,p=_r(f);if(!p&&!uf(e))return Rc([new Fs("","data expressions not supported")]);const v=Bo(f,["zoom","pitch","distance-from-center"]);if(!v&&!$p(e))return Rc([new Fs("","zoom expressions not supported")]);const b=Bo(f,["measure-light"]);if(!b&&!jp(e))return Rc([new Fs("","measure-light expression not supported")]);const T=Bo(f,["line-progress"]);if(!T&&!(function(O){return Vp(O.expression,"line-progress")})(e))return Rc([new Fs("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,C=_f(f);return C||v||I?C instanceof Fs?Rc([C]):C instanceof qa&&!hf(e)?Rc([new Fs("",'"interpolate" expressions cannot be used with this property')]):Tu(C?new Lc(p&&T?"camera":"composite",n.value,C.labels,C instanceof qa?C.interpolation:void 0,b,T):new id(p&&T?"constant":"source",n.value,b,T)):Rc([new Fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class mf{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,ff(this._parameters,this._specification))}static deserialize(e){return new mf(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function _f(n){let e=null;if(n instanceof of)e=_f(n.result);else if(n instanceof Qh){for(const i of n.args)if(e=_f(i),e)break}else(n instanceof Hs||n instanceof qa)&&n.input instanceof qs&&n.input.name==="zoom"&&(e=n);return e instanceof Fs||n.eachChild((i=>{const o=_f(i);o instanceof Fs?e=o:e&&o&&e!==o&&(e=new Fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var nd,gf,W_=(function(){if(gf)return nd;gf=1,nd=e;var n=3;function e(i,o,c){var f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(o=p[1])+2*(c=p[2]);for(var v=0;v<this.d*this.d;v++){var b=p[n+v],T=p[n+v+1];f.push(b===T?null:p.subarray(b,T))}var I=p[n+f.length+1];this.keys=p.subarray(p[n+f.length],I),this.bboxes=p.subarray(I),this.insert=this._insertReadonly}else{this.d=o+2*c;for(var C=0;C<this.d*this.d;C++)f.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=c,this.scale=o/i,this.uid=0;var O=c/o*i;this.min=-O,this.max=i+O}return e.prototype.insert=function(i,o,c,f,p){this._forEachCell(o,c,f,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,c,f,p,v){this.cells[p].push(v)},e.prototype.query=function(i,o,c,f,p){var v=this.min,b=this.max;if(i<=v&&o<=v&&b<=c&&b<=f&&!p)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,o,c,f,this._queryCell,T,{},p),T},e.prototype._queryCell=function(i,o,c,f,p,v,b,T){var I=this.cells[p];if(I!==null)for(var C=this.keys,O=this.bboxes,B=0;B<I.length;B++){var N=I[B];if(b[N]===void 0){var X=4*N;(T?T(O[X+0],O[X+1],O[X+2],O[X+3]):i<=O[X+2]&&o<=O[X+3]&&c>=O[X+0]&&f>=O[X+1])?(b[N]=!0,v.push(C[N])):b[N]=!1}}},e.prototype._forEachCell=function(i,o,c,f,p,v,b,T){for(var I=this._convertToCellCoord(i),C=this._convertToCellCoord(o),O=this._convertToCellCoord(c),B=this._convertToCellCoord(f),N=I;N<=O;N++)for(var X=C;X<=B;X++){var K=this.d*X+N;if((!T||T(this._convertFromCellCoord(N),this._convertFromCellCoord(X),this._convertFromCellCoord(N+1),this._convertFromCellCoord(X+1)))&&p.call(this,i,o,c,f,K,v,b,T))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=n+this.cells.length+1+1,c=0,f=0;f<this.cells.length;f++)c+=this.cells[f].length;var p=new Int32Array(o+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var v=o,b=0;b<i.length;b++){var T=i[b];p[n+b]=v,p.set(T,v),v+=T.length}return p[n+i.length]=v,p.set(this.keys,v),p[n+i.length+1]=v+=this.keys.length,p.set(this.bboxes,v),v+=this.bboxes.length,p.buffer},nd})(),Su=Os(W_);const mh={};function yi(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),mh[e]={klass:n,omit:i.omit||[]}}yi(Object,"Object"),Su.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},Su.deserialize=function(n){return new Su(n.buffer)},Object.defineProperty(Su,"name",{value:"Grid"}),yi(Su,"Grid"),delete kt.prototype.constructor,typeof DOMMatrix<"u"&&yi(DOMMatrix,"DOMMatrix"),yi(Cn,"Color"),yi(Error,"Error"),yi(Ks,"Formatted"),yi(Bs,"FormattedSection"),yi(pr,"AJAXError"),yi(Mo,"ResolvedImage"),yi(mf,"StylePropertyFunction"),yi(pf,"StyleExpression",{omit:["_evaluator"]}),yi(Kr,"ImageId"),yi(Ko,"ImageVariant"),yi(Lc,"ZoomDependentExpression"),yi(id,"ZoomConstantExpression"),yi(qs,"CompoundExpression",{omit:["_evaluate"]});for(const n in fh)mh[fh[n]._classRegistryKey]||yi(fh[n],`Expression${n}`);function Zp(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function sc(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Dc(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Zp(n)||sc(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const o of n)i.push(Dc(o,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[o,c]of n.entries())i.entries.push(Dc(o),Dc(c,e));return i}if(n instanceof Set){const i={$name:"Set"};let o=0;for(const c of n.values())i[++o]=Dc(c);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of o)i[c]=n[c];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const c=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const f in n)n.hasOwnProperty(f)&&(mh[o].omit.indexOf(f)>=0||(c[f]=Dc(n[f],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof n)}function zc(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Zp(n)||sc(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(zc);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const c=n.entries||[],f=new Map;for(let p=0;p<c.length;p+=2)f.set(zc(c[p]),zc(c[p+1]));return f}if(e==="Set"){const c=new Set;for(const f of Object.keys(n))f!=="$name"&&c.add(zc(n[f]));return c}if(e==="DOMMatrix"){let c;return c=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=mh[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(o[c]=zc(n[c]));return o}throw new Error("can't deserialize object of type "+typeof n)}const Yi={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Wp(n){for(const e of n)if(vf(e.charCodeAt(0)))return!0;return!1}function X_(n){for(const e of n)if(!yf(e.charCodeAt(0)))return!1;return!0}function yf(n){return!(Yi.Arabic(n)||Yi["Arabic Supplement"](n)||Yi["Arabic Extended-A"](n)||Yi["Arabic Presentation Forms-A"](n)||Yi["Arabic Presentation Forms-B"](n))}function vf(n){return!(n!==746&&n!==747&&(n<4352||!(Yi["Bopomofo Extended"](n)||Yi.Bopomofo(n)||Yi["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Yi["CJK Compatibility Ideographs"](n)||Yi["CJK Compatibility"](n)||Yi["CJK Radicals Supplement"](n)||Yi["CJK Strokes"](n)||!(!Yi["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Yi["CJK Unified Ideographs Extension A"](n)||Yi["CJK Unified Ideographs"](n)||Yi["Enclosed CJK Letters and Months"](n)||Yi["Hangul Compatibility Jamo"](n)||Yi["Hangul Jamo Extended-A"](n)||Yi["Hangul Jamo Extended-B"](n)||Yi["Hangul Jamo"](n)||Yi["Hangul Syllables"](n)||Yi.Hiragana(n)||Yi["Ideographic Description Characters"](n)||Yi.Kanbun(n)||Yi["Kangxi Radicals"](n)||Yi["Katakana Phonetic Extensions"](n)||Yi.Katakana(n)&&n!==12540||!(!Yi["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Yi["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Yi["Unified Canadian Aboriginal Syllabics"](n)||Yi["Unified Canadian Aboriginal Syllabics Extended"](n)||Yi["Vertical Forms"](n)||Yi["Yijing Hexagram Symbols"](n)||Yi["Yi Syllables"](n)||Yi["Yi Radicals"](n))))}function xf(n){return!(vf(n)||(function(e){return!!(Yi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Yi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Yi["Letterlike Symbols"](e)||Yi["Number Forms"](e)||Yi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Yi["Control Pictures"](e)&&e!==9251||Yi["Optical Character Recognition"](e)||Yi["Enclosed Alphanumerics"](e)||Yi["Geometric Shapes"](e)||Yi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Yi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Yi["CJK Symbols and Punctuation"](e)||Yi.Katakana(e)||Yi["Private Use Area"](e)||Yi["CJK Compatibility Forms"](e)||Yi["Small Form Variants"](e)||Yi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(n))}function jv(n){return Yi.Arabic(n)||Yi["Arabic Supplement"](n)||Yi["Arabic Extended-A"](n)||Yi["Arabic Presentation Forms-A"](n)||Yi["Arabic Presentation Forms-B"](n)}function K_(n){return n>=1424&&n<=2303||Yi["Arabic Presentation Forms-A"](n)||Yi["Arabic Presentation Forms-B"](n)}function $v(n,e){return!(!e&&K_(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Yi.Khmer(n))}function qv(n){for(const e of n)if(K_(e.charCodeAt(0)))return!0;return!1}const La={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Xp=null,fa=La.unavailable,kc=null;const Y_=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(fa=La.error),Xp&&Xp(n)};function Kp(){Yp.fire(new Ii("pluginStateChange",{pluginStatus:fa,pluginURL:kc}))}const Yp=new ys,bf=function(){return fa},Eu=function(){if(fa!==La.deferred||!kc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fa=La.loading,Kp(),kc&&Ps({url:kc},(n=>{n?Y_(n):(fa=La.loaded,Kp())}))},kl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fa===La.loaded||kl.applyArabicShaping!=null,isLoading:()=>fa===La.loading,setState(n){fa=n.pluginStatus,kc=n.pluginURL},isParsing:()=>fa===La.parsing,isParsed:()=>fa===La.parsed,getPluginURL:()=>kc};class Nr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,o){for(const c of i)if(!$v(c.charCodeAt(0),o))return!1;return!0})(e,kl.isLoaded())}}class Au{constructor(e,i,o,c,f){this.property=e,this.value=i,this.expression=(function(p,v,b,T,I){if(df(p))return new mf(p,v);if(Gp(p)||Array.isArray(p)&&p.length>0){const C=Hp(p,v,b,T,I);if(C.result==="error")throw new Error(C.value.map((O=>`${O.key}: ${O.message}`)).join(", "));return C.value}{let C=p;return typeof p=="string"&&v.type==="color"&&(C=Cn.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>C}}})(i===void 0?e.specification.default:i,e.specification,o,c,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o,c){return this.property.possiblyEvaluate(this,e,i,o,c)}}class Jp{constructor(e,i,o,c){this.property=e,this.value=new Au(e,void 0,i,o,c)}transitioned(e,i){return new oc(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new oc(this.property,this.value,null,{},0)}}class J_{constructor(e,i,o,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this._iconImageUseTheme=c,this.configDependencies=new Set}getValue(e){return Ji(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Jp(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Au(this._values[e].property,i===null?void 0:Ji(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const c in e){const f=e[c];if(c.endsWith("-transition")){const p=c.slice(0,-11);o[p]&&this.setTransition(p,f)}else o.hasOwnProperty(c)&&this.setValue(c,f)}}getTransition(e){return Ji(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Jp(this._values[e].property)),this._values[e].transition=Ji(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const o=new Qp(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,i._values[c]);return o}untransitioned(){const e=new Qp(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class oc{constructor(e,i,o,c,f){const p=c.delay||0,v=c.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+p,this.end=this.begin+v,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const c=e.now||0,f=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return p.possiblyEvaluate(e,i,o);{const v=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),f,be(v))}}return f}}class Qp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const c=new Cu(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(e,i,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Iu{constructor(e,i,o,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this._iconImageUseTheme=c,this.configDependencies=new Set}getValue(e){return Ji(this._values[e].value)}setValue(e,i){this._values[e]=new Au(this._values[e].property,i===null?void 0:Ji(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o,c){const f=new Cu(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].possiblyEvaluate(e,i,o,c);return f}}class Pu{constructor(e,i,o,c){this.property=e,this.value=i,this.parameters=o,this.iconImageUseTheme=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,c){return this.property.evaluate(this.value,this.parameters,e,i,o,c,this.iconImageUseTheme)}}class Cu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Wt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const c=Eo[this.specification.type];return c?c(e,i,o):e}}class li{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,c,f){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Pu(this,{kind:"constant",value:e.expression.evaluate(i,null,{},o,c,void 0,f)},i):new Pu(this,e.expression,i,f)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Pu(this,{kind:"constant",value:void 0},e.parameters);const c=Eo[this.specification.type];return c?new Pu(this,{kind:"constant",value:c(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,c,f,p,v){return e.kind==="constant"?e.value:e.evaluate(i,o,c,f,p,void 0,v)}}class _h{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){return!!e.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class xs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Nr(0,{});for(const o in e){const c=e[o];c.specification.overridable&&this.overridableProperties.push(o);const f=this.defaultPropertyValues[o]=new Au(c,void 0),p=this.defaultTransitionablePropertyValues[o]=new Jp(c);this.defaultTransitioningPropertyValues[o]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=f.possiblyEvaluate(i)}}}yi(li,"DataDrivenProperty"),yi(Wt,"DataConstantProperty"),yi(_h,"ColorRampProperty");var Ye=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function wf(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Mu(n){if(Array.isArray(n))return n.map(Mu);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Mu(n[i]);return e}return wf(n)}function Tf(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Tf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function rd(n,e="",i=null,o="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Tf(n)||(n=Sf(n));const c=n;let f=!0;try{f=(function(I){if(!gh(I))return I;let C=Mu(I);return _l(C),C=Q_(C),C})(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let p=null,v=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){v=Ye[`filter_${o}`];const I=zl(f,v,e,i);if(I.result==="error")throw new Error(I.value.map((C=>`${C.key}: ${C.message}`)).join(", "));p=(C,O,B)=>I.value.evaluate(C,O,{},B)}let b=null,T=null;if(f!==c){const I=zl(c,v,e,i);if(I.result==="error")throw new Error(I.value.map((C=>`${C.key}: ${C.message}`)).join(", "));b=(C,O,B,N,X)=>I.value.evaluate(C,O,{},B,void 0,void 0,N,X),T=!_r(I.value.expression)}return{filter:p,dynamicFilter:b||void 0,needGeometry:tg(f),needFeature:!!T}}function Q_(n){if(!Array.isArray(n))return n;const e=(function(i){if(eg.has(i[0])){for(let o=1;o<i.length;o++)if(gh(i[o]))return!0}return i})(n);return e===!0?e:e.map((i=>Q_(i)))}function _l(n){let e=!1;const i=[];if(n[0]==="case"){for(let o=1;o<n.length-1;o+=2)e=e||gh(n[o]),i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||gh(n[1]);for(let o=2;o<n.length-1;o+=2)i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||gh(n[1]);for(let o=1;o<n.length-1;o+=2)i.push(n[o+1])}e&&(n.length=0,n.push("any",...i));for(let o=1;o<n.length;o++)_l(n[o])}function gh(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(gh(n[i]))return!0;return!1}const eg=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gv(n,e){return n<e?-1:n>e?1:0}function tg(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(tg(n[e]))return!0;return!1}function Sf(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?em(n[1],n[2],"=="):e==="!="?Ef(em(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?em(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Sf))):e==="all"?["all"].concat(n.slice(1).map(Sf)):e==="none"?["all"].concat(n.slice(1).map(Sf).map(Ef)):e==="in"?ig(n[1],n.slice(2)):e==="!in"?Ef(ig(n[1],n.slice(2))):e==="has"?ng(n[1]):e!=="!has"||Ef(ng(n[1]));var i}function em(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function ig(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(Gv)]]:["filter-in-small",n,["literal",e]]}}function ng(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ef(n){return["!",n]}const sd="";function yh(n,e){return e?`${n}${sd}${e}`:n}let tm;const rg=()=>tm||(tm=new xs({"icon-size":new li(Ye.layout_symbol["icon-size"]),"icon-image":new li(Ye.layout_symbol["icon-image"]),"icon-rotate":new li(Ye.layout_symbol["icon-rotate"]),"icon-offset":new li(Ye.layout_symbol["icon-offset"])}));class Hv{constructor(e,i,o,c,f,p){const v=zl(e,Ye.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=i,o){this.properties=new Cu(rg()),this.unevaluatedLayout=new Iu(rg(),c,f,p);for(const b in o)this.unevaluatedLayout.setValue(b,o[b])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.properties&&(e.properties=this.properties),e}}const sg="-transition",og=new Set(["fill","line","background","hillshade","raster"]);class Qo extends ys{constructor(e,i,o,c,f,p){if(super(),this.id=e.id,this.fqid=yh(this.id,o),this.type=e.type,this.scope=o,this.lut=c,this.options=f,this.iconImageUseTheme=p,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=zl(this.filter,Ye[`filter_${e.type}`]);v.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...v.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),e.appearances&&e.appearances.forEach((v=>{this.appearances.push(new Hv(v.condition,v.name,v.properties,this.scope,f,this.iconImageUseTheme))})),i.layout&&(this._unevaluatedLayout=new Iu(i.layout,this.scope,f,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new J_(i.paint,this.scope,f);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Cu(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&og.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(sg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,c=o._properties.properties;if(e.endsWith(sg)){const C=e.slice(0,-11);return c[C]&&o.setTransition(C,i||void 0),!1}if(!c[e])return!1;const f=o._values[e],p=f.value.isDataDriven(),v=f.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=o._values[e].value,T=b.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return T||p||I||this._handleOverridablePaintPropertyUpdate(e,v,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),pn(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Pu&&uf(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=rd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(e){}queryIntersectsFeature(e,i,o,c,f,p,v,b,T){}}const Fc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Gr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function qn(n,e=1){let i=0,o=0;return{members:n.map((c=>{const f=Fc[c.type].BYTES_PER_ELEMENT,p=i=ag(i,Math.max(e,f)),v=c.components||1;return o=Math.max(o,f),i+=f*v,{name:c.name,type:c.type,components:v,offset:p}})),size:ag(i,Math.max(o,e)),alignment:e}}function ag(n,e){return Math.ceil(n/e)*e}class Bc extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=o,e}}Bc.prototype.bytesPerElement=4,yi(Bc,"StructArrayLayout2i4");class Ru extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=c,e}}Ru.prototype.bytesPerElement=6,yi(Ru,"StructArrayLayout3i6");class Ou extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,c)}emplace(e,i,o,c,f){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=c,this.int16[p+3]=f,e}}Ou.prototype.bytesPerElement=8,yi(Ou,"StructArrayLayout4i8");class Nc extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Nc.prototype.bytesPerElement=4,yi(Nc,"StructArrayLayout1f4");class im extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=4*e,p=2*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.float32[p+1]=c,e}}im.prototype.bytesPerElement=8,yi(im,"StructArrayLayout2i1f8");class Af extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=c,e}}Af.prototype.bytesPerElement=8,yi(Af,"StructArrayLayout3i8");class nm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,c,f)}emplace(e,i,o,c,f,p){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=o,this.int16[v+2]=c,this.int16[v+3]=f,this.int16[v+4]=p,e}}nm.prototype.bytesPerElement=10,yi(nm,"StructArrayLayout5i10");class If extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,c,f,p,v)}emplace(e,i,o,c,f,p,v,b){const T=6*e,I=12*e,C=3*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.uint8[I+4]=c,this.uint8[I+5]=f,this.uint8[I+6]=p,this.uint8[I+7]=v,this.float32[C+2]=b,e}}If.prototype.bytesPerElement=12,yi(If,"StructArrayLayout2i4ub1f12");class Ta extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=c,e}}Ta.prototype.bytesPerElement=12,yi(Ta,"StructArrayLayout3f12");class Uc extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,c,f)}emplace(e,i,o,c,f,p){const v=6*e,b=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=o,this.uint16[v+2]=c,this.uint16[v+3]=f,this.float32[b+2]=p,e}}Uc.prototype.bytesPerElement=12,yi(Uc,"StructArrayLayout4ui1f12");class xh extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,c)}emplace(e,i,o,c,f){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=o,this.uint16[p+2]=c,this.uint16[p+3]=f,e}}xh.prototype.bytesPerElement=8,yi(xh,"StructArrayLayout4ui8");class Pf extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,p)}emplace(e,i,o,c,f,p,v){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=c,this.int16[b+3]=f,this.int16[b+4]=p,this.int16[b+5]=v,e}}Pf.prototype.bytesPerElement=12,yi(Pf,"StructArrayLayout6i12");class rm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v,b,T,I,C,O){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,o,c,f,p,v,b,T,I,C,O)}emplace(e,i,o,c,f,p,v,b,T,I,C,O,B){const N=12*e;return this.int16[N+0]=i,this.int16[N+1]=o,this.int16[N+2]=c,this.int16[N+3]=f,this.uint16[N+4]=p,this.uint16[N+5]=v,this.uint16[N+6]=b,this.uint16[N+7]=T,this.int16[N+8]=I,this.int16[N+9]=C,this.int16[N+10]=O,this.int16[N+11]=B,e}}rm.prototype.bytesPerElement=24,yi(rm,"StructArrayLayout4i4ui4i24");class sm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,p)}emplace(e,i,o,c,f,p,v){const b=10*e,T=5*e;return this.int16[b+0]=i,this.int16[b+1]=o,this.int16[b+2]=c,this.float32[T+2]=f,this.float32[T+3]=p,this.float32[T+4]=v,e}}sm.prototype.bytesPerElement=20,yi(sm,"StructArrayLayout3i3f20");class gl extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,c)}emplace(e,i,o,c,f){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=c,this.float32[p+3]=f,e}}gl.prototype.bytesPerElement=16,yi(gl,"StructArrayLayout4f16");class bh extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}bh.prototype.bytesPerElement=4,yi(bh,"StructArrayLayout1ul4");class eo extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=o,e}}eo.prototype.bytesPerElement=4,yi(eo,"StructArrayLayout2ui4");class wh extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v,b,T,I,C,O,B){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,o,c,f,p,v,b,T,I,C,O,B)}emplace(e,i,o,c,f,p,v,b,T,I,C,O,B,N){const X=20*e,K=10*e;return this.int16[X+0]=i,this.int16[X+1]=o,this.int16[X+2]=c,this.int16[X+3]=f,this.int16[X+4]=p,this.float32[K+3]=v,this.float32[K+4]=b,this.float32[K+5]=T,this.float32[K+6]=I,this.int16[X+14]=C,this.uint32[K+8]=O,this.uint16[X+18]=B,this.uint16[X+19]=N,e}}wh.prototype.bytesPerElement=40,yi(wh,"StructArrayLayout5i4f1i1ul2ui40");class Cf extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,c,f,p,v)}emplace(e,i,o,c,f,p,v,b){const T=8*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=c,this.int16[T+4]=f,this.int16[T+5]=p,this.int16[T+6]=v,this.int16[T+7]=b,e}}Cf.prototype.bytesPerElement=16,yi(Cf,"StructArrayLayout3i2i2i16");class om extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,c,f)}emplace(e,i,o,c,f,p){const v=4*e,b=8*e;return this.float32[v+0]=i,this.float32[v+1]=o,this.float32[v+2]=c,this.int16[b+6]=f,this.int16[b+7]=p,e}}om.prototype.bytesPerElement=16,yi(om,"StructArrayLayout2f1f2i16");class am extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,p)}emplace(e,i,o,c,f,p,v){const b=20*e,T=5*e;return this.uint8[b+0]=i,this.uint8[b+1]=o,this.float32[T+1]=c,this.float32[T+2]=f,this.float32[T+3]=p,this.float32[T+4]=v,e}}am.prototype.bytesPerElement=20,yi(am,"StructArrayLayout2ub4f20");class co extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=c,e}}co.prototype.bytesPerElement=6,yi(co,"StructArrayLayout3ui6");class od extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y,ue,de,_e,ze){const ke=this.length;return this.resize(ke+1),this.emplace(ke,e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y,ue,de,_e,ze)}emplace(e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y,ue,de,_e,ze,ke){const Ue=30*e,qe=15*e,Ze=60*e;return this.int16[Ue+0]=i,this.int16[Ue+1]=o,this.int16[Ue+2]=c,this.float32[qe+2]=f,this.float32[qe+3]=p,this.uint16[Ue+8]=v,this.uint16[Ue+9]=b,this.uint32[qe+5]=T,this.uint32[qe+6]=I,this.uint32[qe+7]=C,this.uint16[Ue+16]=O,this.uint16[Ue+17]=B,this.uint16[Ue+18]=N,this.float32[qe+10]=X,this.float32[qe+11]=K,this.uint8[Ze+48]=Y,this.uint8[Ze+49]=ue,this.uint8[Ze+50]=de,this.uint32[qe+13]=_e,this.int16[Ue+28]=ze,this.uint8[Ze+58]=ke,e}}od.prototype.bytesPerElement=60,yi(od,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class lm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y,ue,de,_e,ze,ke,Ue,qe,Ze,Et,Je,Ot,jt,Lt,Ft,Gt,Tt){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y,ue,de,_e,ze,ke,Ue,qe,Ze,Et,Je,Ot,jt,Lt,Ft,Gt,Tt)}emplace(e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y,ue,de,_e,ze,ke,Ue,qe,Ze,Et,Je,Ot,jt,Lt,Ft,Gt,Tt,Bt){const ht=20*e,at=40*e,Ht=80*e;return this.float32[ht+0]=i,this.float32[ht+1]=o,this.int16[at+4]=c,this.int16[at+5]=f,this.int16[at+6]=p,this.int16[at+7]=v,this.int16[at+8]=b,this.int16[at+9]=T,this.int16[at+10]=I,this.int16[at+11]=C,this.int16[at+12]=O,this.uint16[at+13]=B,this.uint16[at+14]=N,this.uint16[at+15]=X,this.uint16[at+16]=K,this.uint16[at+17]=Y,this.uint16[at+18]=ue,this.uint16[at+19]=de,this.uint16[at+20]=_e,this.uint16[at+21]=ze,this.uint16[at+22]=ke,this.uint16[at+23]=Ue,this.uint16[at+24]=qe,this.uint16[at+25]=Ze,this.uint16[at+26]=Et,this.uint16[at+27]=Je,this.uint32[ht+14]=Ot,this.float32[ht+15]=jt,this.float32[ht+16]=Lt,this.float32[ht+17]=Ft,this.float32[ht+18]=Gt,this.uint8[Ht+76]=Tt,this.uint16[at+39]=Bt,e}}lm.prototype.bytesPerElement=80,yi(lm,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class ad extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,o,c,f,p)}emplace(e,i,o,c,f,p,v){const b=6*e;return this.float32[b+0]=i,this.float32[b+1]=o,this.float32[b+2]=c,this.float32[b+3]=f,this.float32[b+4]=p,this.float32[b+5]=v,e}}ad.prototype.bytesPerElement=24,yi(ad,"StructArrayLayout6f24");class Lu extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,c,f)}emplace(e,i,o,c,f,p){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=o,this.float32[v+2]=c,this.float32[v+3]=f,this.float32[v+4]=p,e}}Lu.prototype.bytesPerElement=20,yi(Lu,"StructArrayLayout5f20");class cm extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,c,f,p,v)}emplace(e,i,o,c,f,p,v,b){const T=7*e;return this.float32[T+0]=i,this.float32[T+1]=o,this.float32[T+2]=c,this.float32[T+3]=f,this.float32[T+4]=p,this.float32[T+5]=v,this.float32[T+6]=b,e}}cm.prototype.bytesPerElement=28,yi(cm,"StructArrayLayout7f28");class Mf extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v,b,T,I,C){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,o,c,f,p,v,b,T,I,C)}emplace(e,i,o,c,f,p,v,b,T,I,C,O){const B=11*e;return this.float32[B+0]=i,this.float32[B+1]=o,this.float32[B+2]=c,this.float32[B+3]=f,this.float32[B+4]=p,this.float32[B+5]=v,this.float32[B+6]=b,this.float32[B+7]=T,this.float32[B+8]=I,this.float32[B+9]=C,this.float32[B+10]=O,e}}Mf.prototype.bytesPerElement=44,yi(Mf,"StructArrayLayout11f44");class ld extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,o,c,f,p,v,b,T)}emplace(e,i,o,c,f,p,v,b,T,I){const C=9*e;return this.float32[C+0]=i,this.float32[C+1]=o,this.float32[C+2]=c,this.float32[C+3]=f,this.float32[C+4]=p,this.float32[C+5]=v,this.float32[C+6]=b,this.float32[C+7]=T,this.float32[C+8]=I,e}}ld.prototype.bytesPerElement=36,yi(ld,"StructArrayLayout9f36");class Th extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=o,e}}Th.prototype.bytesPerElement=8,yi(Th,"StructArrayLayout2f8");class Rf extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,c)}emplace(e,i,o,c,f){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=o,this.uint16[p+3]=c,this.uint16[p+4]=f,e}}Rf.prototype.bytesPerElement=12,yi(Rf,"StructArrayLayout1ul3ui12");class Of extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Of.prototype.bytesPerElement=2,yi(Of,"StructArrayLayout1ui2");class um extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K){const Y=this.length;return this.resize(Y+1),this.emplace(Y,e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K)}emplace(e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y){const ue=16*e;return this.float32[ue+0]=i,this.float32[ue+1]=o,this.float32[ue+2]=c,this.float32[ue+3]=f,this.float32[ue+4]=p,this.float32[ue+5]=v,this.float32[ue+6]=b,this.float32[ue+7]=T,this.float32[ue+8]=I,this.float32[ue+9]=C,this.float32[ue+10]=O,this.float32[ue+11]=B,this.float32[ue+12]=N,this.float32[ue+13]=X,this.float32[ue+14]=K,this.float32[ue+15]=Y,e}}um.prototype.bytesPerElement=64,yi(um,"StructArrayLayout16f64");class Sh extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,f,p,v){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,o,c,f,p,v)}emplace(e,i,o,c,f,p,v,b){const T=10*e,I=5*e;return this.uint16[T+0]=i,this.uint16[T+1]=o,this.uint16[T+2]=c,this.uint16[T+3]=f,this.float32[I+2]=p,this.float32[I+3]=v,this.float32[I+4]=b,e}}Sh.prototype.bytesPerElement=20,yi(Sh,"StructArrayLayout4ui3f20");class Eh extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Eh.prototype.bytesPerElement=2,yi(Eh,"StructArrayLayout1i2");class Lf extends Gr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Lf.prototype.bytesPerElement=1,yi(Lf,"StructArrayLayout1ub1");class lg extends vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}lg.prototype.size=40;class hm extends wh{get(e){return new lg(this,e)}}yi(hm,"CollisionBoxArray");class cg extends vh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}cg.prototype.size=60;class Df extends od{get(e){return new cg(this,e)}}yi(Df,"PlacedSymbolArray");class ug extends vh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ug.prototype.size=80;class hg extends lm{get(e){return new ug(this,e)}}yi(hg,"SymbolInstanceArray");class dg extends Nc{getoffsetX(e){return this.float32[1*e+0]}}yi(dg,"GlyphOffsetArray");class fg extends Bc{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}yi(fg,"SymbolLineVertexArray");class dm extends vh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}dm.prototype.size=12;class pg extends Rf{get(e){return new dm(this,e)}}yi(pg,"FeatureIndexArray");class mg extends eo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}yi(mg,"FillExtrusionCentroidArray");class _g extends vh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}_g.prototype.size=6;class gg extends Ru{get(e){return new _g(this,e)}}yi(gg,"FillExtrusionWallArray");const Zv=qn([{name:"a_pos",components:2,type:"Int16"}],4),Wv=qn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Xv=qn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class cs{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,c){let f=this.segments[this.segments.length-1];return e>cs.MAX_VERTEX_ARRAY_LENGTH&&An(`Max vertices per segment is ${cs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>cs.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}prepareSegment(e,i,o,c){return this._prepareSegment(e,i.length,o.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,c){return new cs([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function cd(n,e){return 256*(n=Le(Math.floor(n),0,255))+Le(Math.floor(e),0,255)}cs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yi(cs,"SegmentVector");const Kv=qn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Yv=qn([{name:"a_pattern_b",components:4,type:"Uint16"}]),zf=qn([{name:"a_dash",components:4,type:"Uint16"}]);class ud{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,c){this.ids.push(fm(e)),this.positions.push(i,o,c)}eachPosition(e,i){const o=fm(e);let c=0,f=this.ids.length-1;for(;c<f;){const p=c+f>>1;this.ids[p]>=o?f=p:c=p+1}for(;this.ids[c]===o;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return pm(o,c,0,o.length-1),i&&(i.add(o.buffer),i.add(c.buffer)),{ids:o,positions:c}}static deserialize(e){const i=new ud;let o;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==o&&i.uniqueIds.push(c),o=c;return i.indexed=!0,i}}function fm(n){const e=+n;return Number.isSafeInteger(e)?e:Ai(String(n))}function pm(n,e,i,o){for(;i<o;){const c=n[i+o>>1];let f=i-1,p=o+1;for(;;){do f++;while(n[f]<c);do p--;while(n[p]>c);if(f>=p)break;hd(n,f,p),hd(e,3*f,3*p),hd(e,3*f+1,3*p+1),hd(e,3*f+2,3*p+2)}p-i<o-p?(pm(n,e,i,p),i=p+1):(pm(n,e,p+1,o),o=p)}}function hd(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}yi(ud,"FeaturePositionMap");class Fl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class dd extends Fl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Ns extends Fl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class Bl extends Fl{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class fd extends Fl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class pd extends Fl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class yg extends Fl{constructor(e){super(e),this.current=Cn.transparent.toPremultipliedRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Jv=new Float32Array(16);class md extends Fl{constructor(e){super(e),this.current=Jv}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Qv=new Float32Array(9),ex=new Float32Array(4);class kf extends Fl{constructor(e){super(e),this.current=ex}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function _d(n){return[cd(255*n.r,255*n.g),cd(255*n.b,255*n.a)]}class Ga{constructor(e,i,o,c){this.value=e,this.uniformNames=i.map((f=>`u_${f}`)),this.type=o,this.context=c}setUniform(e,i,o,c,f){const p=c.constantOr(this.value);i.set(e,f,p instanceof Cn?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,i){return this.type==="color"?new yg(e):new Ns(e)}}class Du{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,o,c,f){let p=null;f!=="u_pattern"&&f!=="u_dash"||(p=this.pattern),f==="u_pattern_b"&&(p=this.patternTransition),f==="u_pixel_ratio"&&(p=this.pixelRatio),p&&i.set(e,f,p)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new pd(e):new Ns(e)}}class Vc{constructor(e,i,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new c}populatePaintArray(e,i,o,c,f,p,v,b){const T=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Nr(0,{brightness:p,worldview:b}),i,{},f,c,v):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:p,worldview:b}),i,{},f,c,v):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(T,e,I,C?null:this.context.lut)}updatePaintArray(e,i,o,c,f,p,v,b){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:b},o,c,void 0,f):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:v,worldview:b}),o,c,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I?null:this.context.lut)}_setPaintValue(e,i,o,c){if(this.type==="color"){const f=_d(o.toPremultipliedRenderColor(c));for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ac{constructor(e,i,o,c,f,p){this.expression=e,this.uniformNames=i.map((v=>`u_${v}_t`)),this.type=o,this.useIntegerZoom=c,this.context=f,this.maxValue=0,this.paintVertexAttributes=i.map((v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,o,c,f,p,v,b){const T=this.expression.evaluate(new Nr(this.context.zoom,{brightness:p,worldview:b}),i,{},f,c,v),I=this.expression.evaluate(new Nr(this.context.zoom+1,{brightness:p,worldview:b}),i,{},f,c,v),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:p,worldview:b}),i,{},f,c,v):this.lutExpression.value)==="none",O=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(O,e,T,I,C?null:this.context.lut)}updatePaintArray(e,i,o,c,f,p,v,b){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:b},o,c,void 0,f),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:b},o,c,void 0,f),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Nr(0,{brightness:v,worldview:b}),o,c,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I,C?null:this.context.lut)}_setPaintValue(e,i,o,c,f){if(this.type==="color"){const p=_d(o.toPremultipliedRenderColor(f)),v=_d(o.toPremultipliedRenderColor(f));for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,p[0],p[1],v[0],v[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,c,f){const p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,v=Le(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);i.set(e,f,v)}getBinding(e,i){return new Ns(e)}}class lc{constructor(e,i,o,c,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(o==="array"?zf:Kv).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new c,this.paintTransitionVertexArray=new xh}populatePaintArray(e,i,o,c){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,c,f,p,v){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(e,i,o,c){if(!c||!o)return;const f=c[o[0]],p=c[o[1]];if(f){if(f){const{tl:v,br:b,pixelRatio:T}=f;for(let I=e;I<i;I++)this.paintVertexArray.emplace(I,v[0],v[1],b[0],b[1],T)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:b}=p;for(let T=e;T<i;T++)this.paintTransitionVertexArray.emplace(T,v[0],v[1],b[0],b[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Yv.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class zu{constructor(e,i,o=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const c=[];for(const f in e.paint._values){const p=e.paint.get(f);if(f.endsWith("-use-theme")||!o(f)||!(p instanceof Pu&&uf(p.property.specification)))continue;const v=e1(f,e.type),b=p.value,T=p.property.specification.type,I=!!p.property.useIntegerZoom,C=f==="line-dasharray"||f.endsWith("pattern"),O=e.paint.get(`${f}-use-theme`),B=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||O&&O.value.kind!=="constant";if(b.kind!=="constant"||B)if(b.kind==="source"||B||C){const N=s(f,T,"source");this.binders[f]=C?new lc(b,v,T,N,e.id):new Vc(b,v,T,N),c.push(`/a_${f}`)}else{const N=s(f,T,"composite");this.binders[f]=new ac(b,v,T,I,i,N),c.push(`/z_${f}`)}else this.binders[f]=C?new Du(b.value,v):new Ga(b.value,v,T,i),c.push(`/u_${f}`);O&&(this.binders[f].lutExpression=O.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Vc||i instanceof ac?i.maxValue:0}populatePaintArrays(e,i,o,c,f,p,v,b){for(const T in this.binders){const I=this.binders[T];I.context=this.context,(I instanceof Vc||I instanceof ac||I instanceof lc)&&I.populatePaintArray(e,i,o,c,f,p,v,b)}}setConstantPatternPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof Du&&c.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof lc?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,o,c,f,p,v,b,T,I){let C=!1;const O=Object.keys(e),B=O.length!==0&&!b,N=B?O:i.uniqueIds;this.context.lut=f.lut;for(const X in this.binders){const K=this.binders[X];if(K.context=this.context,(K instanceof Vc||K instanceof ac||K instanceof lc)&&K.expression&&K.expression.kind&&K.expression.kind!=="constant"&&(K.expression.isStateDependent===!0||K.expression.isLightConstant===!1)){const Y=f.paint.get(X);K.expression=Y.value;for(const ue of N){const de=e[ue.toString()];i.eachPosition(ue,((_e,ze,ke)=>{const Ue=c.feature(_e);K.updatePaintArray(ze,ke,Ue,de,p,v,T,I)}))}if(!B)for(const ue of o.uniqueIds){const de=e[ue.toString()];o.eachPosition(ue,((_e,ze,ke)=>{const Ue=c.feature(_e);K.updatePaintArray(ze,ke,Ue,de,p,v,T,I)}))}C=!0}}return C}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Ga||o instanceof Du)&&e.push(...o.uniformNames.map((c=>`#define HAS_UNIFORM_${c}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Ga||c instanceof Du||c instanceof ac)for(const f of c.uniformNames)i.push({name:f,property:o,binding:c.getBinding(e,f)})}return i}setUniforms(e,i,o,c,f){for(const{name:p,property:v,binding:b}of o)this.binders[v].setUniform(e,b,f,c.get(v),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Vc||i instanceof ac||i instanceof lc)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof lc&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Vc||o instanceof ac||o instanceof lc)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Vc||i instanceof ac||i instanceof lc)&&i.destroy()}}}class yl{constructor(e,i,o=(()=>!0)){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new zu(c,i,o);this.needsUpload=!1,this._featureMap=new ud,this._featureMapWithoutIds=new ud,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,c,f,p,v,b,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,i,c,f,p,v,b,T);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,c,f,p,v,b){for(const T of o)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,T,c,f,p,v||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const vg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function e1(n,e){return vg[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const h={"line-pattern":{source:Uc,composite:Uc},"fill-pattern":{source:Uc,composite:Uc},"fill-extrusion-pattern":{source:Uc,composite:Uc},"line-dasharray":{source:xh,composite:xh}},t={color:{source:Th,composite:gl},number:{source:Nc,composite:Th}};function s(n,e,i){const o=h[n];return o&&o[i]||t[e][i]}yi(Ga,"ConstantBinder"),yi(Du,"PatternConstantBinder"),yi(Vc,"SourceExpressionBinder"),yi(lc,"PatternCompositeBinder"),yi(ac,"CompositeExpressionBinder"),yi(zu,"ProgramConfiguration",{omit:["_buffers"]}),yi(yl,"ProgramConfigurationSet");const u=Zt/Math.PI/2,m=5,g=6,x=16383,w=64,A=[w,32,16],R=-u,D=u;function U(n,e,i,o=u){return i=Xe(i),[n*Math.sin(i)*o,-e*o,n*Math.cos(i)*o]}function F(n,e,i){return U(Math.cos(Xe(n)),Math.sin(Xe(n)),e,i)}const V=63710088e-1,G=2*Math.PI*V;class Z{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Z(je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,c=e.lat*i,f=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return V*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new ie({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return F(this.lat,this.lng,u+e*u/V)}static convert(e){if(e instanceof Z)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Z(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Z(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ie{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Z?new Z(e.lng,e.lat):Z.convert(e),this}setSouthWest(e){return this._sw=e instanceof Z?new Z(e.lng,e.lat):Z.convert(e),this}extend(e){const i=this._sw,o=this._ne;let c,f;if(e instanceof Z)c=e,f=e;else{if(!(e instanceof ie))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ie.convert(e)):this.extend(Z.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Z.convert(e)):this;if(c=e._sw,f=e._ne,!c||!f)return this}return i||o?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),o.lng=Math.max(f.lng,o.lng),o.lat=Math.max(f.lat,o.lat)):(this._sw=new Z(c.lng,c.lat),this._ne=new Z(f.lng,f.lat)),this}getCenter(){return new Z((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Z(this.getWest(),this.getNorth())}getSouthEast(){return new Z(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=Z.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){if(e)return e instanceof ie?e:new ie(e)}}const J=0,ae=25.5;function me(n){return G*Math.cos(n*Math.PI/180)}function ye(n){return(180+n)/360}function Pe(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ae(n,e){return n/me(e)}function Me(n){return 360*n-180}function Ie(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Ee(n,e){return n*me(Ie(e))}const Re=85.051129;function nt(n){return Math.cos(Xe(Le(n,-Re,Re)))}function We(n,e){const i=Le(e,J,ae),o=Math.pow(2,i);return nt(n)*G/(512*o)}function gt(n){return 1/Math.cos(n*Math.PI/180)}function et(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/Zt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/Zt/(1<<n.z)}class pt{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Z.convert(e);return new pt(ye(o.lng),Pe(o.lat),Ae(i,o.lat))}toLngLat(){return new Z(Me(this.x),Ie(this.y))}toAltitude(){return Ee(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/G*gt(Ie(this.y))}}function Kt(n,e,i,o,c,f,p,v,b){const T=(e+o)/2,I=(i+c)/2,C=new kt(T,I);v(C),(function(O,B,N,X,K,Y){const ue=N-K,de=X-Y;return Math.abs((X-B)*ue-(N-O)*de)/Math.hypot(ue,de)})(C.x,C.y,f.x,f.y,p.x,p.y)>=b?(Kt(n,e,i,T,I,f,C,v,b),Kt(n,T,I,o,c,C,p,v,b)):n.push(p)}function it(n,e,i){let o=n[0],c=o.x,f=o.y;e(o);const p=[o];for(let v=1;v<n.length;v++){const b=n[v],{x:T,y:I}=b;e(b),Kt(p,c,f,T,I,o,b,e,i),c=T,f=I,o=b}return p}function Ve(n,e,i,o){if(o(e,i)){const c=e.add(i)._mult(.5);Ve(n,e,c,o),Ve(n,c,i,o)}else n.push(i)}function bt(n,e){let i=n[0];const o=[i];for(let c=1;c<n.length;c++){const f=n[c];Ve(o,i,f,e),i=f}return o}const ct=Math.pow(2,14)-1,zt=-ct-1;function Xt(n,e){const i=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=Le(i,zt,ct),n.y=Le(o,zt,ct),(i<n.x||i>n.x+1||o<n.y||o>n.y+1)&&An("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function hi(n,e,i){const o=n.loadGeometry(),c=n.extent,f=Zt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:v,x:b,y:T,projection:I}=i,C=O=>{const B=Me((e.x+O.x/c)/p),N=Ie((e.y+O.y/c)/p),X=I.project(B,N);O.x=(X.x*v-b)*c,O.y=(X.y*v-T)*c};for(let O=0;O<o.length;O++)if(n.type!==1)o[O]=it(o[O],C,1);else{const B=[];for(const N of o[O])N.x<0||N.x>=c||N.y<0||N.y>=c||(C(N),B.push(N));o[O]=B}}for(const p of o)for(const v of p)Xt(v,f);return o}function qt(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?hi(n):[]}}class Ut{constructor(e,i,o,c,f){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=f,e.readFields(Bi,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let c,f=1,p=0,v=0,b=0;for(;e.pos<i;){if(p<=0){const T=e.readVarint();f=7&T,p=T>>3}if(p--,f===1||f===2)v+=e.readSVarint(),b+=e.readSVarint(),f===1&&(c&&o.push(c),c=[]),c&&c.push(new kt(v,b));else{if(f!==7)throw new Error(`unknown command ${f}`);c&&c.push(c[0].clone())}}return c&&o.push(c),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,c=0,f=0,p=0,v=1/0,b=-1/0,T=1/0,I=-1/0;for(;e.pos<i;){if(c<=0){const C=e.readVarint();o=7&C,c=C>>3}if(c--,o===1||o===2)f+=e.readSVarint(),p+=e.readSVarint(),f<v&&(v=f),f>b&&(b=f),p<T&&(T=p),p>I&&(I=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[v,T,b,I]}toGeoJSON(e,i,o){const c=this.extent*Math.pow(2,o),f=this.extent*e,p=this.extent*i,v=this.loadGeometry();function b(O){return[360*(O.x+f)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(O.y+p)/c)*Math.PI))-90]}function T(O){return O.map(b)}let I;if(this.type===1){const O=[];for(const N of v)O.push(N[0]);const B=T(O);I=O.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const O=v.map(T);I=O.length===1?{type:"LineString",coordinates:O[0]}:{type:"MultiLineString",coordinates:O}}else{if(this.type!==3)throw new Error("unknown feature type");{const O=(function(N){const X=N.length;if(X<=1)return[N];const K=[];let Y,ue;for(let de=0;de<X;de++){const _e=Di(N[de]);_e!==0&&(ue===void 0&&(ue=_e<0),ue===_e<0?(Y&&K.push(Y),Y=[N[de]]):Y&&Y.push(N[de]))}return Y&&K.push(Y),K})(v),B=[];for(const N of O)B.push(N.map(T));I=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const C={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function Bi(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,c){const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=c._keys[o.readVarint()],v=c._values[o.readVarint()];c.properties[p]=v}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function Di(n){let e=0;for(let i,o,c=0,f=n.length,p=f-1;c<f;p=c++)i=n[c],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}Ut.types=["Unknown","Point","LineString","Polygon"];class Fi{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ri,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Ut(this._pbf,i,this.extent,this._keys,this._values)}}function Ri(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let c=null;const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=o.readVarint()>>3;c=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c})(i))}class on{constructor(e,i){this.layers=e.readFields(xn,{},i)}}function xn(n,e,i){if(n===3){const o=new Fi(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const wn="3d_elevation_id",gr="level";class hn{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,o){return this.get(e,!0,i,o)}optional(e,i,o){return this.get(e,!1,i,o)}success(){return this._valid}get(e,i,o,c){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?o(c?c(f):f):i&&(this._valid=!1),this}}class nr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,o){return this.featureFunc(e,i,o)}parseVertex(e,i,o){return this.vertexFunc(e,i,o)}}const mr=new nr(((n,e,i)=>n.reset(e).require(wn,(o=>{i.id=o})).optional("fixed_height_relative",(o=>{i.constantHeight=o}),bn.decodeRelativeHeight).geometry((o=>{i.bounds=o}),Ic).success()),((n,e,i)=>n.reset(e).require(wn,(o=>{i.id=o})).require("elevation_idx",(o=>{i.idx=o})).require("extent",(o=>{i.extent=o})).require("height_relative",(o=>{i.height=o}),bn.decodeRelativeHeight).geometry((o=>{i.position=o}),bn.getPoint).success())),Hr=new nr(((n,e,i)=>n.reset(e).require(wn,(o=>{i.id=o})).optional("fixed_height",(o=>{i.constantHeight=o}),bn.decodeMetricHeight).geometry((o=>{i.bounds=o}),Ic).success()),((n,e,i)=>n.reset(e).require(wn,(o=>{i.id=o})).require("elevation_idx",(o=>{i.idx=o})).require("extent",(o=>{i.extent=o})).require("height",(o=>{i.height=o}),bn.decodeMetricHeight).geometry((o=>{i.position=o}),bn.getPoint).success()));class bn{static getPoint(e){return Wr(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Hr:void 0:mr}static parse(e){const i=[],o=[],c=e.length,f=new hn;for(let p=0;p<c;p++){const v=e.feature(p),b=v.properties.version,T=bn.getVersionSchema(b);if(T===void 0){An(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}const I=v.properties.type;if(!I)continue;const C=Ut.types[v.type];if(C==="Point"&&I==="curve_point"){const O={};T.parseVertex(f,v,O)&&i.push(O)}else if(C==="Polygon"&&I==="curve_meta"){const O={};T.parseFeature(f,v,O)&&o.push(O)}}return{vertices:i,features:o}}}class ur{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const c=Dn(i,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/c;return o[0]=this.pos[0]+this.dir[0]*f,o[1]=this.pos[1]+this.dir[1]*f,!0}}class lr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const c=pi(i,this.dir);if(Math.abs(c)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return o[0]=this.pos[0]+this.dir[0]*f,o[1]=this.pos[1]+this.dir[1]*f,o[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,o){if((function(B,N){var X=B[0],K=B[1],Y=B[2],ue=N[0],de=N[1],_e=N[2];return Math.abs(X-ue)<=j*Math.max(1,Math.abs(X),Math.abs(ue))&&Math.abs(K-de)<=j*Math.max(1,Math.abs(K),Math.abs(de))&&Math.abs(Y-_e)<=j*Math.max(1,Math.abs(Y),Math.abs(_e))})(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[c,f,p]=this.dir,v=this.pos[0]-e[0],b=this.pos[1]-e[1],T=this.pos[2]-e[2],I=c*c+f*f+p*p,C=2*(v*c+b*f+T*p),O=C*C-4*I*(v*v+b*b+T*T-i*i);if(O<0){const B=Math.max(-C/2,0),N=v+c*B,X=b+f*B,K=T+p*B,Y=Math.hypot(N,X,K);return o[0]=N*i/Y,o[1]=X*i/Y,o[2]=K*i/Y,!1}{const B=(-C-Math.sqrt(O))/(2*I);if(B<0){const N=Math.hypot(v,b,T);return o[0]=v*i/N,o[1]=b*i/N,o[2]=T*i/N,!1}return o[0]=v+c*B,o[1]=b+f*B,o[2]=T+p*B,!0}}}class dr{constructor(e,i,o,c,f){this.TL=e,this.TR=i,this.BR=o,this.BL=c,this.horizon=f}static fromInvProjectionMatrix(e,i,o){const c=[-1,1,1],f=[1,1,1],p=[1,-1,1],v=[-1,-1,1],b=_i(c,c,e),T=_i(f,f,e),I=_i(p,p,e),C=_i(v,v,e);return new dr(b,T,I,C,i/o)}}function Qr(n,e,i){let o=1/0,c=-1/0;const f=[];for(const p of n){vt(f,p,e);const v=pi(f,i);o=Math.min(o,v),c=Math.max(c,v)}return[o,c]}function Cs(n,e){let i=!0;for(let o=0;o<n.planes.length;o++){const c=n.planes[o];let f=0;for(let p=0;p<e.length;p++)f+=+(pi(c,e[p])+c[3]>=0);if(f===0)return 0;f!==e.length&&(i=!1)}return i?2:1}function vo(n,e){for(const i of n.projections){const o=Qr(e,n.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function es(n,e){let i=0;const o=[0,0,0,0];for(let p=0;p<n.length;p++)o[0]=n[p][0],o[1]=n[p][1],o[2]=n[p][2],o[3]=1,(c=o)[0]*(f=e)[0]+c[1]*f[1]+c[2]*f[2]+c[3]*f[3]>=0&&i++;var c,f;return i}class Tn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=nn.fromPoints(this.points),this.projections=[],this.frustumEdges=[vt([],this.points[2],this.points[3]),vt([],this.points[0],this.points[3]),vt([],this.points[4],this.points[0]),vt([],this.points[5],this.points[1]),vt([],this.points[6],this.points[2]),vt([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const c=[0,-o[2],o[1]],f=[o[2],0,-o[0]];this.projections.push({axis:c,projection:Qr(this.points,this.points[0],c)}),this.projections.push({axis:f,projection:Qr(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,i,o,c){const f=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((T=>{const I=ui([],T,e),C=1/I[3]/i*f;return(O=I)[0]=(B=I)[0]*(N=[C,C,c?1/I[3]:C,C])[0],O[1]=B[1]*N[1],O[2]=B[2]*N[2],O[3]=B[3]*N[3],O;var O,B,N})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((T=>{const I=Pt([],Ui([],vt([],p[T[0]],p[T[1]]),vt([],p[T[2]],p[T[1]]))),C=-pi(I,p[T[1]]);return I.concat(C)})),b=[];for(let T=0;T<p.length;T++)b.push([p[T][0],p[T][1],p[T][2]]);return new Tn(b,v)}intersectsPrecise(e,i,o){for(let c=0;c<i.length;c++)if(!es(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!es(e,this.planes[c]))return 0;for(const c of o)for(const f of this.frustumEdges){const p=Ui([],c,f),v=ft(p);if(v===0)continue;di(p,p,1/v);const b=Qr(this.points,this.points[0],p),T=Qr(e,this.points[0],p);if(b[0]>T[1]||T[0]>b[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(pi([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class nn{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const c of e)Gi(i,i,c),Ti(o,o,c);return new nn(i,o)}static fromTileIdAndHeight(e,i,o){const c=1<<e.canonical.z,f=e.canonical.x,p=e.canonical.y;return new nn([f/c,p/c,i],[(f+1)/c,(p+1)/c,o])}static applyTransform(e,i){const o=e.getCorners();for(let c=0;c<o.length;++c)_i(o[c],o[c],i);return nn.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],c=[...o];for(let f=0;f<3;f++)for(let p=0;p<3;p++){const v=i[4*p+f],b=v*e.min[p],T=v*e.max[p];o[f]+=Math.min(b,T),c[f]+=Math.max(b,T)}return new nn(o,c)}static projectAabbCorners(e,i){const o=e.getCorners();for(let c=0;c<o.length;++c)_i(o[c],o[c],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=di([],yt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=He(this.min),c=He(this.max);for(let f=0;f<i.length;f++)o[f]=i[f]?this.min[f]:this.center[f],c[f]=i[f]?this.center[f]:this.max[f];return c[2]=this.max[2],new nn(o,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Cs(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Cs(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?vo(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?vo(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}yi(nn,"Aabb");class yr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,o=i[1],c=-i[0],f=(e.extent+1)*this.metersToTile;return[new kt(Math.trunc(e.position[0]+o*f),Math.trunc(e.position[1]+c*f)),new kt(Math.trunc(e.position[0]-o*f),Math.trunc(e.position[1]-c*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class bs{constructor(e,i,o,c,f,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Qn(),Qn(),Qn(),Qn(),Qn(),Qn(),Qn()],this.id=e,this.heightRange={min:o,max:o},this.safeArea=i,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=f,this.edges=this.edges.filter((v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((b=this.vertices[v.a].position)[0]===(T=this.vertices[v.b].position)[0]&&b[1]===T[1]);var b,T})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Wr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const b=this.vertices[v.a].position,T=this.vertices[v.b].position,I=ds(Qn(),T,b),C=Dt(I),O=Rt(Qn(),I,1/C);this.edgeProps.push({vec:I,dir:O,len:C});const B=this.vertexProps[v.a].dir,N=this.vertexProps[v.b].dir;Dr(B,B,O),Dr(N,N,O)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||en(v.dir,v.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[o,c]=i;return Mi(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,c)}computeSlopeNormal(e,i){const o=this.getClosestEdge(e);if(!o)return tt(0,0,1);const c=o[0],f=this.edges[c],p=this.edgeProps[c].vec,v=tt(p[0],p[1],(this.vertices[f.b].height-this.vertices[f.a].height)*i),b=tt(v[1],-v[0],0);Ui(b,b,v);const T=ft(b);return T>0?di(b,b,1/T):At(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,o=Number.POSITIVE_INFINITY,c=0;const[f,p,v,b,T,I,C]=this._tmpVec2;ns(C,e.x,e.y);const O=new ur(C,null);for(let B=0;B<this.edges.length;B++){const N=this.edges[B],X=this.edgeProps[B].dir;O.dir=X;const K=this.vertices[N.a].position,Y=this.vertices[N.b].position,ue=O.intersectsPlane(K,this.vertexProps[N.a].dir,f),de=O.intersectsPlane(Y,this.vertexProps[N.b].dir,p);if(!ue||!de)continue;ds(v,p,f),ds(b,C,f);const _e=Dn(v,v),ze=_e>0?Dn(b,v)/_e:0,ke=Le(ze,0,1),Ue=Math.abs((ze-ke)*this.edgeProps[B].len);ds(T,C,K),ns(I,X[1],-X[0]);const qe=Ue+Math.abs(Dn(T,I));qe<o&&(i=B,o=qe,c=ke)}return[i,c]}tessellate(e){const i=Oe(),o=Oe(),c=Oe(),f=Oe();for(let p=this.edges.length-1;p>=0;--p){const v=this.edges[p].a,b=this.edges[p].b,{position:T,height:I,extent:C}=this.vertices[v],{position:O,height:B,extent:N}=this.vertices[b],X=this.vertexProps[v].dir,K=this.vertexProps[b].dir;if(At(i,T[0]/e,T[1]/e,I),At(o,O[0]/e,O[1]/e,B),At(c,X[1],-X[0],0),di(c,c,C),At(f,K[1],-K[0],0),di(f,f,N),this.distSqLines(tt(i[0]+.5*c[0],i[1]+.5*c[1],i[2]+.5*c[2]),tt(o[0]-.5*f[0],o[1]-.5*f[1],o[2]-.5*f[2]),tt(i[0]-.5*c[0],i[1]-.5*c[1],i[2]-.5*c[2]),tt(o[0]+.5*f[0],o[1]+.5*f[1],o[2]+.5*f[2]))<=.0025000000000000005)continue;const Y=this.vertices.length,ue=Dr(Qn(),T,O);this.vertices.push({position:Rt(ue,ue,.5),height:.5*(I+B),extent:.5*(C+N)});const de=Dr(Qn(),X,K);this.vertexProps.push({dir:en(de,de)}),this.edges.splice(p,1),this.edgeProps.splice(p,1),this.edges.push({a:v,b:Y}),this.edges.push({a:Y,b});const _e=ds(Qn(),this.vertices[Y].position,T),ze=Dt(_e),ke={vec:_e,dir:Rt(Qn(),_e,1/ze),len:ze};this.edgeProps.push(ke),this.edgeProps.push(ke)}}distSqLines(e,i,o,c){const f=si(Oe(),i,e),p=si(Oe(),c,o),v=si(Oe(),e,o),b=pi(f,f),T=pi(f,p),I=pi(f,v),C=pi(p,p),O=pi(p,v),B=b*C-T*T;if(B===0)return dn(ei(f,o,c,pi(v,p)/pi(p,p)),e);const N=(b*O-T*I)/B;return dn(ei(f,e,i,(T*O-I*C)/B),ei(p,o,c,N))}}class os{static parseFrom(e,i){const o=bn.parse(e);if(!o)return[];let{vertices:c,features:f}=o;const p=1/et(i);f.sort(((I,C)=>I.id-C.id)),c.sort(((I,C)=>I.id-C.id||I.idx-C.idx)),c=c.filter(((I,C,O)=>C===O.findIndex((B=>B.id===I.id&&B.idx===I.idx))));const v=new Array;let b=0;const T=c.length;for(const I of f){if(I.constantHeight){v.push(new bs(I.id,I.bounds,I.constantHeight));continue}for(;b!==T&&c[b].id<I.id;)b++;if(b===T||c[b].id!==I.id)continue;const C=new Array,O=new Array,B=b;for(;b!==T&&c[b].id===I.id;){const N=c[b];if(C.push({position:N.position,height:N.height,extent:N.extent}),b!==B&&c[b-1].idx===N.idx-1){const X=b-B;O.push({a:X-1,b:X})}b++}v.push(new bs(I.id,I.bounds,void 0,C,O,p))}return v}static getElevationFeature(e,i){if(!i)return;const o=+e.properties[wn];return Number.isNaN(o)?void 0:i.find((c=>c.id===o))}}class Zs{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Zt,this.yOffset=(e.y*this.zScale-i.y)*Zt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,o){const c=this.constantElevation(i,o);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),o))}computeBiasedHeight(e,i){return i<=0?e:e+i*rt(0,i,e>=0?e:Math.abs(.5*e))}}yi(bs,"ElevationFeature");class Oo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Bc,this.indexArray=new co,this.segments=new cs,this.programConfigurations=new yl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Nc),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,c){const f=this.layers[0],p=[];let v=null;f.type==="circle"&&(v=f.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:C,sourceLayerIndex:O}of e){const B=this.layers[0]._featureFilter.needGeometry,N=qt(T,B);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom,{worldview:this.worldview}),N,o))continue;const X=v?v.evaluate(N,{},o):void 0,K={id:I,properties:T.properties,type:T.type,sourceLayerIndex:O,index:C,geometry:B?N.geometry:hi(T,o,c),patterns:{},sortKey:X};p.push(K)}v&&p.sort(((T,I)=>T.sortKey-I.sortKey));let b=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new Pf,b=c.projection);for(const T of p){const{geometry:I,index:C,sourceLayerIndex:O}=T,B=e[C].feature;this.addFeature(T,I,C,i.availableImages,o,b,i.brightness,i.elevationFeatures),i.featureIndex.insert(B,I,C,O,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,o,c,f,p,v){this.programConfigurations.updatePaintArrays(e,i,f,o,c,p,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Xv.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Wv.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,o,c,f,p,v,b){let T;this.elevationMode!=="none"&&(T=os.getElevationFeature(e,b));for(const I of i)for(const C of I){const O=C.x,B=C.y;if(O<0||O>=Zt||B<0||B>=Zt)continue;if(p){const K=p.projectTilePoint(O,B,f),Y=p.upVector(f,O,B);this.addGlobeExtVertex(K,Y),this.addGlobeExtVertex(K,Y),this.addGlobeExtVertex(K,Y),this.addGlobeExtVertex(K,Y)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),X=N.vertexLength;if(this.addCircleVertex(O,B,-1,-1),this.addCircleVertex(O,B,1,-1),this.addCircleVertex(O,B,1,1),this.addCircleVertex(O,B,-1,1),this.elevationMode!=="none"){const K=T?T.pointElevation(new kt(O,B)):0;this.hasElevation=this.hasElevation||K!==0;for(let Y=0;Y<4;Y++)this.elevatedLayoutVertexArray.emplaceBack(K)}this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c,f,v,void 0,this.worldview)}addCircleVertex(e,i,o,c){this.layoutVertexArray.emplaceBack(2*e+(o+1)/2,2*i+(c+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Ha(n,e){for(let i=0;i<n.length;i++)if(xo(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(xo(n,e[i]))return!0;return!!pa(n,e)}function Za(n,e,i){return!!xo(n,e)||!!Ms(e,n,i)}function Da(n,e){if(n.length===1)return to(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let c=0;c<o.length;c++)if(xo(n,o[c]))return!0}for(let i=0;i<n.length;i++)if(to(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(pa(n,e[i]))return!0;return!1}function za(n,e,i){if(n.length>1){if(pa(n,e))return!0;for(let o=0;o<e.length;o++)if(Ms(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(Ms(n[o],e,i))return!0;return!1}function pa(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],c=n[i+1];for(let f=0;f<e.length-1;f++)if(ol(o,c,e[f],e[f+1]))return!0}return!1}function ol(n,e,i,o){return Mr(n,i,o)!==Mr(e,i,o)&&Mr(n,e,i)!==Mr(n,e,o)}function vl(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function Is(n,e,i,o){const c=vl(n,e,o),f=vl(n,e,i);if(Math.sign(c)===Math.sign(f))return;const p=vl(i,o,n),v=p+f-c;return Math.sign(p)!==Math.sign(v)?[p/(p-v),f/(f-c)]:void 0}function Ms(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(as(n,e[c-1],e[c])<o)return!0;return!1}function as(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function to(n,e){let i,o,c,f=!1;for(let p=0;p<n.length;p++){i=n[p];for(let v=0,b=i.length-1;v<i.length;b=v++)o=i[v],c=i[b],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(f=!f)}return f}function xo(n,e){let i=!1;for(let o=0,c=n.length-1;o<n.length;c=o++){const f=n[o],p=n[c];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(i=!i)}return i}function Us(n,e,i,o,c){for(const p of n)if(e<=p.x&&i<=p.y&&o>=p.x&&c>=p.y)return!0;const f=[new kt(e,i),new kt(e,c),new kt(o,c),new kt(o,i)];if(n.length>2){for(const p of f)if(xo(n,p))return!0}for(let p=0;p<n.length-1;p++)if(qo(n[p],n[p+1],f))return!0;return!1}function qo(n,e,i){const o=i[0],c=i[2];if(n.x<o.x&&e.x<o.x||n.x>c.x&&e.x>c.x||n.y<o.y&&e.y<o.y||n.y>c.y&&e.y>c.y)return!1;const f=Mr(n,e,i[0]);return f!==Mr(n,e,i[1])||f!==Mr(n,e,i[2])||f!==Mr(n,e,i[3])}function Nl(n,e,i,o,c,f){let p=e.y-n.y,v=n.x-e.x;if(f=f||0){const b=p*p+v*v;if(b===0)return!0;const T=Math.sqrt(b);p/=T,v/=T}return!((i.x-n.x)*p+(i.y-n.y)*v-f<0||(o.x-n.x)*p+(o.y-n.y)*v-f<0||(c.x-n.x)*p+(c.y-n.y)*v-f<0)}function cc(n,e,i,o,c,f,p){return!(Nl(n,e,o,c,f,p)||Nl(e,i,o,c,f,p)||Nl(i,n,o,c,f,p)||Nl(o,c,n,e,i,p)||Nl(c,f,n,e,i,p)||Nl(f,o,n,e,i,p))}function xl(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function jc(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function $c(n,e,i,o,c){if(!e[0]&&!e[1])return n;const f=kt.convert(e)._mult(c);i==="viewport"&&f._rotate(-o);const p=[];for(let v=0;v<n.length;v++)p.push(n[v].sub(f));return p}function Ul(n,e,i,o){const c=kt.convert(n)._mult(o);return e==="viewport"&&c._rotate(-i),c}let Ah,uc;function Vl(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}yi(Oo,"CircleBucket",{omit:["layers"]});class hc{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=Bf(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const o=(function(f,p,v){var b=Vl(256*f,256*(p=Math.pow(2,v)-p-1),v),T=Vl(256*(f+1),256*(p+1),v);return b[0]+","+b[1]+","+T[0]+","+T[1]})(this.x,this.y,this.z),c=(function(f,p,v){let b,T="";for(let I=f;I>0;I--)b=1<<I-1,T+=(p&b?1:0)+(v&b?2:0);return T})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ff{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Bf(e,i.z,i.z,i.x,i.y)}}class ma{constructor(e,i,o,c,f){this.overscaledZ=e,this.wrap=i,this.canonical=new hc(o,+c,+f),this.key=i===0&&e===o?this.canonical.key:Bf(i,e,o,c,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new ma(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ma(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Bf(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Bf(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ma(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new ma(i,this.wrap,i,o,c),new ma(i,this.wrap,i,o+1,c),new ma(i,this.wrap,i,o,c+1),new ma(i,this.wrap,i,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ma(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ma(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ff(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Bf(n,e,i,o,c){const f=1<<Math.min(i,22);let p=f*(c%f)+o%f;return n&&i<22&&(p+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const fR=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new ma(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new ma(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new ma(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new ma(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];yi(hc,"CanonicalTileID"),yi(ma,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const pR=qn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:xg}=pR,mR=qn([{name:"a_pos_3",components:3,type:"Int16"}]);var t1=qn([{name:"a_pos",type:"Int16",components:2}]);function bg(n){return n*u/V}const _R=[new nn([R,R,R],[D,D,D]),new nn([R,R,R],[0,0,D]),new nn([0,R,R],[D,0,D]),new nn([R,0,R],[0,D,D]),new nn([0,0,R],[D,D,D])];function i1(n,e,i,o=!0){const c=di([],n._camera.position,n.worldSize),f=[e,i,1,1];ui(f,f,n.pixelMatrixInverse),Ei(f,f,1/f[3]);const p=Pt([],vt([],f,c)),v=n.globeMatrix,b=[v[12],v[13],v[14]],T=vt([],b,c),I=ft(T),C=Pt([],T),O=n.worldSize/(2*Math.PI),B=pi(C,p),N=Math.asin(O/I);if(N<Math.acos(B)){if(!o)return null;const Et=[],Je=[];di(Et,p,I/B),Pt(Je,vt(Je,Et,T)),Pt(p,yt(p,T,di(p,Je,Math.tan(N)*I)))}const X=[];new lr(c,p).closestPointOnSphere(b,O,X);const K=Pt([],Rr(v,0)),Y=Pt([],Rr(v,1)),ue=Pt([],Rr(v,2)),de=pi(K,X),_e=pi(Y,X),ze=pi(ue,X),ke=Q(Math.asin(-_e/O));let Ue=Q(Math.atan2(de,ze));Ue=n.center.lng+(function(Et,Je){const Ot=(Je-Et+180)%360-180;return Ot<-180?Ot+360:Ot})(n.center.lng,Ue);const qe=ye(Ue),Ze=Le(Pe(ke),0,1);return new pt(qe,Ze)}class gR{constructor(e,i,o){this.a=vt([],e,o),this.b=vt([],i,o),this.center=o;const c=Pt([],this.a),f=Pt([],this.b);this.angle=Math.acos(pi(c,f))}}function tx(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:(function(o,c,f,p){const v=Math.sin(f);return o*(Math.sin((1-p)*f)/v)+c*(Math.sin(p*f)/v)})(n.a[e],n.b[e],n.angle,Le(i,0,1))+n.center[e]}function qc(n){if(n.z<=1)return _R[n.z+2*n.y+n.x];const e=ix(wg(n));return nn.fromPoints(e)}function ku(n,e,i){return di(n,n,1-i),ki(n,n,e,i)}function n1(n,e,i){for(const o of n)_i(o,o,e),di(o,o,i)}function r1(n,e,i,o){const c=e/n.worldSize,f=n.globeMatrix;if(i.z<=1){const Ze=qc(i).getCorners();return n1(Ze,f,c),nn.fromPoints(Ze)}const p=wg(i,o),v=ix(p,u+bg(n._tileCoverLift));n1(v,f,c);const b=Number.MAX_VALUE,T=[-b,-b,-b],I=[b,b,b];if(p.contains(n.center)){for(const Je of v)Gi(I,I,Je),Ti(T,T,Je);T[2]=0;const Ze=n.point,Et=[Ze.x*c,Ze.y*c,0];return Gi(I,I,Et),Ti(T,T,Et),new nn(I,T)}if(n._tileCoverLift>0){for(const Ze of v)Gi(I,I,Ze),Ti(T,T,Ze);return new nn(I,T)}const C=[f[12]*c,f[13]*c,f[14]*c],O=p.getCenter(),B=Le(n.center.lat,-Re,Re),N=Le(O.lat,-Re,Re),X=ye(n.center.lng),K=Pe(B);let Y=X-ye(O.lng);const ue=K-Pe(N);Y>.5?Y-=1:Y<-.5&&(Y+=1);let de=0;Math.abs(Y)>Math.abs(ue)?de=Y>=0?1:3:(de=ue>=0?0:2,ki(C,C,[f[4]*c,f[5]*c,f[6]*c],-Math.sin(Xe(ue>=0?p.getSouth():p.getNorth()))*u));const _e=v[de],ze=v[(de+1)%4],ke=new gR(_e,ze,C),Ue=[tx(ke,0)||_e[0],tx(ke,1)||_e[1],tx(ke,2)||_e[2]],qe=Ih(n.zoom);if(qe>0){const Ze=(function({x:Je,y:Ot,z:jt},Lt,Ft,Gt,Tt){const Bt=1/(1<<jt);let ht=Je*Bt,at=ht+Bt,Ht=Ot*Bt,$t=Ht+Bt,Vi=0;const gi=(ht+at)/2-Gt;return gi>.5?Vi=-1:gi<-.5&&(Vi=1),ht=((ht+Vi)*Lt-(Gt*=Lt))*Ft+Gt,at=((at+Vi)*Lt-Gt)*Ft+Gt,Ht=(Ht*Lt-(Tt*=Lt))*Ft+Tt,$t=($t*Lt-Tt)*Ft+Tt,[[ht,$t,0],[at,$t,0],[at,Ht,0],[ht,Ht,0]]})(i,e,n._pixelsPerMercatorPixel,X,K);for(let Je=0;Je<v.length;Je++)ku(v[Je],Ze[Je],qe);const Et=yt([],Ze[de],Ze[(de+1)%4]);di(Et,Et,.5),ku(Ue,Et,qe)}for(const Ze of v)Gi(I,I,Ze),Ti(T,T,Ze);return I[2]=Math.min(_e[2],ze[2]),Gi(I,I,Ue),Ti(T,T,Ue),new nn(I,T)}function wg({x:n,y:e,z:i},o=!1){const c=1/(1<<i),f=new Z(Me(n*c),e===(1<<i)-1&&o?-90:Ie((e+1)*c)),p=new Z(Me((n+1)*c),e===0&&o?90:Ie(e*c));return new ie(f,p)}function ix(n,e=u){const i=Xe(n.getNorth()),o=Xe(n.getSouth()),c=Math.cos(i),f=Math.cos(o),p=Math.sin(i),v=Math.sin(o),b=n.getWest(),T=n.getEast();return[U(f,v,b,e),U(f,v,T,e),U(c,p,T,e),U(c,p,b,e)]}function mm(n,e,i,o){const c=1<<i.z,f=(n/Zt+i.x)/c;return F(Ie((e/Zt+i.y)/c),Me(f),o)}function Tg({min:n,max:e}){return x/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const s1=new Float64Array(16);function Sg(n){const e=Tg(n),i=It(s1,[e,e,e]);return fe(i,i,mt([],n.min))}function nx(n){const e=(o=n.min,(i=s1)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const c=1/Tg(n);return oe(e,e,[c,c,c])}function rx(n){const e=Zt/(2*Math.PI);return n/(2*Math.PI)/e}function o1(n,e){return Zt/(512*Math.pow(2,n))*Tg(qc(e))}function a1(n,e,i,o,c){const f=rx(i),p=[n,e,-i/(2*Math.PI)],v=he(new Float64Array(16));return fe(v,v,p),oe(v,v,[f,f,f]),ge(v,v,Xe(-c)),Ge(v,v,Xe(-o)),v}function Ih(n){return rt(m,g,n)}function l1(n,e){const i=F(e.lat,e.lng),o=(function(N){const X=F(N._center.lat,N._center.lng);let K=Ui([],tt(0,1,0),X);const Y=ot([],-N.angle,X);K=_i(K,K,Y),ot(Y,-N._pitch,K);const ue=Pt([],X);return di(ue,ue,bg(N.cameraToCenterDistance/N.pixelsPerMeter)),_i(ue,ue,Y),yt([],X,ue)})(n);return p=(c=si([],o,i))[0],v=c[1],b=c[2],T=(f=i)[0],I=f[1],C=f[2],B=(O=Math.sqrt((p*p+v*v+b*b)*(T*T+I*I+C*C)))&&pi(c,f)/O,Math.acos(Math.min(Math.max(B,-1),1));var c,f,p,v,b,T,I,C,O,B}function sx(n,e){return l1(n,e)>Math.PI/2*1.01}const c1=Xe(85),yR=Math.cos(c1),vR=Math.sin(c1),xR=se(),u1=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function h1(n,e,i,o,c,f,p,v,b){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(b*=n.pixelToTileUnitsFactor);const T=n.tileID.canonical,I=i.projection.upVectorScale(T,i.center.lat,i.worldSize).metersToTile;for(const C of e)for(const O of C){const B=O.add(v),N=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(B.x,B.y,!0):0,X=i.projection.projectTilePoint(B.x,B.y,T);if(N>0){const de=i.projection.upVector(T,B.x,B.y);X.x+=de[0]*I*N,X.y+=de[1]*I*N,X.z+=de[2]*I*N}const K=f?B:bR(X.x,X.y,X.z,o),Y=f?n.tilespaceRays.map((de=>TR(de,N))):n.queryGeometry.screenGeometry,ue=ui([],[X.x,X.y,X.z,1],o);if(!p&&f?b*=ue[3]/i.cameraToCenterDistance:p&&!f&&(b*=i.cameraToCenterDistance/ue[3]),f){const de=Ie((O.y/Zt+T.y)/(1<<T.z));b/=i.projection.pixelsPerMeter(de,1)/Ae(1,de)}if(Za(Y,K,b))return!0}return!1}function bR(n,e,i,o){const c=ui([],[n,e,i,1],o);return new kt(c[0]/c[3],c[1]/c[3])}const d1=tt(0,0,0),wR=tt(0,0,1);function TR(n,e){const i=Oe();return d1[2]=e,n.intersectsPlane(d1,wR,i),new kt(i[0],i[1])}class f1 extends Oo{}let p1,m1,_1,g1;function y1(n,{width:e,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=c,n}function v1(n,e,i){const{width:o,height:c}=e;o===n.width&&c===n.height||(ox(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,c)},i,null),n.width=o,n.height=c,n.data=e.data)}function ox(n,e,i,o,c,f,p,v){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const b=n.data,T=e.data,I=f===4&&v;for(let C=0;C<c.height;C++){const O=((i.y+C)*n.width+i.x)*f,B=((o.y+C)*e.width+o.x)*f;if(I)for(let N=0;N<c.width;N++){const X=O+N*f+3,K=B+N*f;T[K+0]=255,T[K+1]=255,T[K+2]=255,T[K+3]=b[X]}else if(p)for(let N=0;N<c.width;N++){const X=O+N*f,K=B+N*f,Y=new Cn(b[X+0]/255,b[X+1]/255,b[X+2]/255,b[X+3]).toNonPremultipliedRenderColor(p).toArray();T[K+0]=Y[0],T[K+1]=Y[1],T[K+2]=Y[2],T[K+3]=Y[3]}else for(let N=0;N<c.width*f;N++)T[B+N]=b[O+N]}return e}yi(f1,"HeatmapBucket",{omit:["layers"]});class Ph{constructor(e,i){y1(this,e,1,i)}resize(e){v1(this,new Ph(e),1)}clone(){return new Ph({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,f){ox(e,i,o,c,f,1,null)}}class Go{constructor(e,i){y1(this,e,4,i)}resize(e){v1(this,new Go(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,f,p,v){ox(e,i,o,c,f,4,p,v)}}class x1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function _m(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,c=n.image||new Go({width:i,height:o}),f=(p,v,b)=>{e[n.evaluationKey]=b;const T=n.expression.evaluate(e),I=T?T.toNonPremultipliedRenderColor(null):null;I&&(c.data[p+v+0]=Math.floor(255*I.r),c.data[p+v+1]=Math.floor(255*I.g),c.data[p+v+2]=Math.floor(255*I.b),c.data[p+v+3]=Math.floor(255*I.a))};if(n.clips)for(let p=0,v=0;p<o;++p,v+=4*i)for(let b=0,T=0;b<i;b++,T+=4){const I=b/(i-1),{start:C,end:O}=n.clips[p];f(v,T,C*(1-I)+O*I)}else for(let p=0,v=0;p<i;p++,v+=4)f(0,v,p/(i-1));return c}yi(Ph,"AlphaImage"),yi(Go,"RGBAImage");const SR=qn([{name:"a_pos",components:2,type:"Int16"}],4),ER=qn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),AR=qn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),IR=qn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Nf(n,e,i=2){const o=e&&e.length,c=o?e[0]*i:n.length;let f=b1(n,0,c,i,!0);const p=[];if(!f||f.next===f.prev)return p;let v,b,T;if(o&&(f=(function(I,C,O,B){const N=[];for(let X=0,K=C.length;X<K;X++){const Y=b1(I,C[X]*B,X<K-1?C[X+1]*B:I.length,B,!1);Y===Y.next&&(Y.steiner=!0),N.push(zR(Y))}N.sort(OR);for(let X=0;X<N.length;X++)O=LR(N[X],O);return O})(n,e,f,i)),n.length>80*i){v=n[0],b=n[1];let I=v,C=b;for(let O=i;O<c;O+=i){const B=n[O],N=n[O+1];B<v&&(v=B),N<b&&(b=N),B>I&&(I=B),N>C&&(C=N)}T=Math.max(I-v,C-b),T=T!==0?32767/T:0}return gm(f,p,i,v,b,T,0),p}function b1(n,e,i,o,c){let f;if(c===(function(p,v,b,T){let I=0;for(let C=v,O=b-T;C<b;C+=T)I+=(p[O]-p[C])*(p[C+1]+p[O+1]),O=C;return I})(n,e,i,o)>0)for(let p=e;p<i;p+=o)f=E1(p/o|0,n[p],n[p+1],f);else for(let p=i-o;p>=e;p-=o)f=E1(p/o|0,n[p],n[p+1],f);return f&&Uf(f,f.next)&&(xm(f),f=f.next),f}function gd(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Uf(o,o.next)&&Ao(o.prev,o,o.next)!==0)o=o.next;else{if(xm(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function gm(n,e,i,o,c,f,p){if(!n)return;!p&&f&&(function(b,T,I,C){let O=b;do O.z===0&&(O.z=ax(O.x,O.y,T,I,C)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==b);O.prevZ.nextZ=null,O.prevZ=null,(function(B){let N,X=1;do{let K,Y=B;B=null;let ue=null;for(N=0;Y;){N++;let de=Y,_e=0;for(let ke=0;ke<X&&(_e++,de=de.nextZ,de);ke++);let ze=X;for(;_e>0||ze>0&&de;)_e!==0&&(ze===0||!de||Y.z<=de.z)?(K=Y,Y=Y.nextZ,_e--):(K=de,de=de.nextZ,ze--),ue?ue.nextZ=K:B=K,K.prevZ=ue,ue=K;Y=de}ue.nextZ=null,X*=2}while(N>1)})(O)})(n,o,c,f);let v=n;for(;n.prev!==n.next;){const b=n.prev,T=n.next;if(f?CR(n,o,c,f):PR(n))e.push(b.i,n.i,T.i),xm(n),n=T.next,v=T.next;else if((n=T)===v){p?p===1?gm(n=MR(gd(n),e),e,i,o,c,f,2):p===2&&RR(n,e,i,o,c,f):gm(gd(n),e,i,o,c,f,1);break}}}function PR(n){const e=n.prev,i=n,o=n.next;if(Ao(e,i,o)>=0)return!1;const c=e.x,f=i.x,p=o.x,v=e.y,b=i.y,T=o.y,I=Math.min(c,f,p),C=Math.min(v,b,T),O=Math.max(c,f,p),B=Math.max(v,b,T);let N=o.next;for(;N!==e;){if(N.x>=I&&N.x<=O&&N.y>=C&&N.y<=B&&ym(c,v,f,b,p,T,N.x,N.y)&&Ao(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function CR(n,e,i,o){const c=n.prev,f=n,p=n.next;if(Ao(c,f,p)>=0)return!1;const v=c.x,b=f.x,T=p.x,I=c.y,C=f.y,O=p.y,B=Math.min(v,b,T),N=Math.min(I,C,O),X=Math.max(v,b,T),K=Math.max(I,C,O),Y=ax(B,N,e,i,o),ue=ax(X,K,e,i,o);let de=n.prevZ,_e=n.nextZ;for(;de&&de.z>=Y&&_e&&_e.z<=ue;){if(de.x>=B&&de.x<=X&&de.y>=N&&de.y<=K&&de!==c&&de!==p&&ym(v,I,b,C,T,O,de.x,de.y)&&Ao(de.prev,de,de.next)>=0||(de=de.prevZ,_e.x>=B&&_e.x<=X&&_e.y>=N&&_e.y<=K&&_e!==c&&_e!==p&&ym(v,I,b,C,T,O,_e.x,_e.y)&&Ao(_e.prev,_e,_e.next)>=0))return!1;_e=_e.nextZ}for(;de&&de.z>=Y;){if(de.x>=B&&de.x<=X&&de.y>=N&&de.y<=K&&de!==c&&de!==p&&ym(v,I,b,C,T,O,de.x,de.y)&&Ao(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;_e&&_e.z<=ue;){if(_e.x>=B&&_e.x<=X&&_e.y>=N&&_e.y<=K&&_e!==c&&_e!==p&&ym(v,I,b,C,T,O,_e.x,_e.y)&&Ao(_e.prev,_e,_e.next)>=0)return!1;_e=_e.nextZ}return!0}function MR(n,e){let i=n;do{const o=i.prev,c=i.next.next;!Uf(o,c)&&T1(o,i,i.next,c)&&vm(o,c)&&vm(c,o)&&(e.push(o.i,i.i,c.i),xm(i),xm(i.next),i=n=c),i=i.next}while(i!==n);return gd(i)}function RR(n,e,i,o,c,f){let p=n;do{let v=p.next.next;for(;v!==p.prev;){if(p.i!==v.i&&kR(p,v)){let b=S1(p,v);return p=gd(p,p.next),b=gd(b,b.next),gm(p,e,i,o,c,f,0),void gm(b,e,i,o,c,f,0)}v=v.next}p=p.next}while(p!==n)}function OR(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function LR(n,e){const i=(function(c,f){let p=f;const v=c.x,b=c.y;let T,I=-1/0;if(Uf(c,p))return p;do{if(Uf(c,p.next))return p.next;if(b<=p.y&&b>=p.next.y&&p.next.y!==p.y){const X=p.x+(b-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(X<=v&&X>I&&(I=X,T=p.x<p.next.x?p:p.next,X===v))return T}p=p.next}while(p!==f);if(!T)return null;const C=T,O=T.x,B=T.y;let N=1/0;p=T;do{if(v>=p.x&&p.x>=O&&v!==p.x&&w1(b<B?v:I,b,O,B,b<B?I:v,b,p.x,p.y)){const X=Math.abs(b-p.y)/(v-p.x);vm(p,c)&&(X<N||X===N&&(p.x>T.x||p.x===T.x&&DR(T,p)))&&(T=p,N=X)}p=p.next}while(p!==C);return T})(n,e);if(!i)return e;const o=S1(i,n);return gd(o,o.next),gd(i,i.next)}function DR(n,e){return Ao(n.prev,n,e.prev)<0&&Ao(e.next,n,n.next)<0}function ax(n,e,i,o,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function zR(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function w1(n,e,i,o,c,f,p,v){return(c-p)*(e-v)>=(n-p)*(f-v)&&(n-p)*(o-v)>=(i-p)*(e-v)&&(i-p)*(f-v)>=(c-p)*(o-v)}function ym(n,e,i,o,c,f,p,v){return!(n===p&&e===v)&&w1(n,e,i,o,c,f,p,v)}function kR(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&T1(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1})(n,e)&&(vm(n,e)&&vm(e,n)&&(function(i,o){let c=i,f=!1;const p=(i.x+o.x)/2,v=(i.y+o.y)/2;do c.y>v!=c.next.y>v&&c.next.y!==c.y&&p<(c.next.x-c.x)*(v-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==i);return f})(n,e)&&(Ao(n.prev,n,e.prev)||Ao(n,e.prev,e))||Uf(n,e)&&Ao(n.prev,n,n.next)>0&&Ao(e.prev,e,e.next)>0)}function Ao(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Uf(n,e){return n.x===e.x&&n.y===e.y}function T1(n,e,i,o){const c=Ag(Ao(n,e,i)),f=Ag(Ao(n,e,o)),p=Ag(Ao(i,o,n)),v=Ag(Ao(i,o,e));return c!==f&&p!==v||!(c!==0||!Eg(n,i,e))||!(f!==0||!Eg(n,o,e))||!(p!==0||!Eg(i,n,o))||!(v!==0||!Eg(i,e,o))}function Eg(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Ag(n){return n>0?1:n<0?-1:0}function vm(n,e){return Ao(n.prev,n,n.next)<0?Ao(n,e,n.next)>=0&&Ao(n,n.prev,e)>=0:Ao(n,e,n.prev)<0||Ao(n,n.next,e)<0}function S1(n,e){const i=lx(n.i,n.x,n.y),o=lx(e.i,e.x,e.y),c=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function E1(n,e,i,o){const c=lx(n,e,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function xm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function lx(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function bm(n,e){const i=n.length;if(i<=1)return[n];const o=[];let c,f;for(let p=0;p<i;p++){const v=ss(n[p]);v!==0&&(n[p].area=Math.abs(v),f===void 0&&(f=v<0),f===v<0?(c&&o.push(c),c=[n[p]]):c.push(n[p]))}if(c&&o.push(c),e>1)for(let p=0;p<o.length;p++)o[p].length<=e||(Zd(o[p],e,1,o[p].length-1,FR),o[p]=o[p].slice(0,e));return o}function FR(n,e){return e.area-n.area}function A1(n,e,i=1){if(!n)return null;const o=typeof n=="string"?Mo.from(n).getPrimary():n.getPrimary(),c=typeof n=="string"?null:n.getSecondary();for(const f of[o,c]){if(!f)continue;const p=f.id.toString();e.has(p)||e.set(p,[]),f.scaleSelf(i),e.get(p).push(f)}return{primary:o.toString(),secondary:c?c.toString():null}}function cx(n,e,i,o){const c=o.patternDependencies;let f=!1;for(const p of e){const v=p.paint.get(`${n}-pattern`);v.isConstant()||(f=!0),A1(v.constantOr(null),c,i)&&(f=!0)}return f}function ux(n,e,i,o,c,f){const p=f.patternDependencies;for(const v of e){const b=v.paint.get(`${n}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:o},i,{},f.availableImages);T=T&&T.name?T.name:T;const I=A1(T,p,c);if(!I)continue;const{primary:C,secondary:O}=I;C&&(i.patterns[v.id]=[C,O].filter(Boolean))}}return i}class I1{constructor(){this.polygons=new Map}add(e,...i){const o=this.polygons.get(e);o?o.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,o]of e.polygons)this.add(i,...o)}}class Fu{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Zt&&i>=Zt}static evaluate(e){if(e.length===0)return new Fu;let i=[];for(const b of e)i.push(...b.portals);if(i.length===0)return new Fu;for(const b of i){const T=b.va,I=b.vb;(Fu.isOnBorder(T.x,I.x)||Fu.isOnBorder(T.y,I.y))&&(b.type="border")}const o=i.filter((b=>b.type!=="unevaluated")),c=i.filter((b=>b.type==="unevaluated"));if(c.length===0)return new Fu;c.sort(((b,T)=>b.hash===T.hash?b.isTunnel===T.isTunnel?0:b.isTunnel?-1:1:b.hash<T.hash?1:-1)),i=o.concat(c);let f=o.length,p=f,v=f;do if(p++,p===i.length||i[f].hash!==i[p].hash){if(p-f==2){v<f&&(i[v]=i[f],i[f]=null);const b=i[v],T=i[p-1];b.type=b.isTunnel!==T.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:T.connection.a},v++}f=p}while(f!==i.length);return i.splice(v),i.sort(((b,T)=>b.hash<T.hash?1:-1)),{portals:i}}}yi(Fu,"ElevationPortalGraph"),yi(I1,"ElevationPolygons");class BR{constructor(e,i,o){this.outPositions=e,this.outNormals=i,this.outIndices=o,this.vertexLookup=new Map}addVertex(e,i,o){let c=e[2];o!=null&&(c*=o);const f=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,p=this.vertexLookup.get(f);if(p!=null)return p;const v=this.outPositions.length;this.vertexLookup.set(f,v);const b=Math.trunc(16384*i[0]),T=Math.trunc(16384*i[1]),I=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(b,T,I),v}addTriangle(e,i,o){this.outIndices.emplaceBack(e,i,o)}addTriangles(e,i,o){if(e.length===0)return;const c=o.length===1,f=Oe(),p=Oe();for(let v=0;v<e.length;v+=3){const b=i[e[v+0]],T=i[e[v+1]],I=i[e[v+2]],C=c?o[0]:o[e[v+1]],O=c?o[0]:o[e[v+2]];At(f,b.x,b.y,c?o[0]:o[e[v+0]]);const B=this.addVertex(f,p);At(f,T.x,T.y,C);const N=this.addVertex(f,p);At(f,I.x,I.y,O);const X=this.addVertex(f,p);this.outIndices.emplaceBack(B,N,X)}}addQuad(e,i,o,c,f,p){const v=this.addVertex(e,f,p),b=this.addVertex(i,f,p),T=this.addVertex(o,f,p),I=this.addVertex(c,f,p);this.addTriangle(v,b,T),this.addTriangle(T,I,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Wa{constructor(e,i,o,c){this.unevaluatedPortals=new Fu,this.portalPolygons=new I1,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new im,this.vertexNormals=new Af,this.indexArray=new co,this.tileToMeters=et(e),this.bridgeProgramConfigurations=new yl(i,{zoom:o,lut:c},(f=>f!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new yl(i,{zoom:o,lut:c},(f=>f!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const o=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(i[c]);return o}addTriangles(e,i,o){const c=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)c.push(f+i)}addRenderableRing(e,i,o,c,f,p){const v=[new kt(f.min.x,f.min.y),new kt(f.max.x,f.min.y),new kt(f.max.x,f.max.y),new kt(f.min.x,f.max.y)];for(let b=0;b<o-1;b++){const T=i+b,I=T+1,C=this.unevalVertices[T],O=this.unevalVertices[I];if(!(C.x>=f.min.x&&C.x<=f.max.x&&C.y>=f.min.y&&C.y<=f.max.y||O.x>=f.min.x&&O.x<=f.max.x&&O.y>=f.min.y&&O.y<=f.max.y||qo(C,O,v))||this.isOnBorder(C.x,O.x)||this.isOnBorder(C.y,O.y))continue;const B=Wa.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[I]);let N,X=this.vertexHashLookup.get(Wa.computePosHash(C));X!=null?N=X.next:(X=this.vertexHashLookup.get(Wa.computePosHash(O)),N=X!=null?X.prev:B),this.unevalEdges.push({polygonIdx:e,a:T,b:I,hash:B,portalHash:N,isTunnel:c,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,i,o,c,f){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:f});const p=i[0];this.vertexHashLookup.clear();let v=Wa.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let b=0;b<p.length-1;b++){const T=p[b+0],I=p[b+1],C=Wr(I.x-T.x,I.y-T.y),O=Dt(C);if(O===0)continue;let B="unevaluated";const N=c.pointElevation(T),X=c.pointElevation(I);Math.abs(N)<.01&&Math.abs(X)<.01?B="entrance":(this.isOnBorder(T.x,I.x)||this.isOnBorder(T.y,I.y))&&(B="border");const K=Wa.computeEdgeHash(T,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:I,vab:C,length:O,hash:K,isTunnel:o,type:B});const Y=Wa.computePosHash(T);this.vertexHashLookup.set(Y,{prev:v,next:K}),v=K}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=O=>{O.primitiveLength=this.indexArray.length-O.primitiveOffset},c=new BR(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=i(),p=i(),v=i(),b=(O,B)=>{O.sort(((X,K)=>X.type===B&&K.type!==B?-1:X.type!==B&&K.type===B?1:0));const N=O.findIndex((X=>X.type!==B));return N>=0?N:O.length};let T=0;this.unevalEdges.length>0&&(T=b(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),o(v);const I=i(),C=i();if(this.unevalEdges.length>0){const O=this.unevalEdges.splice(T),B=b(O,"tunnel")+T;this.unevalEdges.push(...O),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:B})}o(I),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(C),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(p),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(f),this.maskSegments=cs.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.depthSegments=cs.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=cs.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=cs.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=cs.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,i,o,c,f,p,v,b){this.bridgeProgramConfigurations.updatePaintArrays(e,i,f,o,c,p,v,b),this.tunnelProgramConfigurations.updatePaintArrays(e,i,f,o,c,p,v,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,AR.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,IR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,o,c,f){const p=(v,b)=>{for(let T=0;T<b.length-1;T++){const I=b[T].featureIndex,C=b[T+1].vertexStart,O=e.feature(I);v.populatePaintArrays(C,O,I,{},o,i,c,void 0,f)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,o,c,f){const p=new Map;for(let v=c;v<f;v++){const b=o[v],T=b.a,I=b.b,C=Wa.computePosHash(e[T]),O=Wa.computePosHash(e[I]);let B=p.get(C);B||(B={},p.set(C,B));let N=p.get(O);N||(N={},p.set(O,N)),i[T]<=0&&i[I]<=0||(B.to=I,N.from=T)}return p}isTerminalVertex(e,i){const o=Wa.computePosHash(this.unevalVertices[e]),c=i.get(o);return!c||!c.from||!c.to}constructBridgeStructures(e,i,o,c,f,p){e.clearVertexLookup();const v=this.computeVertexConnections(i,o,c,f.min,f.max),b=1/p,T=.5*b,I=(Ft,Gt)=>At(Ft,i[Gt].x,i[Gt].y,o[Gt]*b),C=Oe(),O=Oe(),B=Oe(),N=Oe(),X=Oe(),K=(Ft,Gt)=>{const Tt=v.get(Wa.computePosHash(i[Gt])),Bt=Tt.from,ht=Tt.to;if(!Bt||!ht)return;I(C,Bt),I(O,Gt),I(B,ht),$e(N),lt(C,O)||(vt(X,O,C),Pt(N,X)),lt(B,O)||(vt(X,B,O),yt(N,N,Pt(X,X)));const at=ii(N);return at>0?di(Ft,N,1/at):void 0};let Y=Number.POSITIVE_INFINITY;this.sortSubarray(c,f.min,f.max,((Ft,Gt)=>Ft.featureInfo.featureIndex-Gt.featureInfo.featureIndex));const ue=Oe(),de=Oe(),_e=Oe(),ze=Oe(),ke=Oe(),Ue=Oe(),qe=Oe(),Ze=Oe(),Et=Oe(),Je=[Oe(),Oe(),Oe(),Oe()],Ot=[Oe(),Oe(),Oe(),Oe()],jt=[{coord:new kt(0,0),height:0},{coord:new kt(0,0),height:0}],Lt=(Ft,Gt)=>Ft>Gt;for(let Ft=f.min;Ft<f.max;Ft++){const Gt=c[Ft];if(!Gt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(jt,i,o,Gt,Lt))continue;const[Tt,Bt]=jt;if(At(ue,Tt.coord.x,Tt.coord.y,b*Tt.height),At(de,Bt.coord.x,Bt.coord.y,b*Bt.height),lt(ue,de))continue;vt(_e,de,ue),Pt(_e,_e);const ht=K(Ze,Gt.a)||_e,at=K(Et,Gt.b)||_e;At(ze,ht[1],-ht[0],0),Pt(ze,ze),At(ke,at[1],-at[0],0),Pt(ke,ke),Ui(Ze,ze,ht),Pt(Ue,Ze),Ui(Ze,ke,at),Pt(qe,Ze),yt(Je[0],ue,di(Ze,vt(Ze,ze,Ue),T)),yt(Je[1],ue,di(Ze,yt(Ze,ze,Ue),T)),yt(Je[2],ue,di(Ze,Ue,T)),Je[3]=ue,yt(Ot[0],de,di(Ze,vt(Ze,ke,qe),T)),yt(Ot[1],de,di(Ze,yt(Ze,ke,qe),T)),yt(Ot[2],de,di(Ze,qe,T)),Ot[3]=de,Y=this.addFeatureSection(Gt.featureInfo.featureIndex,Y,this.bridgeFeatureSections,e);const Ht=e.addVertex(Je[0],ze,p),$t=e.addVertex(Je[1],ze,p),Vi=e.addVertex(Ot[0],ke,p),gi=e.addVertex(Ot[1],ke,p);e.addTriangle(Ht,$t,Vi),e.addTriangle($t,gi,Vi);const Ci=e.addVertex(Je[1],Ue,p),Yt=e.addVertex(Je[2],Ue,p),Ni=e.addVertex(Ot[1],qe,p),ln=e.addVertex(Ot[2],qe,p);e.addTriangle(Ci,Yt,Ni),e.addTriangle(Yt,ln,Ni),mt(ze,ze),mt(ke,ke);const oi=e.addVertex(Je[2],ze,p),zi=e.addVertex(Je[3],ze,p),tn=e.addVertex(Ot[2],ke,p),_n=e.addVertex(Ot[3],ke,p);e.addTriangle(oi,zi,tn),e.addTriangle(zi,_n,tn);const On=this.isTerminalVertex(Gt.a,v),yn=this.isTerminalVertex(Gt.b,v);Tt.height<.01&&On&&e.addQuad(Je[3],Je[2],Je[1],Je[0],mt(ht,ht),p),Bt.height<.01&&yn&&e.addQuad(Ot[0],Ot[1],Ot[2],Ot[3],at,p)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,o,c,f,p){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const b=(Y,ue)=>Y.featureInfo.featureIndex-ue.featureInfo.featureIndex;this.sortSubarray(c,f.min,f.max,b),this.sortSubarray(c,p.min,p.max,b);const T=Y=>Pt(Y,Y),I=[{coord:new kt(0,0),height:0},{coord:new kt(0,0),height:0}],C=(Y,ue)=>Y<ue,O=Oe(),B=Oe(),N=Oe(),X=Oe(),K=Oe();for(let Y=f.min;Y<f.max;Y++){if(!this.prepareEdgePoints(I,i,o,c[Y],C))continue;const[ue,de]=I,_e=T(At(K,-(de.coord.y-ue.coord.y),de.coord.x-ue.coord.x,0));v=this.addFeatureSection(c[Y].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(At(O,ue.coord.x,ue.coord.y,ue.height),At(B,de.coord.x,de.coord.y,de.height),At(N,de.coord.x,de.coord.y,c[Y].isTunnel?-.1:0),At(X,ue.coord.x,ue.coord.y,c[Y].isTunnel?-.1:0),_e)}for(let Y=p.min;Y<p.max;Y++){const ue=c[Y];ue.isTunnel&&([ue.a,ue.b]=[ue.b,ue.a]);const de=i[ue.a],_e=i[ue.b],ze=T(At(K,-(_e.y-de.y),_e.x-de.x,0));v=this.addFeatureSection(ue.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(At(O,_e.x,_e.y,0),At(B,de.x,de.y,0),At(N,de.x,de.y,o[ue.a]+4),At(X,_e.x,_e.y,o[ue.b]+4),ze),e.addQuad(At(O,de.x,de.y,0),At(B,_e.x,_e.y,0),At(N,_e.x,_e.y,o[ue.b]+4),At(X,de.x,de.y,o[ue.a]+4),ze)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,o,c){e.coord.x=i,e.coord.y=o,e.height=c}prepareEdgePoints(e,i,o,c,f){let p=i[c.a].x,v=i[c.a].y,b=i[c.b].x,T=i[c.b].y,I=o[c.a],C=o[c.b];const O=f(I,0),B=f(C,0);if(O&&B)return this.setElevatedPoint(e[0],p,v,I),this.setElevatedPoint(e[1],b,T,C),!0;if(!O&&!B)return!1;if(O){if(!B){const N=C/(C-I);b=Mi(b,p,N),T=Mi(T,v,N),C=Mi(C,I,N)}}else{const N=I/(I-C);p=Mi(p,b,N),v=Mi(v,T,N),I=Mi(I,C,N)}return this.setElevatedPoint(e[0],p,v,I),this.setElevatedPoint(e[1],b,T,C),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((v,b)=>v.hash===b.hash?b.polygonIdx-v.polygonIdx:b.hash>v.hash?1:-1));let o=0,c=0,f=0,p=i[o].polygonIdx;do c++,(c===i.length||i[o].hash!==i[c].hash)&&((c-o==1||i[c-1].polygonIdx!==p)&&(f<o&&(i[f]=i[o],i[o]=null),i[f].type="none",f++),o=c,o!==i.length&&(p=i[o].polygonIdx));while(o!==i.length);if(i.splice(f),i.length!==0&&e.length!==0){i.sort(((T,I)=>T.portalHash<I.portalHash?1:-1));let v=0,b=0;for(;v!==i.length&&b!==e.length;){const T=i[v],I=e[b];T.portalHash>I.hash?v++:I.hash>T.portalHash?b++:(T.type=I.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Zt&&i>=Zt}addFeatureSection(e,i,o,c){return e!==i&&(i=e,o.push({featureIndex:e,vertexStart:c.getVertexCount()}),c.clearVertexLookup()),i}sortSubarray(e,i,o,c){const f=e.slice(i,o);f.sort(c),e.splice(i,f.length,...f)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Wa.computePosHash(e))<<32n|BigInt(Wa.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var P1,C1={exports:{}},M1=(P1||(P1=1,(function(n,e){(function(i){function o(xe,we){return xe>we?1:xe<we?-1:0}var c=function(xe,we){xe===void 0&&(xe=o),we===void 0&&(we=!1),this._compare=xe,this._root=null,this._size=0,this._noDuplicates=!!we},f={size:{configurable:!0}};function p(xe,we,ut,St,ri){var ni=ri-St;if(ni>0){var xi=St+Math.floor(ni/2),ji={key:we[xi],data:ut[xi],parent:xe};return ji.left=p(ji,we,ut,St,xi),ji.right=p(ji,we,ut,xi+1,ri),ji}return null}function v(xe,we,ut,St,ri){if(!(ut>=St)){for(var ni=xe[ut+St>>1],xi=ut-1,ji=St+1;;){do xi++;while(ri(xe[xi],ni)<0);do ji--;while(ri(xe[ji],ni)>0);if(xi>=ji)break;var Ln=xe[xi];xe[xi]=xe[ji],xe[ji]=Ln,Ln=we[xi],we[xi]=we[ji],we[ji]=Ln}v(xe,we,ut,ji,ri),v(xe,we,ji+1,St,ri)}}c.prototype.rotateLeft=function(xe){var we=xe.right;we&&(xe.right=we.left,we.left&&(we.left.parent=xe),we.parent=xe.parent),xe.parent?xe===xe.parent.left?xe.parent.left=we:xe.parent.right=we:this._root=we,we&&(we.left=xe),xe.parent=we},c.prototype.rotateRight=function(xe){var we=xe.left;we&&(xe.left=we.right,we.right&&(we.right.parent=xe),we.parent=xe.parent),xe.parent?xe===xe.parent.left?xe.parent.left=we:xe.parent.right=we:this._root=we,we&&(we.right=xe),xe.parent=we},c.prototype._splay=function(xe){for(;xe.parent;){var we=xe.parent;we.parent?we.left===xe&&we.parent.left===we?(this.rotateRight(we.parent),this.rotateRight(we)):we.right===xe&&we.parent.right===we?(this.rotateLeft(we.parent),this.rotateLeft(we)):we.left===xe&&we.parent.right===we?(this.rotateRight(we),this.rotateLeft(we)):(this.rotateLeft(we),this.rotateRight(we)):we.left===xe?this.rotateRight(we):this.rotateLeft(we)}},c.prototype.splay=function(xe){for(var we,ut,St,ri,ni;xe.parent;)(ut=(we=xe.parent).parent)&&ut.parent?((St=ut.parent).left===ut?St.left=xe:St.right=xe,xe.parent=St):(xe.parent=null,this._root=xe),ri=xe.left,ni=xe.right,xe===we.left?(ut&&(ut.left===we?(we.right?(ut.left=we.right,ut.left.parent=ut):ut.left=null,we.right=ut,ut.parent=we):(ri?(ut.right=ri,ri.parent=ut):ut.right=null,xe.left=ut,ut.parent=xe)),ni?(we.left=ni,ni.parent=we):we.left=null,xe.right=we,we.parent=xe):(ut&&(ut.right===we?(we.left?(ut.right=we.left,ut.right.parent=ut):ut.right=null,we.left=ut,ut.parent=we):(ni?(ut.left=ni,ni.parent=ut):ut.left=null,xe.right=ut,ut.parent=xe)),ri?(we.right=ri,ri.parent=we):we.right=null,xe.left=we,we.parent=xe)},c.prototype.replace=function(xe,we){xe.parent?xe===xe.parent.left?xe.parent.left=we:xe.parent.right=we:this._root=we,we&&(we.parent=xe.parent)},c.prototype.minNode=function(xe){if(xe===void 0&&(xe=this._root),xe)for(;xe.left;)xe=xe.left;return xe},c.prototype.maxNode=function(xe){if(xe===void 0&&(xe=this._root),xe)for(;xe.right;)xe=xe.right;return xe},c.prototype.insert=function(xe,we){var ut=this._root,St=null,ri=this._compare;if(this._noDuplicates)for(;ut;){if(St=ut,ri(ut.key,xe)===0)return;ut=ri(ut.key,xe)<0?ut.right:ut.left}else for(;ut;)St=ut,ut=ri(ut.key,xe)<0?ut.right:ut.left;return ut={key:xe,data:we,left:null,right:null,parent:St},St?ri(St.key,ut.key)<0?St.right=ut:St.left=ut:this._root=ut,this.splay(ut),this._size++,ut},c.prototype.find=function(xe){for(var we=this._root,ut=this._compare;we;){var St=ut(we.key,xe);if(St<0)we=we.right;else{if(!(St>0))return we;we=we.left}}return null},c.prototype.contains=function(xe){for(var we=this._root,ut=this._compare;we;){var St=ut(xe,we.key);if(St===0)return!0;we=St<0?we.left:we.right}return!1},c.prototype.remove=function(xe){var we=this.find(xe);if(!we)return!1;if(this.splay(we),we.left)if(we.right){var ut=this.minNode(we.right);ut.parent!==we&&(this.replace(ut,ut.right),ut.right=we.right,ut.right.parent=ut),this.replace(we,ut),ut.left=we.left,ut.left.parent=ut}else this.replace(we,we.left);else this.replace(we,we.right);return this._size--,!0},c.prototype.removeNode=function(xe){if(!xe)return!1;if(this.splay(xe),xe.left)if(xe.right){var we=this.minNode(xe.right);we.parent!==xe&&(this.replace(we,we.right),we.right=xe.right,we.right.parent=we),this.replace(xe,we),we.left=xe.left,we.left.parent=we}else this.replace(xe,xe.left);else this.replace(xe,xe.right);return this._size--,!0},c.prototype.erase=function(xe){var we=this.find(xe);if(we){this.splay(we);var ut=we.left,St=we.right,ri=null;ut&&(ut.parent=null,ri=this.maxNode(ut),this.splay(ri),this._root=ri),St&&(ut?ri.right=St:this._root=St,St.parent=ri),this._size--}},c.prototype.pop=function(){var xe=this._root,we=null;if(xe){for(;xe.left;)xe=xe.left;we={key:xe.key,data:xe.data},this.remove(xe.key)}return we},c.prototype.next=function(xe){var we=xe;if(we)if(we.right)for(we=we.right;we&&we.left;)we=we.left;else for(we=xe.parent;we&&we.right===xe;)xe=we,we=we.parent;return we},c.prototype.prev=function(xe){var we=xe;if(we)if(we.left)for(we=we.left;we&&we.right;)we=we.right;else for(we=xe.parent;we&&we.left===xe;)xe=we,we=we.parent;return we},c.prototype.forEach=function(xe){for(var we=this._root,ut=[],St=!1,ri=0;!St;)we?(ut.push(we),we=we.left):ut.length>0?(xe(we=ut.pop(),ri++),we=we.right):St=!0;return this},c.prototype.range=function(xe,we,ut,St){for(var ri=[],ni=this._compare,xi=this._root;ri.length!==0||xi;)if(xi)ri.push(xi),xi=xi.left;else{if(ni((xi=ri.pop()).key,we)>0)break;if(ni(xi.key,xe)>=0&&ut.call(St,xi))return this;xi=xi.right}return this},c.prototype.keys=function(){for(var xe=this._root,we=[],ut=[],St=!1;!St;)xe?(we.push(xe),xe=xe.left):we.length>0?(xe=we.pop(),ut.push(xe.key),xe=xe.right):St=!0;return ut},c.prototype.values=function(){for(var xe=this._root,we=[],ut=[],St=!1;!St;)xe?(we.push(xe),xe=xe.left):we.length>0?(xe=we.pop(),ut.push(xe.data),xe=xe.right):St=!0;return ut},c.prototype.at=function(xe){for(var we=this._root,ut=[],St=!1,ri=0;!St;)if(we)ut.push(we),we=we.left;else if(ut.length>0){if(we=ut.pop(),ri===xe)return we;ri++,we=we.right}else St=!0;return null},c.prototype.load=function(xe,we,ut){if(xe===void 0&&(xe=[]),we===void 0&&(we=[]),ut===void 0&&(ut=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var St=xe.length;return ut&&v(xe,we,0,St-1,this._compare),this._root=p(null,xe,we,0,St),this._size=St,this},c.prototype.min=function(){var xe=this.minNode(this._root);return xe?xe.key:null},c.prototype.max=function(){var xe=this.maxNode(this._root);return xe?xe.key:null},c.prototype.isEmpty=function(){return this._root===null},f.size.get=function(){return this._size},c.createTree=function(xe,we,ut,St,ri){return new c(ut,ri).load(xe,we,St)},Object.defineProperties(c.prototype,f);var b=0,T=1,I=2,C=3,O=0,B=1,N=2,X=3;function K(xe,we,ut){we===null?(xe.inOut=!1,xe.otherInOut=!0):(xe.isSubject===we.isSubject?(xe.inOut=!we.inOut,xe.otherInOut=we.otherInOut):(xe.inOut=!we.otherInOut,xe.otherInOut=we.isVertical()?!we.inOut:we.inOut),we&&(xe.prevInResult=!Y(we,ut)||we.isVertical()?we.prevInResult:we));var St=Y(xe,ut);xe.resultTransition=St?(function(ri,ni){var xi,ji=!ri.inOut,Ln=!ri.otherInOut;switch(ni){case O:xi=ji&&Ln;break;case B:xi=ji||Ln;break;case X:xi=ji^Ln;break;case N:xi=ri.isSubject?ji&&!Ln:Ln&&!ji}return xi?1:-1})(xe,ut):0}function Y(xe,we){switch(xe.type){case b:switch(we){case O:return!xe.otherInOut;case B:return xe.otherInOut;case N:return xe.isSubject&&xe.otherInOut||!xe.isSubject&&!xe.otherInOut;case X:return!0}break;case I:return we===O||we===B;case C:return we===N;case T:return!1}return!1}var ue=function(xe,we,ut,St,ri){this.left=we,this.point=xe,this.otherEvent=ut,this.isSubject=St,this.type=ri||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},de={inResult:{configurable:!0}};function _e(xe,we){return xe[0]===we[0]&&xe[1]===we[1]}ue.prototype.isBelow=function(xe){var we=this.point,ut=this.otherEvent.point;return this.left?(we[0]-xe[0])*(ut[1]-xe[1])-(ut[0]-xe[0])*(we[1]-xe[1])>0:(ut[0]-xe[0])*(we[1]-xe[1])-(we[0]-xe[0])*(ut[1]-xe[1])>0},ue.prototype.isAbove=function(xe){return!this.isBelow(xe)},ue.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},de.inResult.get=function(){return this.resultTransition!==0},ue.prototype.clone=function(){var xe=new ue(this.point,this.left,this.otherEvent,this.isSubject,this.type);return xe.contourId=this.contourId,xe.resultTransition=this.resultTransition,xe.prevInResult=this.prevInResult,xe.isExteriorRing=this.isExteriorRing,xe.inOut=this.inOut,xe.otherInOut=this.otherInOut,xe},Object.defineProperties(ue.prototype,de);var ze=11102230246251565e-32,ke=134217729,Ue=(3+8*ze)*ze;function qe(xe,we,ut,St,ri){var ni,xi,ji,Ln,zn=we[0],En=St[0],vr=0,ts=0;En>zn==En>-zn?(ni=zn,zn=we[++vr]):(ni=En,En=St[++ts]);var Sn=0;if(vr<xe&&ts<ut)for(En>zn==En>-zn?(ji=ni-((xi=zn+ni)-zn),zn=we[++vr]):(ji=ni-((xi=En+ni)-En),En=St[++ts]),ni=xi,ji!==0&&(ri[Sn++]=ji);vr<xe&&ts<ut;)En>zn==En>-zn?(ji=ni-((xi=ni+zn)-(Ln=xi-ni))+(zn-Ln),zn=we[++vr]):(ji=ni-((xi=ni+En)-(Ln=xi-ni))+(En-Ln),En=St[++ts]),ni=xi,ji!==0&&(ri[Sn++]=ji);for(;vr<xe;)ji=ni-((xi=ni+zn)-(Ln=xi-ni))+(zn-Ln),zn=we[++vr],ni=xi,ji!==0&&(ri[Sn++]=ji);for(;ts<ut;)ji=ni-((xi=ni+En)-(Ln=xi-ni))+(En-Ln),En=St[++ts],ni=xi,ji!==0&&(ri[Sn++]=ji);return ni===0&&Sn!==0||(ri[Sn++]=ni),Sn}function Ze(xe){return new Float64Array(xe)}var Et=33306690738754716e-32,Je=22204460492503146e-32,Ot=11093356479670487e-47,jt=Ze(4),Lt=Ze(8),Ft=Ze(12),Gt=Ze(16),Tt=Ze(4);function Bt(xe,we,ut){var St=(function(ri,ni,xi,ji,Ln,zn){var En=(ni-zn)*(xi-Ln),vr=(ri-Ln)*(ji-zn),ts=En-vr;if(En===0||vr===0||En>0!=vr>0)return ts;var Sn=Math.abs(En+vr);return Math.abs(ts)>=Et*Sn?ts:-(function(Ur,Tr,cr,jr,$r,Fr,Vr){var Sr,kn,Er,us,rn,Yn,qr,ws,Zr,io,Cr,Ys,ka,Ho,No,Fa,Zc,no,bo=Ur-$r,Zo=cr-$r,_a=Tr-Fr,ea=jr-Fr;jt[0]=(No=(ws=bo-(qr=(Yn=ke*bo)-(Yn-bo)))*(io=ea-(Zr=(Yn=ke*ea)-(Yn-ea)))-((Ho=bo*ea)-qr*Zr-ws*Zr-qr*io))-((Cr=No-(Zc=(ws=_a-(qr=(Yn=ke*_a)-(Yn-_a)))*(io=Zo-(Zr=(Yn=ke*Zo)-(Yn-Zo)))-((Fa=_a*Zo)-qr*Zr-ws*Zr-qr*io)))+(rn=No-Cr))+(rn-Zc),jt[1]=(ka=Ho-((Ys=Ho+Cr)-(rn=Ys-Ho))+(Cr-rn))-((Cr=ka-Fa)+(rn=ka-Cr))+(rn-Fa),jt[2]=Ys-((no=Ys+Cr)-(rn=no-Ys))+(Cr-rn),jt[3]=no;var zh=(function(n8,qE){for(var GE=qE[0],_0=1;_0<4;_0++)GE+=qE[_0];return GE})(0,jt),Jm=Je*Vr;if(zh>=Jm||-zh>=Jm||(Sr=Ur-(bo+(rn=Ur-bo))+(rn-$r),Er=cr-(Zo+(rn=cr-Zo))+(rn-$r),kn=Tr-(_a+(rn=Tr-_a))+(rn-Fr),us=jr-(ea+(rn=jr-ea))+(rn-Fr),Sr===0&&kn===0&&Er===0&&us===0)||(Jm=Ot*Vr+Ue*Math.abs(zh),(zh+=bo*us+ea*Sr-(_a*Er+Zo*kn))>=Jm||-zh>=Jm))return zh;Tt[0]=(No=(ws=Sr-(qr=(Yn=ke*Sr)-(Yn-Sr)))*(io=ea-(Zr=(Yn=ke*ea)-(Yn-ea)))-((Ho=Sr*ea)-qr*Zr-ws*Zr-qr*io))-((Cr=No-(Zc=(ws=kn-(qr=(Yn=ke*kn)-(Yn-kn)))*(io=Zo-(Zr=(Yn=ke*Zo)-(Yn-Zo)))-((Fa=kn*Zo)-qr*Zr-ws*Zr-qr*io)))+(rn=No-Cr))+(rn-Zc),Tt[1]=(ka=Ho-((Ys=Ho+Cr)-(rn=Ys-Ho))+(Cr-rn))-((Cr=ka-Fa)+(rn=ka-Cr))+(rn-Fa),Tt[2]=Ys-((no=Ys+Cr)-(rn=no-Ys))+(Cr-rn),Tt[3]=no;var jD=qe(4,jt,4,Tt,Lt);Tt[0]=(No=(ws=bo-(qr=(Yn=ke*bo)-(Yn-bo)))*(io=us-(Zr=(Yn=ke*us)-(Yn-us)))-((Ho=bo*us)-qr*Zr-ws*Zr-qr*io))-((Cr=No-(Zc=(ws=_a-(qr=(Yn=ke*_a)-(Yn-_a)))*(io=Er-(Zr=(Yn=ke*Er)-(Yn-Er)))-((Fa=_a*Er)-qr*Zr-ws*Zr-qr*io)))+(rn=No-Cr))+(rn-Zc),Tt[1]=(ka=Ho-((Ys=Ho+Cr)-(rn=Ys-Ho))+(Cr-rn))-((Cr=ka-Fa)+(rn=ka-Cr))+(rn-Fa),Tt[2]=Ys-((no=Ys+Cr)-(rn=no-Ys))+(Cr-rn),Tt[3]=no;var $D=qe(jD,Lt,4,Tt,Ft);Tt[0]=(No=(ws=Sr-(qr=(Yn=ke*Sr)-(Yn-Sr)))*(io=us-(Zr=(Yn=ke*us)-(Yn-us)))-((Ho=Sr*us)-qr*Zr-ws*Zr-qr*io))-((Cr=No-(Zc=(ws=kn-(qr=(Yn=ke*kn)-(Yn-kn)))*(io=Er-(Zr=(Yn=ke*Er)-(Yn-Er)))-((Fa=kn*Er)-qr*Zr-ws*Zr-qr*io)))+(rn=No-Cr))+(rn-Zc),Tt[1]=(ka=Ho-((Ys=Ho+Cr)-(rn=Ys-Ho))+(Cr-rn))-((Cr=ka-Fa)+(rn=ka-Cr))+(rn-Fa),Tt[2]=Ys-((no=Ys+Cr)-(rn=no-Ys))+(Cr-rn),Tt[3]=no;var qD=qe($D,Ft,4,Tt,Gt);return Gt[qD-1]})(ri,ni,xi,ji,Ln,zn,Sn)})(xe[0],xe[1],we[0],we[1],ut[0],ut[1]);return St>0?-1:St<0?1:0}function ht(xe,we){var ut=xe.point,St=we.point;return ut[0]>St[0]?1:ut[0]<St[0]?-1:ut[1]!==St[1]?ut[1]>St[1]?1:-1:(function(ri,ni,xi,ji){return ri.left!==ni.left?ri.left?1:-1:Bt(xi,ri.otherEvent.point,ni.otherEvent.point)!==0?ri.isBelow(ni.otherEvent.point)?-1:1:!ri.isSubject&&ni.isSubject?1:-1})(xe,we,ut)}function at(xe,we,ut){var St=new ue(we,!1,xe,xe.isSubject),ri=new ue(we,!0,xe.otherEvent,xe.isSubject);return _e(xe.point,xe.otherEvent.point)&&console.warn("what is that, a collapsed segment?",xe),St.contourId=ri.contourId=xe.contourId,ht(ri,xe.otherEvent)>0&&(xe.otherEvent.left=!0,ri.left=!1),xe.otherEvent.otherEvent=ri,xe.otherEvent=St,ut.push(ri),ut.push(St),ut}function Ht(xe,we){return xe[0]*we[1]-xe[1]*we[0]}function $t(xe,we){return xe[0]*we[0]+xe[1]*we[1]}function Vi(xe,we,ut){var St=(function(Ln,zn,En,vr,ts){var Sn=[zn[0]-Ln[0],zn[1]-Ln[1]],Ur=[vr[0]-En[0],vr[1]-En[1]];function Tr(Yn,qr,ws){return[Yn[0]+qr*ws[0],Yn[1]+qr*ws[1]]}var cr=[En[0]-Ln[0],En[1]-Ln[1]],jr=Ht(Sn,Ur),$r=jr*jr,Fr=$t(Sn,Sn);if($r>0){var Vr=Ht(cr,Ur)/jr;if(Vr<0||Vr>1)return null;var Sr=Ht(cr,Sn)/jr;return Sr<0||Sr>1?null:Vr===0||Vr===1?[Tr(Ln,Vr,Sn)]:Sr===0||Sr===1?[Tr(En,Sr,Ur)]:[Tr(Ln,Vr,Sn)]}if(($r=(jr=Ht(cr,Sn))*jr)>0)return null;var kn=$t(Sn,cr)/Fr,Er=kn+$t(Sn,Ur)/Fr,us=Math.min(kn,Er),rn=Math.max(kn,Er);return us<=1&&rn>=0?us===1?[Tr(Ln,us>0?us:0,Sn)]:rn===0?[Tr(Ln,rn<1?rn:1,Sn)]:[Tr(Ln,us>0?us:0,Sn),Tr(Ln,rn<1?rn:1,Sn)]:null})(xe.point,xe.otherEvent.point,we.point,we.otherEvent.point),ri=St?St.length:0;if(ri===0||ri===1&&(_e(xe.point,we.point)||_e(xe.otherEvent.point,we.otherEvent.point))||ri===2&&xe.isSubject===we.isSubject)return 0;if(ri===1)return _e(xe.point,St[0])||_e(xe.otherEvent.point,St[0])||at(xe,St[0],ut),_e(we.point,St[0])||_e(we.otherEvent.point,St[0])||at(we,St[0],ut),1;var ni=[],xi=!1,ji=!1;return _e(xe.point,we.point)?xi=!0:ht(xe,we)===1?ni.push(we,xe):ni.push(xe,we),_e(xe.otherEvent.point,we.otherEvent.point)?ji=!0:ht(xe.otherEvent,we.otherEvent)===1?ni.push(we.otherEvent,xe.otherEvent):ni.push(xe.otherEvent,we.otherEvent),xi&&ji||xi?(we.type=T,xe.type=we.inOut===xe.inOut?I:C,xi&&!ji&&at(ni[1].otherEvent,ni[0].point,ut),2):ji?(at(ni[0],ni[1].point,ut),3):ni[0]!==ni[3].otherEvent?(at(ni[0],ni[1].point,ut),at(ni[1],ni[2].point,ut),3):(at(ni[0],ni[1].point,ut),at(ni[3].otherEvent,ni[2].point,ut),3)}function gi(xe,we){if(xe===we)return 0;if(Bt(xe.point,xe.otherEvent.point,we.point)!==0||Bt(xe.point,xe.otherEvent.point,we.otherEvent.point)!==0)return _e(xe.point,we.point)?xe.isBelow(we.otherEvent.point)?-1:1:xe.point[0]===we.point[0]?xe.point[1]<we.point[1]?-1:1:ht(xe,we)===1?we.isAbove(xe.point)?-1:1:xe.isBelow(we.point)?-1:1;if(xe.isSubject!==we.isSubject)return xe.isSubject?-1:1;var ut=xe.point,St=we.point;return ut[0]===St[0]&&ut[1]===St[1]?(ut=xe.otherEvent.point)[0]===(St=we.otherEvent.point)[0]&&ut[1]===St[1]?0:xe.contourId>we.contourId?1:-1:ht(xe,we)===1?1:-1}var Ci=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Yt(xe,we,ut,St){var ri,ni=xe+1,xi=we[xe].point,ji=we.length;for(ni<ji&&(ri=we[ni].point);ni<ji&&ri[0]===xi[0]&&ri[1]===xi[1];){if(!ut[ni])return ni;++ni<ji&&(ri=we[ni].point)}for(ni=xe-1;ut[ni]&&ni>St;)ni--;return ni}Ci.prototype.isExterior=function(){return this.holeOf==null};var Ni=oi,ln=oi;function oi(xe,we){if(!(this instanceof oi))return new oi(xe,we);if(this.data=xe||[],this.length=this.data.length,this.compare=we||zi,this.length>0)for(var ut=(this.length>>1)-1;ut>=0;ut--)this._down(ut)}function zi(xe,we){return xe<we?-1:xe>we?1:0}oi.prototype={push:function(xe){this.data.push(xe),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var xe=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),xe}},peek:function(){return this.data[0]},_up:function(xe){for(var we=this.data,ut=this.compare,St=we[xe];xe>0;){var ri=xe-1>>1,ni=we[ri];if(ut(St,ni)>=0)break;we[xe]=ni,xe=ri}we[xe]=St},_down:function(xe){for(var we=this.data,ut=this.compare,St=this.length>>1,ri=we[xe];xe<St;){var ni=1+(xe<<1),xi=ni+1,ji=we[ni];if(xi<this.length&&ut(we[xi],ji)<0&&(ni=xi,ji=we[xi]),ut(ji,ri)>=0)break;we[xe]=ji,xe=ni}we[xe]=ri}},Ni.default=ln;var tn=Math.max,_n=Math.min,On=0;function yn(xe,we,ut,St,ri,ni){var xi,ji,Ln,zn,En,vr;for(xi=0,ji=xe.length-1;xi<ji;xi++)if(zn=xe[xi+1],En=new ue(Ln=xe[xi],!1,void 0,we),vr=new ue(zn,!1,En,we),En.otherEvent=vr,Ln[0]!==zn[0]||Ln[1]!==zn[1]){En.contourId=vr.contourId=ut,ni||(En.isExteriorRing=!1,vr.isExteriorRing=!1),ht(En,vr)>0?vr.left=!0:En.left=!0;var ts=Ln[0],Sn=Ln[1];ri[0]=_n(ri[0],ts),ri[1]=_n(ri[1],Sn),ri[2]=tn(ri[2],ts),ri[3]=tn(ri[3],Sn),St.push(En),St.push(vr)}}var Si=[];function gn(xe,we,ut){typeof xe[0][0][0]=="number"&&(xe=[xe]),typeof we[0][0][0]=="number"&&(we=[we]);var St=(function(Sn,Ur,Tr){var cr=null;return Sn.length*Ur.length==0&&(Tr===O?cr=Si:Tr===N?cr=Sn:Tr!==B&&Tr!==X||(cr=Sn.length===0?Ur:Sn)),cr})(xe,we,ut);if(St)return St===Si?null:St;var ri=[1/0,1/0,-1/0,-1/0],ni=[1/0,1/0,-1/0,-1/0],xi=(function(Sn,Ur,Tr,cr,jr){var $r,Fr,Vr,Sr,kn,Er,us=new Ni(null,ht);for(Vr=0,Sr=Sn.length;Vr<Sr;Vr++)for(kn=0,Er=($r=Sn[Vr]).length;kn<Er;kn++)(Fr=kn===0)&&On++,yn($r[kn],!0,On,us,Tr,Fr);for(Vr=0,Sr=Ur.length;Vr<Sr;Vr++)for(kn=0,Er=($r=Ur[Vr]).length;kn<Er;kn++)Fr=kn===0,jr===N&&(Fr=!1),Fr&&On++,yn($r[kn],!1,On,us,cr,Fr);return us})(xe,we,ri,ni,ut);if(St=(function(Sn,Ur,Tr,cr,jr){var $r=null;return(Tr[0]>cr[2]||cr[0]>Tr[2]||Tr[1]>cr[3]||cr[1]>Tr[3])&&(jr===O?$r=Si:jr===N?$r=Sn:jr!==B&&jr!==X||($r=Sn.concat(Ur))),$r})(xe,we,ri,ni,ut))return St===Si?null:St;for(var ji=(function(Sn){var Ur,Tr,cr=(function(Vr){var Sr,kn,Er,us,rn=[];for(kn=0,Er=Vr.length;kn<Er;kn++)((Sr=Vr[kn]).left&&Sr.inResult||!Sr.left&&Sr.otherEvent.inResult)&&rn.push(Sr);for(var Yn=!1;!Yn;)for(Yn=!0,kn=0,Er=rn.length;kn<Er;kn++)kn+1<Er&&ht(rn[kn],rn[kn+1])===1&&(us=rn[kn],rn[kn]=rn[kn+1],rn[kn+1]=us,Yn=!1);for(kn=0,Er=rn.length;kn<Er;kn++)(Sr=rn[kn]).otherPos=kn;for(kn=0,Er=rn.length;kn<Er;kn++)(Sr=rn[kn]).left||(us=Sr.otherPos,Sr.otherPos=Sr.otherEvent.otherPos,Sr.otherEvent.otherPos=us);return rn})(Sn),jr={},$r=[],Fr=function(){if(!jr[Ur]){var Vr=$r.length,Sr=(function(rn,Yn,qr){var ws=new Ci;if(rn.prevInResult!=null){var Zr=rn.prevInResult,io=Zr.outputContourId;if(Zr.resultTransition>0){var Cr=Yn[io];if(Cr.holeOf!=null){var Ys=Cr.holeOf;Yn[Ys].holeIds.push(qr),ws.holeOf=Ys,ws.depth=Yn[io].depth}else Yn[io].holeIds.push(qr),ws.holeOf=io,ws.depth=Yn[io].depth+1}else ws.holeOf=null,ws.depth=Yn[io].depth}else ws.holeOf=null,ws.depth=0;return ws})(cr[Ur],$r,Vr),kn=function(rn){jr[rn]=!0,rn<cr.length&&cr[rn]&&(cr[rn].outputContourId=Vr)},Er=Ur,us=Ur;for(Sr.points.push(cr[Ur].point);kn(Er),kn(Er=cr[Er].otherPos),Sr.points.push(cr[Er].point),!((Er=Yt(Er,cr,jr,us))==us||Er>=cr.length)&&cr[Er];);$r.push(Sr)}};for(Ur=0,Tr=cr.length;Ur<Tr;Ur++)Fr();return $r})((function(Sn,Ur,Tr,cr,jr,$r){for(var Fr,Vr,Sr,kn=new c(gi),Er=[],us=Math.min(cr[2],jr[2]);Sn.length!==0;){var rn=Sn.pop();if(Er.push(rn),$r===O&&rn.point[0]>us||$r===N&&rn.point[0]>cr[2])break;if(rn.left){Vr=Fr=kn.insert(rn),Fr=Fr!==(Sr=kn.minNode())?kn.prev(Fr):null,Vr=kn.next(Vr);var Yn=Fr?Fr.key:null;if(K(rn,Yn,$r),Vr&&Vi(rn,Vr.key,Sn)===2&&(K(rn,Yn,$r),K(Vr.key,rn,$r)),Fr&&Vi(Fr.key,rn,Sn)===2){var qr=Fr;K(Yn,(qr=qr!==Sr?kn.prev(qr):null)?qr.key:null,$r),K(rn,Yn,$r)}}else Vr=Fr=kn.find(rn=rn.otherEvent),Fr&&Vr&&(Fr=Fr!==Sr?kn.prev(Fr):null,Vr=kn.next(Vr),kn.remove(rn),Vr&&Fr&&Vi(Fr.key,Vr.key,Sn))}return Er})(xi,0,0,ri,ni,ut)),Ln=[],zn=0;zn<ji.length;zn++){var En=ji[zn];if(En.isExterior()){for(var vr=[En.points],ts=0;ts<En.holeIds.length;ts++)vr.push(ji[En.holeIds[ts]].points);Ln.push(vr)}}return Ln}var Wn={UNION:B,DIFFERENCE:N,INTERSECTION:O,XOR:X};i.diff=function(xe,we){return gn(xe,we,N)},i.intersection=function(xe,we){return gn(xe,we,O)},i.operations=Wn,i.union=function(xe,we){return gn(xe,we,B)},i.xor=function(xe,we){return gn(xe,we,X)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,C1.exports)),C1.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ig(n,e,i,o){const c=[],f=o===0?(p,v,b,T,I,C)=>{p.push(new kt(C,b+(C-v)/(T-v)*(I-b)))}:(p,v,b,T,I,C)=>{p.push(new kt(v+(C-b)/(I-b)*(T-v),C))};for(const p of n){const v=[];for(const b of p){if(b.length<=2)continue;const T=[];for(let O=0;O<b.length-1;O++){const B=b[O].x,N=b[O].y,X=b[O+1].x,K=b[O+1].y,Y=o===0?B:N,ue=o===0?X:K;Y<e?ue>e&&f(T,B,N,X,K,e):Y>i?ue<i&&f(T,B,N,X,K,i):T.push(b[O]),ue<e&&Y>=e&&f(T,B,N,X,K,e),ue>i&&Y<=i&&f(T,B,N,X,K,i)}let I=b[b.length-1];const C=o===0?I.x:I.y;C>=e&&C<=i&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),v.push(T))}v.length&&c.push(v)}return c}function NR(n,e){const i=hx(n),o=hx([e]),c=M1.intersection(i,o);return c==null?[]:R1(c)}function UR(n,e){let o=hx(n,65536);const c=[];for(;e.valid();e.next()){const[f,p]=e.get(),v=f.x*65536,b=f.y*65536,T=p.x*65536,I=p.y*65536,C=T-v,O=I-b,B=Math.hypot(C,O);if(B===0)continue;const N=Math.trunc(O/B*3),X=-Math.trunc(C/B*3);c.push([[[v,b],[T,I],[T+N,I+X],[v+N,b+X],[v,b]]])}return c.length>0&&(o=M1.diff(o,c)),R1(o,1/65536)}function hx(n,e=1){return[n.map((i=>i.map((o=>[o.x*e,o.y*e]))))]}function R1(n,e=1){return n.map((i=>i.map(((o,c)=>{const f=o.map((p=>new kt(p[0]*e,p[1]*e).round()));return c>0&&f.reverse(),f}))))}class dx{constructor(e,i){this.layoutVertexArray=new Bc,this.indexArray=new co,this.lineIndexArray=new eo,this.triangleSegments=new cs,this.lineSegments=new cs,this.programConfigurations=new yl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Nc)}update(e,i,o,c,f,p,v,b){this.programConfigurations.updatePaintArrays(e,i,f,o,c,p,v,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,SR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,ER.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,o,c,f,p,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,c,f,p,void 0,v)}}class fx{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new dx(e,!1),this.elevationBufferData=new dx(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,c){this.hasPattern=cx("fill",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:v,id:b,index:T,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,O=qt(v,C);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom,{worldview:this.worldview}),O,o))continue;const B=f?f.evaluate(O,{},o,i.availableImages):void 0,N={id:b,properties:v.properties,type:v.type,sourceLayerIndex:I,index:T,geometry:C?O.geometry:hi(v,o,c),patterns:{},sortKey:B};p.push(N)}f&&p.sort(((v,b)=>v.sortKey-b.sortKey));for(const v of p){const{geometry:b,index:T,sourceLayerIndex:I}=v;if(this.hasPattern){const C=ux("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(C)}else this.addFeature(v,b,T,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[T].feature,b,T,I,this.index)}}update(e,i,o,c,f,p,v){this.bufferData.update(e,i,o,c,f,p,v,this.worldview),this.elevationBufferData.update(e,i,o,c,f,p,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,o,c,f,p,v,this.worldview)}addFeatures(e,i,o,c,f,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,o,c,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,o,c,f,p=[],v,b){const T=bm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,c,o,b):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,o,f,p,c,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,o,f,p,c,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,o,c,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,o,c,f,this.worldview))}addElevatedRoadFeature(e,i,o,c,f){const p=new Array,v=os.getElevationFeature(e,f);if(!v)return void this.addGeometry(i,this.bufferData);{const T=this.clipPolygonsToTile(i,1);T.length>0&&p.push({polygons:T,elevationFeature:v,elevationTileID:o})}const b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},o),featureIndex:c};for(const T of p)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Wa(T.elevationTileID,this.layers,this.zoom,this.lut));const C=T.elevationFeature.isTunnel();let O=0;e.properties.hasOwnProperty(gr)&&(O=+e.properties[gr]);for(const B of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,B,C,T.elevationFeature,O)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const I=new Zs(o,T.elevationTileID);this.addElevatedGeometry(T.polygons,I,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c,b)}}addElevatedGeometry(e,i,o,c,f,p){const v={elevation:o,elevationSampler:i,bias:c,index:f,featureInfo:p},[b,T]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(e,i,o){let c=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=null;o&&(p=o.elevationSampler.constantElevation(o.elevation,o.bias),p!=null&&(c=p,f=p));const v=(b,T,I)=>{if(o!=null)if(T.push(b),p!=null)i.elevatedLayoutVertexArray.emplaceBack(p),I.push(p);else{const C=o.elevationSampler.pointElevation(b,o.elevation,o.bias);i.elevatedLayoutVertexArray.emplaceBack(C),I.push(C),c=Math.min(c,C),f=Math.max(f,C)}};for(const b of e){let T=0;for(const de of b)T+=de.length;const I=i.triangleSegments.prepareSegment(T,i.layoutVertexArray,i.indexArray),C=I.vertexLength,O=[],B=[],N=[],X=[],K=[],Y=i.layoutVertexArray.length;for(const de of b){if(de.length===0)continue;de!==b[0]&&B.push(O.length/2);const _e=i.lineSegments.prepareSegment(de.length,i.layoutVertexArray,i.lineIndexArray),ze=_e.vertexLength;o&&K.push(i.layoutVertexArray.length-Y),v(de[0],N,X),i.layoutVertexArray.emplaceBack(de[0].x,de[0].y),i.lineIndexArray.emplaceBack(ze+de.length-1,ze),O.push(de[0].x),O.push(de[0].y);for(let ke=1;ke<de.length;ke++)v(de[ke],N,X),i.layoutVertexArray.emplaceBack(de[ke].x,de[ke].y),i.lineIndexArray.emplaceBack(ze+ke-1,ze+ke),O.push(de[ke].x),O.push(de[ke].y);_e.vertexLength+=de.length,_e.primitiveLength+=de.length}const ue=Nf(O,B);for(let de=0;de<ue.length;de+=3)i.indexArray.emplaceBack(C+ue[de],C+ue[de+1],C+ue[de+2]);if(ue.length>0&&o&&this.elevationMode==="hd-road-base"){const de=o.elevation.isTunnel(),_e=o.elevation.safeArea,ze=this.elevatedStructures.addVertices(N,X);this.elevatedStructures.addTriangles(ue,ze,de);const ke=K.length;if(ke>0){for(let Ue=0;Ue<ke-1;Ue++)this.elevatedStructures.addRenderableRing(o.index,K[Ue]+ze,K[Ue+1]-K[Ue],de,_e,o.featureInfo);this.elevatedStructures.addRenderableRing(o.index,K[ke-1]+ze,N.length-K[ke-1],de,_e,o.featureInfo)}}I.vertexLength+=T,I.primitiveLength+=ue.length/3}return[c,f]}prepareElevatedPolygons(e,i,o){const c=1/et(o),f=[];for(const p of e){const v=UR(p,new yr(i,c));f.push(...v)}return f}clipPolygonsToTile(e,i){const o=-i,c=-i,f=Zt+i,p=Zt+i;let v=0;const b=[],T=[];for(;v<e.length;v++){const O=e[v],B=Ic(O);(B.min.x>=o&&B.max.x<=f&&B.min.y>=c&&B.max.y<=p?b:T).push(O)}if(b.length===e.length)return e;const I=[new kt(o,c),new kt(f,c),new kt(f,p),new kt(o,p),new kt(o,c)],C=b;for(const O of T)C.push(...NR(O,I));return C}}let O1,L1,D1,z1;yi(fx,"FillBucket",{omit:["layers","patternFeatures"]}),yi(dx,"FillBufferData"),yi(Wa,"ElevatedStructures");class Pg{constructor(e,i,o,c){if(this.triangleCount=i.length/3,this.min=new kt(0,0),this.max=new kt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,p]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const O=e[C];f.x=Math.min(f.x,O.x),f.y=Math.min(f.y,O.y),p.x=Math.max(p.x,O.x),p.y=Math.max(p.y,O.y)}if(c){const C=Math.ceil(Math.max(p.x-f.x,p.y-f.y)/c);o=Math.max(o,C)}if(o===0)return;this.min=f,this.max=p;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const b=Math.max(v.x,v.y)/o;this.cellsX=Math.max(1,Math.ceil(v.x/b)),this.cellsY=Math.max(1,Math.ceil(v.y/b)),this.xScale=1/b,this.yScale=1/b;const T=[];for(let C=0;C<this.triangleCount;C++){const O=e[i[3*C+0]].sub(this.min),B=e[i[3*C+1]].sub(this.min),N=e[i[3*C+2]].sub(this.min),X=Gc(Math.floor(Math.min(O.x,B.x,N.x)),this.xScale,this.cellsX),K=Gc(Math.floor(Math.max(O.x,B.x,N.x)),this.xScale,this.cellsX),Y=Gc(Math.floor(Math.min(O.y,B.y,N.y)),this.yScale,this.cellsY),ue=Gc(Math.floor(Math.max(O.y,B.y,N.y)),this.yScale,this.cellsY),de=new kt(0,0),_e=new kt(0,0),ze=new kt(0,0),ke=new kt(0,0);for(let Ue=Y;Ue<=ue;++Ue){de.y=_e.y=Ue*b,ze.y=ke.y=(Ue+1)*b;for(let qe=X;qe<=K;++qe)de.x=ze.x=qe*b,_e.x=ke.x=(qe+1)*b,(cc(O,B,N,de,_e,ke)||cc(O,B,N,de,ke,ze))&&T.push({cellIdx:Ue*this.cellsX+qe,triIdx:C})}}if(T.length===0)return;T.sort(((C,O)=>C.cellIdx-O.cellIdx||C.triIdx-O.triIdx));let I=0;for(;I<T.length;){const C=T[I].cellIdx,O={start:this.payload.length,len:0};for(;I<T.length&&T[I].cellIdx===C;)++O.len,this.payload.push(T[I++].triIdx);this.cells[C]=O}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=Gc(e.x-this.min.x,this.xScale,this.cellsX),c=Gc(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[c*this.cellsX+o];if(f){this._lazyInitLookup();for(let p=0;p<f.len;p++){const v=this.payload[f.start+p],b=Math.floor(v/8),T=1<<v%8;if(!(this.lookup[b]&T)&&(this.lookup[b]|=T,i.push(v),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const c=Gc(e.x-this.min.x,this.xScale,this.cellsX),f=Gc(i.x-this.min.x,this.xScale,this.cellsX),p=Gc(e.y-this.min.y,this.yScale,this.cellsY),v=Gc(i.y-this.min.y,this.yScale,this.cellsY);for(let b=p;b<=v;b++)for(let T=c;T<=f;T++){const I=this.cells[b*this.cellsX+T];if(I)for(let C=0;C<I.len;C++){const O=this.payload[I.start+C],B=Math.floor(O/8),N=1<<O%8;if(!(this.lookup[B]&N)&&(this.lookup[B]|=N,o.push(O),o.length===this.triangleCount))return}}}}function Gc(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}yi(Pg,"TriangleGridIndex");class k1{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,c){const f=[];for(const{feature:p,id:v,index:b,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,C=qt(p,I);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom,{worldview:this.worldview}),C,o))continue;const O={id:v,properties:p.properties,type:p.type,sourceLayerIndex:T,index:b,geometry:I?C.geometry:hi(p,o,c),patterns:{}};f.push(O)}for(const p of f){const{geometry:v,index:b,sourceLayerIndex:T}=p;this.addFeature(p,v,b,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[b].feature,v,b,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,c,f,p,v){}destroy(){}addFeature(e,i,o,c,f,p=[],v){for(const b of bm(i,2)){const T=[],I=[],C=[],O=new kt(1/0,1/0),B=new kt(-1/0,-1/0);for(const K of b)if(K.length!==0){K!==b[0]&&C.push(I.length/2);for(let Y=0;Y<K.length;Y++)I.push(K[Y].x),I.push(K[Y].y),T.push(K[Y]),O.x=Math.min(O.x,K[Y].x),O.y=Math.min(O.y,K[Y].y),B.x=Math.max(B.x,K[Y].x),B.y=Math.max(B.y,K[Y].y)}const N=Nf(I,C),X=new Pg(T,N,8,256);this.footprints.push({vertices:T,indices:N,grid:X,min:O,max:B})}}}yi(k1,"ClipBucket",{omit:["layers"]});const VR=qn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),jR=qn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),$R=qn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),qR=qn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),GR=qn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),HR=qn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ZR}=VR,wm=Number.MAX_SAFE_INTEGER,F1=wm-1;function B1(n,e,i,o){return n.order<e||n.order===wm||!(n.clipMask&i)||(function(c,f){return f.length!==0&&f.find((p=>p===c))===void 0})(o,n.clipScope)}function Cg(n,e){return n.x-e.x||n.y-e.y}function N1(n,e){return Cg(n.min,e.min)===0&&Cg(n.max,e.max)===0}function px(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function Mg(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!N1(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!ls(n[i].clipScope,e[i].clipScope))return!1;return!0}function U1(n,e,i){const o=1/Zt,c=1/(1<<i.canonical.z),f=(e.x*o+i.canonical.x)*c+i.wrap,p=(e.y*o+i.canonical.y)*c;return{min:new kt((n.x*o+i.canonical.x)*c+i.wrap,(n.y*o+i.canonical.y)*c),max:new kt(f,p)}}function WR(n,e,i){const o=1<<i.canonical.z,c=((e.x-i.wrap)*o-i.canonical.x)*Zt,f=(e.y*o-i.canonical.y)*Zt;return{min:new kt(((n.x-i.wrap)*o-i.canonical.x)*Zt,(n.y*o-i.canonical.y)*Zt),max:new kt(c,f)}}function mx(n,e,i,o,c,f,p){const v=n.indices,b=n.vertices,T=[];for(let I=o;I<o+c;I+=3){const C=e[i[I+0]+f],O=e[i[I+1]+f],B=e[i[I+2]+f],N=Math.min(C.x,O.x,B.x),X=Math.max(C.x,O.x,B.x),K=Math.min(C.y,O.y,B.y),Y=Math.max(C.y,O.y,B.y);T.length=0,n.grid.query(new kt(N,K),new kt(X,Y),T);for(let ue=0;ue<T.length;ue++){const de=T[ue];if(cc(b[v[3*de+0]],b[v[3*de+1]],b[v[3*de+2]],C,O,B,p))return!0}}return!1}function V1(n,e,i,o){if(!n||!i)return!1;let c=n.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<n.vertices.length)return V1(i,o,n,e);const f=e.canonical,p=o.canonical,v=Math.pow(2,p.z-f.z);c=n.vertices.map((b=>new kt((b.x+f.x*Zt)*v-p.x*Zt,(b.y+f.y*Zt)*v-p.y*Zt)))}return mx(i,c,n.indices,0,n.indices.length,0,0)}function j1(n,e,i,o){const c=Math.pow(2,o.z-i.z);return new kt((n+i.x*Zt)*c-o.x*Zt,(e+i.y*Zt)*c-o.y*Zt)}function _x(n,e){const i=[];e.grid.queryPoint(n,i);const o=e.indices,c=e.vertices;for(let f=0;f<i.length;f++){const p=i[f];if(xo([c[o[3*p+0]],c[o[3*p+1]],c[o[3*p+2]]],n))return!0}return!1}const gx=[new kt(0,0),new kt(Zt,0),new kt(Zt,Zt),new kt(0,Zt)];function $1(n,e){const i=[];let o=[];if(!e||n.length<2)return[n];if(n.length===2)return qo(n[0],n[1],gx)?[n]:[];for(let c=0;c<n.length+2;c++){const f=n[c%n.length],p=n[(c+1)%n.length],v=qo(c===0?n[n.length-1]:n[(c-1)%n.length],f,gx),b=qo(f,p,gx),T=v||b;T&&o.push(f),T&&b||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const yx=Ut.types,XR=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],KR=["fill-extrusion-flood-light-ground-radius"],YR=Math.pow(2,13),JR=Math.pow(2,15)-1,q1=new kt(0,1),Ch=2147483648;function Tm(n,e,i,o,c,f,p,v){n.emplaceBack((e<<1)+p,(i<<1)+f,(Math.floor(o*YR)<<1)+c,Math.round(v))}function Sm(n,e,i){n.emplaceBack(e.x*Zt,e.y*Zt,i?1:0)}function Rg(n,e,i,o,c,f){n.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+c,f)}function Em(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class G1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class H1{constructor(){this.centroidXY=new kt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new kt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new kt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new kt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Z1{constructor(){this.acc=new kt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===Zt)&&i.x===o.x)!=((i.y===0||i.y===Zt)&&i.y===o.y)&&this.processBorderOverlap(i,o),c&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Mi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Zt!=e.x>Zt&&this.addBorderIntersection(1,Mi(i.y,e.y,(Zt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Mi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Zt!=e.y>Zt&&this.addBorderIntersection(3,Mi(i.x,e.x,(Zt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new kt(0,0):new kt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function W1(n,e){const i=n.add(e)._unit(),o=Le(n.x*i.x+n.y*i.y,-1,1);var c,f,p;return c=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(c)))/4*JR*((f=n).x*(p=e).y-f.y*p.x<0?-1:1)}const QR=[n=>n.x<0,n=>n.x>Zt,n=>n.y<0,n=>n.y>Zt];function eO(n,e,i,o){const c=[4];if(o===0)return c;i._mult(o);const f=n.sub(i),p=e.sub(i),v=[n,e,f,p];for(let b=0;b<4;b++)for(const T of v)if(QR[b](T)){c.push(b);break}return c}class vx{constructor(e){this.vertexArray=new nm,this.indexArray=new co,this.programConfigurations=new yl(e.layers,{zoom:e.zoom,lut:e.lut},(i=>KR.includes(i))),this._segments=new cs,this.hiddenByLandmarkVertexArray=new Lf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new cs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,c=!1){const f=e.length;if(f>2){let p=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let b;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const T=e[0],I=e[1];b=W1(T.sub(e[f-1])._perp()._unit(),I.sub(T)._perp()._unit())}for(let T=0;T<f;T++){const I=T===f-1?0:T+1,C=e[T],O=e[I],B=e[I===f-1?0:I+1],N=O.sub(C)._perp()._unit(),X=W1(N,B.sub(O)._perp()._unit()),K=b,Y=X;if(xx(C,O,i)||c&&Y1(C,i)&&Y1(O,i)){b=X;continue}const ue=v.vertexLength;Rg(this.vertexArray,C,O,1,1,K),Rg(this.vertexArray,C,O,1,0,K),Rg(this.vertexArray,C,O,0,1,Y),Rg(this.vertexArray,C,O,0,0,Y),v.vertexLength+=4;const de=eO(C,O,N,o);for(const _e of de)this._segmentToGroundQuads[p].push({id:ue,region:_e}),this._segmentToRegionTriCounts[p][_e]+=2,v.primitiveLength+=2;b=X}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort(((c,f)=>c.region-f.region));for(let o=0;o<i;o++){const c=this._segmentToGroundQuads[o],f=e[o],p=this._segmentToRegionTriCounts[o];p.reduce(((b,T)=>b+T),0);let v=0;for(let b=0;b<=4;b++){const T=p[b];if(T!==0){let I=this.regionSegments[b];I||(I=this.regionSegments[b]=new cs);const C={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+v,vertexLength:f.vertexLength,primitiveLength:T};I.get().push(C)}v+=T}for(let b=0;b<c.length;b++){const T=c[b].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,c,f,p,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,c,f,p,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,jR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,c,f,p,v,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,c,f,p,v,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Ch))}updateHiddenByLandmarkRange(e,i,o){if(!this.hasData())return;const c=i+e;if(i!==0){for(let f=e;f<c;++f)this.hiddenByLandmarkVertexArray.emplace(f,o?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,GR.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Og{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new co,this.footprintVertices=new Bc,this.footprintSegments=[],this.layoutVertexArray=new Ou,this.centroidVertexArray=new mg,this.wallVertexArray=new gg,this.indexArray=new co,this.programConfigurations=new yl(e.layers,{zoom:e.zoom,lut:e.lut},(i=>XR.includes(i))),this.segments=new cs,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new vx(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,c){this.features=[],this.hasPattern=cx("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=et(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:p,index:v,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,I=qt(f,T);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom,{worldview:this.worldview}),I,o))continue;const C={id:p,sourceLayerIndex:b,index:v,geometry:T?I.geometry:hi(f,o,c),properties:f.properties,type:f.type,patterns:{}},O=this.layoutVertexArray.length,B=yx[C.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:f.id,feature:ux("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const N of C.geometry)for(const X of $1(N,B))this.addFeature(f.id,C,[X],v,o,{},i.availableImages,c,i.brightness);else this.addFeature(f.id,C,C.geometry,v,o,{},i.availableImages,c,i.brightness);i.featureIndex.insert(f,C.geometry,v,b,this.index,O)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,c,f,p){for(const{featureId:v,feature:b}of this.features){const T=yx[b.type]==="Polygon",{geometry:I}=b;if(this.wallMode)for(const C of I)for(const O of $1(C,T))this.addFeature(v,b,[O],b.index,i,o,c,f,p);else this.addFeature(v,b,I,b.index,i,o,c,f,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,c,f,p,v){this.programConfigurations.updatePaintArrays(e,i,f,o,c,p,v,this.worldview),this.groundEffect.update(e,i,f,o,c,p,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ZR),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,qR.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,HR.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,$R.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c,f,p,v,b,T){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,C=[new kt(0,0),new kt(Zt,Zt)],O=b.projection,B=O.name==="globe",N=this.wallMode||yx[i.type]==="Polygon",X=new Z1;X.centroidDataIndex=this.centroidData.length;const K=new H1;K.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(K.buildingId=i.properties.building_id);const Y=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},f)<=0,ue=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},f);let de;if(K.height=ue,K.vertexArrayOffset=this.layoutVertexArray.length,K.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Pf),this.wallMode){if(B)return void An("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;de=(function(Je){const Ot=Je[0].x===Je[Je.length-1].x&&Je[0].y===Je[Je.length-1].y;(function(Yt){let Ni=0;const ln=Yt.length;for(let oi=0;oi<ln;oi++)Ni+=(Yt[(oi+1)%ln].x-Yt[oi].x)*(Yt[(oi+1)%ln].y+Yt[oi].y);return Ni>=0})(Je)||(Je=Je.reverse());const Lt={geometry:[],joinNormals:[],indices:[]},Ft=[],Gt=[],Tt=[];let Bt=Je.length;for(;Bt>=2&&Je[Bt-1].equals(Je[Bt-2]);)Bt--;if(Bt<(Ot?3:2))return Lt;let ht,at,Ht,$t,Vi,gi=0;for(;gi<Bt-1&&Je[gi].equals(Je[gi+1]);)gi++;Ot&&(ht=Je[Bt-2],Vi=Je[gi].sub(ht)._unit()._perp());for(let Yt=gi;Yt<Bt;Yt++){if(Ht=Yt===Bt-1?Ot?Je[gi+1]:void 0:Je[Yt+1],Ht&&Je[Yt].equals(Ht))continue;Vi&&($t=Vi),ht&&(at=ht),ht=Je[Yt],Vi=Ht?Ht.sub(ht)._unit()._perp():$t,$t=$t||Vi;let Ni=$t.add(Vi);Ni.x===0&&Ni.y===0||Ni._unit();const ln=Ni.x*Vi.x+Ni.y*Vi.y,oi=ln!==0?1/ln:1/0,zi=$t.x*Vi.y-$t.y*Vi.x>0;let tn="miter";const _n=2;tn==="miter"&&oi>_n&&(tn="bevel"),tn==="bevel"&&(oi>100&&(tn="flipbevel"),oi<_n&&(tn="miter"));const On=(yn,Si,gn,Wn)=>{const xe=new kt(yn.x,yn.y),we=new kt(yn.x,yn.y);xe.x+=Si.x*Wn,xe.y+=Si.y*Wn,we.x-=Si.x*Math.max(gn,1),we.y-=Si.y*Math.max(gn,1),Tt.push(Si),Ft.push(xe),Gt.push(we)};if(tn==="miter")Ni._mult(oi),On(ht,Ni,0,0);else if(tn==="flipbevel")Ni=Vi.mult(-1),On(ht,Ni,0,0),On(ht,Ni.mult(-1),0,0);else{const yn=-Math.sqrt(oi*oi-1),Si=zi?yn:0,gn=zi?0:yn;at&&On(ht,$t,Si,gn),Ht&&On(ht,Vi,Si,gn)}}Lt.geometry=[...Ft,...Gt.reverse(),Ft[0]],Lt.joinNormals=[...Tt,...Tt.reverse(),Tt[Tt.length-1]];const Ci=Lt.geometry.length-1;for(let Yt=0;Yt<Ci/2;Yt++)if(Yt+1<Ci/2){let Ni=Yt,ln=Yt+1,oi=Ci-1-Yt,zi=Ci-2-Yt;Ni=Ni===0?Ci-1:Ni-1,ln=ln===0?Ci-1:ln-1,oi=oi===0?Ci-1:oi-1,zi=zi===0?Ci-1:zi-1,Lt.indices.push(oi),Lt.indices.push(ln),Lt.indices.push(Ni),Lt.indices.push(oi),Lt.indices.push(zi),Lt.indices.push(ln)}return Lt})(o[0]),o=[de.geometry]}const _e=(Je,Ot)=>Je<(Ot.length-1)/2||Je===Ot.length-1,ze=this.wallMode?[o]:bm(o,500);for(let Je=ze.length-1;Je>=0;Je--){const Ot=ze[Je];(Ot.length===0||(ke=Ot[0]).every((jt=>jt.x<=0))||ke.every((jt=>jt.x>=Zt))||ke.every((jt=>jt.y<=0))||ke.every((jt=>jt.y>=Zt)))&&ze.splice(Je,1)}var ke;let Ue;if(B)Ue=tT(ze,C,f);else{Ue=[];for(const Je of ze)Ue.push({polygon:Je,bounds:C})}const qe=N?this.edgeRadius:0,Ze=qe>0&&this.zoom<17,Et=(Je,Ot)=>{if(Je.length===0)return!1;const jt=Je[Je.length-1];return Ot.x===jt.x&&Ot.y===jt.y};for(const{polygon:Je,bounds:Ot}of Ue){let jt=0,Lt=0;for(const Bt of Je)N&&!Bt[0].equals(Bt[Bt.length-1])&&Bt.push(Bt[0]),Lt+=N?Bt.length-1:Bt.length;const Ft=this.segments.prepareSegment((N?5:4)*Lt,this.layoutVertexArray,this.indexArray);K.footprintSegIdx<0&&(K.footprintSegIdx=this.footprintSegments.length),K.polygonSegIdx<0&&(K.polygonSegIdx=this.polygonSegments.length);const Gt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Tt=new G1;if(Tt.vertexOffset=this.footprintVertices.length,Tt.indexOffset=3*this.footprintIndices.length,Tt.ringIndices=[],N){const Bt=[],ht=[];jt=Ft.vertexLength;for(let Ht=0;Ht<Je.length;Ht++){const $t=Je[Ht];$t.length&&Ht!==0&&ht.push(Bt.length/2);const Vi=[];let gi,Ci;gi=$t[1].sub($t[0])._perp()._unit(),Tt.ringIndices.push($t.length-1);for(let Yt=1;Yt<$t.length;Yt++){const Ni=$t[Yt],ln=$t[Yt===$t.length-1?1:Yt+1],oi=Ni.clone();if(qe){Ci=ln.sub(Ni)._perp()._unit();const zi=gi.add(Ci)._unit(),tn=qe*Math.min(4,1/(gi.x*zi.x+gi.y*zi.y));oi.x+=tn*zi.x,oi.y+=tn*zi.y,oi.x=Math.round(oi.x),oi.y=Math.round(oi.y),gi=Ci}if(!Y||qe!==0&&!Ze||Et(Vi,oi)||Vi.push(oi),Tm(this.layoutVertexArray,oi.x,oi.y,0,0,1,1,0),this.wallMode){const zi=_e(Yt,$t);Sm(this.wallVertexArray,de.joinNormals[Yt],!zi)}Ft.vertexLength++,this.footprintVertices.emplaceBack(Ni.x,Ni.y),Bt.push(Ni.x,Ni.y),B&&Em(this.layoutVertexExtArray,O.projectTilePoint(oi.x,oi.y,f),O.upVector(f,oi.x,oi.y))}Y&&(qe===0||Ze)&&(Vi.length!==0&&Et(Vi,Vi[0])&&Vi.pop(),this.groundEffect.addData(Vi,Ot,I))}const at=this.wallMode?de.indices:Nf(Bt,ht);for(let Ht=0;Ht<at.length;Ht+=3)this.footprintIndices.emplaceBack(Tt.vertexOffset+at[Ht+0],Tt.vertexOffset+at[Ht+1],Tt.vertexOffset+at[Ht+2]),this.indexArray.emplaceBack(jt+at[Ht],jt+at[Ht+2],jt+at[Ht+1]),Ft.primitiveLength++;Tt.indexCount+=at.length,Tt.vertexCount+=this.footprintVertices.length-Tt.vertexOffset}for(let Bt=0;Bt<Je.length;Bt++){const ht=Je[Bt];X.startRing(K,ht[0]);let at=ht.length>4&&J1(ht[ht.length-2],ht[0],ht[1]),Ht=qe?tO(ht[ht.length-2],ht[0],ht[1],qe):0;const $t=[];let Vi,gi,Ci;gi=ht[1].sub(ht[0])._perp()._unit();let Yt=!0;for(let Ni=1,ln=0;Ni<ht.length;Ni++){let oi=ht[Ni-1],zi=ht[Ni];const tn=ht[Ni===ht.length-1?1:Ni+1];if(X.appendEdge(K,zi,oi),xx(zi,oi,Ot)){qe&&(gi=tn.sub(zi)._perp()._unit(),Yt=!Yt);continue}const _n=zi.sub(oi)._perp(),On=_n.x/(Math.abs(_n.x)+Math.abs(_n.y)),yn=_n.y>0?1:0,Si=oi.dist(zi);if(ln+Si>32768&&(ln=0),qe){Ci=tn.sub(zi)._perp()._unit();let we=K1(oi,zi,tn,X1(gi,Ci),qe);isNaN(we)&&(we=0);const ut=zi.sub(oi)._unit();oi=oi.add(ut.mult(Ht))._round(),zi=zi.add(ut.mult(-we))._round(),Ht=we,gi=Ci,Y&&this.zoom>=17&&(Et($t,oi)||$t.push(oi),Et($t,zi)||$t.push(zi))}const gn=Ft.vertexLength,Wn=ht.length>4&&J1(oi,zi,tn);let xe=Q1(ln,at,Yt);if(Tm(this.layoutVertexArray,oi.x,oi.y,On,yn,0,0,xe),Tm(this.layoutVertexArray,oi.x,oi.y,On,yn,0,1,xe),this.wallMode){const we=_e(Ni-1,ht),ut=de.joinNormals[Ni-1];Sm(this.wallVertexArray,ut,we),Sm(this.wallVertexArray,ut,we)}if(ln+=Si,xe=Q1(ln,Wn,!Yt),at=Wn,Tm(this.layoutVertexArray,zi.x,zi.y,On,yn,0,0,xe),Tm(this.layoutVertexArray,zi.x,zi.y,On,yn,0,1,xe),this.wallMode){const we=_e(Ni,ht),ut=de.joinNormals[Ni];Sm(this.wallVertexArray,ut,we),Sm(this.wallVertexArray,ut,we)}if(Ft.vertexLength+=4,this.indexArray.emplaceBack(gn+0,gn+1,gn+2),this.indexArray.emplaceBack(gn+1,gn+3,gn+2),Ft.primitiveLength+=2,qe){const we=jt+(Ni===1?ht.length-2:Ni-2),ut=Ni===1?jt:we+1;if(this.indexArray.emplaceBack(gn+1,we,gn+3),this.indexArray.emplaceBack(we,ut,gn+3),Ft.primitiveLength+=2,Vi===void 0&&(Vi=gn),!xx(tn,ht[Ni],Ot)){const St=Ni===ht.length-1?Vi:Ft.vertexLength;this.indexArray.emplaceBack(gn+2,gn+3,St),this.indexArray.emplaceBack(gn+3,St+1,St),this.indexArray.emplaceBack(gn+3,ut,St+1),Ft.primitiveLength+=3}Yt=!Yt}if(B){const we=this.layoutVertexExtArray,ut=O.projectTilePoint(oi.x,oi.y,f),St=O.projectTilePoint(zi.x,zi.y,f),ri=O.upVector(f,oi.x,oi.y),ni=O.upVector(f,zi.x,zi.y);Em(we,ut,ri),Em(we,ut,ri),Em(we,St,ni),Em(we,St,ni)}}N&&(jt+=ht.length-1),Y&&qe&&this.zoom>=17&&($t.length!==0&&Et($t,$t[0])&&$t.pop(),this.groundEffect.addData($t,Ot,I,qe>0))}this.footprintSegments.push(Tt),Gt.triangleCount=this.indexArray.length-Gt.triangleArrayOffset,this.polygonSegments.push(Gt),++K.footprintSegLen,++K.polygonSegLen}if(K.vertexCount=this.layoutVertexArray.length-K.vertexArrayOffset,K.groundVertexCount=this.groundEffect.vertexArray.length-K.groundVertexArrayOffset,K.vertexCount!==0){if(K.centroidXY=X.borders?q1:this.encodeCentroid(X,K),this.centroidData.push(K),X.borders){this.featuresOnBorder.push(X);const Je=this.featuresOnBorder.length-1;for(let Ot=0;Ot<X.borders.length;Ot++)X.borders[Ot][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ot].push(Je)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,p,v,f,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,c,p,v,f,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,ue)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0]))}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const b=this.centroidData[v],T=+(b.min.y+b.max.y>Zt),I=2*T+(+(b.min.x+b.max.x>Zt)^T);for(let C=0;C<b.polygonSegLen;C++){const O=b.polygonSegIdx+C;e.push({centroidIdx:v,subtile:I,polygonSegmentIdx:O,triangleSegmentIdx:this.polygonSegments[O].triangleSegIdx})}}const i=new co;e.sort(((v,b)=>v.triangleSegmentIdx===b.triangleSegmentIdx?v.subtile-b.subtile:v.triangleSegmentIdx-b.triangleSegmentIdx));let o=0,c=0,f=0;for(const v of e){if(v.triangleSegmentIdx!==o)break;f++}const p=e.length;for(;c!==e.length;){o=e[c].triangleSegmentIdx;let v=0,b=c,T=c;for(let I=b;I<f&&e[I].subtile===v;I++)T++;for(;b!==f;){const I=e[b];v=I.subtile;const C=this.centroidData[I.centroidIdx].min.clone(),O=this.centroidData[I.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let N=b;N<T;N++){const X=e[N],K=this.polygonSegments[X.polygonSegmentIdx],Y=this.centroidData[X.centroidIdx].min,ue=this.centroidData[X.centroidIdx].max,de=this.indexArray.uint16;for(let _e=K.triangleArrayOffset;_e<K.triangleArrayOffset+K.triangleCount;_e++)i.emplaceBack(de[3*_e],de[3*_e+1],de[3*_e+2]);B.primitiveLength+=K.triangleCount,C.x=Math.min(C.x,Y.x),C.y=Math.min(C.y,Y.y),O.x=Math.max(O.x,ue.x),O.y=Math.max(O.y,ue.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:C,max:O}),b=T;for(let N=b;N<f&&e[N].subtile===e[b].subtile;N++)T++}c=f;for(let I=c;I<p&&e[I].triangleSegmentIdx===e[c].triangleSegmentIdx;I++)f++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const c=new cs;if(this.wallMode){for(const X of this.triangleSubSegments)c.segments.push(X.segment);return c}let f=0,p=0;const v=1<<e.canonical.z;if(i){const X=i.getMinMaxForTile(e);X&&(f=X.min,p=X.max)}p+=this.maxHeight;const b=e.toUnwrapped();let T;const I=[b.canonical.x/v+b.wrap,b.canonical.y/v],C=[(b.canonical.x+1)/v+b.wrap,(b.canonical.y+1)/v],O=(X,K,Y)=>[X[0]*(1-Y[0])+K[0]*Y[0],X[1]*(1-Y[1])+K[1]*Y[1]],B=[],N=[];for(const X of this.triangleSubSegments){B[0]=X.min.x/Zt,B[1]=X.min.y/Zt,N[0]=X.max.x/Zt,N[1]=X.max.y/Zt;const K=O(I,C,B),Y=O(I,C,N);if(new nn([K[0],K[1],f],[Y[0],Y[1],p]).intersectsPrecise(o)===0){T&&(c.segments.push(T),T=void 0);continue}const ue=X.segment;T&&T.vertexOffset!==ue.vertexOffset&&(c.segments.push(T),T=void 0),T?(T.vertexLength+=ue.vertexLength,T.primitiveLength+=ue.primitiveLength):T={vertexOffset:ue.vertexOffset,primitiveLength:ue.primitiveLength,vertexLength:ue.vertexLength,primitiveOffset:ue.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&c.segments.push(T),c}encodeCentroid(e,i){const o=e.centroid(),c=i.span(),f=Math.min(7,Math.round(c.x*this.tileToMeter/10)),p=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new kt(Le(o.x,1,Zt-1)<<3|f,Le(o.y,1,Zt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new kt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const c=i[0][0]!==o?0:1;return new kt(6|(i[0][0]!==o?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==o?2:3;return new kt((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,c=e.flags&Ch?q1:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||f!==c.x){for(let p=i;p<o;++p)this.centroidVertexArray.emplace(p,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(Mg(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const f=[];for(const p of this.activeReplacements){if(p.order<o)continue;const v=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));if(p.footprint.buildingId){const b=p.footprint.buildingId;for(const T of this.centroidData)T.buildingId===b&&(T.flags|=Ch)}else for(const b of this.centroidData)if(!(b.flags&Ch||p.min.x>b.max.x||b.min.x>p.max.x||p.min.y>b.max.y||b.min.y>p.max.y))for(let T=0;T<b.footprintSegLen;T++){const I=this.footprintSegments[b.footprintSegIdx+T];if(f.length=0,iO(this.footprintVertices,I.vertexOffset,I.vertexCount,p.footprintTileId.canonical,e.canonical,f),mx(p.footprint,f,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-v)){b.flags|=Ch;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let c=!1;for(let f=0;f<o.footprintSegLen;f++){const p=this.footprintSegments[o.footprintSegIdx+f];let v=0;for(const b of p.ringIndices){for(let T=v,I=b+v-1;T<b+v;I=T++){const C=this.footprintVertices.int16[2*(T+p.vertexOffset)+0],O=this.footprintVertices.int16[2*(T+p.vertexOffset)+1],B=this.footprintVertices.int16[2*(I+p.vertexOffset)+1];O>i!=B>i&&e<(this.footprintVertices.int16[2*(I+p.vertexOffset)+0]-C)*(i-O)/(B-O)+C&&(c=!c)}v=b}}return c}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,c=!0;const f=4*(e+Zt)*Zt+(i+Zt);if(this.partLookup.hasOwnProperty(f)){const p=this.partLookup[f];return p?{height:p.height,hidden:!!(p.flags&Ch)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||p.height<=o||this.footprintContainsPoint(e,i,p)&&(o=p.height,this.partLookup[f]=p,c=!!(p.flags&Ch));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.partLookup[f]=void 0}}function X1(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function tO(n,e,i,o){const c=e.sub(n)._perp()._unit(),f=i.sub(e)._perp()._unit();return K1(n,e,i,X1(c,f),o)}function K1(n,e,i,o,c){const f=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(i)/3,c*f/o)}function xx(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function Y1(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function J1(n,e,i){if(n.x<0||n.x>=Zt||e.x<0||e.x>=Zt||i.x<0||i.x>=Zt)return!1;const o=i.sub(e),c=o.perp(),f=n.sub(e);return(o.x*f.x+o.y*f.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(f.x*f.x+f.y*f.y))>-.866&&c.x*f.x+c.y*f.y<0}function Q1(n,e,i){const o=e?2|n:-3&n;return i?1|o:-2&o}function eT(){const n=Math.PI/32,e=Math.tan(n),i=V;return i*Math.sqrt(1+2*e*e)-i}function tT(n,e,i){const o=1<<i.z,c=Me(i.x/o),f=Me((i.x+1)/o),p=Ie(i.y/o),v=Ie((i.y+1)/o);return(function(b,T,I,C,O=0,B){const N=[];if(!b.length||!I||!C)return N;const X=(ke,Ue)=>{for(const qe of ke)N.push({polygon:qe,bounds:Ue})},K=Math.ceil(Math.log2(I)),Y=Math.ceil(Math.log2(C)),ue=K-Y,de=[];for(let ke=0;ke<Math.abs(ue);ke++)de.push(ue>0?0:1);for(let ke=0;ke<Math.min(K,Y);ke++)de.push(0),de.push(1);let _e=b;if(_e=Ig(_e,T[0].y-O,T[1].y+O,1),_e=Ig(_e,T[0].x-O,T[1].x+O,0),!_e.length)return N;const ze=[];for(de.length?ze.push({polygons:_e,bounds:T,depth:0}):X(_e,T);ze.length;){const ke=ze.pop(),Ue=ke.depth,qe=de[Ue],Ze=ke.bounds[0],Et=ke.bounds[1],Je=qe===0?Ze.x:Ze.y,Ot=qe===0?Et.x:Et.y,jt=B?B(qe,Je,Ot):.5*(Je+Ot),Lt=Ig(ke.polygons,Je-O,jt+O,qe),Ft=Ig(ke.polygons,jt-O,Ot+O,qe);if(Lt.length){const Gt=[Ze,new kt(qe===0?jt:Et.x,qe===1?jt:Et.y)];de.length>Ue+1?ze.push({polygons:Lt,bounds:Gt,depth:Ue+1}):X(Lt,Gt)}if(Ft.length){const Gt=[new kt(qe===0?jt:Ze.x,qe===1?jt:Ze.y),Et];de.length>Ue+1?ze.push({polygons:Ft,bounds:Gt,depth:Ue+1}):X(Ft,Gt)}}return N})(n,e,Math.ceil((f-c)/11.25),Math.ceil((p-v)/11.25),1,((b,T,I)=>{if(b===0)return .5*(T+I);{const C=Ie((i.y+T/Zt)/o);return(Pe(.5*(Ie((i.y+I/Zt)/o)+C))*o-i.y)*Zt}}))}function iO(n,e,i,o,c,f){const p=Math.pow(2,o.z-c.z);for(let v=0;v<i;v++){let b=n.int16[2*(v+e)+0],T=n.int16[2*(v+e)+1];b=(b+c.x*Zt)*p-o.x*Zt,T=(T+c.y*Zt)*p-o.y*Zt,f.push(new kt(b,T))}}let iT,nT;yi(Og,"FillExtrusionBucket",{omit:["layers","features"]}),yi(H1,"PartData"),yi(G1,"FootprintSegment"),yi(Z1,"BorderCentroidData"),yi(vx,"GroundEffect");class yd extends kt{constructor(e,i,o){super(e,i),this.z=o}}class rT extends yd{constructor(e,i,o,c){super(e,i,o),this.w=c}}function sT(n,e,i,o){const c=i==="x"?"y":"x",f=(o-n[i])/(e[i]-n[i]);n[c]=Math.round(n[c]+(e[c]-n[c])*f),n[i]=o,n.hasOwnProperty("z")&&(n.z=Mi(n.z,e.z,f)),n.hasOwnProperty("w")&&(n.w=Mi(n.w,e.w,f))}function oT(n,e,i,o){const c=i,f=o;for(const p of["x","y"]){let v=n,b=e;v[p]>=b[p]&&(v=e,b=n),v[p]<c&&b[p]>c&&sT(v,b,p,c),v[p]<f&&b[p]>f&&sT(b,v,p,f)}}function Lg(n,e,i,o,c,f){const p=[];for(let v=0;v<n.length;v++){const b=n[v];let T;const I=p.length;let C=0;for(let O=0;O<b.length-1;O++){let B=b[O],N=b[O+1],X=0;const K=C;let Y,ue;f&&(X=Math.hypot(N.x-B.x,N.y-B.y),C+=X,Y=B,ue=N),B.x<e&&N.x<e||(B.x<e?B=new kt(e,B.y+(e-B.x)/(N.x-B.x)*(N.y-B.y))._round():N.x<e&&(N=new kt(e,B.y+(e-B.x)/(N.x-B.x)*(N.y-B.y))._round()),B.y<i&&N.y<i||(B.y<i?B=new kt(B.x+(i-B.y)/(N.y-B.y)*(N.x-B.x),i)._round():N.y<i&&(N=new kt(B.x+(i-B.y)/(N.y-B.y)*(N.x-B.x),i)._round()),B.x>=o&&N.x>=o||(B.x>=o?B=new kt(o,B.y+(o-B.x)/(N.x-B.x)*(N.y-B.y))._round():N.x>=o&&(N=new kt(o,B.y+(o-B.x)/(N.x-B.x)*(N.y-B.y))._round()),B.y>=c&&N.y>=c||(B.y>=c?B=new kt(B.x+(c-B.y)/(N.y-B.y)*(N.x-B.x),c)._round():N.y>=c&&(N=new kt(B.x+(c-B.y)/(N.y-B.y)*(N.x-B.x),c)._round()),T&&B.equals(T[T.length-1])||(T=[B],p.push(T),f&&f.push({progress:{min:K+aT(Y,ue,B)*X,max:1},parentIndex:v,prevPoint:Y,nextPoint:ue})),T.push(N),f&&(f[f.length-1].progress.max=K+aT(Y,ue,N)*X,f[f.length-1].nextPoint=ue)))))}if(f&&C>0)for(let O=I;O<p.length;O++)f[O].progress.min/=C,f[O].progress.max/=C}return p}function nO(n,e,i,o,c){if(n.length<2)return void o.push(n);const f=[];for(;e.valid();){const[T,I]=e.get();for(let C=0;C<n.length-1;C++){const O=n[C],B=n[C+1],N=Is(O,B,T,I);if(N){const[X]=N,K=new kt(Mi(O.x,B.x,X),Mi(O.y,B.y,X));f.push({t:C+X,distance:0,point:K})}}e.next()}if(f.length===0)return void o.push(n);f.sort(((T,I)=>T.t-I.t));let p=0,v=0,b=[];for(o.push(b);p!==n.length;){if(v===f.length){for(;p!==n.length;)b.length!==0&&b[b.length-1].equals(n[p])||b.push(n[p]),p++;break}f[v].t<=p?(b.length!==0&&b[b.length-1].equals(f[v].point)||b.push(f[v].point),Math.trunc(f[v].t),v++):(b.length!==0&&b[b.length-1].equals(n[p])||b.push(n[p]),p++)}}function aT(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Am(n,e){return n.x*e.x+n.y*e.y}function lT(n,e){if(n.length===1){let i=0;const o=e[i++];let c;for(;!c||o.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const f=e[i],p=n[0],v=c.sub(o),b=f.sub(o),T=p.sub(o),I=Am(v,v),C=Am(v,b),O=Am(b,b),B=Am(T,v),N=Am(T,b),X=I*O-C*C,K=(O*B-C*N)/X,Y=(I*N-C*B)/X,ue=o.z*(1-K-Y)+c.z*K+f.z*Y;if(isFinite(ue))return ue}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function cT(n,e,i,o,c,f,p,v){const b=p*c.getElevationAt(n,e,!0,!0),T=f[0]!==0,I=T?f[1]===0?p*(f[0]/7-450):p*(function(C,O,B){const N=Math.floor(O[0]/8),X=Math.floor(O[1]/8),K=10*(O[0]-8*N),Y=10*(O[1]-8*X),ue=C.getElevationAt(N,X,!0,!0),de=C.getMeterToDEM(B),_e=Math.floor(.5*(K*de-1)),ze=Math.floor(.5*(Y*de-1)),ke=C.tileCoordToPixel(N,X),Ue=2*_e+1,qe=2*ze+1,Ze=(function(Ft,Gt,Tt,Bt,ht){return[Ft.getElevationAtPixel(Gt,Tt,!0),Ft.getElevationAtPixel(Gt+ht,Tt,!0),Ft.getElevationAtPixel(Gt,Tt+ht,!0),Ft.getElevationAtPixel(Gt+Bt,Tt+ht,!0)]})(C,ke.x-_e,ke.y-ze,Ue,qe),Et=Math.abs(Ze[0]-Ze[1]),Je=Math.abs(Ze[2]-Ze[3]),Ot=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),jt=Math.min(.25,.5*de*(Et+Je)/Ue),Lt=Math.min(.25,.5*de*Ot/qe);return ue+Math.max(jt*K,Lt*Y)})(c,f,v):b;return{base:b+(i===0?-1:i),top:T?Math.max(I+o,b+i+2):b+o}}class rO{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class sO{constructor(){this.tasks={},this.taskQueue=[],qi(["process"],this),this.invoker=new rO(this.process),this.nextId=0}add(e,i){const o=this.nextId++,c=(function({type:f,isSymbolTile:p,zoom:v}){return v=v||0,f==="message"?0:f!=="maybePrepare"||p?f!=="parseTile"||p?f==="parseTile"&&p?300-v:f==="maybePrepare"&&p?400-v:500:200-v:100-v})(i);if(c===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((o=>!!this.tasks[o])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const f=this.tasks[this.taskQueue[c]];f.priority<i&&(i=f.priority,e=c)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class uT{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},qi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new sO}send(e,i,o,c,f=!1,p){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=p,this.callbacks[v]=o);const b=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!o,targetMapId:c,mustQueue:f,sourceMapId:this.mapId,data:Dc(i,b)},b),{cancel:()=>{o&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(i.mustQueue||rr(self)){const c=this.callbacks[o],f=this.scheduler.add((()=>this.processTask(o,i)),c&&c.metadata||{type:"message"});f&&(this.cancelCallbacks[o]=f)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(zc(i.error)):o(null,zc(i.data)))}else{const o=new Set,c=i.hasCallback?(p,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Dc(p):null,data:Dc(v,o)},o)}:()=>{},f=zc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,c);else if(this.parent.getWorkerSource){const p=i.type.split("."),{source:v,scope:b}=f;this.parent.getWorkerSource(i.sourceMapId,p[0],v,b)[p[1]](f,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Im={workerUrl:"",workerClass:null,workerParams:void 0};const bx="mapboxgl_preloaded_worker_pool";class vd{constructor(){this.active={}}acquire(e,i=vd.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Im.workerClass!=null?new Im.workerClass:new self.Worker(Im.workerUrl,Im.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[bx]}numActive(){return Object.keys(this.active).length}}vd.workerCount=2;class Vf{constructor(e,i,o="Worker",c=vd.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ct();const f=this.workerPool.acquire(this.id,c);for(let p=0;p<f.length;p++){const v=new Vf.Actor(f[p],i,this.id);v.name=`${o} ${p}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,o){st(this.actors,((c,f)=>{c.send(e,i,f)}),o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Pm,wx;function Dg(){return Pm||(Pm=new vd),Pm}Vf.Actor=uT;class oO{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,o/i.BYTES_PER_ELEMENT),o}createFloatArray(e){const i=new Float32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,o/i.BYTES_PER_ELEMENT),o}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let o=0;o<e.length;++o)this.module.heapU8[i+o]=e.charCodeAt(o);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,o=e.facadeGlazingColorRgb,c=e.roofColorRgb,f=e.wallColorRgb,p=e.normalScale;this.module.setStyle(i[0],i[1],i[2],o[0],o[1],o[2],c[0],c[1],c[2],f[0],f[1],f[2],p[0],p[1],p[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,o){this.module.setFauxFacadeOptions(e?1:0,i?1:0,o)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const v of e){const b=this.createStringBuffer(v.roofType),T=[0],I=[];for(const B of v.coordinates)if(Array.isArray(B)){for(const N of B)I.push(N.x),I.push(N.y);T.push(I.length)}const C=this.createIntArray(T),O=this.createFloatArray(I);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,b,v.roofType.length,O,C,T.length-1),this.module.free(b),this.module.free(C),this.module.free(O)}for(const v of i){let b;b=v.entrances?JSON.parse(v.entrances):[];const T=this.createFloatArray(b),I=[];for(const O of v.coordinates)I.push(O.x),I.push(O.y);const C=this.createFloatArray(I);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,T,b.length,C,I.length),this.module.free(T),this.module.free(C)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const o=this.module.getMeshCount(),c=new Array(o);for(let v=0;v<o;v++){const b=this.module.getPositionsPtr(v),T=this.module.getPositionsLength(v),I=new Float32Array(this.module.heapF32.buffer,b,T),C=this.module.getNormalsPtr(v),O=this.module.getNormalsLength(v),B=new Float32Array(this.module.heapF32.buffer,C,O),N=this.module.getColorsPtr(v),X=this.module.getColorsLength(v),K=new Uint8Array(this.module.heapU8.buffer,N,X),Y=this.module.getAOPtr(v),ue=this.module.getAOLength(v),de=new Float32Array(this.module.heapF32.buffer,Y,ue),_e=this.module.getUVPtr(v),ze=this.module.getUVLength(v),ke=new Float32Array(this.module.heapF32.buffer,_e,ze),Ue=this.module.getFauxFacadePtr(v),qe=this.module.getFauxFacadeLength(v),Ze=new Uint8Array(this.module.heapU8.buffer,Ue,qe),Et=this.module.getIndicesPtr(v),Je=this.module.getIndicesLength(v),Ot=new Int32Array(this.module.heap32.buffer,Et,Je),jt=this.module.getBuildingPart(v),Lt=this.readStringBuffer(jt);c[v]={positions:I,normals:B,colors:K,ao:de,uv:ke,isFauxFacade:Ze,indices:Ot,buildingPart:Lt}}const f=this.module.getRingCount(),p=[];for(let v=0;v<f;v++){const b=this.module.getRingPtr(v),T=this.module.getRingLength(v),I=new Float32Array(this.module.heapF32.buffer,b,T);p.push(I)}return{meshes:c,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:p}}}let Cm,Tx,dc,jf,Sx,$f=null,qf=null,hT=null,zg=null;function dT(){return rr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Tx||sr.DRACO_URL}function fT(){if(rr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(jf)return jf;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return jf=WebAssembly.validate(n)?sr.MESHOPT_SIMD_URL:sr.MESHOPT_URL,jf}function aO(){return zg}const kg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lO={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Mm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function pT(n,e,i){const o=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:c,byteLength:n.byteLength},i.buffers[c]=n}const Ex="KHR_draco_mesh_compression";function cO(n,e){const i=n.extensions&&n.extensions[Ex];if(!i)return;const o=new dc.Decoder,c=yT(e,i.bufferView),f=new dc.Mesh;if(!o.DecodeArrayToMesh(c,c.byteLength,f))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[n.indices],v=kg[p.componentType],b=p.count*v.BYTES_PER_ELEMENT,T=dc._malloc(b);v===Uint16Array?o.GetTrianglesUInt16Array(f,b,T):o.GetTrianglesUInt32Array(f,b,T),pT(dc.memory.buffer.slice(T,T+b),p,e),dc._free(T);for(const I of Object.keys(i.attributes)){const C=o.GetAttributeByUniqueId(f,i.attributes[I]),O=e.json.accessors[n.attributes[I]],B=lO[O.componentType],N=O.count*Mm[O.type]*kg[O.componentType].BYTES_PER_ELEMENT,X=dc._malloc(N);o.GetAttributeDataArrayForAllPoints(f,C,dc[B],N,X),pT(dc.memory.buffer.slice(X,X+N),O,e),dc._free(X)}o.destroy(),f.destroy(),delete n.extensions[Ex]}const Fg="EXT_meshopt_compression";function uO(n,e){if(!n.extensions||!n.extensions[Fg])return;const i=n.extensions[Fg],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);Sx.decodeGltfBuffer(c,i.count,i.byteStride,o,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=c.buffer,delete n.extensions[Fg]}const mT=1179937895,_T=new TextDecoder("utf8");function gT(n,e){return new URL(n,e).href}function hO(n,e,i,o){return fetch(gT(n.uri,o)).then((c=>c.arrayBuffer())).then((c=>{e.buffers[i]=c}))}function yT(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function dO(n,e,i,o){if(n.uri){const c=gT(n.uri,o);return fetch(c).then((f=>f.blob())).then((f=>createImageBitmap(f))).then((f=>{e.images[i]=f}))}if(n.bufferView!==void 0){const c=yT(e,n.bufferView),f=new Blob([c],{type:n.mimeType});return createImageBitmap(f).then((p=>{e.images[i]=p}))}}function vT(n,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===mT){const I=new Uint32Array(n,e);let C=2;const O=(I[C++]>>2)-3,B=I[C++]>>2;if(C++,o.json=JSON.parse(_T.decode(I.subarray(C,C+B))),C+=B,C<O){const N=I[C++];C++;const X=e+(C<<2);o.buffers[0]=n.slice(X,X+N)}}else o.json=JSON.parse(_T.decode(new Uint8Array(n,e)));const{buffers:c,images:f,meshes:p,extensionsUsed:v,bufferViews:b}=o.json;let T=Promise.resolve();if(c){const I=[];for(let C=0;C<c.length;C++){const O=c[C];O.uri?I.push(hO(O,o,C,i)):o.buffers[C]||(o.buffers[C]=null)}T=Promise.all(I)}return T.then((()=>{const I=[],C=v&&v.includes(Ex),O=v&&v.includes(Fg);if(C&&I.push((function(){if(!dc)return Cm??(Cm=(function(B){let N,X=null;function K(){N=new Uint8Array(X.buffer)}function Y(){throw new Error("Unexpected Draco error.")}const ue={a:{a:Y,d:function(de,_e,ze){return N.copyWithin(de,_e,_e+ze)},c:function(de){const _e=N.length,ze=Math.max(de>>>0,Math.ceil(1.2*_e)),ke=Math.ceil((ze-_e)/65536);try{return X.grow(ke),K(),!0}catch{return!1}},b:Y}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,ue):B.then((de=>de.arrayBuffer())).then((de=>WebAssembly.instantiate(de,ue)))).then((de=>{const{Rb:_e,Qb:ze,P:ke,T:Ue,X:qe,Ja:Ze,La:Et,Qa:Je,Va:Ot,Wa:jt,eb:Lt,jb:Ft,f:Gt,e:Tt,yb:Bt,zb:ht,Ab:at,Bb:Ht,Db:$t,Gb:Vi}=de.instance.exports;X=Tt;const gi=(()=>{let Ci=0,Yt=0,Ni=0,ln=0;return oi=>{Ni&&(_e(ln),_e(Ci),Yt+=Ni,Ni=Ci=0),Ci||(Yt+=128,Ci=ze(Yt));const zi=oi.length+7&-8;let tn=Ci;zi>=Yt&&(Ni=zi,tn=ln=ze(zi));for(let _n=0;_n<oi.length;_n++)N[tn+_n]=oi[_n];return tn}})();return K(),Gt(),{memory:Tt,_free:_e,_malloc:ze,Mesh:class{constructor(){this.ptr=ke()}destroy(){Ue(this.ptr)}},Decoder:class{constructor(){this.ptr=Ze()}destroy(){Ft(this.ptr)}DecodeArrayToMesh(Ci,Yt,Ni){const ln=gi(Ci),oi=Et(this.ptr,ln,Yt,Ni.ptr);return!!qe(oi)}GetAttributeByUniqueId(Ci,Yt){return{ptr:Je(this.ptr,Ci.ptr,Yt)}}GetTrianglesUInt16Array(Ci,Yt,Ni){Ot(this.ptr,Ci.ptr,Yt,Ni)}GetTrianglesUInt32Array(Ci,Yt,Ni){jt(this.ptr,Ci.ptr,Yt,Ni)}GetAttributeDataArrayForAllPoints(Ci,Yt,Ni,ln,oi){Lt(this.ptr,Ci.ptr,Yt.ptr,Ni,ln,oi)}},DT_INT8:Bt(),DT_UINT8:ht(),DT_INT16:at(),DT_UINT16:Ht(),DT_UINT32:$t(),DT_FLOAT32:Vi()}}))})(fetch(dT())),Cm.then((B=>{dc=B,Cm=void 0})))})()),O&&I.push((function(){if(Sx)return;const B=(function(N){let X;const K=WebAssembly.instantiateStreaming(N,{}).then((de=>{X=de.instance,X.exports.__wasm_call_ctors()})),Y={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ue={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:K,supported:!0,decodeGltfBuffer(de,_e,ze,ke,Ue,qe){(function(Ze,Et,Je,Ot,jt,Lt,Ft){const Gt=Ze.exports.sbrk,Tt=Ot+3&-4,Bt=Gt(Tt*jt),ht=Gt(Lt.length),at=new Uint8Array(Ze.exports.memory.buffer);at.set(Lt,ht);const Ht=Et(Bt,Ot,jt,ht,Lt.length);if(Ht===0&&Ft&&Ft(Bt,Tt,jt),Je.set(at.subarray(Bt,Bt+Ot*jt)),Gt(Bt-Gt(0)),Ht!==0)throw new Error(`Malformed buffer data: ${Ht}`)})(X,X.exports[ue[Ue]],de,_e,ze,ke,X.exports[Y[qe]])}}})(fetch(fT()));return B.ready.then((()=>{Sx=B}))})()),f)for(let B=0;B<f.length;B++)I.push(dO(f[B],o,B,i));return(I.length?Promise.all(I):Promise.resolve()).then((()=>{if(C&&p)for(const{primitives:B}of p)for(const N of B)cO(N,o);if(O&&p&&b)for(const B of b)uO(B,o);return o}))}))}function Ax(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Ix(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Px{constructor(e,i,o,c){this.context=e,this.format=o,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:c&&c.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:p}=f,{x:v,y:b}=i&&i.position?i.position:{x:0,y:0},T=v+o,I=b+c;!this.size||this.size[0]===T&&this.size[1]===I||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!i||i.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&I>0){const O=this.useMipmap?Math.floor(Math.log2(Math.max(T,I)))+1:1;p.texStorage2D(p.TEXTURE_2D,O,this.format,T,I),this.size=[T,I]}this.size&&(C?p.texSubImage2D(p.TEXTURE_2D,0,v,b,Ax(this.format),Ix(this.format),e):"data"in e&&e.data&&p.texSubImage2D(p.TEXTURE_2D,0,v,b,o,c,Ax(this.format),Ix(this.format),e.data)),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i,o=!1){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,c,f){const{context:p}=this,{gl:v}=p;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,o),this.wrapS=o),c!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,c),this.wrapT=c),f!==this.compareMode&&(f?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,f)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Rm{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}const fO=qn([{name:"a_pos_3f",components:3,type:"Float32"}]),pO=qn([{name:"a_color_3f",components:3,type:"Float32"}]),mO=qn([{name:"a_color_4f",components:4,type:"Float32"}]),_O=qn([{name:"a_uv_2f",components:2,type:"Float32"}]),gO=qn([{name:"a_normal_3f",components:3,type:"Float32"}]),yO=qn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),vO=qn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function xT(n,e){const i=Bg(n.projection,n.zoom,n.width,n.height),o=(function(f,p,v,b,T){const I=new Z(v.lng-180*Mh,v.lat),C=new Z(v.lng+180*Mh,v.lat),O=f.project(I.lng,I.lat),B=f.project(C.lng,C.lat),N=-Math.atan2(B.y-O.y,B.x-O.x),X=pt.fromLngLat(v);X.y=Le(X.y,-1+Mh,1-Mh);const K=X.toLngLat(),Y=f.project(K.lng,K.lat),ue=pt.fromLngLat(K);ue.x+=Mh;const de=ue.toLngLat(),_e=f.project(de.lng,de.lat),ze=wT(_e.x-Y.x,_e.y-Y.y,N),ke=pt.fromLngLat(K);ke.y+=Mh;const Ue=ke.toLngLat(),qe=f.project(Ue.lng,Ue.lat),Ze=wT(qe.x-Y.x,qe.y-Y.y,N),Et=Math.abs(ze.x)/Math.abs(Ze.y),Je=he([]);xt(Je,Je,-N*(1-(T?0:b)));const Ot=he([]);return oe(Ot,Ot,[1,1-(1-Et)*b,1]),Ot[4]=-Ze.x/Ze.y*b,xt(Ot,Ot,N),Se(Ot,Je,Ot),Ot})(n.projection,0,n.center,i,e),c=bT(n);return oe(o,o,[c,c,1]),o}function bT(n){const e=n.projection,i=Bg(n.projection,n.zoom,n.width,n.height),o=Cx(e,n.center),c=Cx(e,Z.convert(e.center));return Math.pow(2,o*i+(1-i)*c)}function Bg(n,e,i,o,c=1/0){const f=n.range;if(!f)return 0;const p=Math.min(c,Math.max(i,o)),v=Math.log2(p/1024);return rt(f[0]+v,f[1]+v,e)}const Mh=1/4e4;function Cx(n,e){const i=Le(e.lat,-Re,Re),o=new Z(e.lng-180*Mh,i),c=new Z(e.lng+180*Mh,i),f=n.project(o.lng,i),p=n.project(c.lng,i),v=pt.fromLngLat(o),b=pt.fromLngLat(c),T=p.x-f.x,I=p.y-f.y,C=b.x-v.x,O=b.y-v.y,B=Math.sqrt((C*C+O*O)/(T*T+I*I));return Math.log2(B)}function wT(n,e,i){const o=Math.cos(i),c=Math.sin(i);return{x:n*o-e*c,y:n*c+e*o}}function TT(n,e,i){he(n),xt(n,n,Xe(e[2])),ge(n,n,Xe(e[0])),Ge(n,n,Xe(e[1])),oe(n,n,i),Se(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ng(n,e,i,o,c,f,p,v){const b=[i[0]-e[0],i[1]-e[1],0],T=[o[0]-e[0],o[1]-e[1],0];if(ft(b)<1e-12||ft(T)<1e-12)return sn(n);const I=Ui([],b,T);Pt(I,I),si(T,o,e),b[2]=(f-c)*v,T[2]=(p-c)*v;const C=b;return Ui(C,b,T),Pt(C,C),is(n,I,C)}function Mx(n,e,i=!1){const o=Ih(e.zoom),c=(function(f,p,v){const b=p.worldSize,T=[f[12],f[13],f[14]],I=Ie(T[1]/b),C=Me(T[0]/b),O=he([]),B=Ae(1,I)*b,N=Ae(1,0)*b*We(I,p.zoom),X=1/rx(b);let K=N*X;if(v){const _e=Bg(p.projection,p.zoom,p.width,p.height,1024);K=X*p.projection.pixelSpaceConversion(p.center.lat,b,_e)}const Y=F(I,C);yt(Y,Y,di([],Pt([],Y),B*K*T[2]));const ue=(function(_e){const ze=[_e[0],_e[1],_e[2]];let ke=[0,1,0];const Ue=Ui([],ke,ze);return Ui(ke,ze,Ue),an(ke)===0&&(ke=[0,1,0],Ui(Ue,ze,ke)),Pt(Ue,Ue),Pt(ke,ke),Pt(ze,ze),[Ue[0],Ue[1],Ue[2],0,ke[0],ke[1],ke[2],0,ze[0],ze[1],ze[2],0,_e[0],_e[1],_e[2],1]})(Y);oe(O,O,[K,K,K*B]),fe(O,O,[-T[0],-T[1],-T[2]]);const de=Se([],p.globeMatrix,ue);return Se(de,de,O),Se(de,de,f),de})(n,e,i);if(o>0){const f=(function(p,v){const b=v.worldSize,T=Ae(1,0)*b*We(v.center.lat,v.zoom)/rx(b),I=Ae(1,v.center.lat)*b,C=he([]);Ge(C,C,Xe(v.center.lng)),ge(C,C,Xe(v.center.lat)),fe(C,C,[0,0,u]),oe(C,C,[T,T,T*I]);const O=v.point;return fe(C,C,[-O.x,-O.y,0]),Se(C,C,p),Se(C,v.globeMatrix,C)})(n,e);return(function(p,v,b){const T=(N,X,K)=>{const Y=ft(N),ue=ft(X),de=ku(N,X,K);return di(de,de,1/ft(de)*Mi(Y,ue,K))},I=T([p[0],p[1],p[2]],[v[0],v[1],v[2]],b),C=T([p[4],p[5],p[6]],[v[4],v[5],v[6]],b),O=T([p[8],p[9],p[10]],[v[8],v[9],v[10]],b),B=ku([p[12],p[13],p[14]],[v[12],v[13],v[14]],b);return[I[0],I[1],I[2],0,C[0],C[1],C[2],0,O[0],O[1],O[2],0,B[0],B[1],B[2],1]})(c,f,o)}return c}function ST(n,e,i,o){const c=nn.projectAabbCorners(o,i);let f=Number.MAX_VALUE,p=-1;for(let T=0;T<c.length;++T){const I=c[T];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<f&&(p=T,f=I[2])}const v=T=>new kt(c[T][0],c[T][1]);let b;switch(p){case 0:case 6:b=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:b=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:b=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:b=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(Ha(n,b))return f}const xd=64,Gf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function ET(n,e,i,o,c,f,p,v,b,T=!1){const I=i.zoom,C=i.project(o),O=We(o.lat,I),B=1/O;he(n),fe(n,n,[C.x+p[0]*B,C.y+p[1]*B,p[2]]);let N=1,X=1;const K=i.worldSize;if(T){if(i.projection.name==="mercator"){let _e=0;i.elevation&&(_e=i.elevation.getAtPointOrZero(new pt(C.x/K,C.y/K),0));const ze=ui([],[C.x,C.y,_e,1],i.projMatrix)[3]/i.cameraToCenterDistance;N=ze,X=ze*We(i.center.lat,I)}else if(i.projection.name==="globe"){const _e=Mx(n,i),ze=[0,0,0,1];ui(ze,ze,Se([],i.projMatrix,_e));const ke=ze[3]/i.cameraToCenterDistance,Ue=Ih(I),qe=i.projection.pixelsPerMeter(o.lat,K)*We(o.lat,I),Ze=i.projection.pixelsPerMeter(i.center.lat,K)*We(i.center.lat,I);N=ke/Mi(qe,nt(i.center.lat),Ue),X=ke*O/qe,N*=Ze,X*=Ze}}else N=B;oe(n,n,[N,N,X]);const Y=[...n],ue=e.orientation,de=[];if(TT(de,[ue[0]+c[0],ue[1]+c[1],ue[2]+c[2]],f),Se(n,Y,de),v&&i.elevation){let _e=0;const ze=[];if(b&&i.elevation){_e=(function(Ue,qe,Ze,Et,Je){const Ot=qe.elevation;if(!Ot)return 0;const jt=nn.projectAabbCorners(Ze,Et),Lt=Ae(1,Je.lat)*qe.worldSize,Ft=(function(Yt,Ni){const ln=[0,0,1],oi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const zi of oi){const tn=Yt[zi.corners[0]],_n=Yt[zi.corners[1]],On=Yt[zi.corners[2]],yn=[_n[0]-tn[0],_n[1]-tn[1],Ni*(_n[2]-tn[2])],Si=Ui(yn,yn,[On[0]-tn[0],On[1]-tn[1],Ni*(On[2]-tn[2])]);Pt(Si,Si),zi.dotProductWithUp=pi(Si,ln)}return oi.sort(((zi,tn)=>zi.dotProductWithUp-tn.dotProductWithUp)),oi[0].corners})(jt,Lt),Gt=jt[Ft[0]],Tt=jt[Ft[1]],Bt=jt[Ft[2]],ht=jt[Ft[3]],at=Ot.getAtPointOrZero(new pt(Gt[0]/qe.worldSize,Gt[1]/qe.worldSize),0),Ht=Ot.getAtPointOrZero(new pt(Tt[0]/qe.worldSize,Tt[1]/qe.worldSize),0),$t=Ot.getAtPointOrZero(new pt(Bt[0]/qe.worldSize,Bt[1]/qe.worldSize),0),Vi=Ot.getAtPointOrZero(new pt(ht[0]/qe.worldSize,ht[1]/qe.worldSize),0),gi=(at+Vi)/2,Ci=(Ht+$t)/2;return gi>Ci?Ht<$t?Ng(Ue,Tt,ht,Gt,Ht,Vi,at,Lt):Ng(Ue,Bt,Gt,ht,$t,at,Vi,Lt):at<Vi?Ng(Ue,Gt,Tt,Bt,at,Ht,$t,Lt):Ng(Ue,ht,Bt,Tt,Vi,$t,Ht,Lt),Math.max(gi,Ci)})(ze,i,e.aabb,n,o);const ke=Se([],Be([],ze),de);Se(n,Y,ke)}else _e=i.elevation.getAtPointOrZero(new pt(C.x/K,C.y/K),0);_e!==0&&(n[14]+=_e)}}function Om(n,e,i=!1){n.uploaded||(n.gfxTexture=new Px(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function xO(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,fO.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,gO.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,_O.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?pO:mO).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,vO.members,!0)),n.segments=cs.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const o=n.material;o.pbrMetallicRoughness.baseColorTexture&&Om(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Om(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Om(o.normalTexture,e),o.occlusionTexture&&Om(o.occlusionTexture,e,i),o.emissionTexture&&Om(o.emissionTexture,e)}function Rx(n,e,i){if(n.meshes)for(const o of n.meshes)xO(o,e,i);if(n.children)for(const o of n.children)Rx(o,e,i)}function Ug(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)Ug(e)}function Ox(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)Ox(i)}function bd(n,e){const i=n.json.bufferViews[e.bufferView],o=kg[e.componentType];return new o(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Mm[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Mm[e.type]))}function Lx(n,e,i,o){const c=kg[e.componentType],f=(function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(c),p=n.json.bufferViews[e.bufferView],v=p.byteStride?p.byteStride/c.BYTES_PER_ELEMENT:Mm[e.type],b=i.float32,T=b.length/i.capacity;for(let I=0,C=0;I<e.count*v;I+=v,C+=T)for(let O=0;O<T;O++)b[C+O]=o[I+O]*f;i._trim()}function bO(n,e,i){const o=n.indices,c=n.attributes,f={};f.indexArray=new co;const p=e.json.accessors[o],v=p.count/3;f.indexArray.reserve(v);const b=bd(e,p);for(let O=0;O<v;O++)f.indexArray.emplaceBack(b[3*O],b[3*O+1],b[3*O+2]);f.indexArray._trim(),f.vertexArray=new Ta;const T=e.json.accessors[c.POSITION];f.vertexArray.reserve(T.count);const I=bd(e,T);for(let O=0;O<T.count;O++)f.vertexArray.emplaceBack(I[3*O],I[3*O+1],I[3*O+2]);if(f.vertexArray._trim(),f.aabb=new nn(T.min,T.max),f.centroid=(function(O,B){const N=[0,0,0],X=O.length;if(X>0){for(let K=0;K<X;K++){const Y=3*O[K];N[0]+=B[Y],N[1]+=B[Y+1],N[2]+=B[Y+2]}N[0]/=X,N[1]/=X,N[2]/=X}return N})(b,I),c.COLOR_0!==void 0){const O=e.json.accessors[c.COLOR_0],B=Mm[O.type],N=bd(e,O);f.colorArray=B===3?new Ta:new gl,f.colorArray.resize(O.count),Lx(e,O,f.colorArray,N)}if(c.NORMAL!==void 0){f.normalArray=new Ta;const O=e.json.accessors[c.NORMAL];f.normalArray.resize(O.count);const B=bd(e,O);Lx(e,O,f.normalArray,B)}if(c.TEXCOORD_0!==void 0&&i.length>0){f.texcoordArray=new Th;const O=e.json.accessors[c.TEXCOORD_0];f.texcoordArray.resize(O.count);const B=bd(e,O);Lx(e,O,f.texcoordArray,B)}if(c._FEATURE_ID_RGBA4444!==void 0){const O=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=bd(e,O))}c._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(bd(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const C=n.material;return f.material=(function(O,B){const{emissiveFactor:N=[0,0,0],alphaMode:X="OPAQUE",alphaCutoff:K=.5,normalTexture:Y,occlusionTexture:ue,emissiveTexture:de,doubleSided:_e}=O,{baseColorFactor:ze=[1,1,1,1],metallicFactor:ke=1,roughnessFactor:Ue=1,baseColorTexture:qe,metallicRoughnessTexture:Ze}=O.pbrMetallicRoughness||{},Et=ue?B[ue.index]:void 0;if(ue&&ue.extensions&&ue.extensions.KHR_texture_transform&&Et){const Je=ue.extensions.KHR_texture_transform;Et.offsetScale=[Je.offset[0],Je.offset[1],Je.scale[0],Je.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Cn(...ze),metallicFactor:ke,roughnessFactor:Ue,baseColorTexture:qe?B[qe.index]:void 0,metallicRoughnessTexture:Ze?B[Ze.index]:void 0},doubleSided:_e,emissiveFactor:new Cn(...N),alphaMode:X,alphaCutoff:K,normalTexture:Y?B[Y.index]:void 0,occlusionTexture:Et,emissionTexture:de?B[de.index]:void 0,defined:O.defined===void 0}})(C!==void 0?e.json.materials[C]:{defined:!1},i),f}function AT(n,e,i){const{matrix:o,rotation:c,translation:f,scale:p,mesh:v,extras:b,children:T}=n,I={};if(I.matrix=o||(function(C,O,B,N){var X=O[0],K=O[1],Y=O[2],ue=O[3],de=X+X,_e=K+K,ze=Y+Y,ke=X*de,Ue=X*_e,qe=X*ze,Ze=K*_e,Et=K*ze,Je=Y*ze,Ot=ue*de,jt=ue*_e,Lt=ue*ze,Ft=N[0],Gt=N[1],Tt=N[2];return C[0]=(1-(Ze+Je))*Ft,C[1]=(Ue+Lt)*Ft,C[2]=(qe-jt)*Ft,C[3]=0,C[4]=(Ue-Lt)*Gt,C[5]=(1-(ke+Je))*Gt,C[6]=(Et+Ot)*Gt,C[7]=0,C[8]=(qe+jt)*Tt,C[9]=(Et-Ot)*Tt,C[10]=(1-(ke+Ze))*Tt,C[11]=0,C[12]=B[0],C[13]=B[1],C[14]=B[2],C[15]=1,C})([],c||[0,0,0,1],f||[0,0,0],p||[1,1,1]),v!==void 0){I.meshes=i[v];const C=I.anchor=[0,0];for(const O of I.meshes){const{min:B,max:N}=O.aabb;C[0]+=B[0]+N[0],C[1]+=B[1]+N[1]}C[0]=Math.floor(C[0]/I.meshes.length/2),C[1]=Math.floor(C[1]/I.meshes.length/2)}if(b&&(b.id&&(I.id=b.id),b.lights&&(I.lights=(function(C){if(!C.length)return[];const O=(function(Y){const ue=atob(Y),de=new Uint8Array(ue.length);for(let _e=0;_e<ue.length;_e++)de[_e]=ue.codePointAt(_e);return de})(C),B=[],N=O.length/24,X=new Uint16Array(O.buffer),K=new Float32Array(O.buffer);for(let Y=0;Y<N;Y++){const ue=X[2*Y*6]/30,de=X[2*Y*6+1]/30,_e=X[2*Y*6+10]/100,ze=K[6*Y+1],ke=K[6*Y+2],Ue=K[6*Y+3],qe=K[6*Y+4],Ze=Ue-ze,Et=qe-ke,Je=Math.hypot(Ze,Et);B.push({pos:[ze+.5*Ze,ke+.5*Et,de],normal:[Et/Je,-Ze/Je,0],width:Je,height:ue,depth:_e,points:[ze,ke,Ue,qe]})}return B})(b.lights))),T){const C=[];for(const O of T)C.push(AT(e.json.nodes[O],e,i));I.children=C}return I}function wO(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Pg(n.vertices,n.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:o}}function TO(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const v=p[0],b=p[1];typeof v=="number"&&typeof b=="number"&&o.push(new kt(v,b))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let c=0;for(let p=0;p<o.length;p++){const v=o[p],b=o[(p+1)%o.length],T=o[(p+2)%o.length];c+=(v.x-b.x)*(T.y-b.y)-(T.x-b.x)*(v.y-b.y)}c>0&&o.reverse();const f=Nf(o.flatMap((p=>[p.x,p.y])),[]);return f.length===0?null:{vertices:o,indices:f}}function SO(n,e){const i=[],o=[];let c=0;const f=[];for(const p of n){c=i.length;const v=p.vertexArray.float32,b=p.indexArray.uint16;for(let T=0;T<p.vertexArray.length;T++)f[0]=v[3*T+0],f[1]=v[3*T+1],f[2]=v[3*T+2],_i(f,f,e),i.push(new kt(f[0],f[1]));for(let T=0;T<3*p.indexArray.length;T++)o.push(b[T]+c)}if(o.length%3!=0)return null;for(let p=0;p<o.length;p+=3){const v=i[o[p+0]],b=i[o[p+1]],T=i[o[p+2]];(v.x-b.x)*(T.y-b.y)-(T.x-b.x)*(v.y-b.y)>0&&([o[p+1],o[p+2]]=[o[p+2],o[p+1]])}return{vertices:i,indices:o}}function IT(n){const e=(function(b,T){const I=[],C=WebGL2RenderingContext;if(b.json.textures)for(const O of b.json.textures){const B={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};O.sampler!==void 0&&Object.assign(B,b.json.samplers[O.sampler]),I.push({image:T[O.source],sampler:B,uploaded:!1})}return I})(n,n.images),i=(function(b,T){const I=[];for(const C of b.json.meshes){const O=[];for(const B of C.primitives)O.push(bO(B,b,T));I.push(O)}return I})(n,e),{scenes:o,scene:c,nodes:f}=n.json,p=o?o[c||0].nodes:[...f.keys()],v=[];for(const b of p)v.push(AT(f[b],n,i));return(function(b,T,I){const C={},O=new Set;for(let B=0;B<b.length;B++){const N=I[T[B]];if(!N.extras)continue;const X=N.extras["mapbox:footprint:version"],K=N.extras["mapbox:footprint:id"];(X||K)&&O.add(B),X==="1.0.0"&&K&&(C[K]=B)}for(let B=0;B<b.length;B++){if(O.has(B))continue;const N=b[B],X=I[T[B]];if(!X.extras)continue;let K=null;N.id in C&&(K=SO(b[C[N.id]].meshes,N.matrix)),K||(K=TO(X)),K&&(N.footprint=wO(K))}if(O.size>0){const B=Array.from(O.values()).sort(((N,X)=>N-X));for(let N=B.length-1;N>=0;N--)b.splice(B[N],1)}})(v,p,n.json.nodes),v}function EO(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,o=n.aabb.min[1]-1,c=xd/(n.aabb.max[0]-i+2),f=xd/(n.aabb.max[1]-o+2);for(let p=0;p<e.length;p+=3){const v=e[p+2],b=(e[p+0]-i)*c|0,T=(e[p+1]-o)*f|0;v>n.heightmap[T*xd+b]&&(n.heightmap[T*xd+b]=v)}}function PT(n,e,i,o,c){i.reserve(i.length+4*n.length),o.reserve(o.length+10*n.length),c.reserve(c.length+10*n.length);let f=o.length;for(const p of n){const v=Math.min(10,Math.max(4,1.3*p.height))*e,b=[-p.normal[1],p.normal[0],0],T=Math.min(.29,.1*p.width/p.depth),I=p.width-2*p.depth*e*(T+.01),C=ki([],p.pos,b,I/2),O=ki([],p.pos,b,-I/2),B=[C[0],C[1],C[2]+p.height],N=[O[0],O[1],O[2]+p.height],X=ki([],p.normal,b,T);di(X,X,v);const K=ki([],p.normal,b,-T);di(K,K,v),yt(X,C,X),yt(K,O,K),C[2]+=.1,O[2]+=.1,o.emplaceBack(X[0],X[1],X[2]),o.emplaceBack(K[0],K[1],K[2]),o.emplaceBack(C[0],C[1],C[2]),o.emplaceBack(O[0],O[1],O[2]),o.emplaceBack(B[0],B[1],B[2]),o.emplaceBack(N[0],N[1],N[2]),o.emplaceBack(C[0],C[1],C[2]),o.emplaceBack(O[0],O[1],O[2]),o.emplaceBack(X[0],X[1],X[2]),o.emplaceBack(K[0],K[1],K[2]);const Y=I/v/2;c.emplaceBack(-Y-T,-1,Y,.8),c.emplaceBack(Y+T,-1,Y,.8),c.emplaceBack(-Y,0,Y,1.3),c.emplaceBack(Y,0,Y,1.3),c.emplaceBack(Y+T,-.8,Y,.7),c.emplaceBack(Y+T,-.8,Y,.7),c.emplaceBack(0,0,Y,1.3),c.emplaceBack(0,0,Y,1.3),c.emplaceBack(Y+T,-1.2,Y,.8),c.emplaceBack(Y+T,-1.2,Y,.8),i.emplaceBack(6+f,4+f,8+f),i.emplaceBack(7+f,9+f,5+f),i.emplaceBack(0+f,1+f,2+f),i.emplaceBack(1+f,3+f,2+f),f+=10}}function AO(n,e){const i={};i.indexArray=new co,i.vertexArray=new Ta,i.colorArray=new gl,PT(n,e,i.indexArray,i.vertexArray,i.colorArray);const o={defined:!0};o.emissiveFactor=Cn.black;const c={};return c.baseColorFactor=Cn.white,o.pbrMetallicRoughness=c,i.material=o,i.aabb=new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const CT=qn([{name:"a_pos_3f",components:3,type:"Float32"}]),IO=qn([{name:"a_normal_3",components:3,type:"Int16"}]),PO=qn([{name:"a_centroid_3",components:3,type:"Int16"}]),MT=qn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),CO=qn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),MO=qn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),RO=qn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),OO=qn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),RT=Ut.types,Dx=32767;function LO(n,e){const i=Zt+e;for(const o of n)for(const c of o)if(c.x<-e||c.x>i||c.y<-e||c.y>i)return!1;return!0}class OT{constructor(){this.layoutVertexArray=new Ta,this.layoutAttenuationArray=new gl,this.layoutColorArray=new eo,this.indexArray=new co,this.indexArrayForConflation=new co,this.segmentsBucket=new cs}}class zx{constructor(){this.layoutVertexArray=new Ta,this.layoutNormalArray=new Ru,this.layoutCentroidArray=new Ru,this.layoutColorArray=new eo,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new co,this.indexArrayForConflation=new co,this.segmentsBucket=new cs,this.entranceBloom=new OT}}class LT{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new zx,this.buildingWithFacade=new zx,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new eo,this.buildingWithFacade.layoutFacadeDataArray=new xh,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new eo,this.programConfigurations=new yl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new vx(e)}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}prepare(){return(function(){if(zg!=null||hT!=null)return null;if(qf!=null)return qf;const e=fetch(sr.BUILDING_GEN_URL);return qf=(function(i){let o,c,f,p;function v(){o=new Uint8Array(p.buffer),c=new Int32Array(p.buffer),f=new Float32Array(p.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},I={a:{a:b,f:function(C){const O=o.length,B=Math.max(C>>>0,Math.ceil(1.2*O)),N=Math.ceil((B-O)/65536);try{return p.grow(N),v(),!0}catch{return!1}},g:b,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,I):i.then((C=>C.arrayBuffer())).then((C=>WebAssembly.instantiate(C,I)))).then((C=>{const O=C.instance.exports;return(0,O.g)(),p=O.f,v(),new oO({setStyle:O.h,setAOOptions:O.i,setMetricOptions:O.j,setStructuralOptions:O.k,setFacadeOptions:O.l,setFauxFacadeOptions:O.m,setFacadeClassifierOptions:O.n,addFeature:O.o,addFacade:O.p,generateMesh:O.q,getLastError:O.r,getOuterRingLength:O.s,getMeshCount:O.t,getPositionsPtr:O.u,getPositionsLength:O.v,getNormalsPtr:O.w,getNormalsLength:O.x,getColorsPtr:O.y,getColorsLength:O.z,getAOPtr:O.A,getAOLength:O.B,getUVPtr:O.C,getUVLength:O.D,getFauxFacadePtr:O.E,getFauxFacadeLength:O.F,getIndicesPtr:O.G,getIndicesLength:O.H,getBuildingPart:O.I,getRingCount:O.J,getRingPtr:O.K,getRingLength:O.L,free:O.M,malloc:O.N,heapU8:o,heap32:c,heapF32:f})}))})(e).then((i=>(qf=null,zg=i,zg))).catch((i=>{An("Could not load building-gen"),qf=null,hT=i})),qf})()}populate(e,i,o,c){const f=aO();if(!f)return;const p=et(o);this.tileToMeter=p,this.brightness=i.brightness,f.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,p],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:p,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),f.setAOOptions(!1,.3),f.setMetricOptions(!1,16),f.setStructuralOptions(!0),f.setFacadeClassifierOptions(3);const v=new Map;for(const{feature:b}of e){if(RT[b.type]!=="LineString")continue;const T=this.layers[0]._featureFilter.needGeometry,I=qt(b,T);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),I,o))continue;const C=T?I.geometry:hi(b,o,c),O=[];for(const K of C)for(const Y of K)O.push({x:Y.x,y:Y.y});const B={coordinates:O,crossPerc:b.properties.cross_perc,distanceToRoad:b.properties.distance_to_road,entrances:b.properties.entrances,sourceId:0},N=b.properties.source_id;let X=v.get(N);X||(X=[],v.set(N,X)),X.push(B)}this.maxHeight=0;for(const{feature:b,index:T}of e){if(RT[b.type]==="LineString")continue;const I=this.layers[0]._featureFilter.needGeometry,C=qt(b,I);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom),C,o))continue;const O=I?C.geometry:hi(b,o,c),B=bm(O,500);if(!LO(O,163))continue;const N=this.layers[0],X=N.layout.get("building-base").evaluate(b,{},o),K=N.layout.get("building-height").evaluate(b,{},o),Y=N.layout.get("building-roof-shape").evaluate(b,{},o),ue=N.paint.get("building-ambient-occlusion-intensity"),de=N.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(Y==="flat")continue;const _e=N.layout.get("building-facade").evaluate(b,{},o);f.setFacadeOptions(4,!0),f.setFauxFacadeOptions(_e,!1,1);const ze=b.properties.source_id;let ke;ke=v.has(ze)?v.get(ze):[];let Ue=0,qe=0,Ze=0,Et=0,Je=0,Ot=0;if(_e){let Si=Math.round(N.layout.get("building-facade-floors").evaluate(b,{},o));if(X===0){Si=Math.max(1,Si-(ke.length>0?1:0));let Wn=4;if(K>100){const xe=[10,13,15];Wn=xe[b.id?b.id%xe.length:0],f.setFacadeOptions(Wn,!0)}Je=1.6803*Wn/p}else Je=X/p;Ot=K/p,Je=Math.min(Je,Ot),Ze=N.layout.get("building-facade-unit-width").evaluate(b,{},o)/p,Et=(Ot-Je)/Si,f.setFauxFacadeOptions(!0,!0,Ze);const gn=N.layout.get("building-facade-window").evaluate(b,{},o);Ue=gn[0],qe=gn[1]}const jt=[],Lt=new kt(1/0,1/0),Ft=new kt(-1/0,-1/0),Gt=new kt(0,0);let Tt=0;for(const Si of B)if(Si.length>0){const gn=[];for(const Wn of Si){const xe=[];for(let we=Wn.length-1;we>=0;we--){const ut=Wn[we];xe.push({x:ut.x,y:ut.y}),Lt.x=Math.min(Lt.x,ut.x),Lt.y=Math.min(Lt.y,ut.y),Ft.x=Math.max(Ft.x,ut.x),Ft.y=Math.max(Ft.y,ut.y),Gt.x+=ut.x,Gt.y+=ut.y,Tt++}gn.push(xe)}jt.push({id:b.id?b.id:0,height:K,minHeight:X,sourceId:0,roofType:Y,coordinates:gn})}Gt.x/=Tt||1,Gt.y/=Tt||1;const Bt=f.generateMesh(jt,ke);if(typeof Bt=="string"){An(`Unable to generate building ${b.id}: ${Bt}`);continue}if(Bt.meshes.length===0||Bt.modifiedPolygonRings.length===0)continue;let ht=0;for(const Si of Bt.meshes)ht+=Si.positions.length/3;const at=_e?this.buildingWithFacade:this.buildingWithoutFacade,Ht=at.segmentsBucket.prepareSegment(ht,at.layoutVertexArray,at.indexArray),$t=[];let Vi=null,gi=0,Ci=-1;const Yt=at.indexArray.length;let Ni=0;for(const Si of Bt.meshes){const gn=at.layoutVertexArray.length;if(Si.buildingPart==="entrance"){const St=new Array;for(let ji=0;ji<Si.indices.length;ji+=12){const Ln=Si.positions[ji+0],zn=Si.positions[ji+1],En=Si.positions[ji+3],vr=Si.positions[ji+4],ts=Si.positions[ji+2],Sn=Si.positions[ji+8]-ts,Ur=1,Tr=En-Ln,cr=vr-zn,jr=Math.hypot(Tr,cr);St.push({pos:[Ln+.5*Tr,zn+.5*cr,ts],normal:[cr/jr,-Tr/jr,0],width:jr,height:Sn,depth:Ur,points:[Ln,zn,En,vr]})}const ri=at.entranceBloom.segmentsBucket.prepareSegment(10*St.length,at.entranceBloom.layoutVertexArray,at.entranceBloom.indexArray),ni=at.entranceBloom.layoutVertexArray.length;gi=at.entranceBloom.indexArray.length,PT(St,.5/this.tileToMeter,at.entranceBloom.indexArray,at.entranceBloom.layoutVertexArray,at.entranceBloom.layoutAttenuationArray);const xi=at.entranceBloom.layoutVertexArray.length-ni;Ci=at.entranceBloom.indexArray.length-gi;for(let ji=0;ji<xi;ji++)at.entranceBloom.layoutColorArray.emplaceBack(65535,65535);ri.vertexLength+=xi,ri.primitiveLength+=Ci,Vi={part:Si.buildingPart,vertexOffset:ni,vertexLength:xi}}for(let St=0;St<Si.positions.length;St+=3)Ni=Math.max(Ni,Si.positions[St+2]),at.layoutVertexArray.emplaceBack(Si.positions[St],Si.positions[St+1],Si.positions[St+2]);const Wn=Math.floor(Gt.x),xe=Math.floor(Gt.y),we=Math.floor(Ni);for(let St=0;St<Si.positions.length;St+=3)at.layoutCentroidArray.emplaceBack(Wn,xe,we);for(let St=0;St<Si.normals.length;St+=3)at.layoutNormalArray.emplaceBack(Si.normals[St+0]*Dx,Si.normals[St+1]*Dx,Si.normals[St+2]*Dx);for(let St=0;St<Si.ao.length;St++)at.layoutAOArray.push(Si.ao[St]);for(let St=0;St<Si.colors.length;St+=3){const ri=1+(Si.ao[St/3]-1)*ue;at.layoutColorArray.emplaceBack(Si.colors[St]*ri<<8|Si.colors[St+1]*ri,Si.colors[St+2]*ri<<8)}if(_e){for(let St=0;St<Si.positions.length;St+=3)at.layoutFacadePaintArray.emplaceBack(65535,255);for(let St=0;St<Si.isFauxFacade.length;St++)if(Si.isFauxFacade[St]){const ri=1|Math.min(65535,Math.floor(Si.uv[2*St]*Bt.outerRingLength)),ni=Math.floor(255*Ue)<<8|Math.floor(255*qe),xi=Math.floor(65535*Math.min(1,Ze/Zt)),ji=Math.floor(65535*Math.min(1,Et/Zt));at.layoutFacadeDataArray.emplaceBack(ri,ni,xi,ji);const Ln=Math.floor(65535*Math.min(1,Je/Zt)),zn=Math.floor(65535*Math.min(1,Ot/Zt));at.layoutFacadeVerticalRangeArray.emplaceBack(Ln,zn)}else at.layoutFacadeDataArray.emplaceBack(0,0,0,0),at.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const ut=Ht.vertexLength;for(let St=0;St<Si.indices.length;St+=3)at.indexArray.emplaceBack(ut+Si.indices[St],ut+Si.indices[St+1],ut+Si.indices[St+2]);Ht.vertexLength+=Si.positions.length/3,Ht.primitiveLength+=Si.indices.length/3,(Si.buildingPart==="roof"||Si.buildingPart==="wall"||Si.buildingPart==="facade_glazing"||Si.buildingPart==="entrance")&&$t.push({part:Si.buildingPart,vertexOffset:gn,vertexLength:Si.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Ni),this.buildingFeatures.push({feature:C,hasFauxFacade:_e,segment:Ht,parts:$t,buildingBloom:Vi});const ln=at.indexArray.length-Yt,oi=[],zi=[],tn=new kt(1/0,1/0),_n=new kt(-1/0,-1/0),On=this.groundEffect.vertexArray.length;for(const Si of Bt.modifiedPolygonRings){const gn=[],Wn=new kt(1/0,1/0),xe=new kt(-1/0,-1/0);for(let we=0;we<Si.length;we+=2){const ut=Si.length-we-2;Wn.x=Math.min(Wn.x,Si[ut]),Wn.y=Math.min(Wn.y,Si[ut+1]),xe.x=Math.max(xe.x,Si[ut]),xe.y=Math.max(xe.y,Si[ut+1]);const St=new kt(Si[ut],Si[ut+1]);gn.push(St),oi.push(St.x,St.y),zi.push(St.clone())}tn.x=Math.min(tn.x,Wn.x),tn.y=Math.min(tn.y,Wn.y),_n.x=Math.max(_n.x,xe.x),_n.y=Math.max(_n.y,xe.y),this.groundEffect.addData(gn,[Wn,xe],de)}const yn=this.groundEffect.vertexArray.length-On;(Lt.x<0||Ft.x>Zt||Lt.y<0||Ft.y>Zt)&&this.featuresOnBorder.push({featureId:b.id,footprintIndex:this.footprints.length});{const Si=Nf(oi,null,2),gn=new Pg(zi,Si,8,256);let Wn=b.id;b.properties&&b.properties.hasOwnProperty("building_id")&&(Wn=b.properties.building_id),this.footprints.push({vertices:zi,indices:Si,grid:gn,min:tn,max:_n,buildingId:Wn,hiddenFlags:0,indicesOffset:Yt,indicesLength:ln,bloomIndicesOffset:gi,bloomIndicesLength:Ci,groundEffectVertexOffset:On,groundEffectVertexLength:yn,hasFauxFacade:_e,segment:Ht,height:Ni})}this.programConfigurations.populatePaintArrays(at.layoutVertexArray.length,b,T,{},i.availableImages,o,i.brightness),this.groundEffect.addPaintPropertiesData(b,T,{},i.availableImages,o,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,o,c,f,p,v){this.programConfigurations.updatePaintArrays(e,i,f,o,c,p,v),this.groundEffect.update(e,i,f,o,c,p,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=o=>{o.layoutVertexBuffer=e.createVertexBuffer(o.layoutVertexArray,CT.members),o.layoutNormalBuffer=e.createVertexBuffer(o.layoutNormalArray,IO.members),o.layoutCentroidBuffer=e.createVertexBuffer(o.layoutCentroidArray,PO.members),o.layoutFacadeDataArray&&o.layoutFacadeDataArray.length&&(o.layoutFacadeDataBuffer=e.createVertexBuffer(o.layoutFacadeDataArray,MO.members)),o.layoutFacadeVerticalRangeArray&&o.layoutFacadeVerticalRangeArray.length&&(o.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(o.layoutFacadeVerticalRangeArray,RO.members)),o.entranceBloom.layoutVertexArray.length&&(o.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(o.entranceBloom.layoutVertexArray,CT.members),o.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(o.entranceBloom.layoutAttenuationArray,OO.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,o=!0){let c=!1;const f=o?i:0,p=0|(o?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const b=this.footprints[v],T=b.hiddenFlags&p|f;b.hiddenFlags!==T&&(b.hiddenFlags=T,c=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return c&&(this.indexArrayForConflationUploaded=!1),c}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=c=>{c.indexArray.length!==0&&(c.indexArrayForConflation.resize(c.indexArray.length),c.indexArrayForConflation.uint16.set(c.indexArray.uint16),c.entranceBloom.indexArrayForConflation.resize(c.entranceBloom.indexArray.length),c.entranceBloom.indexArrayForConflation.uint16.set(c.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const c of this.footprints){const f=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,p=c.indicesOffset+c.indicesLength;if(c.hiddenFlags!==0){for(let b=c.indicesOffset;b<p;b++)f.indexArrayForConflation.uint16[3*b+0]=0,f.indexArrayForConflation.uint16[3*b+1]=0,f.indexArrayForConflation.uint16[3*b+2]=0;const v=c.bloomIndicesOffset+c.bloomIndicesLength;for(let b=c.bloomIndicesOffset;b<v;b++)f.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,f.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,f.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}const o=c=>{c.indexArray.length!==0&&(c.indexBuffer?c.indexBuffer.updateData(c.indexArrayForConflation):c.indexBuffer=e.createIndexBuffer(c.indexArrayForConflation,!0),c.entranceBloom.indexBuffer?c.entranceBloom.indexBuffer.updateData(c.entranceBloom.indexArrayForConflation):c.entranceBloom.indexBuffer=e.createIndexBuffer(c.entranceBloom.indexArrayForConflation,!0))};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=o=>{o.layoutColorBuffer?o.layoutColorBuffer.updateData(o.layoutColorArray):o.layoutColorBuffer=e.createVertexBuffer(o.layoutColorArray,MT.members,!0),o.layoutFacadePaintArray&&(o.layoutFacadePaintBuffer?o.layoutFacadePaintBuffer.updateData(o.layoutFacadePaintArray):o.layoutFacadePaintBuffer=e.createVertexBuffer(o.layoutFacadePaintArray,CO.members,!0)),o.entranceBloom.layoutColorBuffer?o.entranceBloom.layoutColorBuffer.updateData(o.entranceBloom.layoutColorArray):o.entranceBloom.layoutColorBuffer=e.createVertexBuffer(o.entranceBloom.layoutColorArray,MT.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const o=e.paint.get("building-ambient-occlusion-intensity");for(const c of this.buildingFeatures){const f=i[c.feature.id],p=c.feature;p.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="wall";const T=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="window";const C=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),O=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical);p.properties["building-part"]="door";const B=e.paint.get("building-color").evaluate(p,f,this.canonical).toPremultipliedRenderColor(this.lut),N=e.paint.get("building-emissive-strength").evaluate(p,f,this.canonical),X=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Y of c.parts){let ue,de=v;Y.part==="roof"?(de=v,ue=b):Y.part==="wall"?(de=T,ue=I):Y.part==="facade_glazing"?(de=C,ue=O):Y.part==="entrance"&&(de=B,ue=N),ue=Le(ue,0,1);for(let _e=0;_e<Y.vertexLength;_e++){const ze=Y.vertexOffset+_e,ke=1+(X.layoutAOArray[ze]-1)*o;X.layoutColorArray.emplace(ze,de.r*ke*255<<8|de.g*ke*255,de.b*ke*255<<8|255*ue),c.hasFauxFacade&&X.layoutFacadePaintArray.emplace(ze,255*C.r<<8|255*C.g,255*C.b<<8|255*O)}}const K=c.buildingBloom;if(K)for(let Y=0;Y<K.vertexLength;Y++)X.entranceBloom.layoutColorArray.emplace(K.vertexOffset+Y,255*B.r<<8|255*B.g,255*B.b<<8|51*N)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(Mg(this.activeReplacements,c))return;this.activeReplacements=c;for(const p of this.footprints)p.hiddenFlags&=-2;const f=[];for(const p of this.activeReplacements){if(p.order<=F1)continue;const v=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const b of this.footprints)b.min.x>p.max.x||b.max.x<p.min.x||b.min.y>p.max.y||b.max.y<p.min.y||(f.length=0,DO(b.vertices,0,b.vertices.length,p.footprintTileId.canonical,e.canonical,f),mx(p.footprint,f,b.indices,0,b.indices.length,0,-v)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(p.groundEffectVertexOffset,p.groundEffectVertexLength,p.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,c=!0;const f=4*(e+Zt)*Zt+(i+Zt);if(this.footprintLookup.hasOwnProperty(f)){const v=this.footprintLookup[f];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const p=new kt(e,i);for(const v of this.footprints)e>v.max.x||v.min.x>e||i>v.max.y||v.min.y>i||v.height<=o||_x(p,v)&&(o=v.height,this.footprintLookup[f]=v,c=v.hiddenFlags!==0);if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.footprintLookup[f]=void 0}}function DO(n,e,i,o,c,f){const p=Math.pow(2,o.z-c.z);for(let v=0;v<i;v++){let b=n[v+e].x,T=n[v+e].y;b=(b+c.x*Zt)*p-o.x*Zt,T=(T+c.y*Zt)*p-o.y*Zt,f.push(new kt(b,T))}}let DT,zT;yi(LT,"BuildingBucket",{omit:["layers"]}),yi(zx,"BuildingGeometry"),yi(OT,"BuildingBloomGeometry");const zO=qn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),kO=qn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:FO}=zO,BO=qn([{name:"a_packed",components:3,type:"Float32"}]),{members:NO}=BO,UO=qn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:VO}=UO;class kT{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Ph({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=wi(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const c=[];let f=e.length%2==1?-e[e.length-1]*o:0,p=e[0]*o,v=!0;c.push({left:f,right:p,isDash:v,zeroLength:e[0]===0});let b=e[0];for(let T=1;T<e.length;T++){v=!v;const I=e[T];f=b*o,b+=I,p=b*o,c.push({left:f,right:p,isDash:v,zeroLength:I===0})}return c}addRoundDash(e,i,o){const c=i/2;for(let f=-o;f<=o;f++){const p=this.width*(this.nextRow+o+f);let v=0,b=e[v];for(let T=0;T<this.width;T++){T/b.right>1&&(b=e[++v]);const I=Math.abs(T-b.left),C=Math.abs(T-b.right),O=Math.min(I,C);let B;const N=f/o*(c+1);if(b.isDash){const X=c-Math.abs(N);B=Math.sqrt(O*O+X*X)}else B=c-Math.sqrt(O*O+N*N);this.image.data[p+T]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const T=e[b],I=e[b+1];T.zeroLength?e.splice(b,1):I&&I.isDash===T.isDash&&(I.left=T.left,e.splice(b,1))}const o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);const f=this.width*this.nextRow;let p=0,v=e[p];for(let b=0;b<this.width;b++){b/v.right>1&&(v=e[++p]);const T=Math.abs(b-v.left),I=Math.abs(b-v.right),C=Math.min(T,I);this.image.data[f+b]=Math.max(0,Math.min(255,(v.isDash?C:-C)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const c=i==="round",f=c?7:0,p=2*f+1;if(this.nextRow+p>this.height)return An("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let I=0;I<e.length;I++)e[I]<0&&(An("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),v+=e[I];if(v!==0){const I=this.width/v,C=this.getDashRanges(e,this.width,I);c?this.addRoundDash(C,I,f):this.addRegularDash(C,i==="square"?.5*I:0)}const b=this.nextRow+f;this.nextRow+=p;const T={tl:[b,f],br:[v,0]};return this.positions[o]=T,T}}yi(kT,"LineAtlas");const jO=Ut.types,$O=Math.cos(Math.PI/180*37.5),qO=Math.cos(Math.PI/180*5);class kx{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new If,this.layoutVertexArray2=new Ta,this.patternVertexArray=new Ta,this.indexArray=new co,this.programConfigurations=new yl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new cs,this.maxLineLength=0,this.zOffsetVertexArray=new Ta,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Zt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,c){this.hasPattern=cx("line",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=et(o);const p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{const O=this.layers[0].layout.get("line-z-offset"),B=O.isConstant()&&!O.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&p==="none"&&An(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const b=[];for(const{feature:O,id:B,index:N,sourceLayerIndex:X}of e){const K=this.layers[0]._featureFilter.needGeometry,Y=qt(O,K);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom,{worldview:this.worldview}),Y,o))continue;const ue=f?f.evaluate(Y,{},o):void 0,de={id:B,properties:O.properties,type:O.type,sourceLayerIndex:X,index:N,geometry:K?Y.geometry:hi(O,o,c),patterns:{},sortKey:ue};b.push(de)}f&&b.sort(((O,B)=>O.sortKey-B.sortKey));const{lineAtlas:T,featureIndex:I}=i,C=this.addConstantDashes(T);for(const O of b){const{geometry:B,index:N,sourceLayerIndex:X}=O;if(C&&this.addFeatureDashes(O,T),this.hasPattern){const K=ux("line",this.layers,O,this.zoom,this.pixelRatio,i);this.patternFeatures.push(K)}else this.addFeature(O,B,N,o,T.positions,i.availableImages,i.brightness,i.elevationFeatures);I.insert(e[N].feature,B,N,X,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,f=o.layout.get("line-cap").value;if(c.kind!=="constant"||f.kind!=="constant")i=!0;else{const p=f.value,v=c.value;if(!v)continue;e.addDash(v,p)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const c of this.layers){const f=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(f.kind==="constant"&&p.kind==="constant")continue;let v,b;if(f.kind==="constant"){if(v=f.value,!v)continue}else v=f.evaluate({zoom:o},e);b=p.kind==="constant"?p.value:p.evaluate({zoom:o},e),i.addDash(v,b),e.patterns[c.id]=[i.getKey(v,b)]}}update(e,i,o,c,f,p,v,b){this.programConfigurations.updatePaintArrays(e,i,f,o,c,p,v,b)}addFeatures(e,i,o,c,f,p){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,o,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,NO)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,VO)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,kO.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,FO),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let o,c;if(i&&i>0?(o=`mapbox_clip_start_${i}`,c=`mapbox_clip_end_${i}`):(o="mapbox_clip_start",c="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(o)&&e.properties.hasOwnProperty(c))return{start:+e.properties[o],end:+e.properties[c]}}addFeature(e,i,o,c,f,p,v,b){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),C=T.get("line-cap").evaluate(e,{}),O=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const N=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=T.get("line-z-offset").value;const X=this.layers[0].paint.get("line-width").value;if(X.kind!=="constant"&&X.isLineProgressConstant===!1&&(this.variableWidthValue=X),this.elevationType==="road"){const K=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,c,b,I,C,O,B)){const[Y,ue]=this.clipRuntimeLinesToTile(i,1);for(let de=0;de<Y.length;de++){const _e=Y[de],ze=ue[de],ke={progress:{min:ze.progress.min,max:ze.progress.max},nextDir:this.computeSegNextDir(ze,_e),prevDir:this.computeSegPrevDir(ze,_e)};this.addLine(_e,e,c,I,C,O,B,ke,N&&ze.parentIndex>0?ze.parentIndex:null)}this.fillNonElevatedRoadSegment(K)}}else for(let K=0;K<i.length;K++)this.addLine(i[K],e,c,I,C,O,B,void 0,N&&K>0?K:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,f,p,c,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Lg(e,-i,-i,Zt+i,Zt+i)}clipRuntimeLinesToTile(e,i){const o=[];return[Lg(e,-i,-i,Zt+i,Zt+i,o),o]}addElevatedRoadFeature(e,i,o,c,f,p,v,b){const T=[],I=os.getElevationFeature(e,c);if(I){const C=this.clipLinesToTile(i,1),O=this.prepareElevatedLines(C,I,o);for(const B of O)T.push({geometry:B,elevation:I,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const C of T){const O=this.layoutVertexArray.length;this.addLine(C.geometry,e,o,f,p,v,b);const B=new Zs(o,C.elevationTileID);if(C.elevation)for(let N=O;N<this.layoutVertexArray.length;N++){const X=new kt(this.layoutVertexArray.int16[6*N]>>1,this.layoutVertexArray.int16[6*N+1]>>1),K=B.pointElevation(X,C.elevation,.05);this.updateHeightRange(K),this.zOffsetVertexArray.emplaceBack(K,0,0)}else this.fillNonElevatedRoadSegment(O)}return!0}prepareElevatedLines(e,i,o){if(i.constantHeight!=null)return e;const c=[],f=1/et(o);for(const p of e)nO(p,new yr(i,f),0,c);return c}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,o,c,f,p,v,b,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=T?this.lineFeatureClips(i,T):this.lineClips;const I=c==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=b&&b.progress.min>0,O=b&&b.progress.max<1;if(this.lineClips){let Ze={min:this.lineClips.start,max:this.lineClips.end},Et=1;if(b){const jt=this.lineClips.end-this.lineClips.start;Ze=(function(Lt,Ft,Gt){return{min:Hn(Lt.min,Ft,Gt),max:Hn(Lt.max,Ft,Gt)}})(b.progress,{min:0,max:1},Ze),jt>0&&(Et=(Ze.max-Ze.min)/jt)}const Je=+i.properties.mapbox_clip_feature_len,Ot=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Je)||Number.isNaN(Ot)){for(let Lt=0;Lt<e.length-1;Lt++)this.totalDistance+=e[Lt].dist(e[Lt+1]);const jt=this.totalDistance/(Ze.max-Ze.min);this.totalFeatureLength=Number.isFinite(jt)?jt:0,this.lineClips.start=Ze.min,this.lineClips.end=Ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Je,this.distance=Ot*Et,this.lineClips.start=Ze.min,this.lineClips.end=Ze.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const B=jO[i.type]==="Polygon";let N=e.length;for(;N>=2&&e[N-1].equals(e[N-2]);)N--;let X=0;for(;X<N-1&&e[X].equals(e[X+1]);)X++;if(N<(B?3:2))return;c==="bevel"&&(p=1.05);const K=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let Y,ue,de,_e,ze,ke,Ue,qe;b&&b.prevDir&&(ke=b.prevDir.perp()),b&&b.nextDir&&(Ue=b.nextDir.perp()),this.e1=this.e2=-1,B&&(Y=e[N-2],ze=e[X].sub(Y)._unit()._perp());for(let Ze=X;Ze<N;Ze++){if(de=Ze===N-1?B?e[X+1]:void 0:e[Ze+1],de&&e[Ze].equals(de))continue;ze&&(_e=ze),Y&&(ue=Y),Y=e[Ze],qe=this.evaluateLineProgressFeatures(ue?ue.dist(Y):0),ze=de?de.sub(Y)._unit()._perp():_e,_e=_e||ze;const Et=ue&&de;let Je=Et?c:B||I?"butt":f;const Ot=_e.x*ze.x+_e.y*ze.y;if(I){const at=function(Ht){if(Ht.patternJoinNone){const $t=Ht.segmentPoints.length/2,Vi=Ht.lineSoFar-Ht.segmentStart;for(let gi=0;gi<$t;++gi){const Ci=Ht.segmentPoints[2*gi+1],Yt=Math.round(Ht.segmentPoints[2*gi])+.5+.25*Ci;Ht.patternVertexArray.emplaceBack(Yt,Vi,Ht.segmentStart),Ht.patternVertexArray.emplaceBack(Yt,Vi,Ht.segmentStart)}Ht.segmentPoints.length=0}Ht.e1=Ht.e2=-1};if(Et&&Ot<qO){this.updateDistance(ue,Y),this.addCurrentVertex(Y,_e,1,1,K,qe),at(this),this.addCurrentVertex(Y,ze,-1,-1,K,qe);continue}if(ue){if(!de){this.updateDistance(ue,Y),this.addCurrentVertex(Y,_e,1,1,K,qe),at(this);continue}Je="miter"}}let jt=_e.add(ze);jt.x===0&&jt.y===0||jt._unit();const Lt=jt.x*ze.x+jt.y*ze.y,Ft=Lt!==0?1/Lt:1/0,Gt=2*Math.sqrt(2-2*Lt),Tt=Lt<$O&&ue&&de,Bt=_e.x*ze.y-_e.y*ze.x>0,ht=this.overscaling<=16?15*Zt/(512*this.overscaling):0;if(Et&&Je==="round"){if(Ft<v)Je="miter";else if(Ft<=2){const at=Fx(Y,-10,Zt+10);Je=this.elevationType==="offset"&&(at||this.hasCrossSlope)?"miter":"fakeround"}}if(Je==="miter"&&Ft>p&&(Je="bevel"),Je==="bevel"&&(Ft>2&&(Je="flipbevel"),Ft<p&&(Je="miter")),ue&&!(Je==="miter"&&Tt)&&this.updateDistance(ue,Y),Je==="miter")if(Tt){const at=Y.dist(ue);if(at>2*ht){const $t=Y.sub(Y.sub(ue)._mult(ht/at)._round());this.updateDistance(ue,$t),this.addCurrentVertex($t,_e,0,0,K,qe),ue=$t}this.updateDistance(ue,Y),jt._mult(Ft),this.addCurrentVertex(Y,jt,0,0,K,qe);const Ht=Y.dist(de);if(Ht>2*ht){const $t=Y.add(de.sub(Y)._mult(ht/Ht)._round());this.updateDistance(Y,$t),this.addCurrentVertex($t,ze,0,0,K,qe),Y=$t}}else jt._mult(Ft),this.addCurrentVertex(Y,jt,0,0,K,qe);else if(Je==="flipbevel"){if(Ft>100)jt=ze.mult(-1);else{const at=Ft*_e.add(ze).mag()/_e.sub(ze).mag();jt._perp()._mult(at*(Bt?-1:1))}this.addCurrentVertex(Y,jt,0,0,K,qe),this.addCurrentVertex(Y,jt.mult(-1),0,0,K,qe)}else if(Je==="bevel"||Je==="fakeround"){qe!=null&&ue&&this.addCurrentVertex(Y,Ue||_e,-1,-1,K,qe);const at=Y.dist(ue)<=2*ht&&Je!=="bevel",Ht=jt.mult(Bt?1:-1);Ht._mult(Ft);const $t=ze.mult(Bt?-1:1),Vi=_e.mult(Bt?-1:1),gi=this.evaluateLineProgressFeatures(this.distance);if(qe==null&&(this.addHalfVertex(Y,Ht.x,Ht.y,!1,!Bt,0,K,gi),at||this.addHalfVertex(Y,Ht.x+2*Vi.x,Ht.y+2*Vi.y,!1,Bt,0,K,gi)),Je==="fakeround"){const Ci=Math.round(180*Gt/Math.PI/20);this.addHalfVertex(Y,Vi.x,Vi.y,!1,Bt,0,K,gi);for(let Yt=0;Yt<Ci;Yt++){let Ni=Yt/Ci;if(Ni!==.5){const oi=Ni-.5;Ni+=Ni*oi*(Ni-1)*((1.0904+Ot*(Ot*(3.55645-1.43519*Ot)-3.2452))*oi*oi+(.848013+Ot*(.215638*Ot-1.06021)))}const ln=$t.sub(Vi)._mult(Ni)._add(Vi)._unit();this.addHalfVertex(Y,ln.x,ln.y,!1,Bt,0,K,gi)}this.addHalfVertex(Y,$t.x,$t.y,!1,Bt,0,K,gi)}at||qe!=null||this.addHalfVertex(Y,Ht.x+2*$t.x,Ht.y+2*$t.y,!1,Bt,0,K,gi),qe!=null&&de&&this.addCurrentVertex(Y,ke||ze,1,1,K,qe)}else if(Je==="butt")this.addCurrentVertex(Y,jt,0,0,K,qe);else if(Je==="square"){if(!ue){const at=C?0:-1;this.addCurrentVertex(Y,jt,at,at,K,qe)}if(this.addCurrentVertex(Y,jt,0,0,K,qe),ue){const at=O?0:1;this.addCurrentVertex(Y,jt,at,at,K,qe)}}else if(Je==="round"){if(ue){const at=!Et&&Ue?Ue:_e;this.addCurrentVertex(Y,at,0,0,K,qe),!Et&&O||this.addCurrentVertex(Y,at,1,1,K,qe,!0)}if(de){const at=!Et&&ke?ke:ze;!Et&&C||this.addCurrentVertex(Y,at,-1,-1,K,qe,!0),this.addCurrentVertex(Y,at,0,0,K,qe)}}}}addVerticesTo(e,i,o,c,f,p,v,b,T,I){const C=(i.w-e.w)/this.tessellationStep|0;let O=0;const B=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const X=(i.x-e.x)/C,K=(i.y-e.y)/C,Y=(i.z-e.z)/C,ue=(i.w-e.w)/C;for(let de=1;de<C;++de){e.x+=X,e.y+=K,e.z+=Y,this.lineSoFar+=ue,O+=ue;const _e=this.evaluateLineProgressFeatures(this.prevDistance+O);this.scaledDistance=(this.prevDistance+O)/this.totalDistance,this.addHalfVertex(e,o,c,I,!1,v,T,_e),this.addHalfVertex(e,f,p,I,!0,-b,T,_e)}}this.lineSoFar=i.w,this.scaledDistance=B;const N=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,c,I,!1,v,T,N),this.addHalfVertex(i,f,p,I,!0,-b,T,N)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):An(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,o,c,f,p,v=!1){const b=i.x+i.y*o,T=i.y-i.x*o,I=i.y*c-i.x,C=-i.y-i.x*c;if(p!=null){const O=this.elevationType==="offset",B=-10,N=Zt+10,X=p.zOffset,K=new rT(e.x,e.y,X,this.lineSoFar),Y=!!O&&Fx(e,B,N),ue=this.lineSoFar,de=this.distance;if(this.currentVertex)if(Y){const _e=this.currentVertexIsOutside,ze=this.currentVertex,ke=new rT(e.x,e.y,X,this.lineSoFar);if(oT(ze,ke,B,N),!Fx(ke,B,N)){if(_e){this.e1=this.e2=-1,this.distance-=ze.dist(K),this.lineSoFar=ze.w;const Ue=this.evaluateLineProgressFeatures(ze.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ze,b,T,v,!1,o,f,Ue),this.addHalfVertex(ze,I,C,v,!0,-c,f,Ue),this.prevDistance=this.distance}this.distance=this.prevDistance+ze.dist(ke),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ze,ke,b,T,I,C,o,c,f,v),this.distance=de,this.scaledDistance=this.distance/this.totalDistance}}else{const _e=this.currentVertex;if(this.currentVertexIsOutside){oT(_e,K,B,N),this.e1=this.e2=-1,this.distance-=_e.dist(K),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=_e.w;const ze=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,b,T,v,!1,o,f,ze),this.addHalfVertex(_e,I,C,v,!0,-c,f,ze),this.prevDistance=this.distance,this.distance=de,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(_e,K,b,T,I,C,o,c,f,v)}else Y||(this.addHalfVertex(e,b,T,v,!1,o,f,p),this.addHalfVertex(e,I,C,v,!0,-c,f,p));this.currentVertex=K,this.currentVertexIsOutside=Y,this.lineSoFar=ue}else this.addHalfVertex(e,b,T,v,!1,o,f,p),this.addHalfVertex(e,I,C,v,!0,-c,f,p)}addHalfVertex({x:e,y:i},o,c,f,p,v,b,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=Mi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),p?this.e2=I:this.e1=I,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Fx(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let FT,BT;function NT(n,e,i){return e*(Zt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}yi(kx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const UT=(n,e,i)=>(1-i)*n+i*e;function VT(n,e){return 1/NT(n,1,e.tileZoom)}function jT(n,e,i,o){return n.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const $T=n=>{const e=[];qT(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=n.layout.get("line-join").constantOr("miter")==="none",c=!!n.paint.get("line-pattern").constantOr(1);return o&&c&&e.push("LINE_JOIN_NONE"),e};function qT(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Bx;const GT=()=>Bx||(Bx={layout:FT||(FT=new xs({"line-cap":new li(Ye.layout_line["line-cap"]),"line-join":new li(Ye.layout_line["line-join"]),"line-miter-limit":new Wt(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Wt(Ye.layout_line["line-round-limit"]),"line-sort-key":new li(Ye.layout_line["line-sort-key"]),"line-z-offset":new li(Ye.layout_line["line-z-offset"]),"line-elevation-reference":new Wt(Ye.layout_line["line-elevation-reference"]),"line-cross-slope":new Wt(Ye.layout_line["line-cross-slope"]),visibility:new Wt(Ye.layout_line.visibility),"line-width-unit":new Wt(Ye.layout_line["line-width-unit"])})),paint:BT||(BT=new xs({"line-opacity":new li(Ye.paint_line["line-opacity"]),"line-color":new li(Ye.paint_line["line-color"]),"line-translate":new Wt(Ye.paint_line["line-translate"]),"line-translate-anchor":new Wt(Ye.paint_line["line-translate-anchor"]),"line-width":new li(Ye.paint_line["line-width"]),"line-gap-width":new li(Ye.paint_line["line-gap-width"]),"line-offset":new li(Ye.paint_line["line-offset"]),"line-blur":new li(Ye.paint_line["line-blur"]),"line-dasharray":new li(Ye.paint_line["line-dasharray"]),"line-pattern":new li(Ye.paint_line["line-pattern"]),"line-pattern-cross-fade":new Wt(Ye.paint_line["line-pattern-cross-fade"]),"line-gradient":new _h(Ye.paint_line["line-gradient"]),"line-trim-offset":new Wt(Ye.paint_line["line-trim-offset"]),"line-trim-fade-range":new Wt(Ye.paint_line["line-trim-fade-range"]),"line-trim-color":new Wt(Ye.paint_line["line-trim-color"]),"line-emissive-strength":new Wt(Ye.paint_line["line-emissive-strength"]),"line-border-width":new li(Ye.paint_line["line-border-width"]),"line-border-color":new li(Ye.paint_line["line-border-color"]),"line-occlusion-opacity":new Wt(Ye.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},Bx);class GO extends li{possiblyEvaluate(e,i){return i=new Nr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,c){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,c)}}let Lm;function HT(n,e){return e>0?e+2*n:n}const HO=qn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ZO=qn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),WO=qn([{name:"a_projected_pos",components:4,type:"Float32"}],4);qn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const XO=qn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),KO=qn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),YO=qn([{name:"a_texb",components:2,type:"Uint16"}]),JO=qn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),QO=qn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ZT=qn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),eL=qn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);qn([{name:"triangle",components:3,type:"Uint16"}]),qn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),qn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),qn([{type:"Float32",name:"offsetX"}]),qn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Lo=24;function tL(n,e,i){return n.sections.forEach((o=>{o.text=(function(c,f,p){const v=f.layout.get("text-transform").evaluate(p,{});return v==="uppercase"?c=c.toLocaleUpperCase():v==="lowercase"&&(c=c.toLocaleLowerCase()),kl.applyArabicShaping&&(c=kl.applyArabicShaping(c)),c})(o.text,e,i)})),n}const Dm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function iL(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function nL(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const Nx=4294967296,WT=1/Nx,XT=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Vg=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,i=this.length){for(;this.pos<i;){const o=this.readVarint(),c=o>>3,f=this.pos;this.type=7&o,n(c,e,this),this.pos===f&&this.skip(o)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Nx;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Nx;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let i,o;return o=e[this.pos++],i=127&o,o<128?i:(o=e[this.pos++],i|=(127&o)<<7,o<128?i:(o=e[this.pos++],i|=(127&o)<<14,o<128?i:(o=e[this.pos++],i|=(127&o)<<21,o<128?i:(o=e[this.pos],i|=(15&o)<<28,(function(c,f,p){const v=p.buf;let b,T;if(T=v[p.pos++],b=(112&T)>>4,T<128||(T=v[p.pos++],b|=(127&T)<<3,T<128)||(T=v[p.pos++],b|=(127&T)<<10,T<128)||(T=v[p.pos++],b|=(127&T)<<17,T<128)||(T=v[p.pos++],b|=(127&T)<<24,T<128)||(T=v[p.pos++],b|=(1&T)<<31,T<128))return Hf(c,b,f);throw new Error("Expected varint not more than 10 bytes")})(i,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&XT?XT.decode(this.buf.subarray(e,n)):(function(i,o,c){let f="",p=o;for(;p<c;){const v=i[p];let b,T,I,C=null,O=v>239?4:v>223?3:v>191?2:1;if(p+O>c)break;O===1?v<128&&(C=v):O===2?(b=i[p+1],(192&b)==128&&(C=(31&v)<<6|63&b,C<=127&&(C=null))):O===3?(b=i[p+1],T=i[p+2],(192&b)==128&&(192&T)==128&&(C=(15&v)<<12|(63&b)<<6|63&T,(C<=2047||C>=55296&&C<=57343)&&(C=null))):O===4&&(b=i[p+1],T=i[p+2],I=i[p+3],(192&b)==128&&(192&T)==128&&(192&I)==128&&(C=(15&v)<<18|(63&b)<<12|(63&T)<<6|63&I,(C<=65535||C>=1114112)&&(C=null))),C===null?(C=65533,O=1):C>65535&&(C-=65536,f+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),f+=String.fromCharCode(C),p+=O}return f})(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const i=this.readPackedEnd();for(;this.pos<i;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*WT),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*WT),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?(function(e,i){let o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(o=~(-e%4294967296),c=~(-e/4294967296),4294967295^o?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(f,p,v){v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,f>>>=7,v.buf[v.pos++]=127&f|128,v.buf[v.pos]=127&(f>>>=7)})(o,0,i),(function(f,p){const v=(7&f)<<4;p.buf[p.pos++]|=v|((f>>>=3)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f|((f>>>=7)?128:0),f&&(p.buf[p.pos++]=127&f)))))})(c,i)})(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=(function(o,c,f){for(let p,v,b=0;b<c.length;b++){if(p=c.charCodeAt(b),p>55295&&p<57344){if(!v){p>56319||b+1===c.length?(o[f++]=239,o[f++]=191,o[f++]=189):v=p;continue}if(p<56320){o[f++]=239,o[f++]=191,o[f++]=189,v=p;continue}p=v-55296<<10|p-56320|65536,v=null}else v&&(o[f++]=239,o[f++]=191,o[f++]=189,v=null);p<128?o[f++]=p:(p<2048?o[f++]=p>>6|192:(p<65536?o[f++]=p>>12|224:(o[f++]=p>>18|240,o[f++]=p>>12&63|128),o[f++]=p>>6&63|128),o[f++]=63&p|128)}return f})(this.buf,n,this.pos);const i=this.pos-e;i>=128&&KT(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=n[i]}writeRawMessage(n,e){this.pos++;const i=this.pos;n(e,this);const o=this.pos-i;o>=128&&KT(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeMessage(n,e,i){this.writeTag(n,2),this.writeRawMessage(e,i)}writePackedVarint(n,e){e.length&&this.writeMessage(n,rL,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,sL,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,lL,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,oL,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,aL,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,cL,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,uL,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,hL,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,dL,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function Hf(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function KT(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let c=i.pos-1;c>=n;c--)i.buf[c+o]=i.buf[c]}function rL(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function sL(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function oL(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function aL(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function lL(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function cL(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function uL(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function hL(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function dL(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}const Ux=3;function fL(n,e,i){e.glyphs=[],n===1&&i.readMessage(pL,e)}function pL(n,e,i){if(n===3){const{id:o,bitmap:c,width:f,height:p,left:v,top:b,advance:T}=i.readMessage(mL,{});e.glyphs.push({id:o,bitmap:new Ph({width:f+2*Ux,height:p+2*Ux},c),metrics:{width:f,height:p,left:v,top:b,advance:T}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function mL(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const YT=Ux,Xa={horizontal:1,vertical:2,horizontalOnly:3};class zm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new zm;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new zm;return i.image=e,i}}class Zf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,o){const c=new Zf;for(let f=0;f<e.sections.length;f++){const p=e.sections[f];p.image?c.addImageSection(p,o):c.addTextSection(p,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,o){let c="";for(let f=0;f<i.length;f++){const p=i.charCodeAt(f+1)||null,v=i.charCodeAt(f-1)||null;c+=!o&&(p&&xf(p)&&!Dm[i[f+1]]||v&&xf(v)&&!Dm[i[f-1]])||!Dm[i[f]]?i[f]:Dm[i[f]]}return c})(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&jg[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&jg[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Zf;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(zm.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e,i){const o=e.image?e.image.getPrimary():null;if(!o)return void An("Can't add FormattedSection with an empty image.");o.scaleSelf(i);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(zm.forImage(o)),this.sectionIndex.push(this.sections.length-1)):An("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Vx(n,e,i,o,c,f,p,v,b,T,I,C,O,B,N,X=1){const K=Zf.fromFeature(n,c,X);C===Xa.vertical&&K.verticalizePunctuation(O);let Y=[];const ue=(function(Ue,qe,Ze,Et,Je,Ot){if(!Ue)return[];const jt=[],Lt=(function(Bt,ht,at,Ht,$t,Vi){let gi=0;for(let Ci=0;Ci<Bt.length();Ci++){const Yt=Bt.getSection(Ci);gi+=JT(Bt.getCodePoint(Ci),Yt,Ht,$t,ht,Vi)}return gi/Math.max(1,Math.ceil(gi/at))})(Ue,qe,Ze,Et,Je,Ot),Ft=Ue.text.indexOf("")>=0;let Gt=0;for(let Bt=0;Bt<Ue.length();Bt++){const ht=Ue.getSection(Bt),at=Ue.getCodePoint(Bt);if(jg[at]||(Gt+=JT(at,ht,Et,Je,qe,Ot)),Bt<Ue.length()-1){const Ht=!((Tt=at)<11904||!(Yi["Bopomofo Extended"](Tt)||Yi.Bopomofo(Tt)||Yi["CJK Compatibility Forms"](Tt)||Yi["CJK Compatibility Ideographs"](Tt)||Yi["CJK Compatibility"](Tt)||Yi["CJK Radicals Supplement"](Tt)||Yi["CJK Strokes"](Tt)||Yi["CJK Symbols and Punctuation"](Tt)||Yi["CJK Unified Ideographs Extension A"](Tt)||Yi["CJK Unified Ideographs"](Tt)||Yi["Enclosed CJK Letters and Months"](Tt)||Yi["Halfwidth and Fullwidth Forms"](Tt)||Yi.Hiragana(Tt)||Yi["Ideographic Description Characters"](Tt)||Yi["Kangxi Radicals"](Tt)||Yi["Katakana Phonetic Extensions"](Tt)||Yi.Katakana(Tt)||Yi["Vertical Forms"](Tt)||Yi["Yi Radicals"](Tt)||Yi["Yi Syllables"](Tt)));(_L[at]||Ht||ht.image)&&jt.push(eS(Bt+1,Gt,Lt,jt,gL(at,Ue.getCodePoint(Bt+1),Ht&&Ft),!1))}}var Tt;return tS(eS(Ue.length(),Gt,Lt,jt,0,!0))})(K,T,f,e,o,B),{processBidirectionalText:de,processStyledBidirectionalText:_e}=kl;if(de&&K.sections.length===1){const Ue=de(K.toString(),ue);for(const qe of Ue){const Ze=new Zf;Ze.text=qe,Ze.sections=K.sections;for(let Et=0;Et<qe.length;Et++)Ze.sectionIndex.push(0);Y.push(Ze)}}else if(_e){const Ue=_e(K.text,K.sectionIndex,ue);for(const qe of Ue){const Ze=new Zf;Ze.text=qe[0],Ze.sectionIndex=qe[1],Ze.sections=K.sections,Y.push(Ze)}}else Y=(function(Ue,qe){const Ze=[],Et=Ue.text;let Je=0;for(const Ot of qe)Ze.push(Ue.substring(Je,Ot)),Je=Ot;return Je<Et.length&&Ze.push(Ue.substring(Je,Et.length)),Ze})(K,ue);const ze=[],ke={positionedLines:ze,text:K.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ue,qe,Ze,Et,Je,Ot,jt,Lt,Ft,Gt,Tt,Bt){let ht=0,at=0,Ht=0;const $t=Lt==="right"?1:Lt==="left"?0:.5;let Vi=!1;for(const oi of Je){const zi=oi.getSections();for(const tn of zi){if(tn.image)continue;const _n=qe[tn.fontStack];if(_n&&(Vi=_n.ascender!==void 0&&_n.descender!==void 0,!Vi))break}if(!Vi)break}let gi=0;for(const oi of Je){oi.trim();const zi=oi.getMaxScale(),tn=(zi-1)*Lo,_n={positionedGlyphs:[],lineOffset:0};Ue.positionedLines[gi]=_n;const On=_n.positionedGlyphs;let yn=0;if(!oi.length()){at+=Ot,++gi;continue}let Si=0,gn=0;for(let xe=0;xe<oi.length();xe++){const we=oi.getSection(xe),ut=oi.getSectionIndex(xe),St=oi.getCodePoint(xe);let ri=we.scale,ni=null,xi=null,ji=null,Ln=Lo,zn=0,En=Ft;En===Xa.vertical&&((Ci=St)===12312||Ci===12313||Ci===12316||Ci===12540||Ci===12448)&&(En=Xa.horizontal);const vr=!(En===Xa.horizontal||!Tt&&!vf(St)||Tt&&(jg[St]||jv(St)));if(we.image){const ts=Et.get(we.image.toString());if(!ts)continue;ji=we.image,Ue.iconsInText=Ue.iconsInText||!0,xi=ts.paddedRect;const Sn=ts.displaySize;ri=ri*Lo/Bt,ni={width:Sn[0],height:Sn[1],left:0,top:-YT,advance:vr?Sn[1]:Sn[0],localGlyph:!1},zn=Vi?-ni.height*ri:zi*Lo-17-Sn[1]*ri,Ln=ni.advance;const Ur=(vr?Sn[0]:Sn[1])*ri-Lo*zi;Ur>0&&Ur>yn&&(yn=Ur)}else{const ts=Ze[we.fontStack];if(!ts)continue;ts[St]&&(xi=ts[St]);const Sn=qe[we.fontStack];if(!Sn)continue;const Ur=Sn.glyphs[St];if(!Ur)continue;if(ni=Ur.metrics,Ln=St!==8203?Lo:0,Vi){const Tr=Sn.ascender!==void 0?Math.abs(Sn.ascender):0,cr=Sn.descender!==void 0?Math.abs(Sn.descender):0,jr=(Tr+cr)*ri;Si<jr&&(Si=jr,gn=(Tr-cr)/2*ri),zn=-Tr*ri}else zn=(zi-ri)*Lo-17}vr?(Ue.verticalizable=!0,On.push({glyph:St,image:ji,x:ht,y:at+zn,vertical:vr,scale:ri,localGlyph:ni.localGlyph,fontStack:we.fontStack,sectionIndex:ut,metrics:ni,rect:xi}),ht+=Ln*ri+Gt):(On.push({glyph:St,image:ji,x:ht,y:at+zn,vertical:vr,scale:ri,localGlyph:ni.localGlyph,fontStack:we.fontStack,sectionIndex:ut,metrics:ni,rect:xi}),ht+=ni.advance*ri+Gt)}On.length!==0&&(Ht=Math.max(ht-Gt,Ht),Vi?iS(On,$t,yn,gn,Ot*zi/2):iS(On,$t,yn,0,Ot/2)),ht=0;const Wn=Ot*zi+yn;_n.lineOffset=Math.max(yn,tn),at+=Wn,++gi}var Ci;const Yt=at,{horizontalAlign:Ni,verticalAlign:ln}=jx(jt);(function(oi,zi,tn,_n,On,yn){const Si=(zi-tn)*On,gn=-yn*_n;for(const Wn of oi)for(const xe of Wn.positionedGlyphs)xe.x+=Si,xe.y+=gn})(Ue.positionedLines,$t,Ni,ln,Ht,Yt),Ue.top+=-ln*Yt,Ue.bottom=Ue.top+Yt,Ue.left+=-Ni*Ht,Ue.right=Ue.left+Ht,Ue.hasBaseline=Vi})(ke,e,i,o,Y,p,v,b,C,T,O,N),!(function(Ue){for(const qe of Ue)if(qe.positionedGlyphs.length!==0)return!1;return!0})(ze))return ke}const jg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_L={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function JT(n,e,i,o,c,f){if(e.image){const p=o.get(e.image.toString());return p?p.displaySize[0]*e.scale*Lo/f+c:0}{const p=i[e.fontStack],v=p&&p.glyphs[n];return v?v.metrics.advance*e.scale+c:0}}function QT(n,e,i,o){const c=Math.pow(n-e,2);return o?n<e?c/2:2*c:c+Math.abs(i)*i}function gL(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function eS(n,e,i,o,c,f){let p=null,v=QT(e,i,c,f);for(const b of o){const T=QT(e-b.x,i,c,f)+b.badness;T<=v&&(p=b,v=T)}return{index:n,x:e,priorBreak:p,badness:v}}function tS(n){return n?tS(n.priorBreak).concat(n.index):[]}function jx(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function iS(n,e,i,o,c){if(!(e||i||o||c))return;const f=n.length-1,p=n[f],v=(p.x+p.metrics.advance*p.scale)*e;for(let b=0;b<=f;b++)n[b].x-=v,n[b].y+=i+o+c}function nS(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function yL(n,e,i,o){const{horizontalAlign:c,verticalAlign:f}=jx(o),p=i[0]-n.displaySize[0]*c,v=i[1]-n.displaySize[1]*f;return{imagePrimary:n,imageSecondary:e,top:v,bottom:v+n.displaySize[1],left:p,right:p+n.displaySize[0]}}function rS(n,e,i,o,c,f){const p=n.imagePrimary;let v;if(p.content){const K=p.content,Y=p.pixelRatio||1;v=[K[0]/Y,K[1]/Y,p.displaySize[0]-K[2]/Y,p.displaySize[1]-K[3]/Y]}const b=e.left*f,T=e.right*f;let I,C,O,B;i==="width"||i==="both"?(B=c[0]+b-o[3],C=c[0]+T+o[1]):(B=c[0]+(b+T-p.displaySize[0])/2,C=B+p.displaySize[0]);const N=e.top*f,X=e.bottom*f;return i==="height"||i==="both"?(I=c[1]+N-o[0],O=c[1]+X+o[2]):(I=c[1]+(N+X-p.displaySize[1])/2,O=I+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:I,right:C,bottom:O,left:B,collisionPadding:v}}function sS(n){return!n.imagePrimary.stretchX}function oS(n){return!n.imagePrimary.stretchY}function aS(n){return{width:n.right-n.left,height:n.bottom-n.top}}const Hc=128;function lS(n,e,i){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Nr(n+1,{worldview:i}))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:f}=o;let p=0;for(;p<c.length&&c[p]<=n;)p++;p=Math.max(0,p-1);let v=p;for(;v<c.length&&c[v]<n+1;)v++;v=Math.min(c.length-1,v);const b=c[p],T=c[v];return o.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:b,maxZoom:T,minSize:o.evaluate(new Nr(b,{worldview:i})),maxSize:o.evaluate(new Nr(T,{worldview:i})),interpolationType:f}}}function $x(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:c}){return n.kind==="source"?o/Hc:n.kind==="composite"?Mi(o/Hc,c/Hc,i):e}function km(n,e,i=1){let o=0,c=0;if(n.kind==="constant")c=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:v}=n,b=f?Le(qa.interpolationFactor(f,e,p,v),0,1):0;n.kind==="camera"?c=Mi(n.minSize,n.maxSize,b)*i:o=b*i}return{uSizeT:o,uSize:c}}class Bu extends kt{constructor(e,i,o,c,f){super(e,i),this.angle=c,this.z=o,f!==void 0&&(this.segment=f)}clone(){return new Bu(this.x,this.y,this.z,this.angle,this.segment)}}function cS(n,e,i,o,c){if(e.segment===void 0)return!0;let f=e,p=e.segment+1,v=0;for(;v>-i/2;){if(p--,p<0)return!1;v-=n[p].dist(f),f=n[p]}v+=n[p].dist(n[p+1]),p++;const b=[];let T=0;for(;v<i/2;){const I=n[p],C=n[p+1];if(!C)return!1;let O=n[p-1].angleTo(I)-I.angleTo(C);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:O}),T+=O;v-b[0].distance>o;)T-=b.shift().angleDelta;if(T>c)return!1;p++,v+=I.dist(C)}return!0}function uS(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function hS(n,e,i){return n?.6*e*i:0}function dS(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function vL(n,e,i,o,c,f){const p=hS(i,c,f),v=dS(i,o)*f;let b=0;const T=uS(n)/2;for(let I=0;I<n.length-1;I++){const C=n[I],O=n[I+1],B=C.dist(O);if(b+B>T){const N=(T-b)/B,X=Mi(C.x,O.x,N),K=Mi(C.y,O.y,N),Y=new Bu(X,K,0,O.angleTo(C),I);return!p||cS(n,Y,v,p,e)?Y:void 0}b+=B}}function xL(n,e,i,o,c,f,p,v,b){const T=hS(o,f,p),I=dS(o,c),C=I*p,O=n[0].x===0||n[0].x===b||n[0].y===0||n[0].y===b;return e-C<e/4&&(e=C+e/4),fS(n,O?e/2*v%e:(I/2+2*f)*p*v%e,e,T,i,C,O,!1,b)}function fS(n,e,i,o,c,f,p,v,b){const T=f/2,I=uS(n);let C=0,O=e-i,B=[];for(let N=0;N<n.length-1;N++){const X=n[N],K=n[N+1],Y=X.dist(K),ue=K.angleTo(X);for(;O+i<C+Y;){O+=i;const de=(O-C)/Y,_e=Mi(X.x,K.x,de),ze=Mi(X.y,K.y,de);if(_e>=0&&_e<b&&ze>=0&&ze<b&&O-T>=0&&O+T<=I){const ke=new Bu(_e,ze,0,ue,N);o&&!cS(n,ke,f,o,c)||B.push(ke)}}C+=Y}return v||B.length||p||(B=fS(n,C/2,i,o,c,f,p,!0,b)),B}function pS(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort(((p,v)=>v.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,f=0;for(const p of n)for(let v=o.length-1;v>=0;v--){const b=o[v];if(!(p.w>b.w||p.h>b.h)){if(p.x=b.x,p.y=b.y,f=Math.max(f,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===b.w&&p.h===b.h){const T=o.pop();T&&v<o.length&&(o[v]=T)}else p.h===b.h?(b.x+=p.w,b.w-=p.w):p.w===b.w?(b.y+=p.h,b.h-=p.h):(o.push({x:b.x+p.w,y:b.y,w:b.w-p.w,h:p.h}),b.y+=p.h,b.h-=p.h);break}}return{w:c,h:f,fill:e/(c*f)||0}}yi(Bu,"Anchor");const wd=1;class Fm{static getImagePositionScale(e,i,o){if(i&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:o,y:o}}constructor(e,i,o,c){this.paddedRect=e;const{pixelRatio:f,version:p,stretchX:v,stretchY:b,content:T,sdf:I,usvg:C}=i;this.pixelRatio=f,this.stretchX=v,this.stretchY=b,this.content=T,this.version=p,this.padding=o,this.sdf=I,this.usvg=C,this.scale=Fm.getImagePositionScale(c,C,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function qx(n,e,i){const o=Ko.parse(n),c=(function(f,p,v=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*v[0])+2*p,h:(f.data?f.data.height:f.height*v[1])+2*p}})(e,i,[o.options.transform.a,o.options.transform.d]);return{bin:c,imagePosition:new Fm(c,e,i,o),imageVariant:o}}class mS{constructor(e,i,o){const c=new Map,f=new Map;this.haveRenderCallbacks=[];const p=[];this.addImages(e,c,wd,p),this.addImages(i,f,2,p);const{w:v,h:b}=pS(p),T=new Go({width:v||1,height:b||1});for(const[I,C]of e.entries()){const O=c.get(I).paddedRect;Go.copy(C.data,T,{x:0,y:0},{x:O.x+wd,y:O.y+wd},C.data,null,C.sdf)}for(const[I,C]of i.entries()){const O=f.get(I),B=O.paddedRect;let N=O.padding;const X=B.x+N,K=B.y+N,Y=C.data.width,ue=C.data.height;N=N>1?N-1:N,Go.copy(C.data,T,{x:0,y:0},{x:X,y:K},C.data,o),Go.copy(C.data,T,{x:0,y:ue-N},{x:X,y:K-N},{width:Y,height:N},o),Go.copy(C.data,T,{x:0,y:0},{x:X,y:K+ue},{width:Y,height:N},o),Go.copy(C.data,T,{x:Y-N,y:0},{x:X-N,y:K},{width:N,height:ue},o),Go.copy(C.data,T,{x:0,y:0},{x:X+Y,y:K},{width:N,height:ue},o),Go.copy(C.data,T,{x:Y-N,y:ue-N},{x:X-N,y:K-N},{width:N,height:N},o),Go.copy(C.data,T,{x:0,y:ue-N},{x:X+Y,y:K-N},{width:N,height:N},o),Go.copy(C.data,T,{x:0,y:0},{x:X+Y,y:K+ue},{width:N,height:N},o),Go.copy(C.data,T,{x:Y-N,y:0},{x:X-N,y:K+ue},{width:N,height:N},o)}this.lut=o,this.image=T,this.iconPositions=c,this.patternPositions=f}addImages(e,i,o,c){for(const[f,p]of e.entries()){const{bin:v,imagePosition:b,imageVariant:T}=qx(f,p,o);i.set(f,b),c.push(v),p.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((c=>e.hasImage(c,o))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const c of e.getUpdatedImages(o)){for(const f of this.iconPositions.keys()){const p=Ko.parse(f);if(Kr.isEqual(p.id,c)){const v=e.getImage(c,o);this.patchUpdatedImage(this.iconPositions.get(f),v,i,null)}}for(const f of this.patternPositions.keys()){const p=Ko.parse(f);if(Kr.isEqual(p.id,c)){const v=e.getImage(c,o);this.patchUpdatedImage(this.patternPositions.get(f),v,i,this.lut)}}}}patchUpdatedImage(e,i,o,c=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[f,p]=e.tl,v=e.sdf;if(this.lut||v){const b={width:i.data.width,height:i.data.height},T=new Go(b);Go.copy(i.data,T,{x:0,y:0},{x:0,y:0},b,c,v),o.update(T,{position:{x:f,y:p}})}else o.update(i.data,{position:{x:f,y:p}})}}yi(Fm,"ImagePosition"),yi(mS,"ImageAtlas");const Bm=1e20;function _S(n,e,i,o,c,f,p,v,b){for(let T=e;T<e+o;T++)gS(n,i*f+T,f,c,p,v,b);for(let T=i;T<i+c;T++)gS(n,T*f+e,1,o,p,v,b)}function gS(n,e,i,o,c,f,p){f[0]=0,p[0]=-Bm,p[1]=Bm,c[0]=n[e];for(let v=1,b=0,T=0;v<o;v++){c[v]=n[e+v*i];const I=v*v;do{const C=f[b];T=(c[v]-c[C]+I-C*C)/(v-C)/2}while(T<=p[b]&&--b>-1);b++,f[b]=v,p[b]=T,p[b+1]=Bm}for(let v=0,b=0;v<o;v++){for(;p[b+1]<v;)b++;const T=f[b],I=v-T;n[e+v*i]=c[T]+I*I}}const fc=2,Gx={none:0,ideographs:1,all:2};class Wf{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const o=[],c=this.url||sr.GLYPHS_URL;for(const f in e)for(const p of e[f])o.push({stack:f,id:p});st(o,(({stack:f,id:p},v)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[p];if(T!==void 0)return void v(null,{stack:f,id:p,glyph:T});if(T=this._tinySDF(b,f,p),T)return b.glyphs[p]=T,void v(null,{stack:f,id:p,glyph:T});const I=Math.floor(p/256);if(256*I>65535)return An("glyphs > 65535 not supported"),void v(null,{stack:f,id:p,glyph:T});if(b.ranges[I])return void v(null,{stack:f,id:p,glyph:T});let C=b.requests[I];C||(C=b.requests[I]=[],Wf.loadGlyphRange(f,I,c,this.requestManager,((O,B)=>{if(B){b.ascender=B.ascender,b.descender=B.descender;for(const N in B.glyphs)this._doesCharSupportLocalGlyph(+N)||(b.glyphs[+N]=B.glyphs[+N]);b.ranges[I]=!0}for(const N of C)N(O,B);delete b.requests[I]}))),C.push(((O,B)=>{O?v(O):B&&v(null,{stack:f,id:p,glyph:B.glyphs[p]||null})}))}),((f,p)=>{if(f)i(f);else if(p){const v={};for(const{stack:b,id:T,glyph:I}of p)v[b]===void 0&&(v[b]={}),v[b].glyphs===void 0&&(v[b].glyphs={}),v[b].glyphs[T]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;i(null,v)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Gx.none&&(this.localGlyphMode===Gx.all?!!this.localFontFamily:!!this.localFontFamily&&(Yi["CJK Unified Ideographs"](e)||Yi["Hangul Syllables"](e)||Yi.Hiragana(e)||Yi.Katakana(e)||Yi["CJK Symbols and Punctuation"](e)||Yi["CJK Unified Ideographs Extension A"](e)||Yi["CJK Unified Ideographs Extension B"](e)||Yi.Osage(e)))}_tinySDF(e,i,o){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let f=e.tinySDF;if(!f){let X="400";/bold/i.test(i)?X="900":/medium/i.test(i)?X="500":/light/i.test(i)&&(X="200"),f=e.tinySDF=new Wf.TinySDF({fontFamily:c,fontWeight:X,fontSize:24*fc,buffer:3*fc,radius:8*fc}),f.fontWeight=X}if(this.localGlyphs[f.fontWeight][o])return this.localGlyphs[f.fontWeight][o];const p=String.fromCodePoint(o),{data:v,width:b,height:T,glyphWidth:I,glyphHeight:C,glyphLeft:O,glyphTop:B,glyphAdvance:N}=f.draw(p);return this.localGlyphs[f.fontWeight][o]={id:o,bitmap:new Ph({width:b,height:T},v),metrics:{width:I/fc,height:C/fc,left:O/fc,top:B/fc-27,advance:N/fc,localGlyph:!0}}}}Wf.loadGlyphRange=function(n,e,i,o,c){const f=256*e,p=f+255,v=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${f}-${p}`),fr.Glyphs);Ps(v,((b,T)=>{if(b)c(b);else if(T){const I={},C=(function(O){return new Vg(O).readFields(fL,{})})(T);for(const O of C.glyphs)I[O.id]=O;c(null,{glyphs:I,ascender:C.ascender,descender:C.descender})}}))},Wf.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:f="normal",fontStyle:p="normal",lang:v=null}={}){this.buffer=e,this.cutoff=o,this.radius=i,this.lang=v;const b=this.size=n+4*e,T=this._createCanvas(b),I=this.ctx=T.getContext("2d",{willReadFrequently:!0});I.font=`${p} ${f} ${n}px ${c}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:f}=this.ctx.measureText(n),p=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-c))),b=Math.min(this.size-this.buffer,p+Math.ceil(o)),T=v+2*this.buffer,I=b+2*this.buffer,C=Math.max(T*I,0),O=new Uint8ClampedArray(C),B={data:O,width:T,height:I,glyphWidth:v,glyphHeight:b,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(v===0||b===0)return B;const{ctx:N,buffer:X,gridInner:K,gridOuter:Y}=this;this.lang&&(N.lang=this.lang),N.clearRect(X,X,v,b),N.fillText(n,X,X+p);const ue=N.getImageData(X,X,v,b);Y.fill(Bm,0,C),K.fill(0,0,C);for(let de=0;de<b;de++)for(let _e=0;_e<v;_e++){const ze=ue.data[4*(de*v+_e)+3]/255;if(ze===0)continue;const ke=(de+X)*T+_e+X;if(ze===1)Y[ke]=0,K[ke]=Bm;else{const Ue=.5-ze;Y[ke]=Ue>0?Ue*Ue:0,K[ke]=Ue<0?Ue*Ue:0}}_S(Y,0,0,T,I,T,this.f,this.v,this.z),_S(K,X,X,v,b,T,this.f,this.v,this.z);for(let de=0;de<C;de++){const _e=Math.sqrt(Y[de])-Math.sqrt(K[de]);O[de]=Math.round(255-255*(_e/this.radius+this.cutoff))}return B}};const Rh=wd;function yS(n,e){return n+e[1]-e[0]}function vS(n,e,i,o,c=1){const f=[],p=n.imagePrimary,v=p.pixelRatio,b=p.paddedRect.w-2*Rh,T=p.paddedRect.h-2*Rh,I=(n.right-n.left)*c,C=(n.bottom-n.top)*c,O=p.stretchX||[[0,b]],B=p.stretchY||[[0,T]],N=O.reduce(yS,0),X=B.reduce(yS,0),K=b-N,Y=T-X;let ue=0,de=N,_e=0,ze=X,ke=0,Ue=K,qe=0,Ze=Y;if(p.content&&o){const Je=p.content;ue=$g(O,0,Je[0]),_e=$g(B,0,Je[1]),de=$g(O,Je[0],Je[2]),ze=$g(B,Je[1],Je[3]),ke=Je[0]-ue,qe=Je[1]-_e,Ue=Je[2]-Je[0]-de,Ze=Je[3]-Je[1]-ze}const Et=(Je,Ot,jt,Lt)=>{const Ft=qg(Je.stretch-ue,de,I,n.left*c),Gt=Gg(Je.fixed-ke,Ue,Je.stretch,N),Tt=qg(Ot.stretch-_e,ze,C,n.top*c),Bt=Gg(Ot.fixed-qe,Ze,Ot.stretch,X),ht=qg(jt.stretch-ue,de,I,n.left*c),at=Gg(jt.fixed-ke,Ue,jt.stretch,N),Ht=qg(Lt.stretch-_e,ze,C,n.top*c),$t=Gg(Lt.fixed-qe,Ze,Lt.stretch,X),Vi=new kt(Ft,Tt),gi=new kt(ht,Tt),Ci=new kt(ht,Ht),Yt=new kt(Ft,Ht),Ni=new kt(Gt/v,Bt/v),ln=new kt(at/v,$t/v),oi=e*Math.PI/180;if(oi){const Si=Math.sin(oi),gn=Math.cos(oi),Wn=[gn,-Si,Si,gn];Vi._matMult(Wn),gi._matMult(Wn),Yt._matMult(Wn),Ci._matMult(Wn)}const zi=Je.stretch+Je.fixed,tn=jt.stretch+jt.fixed,_n=Ot.stretch+Ot.fixed,On=Lt.stretch+Lt.fixed,yn=n.imageSecondary;return{tl:Vi,tr:gi,bl:Yt,br:Ci,texPrimary:{x:p.paddedRect.x+Rh+zi,y:p.paddedRect.y+Rh+_n,w:tn-zi,h:On-_n},texSecondary:yn?{x:yn.paddedRect.x+Rh+zi,y:yn.paddedRect.y+Rh+_n,w:tn-zi,h:On-_n}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ni,pixelOffsetBR:ln,minFontScaleX:Ue/v/I,minFontScaleY:Ze/v/C,isSDF:i}};if(o&&(p.stretchX||p.stretchY)){const Je=xS(O,K,N),Ot=xS(B,Y,X);for(let jt=0;jt<Je.length-1;jt++){const Lt=Je[jt],Ft=Je[jt+1];for(let Gt=0;Gt<Ot.length-1;Gt++)f.push(Et(Lt,Ot[Gt],Ft,Ot[Gt+1]))}}else f.push(Et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return f}function $g(n,e,i){let o=0;for(const c of n)o+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return o}function xS(n,e,i){const o=[{fixed:-Rh,stretch:0}];for(const[c,f]of n){const p=o[o.length-1];o.push({fixed:c-p.stretch,stretch:p.stretch}),o.push({fixed:c-p.stretch,stretch:p.stretch+(f-c)})}return o.push({fixed:e+Rh,stretch:i}),o}function qg(n,e,i,o){return n/e*i+o}function Gg(n,e,i,o){return n-e*i/o}function bL(n,e,i,o){const c=e+n.positionedLines[o].lineOffset;return o===0?i+c/2:i+(c+(e+n.positionedLines[o-1].lineOffset))/2}function wL(n,e=1,i=!1){let o=1/0,c=1/0,f=-1/0,p=-1/0;const v=n[0];for(let B=0;B<v.length;B++){const N=v[B];(!B||N.x<o)&&(o=N.x),(!B||N.y<c)&&(c=N.y),(!B||N.x>f)&&(f=N.x),(!B||N.y>p)&&(p=N.y)}const b=Math.min(f-o,p-c);let T=b/2;const I=new ah([],TL);if(b===0)return new kt(o,c);for(let B=o;B<f;B+=b)for(let N=c;N<p;N+=b)I.push(new Xf(B+T,N+T,T,n));let C=(function(B){let N=0,X=0,K=0;const Y=B[0];for(let ue=0,de=Y.length,_e=de-1;ue<de;_e=ue++){const ze=Y[ue],ke=Y[_e],Ue=ze.x*ke.y-ke.x*ze.y;X+=(ze.x+ke.x)*Ue,K+=(ze.y+ke.y)*Ue,N+=3*Ue}return new Xf(X/N,K/N,0,B)})(n),O=I.length;for(;I.length;){const B=I.pop();(B.d>C.d||!C.d)&&(C=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,O)),B.max-C.d<=e||(T=B.h/2,I.push(new Xf(B.p.x-T,B.p.y-T,T,n)),I.push(new Xf(B.p.x+T,B.p.y-T,T,n)),I.push(new Xf(B.p.x-T,B.p.y+T,T,n)),I.push(new Xf(B.p.x+T,B.p.y+T,T,n)),O+=4)}return i&&(console.log(`num probes: ${O}`),console.log(`best distance: ${C.d}`)),C.p}function TL(n,e){return e.max-n.max}class Xf{constructor(e,i,o,c){this.p=new kt(e,i),this.h=o,this.d=(function(f,p){let v=!1,b=1/0;for(let T=0;T<p.length;T++){const I=p[T];for(let C=0,O=I.length,B=O-1;C<O;B=C++){const N=I[C],X=I[B];N.y>f.y!=X.y>f.y&&f.x<(X.x-N.x)*(f.y-N.y)/(X.y-N.y)+N.x&&(v=!v),b=Math.min(b,as(f,N,X))}}return(v?1:-1)*Math.sqrt(b)})(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const SL=Object.keys,Hx=Number.POSITIVE_INFINITY,EL=Math.sqrt(2);function bS(n,[e,i]){let o=0,c=0;if(i===Hx){e<0&&(e=0);const f=e/EL;switch(n){case"top-right":case"top-left":c=f-7;break;case"bottom-right":case"bottom-left":c=7-f;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(n){case"top-right":case"bottom-right":o=-f;break;case"top-left":case"bottom-left":o=f;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(n){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,c]}function Hg(n,e,i,o,c,f,p,v,b){if(!e||!e.usvg)return;const T=aS(o),I=aS(c),C=f!=="both"&&f!=="width"||!sS(o)?1:I.width/T.width,O=f!=="both"&&f!=="height"||!oS(o)?1:I.height/T.height;i.scaleSelf(C,O);const B=i.toString();p.set(B,i),v.set(B,e);const{imagePosition:N}=qx(B,e,wd);b.set(B,N)}function wS(n,e,i,o,c,f,p,v,b){if(!n)return;const T=(function(I,C,O,B,N,X){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const K=C.possiblyEvaluate(new Nr(I.maxZoom,{worldview:X}),O).evaluate(N,{},O),Y=C.possiblyEvaluate(new Nr(I.minZoom,{worldview:X}),O).evaluate(N,{},O);return Math.max(K,Y)}return C.possiblyEvaluate(new Nr(B,{worldview:X})).evaluate(N,{},O)})(e,i,o,c,f,b);return n.scaleSelf(T*v*p)}function TS(n,e,i,o,c,f,p,v,b){return{iconPrimary:wS(n.getPrimary(),e,i,o,c,f,p,v,b),iconSecondary:wS(n.getSecondary(),e,i,o,c,f,p,v,b)}}function AL(n,e,i){if(!e)return;const o=i.get(n.toString()),c=i.get(e.toString());o&&c&&(o.paddedRect.w===c.paddedRect.w&&o.paddedRect.h===c.paddedRect.h||An(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),o.usvg!==c.usvg&&An(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function SS(n,e,i,o){if(!n)return;const c=e.get(i.toString());if(n.imagePrimary=c,o){const f=e.get(o.toString());n.imageSecondary=f}}function IL(n,e){for(const i in n.horizontal)ES(n.horizontal[i],e);ES(n.vertical,e)}function ES(n,e){if(n){for(const i of n.positionedLines)for(const o of i.positionedGlyphs)if(o.image!==null){const c=o.image.toString();o.rect=e.get(c).paddedRect}}}function Zx(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function PL(n,e,i,o,c,f,p,v,b){const T=Wx(f.horizontal)||f.vertical,I=i.get("icon-text-fit-padding").evaluate(o,{},c);let C,O=e;return e&&b!=="none"&&(n.allowVerticalPlacement&&f.vertical&&(C=rS(e,f.vertical,b,I,v,p)),T&&(O=rS(e,T,b,I,v,p))),{defaultShapedIcon:O,verticallyShapedIcon:C}}function CL(n,e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y,ue,de){let _e=p.textMaxSize.evaluate(e,{},O);_e===void 0?_e=v*p.textScaleFactor:_e*=p.textScaleFactor;const ze=n.layers[0].layout,ke=Wx(i.horizontal)||i.vertical,Ue=B.name==="globe",qe=Lo,Ze=n.tilePixelRatio*_e/qe,Et=(Gt=n.overscaling,n.zoom>18&&Gt>2&&(Gt>>=1),Math.max(Zt/(512*Gt),1)*ze.get("symbol-spacing")),Je=ze.get("text-padding")*n.tilePixelRatio,Ot=ze.get("icon-padding")*n.tilePixelRatio,jt=Xe(ze.get("text-max-angle")),Lt=ze.get("icon-rotation-alignment")==="map"&&de!=="point",Ft=Et/2;var Gt;n.hasAnyIconTextFit===!1&&K!=="none"&&(n.hasAnyIconTextFit=!0);const Tt=e.properties?+e.properties[wn]:null,Bt=Tt&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Tt):65535,ht=(at,Ht,$t)=>{if(Ht.x<0||Ht.x>=Zt||Ht.y<0||Ht.y>=Zt)return;let Vi=null;if(Ue){const{x:gi,y:Ci,z:Yt}=B.projectTilePoint(Ht.x,Ht.y,$t);Vi={anchor:new Bu(gi,Ci,Yt,0,void 0),up:B.upVector($t,Ht.x,Ht.y)}}(function(gi,Ci,Yt,Ni,ln,oi,zi,tn,_n,On,yn,Si,gn,Wn,xe,we,ut,St,ri,ni,xi,ji,Ln,zn,En,vr,ts,Sn,Ur){const Tr=gi.addToLineVertexArray(Ci,Ni);let cr,jr,$r,Fr,Vr,Sr,kn,Er=0,us=0,rn=0,Yn=0,qr=-1,ws=-1;const Zr={};let io=Ai("");const Cr=Yt?Yt.anchor:Ci,Ys=Sn!=="none";let ka=0,Ho=0;if(_n._unevaluatedLayout.getValue("text-radial-offset")===void 0){const no=_n.layout.get("text-offset").evaluate(xi,{},En);ka=no[0]*Lo,Ho=no[1]*Lo}else ka=_n.layout.get("text-radial-offset").evaluate(xi,{},En)*Lo,Ho=Hx;if(gi.allowVerticalPlacement&&ln.vertical){const no=ln.vertical;if(xe)Sr=Xx(no),tn&&(kn=Xx(tn));else{const bo=_n.layout.get("text-rotate").evaluate(xi,{},En)+90;$r=Zg(On,Cr,Ci,yn,Si,gn,no,Wn,bo,we),tn&&(Fr=Zg(On,Cr,Ci,yn,Si,gn,tn,St,bo))}}if(oi){const no=gi.iconSizeData,bo=_n.layout.get("icon-rotate").evaluate(xi,{},En),Zo=vS(oi,bo,Ln,Ys,ji.iconScaleFactor),_a=tn?vS(tn,bo,Ln,Ys,ji.iconScaleFactor):void 0;jr=Zg(On,Cr,Ci,yn,Si,gn,oi,St,bo,null),Er=4*Zo.length;let ea=null;no.kind==="source"?(ea=[Hc*_n.layout.get("icon-size").evaluate(xi,{},En)*ji.iconScaleFactor],ea[0]>Oh&&An(`${gi.layerIds[0]}: Value for "icon-size" is >= ${Nm}. Reduce your "icon-size".`)):no.kind==="composite"&&(ea=[Hc*ji.compositeIconSizes[0].evaluate(xi,{},En)*ji.iconScaleFactor,Hc*ji.compositeIconSizes[1].evaluate(xi,{},En)*ji.iconScaleFactor],(ea[0]>Oh||ea[1]>Oh)&&An(`${gi.layerIds[0]}: Value for "icon-size" is >= ${Nm}. Reduce your "icon-size".`)),gi.addSymbols(gi.icon,Zo,ea,ni,ri,xi,void 0,Yt,Ci,Tr.lineStartIndex,Tr.lineLength,-1,zn,En,vr,ts),qr=gi.icon.placedSymbolArray.length-1,_a&&(us=4*_a.length,gi.addSymbols(gi.icon,_a,ea,ni,ri,xi,Xa.vertical,Yt,Ci,Tr.lineStartIndex,Tr.lineLength,-1,zn,En,vr,ts),ws=gi.icon.placedSymbolArray.length-1)}for(const no in ln.horizontal){const bo=no,Zo=ln.horizontal[bo];cr||(io=Ai(Zo.text),xe?Vr=Xx(Zo):cr=Zg(On,Cr,Ci,yn,Si,gn,Zo,Wn,_n.layout.get("text-rotate").evaluate(xi,{},En),we));const _a=Zo.positionedLines.length===1;if(rn+=AS(gi,Yt,Ci,Zo,zi,_n,xe,xi,we,Tr,ln.vertical?Xa.horizontal:Xa.horizontalOnly,_a?SL(ln.horizontal):[bo],Zr,qr,ji,zn,En,vr),_a)break}ln.vertical&&(Yn+=AS(gi,Yt,Ci,ln.vertical,zi,_n,xe,xi,we,Tr,Xa.vertical,["vertical"],Zr,ws,ji,zn,En,vr));let No=-1;const Fa=(no,bo)=>no?Math.max(no,bo):bo;No=Fa(Vr,No),No=Fa(Sr,No),No=Fa(kn,No);const Zc=No>-1?1:0;gi.glyphOffsetArray.length>=65535&&An("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xi.sortKey!==void 0&&gi.addToSortKeyRanges(gi.symbolInstances.length,xi.sortKey),gi.symbolInstances.emplaceBack(Ci.x,Ci.y,Cr.x,Cr.y,Cr.z,Zr.right>=0?Zr.right:-1,Zr.center>=0?Zr.center:-1,Zr.left>=0?Zr.left:-1,Zr.vertical>=0?Zr.vertical:-1,qr,ws,io,cr!==void 0?cr:gi.collisionBoxArray.length,cr!==void 0?cr+1:gi.collisionBoxArray.length,$r!==void 0?$r:gi.collisionBoxArray.length,$r!==void 0?$r+1:gi.collisionBoxArray.length,jr!==void 0?jr:gi.collisionBoxArray.length,jr!==void 0?jr+1:gi.collisionBoxArray.length,Fr||gi.collisionBoxArray.length,Fr?Fr+1:gi.collisionBoxArray.length,yn,rn,Yn,Er,us,Zc,0,ka,Ho,No,0,Ys?1:0,Ur)})(n,Ht,Vi,at,i,o,f,c,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Je,ue,T,0,Ot,Lt,Y,e,p,I,C,O,N,X,K,Bt)};if(de==="line")for(const at of Lg(e.geometry,0,0,Zt,Zt)){const Ht=xL(at,Et,jt,i.vertical||ke,o,qe,Ze,n.overscaling,Zt);for(const $t of Ht)ke&&ML(n,ke.text,Ft,$t)||ht(at,$t,O)}else if(de==="line-center"){for(const at of e.geometry)if(at.length>1){const Ht=vL(at,jt,i.vertical||ke,o,qe,Ze);Ht&&ht(at,Ht,O)}}else if(e.type==="Polygon")for(const at of bm(e.geometry,0)){const Ht=wL(at,16);ht(at[0],new Bu(Ht.x,Ht.y,0,0,void 0),O)}else if(e.type==="LineString")for(const at of e.geometry)ht(at,new Bu(at[0].x,at[0].y,0,0,void 0),O);else if(e.type==="Point")for(const at of e.geometry)for(const Ht of at)ht([Ht],new Bu(Ht.x,Ht.y,0,0,void 0),O)}const Nm=255,Oh=Nm*Hc;function AS(n,e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K,Y){const ue=(function(ze,ke,Ue,qe,Ze,Et,Je,Ot){const jt=[];if(ke.positionedLines.length===0)return jt;const Lt=qe.layout.get("text-rotate").evaluate(Et,{})*Math.PI/180,Ft=(function(at){const Ht=at[0],$t=at[1],Vi=Ht*$t;return Vi>0?[Ht,-$t]:Vi<0?[-Ht,$t]:Ht===0?[$t,Ht]:[$t,-Ht]})(Ue);let Gt=Math.abs(ke.top-ke.bottom);for(const at of ke.positionedLines)Gt-=at.lineOffset;const Tt=ke.positionedLines.length,Bt=Gt/Tt;let ht=ke.top-Ue[1];for(let at=0;at<Tt;++at){const Ht=ke.positionedLines[at];ht=bL(ke,Bt,ht,at);for(const $t of Ht.positionedGlyphs){if(!$t.rect)continue;const Vi=$t.rect||{};let gi=YT+1,Ci=!0,Yt=1,Ni=0;if($t.image){const xi=Je.get($t.image.toString());if(!xi)continue;if(xi.sdf){An("SDF images are not supported in formatted text and will be ignored.");continue}Ci=!1,Yt=xi.pixelRatio,gi=wd/Yt}const ln=(Ze||Ot)&&$t.vertical,oi=$t.metrics.advance*$t.scale/2,zi=$t.metrics,tn=$t.rect;if(tn===null)continue;Ot&&ke.verticalizable&&(Ni=$t.image?oi-$t.metrics.width*$t.scale/2:0);const _n=Ze?[$t.x+oi,$t.y]:[0,0];let On=[0,0],yn=[0,0],Si=!1;Ze||(ln?(yn=[$t.x+oi+Ft[0],$t.y+Ft[1]-Ni],Si=!0):On=[$t.x+oi+Ue[0],$t.y+Ue[1]-Ni]);const gn=tn.w*$t.scale/(Yt*($t.localGlyph?fc:1)),Wn=tn.h*$t.scale/(Yt*($t.localGlyph?fc:1));let xe,we,ut,St;if(ln){const xi=$t.y-ht,ji=new kt(-oi,oi-xi),Ln=-Math.PI/2,zn=new kt(...yn);xe=new kt(-oi+On[0],On[1]),xe._rotateAround(Ln,ji)._add(zn),xe.x+=-xi+oi,xe.y-=(zi.left-gi)*$t.scale;const En=$t.image?zi.advance*$t.scale:Lo*$t.scale,vr=String.fromCodePoint($t.glyph);iL(vr)?xe.x+=(1-gi)*$t.scale:nL(vr)?xe.x+=En-zi.height*$t.scale+(-gi-1)*$t.scale:xe.x+=$t.image||zi.width+2*gi===tn.w&&zi.height+2*gi===tn.h?(En-Wn)/2:(En-(zi.height+2*gi)*$t.scale)/2,we=new kt(xe.x,xe.y-gn),ut=new kt(xe.x+Wn,xe.y),St=new kt(xe.x+Wn,xe.y-gn)}else{const xi=(zi.left-gi)*$t.scale-oi+On[0],ji=(-zi.top-gi)*$t.scale+On[1],Ln=xi+gn,zn=ji+Wn;xe=new kt(xi,ji),we=new kt(Ln,ji),ut=new kt(xi,zn),St=new kt(Ln,zn)}if(Lt){let xi;xi=Ze?new kt(0,0):Si?new kt(Ft[0],Ft[1]):new kt(Ue[0],Ue[1]),xe._rotateAround(Lt,xi),we._rotateAround(Lt,xi),ut._rotateAround(Lt,xi),St._rotateAround(Lt,xi)}const ri=new kt(0,0),ni=new kt(0,0);jt.push({tl:xe,tr:we,bl:ut,br:St,texPrimary:Vi,texSecondary:void 0,writingMode:ke.writingMode,glyphOffset:_n,sectionIndex:$t.sectionIndex,isSDF:Ci,pixelOffsetTL:ri,pixelOffsetBR:ni,minFontScaleX:0,minFontScaleY:0})}}return jt})(0,o,b,f,p,v,c,n.allowVerticalPlacement),de=n.textSizeData;let _e=null;de.kind==="source"?(_e=[Hc*f.layout.get("text-size").evaluate(v,{},K)*N.textScaleFactor],_e[0]>Oh&&An(`${n.layerIds[0]}: Value for "text-size" is >= ${Nm}. Reduce your "text-size".`)):de.kind==="composite"&&(_e=[Hc*N.compositeTextSizes[0].evaluate(v,{},K)*N.textScaleFactor,Hc*N.compositeTextSizes[1].evaluate(v,{},K)*N.textScaleFactor],(_e[0]>Oh||_e[1]>Oh)&&An(`${n.layerIds[0]}: Value for "text-size" is >= ${Nm}. Reduce your "text-size".`)),n.addSymbols(n.text,ue,_e,b,p,v,I,e,i,T.lineStartIndex,T.lineLength,B,X,K,Y,!1);for(const ze of C)O[ze]=n.text.placedSymbolArray.length-1;return 4*ue.length}function Wx(n){for(const e in n)return n[e];return null}function Zg(n,e,i,o,c,f,p,v,b,T){let I=p.top,C=p.bottom,O=p.left,B=p.right;if(nS(p)&&p.collisionPadding){const N=p.collisionPadding;O-=N[0],I-=N[1],B+=N[2],C+=N[3]}if(b){const N=new kt(O,I),X=new kt(B,I),K=new kt(O,C),Y=new kt(B,C),ue=Xe(b);let de=new kt(0,0);T&&(de=new kt(T[0],T[1])),N._rotateAround(ue,de),X._rotateAround(ue,de),K._rotateAround(ue,de),Y._rotateAround(ue,de),O=Math.min(N.x,X.x,K.x,Y.x),B=Math.max(N.x,X.x,K.x,Y.x),I=Math.min(N.y,X.y,K.y,Y.y),C=Math.max(N.y,X.y,K.y,Y.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,O,I,B,C,v,o,c,f),n.length-1}function Xx(n){nS(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function ML(n,e,i,o){const c=n.compareText;if(e in c){const f=c[e];for(let p=f.length-1;p>=0;p--)if(o.dist(f[p])<i)return!0}else c[e]=[];return c[e].push(o),!1}function IS(n,e){const i=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),f=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let p=Math.sin(n._pitch)*f+c;const v=c*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let b=Math.max(n.zoom-17,0);n.isOrthographic&&(b/=10),p*=1+b}return Math.min(1.01*p,v)}function Um(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),o=n.x*i,c=(n.x+1)*i,f=n.y*i,p=(n.y+1)*i,v=Me(o),b=Me(c),T=Ie(f),I=Ie(p),C=e.project(v,T),O=e.project(b,T),B=e.project(b,I),N=e.project(v,I);let X=Math.min(C.x,O.x,B.x,N.x),K=Math.min(C.y,O.y,B.y,N.y),Y=Math.max(C.x,O.x,B.x,N.x),ue=Math.max(C.y,O.y,B.y,N.y);const de=i/16;function _e(ke,Ue,qe,Ze,Et,Je){const Ot=(qe+Et)/2,jt=(Ze+Je)/2,Lt=e.project(Me(Ot),Ie(jt)),Ft=Math.max(0,X-Lt.x,K-Lt.y,Lt.x-Y,Lt.y-ue);X=Math.min(X,Lt.x),Y=Math.max(Y,Lt.x),K=Math.min(K,Lt.y),ue=Math.max(ue,Lt.y),Ft>de&&(_e(ke,Lt,qe,Ze,Ot,jt),_e(Lt,Ue,Ot,jt,Et,Je))}_e(C,O,o,f,c,f),_e(O,B,c,f,c,p),_e(B,N,c,p,o,p),_e(N,C,o,p,o,f),X-=de,K-=de,Y+=de,ue+=de;const ze=1/Math.max(Y-X,ue-K);return{scale:ze,x:X*ze,y:K*ze,x2:Y*ze,y2:ue*ze,projection:e}}function PS(n,{x:e,y:i},o=0){return new kt(((e-o)*n.scale-n.x)*Zt,(i*n.scale-n.y)*Zt)}const RL=he(new Float32Array(16));class Lh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Z(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o,c=!0){return e._coordinatePoint(e.locationCoordinate(i,o),c)}pixelsPerMeter(e,i){return Ae(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return IS(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,c){const f=e.horizonLineFromTop(!1),p=new kt(i,Math.max(f,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,c))}pointCoordinate3D(e,i,o){const c=new kt(i,o);if(e.elevation)return e.elevation.pointCoordinate(c);{const f=this.pointCoordinate(e,c.x,c.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return RL}createTileMatrix(e,i,o){let c,f,p;const v=o.canonical,b=he(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Um(v,this);c=1,f=T.x+o.wrap*T.scale,p=T.y,oe(b,b,[c/T.scale,c/T.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(v.z),f=(v.x+Math.pow(2,v.z)*o.wrap)*c,p=v.y*c;return fe(b,b,[f,p,0]),oe(b,b,[c/Zt,c/Zt,1]),b}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class OL extends Lh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(Xe(i));this.n=(c+Math.sin(Xe(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c,r0:f}=this,p=Xe(e-this.center[0]),v=Xe(i),b=Math.sqrt(c-2*o*Math.sin(v))/o;return{x:b*Math.sin(p*o),y:b*Math.cos(p*o)-f,z:0}}unproject(e,i){const{n:o,c,r0:f}=this,p=f+i;let v=Math.atan2(e,Math.abs(p))*Math.sign(p);p*o<0&&(v-=Math.PI*Math.sign(e)*Math.sign(p));const b=Xe(this.center[0])*o;v=je(v,-Math.PI-b,Math.PI-b);const T=Le(Q(v/o)+this.center[0],-180,180),I=Math.asin(Le((c-(e*e+p*p)*o*o)/(2*o),-1,1)),C=Le(Q(I),-Re,Re);return new Z(T,C)}}const Vm=1.340264,jm=-.081106,$m=893e-6,qm=.003796,Wg=Math.sqrt(3)/2;class LL extends Lh{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Wg*Math.sin(i)),c=o*o,f=c*c*c;return{x:.5*(e*Math.cos(o)/(Wg*(Vm+3*jm*c+f*(7*$m+9*qm*c)))/Math.PI+.5),y:1-.5*(o*(Vm+jm*c+f*($m+qm*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=o*o,f=c*c*c;for(let I,C,O,B=0;B<12&&(C=o*(Vm+jm*c+f*($m+qm*c))-i,O=Vm+3*jm*c+f*(7*$m+9*qm*c),I=C/O,o=Le(o-I,-Math.PI/3,Math.PI/3),c=o*o,f=c*c*c,!(Math.abs(I)<1e-12));++B);const p=Wg*e*(Vm+3*jm*c+f*(7*$m+9*qm*c))/Math.cos(o),v=Math.asin(Math.sin(o)/Wg),b=Le(180*p/Math.PI,-180,180),T=Le(180*v/Math.PI,-Re,Re);return new Z(b,T)}}class DL extends Lh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),c=Le(360*(.5-i),-Re,Re);return new Z(o,c)}}const Kf=Math.PI/2;function Xg(n){return Math.tan((Kf+n)/2)}class zL extends Lh{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let c=Xe(i),f=Xe(o);this.southernCenter=c+f<0,this.southernCenter&&(c=-c,f=-f);const p=Math.cos(c),v=Xg(c);this.n=c===f?Math.sin(c):Math.log(p/Math.cos(f))/Math.log(Xg(f)/v),this.f=p*Math.pow(Xg(c),this.n)/this.n}project(e,i){i=Xe(i),this.southernCenter&&(i=-i),e=Xe(e-this.center[0]);const o=1e-6,{n:c,f}=this;f>0?i<-Kf+o&&(i=-Kf+o):i>Kf-o&&(i=Kf-o);const p=f/Math.pow(Xg(i),c);let v=p*Math.sin(c*e),b=f-p*Math.cos(c*e);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:c}=this,f=c-i,p=Math.sign(f),v=Math.sign(o)*Math.sqrt(e*e+f*f);let b=Math.atan2(e,Math.abs(f))*p;f*o<0&&(b-=Math.PI*Math.sign(e)*p);const T=Le(Q(b/o)+this.center[0],-180,180),I=Le(Q(2*Math.atan(Math.pow(c/v,1/o))-Kf),-Re,Re);return new Z(T,this.southernCenter?-I:I)}}class CS extends Lh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ye(e),y:Pe(i),z:0}}unproject(e,i){const o=Me(e),c=Ie(i);return new Z(o,c)}}const MS=Xe(Re);class kL extends Lh{project(e,i){const o=(i=Xe(i))*i,c=o*o;return{x:.5*((e=Xe(e))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=25,f=0,p=o*o;do{p=o*o;const T=p*p;f=(o*(1.007226+p*(.015085+T*(.028874*p-.044475-.005916*T)))-i)/(1.007226+p*(.045255+T*(.259866*p-.311325-.005916*11*T))),o=Le(o-f,-MS,MS)}while(Math.abs(f)>1e-6&&--c>0);p=o*o;const v=Le(Q(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),b=Q(o);return new Z(v,b)}}const RS=Xe(Re);class FL extends Lh{project(e,i){i=Xe(i),e=Xe(e);const o=Math.cos(i),c=2/Math.PI,f=Math.acos(o*Math.cos(e/2)),p=Math.sin(f)/f,v=.5*(e*c+2*o*Math.sin(e/2)/p)||0,b=.5*(i+Math.sin(i)/p)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,f=25;const p=1e-6;let v=0,b=0;do{const T=Math.cos(c),I=Math.sin(c),C=2*I*T,O=I*I,B=T*T,N=Math.cos(o/2),X=Math.sin(o/2),K=2*N*X,Y=X*X,ue=1-B*N*N,de=ue?1/ue:0,_e=ue?Math.acos(T*N)*Math.sqrt(1/ue):0,ze=.5*(2*_e*T*X+2*o/Math.PI)-e,ke=.5*(_e*I+c)-i,Ue=.5*de*(B*Y+_e*T*N*O)+1/Math.PI,qe=de*(K*C/4-_e*I*X),Ze=.125*de*(C*X-_e*I*B*K),Et=.5*de*(O*N+_e*Y*T)+.5,Je=qe*Ze-Et*Ue;v=(ke*qe-ze*Et)/Je,b=(ze*Ze-ke*Ue)/Je,o=Le(o-v,-Math.PI,Math.PI),c=Le(c-b,-RS,RS)}while((Math.abs(v)>p||Math.abs(b)>p)&&--f>0);return new Z(Q(o),Q(c))}}class OS extends Lh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Xe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:c}=this;return{x:Xe(e)*c*o+.5,y:-Math.sin(Xe(i))/c*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:c}=this,f=-(i-.5)/o,p=Le(Q((e-.5)/o)/c,-180,180),v=Math.asin(Le(f*c,-1,1)),b=Le(Q(v),-Re,Re);return new Z(p,b)}}class BL extends CS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const c=mm(e,i,o);return _i(c,c,Sg(qc(o))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i,o){const c=F(i.lat,i.lng),f=Pt([],c),p=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ki(c,c,f,Ae(1,0)*Zt*p);const v=he(new Float64Array(16));return Se(v,e.pixelMatrix,e.globeMatrix),_i(c,c,v),new kt(c[0],c[1])}pixelsPerMeter(e,i){return Ae(1,0)*i}pixelSpaceConversion(e,i,o){const c=Ae(1,e)*i,f=Mi(Ae(1,45)*i,c,o);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,o){const c=nx(qc(o.canonical));return Se(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:o}=e,c=Sg(qc(i));return Ge(c,c,Xe(o.lng)),ge(c,c,Xe(o.lat)),oe(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,o,c){return i1(e,i,o,!0)||new pt(0,0)}pointCoordinate3D(e,i,o){const c=this.pointCoordinate(e,i,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!i1(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(c,f){const p=c.cameraToCenterDistance,v=c._centerAltitude*f,b=c._camera,T=c._camera.forward(),I=yt([],di([],T,-p),[0,0,v]),C=c.worldSize/(2*Math.PI),O=[0,0,-C],B=c.width/c.height,N=Math.tan(c.fovAboveCenter),X=di([],b.up(),N),K=di([],b.right(),N*B),Y=Pt([],yt([],yt([],T,X),K)),ue=[];let de;if(new lr(I,Y).closestPointOnSphere(O,C,ue)){const _e=yt([],ue,O),ze=vt([],_e,I);de=Math.cos(c.fovAboveCenter)*ft(ze)}else{const _e=vt([],I,O),ze=vt([],O,I);Pt(ze,ze);const ke=ft(_e)-C;de=Math.sqrt(ke*(ke+2*C));const Ue=Math.acos(de/(C+ke))-Math.acos(pi(T,ze));de*=Math.cos(Ue)}return 1.01*de})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Ih(e.zoom);if(o>0){const c=IS(e,Ae(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mi(i,c+f*(1-Math.cos(p)),Math.pow(o,10))}return i}upVector(e,i,o){return mm(i,o,e,1)}upVectorScale(e){return{metersToTile:bg(Tg(qc(e)))}}}function LS(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new CS(n);case"equirectangular":return new DL(n);case"naturalEarth":return new kL(n);case"equalEarth":return new LL(n);case"winkelTripel":return new FL(n);case"albers":return i?new OS(n):new OL(n);case"lambertConformalConic":return i?new OS(n):new zL(n);case"globe":return new BL(n)}throw new Error(`Invalid projection name: ${n.name}`)}const NL=Ut.types,UL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kg(n,e,i,o,c,f,p,v,b,T,I,C,O){const B=v?Math.min(Oh,Math.round(v[0])):0,N=v?Math.min(Oh,Math.round(v[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*c),f,p,(B<<1)+(b?1:0),N,16*T,16*I,256*C,256*O)}function Yg(n,e,i){n.emplaceBack(e,i)}function Jg(n,e,i,o,c,f,p){n.emplaceBack(e,i,o,c,f,p)}const Qg=(n,e,i,o)=>{for(let c=0;c<e;c++)n.emplaceBack(i[0],i[1],i[2],o[0],o[1],o[2])};function ey(n,e,i,o,c){n.emplaceBack(e,i,o,c),n.emplaceBack(e,i,o,c),n.emplaceBack(e,i,o,c),n.emplaceBack(e,i,o,c)}function VL(n){for(const e of n.sections)if(qv(e.text))return!0;return!1}class Kx{constructor(e){this.layoutVertexArray=new rm,this.indexArray=new co,this.programConfigurations=e,this.segments=new cs,this.dynamicLayoutVertexArray=new gl,this.opacityVertexArray=new bh,this.placedSymbolArray=new Df,this.iconTransitioningVertexArray=new eo,this.globeExtVertexArray=new sm,this.zOffsetVertexArray=new Nc,this.orientationVertexArray=new ad}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,c,f){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,HO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,WO.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,UL,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,YO.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ZO.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,XO.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,KO.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}yi(Kx,"SymbolBuffers");class Yx{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new cs,this.collisionVertexArray=new am,this.collisionVertexArrayExt=new gl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,JO.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,QO.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yi(Yx,"CollisionBuffers");class ty{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=he([]),this.placementViewportMatrix=he([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=lS(this.zoom,i["text-size"],this.worldview),this.iconSizeData=lS(this.zoom,i["icon-size"],this.worldview);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.lut=e.lut,this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map((p=>Xa[p])),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new Kx(new yl(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new Kx(new yl(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new dg,this.lineVertexArray=new fg,this.symbolInstances=new hg}calculateGlyphDependencies(e,i,o,c,f){for(const p of e){const v=p.codePointAt(0);if(v===void 0)break;if(i[v]=!0,c&&f&&v<=65535){const b=Dm[p];b&&(i[b.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Mg(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,c){const f=this.layers[0],p=f.layout,v=this.projection.name==="globe",b=p.get("text-font"),T=p.get("text-field"),I=p.get("icon-image"),[C,O]=p.get("icon-size-scale-range"),B=Le(i.scaleFactor||1,C,O),N=(T.value.kind!=="constant"||T.value.value instanceof Ks&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),X=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,K=p.get("symbol-sort-key");if(this.features=[],!N&&!X)return;const Y=i.iconDependencies,ue=i.glyphDependencies,de=i.availableImages,_e=new Nr(this.zoom,{worldview:this.worldview});for(const{feature:ze,id:ke,index:Ue,sourceLayerIndex:qe}of e){const Ze=f._featureFilter.needGeometry,Et=qt(ze,Ze);if(!f._featureFilter.filter(_e,Et,o))continue;if(Ze||(Et.geometry=hi(ze,o,c)),v&&ze.type!==1&&o.z<=5){const Ft=Et.geometry,Gt=.98078528056,Tt=(Bt,ht)=>pi(mm(Bt.x,Bt.y,o,1),mm(ht.x,ht.y,o,1))<Gt;for(let Bt=0;Bt<Ft.length;Bt++)Ft[Bt]=bt(Ft[Bt],Tt)}let Je,Ot;if(N){const Ft=f.getValueAndResolveTokens("text-field",Et,o,de),Gt=Ks.factory(Ft);VL(Gt)&&(this.hasRTLText=!0),(!this.hasRTLText||bf()==="unavailable"||this.hasRTLText&&kl.isParsed())&&(Je=tL(Gt,f,Et))}if(X){const Ft=f.getValueAndResolveTokens("icon-image",Et,o,de);Ot=typeof Ft=="string"?Mo.build(Ft):Ft}if(!Je&&!Ot)continue;const jt=this.sortFeaturesByKey?K.evaluate(Et,{},o):void 0,Lt={id:ke,text:Je,icon:Ot,index:Ue,sourceLayerIndex:qe,geometry:Et.geometry,properties:ze.properties,type:NL[ze.type],sortKey:jt};if(this.features.push(Lt),Ot){const Ft=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Gt,iconSecondary:Tt}=TS(Ot,this.iconSizeData,Ft["icon-size"],o,this.zoom,Lt,this.pixelRatio,B,this.worldview),Bt=Gt.id.toString();if(Y.has(Bt)?Y.get(Bt).push(Gt):Y.set(Bt,[Gt]),Tt){this.hasAnySecondaryIcon=!0;const ht=Tt.id.toString();Y.has(ht)?Y.get(ht).push(Tt):Y.set(ht,[Tt])}}if(Je){const Ft=b.evaluate(Et,{},o).join(","),Gt=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xa.vertical)>=0;for(const Tt of Je.sections)if(Tt.image){const Bt=Tt.image.getPrimary().scaleSelf(this.pixelRatio),ht=Bt.id.toString(),at=Y.get(ht)||[];at.push(Bt),Y.set(ht,at)}else{const Bt=Wp(Je.toString()),ht=Tt.fontStack||Ft,at=ue[ht]=ue[ht]||{};this.calculateGlyphDependencies(Tt.text,at,Gt,this.allowVerticalPlacement,Bt)}}}if(p.get("symbol-placement")==="line"&&(this.features=(function(ze){const ke={},Ue={},qe=[];let Ze=0;function Et(Lt){qe.push(ze[Lt]),Ze++}function Je(Lt,Ft,Gt){const Tt=Ue[Lt];return delete Ue[Lt],Ue[Ft]=Tt,qe[Tt].geometry[0].pop(),qe[Tt].geometry[0]=qe[Tt].geometry[0].concat(Gt[0]),Tt}function Ot(Lt,Ft,Gt){const Tt=ke[Ft];return delete ke[Ft],ke[Lt]=Tt,qe[Tt].geometry[0].shift(),qe[Tt].geometry[0]=Gt[0].concat(qe[Tt].geometry[0]),Tt}function jt(Lt,Ft,Gt){const Tt=Gt?Ft[0][Ft[0].length-1]:Ft[0][0];return`${Lt}:${Tt.x}:${Tt.y}`}for(let Lt=0;Lt<ze.length;Lt++){const Ft=ze[Lt],Gt=Ft.geometry,Tt=Ft.text?Ft.text.toString():null;if(!Tt){Et(Lt);continue}const Bt=jt(Tt,Gt),ht=jt(Tt,Gt,!0);if(Bt in Ue&&ht in ke&&Ue[Bt]!==ke[ht]){const at=Ot(Bt,ht,Gt),Ht=Je(Bt,ht,qe[at].geometry);delete ke[Bt],delete Ue[ht],Ue[jt(Tt,qe[Ht].geometry,!0)]=Ht,qe[at].geometry=null}else Bt in Ue?Je(Bt,ht,Gt):ht in ke?Ot(Bt,ht,Gt):(Et(Lt),ke[Bt]=Ze-1,Ue[ht]=Ze-1)}return qe.filter((Lt=>Lt.geometry))})(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ze of i.elevationFeatures)this.elevationFeatureIdToIndex.set(ze.id,this.elevationFeatures.length),this.elevationFeatures.push(ze)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((ze,ke)=>ze.sortKey-ke.sortKey))}update(e,i,o,c,f,p,v){this.text.programConfigurations.updatePaintArrays(e,i,f,o,c,p,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,f,o,c,p,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const o=et(e),c=1/o;let f=!1,p=!1;for(let v=0;v<this.symbolInstances.length;v++){const b=this.symbolInstances.get(v),T=tt(1,0,0),I=tt(0,1,0),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:O,numIconVertices:B,numVerticalIconVertices:N}=b,X=C>0||O>0,K=B>0,Y=this.elevationFeatures[b.elevationFeatureIndex];if(Y){const ue=new kt(b.tileAnchorX,b.tileAnchorY),de=.075+Y.pointElevation(ue);b.zOffset!==de&&(i=!0,b.zOffset=de);const _e=Y.computeSlopeNormal(ue,c),ze=is(vi(),tt(0,0,1),_e);Qi(T,T,ze),Qi(I,I,ze),T[2]*=o,I[2]*=o,T[0]===1&&T[1]===0&&T[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(f=f||X,p=p||K)}if(X&&(Qg(this.text.orientationVertexArray,C,T,I),Qg(this.text.orientationVertexArray,O,T,I)),K){const{placedIconSymbolIndex:ue,verticalPlacedIconSymbolIndex:de}=b;ue>=0&&Qg(this.icon.orientationVertexArray,B,T,I),de>=0&&Qg(this.icon.orientationVertexArray,N,T,I)}}f||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,p,v)=>{o+=p,o>f.length&&f.resize(o);for(let b=-p;b<0;b++)f.emplace(b+o,v)},i=(f,p,v)=>{c+=p,c>f.length&&f.resize(c);for(let b=-p;b<0;b++)f.emplace(b+c,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,c=0;for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:b,numIconVertices:T}=p,I=p.zOffset,C=T>0;if((v>0||b>0)&&(e(this.text.zOffsetVertexArray,v,I),e(this.text.zOffsetVertexArray,b,I)),C){const{placedIconSymbolIndex:O,verticalPlacedIconSymbolIndex:B}=p;O>=0&&i(this.icon.zOffsetVertexArray,T,I),B>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=LS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:f}of i)this.lineVertexArray.emplaceBack(c,f);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,c,f,p,v,b,T,I,C,O,B,N,X,K){const Y=e.indexArray,ue=e.layoutVertexArray,de=e.globeExtVertexArray,_e=e.segments.prepareSegment(4*i.length,ue,Y,this.canOverlap?p.sortKey:void 0),ze=this.glyphOffsetArray.length,ke=_e.vertexLength,Ue=this.allowVerticalPlacement&&v===Xa.vertical?Math.PI/2:0,qe=p.text&&p.text.sections;for(let Et=0;Et<i.length;Et++){const{tl:Je,tr:Ot,bl:jt,br:Lt,texPrimary:Ft,texSecondary:Gt,pixelOffsetTL:Tt,pixelOffsetBR:Bt,minFontScaleX:ht,minFontScaleY:at,glyphOffset:Ht,isSDF:$t,sectionIndex:Vi}=i[Et],gi=_e.vertexLength,Ci=Ht[1];if(Kg(ue,T.x,T.y,Je.x,Ci+Je.y,Ft.x,Ft.y,o,$t,Tt.x,Tt.y,ht,at),Kg(ue,T.x,T.y,Ot.x,Ci+Ot.y,Ft.x+Ft.w,Ft.y,o,$t,Bt.x,Tt.y,ht,at),Kg(ue,T.x,T.y,jt.x,Ci+jt.y,Ft.x,Ft.y+Ft.h,o,$t,Tt.x,Bt.y,ht,at),Kg(ue,T.x,T.y,Lt.x,Ci+Lt.y,Ft.x+Ft.w,Ft.y+Ft.h,o,$t,Bt.x,Bt.y,ht,at),b){const{x:Yt,y:Ni,z:ln}=b.anchor,[oi,zi,tn]=b.up;Jg(de,Yt,Ni,ln,oi,zi,tn),Jg(de,Yt,Ni,ln,oi,zi,tn),Jg(de,Yt,Ni,ln,oi,zi,tn),Jg(de,Yt,Ni,ln,oi,zi,tn),ey(e.dynamicLayoutVertexArray,Yt,Ni,ln,Ue)}else ey(e.dynamicLayoutVertexArray,T.x,T.y,T.z,Ue);if(K){const Yt=Gt||Ft;Yg(e.iconTransitioningVertexArray,Yt.x,Yt.y),Yg(e.iconTransitioningVertexArray,Yt.x+Yt.w,Yt.y),Yg(e.iconTransitioningVertexArray,Yt.x,Yt.y+Yt.h),Yg(e.iconTransitioningVertexArray,Yt.x+Yt.w,Yt.y+Yt.h)}Y.emplaceBack(gi,gi+1,gi+2),Y.emplaceBack(gi+1,gi+2,gi+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ht[0]),Et!==i.length-1&&Vi===i[Et+1].sectionIndex||e.programConfigurations.populatePaintArrays(ue.length,p,p.index,{},B,N,X,qe&&qe[Vi],this.worldview)}const Ze=b?b.anchor:T;e.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,T.x,T.y,ze,this.glyphOffsetArray.length-ze,ke,I,C,T.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],v,0,0,0,O,0)}_commitLayoutVertex(e,i,o,c,f,p,v){e.emplaceBack(i,o,c,f,p,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,o,c,f,p,v){const b=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),T=b.vertexLength,I=v.tileAnchorX,C=v.tileAnchorY;for(let B=0;B<4;B++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(o.layoutVertexArray,c,f,p,I,C,new kt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,f,p,I,C,new kt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,f,p,I,C,new kt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,f,p,I,C,new kt(e.x1,e.y2)),b.vertexLength+=4;const O=o.indexArray;O.emplaceBack(T,T+1),O.emplaceBack(T+1,T+2),O.emplaceBack(T+2,T+3),O.emplaceBack(T+3,T),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,c,f,p){for(let v=c;v<f;v++){const b=o.get(v),T=this.getSymbolInstanceTextSize(e,p,i,v);this._addCollisionDebugVertices(b,T,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,o,c,f,p){for(let v=c;v<f;v++){const b=o.get(v),T=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(b,T,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Yx(Cf,ZT.members,eo),this.iconCollisionBox=new Yx(Cf,ZT.members,eo);const c=km(this.iconSizeData,e),f=km(this.textSizeData,e,o);for(let p=0;p<this.symbolInstances.length;p++){const v=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(f,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(c,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,o,c){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),p=$x(this.textSizeData,e,f)/Lo;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,o){const c=this.icon.placedSymbolArray.get(o),f=$x(this.iconSizeData,e,c);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,o,c){e.emplaceBack(i,-o,-o,c),e.emplaceBack(i,o,-o,c),e.emplaceBack(i,o,o,c),e.emplaceBack(i,-o,o,c)}_updateTextDebugCollisionBoxes(e,i,o,c,f,p,v){for(let b=c;b<f;b++){const T=o.get(b),I=this.getSymbolInstanceTextSize(e,p,i,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,T.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,c,f,p,v){for(let b=c;b<f;b++){const T=o.get(b),I=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,T.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i,o,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=km(this.iconSizeData,e,c),p=km(this.textSizeData,e,o);for(let v=0;v<this.symbolInstances.length;v++){const b=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(p,e,i,b.textBoxStartIndex,b.textBoxEndIndex,b,o),this._updateTextDebugCollisionBoxes(p,e,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,o),this._updateIconDebugCollisionBoxes(f,e,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b,c),this._updateIconDebugCollisionBoxes(f,e,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,c,f,p,v,b,T){const I={};if(i<o){const{x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e,featureIndex:ze}=e.get(i);I.textBox={x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e},I.textFeatureIndex=ze}if(c<f){const{x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e,featureIndex:ze}=e.get(c);I.verticalTextBox={x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e},I.verticalTextFeatureIndex=ze}if(p<v){const{x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e,featureIndex:ze}=e.get(p);I.iconBox={x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e},I.iconFeatureIndex=ze}if(b<T){const{x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e,featureIndex:ze}=e.get(b);I.verticalIconBox={x1:C,y1:O,x2:B,y2:N,padding:X,projectedAnchorX:K,projectedAnchorY:Y,projectedAnchorZ:ue,tileAnchorX:de,tileAnchorY:_e},I.verticalIconFeatureIndex=ze}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<c;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),c=[],f=[],p=[];for(let v=0;v<this.symbolInstances.length;++v){p.push(v);const b=this.symbolInstances.get(v);c.push(0|Math.round(i*b.tileAnchorX+o*b.tileAnchorY)),f.push(b.featureIndex)}return p.sort(((v,b)=>c[v]-c[b]||f[b]-f[v])),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:T}=o;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&p!==c&&this.addIndicesForPlacedSymbol(this.text,p),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let DS,zS,Jx;yi(ty,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ty.addDynamicAttributes=ey;class kS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:xa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yi(kS,"FormatSectionOverride",{omit:["defaultValue"]});const Qx=()=>Jx||(Jx={layout:DS||(DS=new xs({"symbol-placement":new Wt(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Wt(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wt(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new li(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wt(Ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Wt(Ye.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Wt(Ye.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Wt(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Wt(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wt(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wt(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new li(Ye.layout_symbol["icon-size"]),"icon-size-scale-range":new Wt(Ye.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new li(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new li(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new li(Ye.layout_symbol["icon-image"]),"icon-image-use-theme":new Wt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new li(Ye.layout_symbol["icon-rotate"]),"icon-padding":new Wt(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Wt(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new li(Ye.layout_symbol["icon-offset"]),"icon-anchor":new li(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wt(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wt(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wt(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new li(Ye.layout_symbol["text-field"]),"text-font":new li(Ye.layout_symbol["text-font"]),"text-size":new li(Ye.layout_symbol["text-size"]),"text-size-scale-range":new Wt(Ye.layout_symbol["text-size-scale-range"]),"text-max-width":new li(Ye.layout_symbol["text-max-width"]),"text-line-height":new li(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new li(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new li(Ye.layout_symbol["text-justify"]),"text-radial-offset":new li(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wt(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new li(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Wt(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Wt(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new li(Ye.layout_symbol["text-rotate"]),"text-padding":new Wt(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Wt(Ye.layout_symbol["text-keep-upright"]),"text-transform":new li(Ye.layout_symbol["text-transform"]),"text-offset":new li(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Wt(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Wt(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Wt(Ye.layout_symbol["text-optional"]),visibility:new Wt(Ye.layout_symbol.visibility)})),paint:zS||(zS=new xs({"icon-opacity":new li(Ye.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new li(Ye.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new li(Ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new li(Ye.paint_symbol["text-emissive-strength"]),"icon-color":new li(Ye.paint_symbol["icon-color"]),"icon-halo-color":new li(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new li(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new li(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Wt(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wt(Ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Wt(Ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new li(Ye.paint_symbol["text-opacity"]),"text-occlusion-opacity":new li(Ye.paint_symbol["text-occlusion-opacity"]),"text-color":new li(Ye.paint_symbol["text-color"],{runtimeType:Yr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new li(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new li(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new li(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Wt(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Wt(Ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Wt(Ye.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Wt(Ye.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Wt(Ye.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Wt(Ye.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new li(Ye.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},Jx);class iy extends Qo{constructor(e,i,o,c){super(e,Qx(),i,o,c,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=he([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const f of o)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,c){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===c||(this._colorAdjustmentMatrix=(function(f,p,v,b){f=zs(f),p=gs(p);const T=se(),I=f/3,C=1-2*I,O=[C,I,I,0,I,C,I,0,I,I,C,0,0,0,0,1],B=.5-.5*p,N=b-v;return Se(T,[N,0,0,0,0,N,0,0,0,0,N,0,v,v,v,1],[p,0,0,0,0,p,0,0,0,0,p,0,B,B,B,1]),Se(T,T,O),T})(e,i,o,c),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,c){const f=this.layout.get(e).evaluate(i,{},o,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Gp(p.value)||!f?f:(function(v,b){return b.replace(/{([^{}]+)}/g,((T,I)=>I in v?String(v[I]):""))})(i.properties,f)}createBucket(e){return new ty(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Qx().paint.overridableProperties){if(!iy.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new kS(i),c=new pf(o,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new id("source",c):new Lc("composite",c,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Pu(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&iy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),c=Qx().paint.properties[i];let f=!1;const p=v=>{for(const b of v)if(c.overrides&&c.overrides.hasOverride(b))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Ks)p(o.value.value.sections);else if(o.value.kind==="source"){const v=T=>{f||(T instanceof cn&&$s(T.value)===q?p(T.value.sections):T instanceof Yo?p(T.sections):T.eachChild(v))},b=o.value;b._styleExpression&&v(b._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new zu(this,{zoom:i,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let FS,BS,NS,US;var e0=qn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function ny(n,e,i,o,c,f,p,v){const b=[n,e,1,i,o,1,c,f,1],T=[p,v,1],I=le([],b),[C,O,B]=un(T,T,I);return pe(b,b,[C,0,0,0,O,0,0,0,B])}function VS(n,e,i,o,c,f,p,v){const b=(function(T,I,C,O,B,N,X,K){const Y=ny(0,0,1,0,1,1,0,1),ue=ny(T,I,C,O,B,N,X,K);return pe(ue,ue,le([],Y))})(n,e,i,o,c,f,p,v);return[b[2]/b[8]/Zt,b[5]/b[8]/Zt]}function ry(n){return[n[0],Math.min(Math.max(n[1],-Re),Re)]}class jS extends ys{constructor(e,i,o,c){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ii("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ms(this.map._requestManager.transformRequest(this.url,fr.Image),((o,c)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Xr(o)):c&&(this.image=c instanceof HTMLImageElement?oo.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Rm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ii("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Rm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const f of e)f[1]>o&&(o=f[1]),f[1]<i&&(i=f[1]);const c=(o+i)/2;if(c>Re?this.onNorthPole=!0:c<-Re&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(pt.fromLngLat);this.tileID=(function(p){let v=1/0,b=1/0,T=-1/0,I=-1/0;for(const X of p)v=Math.min(v,X.x),b=Math.min(b,X.y),T=Math.max(T,X.x),I=Math.max(I,X.y);const C=Math.max(T-v,I-b),O=Math.max(0,Math.floor(-Math.log2(C))),B=Math.pow(2,O);let N=Math.floor((v+T)/2*B);return N>1&&(N-=1),new hc(O,N,Math.floor((b+I)/2*B))})(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ii("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Rm||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const Y in this.tiles){const ue=this.tiles[Y];ue.state!=="loaded"&&(ue.state="loaded",ue.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Um(new hc(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(Y){const ue=Y[1].x-Y[0].x,de=Y[1].y-Y[0].y,_e=Y[2].x-Y[1].x,ze=Y[2].y-Y[1].y,ke=Y[3].x-Y[2].x,Ue=Y[3].y-Y[2].y,qe=Y[0].x-Y[3].x,Ze=Y[0].y-Y[3].y,Et=ue*ze-_e*de,Je=_e*Ue-ke*ze,Ot=ke*Ze-qe*Ue,jt=qe*de-ue*Ze;return Et>0&&Je>0&&Ot>0&&jt>0||Et<0&&Je<0&&Ot<0&&jt<0})(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=Um(this.tileID,this.map.transform.projection),[f,p,v,b]=this.coordinates.map((Y=>{const ue=c.projection.project(Y[0],Y[1]);return PS(c,ue)._round()}));this.perspectiveTransform=VS(f.x,f.y,p.x,p.y,v.x,v.y,b.x,b.y);const T=this._boundsArray=new Ou;T.emplaceBack(f.x,f.y,0,0),T.emplaceBack(p.x,p.y,Zt,0),T.emplaceBack(b.x,b.y,0,Zt),T.emplaceBack(v.x,v.y,Zt,Zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,e0.members),this.boundsSegments=cs.simpleSegment(0,0,4,2);const I=[],C=[ry((O=this.coordinates)[0]),ry(O[1]),ry(O[2]),ry(O[3])];var O;const[B,N,X,K]=(function(Y){let ue=Y[0][0],de=ue,_e=Y[0][1],ze=_e;for(let ke=1;ke<Y.length;ke++)Y[ke][0]<ue?ue=Y[ke][0]:Y[ke][0]>de&&(de=Y[ke][0]),Y[ke][1]<_e?_e=Y[ke][1]:Y[ke][1]>ze&&(ze=Y[ke][1]);return[ue,_e,de-ue,ze-_e]})(C);{const Y=new Ou,[ue,de,_e,ze]=(function(Tt){let Bt=Tt[0].x,ht=Bt,at=Tt[0].y,Ht=at;for(let $t=1;$t<Tt.length;$t++)Tt[$t].x<Bt?Bt=Tt[$t].x:Tt[$t].x>ht&&(ht=Tt[$t].x),Tt[$t].y<at?at=Tt[$t].y:Tt[$t].y>Ht&&(Ht=Tt[$t].y);return[Bt,at,ht-Bt,Ht-at]})(o),ke=Tt=>[(Tt.x-ue)/_e,(Tt.y-de)/ze],[Ue,qe,Ze,Et]=o.map(ke),Je=(function(Tt,Bt,ht,at,Ht,$t,Vi,gi){const Ci=ny(0,0,1,0,1,1,0,1);return pe(Ci,Ci,le([],ny(Tt,Bt,ht,at,Ht,$t,Vi,gi)))})(Ue[0],Ue[1],qe[0],qe[1],Ze[0],Ze[1],Et[0],Et[1]);this.elevatedGlobePerspectiveTransform=VS(Ue[0],Ue[1],qe[0],qe[1],Ze[0],Ze[1],Et[0],Et[1]);const Ot=(Tt,Bt)=>{I.push(Tt.lng);const ht=Math.round((Tt.lng-B)/X*Zt),at=Math.round((Tt.lat-N)/K*Zt),Ht=ke(Bt),$t=un([],[Ht[0],Ht[1],1],Je),Vi=Math.round($t[0]/$t[2]*Zt),gi=Math.round($t[1]/$t[2]*Zt);Y.emplaceBack(ht,at,Vi,gi)},jt=o[3].x-o[0].x,Lt=o[3].y-o[0].y,Ft=o[2].x-o[1].x,Gt=o[2].y-o[1].y;for(let Tt=0;Tt<65;Tt++){const Bt=Tt/64,ht=[o[0].x+Bt*jt,o[0].y+Bt*Lt],at=[o[1].x+Bt*Ft,o[1].y+Bt*Gt],Ht=at[0]-ht[0],$t=at[1]-ht[1];for(let Vi=0;Vi<65;Vi++){const gi=Vi/64,Ci={x:ht[0]+Ht*gi,y:ht[1]+$t*gi};Ot(i.projection.unproject(Ci.x,Ci.y),Ci)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(Y,e0.members)}{this.maxLongitudeTriangleSize=0;let Y=[],ue=new co;const de=(_e,ze,ke)=>{ue.emplaceBack(_e,ze,ke);const Ue=I[_e],qe=I[ze],Ze=I[ke],Et=Math.min(Math.min(Ue,qe),Ze),Je=Math.max(Math.max(Ue,qe),Ze)-Et;Je>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Je),Y.push(Et+Je/2)};for(let _e=0;_e<64;_e++)for(let ze=0;ze<64;ze++){const ke=65*_e+ze,Ue=ke+1,qe=ke+65,Ze=qe+1;de(ke,qe,Ue),de(Ue,qe,Ze)}[Y,ue]=(function(_e,ze){const ke=Array.from({length:_e.length},((Ze,Et)=>Et));ke.sort(((Ze,Et)=>_e[Ze]-_e[Et]));const Ue=[],qe=new co;for(let Ze=0;Ze<ke.length;Ze++){const Et=ke[Ze];Ue.push(_e[Et]);const Je=3*Et,Ot=Je+1;qe.emplaceBack(ze.uint16[Je],ze.uint16[Ot],ze.uint16[Ot+1])}return[Ue,qe]})(Y,ue),this.elevatedGlobeTrianglesCenterLongitudes=Y,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ue)}this.elevatedGlobeSegments=cs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,X/Zt,0,K/Zt,0,0,N,B,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof Rm||(this.texture?this.texture.update(this.image):(this.texture=new Px(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let c=(f=e+180)+360*Math.round((o[0]-f)/360);var f;const p=new cs,v=(C,O)=>{p.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:i.segments[0].vertexLength,primitiveLength:O,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-c)<=b){const C=ps(o,0,o.length,c+b);return C===o.length||v(C,Gn(o,C+1,o.length,c+360-b)-C),p}c<o[0]&&(c+=360);const T=Gn(o,0,o.length,c-b);if(T===o.length)return v(0,o.length),p;v(0,T-0);const I=ps(o,T+1,o.length,c+b);return I!==o.length&&v(I,o.length-I),p}}const jL=(Math.pow(256,2)-1)/16907520;class $S extends Qo{constructor(e,i,o,c){super(e,{layout:NS||(NS=new xs({visibility:new Wt(Ye.layout_raster.visibility)})),paint:US||(US=new xs({"raster-opacity":new Wt(Ye.paint_raster["raster-opacity"]),"raster-color":new _h(Ye.paint_raster["raster-color"]),"raster-color-mix":new Wt(Ye.paint_raster["raster-color-mix"]),"raster-color-range":new Wt(Ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Wt(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wt(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wt(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Wt(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Wt(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Wt(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Wt(Ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Wt(Ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Wt(Ye.paint_raster["raster-array-band"]),"raster-elevation":new Wt(Ye.paint_raster["raster-elevation"]),"raster-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof jS&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(c)||o===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=_m({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,c])}}let qS,GS,HS,ZS,WS;class XS extends Qo{constructor(e,i,o,c){super(e,{layout:qS||(qS=new xs({visibility:new Wt(Ye["layout_raster-particle"].visibility)})),paint:GS||(GS=new xs({"raster-particle-array-band":new Wt(Ye["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Wt(Ye["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new _h(Ye["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Wt(Ye["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Wt(Ye["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Wt(Ye["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Wt(Ye["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Wt(Ye["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this._updateColorRamp(),this.lastInvalidatedAt=oo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=_m({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=oo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class $L extends Qo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function t0(n,e,i){const o=[0,0,1],c=sn([]);return $i(c,c,i?-Xe(n)+Math.PI:Xe(n)),Hi(c,c,-Xe(e)),Qi(o,o,c),Pt(o,o)}const KS={None:0,Model:1,Symbol:2,FillExtrusion:4};class sy{constructor(e,i,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function i0(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class YS{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class JS{constructor(){this.instancedDataArray=new um,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class n0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,o,c){this.tileToMeter=et(o);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:v,index:b,sourceLayerIndex:T}of e){const I=v??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),C=qt(p,f);if(!this.layers[0]._featureFilter.filter(new Nr(this.zoom,{worldview:this.worldview}),C,o))continue;const O={id:I,sourceLayerIndex:T,index:b,geometry:f?C.geometry:hi(p,o,c),properties:p.properties,type:p.type,patterns:{}},B=this.addFeature(O,O.geometry,C);B&&i.featureIndex.insert(p,O.geometry,b,T,this.index,this.instancesPerModel[B].instancedDataArray.length,Zt/32)}this.lookup=null}update(e,i,o,c){for(const f in this.instancesPerModel){const p=this.instancesPerModel[f];for(const v in e)p.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(p.features[p.idToFeaturesIndex[v]],e[v],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const c of o.features){const f=this.layers[0],p=c.feature,v=this.canonical,b=f.paint.get("model-rotation").evaluate(p,{},v),T=f.paint.get("model-scale").evaluate(p,{},v),I=f.paint.get("model-translation").evaluate(p,{},v);lt(c.rotation,b)&&lt(c.scale,T)&&lt(c.translation,I)||(this.evaluate(c,c.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,c){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Mg(this.activeReplacements,f))return!1;this.activeReplacements=f;let p=!1;for(const v in this.instancesPerModel){const b=this.instancesPerModel[v],T=b.instancedDataArray;for(const I of b.features){const C=I.instancedDataOffset,O=I.instancedDataCount;for(let B=0;B<O;B++){const N=16*(B+C);let X=T.float32[N+0];const K=X>Zt;X=K?X-Zt:X;const Y=Math.floor(X),ue=T.float32[N+1];let de=!1;for(const _e of this.activeReplacements)if(!B1(_e,o,KS.Model,c)&&!(_e.min.x>Y||Y>_e.max.x||_e.min.y>ue||ue>_e.max.y)&&(de=_x(j1(Y,ue,e.canonical,_e.footprintTileId.canonical),_e.footprint),de))break;T.float32[N]=de?X+Zt:X,p=p||de!==K}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,yO.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,o){const c=this.layers[0],f=c.layout.get("model-id").evaluate(o,{},this.canonical);if(!f)return An(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),f;(i0(f,!1)||this.styleDefinedModelURLs[f]!==void 0)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new JS);const p=this.instancesPerModel[f],v=p.instancedDataArray,b=new YS(o,v.length);for(const T of i)for(const I of T){if(I.x<0||I.x>=Zt||I.y<0||I.y>=Zt)continue;if(this.lookupDim!==0){const O=(this.lookupDim-1)/Zt,B=this.lookupDim*(I.y*O|0)+I.x*O|0;if(this.lookup){if(this.lookup[B]!==0)continue;this.lookup[B]=1}}this.instanceCount++;const C=v.length;v.resize(C+1),p.instancesEvaluatedElevation.push(0),v.float32[16*C]=I.x,v.float32[16*C+1]=I.y}return b.instancedDataCount=p.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(b),this.evaluate(b,{},p,!1)),f}getModelUris(){return this.modelUris}evaluate(e,i,o,c){const f=this.layers[0],p=e.feature,v=this.canonical,b=e.rotation=f.paint.get("model-rotation").evaluate(p,i,v),T=e.scale=f.paint.get("model-scale").evaluate(p,i,v),I=e.translation=f.paint.get("model-translation").evaluate(p,i,v),C=f.paint.get("model-color").evaluate(p,i,v);C.a=f.paint.get("model-color-mix-intensity").evaluate(p,i,v);const O=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),TT(O,b,T);const B=Math.round(100*C.a)+C.b/1.05;for(let N=0;N<e.instancedDataCount;++N){const X=e.instancedDataOffset+N,K=16*X,Y=o.instancedDataArray.float32;let ue=0;c&&(ue=Y[K+6]-o.instancesEvaluatedElevation[X]);const de=0|Y[K+1];Y[K]=(0|Y[K])+C.r/1.05,Y[K+1]=de+C.g/1.05,Y[K+2]=B,Y[K+3]=1/(v.z>10?this.tileToMeter:et(v,de)),Y[K+4]=I[0],Y[K+5]=I[1],Y[K+6]=I[2]+ue,Y[K+7]=O[0],Y[K+8]=O[1],Y[K+9]=O[2],Y[K+10]=O[4],Y[K+11]=O[5],Y[K+12]=O[6],Y[K+13]=O[8],Y[K+14]=O[9],Y[K+15]=O[10],o.instancesEvaluatedElevation[X]=I[2]}}}let QS,eE;yi(n0,"ModelBucket",{omit:["layers"]}),yi(JS,"PerModelAttributes"),yi(YS,"ModelFeature");class Yf{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const c=o||e.findDEMTileFor(i);if(!c||!c.dem)return;const f=c.dem,p=c.tileID,v=1<<i.canonical.z-p.canonical.z;return new Yf(c,f.dim/Zt/v,[(i.canonical.x/v-p.canonical.x)*f.dim,(i.canonical.y/v-p.canonical.y)*f.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1];return new kt(Math.floor(e*this._scale+this._offset[0]),Math.floor(o))}getElevationAt(e,i,o,c){const f=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],v=Math.floor(f),b=Math.floor(p),T=this._dem;return c=!!c,o?Mi(Mi(T.get(v,b,c),T.get(v,b+1,c),p-b),Mi(T.get(v+1,b,c),T.get(v+1,b+1,c),p-b),f-v):T.get(v,b,c)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ae(1,e)*this._dem.stride}}const r0=new Float32Array(262144),Td=new Uint8Array(262144);function tE(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,tE(i));return e}function iE(n,e,i){if(n.meshes)for(const o of n.meshes){if(o.aabb.min[0]===1/0)continue;const c=nn.applyTransform(o.aabb,n.matrix);i.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(n.children)for(const o of n.children)iE(o,e,i)}const nE=["","wall","door","roof","window","lamp","logo"];class rE{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:tE(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=nn.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class oy{constructor(e,i,o,c,f,p,v,b){this.id=o,this.layers=e,this.layerIds=this.layers.map((T=>T.fqid)),this.stateDependentLayerIds=this.layers.filter((T=>T.isStateDependent())).map((T=>T.id)),this.modelTraits|=Gf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=Gf.HasMapboxMeshFeatures),f&&(this.modelTraits|=Gf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of i)this.nodesInfo.push(new rE(T)),iE(T,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const c=o.node;c.footprint&&i.push({footprint:c.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!ls(e,this.states))for(const c of o)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const c=o.node;this.uploaded?this.updatePbrBuffer(c):Rx(c,e,!0)}for(const o of i)Ug(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const c=e.transform.projectionOptions,f=e.style.getBrightness(),p=this.brightness!==f;if(!this.uploaded||this.dirty||c.name!==this.projection.name||Gm(o.paint.get("model-color").value,p)||Gm(o.paint.get("model-color-mix-intensity").value,p)||Gm(o.paint.get("model-roughness").value,p)||Gm(o.paint.get("model-emissive-strength").value,p)||Gm(o.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=c,this.brightness=f;const v=this.getNodesInfo();for(const b of v)b.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),c=this.id.canonical;for(const f of o){const p=f.feature;f.evaluatedTranslation=i.paint.get("model-translation").evaluate(p,{},c),f.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},c)}}evaluate(e,i){const o=this.getNodesInfo();for(const c of o){if(!c.node.meshes)continue;const f=c.feature,p=i&&i[f.id];if(ls(p,c.state))continue;c.state=structuredClone(p);const v=c.node.meshes&&c.node.meshes[0].featureData,b=c.evaluatedColor[2],T=c.evaluatedRMEA[2],I=this.id.canonical;if(c.hasTranslucentParts=!1,v){for(let C=0;C<nE.length;C++){const O=nE[C];O.length&&(f.properties.part=O);const B=e.paint.get("model-color").evaluate(f,p,I).toPremultipliedRenderColor(null),N=e.paint.get("model-color-mix-intensity").evaluate(f,p,I);c.evaluatedColor[C]=[B.r,B.g,B.b,N],c.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(f,p,I),c.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(f,p,I),c.evaluatedRMEA[C][3]=B.a,c.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,p,I),!c.hasTranslucentParts&&B.a<1&&(c.hasTranslucentParts=!0)}delete f.properties.part,GL(c,b!==c.evaluatedColor[2]||T!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,p,I);c.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,p,I),c.evaluatedScale=e.paint.get("model-scale").evaluate(f,p,I),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,c){const f=e.findDEMTileFor(o);if(f&&(f.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const p=Yf.create(e,o,f);if(!p)return;this.modelTraits&Gf.HasMapboxMeshFeatures&&this.updateDEM(e,p,o,c);for(const v of this.getNodesInfo()){const b=v.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const T=b.footprint.vertices;let I=p.getElevationAt(T[0].x,T[0].y,!0,!0);for(let C=1;C<T.length;C++)I=Math.min(I,p.getElevationAt(T[C].x,T[C].y,!0,!0));b.elevation=I}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,c){let f=i._dem._modifiedForSources[c];if(f===void 0&&(i._dem._modifiedForSources[c]=[],f=i._dem._modifiedForSources[c]),f.includes(o.canonical))return;const p=i._dem.dim;f.push(o.canonical);let v=!1;for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.grid)continue;const I=T.footprint.grid,C=i.tileCoordToPixel(I.min.x,I.min.y),O=i.tileCoordToPixel(I.max.x,I.max.y),B=Math.min(Math.min(p-O.y,C.x),Math.min(C.y,p-O.x));if(B<0)continue;const N=Le(B,2,5);let X=Math.max(0,C.x-N),K=Math.max(0,C.y-N),Y=Math.min(O.x+N,p-1),ue=Math.min(O.y+N,p-1);for(let ke=K;ke<=ue;++ke)for(let Ue=X;Ue<=Y;++Ue)Td[ke*p+Ue]=255;let de=0,_e=0;for(let ke=0;ke<I.cellsY;++ke)for(let Ue=0;Ue<I.cellsX;++Ue){if(!I.cells[ke*I.cellsX+Ue])continue;const qe=i.tileCoordToPixel(I.min.x+Ue/I.xScale,I.min.y+ke/I.yScale),Ze=i.tileCoordToPixel(I.min.x+(Ue+1)/I.xScale,I.min.y+(ke+1)/I.yScale);for(let Et=qe.y;Et<=Math.min(Ze.y+1,p-1);++Et)for(let Je=qe.x;Je<=Math.min(Ze.x+1,p-1);++Je)Td[Et*p+Je]===255&&(Td[Et*p+Je]=0,de+=i.getElevationAtPixel(Je,Et),_e++)}const ze=de/_e;X=Math.max(1,C.x-N),K=Math.max(1,C.y-N),Y=Math.min(O.x+N,p-2),ue=Math.min(O.y+N,p-2),v=!0;for(let ke=K;ke<=ue;++ke)for(let Ue=X;Ue<=Y;++Ue)Td[ke*p+Ue]===0&&(r0[ke*p+Ue]=i._dem.set(Ue,ke,ze));for(let ke=1;ke<N;++ke){X=Math.max(1,C.x-ke),K=Math.max(1,C.y-ke),Y=Math.min(O.x+ke,p-2),ue=Math.min(O.y+ke,p-2);for(let Ue=K;Ue<=ue;++Ue)for(let qe=X;qe<=Y;++qe){const Ze=Ue*p+qe;if(Td[Ze]===255){let Et=0,Je=0,Ot=-1,jt=-1;for(let Lt=-1;Lt<=1;++Lt)for(let Ft=-1;Ft<=1;++Ft){const Gt=(Ue+Lt)*p+qe+Ft;if(Td[Gt]>=ke)continue;const Tt=r0[Gt],Bt=Math.abs(Tt);Bt>Je&&(Et=Tt,Je=Bt,Ot=Ft,jt=Lt)}if(Je>.1){const Lt=1-(ke+.5*Math.abs(Ot*jt))/N;let Ft=i._dem.get(qe,Ue)+Et*Lt;const Gt=i._dem.get(qe+Ot,Ue+jt),Tt=i._dem.get(qe-Ot,Ue-jt,!0);(Ft-Gt)*(Ft-Tt)>0&&(Ft=(Gt+Tt)/2),r0[Ze]=i._dem.set(qe,Ue,Ft),Td[Ze]=ke}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=oo.now())}setFilter(e){this.filter=e?rd(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Nr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Ug(i.node),Ox(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());for(const c of this.getNodesInfo()){const f=c.node.footprint;c.hiddenByReplacement=!!f&&!o.find((p=>p.footprint===f))}}getHeightAtTileCoord(e,i){const o=[],c=[0,0,0],f=he([]);for(const p of this.getNodesInfo()){const v=p.node.meshes[0],b=v.transformedAabb;if(e<b.min[0]||i<b.min[1]||e>b.max[0]||i>b.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};Te(f,p.node.matrix),c[0]=e,c[1]=i,_i(c,c,f);const T=(c[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*xd|0,I=Math.min(63,(c[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*xd|0)*xd+Math.min(63,T),C=v.heightmap[I];if(!(C<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:C,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new kt(e,i),new kt(e,i),o),o.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function Gm(n,e){return n instanceof id&&!n.isLightConstant&&e}function qL(n,e,i,o,c,f,p,v){let b=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;i[3]>0&&(b=Mi(b,255*i[0],i[3]),T=Mi(T,255*i[1],i[3]),I=Mi(I,255*i[2],i[3]));const C=b<<8|T,O=I<<8|Math.floor(255*o[3]),B=(function(ke){const Ue=Le(ke,0,2);return Math.min(Math.round(.5*Ue*255),255)})(o[2])<<8|15*o[0]<<4|15*o[1],N=Le(c[0],0,1),X=Le(c[1],0,1),K=Le(c[2],0,1),Y=Le(c[3],0,1);let ue,de,_e,ze;if(N!==X&&p!==f&&X!==N){const ke=p-f;de=1/(ke*(X-N)),_e=-(f+ke*N)/(ke*(X-N));const Ue=Le(c[4],-1,1);ze=Math.pow(10,Ue),ue=255*K<<8|255*Y}else ue=65535,de=0,_e=1,ze=1;if(n.emplaceBack(C,O,B,ue,de,_e,ze),v){const ke=v.length;v.clear();for(let Ue=0;Ue<ke;Ue++)v.emplaceBack(C,O,B,ue,de,_e,ze)}}function GL(n,e,i){const o=n.node;let c=0;const f=i&Gf.HasMeshoptCompression;for(const p of o.meshes){if(o.lights&&o.lightMeshIndex===c||!p.featureData)continue;p.featureArray=new Sh,p.featureArray.reserve(p.featureData.length);let v=e;for(const b of p.featureData){const T=f?65535&b:b>>16&65535,I=f?b>>16&65535:65535&b,C=(15&I)<8?15&I:0,O=n.evaluatedRMEA[C],B=n.evaluatedColor[C],N=n.emissionHeightBasedParams[C];let X;if(v&&C===2&&o.lights&&(X=new Sh,X.resize(10*o.lights.length)),qL(p.featureArray,T,B,O,N,p.aabb.min[2],p.aabb.max[2],X),X&&v){v=!1;const K=o.meshes[o.lightMeshIndex];K.featureArray=X,K.featureArray._trim()}}p.featureArray._trim(),c++}}function sE(n,e,i,o){const c=1<<n.z;e.lat=Ie((o/Zt+n.y)/c),e.lng=Me((i/Zt+n.x)/c)}function HL(n,e,i,o){const c=n.getNodesInfo()[e];if(!c||c.hiddenByReplacement||!c.node.meshes)return;let f=Number.MAX_VALUE;const p=c.node,v=i.tile,b=o.calculatePosMatrix(v.tileID.toUnwrapped(),o.worldSize),T=c.evaluatedScale;let I=0;o.elevation&&p.elevation&&(I=p.elevation*o.elevation.exaggeration()),fe(b,b,[(p.anchor?p.anchor[0]:0)*(T[0]-1),(p.anchor?p.anchor[1]:0)*(T[1]-1),I]),oe(b,b,T);const C=i.queryGeometry,O=C.isPointQuery()?C.screenBounds:C.screenGeometry,B=function(X){const K=Se([],b,X.matrix);Se(K,o.expandedFarZProjMatrix,K);for(let Y=0;Y<X.meshes.length;++Y){const ue=X.meshes[Y];if(Y===X.lightMeshIndex)continue;const de=ST(O,o,K,ue.aabb);de!=null&&(f=Math.min(de,f))}if(X.children)for(const Y of X.children)B(Y)};if(B(p),f===Number.MAX_VALUE)return;const N=new Z(0,0);return sE(v.tileID.canonical,N,c.node.anchor[0],c.node.anchor[1]),{intersectionZ:f,position:N,feature:c.feature}}yi(oy,"Tiled3dModelBucket",{omit:["layers"]}),yi(rE,"Tiled3dModelFeature");const ZL={circle:class extends Qo{constructor(n,e,i,o){super(n,{layout:Ah||(Ah=new xs({"circle-sort-key":new li(Ye.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Wt(Ye.layout_circle["circle-elevation-reference"]),visibility:new Wt(Ye.layout_circle.visibility)})),paint:uc||(uc=new xs({"circle-radius":new li(Ye.paint_circle["circle-radius"]),"circle-color":new li(Ye.paint_circle["circle-color"]),"circle-blur":new li(Ye.paint_circle["circle-blur"]),"circle-opacity":new li(Ye.paint_circle["circle-opacity"]),"circle-translate":new Wt(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Wt(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wt(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wt(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new li(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new li(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new li(Ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Wt(Ye.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(n){return new Oo(n)}queryRadius(n){const e=n;return xl("circle-radius",this,e)+xl("circle-stroke-width",this,e)+jc(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,o,c,f,p,v){const b=Ul(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return h1(n,o,f,p,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const o=u1(this);return{config:new zu(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Qo{createBucket(n){return new f1(n)}constructor(n,e,i,o){super(n,{layout:p1||(p1=new xs({visibility:new Wt(Ye.layout_heatmap.visibility)})),paint:m1||(m1=new xs({"heatmap-radius":new li(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new li(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wt(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _h(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wt(Ye.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=_m({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return xl("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,o,c,f,p,v){const b=this.paint.get("heatmap-radius").evaluate(e,i);return h1(n,o,f,p,v,!0,!0,new kt(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new zu(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Qo{constructor(n,e,i,o){super(n,{layout:_1||(_1=new xs({visibility:new Wt(Ye.layout_hillshade.visibility)})),paint:g1||(g1=new xs({"hillshade-illumination-direction":new Wt(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wt(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wt(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wt(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wt(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wt(Ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Wt(Ye.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends Qo{constructor(n,e,i,o){super(n,{layout:O1||(O1=new xs({"fill-sort-key":new li(Ye.layout_fill["fill-sort-key"]),visibility:new Wt(Ye.layout_fill.visibility),"fill-elevation-reference":new Wt(Ye.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new li(Ye.layout_fill["fill-construct-bridge-guard-rail"])})),paint:L1||(L1=new xs({"fill-antialias":new Wt(Ye.paint_fill["fill-antialias"]),"fill-opacity":new li(Ye.paint_fill["fill-opacity"]),"fill-color":new li(Ye.paint_fill["fill-color"]),"fill-outline-color":new li(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Wt(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Wt(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new li(Ye.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Wt(Ye.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Wt(Ye.paint_fill["fill-emissive-strength"]),"fill-z-offset":new li(Ye.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new li(Ye.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new li(Ye.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new zu(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new fx(n)}queryRadius(){return jc(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,o,c,f){return!n.queryGeometry.isAboveHorizon&&Da($c(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Qo{constructor(n,e,i,o){super(n,{layout:iT||(iT=new xs({visibility:new Wt(Ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Wt(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:nT||(nT=new xs({"fill-extrusion-opacity":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new li(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new li(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new li(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new li(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new li(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new li(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new li(Ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new li(Ye["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Wt(Ye["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Og(n)}queryRadius(){return jc(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,o,c,f,p,v,b){const T=Ul(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),C=this.paint.get("fill-extrusion-base").evaluate(e,i),O=[0,0],B=v&&f.elevation,N=f.elevation?f.elevation.exaggeration():1,X=n.tile.getBucket(this);if(B&&X instanceof Og){const _e=X.centroidVertexArray,ze=b+1;ze<_e.length&&(O[0]=_e.geta_centroid_pos0(ze),O[1]=_e.geta_centroid_pos1(ze))}if(O[0]===0&&O[1]===1)return!1;f.projection.name==="globe"&&(o=tT([o],[new kt(0,0),new kt(Zt,Zt)],n.tileID.canonical).map((_e=>_e.polygon)).flat());const K=B?v:null,[Y,ue]=(function(_e,ze,ke,Ue,qe,Ze,Et,Je,Ot,jt,Lt){return _e.projection.name==="globe"?(function(Ft,Gt,Tt,Bt,ht,at,Ht,$t,Vi,gi,Ci){const Yt=[],Ni=[],ln=Ft.projection.upVectorScale(Ci,Ft.center.lat,Ft.worldSize).metersToTile,oi=[0,0,0,1],zi=[0,0,0,1],tn=(On,yn,Si,gn)=>{On[0]=yn,On[1]=Si,On[2]=gn,On[3]=1},_n=eT();Tt>0&&(Tt+=_n),Bt+=_n;for(const On of Gt){const yn=[],Si=[];for(const gn of On){const Wn=gn.x+ht.x,xe=gn.y+ht.y,we=Ft.projection.projectTilePoint(Wn,xe,Ci),ut=Ft.projection.upVector(Ci,gn.x,gn.y);let St=Tt,ri=Bt;if(Ht){const ni=cT(Wn,xe,Tt,Bt,Ht,$t,Vi,gi);St+=ni.base,ri+=ni.top}Tt!==0?tn(oi,we.x+ut[0]*ln*St,we.y+ut[1]*ln*St,we.z+ut[2]*ln*St):tn(oi,we.x,we.y,we.z),tn(zi,we.x+ut[0]*ln*ri,we.y+ut[1]*ln*ri,we.z+ut[2]*ln*ri),_i(oi,oi,at),_i(zi,zi,at),yn.push(new yd(oi[0],oi[1],oi[2])),Si.push(new yd(zi[0],zi[1],zi[2]))}Yt.push(yn),Ni.push(Si)}return[Yt,Ni]})(_e,ze,ke,Ue,qe,Ze,Et,Je,Ot,jt,Lt):Et?(function(Ft,Gt,Tt,Bt,ht,at,Ht,$t,Vi){const gi=[],Ci=[],Yt=[0,0,0,1];for(const Ni of Ft){const ln=[],oi=[];for(const zi of Ni){const tn=zi.x+Bt.x,_n=zi.y+Bt.y,On=cT(tn,_n,Gt,Tt,at,Ht,$t,Vi);Yt[0]=tn,Yt[1]=_n,Yt[2]=On.base,Yt[3]=1,ui(Yt,Yt,ht),Yt[3]=Math.max(Yt[3],1e-5);const yn=new yd(Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]);Yt[0]=tn,Yt[1]=_n,Yt[2]=On.top,Yt[3]=1,ui(Yt,Yt,ht),Yt[3]=Math.max(Yt[3],1e-5);const Si=new yd(Yt[0]/Yt[3],Yt[1]/Yt[3],Yt[2]/Yt[3]);ln.push(yn),oi.push(Si)}gi.push(ln),Ci.push(oi)}return[gi,Ci]})(ze,ke,Ue,qe,Ze,Et,Je,Ot,jt):(function(Ft,Gt,Tt,Bt,ht){const at=[],Ht=[],$t=ht[8]*Gt,Vi=ht[9]*Gt,gi=ht[10]*Gt,Ci=ht[11]*Gt,Yt=ht[8]*Tt,Ni=ht[9]*Tt,ln=ht[10]*Tt,oi=ht[11]*Tt;for(const zi of Ft){const tn=[],_n=[];for(const On of zi){const yn=On.x+Bt.x,Si=On.y+Bt.y,gn=ht[0]*yn+ht[4]*Si+ht[12],Wn=ht[1]*yn+ht[5]*Si+ht[13],xe=ht[2]*yn+ht[6]*Si+ht[14],we=ht[3]*yn+ht[7]*Si+ht[15],ut=gn+$t,St=Wn+Vi,ri=xe+gi,ni=Math.max(we+Ci,1e-5),xi=gn+Yt,ji=Wn+Ni,Ln=xe+ln,zn=Math.max(we+oi,1e-5);tn.push(new yd(ut/ni,St/ni,ri/ni)),_n.push(new yd(xi/zn,ji/zn,Ln/zn))}at.push(tn),Ht.push(_n)}return[at,Ht]})(ze,ke,Ue,qe,Ze)})(f,o,C,I,T,p,K,O,N,f.center.lat,n.tileID.canonical),de=n.queryGeometry;return(function(_e,ze,ke){let Ue=1/0;Da(ke,ze)&&(Ue=lT(ke,ze[0]));for(let qe=0;qe<ze.length;qe++){const Ze=ze[qe],Et=_e[qe];for(let Je=0;Je<Ze.length-1;Je++){const Ot=Ze[Je],jt=[Ot,Ze[Je+1],Et[Je+1],Et[Je],Ot];Ha(ke,jt)&&(Ue=Math.min(Ue,lT(ke,jt)))}}return Ue!==1/0&&Ue})(Y,ue,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},building:class extends Qo{constructor(n,e,i,o){super(n,{layout:DT||(DT=new xs({visibility:new Wt(Ye.layout_building.visibility),"building-facade":new li(Ye.layout_building["building-facade"]),"building-facade-floors":new li(Ye.layout_building["building-facade-floors"]),"building-facade-unit-width":new li(Ye.layout_building["building-facade-unit-width"]),"building-facade-window":new li(Ye.layout_building["building-facade-window"]),"building-roof-shape":new li(Ye.layout_building["building-roof-shape"]),"building-height":new li(Ye.layout_building["building-height"]),"building-base":new li(Ye.layout_building["building-base"]),"building-flood-light-wall-radius":new li(Ye.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new li(Ye.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new li(Ye.layout_building["building-flip-roof-orientation"])})),paint:zT||(zT=new xs({"building-opacity":new Wt(Ye.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Wt(Ye.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Wt(Ye.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Wt(Ye.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Wt(Ye.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Wt(Ye.paint_building["building-vertical-scale"]),"building-cast-shadows":new Wt(Ye.paint_building["building-cast-shadows"]),"building-color":new li(Ye.paint_building["building-color"]),"building-emissive-strength":new li(Ye.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Wt(Ye.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Wt(Ye.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Wt(Ye.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Wt(Ye.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Wt(Ye.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new LT(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}},line:class extends Qo{constructor(n,e,i,o){const c=GT();super(n,c,e,i,o),c.layout&&(this.layout=new Cu(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Hs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(Lm)return Lm;const i=GT();return Lm=new GO(i.paint.properties["line-width"].specification),Lm.useIntegerZoom=!0,Lm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new kx(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const o=$T(this);return{config:new zu(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(n){const e=n,i=HT(xl("line-width",this,e),xl("line-gap-width",this,e)),o=xl("line-offset",this,e);return i/2+Math.abs(o)+jc(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,o,c,f){if(n.queryGeometry.isAboveHorizon)return!1;const p=$c(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),v=n.pixelToTileUnitsFactor/2*HT(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(o=(function(T,I){const C=[],O=new kt(0,0);for(let B=0;B<T.length;B++){const N=T[B],X=[];for(let K=0;K<N.length;K++){const Y=N[K],ue=N[K+1],de=K===0?O:Y.sub(N[K-1])._unit()._perp(),_e=K===N.length-1?O:ue.sub(Y)._unit()._perp(),ze=de._add(_e)._unit();ze._mult(1/(ze.x*_e.x+ze.y*_e.y)),X.push(ze._mult(I)._add(Y))}C.push(X)}return C})(o,b*n.pixelToTileUnitsFactor)),(function(T,I,C){for(let O=0;O<I.length;O++){const B=I[O];if(T.length>=3){for(let N=0;N<B.length;N++)if(xo(T,B[N]))return!0}if(za(T,B,C))return!0}return!1})(p,o,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:iy,background:class extends Qo{constructor(n,e,i,o){super(n,{layout:FS||(FS=new xs({visibility:new Wt(Ye.layout_background.visibility)})),paint:BS||(BS=new xs({"background-pitch-alignment":new Wt(Ye.paint_background["background-pitch-alignment"]),"background-color":new Wt(Ye.paint_background["background-color"]),"background-pattern":new Wt(Ye.paint_background["background-pattern"]),"background-opacity":new Wt(Ye.paint_background["background-opacity"]),"background-emissive-strength":new Wt(Ye.paint_background["background-emissive-strength"]),"background-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:$S,"raster-particle":XS,sky:class extends Qo{constructor(n,e,i,o){super(n,{layout:HS||(HS=new xs({visibility:new Wt(Ye.layout_sky.visibility)})),paint:ZS||(ZS=new xs({"sky-type":new Wt(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Wt(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Wt(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Wt(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Wt(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new _h(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Wt(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Wt(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Wt(Ye.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=_m({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),c=!o,f=n.style.light,p=f.properties.get("position");return c&&f.properties.get("anchor")==="viewport"&&An("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?t0(p.azimuthal,90-p.polar,e):t0(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return t0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends Qo{constructor(n,e,i,o){super(n,{paint:WS||(WS=new xs({}))},e,null)}},model:class extends Qo{constructor(n,e,i,o){super(n,{layout:QS||(QS=new xs({visibility:new Wt(Ye.layout_model.visibility),"model-id":new li(Ye.layout_model["model-id"])})),paint:eE||(eE=new xs({"model-opacity":new li(Ye.paint_model["model-opacity"]),"model-rotation":new li(Ye.paint_model["model-rotation"]),"model-scale":new li(Ye.paint_model["model-scale"]),"model-translation":new li(Ye.paint_model["model-translation"]),"model-color":new li(Ye.paint_model["model-color"]),"model-color-mix-intensity":new li(Ye.paint_model["model-color-mix-intensity"]),"model-type":new Wt(Ye.paint_model["model-type"]),"model-cast-shadows":new Wt(Ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Wt(Ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Wt(Ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new li(Ye.paint_model["model-emissive-strength"]),"model-roughness":new li(Ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new li(Ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Wt(Ye.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Wt(Ye.paint_model["model-front-cutoff"]),"model-elevation-reference":new Wt(Ye.paint_model["model-elevation-reference"]),"model-color-use-theme":new li({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new n0(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof oy?Zt-1:0}queryIntersectsFeature(n,e,i,o,c,f){if(!this.modelManager)return!1;const p=this.modelManager,v=n.tile.getBucket(this);if(!(v&&v instanceof n0))return!1;for(const b in v.instancesPerModel){const T=v.instancesPerModel[b],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){const C=T.features[T.idToFeaturesIndex[I]],O=p.getModel(b,this.scope);if(!O)return!1;let B=se();const N=new Z(0,0),X=v.canonical;let K=Number.MAX_VALUE;for(let Y=0;Y<C.instancedDataCount;++Y){const ue=16*(C.instancedDataOffset+Y),de=T.instancedDataArray.float32,_e=[de[ue+4],de[ue+5],de[ue+6]];sE(X,N,de[ue],0|de[ue+1]),ET(B,O,f,N,C.rotation,C.scale,_e,!1,!1,!1),f.projection.name==="globe"&&(B=Mx(B,f));const ze=Se([],f.projMatrix,B),ke=n.queryGeometry,Ue=ST(ke.isPointQuery()?ke.screenBounds:ke.screenGeometry,f,ze,O.aabb);Ue!=null&&(K=Math.min(Ue,K))}return K!==Number.MAX_VALUE&&K}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Lc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Qo{constructor(n,e,i,o){super(n,{layout:D1||(D1=new xs({"clip-layer-types":new Wt(Ye.layout_clip["clip-layer-types"]),"clip-layer-scope":new Wt(Ye.layout_clip["clip-layer-scope"])})),paint:z1||(z1=new xs({}))},e,i,o)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new k1(n)}is3D(n){return!0}}},s0=new Cn(0,0,0),o0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},a0={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},ay={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},WL={PAINT_ORDER_FILL_AND_STROKE:1},Hm={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},oE={MASK_TYPE_LUMINANCE:1};function XL(n,e,i){n===1&&e.icons.push((function(o,c){return(function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:p}=f;if(p.content_area){const{content_area:v}=p;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=f.usvg_tree.width),v.height==null&&(v.height=v.width)}if(p.text_placeholder){const{text_placeholder:v}=p;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return p.stretch_x&&p.stretch_x.length&&aE(p,"x"),p.stretch_y&&p.stretch_y.length&&aE(p,"y"),f})(o.readFields(KL,{name:void 0},c))})(i,i.readVarint()+i.pos))}function aE(n,e){const i=[],o=n[`stretch_${e}`];let c=null;for(let f=0;f<o.length;f++)c===null?c=i.length===0?o[0]:i[i.length-1][1]+o[f]:(i.push([c,c+o[f]]),c=null);n[`stretch_${e}_areas`]=i}function KL(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=(function(o,c){return o.readFields(YL,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)})(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=(function(o,c){return o.readFields(eD,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function YL(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=lE(i,i.readVarint()+i.pos):n===4?e.variables.push((function(o,c){return o.readFields(QL,{name:void 0},c)})(i,i.readVarint()+i.pos)):n===5&&(e.text_placeholder=lE(i,i.readVarint()+i.pos))}function lE(n,e){return n.readFields(JL,{},e)}function JL(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function QL(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=uy(i.readVarint()),e.value="rgb_color")}function eD(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(ly(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push((function(o,c){return o.readFields(aD,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)})(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push((function(o,c){return o.readFields(cD,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)})(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push((function(o,c){return o.readFields(uD,{children:[]},c)})(i,i.readVarint()+i.pos)):n===8&&e.masks.push((function(o,c){const f=o.readFields(hD,{left:0,width:20,mask_type:oE.MASK_TYPE_LUMINANCE,children:[]},c);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f})(i,i.readVarint()+i.pos))}function ly(n,e){return n.readFields(tD,{},e)}function tD(n,e,i){n===1?(e.group=(function(o,c){return o.readFields(iD,{opacity:255,children:[]},c)})(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=(function(o,c){return o.readFields(rD,{paint_order:1,commands:[],step:1,diffs:[],rule:o0.PATH_RULE_NON_ZERO},c)})(i,i.readVarint()+i.pos),e.node="path")}function iD(n,e,i){n===1?e.transform=cy(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(ly(i,i.readVarint()+i.pos))}function cy(n,e){return n.readFields(nD,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function nD(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function rD(n,e,i){n===1?e.fill=(function(o,c){return o.readFields(sD,{rgb_color:s0,paint:"rgb_color",opacity:255},c)})(i,i.readVarint()+i.pos):n===2?e.stroke=(function(o,c){return o.readFields(oD,{rgb_color:s0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)})(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function sD(n,e,i){n===1?(e.rgb_color=uy(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function uy(n){return new Cn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function oD(n,e,i){n===1?(e.rgb_color=uy(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function aD(n,e,i){n===1?e.transform=cy(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(cE(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function cE(n,e){return n.readFields(lD,{offset:0,opacity:255,rgb_color:s0},e)}function lD(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=uy(i.readVarint()))}function cD(n,e,i){n===1?e.transform=cy(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(cE(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function uD(n,e,i){n===1?e.transform=cy(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(ly(i,i.readVarint()+i.pos))}function hD(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(ly(i,i.readVarint()+i.pos))}class dD{static calculate(e={},i=[]){const o=new Map,c=new Map;if(Object.keys(e).length===0)return o;i.forEach((f=>{c.set(f.name,f.rgb_color||new Cn(0,0,0))}));for(const[f,p]of Object.entries(e))c.has(f)?o.set(c.get(f).toString(),p):console.warn(`Ignoring unknown image variable "${f}"`);return o}}function Jf(n,e=255,i){const o=e/255,c=n.toString(),f=i.has(c)?i.get(c).clone():n.clone();return f.a*=o,f.toString()}function Zm(n,e){if(!Ls()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function fD(n,e){const i=dD.calculate(e.params,n.metadata?n.metadata.variables:[]),o=n.usvg_tree,c=o.width,f=o.height,p=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(c*p.a)),b=Math.max(1,Math.round(f*p.d)),T=new DOMMatrix([v/c,0,0,b/f,0,0]),I=Zm(v,b).getContext("2d");return l0(I,T,o,o,i),I.getImageData(0,0,v,b)}function l0(n,e,i,o,c){for(const f of o.children)uE(n,e,i,f,c)}function uE(n,e,i,o,c){o.group?(n.save(),(function(f,p,v,b,T){const I=b.mask_idx!=null?v.masks[b.mask_idx]:null,C=b.clip_path_idx!=null?v.clip_paths[b.clip_path_idx]:null;if(b.transform&&(p=Qf(b.transform).preMultiplySelf(p)),!(function(N,X,K){return N.opacity!==255||X||K})(b,C!=null,I!=null))return void l0(f,p,v,b,T);const O=Zm(f.canvas.width,f.canvas.height),B=O.getContext("2d");l0(B,p,v,b,T),C&&gE(B,p,v,C),I&&yE(B,p,v,I,T),f.globalAlpha=b.opacity/255,f.drawImage(O,0,0)})(n,e,i,o.group,c),n.restore()):o.path&&(n.save(),(function(f,p,v,b,T){f.setTransform(p),b.paint_order===WL.PAINT_ORDER_FILL_AND_STROKE?(hE(f,v,b,T),fE(f,v,b,T)):(fE(f,v,b,T),hE(f,v,b,T))})(n,e,i,o.path,c),n.restore())}function hE(n,e,i,o){const c=i.fill;if(!c)return;const f=c.opacity/255;switch(n.save(),n.beginPath(),vE(i,n),c.paint){case"rgb_color":n.fillStyle=Jf(c.rgb_color,c.opacity,o);break;case"linear_gradient_idx":{const p=e.linear_gradients[c.linear_gradient_idx];p.transform&&n.setTransform(Qf(p.transform).preMultiplySelf(n.getTransform())),n.fillStyle=pE(n,p,f,o);break}case"radial_gradient_idx":{const p=e.radial_gradients[c.radial_gradient_idx];p.transform&&n.setTransform(Qf(p.transform).preMultiplySelf(n.getTransform())),n.fillStyle=mE(n,p,f,o)}}n.fill(dE(i)),n.restore()}function dE(n){return n.rule===o0.PATH_RULE_NON_ZERO?"nonzero":n.rule===o0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function fE(n,e,i,o){const c=i.stroke;if(!c)return;const f=xE(i);n.lineWidth=c.width,n.miterLimit=c.miterlimit,n.setLineDash(c.dasharray),n.lineDashOffset=c.dashoffset;const p=c.opacity/255;switch(c.paint){case"rgb_color":n.strokeStyle=Jf(c.rgb_color,c.opacity,o);break;case"linear_gradient_idx":n.strokeStyle=pE(n,e.linear_gradients[c.linear_gradient_idx],p,o,!0);break;case"radial_gradient_idx":n.strokeStyle=mE(n,e.radial_gradients[c.radial_gradient_idx],p,o,!0)}switch(c.linejoin){case ay.LINE_JOIN_MITER_CLIP:case ay.LINE_JOIN_MITER:n.lineJoin="miter";break;case ay.LINE_JOIN_ROUND:n.lineJoin="round";break;case ay.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(c.linecap){case a0.LINE_CAP_BUTT:n.lineCap="butt";break;case a0.LINE_CAP_ROUND:n.lineCap="round";break;case a0.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(f)}function pE(n,e,i,o,c=!1){if(e.stops.length===1){const O=e.stops[0];return Jf(O.rgb_color,O.opacity*i,o)}const{x1:f,y1:p,x2:v,y2:b}=e;let T=new DOMPoint(f,p),I=new DOMPoint(v,b);if(c){const O=Qf(e.transform);T=O.transformPoint(T),I=O.transformPoint(I)}const C=n.createLinearGradient(T.x,T.y,I.x,I.y);for(const O of e.stops)C.addColorStop(O.offset,Jf(O.rgb_color,O.opacity*i,o));return C}function mE(n,e,i,o,c=!1){if(e.stops.length===1){const Y=e.stops[0];return Jf(Y.rgb_color,Y.opacity*i,o)}const f=Qf(e.transform),{fx:p,fy:v,fr:b,cx:T,cy:I,r:C}=e;let O=new DOMPoint(p,v),B=new DOMPoint(T,I),N=b,X=C;if(c){O=f.transformPoint(O),B=f.transformPoint(B);const Y=(f.a+f.d)/2;N=b*Y,X=e.r*Y}const K=n.createRadialGradient(O.x,O.y,N,B.x,B.y,X);for(const Y of e.stops)K.addColorStop(Y.offset,Jf(Y.rgb_color,Y.opacity*i,o));return K}function _E(n,e,i,o){const c=o.transform?Qf(o.transform).preMultiplySelf(e):e,f=Zm(n.canvas.width,n.canvas.height),p=f.getContext("2d");for(const b of o.children)if(b.group)_E(p,c,i,b.group);else if(b.path){const T=b.path,I=new Path2D;I.addPath(xE(T),c),p.fill(I,dE(T))}const v=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;v&&gE(p,c,i,v),n.globalCompositeOperation="source-over",n.drawImage(f,0,0)}function gE(n,e,i,o){const c=Zm(n.canvas.width,n.canvas.height);_E(c.getContext("2d"),e,i,o),n.globalCompositeOperation="destination-in",n.drawImage(c,0,0)}function yE(n,e,i,o,c){if(o.children.length===0)return;const f=o.mask_idx!=null?i.masks[o.mask_idx]:null;f&&yE(n,e,i,f,c);const p=n.canvas.width,v=n.canvas.height,b=Zm(p,v),T=b.getContext("2d"),I=o.width,C=o.height,O=o.left,B=o.top,N=new Path2D,X=new Path2D;X.rect(O,B,I,C),N.addPath(X,e),T.clip(N);for(const ue of o.children)uE(T,e,i,ue,c);const K=T.getImageData(0,0,p,v),Y=K.data;if(o.mask_type===oE.MASK_TYPE_LUMINANCE)for(let ue=0;ue<Y.length;ue+=4)Y[ue+3]=Y[ue+3]/255*(.2126*Y[ue]+.7152*Y[ue+1]+.0722*Y[ue+2]);T.putImageData(K,0,0),n.globalCompositeOperation="destination-in",n.drawImage(b,0,0)}function Qf(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function vE(n,e){const i=n.step;let o=n.diffs[0]*i,c=n.diffs[1]*i;e.moveTo(o,c);for(let f=0,p=2;f<n.commands.length;f++)switch(n.commands[f]){case Hm.PATH_COMMAND_MOVE:o+=n.diffs[p++]*i,c+=n.diffs[p++]*i,e.moveTo(o,c);break;case Hm.PATH_COMMAND_LINE:o+=n.diffs[p++]*i,c+=n.diffs[p++]*i,e.lineTo(o,c);break;case Hm.PATH_COMMAND_QUAD:{const v=o+n.diffs[p++]*i,b=c+n.diffs[p++]*i;o=v+n.diffs[p++]*i,c=b+n.diffs[p++]*i,e.quadraticCurveTo(v,b,o,c);break}case Hm.PATH_COMMAND_CUBIC:{const v=o+n.diffs[p++]*i,b=c+n.diffs[p++]*i,T=v+n.diffs[p++]*i,I=b+n.diffs[p++]*i;o=T+n.diffs[p++]*i,c=I+n.diffs[p++]*i,e.bezierCurveTo(v,b,T,I,o,c);break}case Hm.PATH_COMMAND_CLOSE:e.closePath()}return e}function xE(n){return vE(n,new Path2D)}class hy{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}yi(hy,"LRUCache");class c0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Go(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new hy(150)),this.cacheMap.get(o).get(yh(e.toString(),i))}setInCache(e,i,o,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new hy(150));const f=this.cacheDependenciesMap.get(c),p=yh(e.id.toString(),o);f.get(p)||f.set(p,new Set);const v=this.cacheMap.get(c),b=e.toString();f.get(p).add(b),v.put(yh(e.toString(),o),i)}removeImagesFromCacheByIds(e,i,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const c=this.cacheMap.get(o),f=this.cacheDependenciesMap.get(o);for(const p of e){const v=yh(p.toString(),i);if(f.has(v)){for(const b of f.get(v))c.delete(b);f.delete(v)}}}rasterize(e,i,o,c,f=fD){const p=this.getFromCache(e,o,c);if(p)return p.clone();const v=f(i.icon,e.options),b=c0._getImage(v);return this.setInCache(e,b,o,c),b.clone()}}class bE{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function wE(n,e,i,o){let c=0,f=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(o[p])<1e-15){if(i[p]<n[p]||i[p]>e[p])return null}else{const v=1/o[p];let b=(n[p]-i[p])*v,T=(e[p]-i[p])*v;if(b>T){const I=b;b=T,T=I}if(b>c&&(c=b),T<f&&(f=T),c>f)return null}return c}function TE(n,e,i,o,c,f,p,v,b,T,I){const C=o-n,O=c-e,B=f-i,N=p-n,X=v-e,K=b-i,Y=I[1]*K-I[2]*X,ue=I[2]*N-I[0]*K,de=I[0]*X-I[1]*N,_e=C*Y+O*ue+B*de;if(Math.abs(_e)<1e-15)return null;const ze=1/_e,ke=T[0]-n,Ue=T[1]-e,qe=T[2]-i,Ze=(ke*Y+Ue*ue+qe*de)*ze;if(Ze<0||Ze>1)return null;const Et=Ue*B-qe*O,Je=qe*C-ke*B,Ot=ke*O-Ue*C,jt=(I[0]*Et+I[1]*Je+I[2]*Ot)*ze;return jt<0||Ze+jt>1?null:(N*Et+X*Je+K*Ot)*ze}function SE(n,e,i){return(n-e)/(i-e)}function EE(n,e,i,o,c,f,p,v,b){const T=1<<i,I=f-o,C=p-c,O=(n+1)/T*I+o,B=(e+0)/T*C+c,N=(e+1)/T*C+c;v[0]=(n+0)/T*I+o,v[1]=B,b[0]=O,b[1]=N}class AE{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(f){const p=Math.ceil(Math.log2(f.dim/8)),v=[];let b=Math.ceil(Math.pow(2,p));const T=1/b,I=(B,N,X,K,Y)=>{const ue=K?1:0,de=(B+1)*X-ue,_e=N*X,ze=(N+1)*X-ue;Y[0]=B*X,Y[1]=_e,Y[2]=de,Y[3]=ze};let C=new bE(b);const O=[];for(let B=0;B<b*b;B++){I(B%b,Math.floor(B/b),T,!1,O);const N=Dh(O[0],O[1],f),X=Dh(O[2],O[1],f),K=Dh(O[2],O[3],f),Y=Dh(O[0],O[3],f);C.minimums.push(Math.min(N,X,K,Y)),C.maximums.push(Math.max(N,X,K,Y)),C.leaves.push(1)}for(v.push(C),b/=2;b>=1;b/=2){const B=v[v.length-1];C=new bE(b);for(let N=0;N<b*b;N++){I(N%b,Math.floor(N/b),2,!0,O);const X=B.getElevation(O[0],O[1]),K=B.getElevation(O[2],O[1]),Y=B.getElevation(O[2],O[3]),ue=B.getElevation(O[0],O[3]),de=B.isLeaf(O[0],O[1]),_e=B.isLeaf(O[2],O[1]),ze=B.isLeaf(O[2],O[3]),ke=B.isLeaf(O[0],O[3]),Ue=Math.min(X.min,K.min,Y.min,ue.min),qe=Math.max(X.max,K.max,Y.max,ue.max),Ze=de&&_e&&ze&&ke;C.maximums.push(qe),C.minimums.push(Ue),C.leaves.push(qe-Ue<=5&&Ze?1:0)}v.push(C)}return v})(this.dem),o=i.length-1,c=i[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,c,f,p,v=1){return wE([e,i,-100],[o,c,this.maximums[0]*v],f,p)}raycast(e,i,o,c,f,p,v=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,o,c,f,p,v);if(b==null)return null;const T=[],I=[],C=[],O=[],B=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:N,t:X,nodex:K,nodey:Y,depth:ue}=B.pop();if(this.leaves[N]){EE(K,Y,ue,e,i,o,c,C,O);const _e=1<<ue,ze=(K+0)/_e,ke=(K+1)/_e,Ue=(Y+0)/_e,qe=(Y+1)/_e,Ze=Dh(ze,Ue,this.dem)*v,Et=Dh(ke,Ue,this.dem)*v,Je=Dh(ke,qe,this.dem)*v,Ot=Dh(ze,qe,this.dem)*v,jt=TE(C[0],C[1],Ze,O[0],C[1],Et,O[0],O[1],Je,f,p),Lt=TE(O[0],O[1],Je,C[0],O[1],Ot,C[0],C[1],Ze,f,p),Ft=Math.min(jt!==null?jt:Number.MAX_VALUE,Lt!==null?Lt:Number.MAX_VALUE);if(Ft!==Number.MAX_VALUE)return Ft;{const Gt=ki([],f,p,X);if(IE(Ze,Et,Ot,Je,SE(Gt[0],C[0],O[0]),SE(Gt[1],C[1],O[1]))>=Gt[2])return X}continue}let de=0;for(let _e=0;_e<this._siblingOffset.length;_e++){EE((K<<1)+this._siblingOffset[_e][0],(Y<<1)+this._siblingOffset[_e][1],ue+1,e,i,o,c,C,O),C[2]=-100,O[2]=this.maximums[this.childOffsets[N]+_e]*v;const ze=wE(C,O,f,p);if(ze!=null){const ke=ze;T[_e]=ke;let Ue=!1;for(let qe=0;qe<de&&!Ue;qe++)ke>=T[I[qe]]&&(I.splice(qe,0,_e),Ue=!0);Ue||(I[de]=_e),de++}}for(let _e=0;_e<de;_e++){const ze=I[_e];B.push({idx:this.childOffsets[N]+ze,t:T[ze],nodex:(K<<1)+this._siblingOffset[ze][0],nodey:(Y<<1)+this._siblingOffset[ze][1],depth:ue+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,c,f){if(e[c].isLeaf(i,o)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const p=c-1,v=e[p];let b=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const C=2*i+this._siblingOffset[I][0],O=2*o+this._siblingOffset[I][1],B=v.getElevation(C,O),N=v.isLeaf(C,O),X=this._addNode(B.min,B.max,N);N&&(b|=1<<I),T||(T=X)}for(let I=0;I<this._siblingOffset.length;I++)b&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*o+this._siblingOffset[I][1],p,T+I)}}function IE(n,e,i,o,c,f){return Mi(Mi(n,i,f),Mi(e,o,f),c)}function Dh(n,e,i){const o=i.dim,c=Le(n*o-.5,0,o-1),f=Le(e*o-.5,0,o-1),p=Math.floor(c),v=Math.floor(f),b=Math.min(p+1,o-1),T=Math.min(v+1,o-1);return IE(i.get(p,v),i.get(b,v),i.get(p,T),i.get(b,T),c-p,f-v)}const pD={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function mD(n,e,i){return(256*n*256+256*e+i)/10-1e4}function _D(n,e,i){return 256*n+e+i/256-32768}class dy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void An(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let b=0;b<f;b++)p[this._idx(-1,b)]=p[this._idx(0,b)],p[this._idx(f,b)]=p[this._idx(f-1,b)],p[this._idx(b,-1)]=p[this._idx(b,0)],p[this._idx(b,f)]=p[this._idx(b,f-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(f,-1)]=p[this._idx(f-1,0)],p[this._idx(-1,f)]=p[this._idx(0,f-1)],p[this._idx(f,f)]=p[this._idx(f-1,f-1)]}const v=o==="terrarium"?_D:mD;for(let b=0;b<p.length;++b){const T=4*b;this.floatView[b]=v(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=oo.now()}_buildQuadTree(){this._tree=new AE(this)}get(e,i,o=!1){o&&(e=Le(e,-1,this.dim),i=Le(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,o){const c=this._idx(e,i),f=this.floatView[c];return this.floatView[c]=o,o-f}static getUnpackVector(e){return pD[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],c=dy.getUnpackVector(i);let f=Math.floor((e+c[3])/c[2]);return o[2]=f%256,f=Math.floor(f/256),o[1]=f%256,f=Math.floor(f/256),o[0]=f,o}getPixels(){return new x1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,f=i*this.dim+this.dim,p=o*this.dim,v=o*this.dim+this.dim;switch(i){case-1:c=f-1;break;case 1:f=c+1}switch(o){case-1:p=v-1;break;case 1:v=p+1}const b=-i*this.dim,T=-o*this.dim;for(let I=p;I<v;I++)for(let C=c;C<f;C++){const O=4*this._idx(C,I),B=4*this._idx(C+b,I+T);this.pixels[O+0]=e.pixels[B+0],this.pixels[O+1]=e.pixels[B+1],this.pixels[O+2]=e.pixels[B+2],this.pixels[O+3]=e.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function gD(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push((function(o,c){return o.readFields(wD,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)})(i,i.readVarint()+i.pos))}function yD(n,e,i){n===1?(e.delta_filter=(function(o,c){return o.readFields(vD,{blockSize:0},c)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function vD(n,e,i){n===1&&(e.blockSize=i.readVarint())}function xD(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function bD(n,e,i){let o=0,c=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push((function(f,p){return f.readFields(yD,{},p)})(i,i.readVarint()+i.pos)):n===4?e.codec=(function(f,p){return f.readFields(xD,{},p)})(i,i.readVarint()+i.pos):n===5?c=i.readFloat():n===6?o=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=o)}function wD(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push((function(o,c){return o.readFields(bD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)})(i,i.readVarint()+i.pos))}function TD(n,e,i){if(n===2)(function(o,c,f){o.readFields(SD,f,c)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function SD(n,e,i){if(n===1){let o=0;const c=i.readVarint()+i.pos;for(;i.pos<c;)e[o++]=i.readVarint()}}function ED(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const c=o===1?1:0,f=o===2?1:0;for(let p=0;p<e[0];p++){const v=e[1]*p;for(let b=c;b<e[1];b++){const T=e[2]*(b+v);for(let I=f;I<e[2];I++){const C=e[3]*(I+T);for(let O=0;O<e[3];O++){const B=C+O;n[B]+=n[B-i]}}}}i*=e[o]}return n}function AD(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function ID(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const o=n[i],c=n[i+1];n[i]=(240&o)>>4|(61440&o)>>8|(240&c)<<4|61440&c,n[i+1]=15&o|(3840&o)>>4|(15&c)<<8|(3840&c)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const o=n[i],c=n[i+1],f=n[i+2],p=n[i+3];n[i+0]=(192&o)>>6|(192&c)>>4|(192&f)>>2|192&p,n[i+1]=(48&o)>>4|(48&c)>>2|48&f|(48&p)<<2,n[i+2]=(12&o)>>2|12&c|(12&f)<<2|(12&p)<<4,n[i+3]=3&o|(3&c)<<2|(3&f)<<4|(3&p)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}yi(dy,"DEMData"),yi(AE,"DemMinMaxQuadTree",{omit:["dem"]});var bl=Uint8Array,Wm=Uint16Array,PD=Int32Array,PE=new bl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),CE=new bl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),CD=new bl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ME=function(n,e){for(var i=new Wm(31),o=0;o<31;++o)i[o]=e+=1<<n[o-1];var c=new PD(i[30]);for(o=1;o<30;++o)for(var f=i[o];f<i[o+1];++f)c[f]=f-i[o]<<5|o;return{b:i,r:c}},RE=ME(PE,2),OE=RE.b,MD=RE.r;OE[28]=258,MD[258]=28;for(var RD=ME(CE,0).b,LE=new Wm(32768),uo=0;uo<32768;++uo){var ep=(43690&uo)>>1|(21845&uo)<<1;LE[uo]=((65280&(ep=(61680&(ep=(52428&ep)>>2|(13107&ep)<<2))>>4|(3855&ep)<<4))>>8|(255&ep)<<8)>>1}var Xm=function(n,e,i){for(var o=n.length,c=0,f=new Wm(e);c<o;++c)n[c]&&++f[n[c]-1];var p,v=new Wm(e);for(c=1;c<e;++c)v[c]=v[c-1]+f[c-1]<<1;p=new Wm(1<<e);var b=15-e;for(c=0;c<o;++c)if(n[c])for(var T=c<<4|n[c],I=e-n[c],C=v[n[c]-1]++<<I,O=C|(1<<I)-1;C<=O;++C)p[LE[C]>>b]=T;return p},Km=new bl(288);for(uo=0;uo<144;++uo)Km[uo]=8;for(uo=144;uo<256;++uo)Km[uo]=9;for(uo=256;uo<280;++uo)Km[uo]=7;for(uo=280;uo<288;++uo)Km[uo]=8;var DE=new bl(32);for(uo=0;uo<32;++uo)DE[uo]=5;var OD=Xm(Km,9),LD=Xm(DE,5),u0=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},pc=function(n,e,i){var o=e/8|0;return(n[o]|n[o+1]<<8)>>(7&e)&i},h0=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},DD=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],mc=function(n,e,i){var o=new Error(e||DD[n]);if(o.code=n,Error.captureStackTrace&&Error.captureStackTrace(o,mc),!i)throw o;return o},zD=new bl(0),kD=typeof TextDecoder<"u"&&new TextDecoder;try{kD.decode(zD,{stream:!0})}catch{}const FD={gzip_data:"gzip"};class jl extends Error{constructor(e){super(e),this.name="MRTError"}}const BD={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},zE={uint32:1,uint16:2,uint8:4},ND={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let d0;class fy{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new jl(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new jl("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new jl(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const c=new d0(i.subarray(0,o)).readFields(gD,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new jl(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const f of c.layers)this.layers[f.name]=new kE(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let c of e.blockIndices){const f=o.dataIndex[c],p=f.firstByte-e.firstByte,v=f.lastByte-e.firstByte;if(o._blocksInProgress.has(c))continue;const b={layerName:o.name,firstByte:p,lastByte:v,pixelFormat:o.pixelFormat,blockIndex:c,blockShape:[f.bands.length].concat(o.bandShape),buffer:o.buffer,codec:f.codec.codec,filters:f.filters.map((T=>T.filter))};o._blocksInProgress.add(c),i.push(b)}return new FE(i,(()=>{i.forEach((c=>o._blocksInProgress.delete(c.blockIndex)))}),((c,f)=>{if(i.forEach((p=>o._blocksInProgress.delete(p.blockIndex))),c)throw c;f.forEach((p=>{this.getLayer(p.layerName).processDecodedData(p)}))}))}}class kE{constructor({version:e,name:i,units:o,tileSize:c,pixelFormat:f,buffer:p,dataIndex:v},b){if(this.version=e,this.version!==1)throw new jl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=c,this.buffer=p,this.pixelFormat=BD[f],this.dataIndex=v,this.bandShape=[c+2*p,c+2*p,zE[this.pixelFormat]],this._decodedBlocks=new hy(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return zE[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,c]of this.dataIndex.entries()){for(const[f,p]of c.bands.entries())if(p===e)return{bandIndex:i+f,blockIndex:o,blockBandIndex:f};i+=c.bands.length}break;case"number":for(const[o,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new jl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,o=-1/0;const c=[],f=new Set;for(const p of e){const{blockIndex:v}=this.getBlockForBand(p);if(v<0)throw new jl(`Invalid band: ${JSON.stringify(p)}`);const b=this.dataIndex[v];c.includes(v)||c.push(v),f.add(v),i=Math.min(i,b.firstByte),o=Math.max(o,b.lastByte)}if(f.size>this.cacheSize)throw new jl(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e);if(i<0)throw new jl(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(i.toString());if(!c)throw new jl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[i],p=this.bandShape.reduce(((T,I)=>T*I),1),v=o*p,b=c.subarray(v,v+p);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}fy.setPbf=function(n){d0=n};class FE{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}fy.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map((o=>{const{layerName:c,firstByte:f,lastByte:p,pixelFormat:v,blockShape:b,blockIndex:T,filters:I,codec:C}=o,O=i.subarray(f,p+1),B=new Uint32Array(b[0]*b[1]*b[2]);let N;if(C!=="gzip_data")throw new jl(`Unhandled codec: ${C}`);return N=(function(X,K){if(!globalThis.DecompressionStream&&K==="gzip_data")return Promise.resolve(((_e=(function(Ue){Ue[0]==31&&Ue[1]==139&&Ue[2]==8||mc(6,"invalid gzip data");var qe=Ue[3],Ze=10;4&qe&&(Ze+=2+(Ue[10]|Ue[11]<<8));for(var Et=(qe>>3&1)+(qe>>4&1);Et>0;Et-=!Ue[Ze++]);return Ze+(2&qe)})(de=X))+8>de.length&&mc(6,"invalid gzip data"),(function(Ue,qe,Ze,Et){var Je=Ue.length;if(!Je||qe.f&&!qe.l)return Ze||new bl(0);var Ot=!Ze,jt=Ot||qe.i!=2,Lt=qe.i;Ot&&(Ze=new bl(3*Je));var Ft,Gt,Tt=function(jr){var $r=Ze.length;if(jr>$r){var Fr=new bl(Math.max(2*$r,jr));Fr.set(Ze),Ze=Fr}},Bt=qe.f||0,ht=qe.p||0,at=qe.b||0,Ht=qe.l,$t=qe.d,Vi=qe.m,gi=qe.n,Ci=8*Je;do{if(!Ht){Bt=pc(Ue,ht,1);var Yt=pc(Ue,ht+1,3);if(ht+=3,!Yt){var Ni=Ue[(xe=4+((ht+7)/8|0))-4]|Ue[xe-3]<<8,ln=xe+Ni;if(ln>Je){Lt&&mc(0);break}jt&&Tt(at+Ni),Ze.set(Ue.subarray(xe,ln),at),qe.b=at+=Ni,qe.p=ht=8*ln,qe.f=Bt;continue}if(Yt==1)Ht=OD,$t=LD,Vi=9,gi=5;else if(Yt==2){var oi=pc(Ue,ht,31)+257,zi=pc(Ue,ht+10,15)+4,tn=oi+pc(Ue,ht+5,31)+1;ht+=14;for(var _n=new bl(tn),On=new bl(19),yn=0;yn<zi;++yn)On[CD[yn]]=pc(Ue,ht+3*yn,7);ht+=3*zi;var Si=u0(On),gn=(1<<Si)-1,Wn=Xm(On,Si);for(yn=0;yn<tn;){var xe,we=Wn[pc(Ue,ht,gn)];if(ht+=15&we,(xe=we>>4)<16)_n[yn++]=xe;else{var ut=0,St=0;for(xe==16?(St=3+pc(Ue,ht,3),ht+=2,ut=_n[yn-1]):xe==17?(St=3+pc(Ue,ht,7),ht+=3):xe==18&&(St=11+pc(Ue,ht,127),ht+=7);St--;)_n[yn++]=ut}}var ri=_n.subarray(0,oi),ni=_n.subarray(oi);Vi=u0(ri),gi=u0(ni),Ht=Xm(ri,Vi),$t=Xm(ni,gi)}else mc(1);if(ht>Ci){Lt&&mc(0);break}}jt&&Tt(at+131072);for(var xi=(1<<Vi)-1,ji=(1<<gi)-1,Ln=ht;;Ln=ht){var zn=(ut=Ht[h0(Ue,ht)&xi])>>4;if((ht+=15&ut)>Ci){Lt&&mc(0);break}if(ut||mc(2),zn<256)Ze[at++]=zn;else{if(zn==256){Ln=ht,Ht=null;break}var En=zn-254;zn>264&&(En=pc(Ue,ht,(1<<(Sn=PE[yn=zn-257]))-1)+OE[yn],ht+=Sn);var vr=$t[h0(Ue,ht)&ji],ts=vr>>4;if(vr||mc(3),ht+=15&vr,ni=RD[ts],ts>3){var Sn=CE[ts];ni+=h0(Ue,ht)&(1<<Sn)-1,ht+=Sn}if(ht>Ci){Lt&&mc(0);break}jt&&Tt(at+131072);var Ur=at+En;if(at<ni){var Tr=0-ni,cr=Math.min(ni,Ur);for(Tr+at<0&&mc(3);at<cr;++at)Ze[at]=(void 0)[Tr+at]}for(;at<Ur;++at)Ze[at]=Ze[at-ni]}}qe.l=Ht,qe.p=Ln,qe.b=at,qe.f=Bt,Ht&&(Bt=1,qe.m=Vi,qe.d=$t,qe.n=gi)}while(!Bt);return at!=Ze.length&&Ot?(Ft=Ze,((Gt=at)==null||Gt>Ft.length)&&(Gt=Ft.length),new bl(Ft.subarray(0,Gt))):Ze.subarray(0,at)})(de.subarray(_e,-8),{i:2},new bl(((Y=de)[(ue=Y.length)-4]|Y[ue-3]<<8|Y[ue-2]<<16|Y[ue-1]<<24)>>>0))));var Y,ue,de,_e;const ze=FD[K];if(!ze)throw new Error(`Unhandled codec: ${K}`);const ke=new globalThis.DecompressionStream(ze);return new Response(new Blob([X]).stream().pipeThrough(ke)).arrayBuffer().then((Ue=>new Uint8Array(Ue)))})(O,C).then((X=>((function(K,Y){K.readFields(TD,Y)})(new d0(X),B),new ND[v](B.buffer)))),N.then((X=>{for(let K=I.length-1;K>=0;K--)switch(I[K]){case"delta_filter":ED(X,b);break;case"zigzag_filter":AD(X);break;case"bitshuffle_filter":ID(X,v);break;default:throw new jl(`Unhandled filter "${I[K]}"`)}return{layerName:c,blockIndex:T,data:X}})).catch((X=>{throw X}))})))},yi(FE,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),yi(fy,"MapboxRasterTile"),yi(kE,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class BE{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const UD=["id","tile","layer","source","sourceLayer","state"];class tp{constructor(e,i,o,c,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=c,this.properties=e.properties,this.id=f}clone(){const e=new tp(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of UD)this[i]!==void 0&&(e[i]=this[i]);return e}}class NE{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Su(Zt,16,0),this.featureIndexArray=new pg,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,c,f,p=0,v=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,f,p);const T=this.grid;for(let I=0;I<i.length;I++){const C=i[I],O=[1/0,1/0,-1/0,-1/0];for(let B=0;B<C.length;B++){const N=C[B];O[0]=Math.min(O[0],N.x),O[1]=Math.min(O[1],N.y),O[2]=Math.max(O[2],N.x),O[3]=Math.max(O[3],N.y)}v!==0&&(O[0]-=v,O[1]-=v,O[2]+=v,O[3]+=v),O[0]<Zt&&O[1]<Zt&&O[2]>=0&&O[3]>=0&&T.insert(b,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new on(new Vg(this.rawTileData)).layers,this.sourceLayerCoder=new BE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:c,tileTransform:f,pixelPosMatrix:p,availableImages:v,worldview:b}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const T=o.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,((N,X,K,Y)=>Us(o.bufferedTilespaceGeometry,N,X,K,Y)));I.sort(VD);let C=null;c.elevation&&I.length>0&&(C=Yf.create(c.elevation,this.tileID));const O={};let B;for(let N=0;N<I.length;N++){const X=I[N];if(X===B)continue;B=X;const K=this.featureIndexArray.get(X);let Y=null;this.is3DTile?this.loadMatchingModelFeature(O,K,e,o,c,b):this.loadMatchingFeature(O,K,e,v,b,((ue,de,_e,ze=0)=>(Y||(Y=hi(ue,this.tileID.canonical,f)),de.queryIntersectsFeature(o,ue,_e,Y,this.z,c,p,C,ze))))}return O}loadMatchingFeature(e,i,o,c,f,p){const{featureIndex:v,bucketIndex:b,sourceLayerIndex:T,layoutVertexArrayOffset:I}=i,C=this.bucketLayerIDs[b],O=o.layers,B=Object.keys(O);if(B.length&&!Mn(B,C))return;const N=o.sourceCache,X=this.sourceLayerCoder.decode(T),K=this.vtLayers[X].feature(v),Y=this.getId(K,X);for(let ue=0;ue<C.length;ue++){const de=C[ue];if(!O[de])continue;const{styleLayer:_e,targets:ze}=O[de];let ke={};Y!==void 0&&(ke=N.getFeatureState(_e.sourceLayer,Y));const Ue=!p||p(K,_e,ke,I);if(!Ue)continue;const qe=new tp(K,this.z,this.x,this.y,Y);qe.tile=this.tileID.canonical,qe.state=ke;let Ze=this.serializedLayersCache.get(de);Ze||(Ze=_e.serialize(),Ze.id=de,this.serializedLayersCache.set(de,Ze)),qe.source=Ze.source,qe.sourceLayer=Ze["source-layer"],qe.layer=Object.assign({},Ze),qe.layer.paint=UE(Ze.paint,_e.paint,K,ke,c),qe.layer.layout=UE(Ze.layout,_e.layout,K,ke,c);let Et=!1;for(const Je of ze){this.updateFeatureProperties(qe,Je);const{filter:Ot}=Je;if(Ot){if(K.properties=qe.properties,Ot.needGeometry){const jt=qt(K,!0);if(!Ot.filter(new Nr(this.tileID.overscaledZ,{worldview:f}),jt,this.tileID.canonical))continue}else if(!Ot.filter(new Nr(this.tileID.overscaledZ,{worldview:f}),K))continue}Et=!0,Je.targetId&&this.addFeatureVariant(qe,Je)}Et&&this.appendToResult(e,de,v,qe,Ue)}}loadMatchingModelFeature(e,i,o,c,f,p){const{featureIndex:v,bucketIndex:b}=i,T=this.bucketLayerIDs[b],I=o.layers,C=Object.keys(I);if(!C.length||Mn(C,T))for(let O=0;O<T.length;O++){const B=T[O],{styleLayer:N,targets:X}=I[B];if(N.type!=="model")continue;const K=c.tile,Y=K.getBucket(N);if(!(Y&&Y instanceof oy))continue;const ue=HL(Y,v,c,f);if(!ue)continue;const{z:de,x:_e,y:ze}=K.tileID.canonical,{feature:ke,intersectionZ:Ue,position:qe}=ue;let Ze={};ke.id!==void 0&&(Ze=o.sourceCache.getFeatureState(N.sourceLayer,ke.id));const Et=new tp({},de,_e,ze,ke.id);Et.tile=this.tileID.canonical,Et.state=Ze,Et.properties=ke.properties,Et.geometry={type:"Point",coordinates:[qe.lng,qe.lat]};let Je=this.serializedLayersCache.get(B);Je||(Je=N.serialize(),Je.id=B,this.serializedLayersCache.set(B,Je)),Et.source=Je.source,Et.sourceLayer=Je["source-layer"],Et.layer=Object.assign({},Je);let Ot=!1;for(const jt of X){this.updateFeatureProperties(Et,jt);const{filter:Lt}=jt;if(Lt){if(ke.properties=Et.properties,Lt.needGeometry){if(!Lt.filter(new Nr(this.tileID.overscaledZ,{worldview:p}),ke,this.tileID.canonical))continue}else if(!Lt.filter(new Nr(this.tileID.overscaledZ,{worldview:p}),ke))continue}Ot=!0,jt.targetId&&this.addFeatureVariant(Et,jt)}Ot&&this.appendToResult(e,B,v,Et,Ue)}}updateFeatureProperties(e,i,o){if(i.properties){const c={};for(const f in i.properties){const p=i.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);p!=null&&(c[f]=p)}e.properties=c}}addFeatureVariant(e,i,o){const c={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(c)}appendToResult(e,i,o,c,f){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:o,feature:c,intersectionZ:f})}lookupSymbolFeatures(e,i,o,c,f,p){const v={};this.loadVTLayers();for(const b of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:o,featureIndex:b,layoutVertexArrayOffset:0},c,f,p);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(o),f=this.vtFeatures[c];if(f[i])return f[i];const p=this.vtLayers[c].feature(i);return f[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const f=zl(c);if(f.result!=="success"){const p=f.value.map((v=>`${v.key}: ${v.message}`)).join(", ");return void An(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=f.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new fl),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[c];typeof o=="boolean"&&(o=Number(o))}return o}}function UE(n,e,i,o,c){return Ki(n,((f,p)=>{const v=e instanceof Cu?e.get(p):null;return v&&v.evaluate?v.evaluate(i,o,void 0,c):v}))}function VD(n,e){return e-n}yi(NE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const VE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class f0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=VE[15&o];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new f0(v,p,f,e)}constructor(e,i=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=VE.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+v+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return p0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:v}=this,b=[0,f.length-1,0],T=[];for(;b.length;){const I=b.pop()||0,C=b.pop()||0,O=b.pop()||0;if(C-O<=v){for(let K=O;K<=C;K++){const Y=p[2*K],ue=p[2*K+1];Y>=e&&Y<=o&&ue>=i&&ue<=c&&T.push(f[K])}continue}const B=O+C>>1,N=p[2*B],X=p[2*B+1];N>=e&&N<=o&&X>=i&&X<=c&&T.push(f[B]),(I===0?e<=N:i<=X)&&(b.push(O),b.push(B-1),b.push(1-I)),(I===0?o>=N:c>=X)&&(b.push(B+1),b.push(C),b.push(1-I))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:p}=this,v=[0,c.length-1,0],b=[],T=o*o;for(;v.length;){const I=v.pop()||0,C=v.pop()||0,O=v.pop()||0;if(C-O<=p){for(let K=O;K<=C;K++)$E(f[2*K],f[2*K+1],e,i)<=T&&b.push(c[K]);continue}const B=O+C>>1,N=f[2*B],X=f[2*B+1];$E(N,X,e,i)<=T&&b.push(c[B]),(I===0?e-o<=N:i-o<=X)&&(v.push(O),v.push(B-1),v.push(1-I)),(I===0?e+o>=N:i+o>=X)&&(v.push(B+1),v.push(C),v.push(1-I))}return b}}function p0(n,e,i,o,c,f){if(c-o<=i)return;const p=o+c>>1;jE(n,e,p,o,c,f),p0(n,e,i,o,p-1,1-f),p0(n,e,i,p+1,c,1-f)}function jE(n,e,i,o,c,f){for(;c>o;){if(c-o>600){const T=c-o+1,I=i-o+1,C=Math.log(T),O=.5*Math.exp(2*C/3),B=.5*Math.sqrt(C*O*(T-O)/T)*(I-T/2<0?-1:1);jE(n,e,i,Math.max(o,Math.floor(i-I*O/T+B)),Math.min(c,Math.floor(i+(T-I)*O/T+B)),f)}const p=e[2*i+f];let v=o,b=c;for(Ym(n,e,o,i),e[2*c+f]>p&&Ym(n,e,o,c);v<b;){for(Ym(n,e,v,b),v++,b--;e[2*v+f]<p;)v++;for(;e[2*b+f]>p;)b--}e[2*o+f]===p?Ym(n,e,o,b):(b++,Ym(n,e,b,c)),b<=i&&(o=b+1),i<=b&&(c=b-1)}}function Ym(n,e,i,o){m0(n,i,o),m0(e,2*i,2*o),m0(e,2*i+1,2*o+1)}function m0(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function $E(n,e,i,o){const c=n-i,f=e-o;return c*c+f*f}r.$=Ra,r.A=Ko,r.B=yh,r.C=2,r.D=Vf,r.E=ys,r.F=Fm,r.G=pS,r.H=Jl,r.I=Kr,r.J=wf,r.K=Wi,r.L=Ql,r.M=hf,r.N=uf,r.O=$p,r.P=kt,r.Q=Gp,r.R=fr,r.S=Mu,r.T=Px,r.U=zl,r.V=sy,r.W=Hp,r.X=Bo,r.Y=_r,r.Z=Ro,r._=qs,r.a=function(n){return sr.API_CDN_URL_REGEX.test(n)},r.a$=Ie,r.a0=il,r.a1=Po,r.a2=Tf,r.a3=class extends sy{},r.a4=df,r.a5=jp,r.a6=Ye,r.a7=function(n){const e=n.value;return e?il(e)?i0(e,!0)?[]:[new sy(n.key,e,`invalid url "${e}"`)]:[new sy(n.key,e,`string expected, "${Wi(e)}" found`)]:[]},r.a8=J_,r.a9=xs,r.aA=Le,r.aB=Se,r.aC=ui,r.aD=u,r.aE=xo,r.aF=ye,r.aG=it,r.aH=function(n,e){const i={};for(let o=0;o<e.length;o++){const c=e[o];c in n&&(i[c]=n[c])}return i},r.aI=ie,r.aJ=Pe,r.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,o){const c=this.entries[n]=this.entries[n]||{callbacks:[]};if(c.result){const[f,p]=c.result;return this.scheduler?this.scheduler.add((()=>{o(f,p)}),e):o(f,p),()=>{}}return c.callbacks.push(o),c.cancel||(c.cancel=i(((f,p)=>{c.result=[f,p];for(const v of c.callbacks)this.scheduler?this.scheduler.add((()=>{v(f,p)}),e):v(f,p);setTimeout((()=>delete this.entries[n]),3e3)}))),()=>{c.result||(c.callbacks=c.callbacks.filter((f=>f!==o)),c.callbacks.length||(c.cancel(),delete this.entries[n]))}}},r.aL=function(n,e,i){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},(c=>{const f=Ps(n.request,((p,v,b,T)=>{p?c(p):v&&c(null,{vectorTile:i?void 0:new on(new Vg(v)),rawData:v,cacheControl:b,expires:T})}));return()=>{f.cancel(),c()}}),e)},r.aM=function(n){ko++,ko>mo&&(n.getActor().send("enforceCacheSizeLimit",Vs),ko=0)},r.aN=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},r.aO=ma,r.aP=$S,r.aQ=XS,r.aR=Z,r.aS=jS,r.aT=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<n.length;o++){const c=document.createElement("source");Pa(n[o])||(i.crossOrigin="Anonymous"),c.src=n[o],i.appendChild(c)}return{cancel:()=>{}}},r.aU=Rm,r.aV=function(n){return fetch(n).then((e=>e.arrayBuffer())).then((e=>vT(e,0,n)))},r.aW=IT,r.aX=class{constructor(n,e,i,o){this.id=n,this.position=e!=null?new Z(e[0],e[1]):new Z(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(Se(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const o=nn.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(o)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=he([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,o,c,f,p=!1){ET(this.matrix,this,n.transform,this.position,e,i,o,c,f,p)}upload(n){if(!this.uploaded){for(const e of this.nodes)Rx(e,n);for(const e of this.nodes)Ug(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)Ox(n)}},r.aY=qi,r.aZ=Um,r.a_=Me,r.aa=Wt,r.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return zr(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Mi(n.x,e.x,i),y:Mi(n.y,e.y,i),z:Mi(n.z,e.z,i),azimuthal:Mi(n.azimuthal,e.azimuthal,i),polar:Mi(n.polar,e.polar,i)}}},r.ac=Nr,r.ad=Lc,r.ae=pt,r.af=_i,r.ag=ft,r.ah=rt,r.ai=Cu,r.aj=Ih,r.ak=Mi,r.al=Zt,r.am=va,r.an=Xe,r.ao=Cn,r.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return(function([i,o]){const c=zr([1,i,o]);return{x:c.x,y:c.y,z:c.z}})(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Mi(n.x,e.x,i),y:Mi(n.y,e.y,i),z:Mi(n.z,e.z,i)}}},r.aq=function(n,e,i=0,o=!0){const c=new kt(i,i),f=n.sub(c),p=e.add(c),v=[f,new kt(p.x,f.y),p,new kt(f.x,p.y)];return o&&v.push(f.clone()),v},r.ar=function(n,e){const i=[];for(let o=0;o<n.length;o++){const c=je(o-1,-1,n.length-1),f=je(o+1,-1,n.length-1),p=n[o],v=n[f],b=n[c].sub(p).unit(),T=v.sub(p).unit(),I=T.angleWithSep(b.x,b.y),C=b.add(T).unit().mult(-1*e/Math.sin(I/2));i.push(p.add(C))}return i},r.as=PS,r.at=Us,r.au=function(n,e,i=0){return tt(((e.x-i)*n.scale-n.x)*Zt,(e.y*n.scale-n.y)*Zt,Ee(e.z,e.y))},r.av=vt,r.aw=Pt,r.ax=lr,r.ay=NT,r.az=function(n){let e=1/0,i=1/0,o=-1/0,c=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),c=Math.max(c,f.y);return{min:new kt(e,i),max:new kt(o,c)}},r.b=function(n){return sr.API_FONTS_REGEX.test(n)},r.b$=_x,r.b0=Ou,r.b1=co,r.b2=Ct,r.b3=hm,r.b4=ty,r.b5=function(){kl.isLoading()||kl.isLoaded()||bf()!=="deferred"||Eu()},r.b6=rd,r.b7=qt,r.b8=tp,r.b9=Zn,r.bA=he,r.bB=xt,r.bC=se,r.bD=function(n,e){const{x:i,y:o}=n.point,c=a1(i,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Se(c,c,nx(qc(e)))},r.bE=W,r.bF=$e,r.bG=function(n,e){var i=e[0]-n[0],o=e[1]-n[1],c=e[2]-n[2];return Math.sqrt(i*i+o*o+c*c)},r.bH=ki,r.bI=Ui,r.bJ=pi,r.bK=km,r.bL=Xa,r.bM=$x,r.bN=function(n,e,i,o,c){const f=5*e+2;n.float32[f+0]=i,n.float32[f+1]=o,n.float32[f+2]=c},r.bO=ey,r.bP=Wr,r.bQ=Rt,r.bR=Dr,r.bS=rs,r.bT=je,r.bU=function(n,e,i,o){var c=new H(4);return c[0]=n,c[1]=e,c[2]=i,c[3]=o,c},r.bV=Lg,r.bW=Ha,r.bX=Lo,r.bY=B1,r.bZ=KS,r.b_=j1,r.ba=kx,r.bb=fx,r.bc=hi,r.bd=Bc,r.be=Of,r.bf=t1,r.bg=cs,r.bh=Nf,r.bi=e0,r.bj=function(n,e){const i=Ih(e.zoom);if(i===0)return qc(n);const o=wg(n),c=ix(o),f=ye(o.getWest())*e.worldSize,p=ye(o.getEast())*e.worldSize,v=Pe(o.getNorth())*e.worldSize,b=Pe(o.getSouth())*e.worldSize,T=[f,v,0],I=[p,v,0],C=[f,b,0],O=[p,b,0],B=Te([],e.globeMatrix);return _i(T,T,B),_i(I,I,B),_i(C,C,B),_i(O,O,B),c[0]=ku(c[0],C,i),c[1]=ku(c[1],O,i),c[2]=ku(c[2],I,i),c[3]=ku(c[3],T,i),nn.fromPoints(c)},r.bk=Sg,r.bl=Te,r.bm=mm,r.bn=ku,r.bo=Ru,r.bp=mR,r.bq=It,r.br=fe,r.bs=fy,r.bt=Vg,r.bu=Ps,r.bv=function(n,e){const i=[];for(const o in n)o in e||i.push(o);return i},r.bw=st,r.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.by=ls,r.bz=function(n){var e=new H(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},r.c=oa,r.c$=function(n){return n*n*n*n*n},r.c0=jx,r.c1=bS,r.c2=Zx,r.c3=f0,r.c4=di,r.c5=ii,r.c6=sn,r.c7=function(n,e,i){i*=.5;var o=e[0],c=e[1],f=e[2],p=e[3],v=Math.sin(i),b=Math.cos(i);return n[0]=o*b+c*v,n[1]=c*b-o*v,n[2]=f*b+p*v,n[3]=p*b-f*v,n},r.c8=Hi,r.c9=Rr,r.cA=Tn,r.cB=bT,r.cC=hc,r.cD=r1,r.cE=function(n,e,i,o,c,f,p,v,b){if(b.name==="globe")return r1(n,e,new hc(i,o,c),!1);const T=Um({z:i,x:o,y:c},b);return new nn([(f+T.x/T.scale)*e,e*(T.y/T.scale),p],[(f+T.x2/T.scale)*e,e*(T.y2/T.scale),v])},r.cF=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},r.cG=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},r.cH=function(n){const e=Math.round((n+45+360)%360/90)%4;return ne[e]},r.cI=Re,r.cJ=Ei,r.cK=g,r.cL=function(n){const e=he(new Float64Array(16));Se(e,n.pixelMatrix,n.globeMatrix);const i=[0,R,0],o=[0,D,0];return _i(i,i,e),_i(o,o,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!sx(n,new Z(n.center.lat,90)),o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!sx(n,new Z(n.center.lat,-90))]},r.cM=function(n,e){const{scale:i}=n.tileTransform,o=i*Zt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return(function(c,f,p){var v=f[1],b=f[2],T=f[3],I=p[0],C=p[1];return c[0]=f[0]*I,c[1]=v*I,c[2]=b*C,c[3]=T*C,c})(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.cN=Bg,r.cO=De,r.cP=xT,r.cQ=function(n){const e=xT(n,!0);return W([],[e[0],e[1],e[4],e[5]])},r.cR=oe,r.cS=dr,r.cT=ge,r.cU=function(n){const{x:e,y:i}=n.point,{lng:o,lat:c}=n._center;return a1(e,i,n.worldSize,o,c)},r.cV=wt,r.cW=Q,r.cX=Bf,r.cY=qo,r.cZ=m,r.c_=function(n,e,i){let o=0;for(let c=0;c<2;++c)n[c]>0&&(o+=(n[c]-0)*(n[c]-0)),e[c]<0&&(o+=(0-e[c])*(0-e[c]));return o},r.ca=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.cb=Be,r.cc=function(n,e,i,o,c){var f=1/Math.tan(e/2);if(n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0){var p=1/(o-c);n[10]=(c+o)*p,n[14]=2*c*o*p}else n[10]=-1,n[14]=-2*o;return n},r.cd=function(n,e,i,o,c,f,p){var v=1/(e-i),b=1/(o-c),T=1/(f-p);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*b,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*v,n[13]=(c+o)*b,n[14]=(p+f)*T,n[15]=1,n},r.ce=Ae,r.cf=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},r.cg=dd,r.ch=fd,r.ci=Ns,r.cj=Bl,r.ck=md,r.cl=LS,r.cm=function(){var n=new H(4);return H!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.cn=function(n,e,i){var o=e[0],c=e[1],f=e[2],p=e[3],v=Math.sin(i),b=Math.cos(i);return n[0]=o*b+f*v,n[1]=c*b+p*v,n[2]=o*-v+f*b,n[3]=c*-v+p*b,n},r.co=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.cp=lt,r.cq=function(n){var e=n[0],i=n[1],o=n[2],c=n[3];return Math.sqrt(e*e+i*i+o*o+c*c)},r.cr=Xn,r.cs=Qi,r.ct=Ff,r.cu=3,r.cv=2,r.cw=7,r.cx=6,r.cy=ei,r.cz=Oe,r.d=function(n){return sr.API_TILEJSON_REGEX.test(n)},r.d$=$T,r.d0=me,r.d1=45,r.d2=pd,r.d3=function(n,e,i){const o=Math.sqrt(n*n+e*e+i*i),c=o>0?Math.acos(i/o)*wo:0;let f=n!==0||e!==0?Math.atan2(-e,-n)*wo+90:0;return f<0&&(f+=360),[o,f,c]},r.d4=tt,r.d5=zr,r.d6=et,r.d7=yt,r.d8=nn,r.d9=si,r.dA=function(n,e,i){const o=Ih(i.zoom),c=n.style.map._antialias,f=n.terrain&&n.terrain.exaggeration()>0;return o===0&&!c&&!f},r.dB=function(n){const e=n.pixelsPerMeter,i=e/Ae(1,n.center.lat),o=he(new Float64Array(16));return fe(o,o,[n.point.x,n.point.y,0]),oe(o,o,[i,i,e]),Float32Array.from(o)},r.dC=wg,r.dD=function(n){const e=Re-5;n=Le(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Xe(n))),3);return Math.round(i*(A.length-1))},r.dE=function(n,e,i,o){const c=e.getNorth(),f=e.getSouth(),p=e.getWest(),v=e.getEast(),b=1<<n.z,T=v-p,I=c-f,C=T/w,O=-I/A[i],B=[0,C,0,O,0,0,c,p,0];if(n.z>0){const N=180/o;pe(B,B,[N/T+1,0,0,0,N/I+1,0,-.5*N/C,.5*N/O,1])}return B[2]=b,B[5]=n.x,B[8]=n.y,B},r.dF=qc,r.dG=function(n,e,i){const o=he(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return Ge(o,i.globeMatrix,c),Float32Array.from(o)},r.dH=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,c=Math.floor(n.x),f=Math.floor((n.x-c)*o),p=Math.floor(n.y*o),v=this.findDEMTileFor(new ma(i,c,i,f,p));return!(!v||!v.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const c=o.getSource().maxzoom,f=1<<c,p=Math.floor(n.x),v=n.x-p,b=new ma(c,p,c,Math.floor(v*f),Math.floor(n.y*f)),T=this.findDEMTileFor(b);if(!T||!T.dem)return e;const I=T.dem,C=1<<T.tileID.canonical.z,O=(v*C-T.tileID.canonical.x)*I.dim,B=(n.y*C-T.tileID.canonical.y)*I.dim,N=Math.floor(O),X=Math.floor(B);return(i?this.exaggeration():1)*Mi(Mi(I.get(N,X),I.get(N,X+1),B-X),Mi(I.get(N+1,X),I.get(N+1,X+1),B-X),O-N)}getAtTileOffset(n,e,i){const o=1<<n.canonical.z;return this.getAtPointOrZero(new pt(n.wrap+(n.canonical.x+e/Zt)/o,(n.canonical.y+i/Zt)/o))}getAtTileOffsetFunc(n,e,i,o){return c=>{const f=this.getAtTileOffset(n,c.x,c.y),p=o.upVector(n.canonical,c.x,c.y);return di(p,p,f*o.upVectorScale(n.canonical,e,i).metersToTile),p}}getForTilePoints(n,e,i,o){if(this.isUsingMockSource())return!1;const c=Yf.create(this,n,o);return!!c&&(e.forEach((f=>{f[2]=this.exaggeration()*c.getElevationAt(f[0],f[1],i)})),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,c=1<<n.canonical.z-o.canonical.z;let f=n.canonical.x/c-o.canonical.x,p=n.canonical.y/c-o.canonical.y,v=0;for(let b=0;b<n.canonical.z-o.canonical.z&&!i.leaves[v];b++){f*=2,p*=2;const T=2*Math.floor(p)+Math.floor(f);v=i.childOffsets[v]+T,f%=1,p%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const c of n){const f=this.getMinMaxForTile(c.tileID);f&&(i=Math.min(i,f.min),o=Math.max(o,f.max),e=!0)}return e?{min:i,max:o}:null}},r.dI=x1,r.dJ=bg,r.dK=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dL=ee,r.dM=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dN=un,r.dO=o1,r.dP=gs,r.dQ=zs,r.dR=256,r.dS=function(n,e){const i=[0,0,0];return _i(i,i,Sg(qc(e.canonical))),_i(i,i,n),i},r.dT=n=>({u_matrix:new md(n),u_texsize:new Bl(n),u_pixels_to_tile_units:new kf(n),u_device_pixel_ratio:new Ns(n),u_width_scale:new Ns(n),u_floor_width_scale:new Ns(n),u_image:new dd(n),u_units_to_pixels:new Bl(n),u_tile_units_to_pixels:new Ns(n),u_alpha_discard_threshold:new Ns(n),u_trim_offset:new Bl(n),u_trim_fade_range:new Bl(n),u_trim_color:new pd(n),u_emissive_strength:new Ns(n),u_zbias_factor:new Ns(n),u_tile_to_meter:new Ns(n),u_ground_shadow_factor:new fd(n),u_pattern_transition:new Ns(n)}),r.dU=n=>({u_matrix:new md(n),u_pixels_to_tile_units:new kf(n),u_device_pixel_ratio:new Ns(n),u_width_scale:new Ns(n),u_floor_width_scale:new Ns(n),u_units_to_pixels:new Bl(n),u_dash_image:new dd(n),u_gradient_image:new dd(n),u_image_height:new Ns(n),u_texsize:new Bl(n),u_tile_units_to_pixels:new Ns(n),u_alpha_discard_threshold:new Ns(n),u_trim_offset:new Bl(n),u_trim_fade_range:new Bl(n),u_trim_color:new pd(n),u_emissive_strength:new Ns(n),u_zbias_factor:new Ns(n),u_tile_to_meter:new Ns(n),u_ground_shadow_factor:new fd(n)}),r.dV=n=>({u_camera_to_center_distance:new Ns(n),u_extrude_scale:new kf(n),u_device_pixel_ratio:new Ns(n),u_matrix:new md(n),u_inv_rot_matrix:new md(n),u_merc_center:new Bl(n),u_tile_id:new fd(n),u_zoom_transition:new Ns(n),u_up_dir:new fd(n),u_emissive_strength:new Ns(n)}),r.dW=om,r.dX=eL,r.dY=class{constructor(n,e,i,o){this.context=n,this.format=o,this.size=i,this.texture=n.gl.createTexture();const[c,f,p]=this.size,{gl:v}=n;v.bindTexture(v.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,c,f,p,0,Ax(this.format),Ix(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),n!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.dZ=u1,r.d_=(n,e,i,o,c,f)=>{const p=n.transform,v=p.projection.name==="globe";let b;if(f.paint.get("circle-pitch-alignment")==="map")if(v){const I=o1(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;b=Float32Array.from([I,0,0,I])}else b=p.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(p.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:oo.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:xR,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(v){T.u_inv_rot_matrix=o,T.u_merc_center=c,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=Ih(p.zoom);const I=c[0]*Zt,C=c[1]*Zt;T.u_up_dir=p.projection.upVector(new hc(0,0,0),I,C)}return T},r.da=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.db=i0,r.dc=function(n,e){return n.readFields(XL,{icons:[]},e)},r.dd=Dg,r.de=Wf,r.df=Gx,r.dg=Js,r.dh=Y_,r.di=Vo,r.dj=Ai,r.dk=Ji,r.dl=function(n){const e=n.indexOf(sd);return e>=0?n.slice(0,e):n},r.dm=function(n){return n.indexOf(sd)>=0},r.dn=function(n){const e=n.lastIndexOf(sd);return e>=0?n.slice(e+1):""},r.dp=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.dq=function(n,e,i,o){return n.type==="custom"?new $L(n,e):new ZL[n.type](n,e,i,o)},r.dr=pn,r.ds=function(n){const e=n.indexOf(sd);return e>=0?n.slice(e+1):""},r.dt=class extends tp{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.du=Yp,r.dv=Pn,r.dw=function(n){return n({pluginStatus:fa,pluginURL:kc}),Yp.on("pluginStateChange",n),n},r.dx=yg,r.dy=class extends Fl{constructor(n){super(n),this.current=Qv}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dz=be,r.e=sr,r.e$=function(){const n=Pm;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(bx),Pm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e0=Mo,r.e1=(n,e,i,o,c,f,p,v,b,T)=>{const I=n.transform,C=I.pitch<15?UT(.07,.7,Le((14-I.zoom)/5,0,1)):.07,O=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:jT(n,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:f,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:VT(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:et(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:T}},r.e2=(n,e,i,o,c,f,p,v,b,T)=>{const I=n.transform,C=I.calculatePixelsToTileUnitsMatrix(e),O=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=I.pitch<15?UT(.07,.7,Le((14-I.zoom)/5,0,1)):.07;return{u_matrix:jT(n,e,i,o),u_pixels_to_tile_units:C,u_device_pixel_ratio:f,u_width_scale:p,u_floor_width_scale:v,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:qT(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:VT(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:et(e.tileID.canonical,0),u_ground_shadow_factor:T}},r.e3=wi,r.e4=_m,r.e5=Ee,r.e6=fR,r.e7=Og,r.e8=eT,r.e9=Ch,r.eA=eo,r.eB=Th,r.eC=function(n,e,i,o,c,f,p,v,b,T,I,C,O,B,N,X){var K=new H(16);return K[0]=n,K[1]=e,K[2]=i,K[3]=o,K[4]=c,K[5]=f,K[6]=p,K[7]=v,K[8]=b,K[9]=T,K[10]=I,K[11]=C,K[12]=O,K[13]=B,K[14]=N,K[15]=X,K},r.eD=V,r.eE=ld,r.eF=Mf,r.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new kt(1/0,1/0),max:new kt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=U1(new kt(0,0),new kt(Zt,Zt),n),o=[];if(e&&!px(i,this._globalClipBounds))return o;for(const c of this._activeRegions){if(c.hiddenByOverlap||!px(i,c))continue;const f=WR(c.min,c.max,n);o.push({min:f.min,max:f.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return o}setSources(n){this._setSources(n.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(o).buckets[e.layer];c&&c.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),o=n.getClipMask(),c=n.getClipScope();for(const f of e){if(!f.footprint)continue;const p=U1(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:i,clipMask:o,clipScope:c})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||Cg(e.min,i.min)||Cg(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(o,c){const f=(p,v)=>p+v;return o.length-c.length||o.reduce(f,"").localeCompare(c.reduce(f,""))})(e.clipScope,i.clipScope)));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];n=i.priority!==o.priority||!N1(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!ls(i.clipScope,o.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==wm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const c=o[i].priority;for(;i<o.length&&o[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let c=i;const f=i;for(;c!==o;){const p=this._activeRegions[c];p.hiddenByOverlap=!1;for(let v=0;v<f;v++){const b=this._activeRegions[v];if(!b.hiddenByOverlap&&p.order===wm&&px(p,b)&&(p.hiddenByOverlap=V1(p.footprint,p.tileId,b.footprint,b.tileId),p.hiddenByOverlap))break}++c}i=o,o=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eH=wm,r.eI=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Bc,o=new co,c=[],f=n+1+2,p=e[0]+1,v=e[0]+1+(1+e.length),b=(T,I,C)=>{let O=T===f-1?T-2:T===0?T:T-1;return O+=C?24575:0,[O,I]};for(let T=0;T<f;++T)i.emplaceBack(...b(T,0,!0));for(let T=0;T<p;++T)for(let I=0;I<f;++I)i.emplaceBack(...b(I,T,(I===0||I===f-1)&&!0));for(let T=0;T<e.length;++T){const I=e[T];for(let C=0;C<f;++C)i.emplaceBack(...b(C,I,!0))}for(let T=0;T<e.length;++T){const I=o.length,C=e[T]+1+2,O=new co;for(let X=0;X<C-1;X++){const K=X===C-2,Y=K?f*(v-e.length+T-X):f;for(let ue=0;ue<f-1;ue++){const de=X*f+ue;X===0||K||ue===0||ue===f-2?(O.emplaceBack(de+1,de,de+Y),O.emplaceBack(de+Y,de+Y+1,de+1)):(o.emplaceBack(de+1,de,de+Y),o.emplaceBack(de+Y,de+Y+1,de+1))}}const B=cs.simpleSegment(0,I,i.length,o.length-I);for(let X=0;X<O.uint16.length;X+=3)o.emplaceBack(O.uint16[X],O.uint16[X+1],O.uint16[X+2]);const N=cs.simpleSegment(0,I,i.length,o.length-I);c.push({withoutSkirts:B,withSkirts:N})}return{vertices:i,indices:o,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(w,A);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,t1.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new co;for(let p=0;p<=w;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Lu,o=new Lu,c=new Lu,f=new Lu;this._poleSegments=[];for(let p=0,v=0;p<m;p++){const b=360/(1<<p);i.emplaceBack(0,-u,0,.5,0),o.emplaceBack(0,-u,0,.5,1),c.emplaceBack(0,-u,0,.5,.5),f.emplaceBack(0,-u,0,.5,.5);for(let T=0;T<=w;T++){let I=T/w,C=0;const O=Mi(0,b,I),[B,N,X]=U(yR,vR,O,u);i.emplaceBack(B,N,X,I,C),o.emplaceBack(B,N,X,I,1-C);const K=Xe(O);I=.5+.5*Math.sin(K),C=.5+.5*Math.cos(K),c.emplaceBack(B,N,X,I,C),f.emplaceBack(B,N,X,I,1-C)}this._poleSegments.push(cs.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,xg,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,xg,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(c,xg,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(f,xg,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.eJ=F1,r.eK=Fe,r.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eM=ve,r.eN=gt,r.eO=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},r.eP=ai,r.eQ=F,r.eR=an,r.eS=At,r.eT=function([n,e,i]){const o=Math.hypot(n,e,i),c=Math.atan2(n,i),f=.5*Math.PI-Math.acos(-e/o);return new Z(Q(c),Q(f))},r.eU=bi,r.eV=Cx,r.eW=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!(function(i){if(kr==null){const o=i.navigator?i.navigator.userAgent:null;kr=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return kr})(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eX=function(n,e){Vs=n,mo=e},r.eY=sx,r.eZ=l1,r.e_=function(n){const e=[0,0,0],i=he(new Float64Array(16));return Se(i,n.pixelMatrix,n.globeMatrix),_i(e,e,i),new kt(e[0],e[1])},r.ea=450,r.eb=7,r.ec=We,r.ed=function(n,e){if(n===e){var i=e[1],o=e[2],c=e[3],f=e[6],p=e[7],v=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=o,n[9]=f,n[11]=e[14],n[12]=c,n[13]=p,n[14]=v}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.ee=jL,r.ef=qn,r.eg=Eh,r.eh=256,r.ei=nx,r.ej=Ta,r.ek=Ge,r.el=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.em=Lu,r.en=cm,r.eo=Bp,r.ep=function(n,e,i,o,c){return Le((n-e)/(i-e)*(c-o)+o,o,c)},r.eq=$i,r.er=function(n,e){var i=e[0],o=e[1],c=e[2],f=e[3],p=e[4],v=e[5],b=e[6],T=e[7],I=e[8],C=I*p-v*T,O=-I*f+v*b,B=T*f-p*b,N=i*C+o*O+c*B;return N?(n[0]=C*(N=1/N),n[1]=(-I*o+c*T)*N,n[2]=(v*o-c*p)*N,n[3]=O*N,n[4]=(I*i-c*b)*N,n[5]=(-v*i+c*f)*N,n[6]=B*N,n[7]=(-T*i+o*b)*N,n[8]=(p*i-o*f)*N,n):null},r.es=2,r.et=mt,r.eu=Mx,r.ev=[1,1,1],r.ew=Yf,r.ex=ci,r.ey=function(n,e,i,o){var c=e[0],f=e[1],p=e[2],v=e[3];return n[0]=c+o*(i[0]-c),n[1]=f+o*(i[1]-f),n[2]=p+o*(i[2]-p),n[3]=v+o*(i[3]-v),n},r.ez=Gf,r.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},r.f0=function(){Dg().acquire(bx)},r.f1=bf,r.f2=function(n,e,i=!1){if(fa===La.deferred||fa===La.loading||fa===La.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");kc=oo.resolveURL(n),fa=La.deferred,Xp=e,Kp(),i||Eu()},r.f3=function(n){jf=oo.resolveURL(n),$f||($f=new Vf(Dg(),new ys)),$f.broadcast("setMeshoptUrl",jf)},r.f4=fT,r.f5=function(n){Tx=oo.resolveURL(n),$f||($f=new Vf(Dg(),new ys)),$f.broadcast("setDracoUrl",Tx)},r.f6=dT,r.f7=Im,r.f8=function(n){const e=go();if(!e)return;const i=e.delete(Or);n&&i.then((()=>n())).catch(n)},r.f9=vd,r.fA=function(n){To(),js?.then((e=>{e.keys().then((i=>{for(let o=0;o<i.length-n;o++)e.delete(i[o]).catch((c=>An(c.message)))})).catch((i=>An(i.message)))})).catch((e=>An(e.message)))},r.fa=yi,r.fb=Ph,r.fc=fc,r.fd=BE,r.fe=NE,r.ff=kT,r.fg=wn,r.fh="hd_road_elevation",r.fi=os,r.fj=Ki,r.fk=Fu,r.fl=qx,r.fm=wd,r.fn=function(n,e,i,o,c,f,p,v=1,b,T,I){n.createArrays(),n.tilePixelRatio=Zt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const C=n.layers[0].layout,O=n.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=v,B.textSizeScaleRange=C.get("text-size-scale-range"),B.iconSizeScaleRange=C.get("icon-size-scale-range");const[N,X]=B.textSizeScaleRange,[K,Y]=B.iconSizeScaleRange;B.textScaleFactor=Le(B.scaleFactor,N,X),B.iconScaleFactor=Le(B.scaleFactor,K,Y);const ue=O["text-size"],de=O["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:Ze,maxZoom:Et}=n.textSizeData;B.compositeTextSizes=[ue.possiblyEvaluate(new Nr(Ze,{worldview:I}),f),ue.possiblyEvaluate(new Nr(Et,{worldview:I}),f)]}if(n.iconSizeData.kind==="composite"){const{minZoom:Ze,maxZoom:Et}=n.iconSizeData;B.compositeIconSizes=[de.possiblyEvaluate(new Nr(Ze,{worldview:I}),f),de.possiblyEvaluate(new Nr(Et,{worldview:I}),f)]}B.layoutTextSize=ue.possiblyEvaluate(new Nr(p+1,{worldview:I}),f),B.layoutIconSize=de.possiblyEvaluate(new Nr(p+1,{worldview:I}),f),B.textMaxSize=ue.possiblyEvaluate(new Nr(18,{worldview:I}),f);const _e=C.get("symbol-placement"),ze=C.get("text-rotation-alignment")==="map"&&_e!=="point",ke=C.get("text-size");let Ue=!1;const qe=[];for(const Ze of n.features){const Et=C.get("text-font").evaluate(Ze,{},f).join(","),Je=ke.evaluate(Ze,{},f)*B.textScaleFactor,Ot=B.layoutTextSize.evaluate(Ze,{},f)*B.textScaleFactor,jt=B.layoutIconSize.evaluate(Ze,{},f)*B.iconScaleFactor,Lt={horizontal:{},vertical:void 0},Ft=Ze.text;let Gt,Tt=[0,0];if(Ft){const zi=Ft.toString(),tn=C.get("text-letter-spacing").evaluate(Ze,{},f)*Lo,_n=C.get("text-line-height").evaluate(Ze,{},f)*Lo,On=X_(zi)?tn:0,yn=C.get("text-anchor").evaluate(Ze,{},f),Si=C.get("text-variable-anchor");if(!Si){const ut=C.get("text-radial-offset").evaluate(Ze,{},f);if(ut)Tt=bS(yn,[ut*Lo,Hx]);else{const St=C.get("text-offset").evaluate(Ze,{},f);Tt=[St[0]*Lo,St[1]*Lo]}}let gn=ze?"center":C.get("text-justify").evaluate(Ze,{},f);const Wn=_e==="point",xe=Wn?C.get("text-max-width").evaluate(Ze,{},f)*Lo:1/0,we=ut=>{n.allowVerticalPlacement&&Wp(zi)&&(Lt.vertical=Vx(Ft,e,i,c,Et,xe,_n,yn,ut,On,Tt,Xa.vertical,!0,Ot,Je,b))};if(!ze&&Si){const ut=gn==="auto"?Si.map((ri=>Zx(ri))):[gn];let St=!1;for(let ri=0;ri<ut.length;ri++){const ni=ut[ri];if(!Lt.horizontal[ni])if(St)Lt.horizontal[ni]=Lt.horizontal[0];else{const xi=Vx(Ft,e,i,c,Et,xe,_n,"center",ni,On,Tt,Xa.horizontal,!1,Ot,Je,b);xi&&(Lt.horizontal[ni]=xi,St=xi.positionedLines.length===1)}}we("left")}else{if(gn==="auto"&&(gn=Zx(yn)),Wn||C.get("text-writing-mode").indexOf("horizontal")>=0||!Wp(zi)){const ut=Vx(Ft,e,i,c,Et,xe,_n,yn,gn,On,Tt,Xa.horizontal,!1,Ot,Je,b);ut&&(Lt.horizontal[gn]=ut)}we(Wn?"left":gn)}}let Bt,ht,at,Ht,$t,Vi,gi=!1;const Ci=C.get("icon-text-fit").evaluate(Ze,{},f);if(Ze.icon&&Ze.icon.hasPrimary()){const zi=TS(Ze.icon,n.iconSizeData,O["icon-size"],f,n.zoom,Ze,b,B.iconScaleFactor,I);Bt=zi.iconPrimary,at=zi.iconSecondary;const tn=Bt.toString();if(ht=o.get(tn),ht&&($t=C.get("icon-offset").evaluate(Ze,{},f),Vi=C.get("icon-anchor").evaluate(Ze,{},f),Gt=yL(c.get(tn),at?c.get(at.toString()):void 0,$t,Vi),gi=ht.sdf,n.sdfIcons===void 0?n.sdfIcons=ht.sdf:n.sdfIcons!==ht.sdf&&An("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ht.pixelRatio!==n.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),at){const _n=at.toString();Ht=o.get(_n)}}Ue=Ue||!(!Ze.icon||!Ze.icon.hasSecondary());const Yt=Wx(Lt.horizontal)||Lt.vertical;n.iconsInText||(n.iconsInText=!!Yt&&Yt.iconsInText);const Ni=Ot*B.textScaleFactor/Lo,{defaultShapedIcon:ln,verticallyShapedIcon:oi}=PL(n,Gt,C,Ze,f,Lt,Ni,$t,Ci);Ci!=="none"&&Gt&&(sS(Gt)||oS(Gt))&&(Hg(0,ht,Bt,Gt,ln,Ci,T,o,c),Hg(0,Ht,at,Gt,ln,Ci,T,o,c),oi&&(Hg(0,ht,Bt,Gt,oi,Ci,T,o,c),Hg(0,Ht,at,Gt,oi,Ci,T,o,c))),Gt=ln,qe.push({feature:Ze,shapedTextOrientations:Lt,shapedText:Yt,shapedIcon:Gt,iconPrimary:Bt,iconSecondary:at,iconOffset:$t,iconAnchor:Vi,verticallyShapedIcon:oi,layoutTextSize:Ot,layoutIconSize:jt,textOffset:Tt,isSDFIcon:gi,iconTextFit:Ci})}return{featureData:qe,sizes:B,hasAnySecondaryIcon:Ue,textAlongLine:ze,symbolPlacement:_e}},r.fo=mS,r.fp=function(n,e,i,o,c,f,p,v,b,T){const{featureData:I,hasAnySecondaryIcon:C,sizes:O,textAlongLine:B,symbolPlacement:N}=e;for(const X of I){const{shapedIcon:K,verticallyShapedIcon:Y,feature:ue,shapedTextOrientations:de,shapedText:_e,layoutTextSize:ze,textOffset:ke,isSDFIcon:Ue,iconPrimary:qe,iconSecondary:Ze,iconTextFit:Et,iconOffset:Je}=X;SS(K,T.iconPositions,qe,Ze),SS(Y,T.iconPositions,qe,Ze),IL(de,T.iconPositions),AL(qe,Ze,T.iconPositions),(_e||K)&&CL(n,ue,de,K,Y,b,O,ze,0,ke,Ue,o,c,p,v,C,Et,Je,B,N)}i&&n.generateCollisionDebugBuffers(f,n.collisionBoxArray,O.textScaleFactor)},r.fq=on,r.fr=dy,r.fs=Ut,r.ft=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==mT){const i=new Uint32Array(n,0,7),[,,o,c,f,p]=i;e=i.byteLength+c+f+p+f,(o!==n.byteLength||e>=n.byteLength)&&An("Invalid b3dm header information.")}return vT(n,e)},r.fu=function(n,e){const i=IT(n);for(const o of i){for(const c of o.meshes)EO(c);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(AO(o.lights,e)))}return i},r.fv=oy,r.fw=rr,r.fx=uT,r.fy=kl,r.fz=La,r.g=function(n,e){return Pn(Object.assign(n,{method:"GET"}),e)},r.h=function(n){return n.indexOf("mapbox:")===0},r.i=function(n){return sr.API_STYLE_REGEX.test(n)&&!oa(n)},r.j=Wo,r.k=_t,r.l=function(n){return decodeURIComponent(atob(n).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},r.m=function(n,e){return Pn(Object.assign(n,{type:"json"}),e)},r.n=ms,r.o=oo,r.p=function(n,e){return Pn(Object.assign(n,{method:"POST"}),e)},r.q=Go,r.r=Ls,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return wx||(wx=new vd),wx},r.u=function(){return(function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)})()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=An,r.x=c0,r.y=Xr,r.z=Ii})),M(["./shared"],(function(r){function j(Xe){const Q=Xe?Xe.url.toString():void 0;return Q?performance.getEntriesByName(Q):[]}function H(Xe){if(typeof Xe=="number"||typeof Xe=="boolean"||typeof Xe=="string"||Xe==null)return JSON.stringify(Xe);if(Array.isArray(Xe)){let ne="[";for(const be of Xe)ne+=`${H(be)},`;return`${ne}]`}let Q="{";for(const ne of Object.keys(Xe).sort())Q+=`${ne}:${H(Xe[ne])},`;return`${Q}}`}function W(Xe){let Q="";for(const ne of r.bx)Q+=`/${H(Xe[ne])}`;return Q}class ee{constructor(Q){this.keyCache={},this._layers={},this._layerConfigs={},Q&&this.replace(Q)}replace(Q,ne){this._layerConfigs={},this._layers={},this.update(Q,[],ne)}update(Q,ne,be){this._options=be;for(const ve of Q)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=r.dq(ve,this.scope,null,this._options)).compileFilter(be),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of ne)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const Fe=(function(ve,Le){const rt={};for(let st=0;st<ve.length;st++){const Nt=ve[st];let Ct=Le&&Le[Nt.id];Ct||(Nt.type==="symbol"?Ct=Nt.id:(Ct=W(Nt),Nt.type==="line"&&Nt.paint&&(function qi(Ki){return typeof Ki=="string"&&Ki==="line-progress"||(Array.isArray(Ki)?Ki.some(qi):!(!Ki||typeof Ki!="object")&&Object.values(Ki).some(qi))})(Nt.paint["line-width"])&&(Ct+=`/${H(Nt.paint["line-width"])}`))),Le&&(Le[Nt.id]=Ct);let wi=rt[Ct];wi||(wi=rt[Ct]=[]),wi.push(Nt)}const je=[];for(const st in rt)je.push(rt[st]);return je})(Object.values(this._layerConfigs),this.keyCache);for(const ve of Fe){const Le=ve.map((wi=>this._layers[wi.id])),rt=Le[0];if(rt.visibility==="none")continue;const je=rt.source||"";let st=this.familiesBySource[je];st||(st=this.familiesBySource[je]={});const Nt=rt.sourceLayer||"_geojsonTileLayer";let Ct=st[Nt];Ct||(Ct=st[Nt]=[]),Ct.push(Le)}}}const le=1*r.fc;class pe{constructor(Q){const ne={},be=[];for(const rt in Q){const je=Q[rt],st=ne[rt]={};for(const Nt in je.glyphs){const Ct=je.glyphs[+Nt];if(!Ct||Ct.bitmap.width===0||Ct.bitmap.height===0)continue;const wi=Ct.metrics.localGlyph?le:1,qi={x:0,y:0,w:Ct.bitmap.width+2*wi,h:Ct.bitmap.height+2*wi};be.push(qi),st[Nt]=qi}}const{w:Fe,h:ve}=r.G(be),Le=new r.fb({width:Fe||1,height:ve||1});for(const rt in Q){const je=Q[rt];for(const st in je.glyphs){const Nt=je.glyphs[+st];if(!Nt||Nt.bitmap.width===0||Nt.bitmap.height===0)continue;const Ct=ne[rt][st],wi=Nt.metrics.localGlyph?le:1;r.fb.copy(Nt.bitmap,Le,{x:0,y:0},{x:Ct.x+wi,y:Ct.y+wi},Nt.bitmap)}}this.image=Le,this.positions=ne}}r.fa(pe,"GlyphAtlas");class se{constructor(Q){this.tileID=new r.aO(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.lut=Q.lut,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.scope=Q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.request&&Q.request.collectResourceTiming,this.promoteId=Q.promoteId,this.isSymbolTile=Q.isSymbolTile,this.tileTransform=r.aZ(Q.tileID.canonical,Q.projection),this.projection=Q.projection,this.worldview=Q.worldview,this.localizableLayerIds=Q.localizableLayerIds,this.brightness=Q.brightness,this.extraShadowCaster=!!Q.extraShadowCaster,this.tessellationStep=Q.tessellationStep,this.scaleFactor=Q.scaleFactor,this.worldview=Q.worldview}parse(Q,ne,be,Fe,ve,Le){this.status="parsing",this.data=Q,this.collisionBoxArray=new r.b3;const rt=new r.fd(Object.keys(Q.layers).sort()),je=new r.fe(this.tileID,this.promoteId);je.bucketLayerIDs=[];const st={},Nt=new r.ff(256,256),Ct={featureIndex:je,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Nt,availableImages:be,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},wi=[],qi=ne.familiesBySource[this.source];for(const pn in qi){const Ji=Q.layers[pn];if(!Ji)continue;let Mn=!1,er=!1,An=!1;for(const rr of qi[pn])rr[0].type==="symbol"?Mn=!0:er=!0,rr[0].is3D()&&rr[0].type!=="model"&&(An=!0);if(this.extraShadowCaster&&!An||this.isSymbolTile===!0&&!Mn||this.isSymbolTile===!1&&!er)continue;Ji.version===1&&r.w(`Vector tile source "${this.source}" layer "${pn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mr=rt.encode(pn),ss=[];let zr=!1;for(let rr=0,Zn=0;rr<Ji.length;rr++){const kr=Ji.feature(rr),Rr=je.getId(kr,pn);if(this.localizableLayerIds&&this.localizableLayerIds.has(pn)){const Gn=kr.properties?kr.properties.worldview:null;if(this.worldview&&typeof Gn=="string")if(Gn==="all")kr.properties.$localized=!0;else{if(!Gn.split(",").includes(this.worldview))continue;kr.properties.$localized=!0,kr.properties.worldview=this.worldview}}!zr&&kr.properties&&kr.properties.hasOwnProperty(r.fg)&&(zr=!0),ss.push({feature:kr,id:Rr,index:Zn,sourceLayerIndex:Mr}),Zn++}zr&&!Ct.elevationFeatures&&Q.layers.hasOwnProperty(r.fh)&&(Ct.elevationFeatures=r.fi.parseFrom(Q.layers[r.fh],this.canonical));for(const rr of qi[pn]){const Zn=rr[0];if(this.extraShadowCaster&&(!Zn.is3D()||Zn.type==="model")||this.isSymbolTile!==void 0&&Zn.type==="symbol"!==this.isSymbolTile||Zn.minzoom&&this.zoom<Math.floor(Zn.minzoom)||Zn.maxzoom&&this.zoom>=Zn.maxzoom||Zn.visibility==="none")continue;he(rr,this.zoom,Ct.brightness,be,this.worldview);const kr=st[Zn.id]=Zn.createBucket({index:je.bucketLayerIDs.length,layers:rr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Fe,worldview:this.worldview});je.bucketLayerIDs.push(rr.map((Gn=>r.B(Gn.id,Gn.scope))));let Rr=kr.prepare?kr.prepare():null;Rr!=null?(Rr=Rr.then((()=>kr.populate(ss,Ct,this.tileID.canonical,this.tileTransform))),wi.push(Rr)):kr.populate(ss,Ct,this.tileID.canonical,this.tileTransform)}}const Ki=()=>{let pn,Ji,Mn,er,An,Mr;Nt.trim();const ss={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},zr=()=>{if(pn)return this.status="done",Le(pn);if(this.extraShadowCaster)this.status="done",Le(null,{buckets:Object.values(st).filter((Zn=>!Zn.isEmpty())),featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ct.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ji&&Mn&&er){const Zn=new pe(Ji),kr=new Map;for(const[ps,gs]of Mn.entries()){const{imagePosition:zs}=r.fl(ps,gs,r.fm);kr.set(ps,zs)}const Rr={};for(const ps in st){const gs=st[ps];gs instanceof r.b4&&(he(gs.layers,this.zoom,Ct.brightness,be,this.worldview),Rr[ps]=r.fn(gs,Ji,Zn.positions,Mn,kr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,An,this.worldview))}const Gn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,Mn,An,(()=>{Gn.iconsPending=!1,rr(Rr,Zn,Gn)})),this.rasterizeIfNeeded(ve,er,Mr,(()=>{Gn.patternsPending=!1,rr(Rr,Zn,Gn)}))}},rr=(Zn,kr,Rr,Gn)=>{if(Rr.iconsPending||Rr.patternsPending)return;const ps=new r.fo(Mn,er,this.lut);for(const gs in st){const zs=st[gs];if(gs in Zn)r.fp(zs,Zn[gs],this.showCollisionBoxes,be,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Mn,ps);else if(zs.hasPattern&&(zs instanceof r.ba||zs instanceof r.bb||zs instanceof r.e7)){he(zs.layers,this.zoom,Ct.brightness,be,this.worldview);const Hn=Object.fromEntries(ps.patternPositions);zs.addFeatures(Ct,this.tileID.canonical,Hn,be,this.tileTransform,this.brightness)}}this.status="done",Le(null,{buckets:Object.values(st).filter((gs=>!gs.isEmpty())),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kr.image,lineAtlas:Nt,imageAtlas:ps,brightness:Ct.brightness})};if(!this.extraShadowCaster){const Zn=r.fj(Ct.glyphDependencies,(Gn=>Object.keys(Gn).map(Number)));Object.keys(Zn).length?ve.send("getGlyphs",{uid:this.uid,stacks:Zn},((Gn,ps)=>{pn||(pn=Gn,Ji=ps,zr())}),void 0,!1,ss):Ji={};const kr=Array.from(Ct.iconDependencies.keys()).map((Gn=>r.I.parse(Gn)));kr.length?ve.send("getImages",{images:kr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Gn,ps)=>{pn||(pn=Gn,Mn=new Map,An=this.updateImageMapAndGetImageTaskQueue(Mn,ps,Ct.iconDependencies),zr())}),void 0,!1,ss):(Mn=new Map,An=new Map);const Rr=Array.from(Ct.patternDependencies.keys()).map((Gn=>r.I.parse(Gn)));Rr.length?ve.send("getImages",{images:Rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Gn,ps)=>{pn||(pn=Gn,er=new Map,Mr=this.updateImageMapAndGetImageTaskQueue(er,ps,Ct.patternDependencies),zr())}),void 0,!1,ss):(er=new Map,Mr=new Map)}if(Ct.elevationFeatures&&Ct.elevationFeatures.length>0){const Zn=[];for(const Rr of Object.values(st))if(Rr instanceof r.bb){const Gn=Rr.getUnevaluatedPortalGraph();Gn&&Zn.push(Gn)}const kr=r.fk.evaluate(Zn);for(const Rr of Object.values(st))if(Rr instanceof r.bb){const Gn=Q.layers[rt.decode(Rr.sourceLayerIndex)];Rr.setEvaluatedPortalGraph(kr,Gn,this.tileID.canonical,Ct.availableImages,Ct.brightness)}}zr()};wi.length>0?Promise.allSettled(wi).then(Ki).catch(Le):Ki()}rasterizeIfNeeded(Q,ne,be,Fe){Array.from(ne.values()).some((ve=>ve.usvg))?this.rasterize(Q,ne,be,Fe):Fe()}updateImageMapAndGetImageTaskQueue(Q,ne,be){const Fe=new Map;for(const ve of ne.keys()){const Le=be.get(ve)||[];for(const rt of Le){const je=rt.toString(),st=ne.get(rt.id.toString());st.usvg?Fe.has(je)||(Fe.set(je,rt),Q.set(je,Object.assign({},st))):Q.set(je,st)}}return Fe}rasterize(Q,ne,be,Fe){this.rasterizeTask=Q.send("rasterizeImages",{scope:this.scope,tasks:be},((ve,Le)=>{if(!ve)for(const[rt,je]of Le.entries()){const st=Object.assign(ne.get(rt),{data:je});ne.set(rt,st)}Fe()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function he(Xe,Q,ne,be,Fe){const ve=new r.ac(Q,{brightness:ne,worldview:Fe});for(const Le of Xe)Le.recalculate(ve,be)}class Te extends r.E{constructor(Q,ne,be,Fe,ve,Le,rt){super(),this.actor=Q,this.layerIndex=ne,this.availableImages=be,this.availableModels=Fe,this.loadVectorData=Le||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(Q.scheduler),this.isSpriteLoaded=ve,this.scheduler=Q.scheduler,this.brightness=rt}loadTile(Q,ne){const be=Q.uid,Fe=Q&&Q.request,ve=Fe&&Fe.collectResourceTiming,Le=this.loading[be]=new se(Q);Le.abort=this.loadVectorData(Q,((rt,je)=>{const st=!this.loading[be];if(delete this.loading[be],Le.cancelRasterize(),st||rt||!je)return Le.status="done",st||(this.loaded[be]=Le),ne(rt);const Nt=je.rawData,Ct={};je.expires&&(Ct.expires=je.expires),je.cacheControl&&(Ct.cacheControl=je.cacheControl),Le.vectorTile=je.vectorTile||new r.fq(new r.bt(Nt));const wi=()=>{Le.parse(Le.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((qi,Ki)=>{if(qi||!Ki)return ne(qi);const pn={};if(ve){const Ji=j(Fe);Ji.length>0&&(pn.resourceTiming=JSON.parse(JSON.stringify(Ji)))}ne(null,Object.assign({rawTileData:Nt.slice(0)},Ki,Ct,pn))}))};this.isSpriteLoaded?wi():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(wi,{type:"parseTile",isSymbolTile:Q.isSymbolTile,zoom:Q.tileZoom}):wi()})),this.loaded=this.loaded||{},this.loaded[be]=Le}))}reloadTile(Q,ne){const be=this.loaded,Fe=Q.uid;if(be&&be[Fe]){const ve=be[Fe];ve.scaleFactor=Q.scaleFactor,ve.showCollisionBoxes=Q.showCollisionBoxes,ve.projection=Q.projection,ve.brightness=Q.brightness,ve.tileTransform=r.aZ(Q.tileID.canonical,Q.projection),ve.extraShadowCaster=Q.extraShadowCaster,ve.lut=Q.lut,ve.worldview=Q.worldview;const Le=(rt,je)=>{const st=ve.reloadCallback;st&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,st)),ne(rt,je)};ve.status==="parsing"?ve.reloadCallback=Le:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Le):Le())}else ne(null,void 0)}abortTile(Q,ne){const be=Q.uid,Fe=this.loading[be];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[be]),ne()}removeTile(Q,ne){const be=this.loaded,Fe=Q.uid;be&&be[Fe]&&delete be[Fe],ne()}}class Se{loadTile(Q,ne){const{uid:be,encoding:Fe,rawImageData:ve,padding:Le}=Q,rt=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Le):ve;ne(null,new r.fr(be,rt,Fe,Le<1))}reloadTile(Q,ne){ne(null,null)}abortTile(Q,ne){ne()}removeTile(Q,ne){ne()}getImageData(Q,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);const be=this.offscreenCanvasContext.getImageData(-ne,-ne,Q.width+2*ne,Q.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),be}}r.bs.setPbf(r.bt);class fe{constructor(Q){this._mrt=new r.bs(Q.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Q.uid,this.tileID=Q.tileID,this.source=Q.source}parse(Q,ne){const be=this._mrt;this.status="parsing",this._entireBuffer=Q;try{be.parseHeader(Q),this._isHeaderLoaded=!0;const Fe=[];for(const ve in be.layers){const Le=be.getLayer(ve),rt=Le.getDataRange(Le.getBandList()),je=be.createDecodingTask(rt),st=Q.slice(rt.firstByte,rt.lastByte+1),Nt=r.bs.performDecoding(st,je).then((Ct=>je.complete(null,Ct))).catch((Ct=>je.complete(Ct,null)));Fe.push(Nt)}Promise.allSettled(Fe).then((()=>ne(null,be))).catch((ve=>ne(ve)))}catch(Fe){ne(Fe)}}}class oe{constructor(Q){this.actor=Q,this.loading={},this.loaded={}}loadTile(Q,ne){const be=Q.uid,Fe=Q.request,ve=this.loading[be]=new fe(Q),{cancel:Le}=r.bu(Fe,((rt,je,st,Nt)=>{const Ct=!this.loading[be];if(delete this.loading[be],Ct||rt||!je)return ve.status="done",Ct||(this.loaded[be]=ve),ne(rt);ve.parse(je,((wi,qi)=>{if(wi||!qi)return ne(wi);ne(null,qi,st,Nt)})),this.loaded[be]=ve}));ve.abort=Le}reloadTile(Q,ne){ne(null,void 0)}abortTile(Q,ne){const be=Q.uid,Fe=this.loading[be];Fe&&(Fe.abort&&Fe.abort(),delete this.loading[be]),ne()}removeTile(Q,ne){const be=Q.uid;this.loaded[be]&&delete this.loaded[be],ne()}decodeRasterArray(Q,ne){r.bs.performDecoding(Q.buffer,Q.task).then((be=>ne(null,be))).catch((be=>ne(be)))}}const ge=r.fs.prototype.toGeoJSON;class Ge{constructor(Q){this._feature=Q,this.extent=r.al,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))}loadGeometry(){if(this._feature.type===1){const Q=[];for(const ne of this._feature.geometry)Q.push([new r.P(ne[0],ne[1])]);return Q}{const Q=[];for(const ne of this._feature.geometry){const be=[];for(const Fe of ne)be.push(new r.P(Fe[0],Fe[1]));Q.push(be)}return Q}}toGeoJSON(Q,ne,be){return ge.call(this,Q,ne,be)}}class xt{constructor(Q,ne){this.name=Q,this.extent=r.al,this.length=ne.length,this._jsonFeatures=ne}feature(Q){return new Ge(this._jsonFeatures[Q])}}class It{constructor(Q){this.layers={},this.extent=r.al;for(const ne of Object.keys(Q))this.layers[ne]=new xt(ne,Q[ne])}}const ot=64/4096,Be=128;class De{constructor(){this.features=new Map}clear(){this.features.clear()}load(Q=[],ne){for(const be of Q){const Fe=be.id;if(Fe==null)continue;let ve=this.features.get(Fe);ve&&this.updateCache(ve,ne),be.geometry?(ve=He(be),this.updateCache(ve,ne),this.features.set(Fe,ve)):this.features.delete(Fe),this.updateCache(ve,ne)}}updateCache(Q,ne){for(const{canonical:be,uid:Fe}of Object.values(ne)){const{z:ve,x:Le,y:rt}=be;Oe(Q,Math.pow(2,ve),Le,rt)&&delete ne[Fe]}}getTile(Q,ne,be){const Fe=Math.pow(2,Q),ve=[];for(const Le of this.features.values())Oe(Le,Fe,ne,be)&&ve.push(yt(Le,Fe,ne,be));return{features:ve}}getFeatures(){return[...this.features.values()]}}function Oe({minX:Xe,minY:Q,maxX:ne,maxY:be},Fe,ve,Le){return Xe<(ve+1+ot)/Fe&&Q<(Le+1+ot)/Fe&&ne>(ve-ot)/Fe&&be>(Le-ot)/Fe}function He(Xe){const{id:Q,geometry:ne,properties:be}=Xe;if(!ne)return;if(ne.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Fe,coordinates:ve}=ne,Le={id:Q,type:1,geometry:[],tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=Le.geometry;if(Fe==="Point")ft(ve,rt,Le);else if(Fe==="MultiPoint")for(const je of ve)ft(je,rt,Le);else if(Fe==="LineString")Le.type=2,tt(ve,rt,Le);else if(Fe==="MultiLineString")Le.type=2,At(ve,rt,Le);else if(Fe==="Polygon")Le.type=3,At(ve,rt,Le,!0);else{if(Fe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Le.type=3;for(const je of ve)At(je,rt,Le,!0)}return Le}function ft([Xe,Q],ne,be){const Fe=r.aF(Xe);let ve=r.aJ(Q);ve=ve<0?0:ve>1?1:ve,ne.push(Fe,ve),be.minX=Math.min(be.minX,Fe),be.minY=Math.min(be.minY,ve),be.maxX=Math.max(be.maxX,Fe),be.maxY=Math.max(be.maxY,ve)}function tt(Xe,Q,ne,be=!1,Fe=!1){const ve=[];for(const Le of Xe)ft(Le,ve,ne);Q.push(ve),be&&(function(Le,rt){let je=0;for(let st=0,Nt=Le.length,Ct=Nt-2;st<Nt;Ct=st,st+=2)je+=(Le[st]-Le[Ct])*(Le[st+1]+Le[Ct+1]);if(je>0===rt)for(let st=0,Nt=Le.length;st<Nt/2;st+=2){const Ct=Le[st],wi=Le[st+1];Le[st]=Le[Nt-2-st],Le[st+1]=Le[Nt-1-st],Le[Nt-2-st]=Ct,Le[Nt-1-st]=wi}})(ve,Fe)}function At(Xe,Q,ne,be=!1){for(let Fe=0;Fe<Xe.length;Fe++)tt(Xe[Fe],Q,ne,be,Fe===0)}function yt(Xe,Q,ne,be){const{id:Fe,type:ve,geometry:Le,tags:rt}=Xe,je=[];if(ve===1)(function(st,Nt,Ct,wi,qi){for(let Ki=0;Ki<st.length;Ki+=2){const pn=Math.round(r.al*(st[Ki+0]*Nt-Ct)),Ji=Math.round(r.al*(st[Ki+1]*Nt-wi));qi.push([pn,Ji])}})(Le,Q,ne,be,je);else for(const st of Le)si(st,Q,ne,be,je);return{id:Fe,type:ve,geometry:je,tags:rt}}function si(Xe,Q,ne,be,Fe){const ve=-Be,Le=r.al+Be;let rt;for(let je=0;je<Xe.length-2;je+=2){let st=Math.round(r.al*(Xe[je+0]*Q-ne)),Nt=Math.round(r.al*(Xe[je+1]*Q-be)),Ct=Math.round(r.al*(Xe[je+2]*Q-ne)),wi=Math.round(r.al*(Xe[je+3]*Q-be));const qi=Ct-st,Ki=wi-Nt;st<ve&&Ct<ve||(st<ve?(Nt+=Math.round(Ki*((ve-st)/qi)),st=ve):Ct<ve&&(wi=Nt+Math.round(Ki*((ve-st)/qi)),Ct=ve),Nt<ve&&wi<ve||(Nt<ve?(st+=Math.round(qi*((ve-Nt)/Ki)),Nt=ve):wi<ve&&(Ct=st+Math.round(qi*((ve-Nt)/Ki)),wi=ve),st>=Le&&Ct>=Le||(st>=Le?(Nt+=Math.round(Ki*((Le-st)/qi)),st=Le):Ct>=Le&&(wi=Nt+Math.round(Ki*((Le-st)/qi)),Ct=Le),Nt>=Le&&wi>=Le||(Nt>=Le?(st+=Math.round(qi*((Le-Nt)/Ki)),Nt=Le):wi>=Le&&(Ct=st+Math.round(qi*((Le-Nt)/Ki)),wi=Le),rt&&st===rt[rt.length-1][0]&&Nt===rt[rt.length-1][1]||(rt=[[st,Nt]],Fe.push(rt)),rt.push([Ct,wi])))))}}function wt({name:Xe,features:Q},ne){ne.writeStringField(1,Xe),ne.writeVarintField(5,r.al);const be=new Map,Fe=new Map,ve={keys:be,values:Fe,feature:null};for(const Le of Q)ve.feature=Le,ne.writeMessage(2,Gi,ve);for(const Le of be.keys())ne.writeStringField(3,Le);for(const Le of Fe.keys())ne.writeMessage(4,an,Le)}function Gi(Xe,Q){const ne=Xe.feature;ne.id!==void 0&&Number.isSafeInteger(+ne.id)&&Q.writeVarintField(1,+ne.id),ne.tags&&Q.writeMessage(2,Ti,Xe),Q.writeVarintField(3,ne.type),Q.writeMessage(4,dn,ne)}function Ti({keys:Xe,values:Q,feature:ne},be){for(const Fe of Object.keys(ne.tags)){let ve=ne.tags[Fe];if(ve===null)continue;let Le=Xe.get(Fe);Le===void 0&&(Le=Xe.size,Xe.set(Fe,Le)),be.writeVarint(Le);const rt=typeof ve;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(ve=JSON.stringify(ve));let je=Q.get(ve);je===void 0&&(je=Q.size,Q.set(ve,je)),be.writeVarint(je)}}function di(Xe,Q){return(Q<<3)+(7&Xe)}function ki(Xe){return Xe<<1^Xe>>31}function dn(Xe,Q){const{geometry:ne,type:be}=Xe;let Fe=0,ve=0;if(be===1){Q.writeVarint(di(1,ne.length));for(const Le of ne){const rt=Le[0]-Fe,je=Le[1]-ve;Q.writeVarint(ki(rt)),Q.writeVarint(ki(je)),Fe+=rt,ve+=je}}else for(const Le of ne){Q.writeVarint(di(1,1));const rt=Le.length-(be===3?1:0);for(let je=0;je<rt;je++){je===1&&Q.writeVarint(di(2,rt-1));const st=Le[je][0]-Fe,Nt=Le[je][1]-ve;Q.writeVarint(ki(st)),Q.writeVarint(ki(Nt)),Fe+=st,ve+=Nt}be===3&&Q.writeVarint(di(7,1))}}function an(Xe,Q){const ne=typeof Xe;ne==="string"?Q.writeStringField(1,Xe):ne==="boolean"?Q.writeBooleanField(7,Xe):ne==="number"&&(Xe%1!=0?Q.writeDoubleField(3,Xe):Xe<0?Q.writeSVarintField(6,Xe):Q.writeVarintField(5,Xe))}const mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},Pt=Math.fround||(pi=new Float32Array(1),Xe=>(pi[0]=+Xe,pi[0]));var pi;const Ui=3,ei=5,_i=6;class un{constructor(Q){this.options=Object.assign(Object.create(mt),Q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Q){const{log:ne,minZoom:be,maxZoom:Fe}=this.options;ne&&console.time("total time");const ve=`prepare ${Q.length} points`;ne&&console.time(ve),this.points=Q;const Le=[];for(let je=0;je<Q.length;je++){const st=Q[je];if(!st.geometry)continue;const[Nt,Ct]=st.geometry.coordinates,wi=Pt(lt(Nt)),qi=Pt(vt(Ct));Le.push(wi,qi,1/0,je,-1,1),this.options.reduce&&Le.push(0)}let rt=this.trees[Fe+1]=this._createTree(Le);ne&&console.timeEnd(ve);for(let je=Fe;je>=be;je--){const st=+Date.now();rt=this.trees[je]=this._createTree(this._cluster(rt,je)),ne&&console.log("z%d: %d clusters in %dms",je,rt.numItems,+Date.now()-st)}return ne&&console.timeEnd("total time"),this}getClusters(Q,ne){let be=((Q[0]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,Q[1]));let ve=Q[2]===180?180:((Q[2]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)be=-180,ve=180;else if(be>ve){const Ct=this.getClusters([be,Fe,180,Le],ne),wi=this.getClusters([-180,Fe,ve,Le],ne);return Ct.concat(wi)}const rt=this.trees[this._limitZoom(ne)],je=rt.range(lt(be),vt(Le),lt(ve),vt(Fe)),st=rt.data,Nt=[];for(const Ct of je){const wi=this.stride*Ct;Nt.push(st[wi+ei]>1?Qi(st,wi,this.clusterProps):this.points[st[wi+Ui]])}return Nt}getChildren(Q){const ne=this._getOriginId(Q),be=this._getOriginZoom(Q),Fe="No cluster with the specified id.",ve=this.trees[be];if(!ve)throw new Error(Fe);const Le=ve.data;if(ne*this.stride>=Le.length)throw new Error(Fe);const rt=this.options.radius/(this.options.extent*Math.pow(2,be-1)),je=ve.within(Le[ne*this.stride],Le[ne*this.stride+1],rt),st=[];for(const Nt of je){const Ct=Nt*this.stride;Le[Ct+4]===Q&&st.push(Le[Ct+ei]>1?Qi(Le,Ct,this.clusterProps):this.points[Le[Ct+Ui]])}if(st.length===0)throw new Error(Fe);return st}getLeaves(Q,ne,be){const Fe=[];return this._appendLeaves(Fe,Q,ne=ne||10,be=be||0,0),Fe}getTile(Q,ne,be){const Fe=this.trees[this._limitZoom(Q)],ve=Math.pow(2,Q),{extent:Le,radius:rt}=this.options,je=rt/Le,st=(be-je)/ve,Nt=(be+1+je)/ve,Ct={features:[]};return this._addTileFeatures(Fe.range((ne-je)/ve,st,(ne+1+je)/ve,Nt),Fe.data,ne,be,ve,Ct),ne===0&&this._addTileFeatures(Fe.range(1-je/ve,st,1,Nt),Fe.data,ve,be,ve,Ct),ne===ve-1&&this._addTileFeatures(Fe.range(0,st,je/ve,Nt),Fe.data,-1,be,ve,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(Q){let ne=this._getOriginZoom(Q)-1;for(;ne<=this.options.maxZoom;){const be=this.getChildren(Q);if(ne++,be.length!==1)break;Q=be[0].properties.cluster_id}return ne}_appendLeaves(Q,ne,be,Fe,ve){const Le=this.getChildren(ne);for(const rt of Le){const je=rt.properties;if(je&&je.cluster?ve+je.point_count<=Fe?ve+=je.point_count:ve=this._appendLeaves(Q,je.cluster_id,be,Fe,ve):ve<Fe?ve++:Q.push(rt),Q.length===be)break}return ve}_createTree(Q){const ne=new r.c3(Q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let be=0;be<Q.length;be+=this.stride)ne.add(Q[be],Q[be+1]);return ne.finish(),ne.data=Q,ne}_addTileFeatures(Q,ne,be,Fe,ve,Le){for(const rt of Q){const je=rt*this.stride,st=ne[je+ei]>1;let Nt,Ct,wi;if(st)Nt=$e(ne,je,this.clusterProps),Ct=ne[je],wi=ne[je+1];else{const pn=this.points[ne[je+Ui]];Nt=pn.properties;const[Ji,Mn]=pn.geometry.coordinates;Ct=lt(Ji),wi=vt(Mn)}const qi={type:1,geometry:[[Math.round(this.options.extent*(Ct*ve-be)),Math.round(this.options.extent*(wi*ve-Fe))]],tags:Nt};let Ki;Ki=st||this.options.generateId?ne[je+Ui]:this.points[ne[je+Ui]].id,Ki!==void 0&&(qi.id=Ki),Le.features.push(qi)}}_limitZoom(Q){return Math.max(this.options.minZoom,Math.min(Math.floor(+Q),this.options.maxZoom+1))}_cluster(Q,ne){const{radius:be,extent:Fe,reduce:ve,minPoints:Le}=this.options,rt=be/(Fe*Math.pow(2,ne)),je=Q.data,st=[],Nt=this.stride;for(let Ct=0;Ct<je.length;Ct+=Nt){if(je[Ct+2]<=ne)continue;je[Ct+2]=ne;const wi=je[Ct],qi=je[Ct+1],Ki=Q.within(je[Ct],je[Ct+1],rt),pn=je[Ct+ei];let Ji=pn;for(const Mn of Ki){const er=Mn*Nt;je[er+2]>ne&&(Ji+=je[er+ei])}if(Ji>pn&&Ji>=Le){let Mn,er=wi*pn,An=qi*pn,Mr=-1;const ss=(Ct/Nt<<5)+(ne+1)+this.points.length;for(const zr of Ki){const rr=zr*Nt;if(je[rr+2]<=ne)continue;je[rr+2]=ne;const Zn=je[rr+ei];er+=je[rr]*Zn,An+=je[rr+1]*Zn,je[rr+4]=ss,ve&&(Mn||(Mn=this._map(je,Ct,!0),Mr=this.clusterProps.length,this.clusterProps.push(Mn)),ve(Mn,this._map(je,rr)))}je[Ct+4]=ss,st.push(er/Ji,An/Ji,1/0,ss,-1,Ji),ve&&st.push(Mr)}else{for(let Mn=0;Mn<Nt;Mn++)st.push(je[Ct+Mn]);if(Ji>1)for(const Mn of Ki){const er=Mn*Nt;if(!(je[er+2]<=ne)){je[er+2]=ne;for(let An=0;An<Nt;An++)st.push(je[er+An])}}}}return st}_getOriginId(Q){return Q-this.points.length>>5}_getOriginZoom(Q){return(Q-this.points.length)%32}_map(Q,ne,be){if(Q[ne+ei]>1){const Le=this.clusterProps[Q[ne+_i]];return be?Object.assign({},Le):Le}const Fe=this.points[Q[ne+Ui]].properties,ve=this.options.map(Fe);return be&&ve===Fe?Object.assign({},ve):ve}}function Qi(Xe,Q,ne){return{type:"Feature",id:Xe[Q+Ui],properties:$e(Xe,Q,ne),geometry:{type:"Point",coordinates:[(be=Xe[Q],360*(be-.5)),ai(Xe[Q+1])]}};var be}function $e(Xe,Q,ne){const be=Xe[Q+ei],Fe=be>=1e4?`${Math.round(be/1e3)}k`:be>=1e3?Math.round(be/100)/10+"k":be,ve=Xe[Q+_i],Le=ve===-1?{}:Object.assign({},ne[ve]);return Object.assign(Le,{cluster:!0,cluster_id:Xe[Q+Ui],point_count:be,point_count_abbreviated:Fe})}function lt(Xe){return Xe/360+.5}function vt(Xe){const Q=Math.sin(Xe*Math.PI/180),ne=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ne<0?0:ne>1?1:ne}function ai(Xe){const Q=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(Q))/Math.PI-90}function ii(Xe,Q,ne,be){let Fe=be;const ve=Q+(ne-Q>>1);let Le,rt=ne-Q;const je=Xe[Q],st=Xe[Q+1],Nt=Xe[ne],Ct=Xe[ne+1];for(let wi=Q+3;wi<ne;wi+=3){const qi=ci(Xe[wi],Xe[wi+1],je,st,Nt,Ct);if(qi>Fe)Le=wi,Fe=qi;else if(qi===Fe){const Ki=Math.abs(wi-ve);Ki<rt&&(Le=wi,rt=Ki)}}Fe>be&&(Le-Q>3&&ii(Xe,Q,Le,be),Xe[Le+2]=Fe,ne-Le>3&&ii(Xe,Le,ne,be))}function ci(Xe,Q,ne,be,Fe,ve){let Le=Fe-ne,rt=ve-be;if(Le!==0||rt!==0){const je=((Xe-ne)*Le+(Q-be)*rt)/(Le*Le+rt*rt);je>1?(ne=Fe,be=ve):je>0&&(ne+=Le*je,be+=rt*je)}return Le=Xe-ne,rt=Q-be,Le*Le+rt*rt}function Ei(Xe,Q,ne,be){const Fe={id:Xe??null,type:Q,geometry:ne,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Q==="Point"||Q==="MultiPoint"||Q==="LineString")bi(Fe,ne);else if(Q==="Polygon")bi(Fe,ne[0]);else if(Q==="MultiLineString")for(const ve of ne)bi(Fe,ve);else if(Q==="MultiPolygon")for(const ve of ne)bi(Fe,ve[0]);return Fe}function bi(Xe,Q){for(let ne=0;ne<Q.length;ne+=3)Xe.minX=Math.min(Xe.minX,Q[ne]),Xe.minY=Math.min(Xe.minY,Q[ne+1]),Xe.maxX=Math.max(Xe.maxX,Q[ne]),Xe.maxY=Math.max(Xe.maxY,Q[ne+1])}function ui(Xe,Q,ne,be){if(!Q.geometry)return;const Fe=Q.geometry.coordinates;if(Fe&&Fe.length===0)return;const ve=Q.geometry.type,Le=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2);let rt=[],je=Q.id;if(ne.promoteId?je=Q.properties[ne.promoteId]:ne.generateId&&(je=be||0),ve==="Point")vi(Fe,rt);else if(ve==="MultiPoint")for(const st of Fe)vi(st,rt);else if(ve==="LineString")sn(Fe,rt,Le,!1);else if(ve==="MultiLineString"){if(ne.lineMetrics){for(const st of Fe)rt=[],sn(st,rt,Le,!1),Xe.push(Ei(je,"LineString",rt,Q.properties));return}Hi(Fe,rt,Le,!1)}else if(ve==="Polygon")Hi(Fe,rt,Le,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const st of Q.geometry.geometries)ui(Xe,{id:je,geometry:st,properties:Q.properties},ne,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const st of Fe){const Nt=[];Hi(st,Nt,Le,!0),rt.push(Nt)}}Xe.push(Ei(je,ve,rt,Q.properties))}function vi(Xe,Q){Q.push($i(Xe[0]),fn(Xe[1]),0)}function sn(Xe,Q,ne,be){let Fe,ve,Le=0;for(let je=0;je<Xe.length;je++){const st=$i(Xe[je][0]),Nt=fn(Xe[je][1]);Q.push(st,Nt,0),je>0&&(Le+=be?(Fe*Nt-st*ve)/2:Math.sqrt(Math.pow(st-Fe,2)+Math.pow(Nt-ve,2))),Fe=st,ve=Nt}const rt=Q.length-3;Q[2]=1,ii(Q,0,rt,ne),Q[rt+2]=1,Q.size=Math.abs(Le),Q.start=0,Q.end=Q.size}function Hi(Xe,Q,ne,be){for(let Fe=0;Fe<Xe.length;Fe++){const ve=[];sn(Xe[Fe],ve,ne,be),Q.push(ve)}}function $i(Xe){return Xe/360+.5}function fn(Xe){const Q=Math.sin(Xe*Math.PI/180),ne=.5-.25*Math.log((1+Q)/(1-Q))/Math.PI;return ne<0?0:ne>1?1:ne}function Nn(Xe,Q,ne,be,Fe,ve,Le,rt){if(be/=Q,ve>=(ne/=Q)&&Le<be)return Xe;if(Le<ne||ve>=be)return null;const je=[];for(const st of Xe){const Nt=st.geometry;let Ct=st.type;const wi=Fe===0?st.minX:st.minY,qi=Fe===0?st.maxX:st.maxY;if(wi>=ne&&qi<be){je.push(st);continue}if(qi<ne||wi>=be)continue;let Ki=[];if(Ct==="Point"||Ct==="MultiPoint")br(Nt,Ki,ne,be,Fe);else if(Ct==="LineString")Xn(Nt,Ki,ne,be,Fe,!1,rt.lineMetrics);else if(Ct==="MultiLineString")Qn(Nt,Ki,ne,be,Fe,!1);else if(Ct==="Polygon")Qn(Nt,Ki,ne,be,Fe,!0);else if(Ct==="MultiPolygon")for(const pn of Nt){const Ji=[];Qn(pn,Ji,ne,be,Fe,!0),Ji.length&&Ki.push(Ji)}if(Ki.length){if(rt.lineMetrics&&Ct==="LineString"){for(const pn of Ki)je.push(Ei(st.id,Ct,pn,st.tags));continue}Ct!=="LineString"&&Ct!=="MultiLineString"||(Ki.length===1?(Ct="LineString",Ki=Ki[0]):Ct="MultiLineString"),Ct!=="Point"&&Ct!=="MultiPoint"||(Ct=Ki.length===3?"Point":"MultiPoint"),je.push(Ei(st.id,Ct,Ki,st.tags))}}return je.length?je:null}function br(Xe,Q,ne,be,Fe){for(let ve=0;ve<Xe.length;ve+=3){const Le=Xe[ve+Fe];Le>=ne&&Le<=be&&Wr(Q,Xe[ve],Xe[ve+1],Xe[ve+2])}}function Xn(Xe,Q,ne,be,Fe,ve,Le){let rt=is(Xe);const je=Fe===0?ns:Dr;let st,Nt,Ct=Xe.start;for(let Ji=0;Ji<Xe.length-3;Ji+=3){const Mn=Xe[Ji],er=Xe[Ji+1],An=Xe[Ji+2],Mr=Xe[Ji+3],ss=Xe[Ji+4],zr=Fe===0?Mn:er,rr=Fe===0?Mr:ss;let Zn=!1;Le&&(st=Math.sqrt(Math.pow(Mn-Mr,2)+Math.pow(er-ss,2))),zr<ne?rr>ne&&(Nt=je(rt,Mn,er,Mr,ss,ne),Le&&(rt.start=Ct+st*Nt)):zr>be?rr<be&&(Nt=je(rt,Mn,er,Mr,ss,be),Le&&(rt.start=Ct+st*Nt)):Wr(rt,Mn,er,An),rr<ne&&zr>=ne&&(Nt=je(rt,Mn,er,Mr,ss,ne),Zn=!0),rr>be&&zr<=be&&(Nt=je(rt,Mn,er,Mr,ss,be),Zn=!0),!ve&&Zn&&(Le&&(rt.end=Ct+st*Nt),Q.push(rt),rt=is(Xe)),Le&&(Ct+=st)}let wi=Xe.length-3;const qi=Xe[wi],Ki=Xe[wi+1],pn=Fe===0?qi:Ki;pn>=ne&&pn<=be&&Wr(rt,qi,Ki,Xe[wi+2]),wi=rt.length-3,ve&&wi>=3&&(rt[wi]!==rt[0]||rt[wi+1]!==rt[1])&&Wr(rt,rt[0],rt[1],rt[2]),rt.length&&Q.push(rt)}function is(Xe){const Q=[];return Q.size=Xe.size,Q.start=Xe.start,Q.end=Xe.end,Q}function Qn(Xe,Q,ne,be,Fe,ve){for(const Le of Xe)Xn(Le,Q,ne,be,Fe,ve,!1)}function Wr(Xe,Q,ne,be){Xe.push(Q,ne,be)}function ns(Xe,Q,ne,be,Fe,ve){const Le=(ve-Q)/(be-Q);return Wr(Xe,ve,ne+(Fe-ne)*Le,1),Le}function Dr(Xe,Q,ne,be,Fe,ve){const Le=(ve-ne)/(Fe-ne);return Wr(Xe,Q+(be-Q)*Le,ve,1),Le}function ds(Xe,Q){const ne=[];for(let be=0;be<Xe.length;be++){const Fe=Xe[be],ve=Fe.type;let Le;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Le=Rt(Fe.geometry,Q);else if(ve==="MultiLineString"||ve==="Polygon"){Le=[];for(const rt of Fe.geometry)Le.push(Rt(rt,Q))}else if(ve==="MultiPolygon"){Le=[];for(const rt of Fe.geometry){const je=[];for(const st of rt)je.push(Rt(st,Q));Le.push(je)}}ne.push(Ei(Fe.id,ve,Le,Fe.tags))}return ne}function Rt(Xe,Q){const ne=[];ne.size=Xe.size,Xe.start!==void 0&&(ne.start=Xe.start,ne.end=Xe.end);for(let be=0;be<Xe.length;be+=3)ne.push(Xe[be]+Q,Xe[be+1],Xe[be+2]);return ne}function Dt(Xe,Q){if(Xe.transformed)return Xe;const ne=1<<Xe.z,be=Xe.x,Fe=Xe.y;for(const ve of Xe.features){const Le=ve.geometry,rt=ve.type;if(ve.geometry=[],rt===1)for(let je=0;je<Le.length;je+=2)ve.geometry.push(en(Le[je],Le[je+1],Q,ne,be,Fe));else for(let je=0;je<Le.length;je++){const st=[];for(let Nt=0;Nt<Le[je].length;Nt+=2)st.push(en(Le[je][Nt],Le[je][Nt+1],Q,ne,be,Fe));ve.geometry.push(st)}}return Xe.transformed=!0,Xe}function en(Xe,Q,ne,be,Fe,ve){return[Math.round(ne*(Xe*be-Fe)),Math.round(ne*(Q*be-ve))]}function Dn(Xe,Q,ne,be,Fe){const ve=Q===Fe.maxZoom?0:Fe.tolerance/((1<<Q)*Fe.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:ne,y:be,z:Q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of Xe)ir(Le,rt,ve,Fe);return Le}function ir(Xe,Q,ne,be){const Fe=Q.geometry,ve=Q.type,Le=[];if(Xe.minX=Math.min(Xe.minX,Q.minX),Xe.minY=Math.min(Xe.minY,Q.minY),Xe.maxX=Math.max(Xe.maxX,Q.maxX),Xe.maxY=Math.max(Xe.maxY,Q.maxY),ve==="Point"||ve==="MultiPoint")for(let rt=0;rt<Fe.length;rt+=3)Le.push(Fe[rt],Fe[rt+1]),Xe.numPoints++,Xe.numSimplified++;else if(ve==="LineString")jn(Le,Fe,Xe,ne,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let rt=0;rt<Fe.length;rt++)jn(Le,Fe[rt],Xe,ne,ve==="Polygon",rt===0);else if(ve==="MultiPolygon")for(let rt=0;rt<Fe.length;rt++){const je=Fe[rt];for(let st=0;st<je.length;st++)jn(Le,je[st],Xe,ne,!0,st===0)}if(Le.length){let rt=Q.tags||null;if(ve==="LineString"&&be.lineMetrics){rt={};for(const st in Q.tags)rt[st]=Q.tags[st];rt.mapbox_clip_start=Fe.start/Fe.size,rt.mapbox_clip_end=Fe.end/Fe.size}const je={geometry:Le,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:rt};Q.id!==null&&(je.id=Q.id),Xe.features.push(je)}}function jn(Xe,Q,ne,be,Fe,ve){const Le=be*be;if(be>0&&Q.size<(Fe?Le:be))return void(ne.numPoints+=Q.length/3);const rt=[];for(let je=0;je<Q.length;je+=3)(be===0||Q[je+2]>Le)&&(ne.numSimplified++,rt.push(Q[je],Q[je+1])),ne.numPoints++;Fe&&(function(je,st){let Nt=0;for(let Ct=0,wi=je.length,qi=wi-2;Ct<wi;qi=Ct,Ct+=2)Nt+=(je[Ct]-je[qi])*(je[Ct+1]+je[qi+1]);if(Nt>0===st)for(let Ct=0,wi=je.length;Ct<wi/2;Ct+=2){const qi=je[Ct],Ki=je[Ct+1];je[Ct]=je[wi-2-Ct],je[Ct+1]=je[wi-1-Ct],je[wi-2-Ct]=qi,je[wi-1-Ct]=Ki}})(rt,ve),Xe.push(rt)}const rs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Os{constructor(Q,ne){const be=(ne=this.options=(function(ve,Le){for(const rt in Le)ve[rt]=Le[rt];return ve})(Object.create(rs),ne)).debug;if(be&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");let Fe=(function(ve,Le){const rt=[];if(ve.type==="FeatureCollection")for(let je=0;je<ve.features.length;je++)ui(rt,ve.features[je],Le,je);else ui(rt,ve.type==="Feature"?ve:{geometry:ve},Le);return rt})(Q,ne);this.tiles={},this.tileCoords=[],be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Fe=(function(ve,Le){const rt=Le.buffer/Le.extent;let je=ve;const st=Nn(ve,1,-1-rt,rt,0,-1,2,Le),Nt=Nn(ve,1,1-rt,2+rt,0,-1,2,Le);return(st||Nt)&&(je=Nn(ve,1,-rt,1+rt,0,-1,2,Le)||[],st&&(je=ds(st,1).concat(je)),Nt&&(je=je.concat(ds(Nt,-1)))),je})(Fe,ne),Fe.length&&this.splitTile(Fe,0,0,0),be&&(Fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Q,ne,be,Fe,ve,Le,rt){const je=[Q,ne,be,Fe],st=this.options,Nt=st.debug;for(;je.length;){Fe=je.pop(),be=je.pop(),ne=je.pop(),Q=je.pop();const Ct=1<<ne,wi=fs(ne,be,Fe);let qi=this.tiles[wi];if(!qi&&(Nt>1&&console.time("creation"),qi=this.tiles[wi]=Dn(Q,ne,be,Fe,st),this.tileCoords.push({z:ne,x:be,y:Fe}),Nt)){Nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,be,Fe,qi.numFeatures,qi.numPoints,qi.numSimplified),console.timeEnd("creation"));const Zn=`z${ne}`;this.stats[Zn]=(this.stats[Zn]||0)+1,this.total++}if(qi.source=Q,ve==null){if(ne===st.indexMaxZoom||qi.numPoints<=st.indexMaxPoints)continue}else{if(ne===st.maxZoom||ne===ve)continue;if(ve!=null){const Zn=ve-ne;if(be!==Le>>Zn||Fe!==rt>>Zn)continue}}if(qi.source=null,Q.length===0)continue;Nt>1&&console.time("clipping");const Ki=.5*st.buffer/st.extent,pn=.5-Ki,Ji=.5+Ki,Mn=1+Ki;let er=null,An=null,Mr=null,ss=null,zr=Nn(Q,Ct,be-Ki,be+Ji,0,qi.minX,qi.maxX,st),rr=Nn(Q,Ct,be+pn,be+Mn,0,qi.minX,qi.maxX,st);Q=null,zr&&(er=Nn(zr,Ct,Fe-Ki,Fe+Ji,1,qi.minY,qi.maxY,st),An=Nn(zr,Ct,Fe+pn,Fe+Mn,1,qi.minY,qi.maxY,st),zr=null),rr&&(Mr=Nn(rr,Ct,Fe-Ki,Fe+Ji,1,qi.minY,qi.maxY,st),ss=Nn(rr,Ct,Fe+pn,Fe+Mn,1,qi.minY,qi.maxY,st),rr=null),Nt>1&&console.timeEnd("clipping"),je.push(er||[],ne+1,2*be,2*Fe),je.push(An||[],ne+1,2*be,2*Fe+1),je.push(Mr||[],ne+1,2*be+1,2*Fe),je.push(ss||[],ne+1,2*be+1,2*Fe+1)}}getTile(Q,ne,be){Q=+Q,ne=+ne,be=+be;const Fe=this.options,{extent:ve,debug:Le}=Fe;if(Q<0||Q>24)return null;const rt=1<<Q,je=fs(Q,ne=ne+rt&rt-1,be);if(this.tiles[je])return Dt(this.tiles[je],ve);Le>1&&console.log("drilling down to z%d-%d-%d",Q,ne,be);let st,Nt=Q,Ct=ne,wi=be;for(;!st&&Nt>0;)Nt--,Ct>>=1,wi>>=1,st=this.tiles[fs(Nt,Ct,wi)];return st&&st.source?(Le>1&&(console.log("found parent tile z%d-%d-%d",Nt,Ct,wi),console.time("drilling down")),this.splitTile(st.source,Nt,Ct,wi,Q,ne,be),Le>1&&console.timeEnd("drilling down"),this.tiles[je]?Dt(this.tiles[je],ve):null):null}}function fs(Xe,Q,ne){return 32*((1<<Xe)*ne+Q)+Xe}function fo(Xe,Q){const ne=Xe.tileID.canonical;if(!this._geoJSONIndex)return void Q(null,null);const be=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!be)return void Q(null,null);const Fe=st=>st.tags&&"3d_elevation_id"in st.tags&&"source"in st.tags&&st.tags.source==="elevation",ve=be.features.filter((st=>Fe(st)));let Le={_geojsonTileLayer:be.features};ve.length>0&&(Le={_geojsonTileLayer:be.features.filter((st=>!Fe(st))),hd_road_elevation:ve});const rt=new It(Le),je=(function(st){const Nt=new r.bt;for(const Ct of Object.keys(st))Nt.writeMessage(3,wt,{name:Ct,features:st[Ct]});return Nt.finish()})(Le).buffer;Q(null,{vectorTile:rt,rawData:je})}class kt extends Te{constructor(Q,ne,be,Fe,ve,Le,rt){super(Q,ne,be,Fe,ve,fo,rt),Le&&(this.loadGeoJSON=Le),this._dynamicIndex=new De}loadData(Q,ne){const be=Q&&Q.request,Fe=be&&be.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Q,((ve,Le)=>{if(ve||!Le)return ne(ve);if(typeof Le!="object")return ne(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));{try{if(Q.filter){const je=r.U(Q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map((st=>`${st.key}: ${st.message}`)).join(", "));Le.features=Le.features.filter((st=>je.value.evaluate({zoom:0},st)))}Q.dynamic?(Le.type==="Feature"&&(Le={type:"FeatureCollection",features:[Le]}),Q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Le.features,this.loaded),Q.cluster&&(Le.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Q.cluster?new un((function({superclusterOptions:je,clusterProperties:st}){if(!st||!je)return je;const Nt={},Ct={},wi={accumulated:null,zoom:0},qi={properties:null},Ki=Object.keys(st);for(const pn of Ki){const[Ji,Mn]=st[pn],er=r.U(Mn),An=r.U(typeof Ji=="string"?[Ji,["accumulated"],["get",pn]]:Ji);Nt[pn]=er.value,Ct[pn]=An.value}return je.map=pn=>{qi.properties=pn;const Ji={};for(const Mn of Ki)Ji[Mn]=Nt[Mn].evaluate(wi,qi);return Ji},je.reduce=(pn,Ji)=>{qi.properties=Ji;for(const Mn of Ki)wi.accumulated=pn[Mn],pn[Mn]=Ct[Mn].evaluate(wi,qi)},je})(Q)).load(Le.features):Q.dynamic?this._dynamicIndex:(function(je,st){return new Os(je,st)})(Le,Q.geojsonVtOptions)}catch(je){return ne(je)}const rt={};if(Fe){const je=j(be);je&&(rt.resourceTiming={},rt.resourceTiming[Q.source]=JSON.parse(JSON.stringify(je)))}ne(null,rt)}}))}reloadTile(Q,ne){const be=this.loaded;return be&&be[Q.uid]?Q.partial?ne(null,void 0):super.reloadTile(Q,ne):this.loadTile(Q,ne)}loadGeoJSON(Q,ne){if(Q.request)r.m(Q.request,ne);else{if(typeof Q.data!="string")return ne(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return ne(null,JSON.parse(Q.data))}catch{return ne(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(Q,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(Q.clusterId))}catch(be){ne(be)}}getClusterChildren(Q,ne){try{ne(null,this._geoJSONIndex.getChildren(Q.clusterId))}catch(be){ne(be)}}getClusterLeaves(Q,ne){try{ne(null,this._geoJSONIndex.getLeaves(Q.clusterId,Q.limit,Q.offset))}catch(be){ne(be)}}}class ls{constructor(Q,ne,be){this.tileID=new r.aO(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.tileZoom=Q.tileZoom,this.uid=Q.uid,this.zoom=Q.zoom,this.canonical=Q.tileID.canonical,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Q.projection,this.brightness=ne,this.worldview=be}parse(Q,ne,be,Fe){this.status="parsing";const ve=new r.aO(be.tileID.overscaledZ,be.tileID.wrap,be.tileID.canonical.z,be.tileID.canonical.x,be.tileID.canonical.y),Le=[],rt=ne.familiesBySource[be.source],je=new r.fe(ve,be.promoteId);je.bucketLayerIDs=[],je.is3DTile=!0,r.ft(Q).then((st=>{if(!st)return Fe(new Error("Could not parse tile"));const Nt=st.json.extensionsUsed&&st.json.extensionsUsed.includes("MAPBOX_mesh_features")||st.json.asset.extras&&st.json.asset.extras.MAPBOX_mesh_features,Ct=st.json.extensionsUsed&&st.json.extensionsUsed.includes("EXT_meshopt_compression"),wi=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const qi in rt)for(const Ki of rt[qi]){const pn=Ki[0];je.bucketLayerIDs.push(Ki.map((er=>r.B(er.id,er.scope)))),pn.recalculate(wi,[]);const Ji=r.fu(st,1/r.d6(be.tileID.canonical)),Mn=new r.fv(Ki,Ji,ve,Nt,Ct,this.brightness,je,this.worldview);Nt||(Mn.needsUpload=!0),Le.push(Mn),Mn.evaluate(pn)}this.status="done",Fe(null,{buckets:Le,featureIndex:je,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((st=>Fe(new Error(st.message))))}}class Ss{constructor(Q,ne,be,Fe,ve,Le,rt,je){this.actor=Q,this.layerIndex=ne,this.availableImages=be,this.availableModels=Fe,this.brightness=rt,this.loading={},this.loaded={},this.worldview=je}loadTile(Q,ne){const be=Q.uid,Fe=this.loading[be]=new ls(Q,this.brightness,this.worldview);r.bu(Q.request,((ve,Le)=>{const rt=!this.loading[be];return delete this.loading[be],rt||ve?(Fe.status="done",rt||(this.loaded[be]=Fe),ne(ve)):Le&&Le.byteLength!==0?void Fe.parse(Le,this.layerIndex,Q,((je,st)=>{Fe.status="done",this.loaded=this.loaded||{},this.loaded[be]=Fe,je||!st?ne(je):ne(null,st)})):(Fe.status="done",this.loaded[be]=Fe,ne())}))}reloadTile(Q,ne){const be=this.loaded,Fe=Q.uid;if(be&&be[Fe]){const ve=be[Fe];ve.projection=Q.projection,ve.brightness=Q.brightness;const Le=(rt,je)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(Q,ne)),ne(rt,je)};ve.status==="parsing"?ve.reloadCallback=Le:ve.status==="done"&&this.loadTile(Q,ne)}}abortTile(Q,ne){const be=Q.uid;this.loading[be]&&delete this.loading[be],ne()}removeTile(Q,ne){const be=this.loaded,Fe=Q.uid;be&&be[Fe]&&delete be[Fe],ne()}}class wo{constructor(Q){this.self=Q,this.actor=new r.fx(Q,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cl({name:"mercator"}),this.workerSourceTypes={vector:Te,geojson:kt,"raster-dem":Se,"raster-array":oe,"batched-model":Ss},this.workerSources={},this.self.registerWorkerSource=(ne,be)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=be},this.self.registerRTLTextPlugin=ne=>{if(r.fy.isParsed())throw new Error("RTL text plugin already registered.");r.fy.setState({pluginStatus:r.fz.parsed,pluginURL:r.fy.getPluginURL()}),r.fy.applyArabicShaping=ne.applyArabicShaping,r.fy.processBidirectionalText=ne.processBidirectionalText,r.fy.processStyledBidirectionalText=ne.processStyledBidirectionalText;for(const be of this.rtlPluginParsingListeners)be(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Q,ne,be){delete this.layerIndexes[Q],delete this.availableImages[Q],delete this.availableModels[Q],delete this.workerSources[Q],be()}checkIfReady(Q,ne,be){be()}setReferrer(Q,ne){this.referrer=ne}spriteLoaded(Q,ne){this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={});const{scope:be,isLoaded:Fe}=ne;if(this.isSpriteLoaded[Q][be]=Fe,this.workerSources[Q]&&this.workerSources[Q][be])for(const ve in this.workerSources[Q][be]){const Le=this.workerSources[Q][be][ve];for(const rt in Le){const je=Le[rt];je instanceof Te&&(je.isSpriteLoaded=Fe,je.fire(new r.z("isSpriteLoaded")))}}}setImages(Q,ne,be){this.availableImages[Q]||(this.availableImages[Q]={});const{scope:Fe,images:ve}=ne;if(this.availableImages[Q][Fe]=ve,this.workerSources[Q]&&this.workerSources[Q][Fe]){for(const Le in this.workerSources[Q][Fe]){const rt=this.workerSources[Q][Fe][Le];for(const je in rt)rt[je].availableImages=ve}be()}else be()}setModels(Q,{scope:ne,models:be},Fe){if(this.availableModels[Q]||(this.availableModels[Q]={}),this.availableModels[Q][ne]=be,this.workerSources[Q]&&this.workerSources[Q][ne]){for(const ve in this.workerSources[Q][ne]){const Le=this.workerSources[Q][ne][ve];for(const rt in Le)Le[rt].availableModels=be}Fe()}else Fe()}setProjection(Q,ne){this.projections[Q]=r.cl(ne)}setBrightness(Q,ne,be){this.brightness=ne,be()}setWorldview(Q,ne,be){this.worldview=ne,be()}setLayers(Q,ne,be){this.getLayerIndex(Q,ne.scope).replace(ne.layers,ne.options),be()}updateLayers(Q,ne,be){this.getLayerIndex(Q,ne.scope).update(ne.layers,ne.removedIds,ne.options),be()}loadTile(Q,ne,be){ne.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ne.type,ne.source,ne.scope).loadTile(ne,be)}decodeRasterArray(Q,ne,be){this.getWorkerSource(Q,ne.type,ne.source,ne.scope).decodeRasterArray(ne,be)}reloadTile(Q,ne,be){ne.projection=this.projections[Q]||this.defaultProjection,this.getWorkerSource(Q,ne.type,ne.source,ne.scope).reloadTile(ne,be)}abortTile(Q,ne,be){this.getWorkerSource(Q,ne.type,ne.source,ne.scope).abortTile(ne,be)}removeTile(Q,ne,be){this.getWorkerSource(Q,ne.type,ne.source,ne.scope).removeTile(ne,be)}removeSource(Q,ne,be){if(!(this.workerSources[Q]&&this.workerSources[Q][ne.scope]&&this.workerSources[Q][ne.scope][ne.type]&&this.workerSources[Q][ne.scope][ne.type][ne.source]))return;const Fe=this.workerSources[Q][ne.scope][ne.type][ne.source];delete this.workerSources[Q][ne.scope][ne.type][ne.source],Fe.removeSource!==void 0?Fe.removeSource(ne,be):be()}loadWorkerSource(Q,ne,be){try{this.self.importScripts(ne.url),be()}catch(Fe){be(Fe.toString())}}syncRTLPluginState(Q,ne,be){if(r.fy.isParsed())be(null,!0);else if(r.fy.isParsing())this.rtlPluginParsingListeners.push(be);else try{r.fy.setState(ne);const Fe=r.fy.getPluginURL();!r.fy.isLoaded()||r.fy.isParsed()||r.fy.isParsing()||Fe==null||(r.fy.setState({pluginStatus:r.fz.parsing,pluginURL:r.fy.getPluginURL()}),this.self.importScripts(Fe),r.fy.isParsed()?be(null,!0):this.rtlPluginParsingListeners.push(be))}catch(Fe){be(Fe.toString())}}setDracoUrl(Q,ne){this.dracoUrl=ne}getAvailableImages(Q,ne){this.availableImages[Q]||(this.availableImages[Q]={});let be=this.availableImages[Q][ne];return be||(be=[]),be}getAvailableModels(Q,ne){this.availableModels[Q]||(this.availableModels[Q]={});let be=this.availableModels[Q][ne];return be||(be={}),be}getLayerIndex(Q,ne){this.layerIndexes[Q]||(this.layerIndexes[Q]={});let be=this.layerIndexes[Q][ne];return be||(be=this.layerIndexes[Q][ne]=new ee,be.scope=ne),be}getWorkerSource(Q,ne,be,Fe){const ve=this.workerSources;return ve[Q]||(ve[Q]={}),ve[Q][Fe]||(ve[Q][Fe]={}),ve[Q][Fe][ne]||(ve[Q][Fe][ne]={}),this.isSpriteLoaded[Q]||(this.isSpriteLoaded[Q]={}),ve[Q][Fe][ne][be]||(ve[Q][Fe][ne][be]=new this.workerSourceTypes[ne]({send:(Le,rt,je,st,Nt,Ct)=>this.actor.send(Le,rt,je,Q,Nt,Ct),scheduler:this.actor.scheduler},this.getLayerIndex(Q,Fe),this.getAvailableImages(Q,Fe),this.getAvailableModels(Q,Fe),this.isSpriteLoaded[Q][Fe],void 0,this.brightness,this.worldview)),ve[Q][Fe][ne][be]}rasterizeImagesWorker(Q,ne,be){const Fe=new Map;for(const[ve,{image:Le,imageVariant:rt}]of ne.tasks.entries()){const je=this.imageRasterizer.rasterize(rt,Le,ne.scope,Q);Fe.set(ve,je)}be(void 0,Fe)}removeRasterizedImages(Q,ne,be){this.imageRasterizer.removeImagesFromCacheByIds(ne.imageIds,ne.scope,Q),be()}enforceCacheSizeLimit(Q,ne){r.fA(ne)}getWorkerPerformanceMetrics(Q,ne,be){be(void 0,void 0)}}return r.fw(self)&&(self.worker=new wo(self)),wo})),M(["./shared"],(function(r){var j="3.15.0";const H={create:"create",load:"load",fullLoad:"fullLoad"},W={mark(h){performance.mark(h)},measure(h,t,s){performance.measure(h,t,s)}};function ee(h){const t=h.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var le,pe={},se=(function(){if(le)return pe;function h(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,w=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(w);try{x=new Worker(A),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(A),g})()?(function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===g.width})()?(s[m=u&&u.failIfMajorPerformanceCaveat]===void 0&&(s[m]=(function(g){var x,w=(function(A){var R=document.createElement("canvas"),D=Object.create(h.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=A,R.getContext("webgl2",D)})(g);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)})(m)),s[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}le=1,pe.supported=h,pe.notSupportedReason=t;var s={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},pe})();function he(h,t,s){const u=document.createElement(h);return t!=null&&(u.className=t),s&&s.appendChild(u),u}function Te(h,t,s){const u=document.createElementNS("http://www.w3.org/2000/svg",h);for(const m of Object.keys(t))u.setAttributeNS(null,m,String(t[m]));return s&&s.appendChild(u),u}const Se=typeof document<"u"?document.documentElement&&document.documentElement.style:null,fe=Se&&Se.userSelect!==void 0?"userSelect":"WebkitUserSelect";let oe;function ge(){Se&&fe&&(oe=Se[fe],Se[fe]="none")}function Ge(){Se&&fe&&(Se[fe]=oe)}function xt(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",xt,!0)}function It(){window.addEventListener("click",xt,!0),window.setTimeout((()=>{window.removeEventListener("click",xt,!0)}),0)}function ot(h,t){const s=h.getBoundingClientRect();return Oe(h,s,t)}function Be(h,t){const s=h.getBoundingClientRect(),u=[];for(let m=0;m<t.length;m++)u.push(Oe(h,s,t[m]));return u}function De(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function Oe(h,t,s){const u=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new r.P((s.clientX-t.left)*u,(s.clientY-t.top)*u)}const He="01",ft="NO_ACCESS_TOKEN";class tt{constructor(t,s,u){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=(function(){let s="";for(let u=0;u<10;u++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",He,s].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!r.h(t))return t;const u=yt(t);return u.params.push(`sdk=js-${j}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!r.h(t))return t;const u=yt(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||s)}normalizeModelURL(t,s){if(!r.h(t))return t;const u=yt(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||s)}normalizeSourceURL(t,s,u,m){if(!r.h(t))return t;const g=yt(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),u&&g.params.push(`language=${u}`),m&&g.params.push(`worldview=${m}`),this._makeAPIURL(g,this._customAccessToken||s)}normalizeIconsetURL(t,s){const u=yt(t);return r.h(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||s)):si(u)}normalizeSpriteURL(t,s,u,m){const g=yt(t);return r.h(t)?(g.path=`/styles/v1${g.path}/sprite${s}${u}`,this._makeAPIURL(g,this._customAccessToken||m)):(g.path+=`${s}${u}`,si(g))}normalizeTileURL(t,s,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.h(t))return t;const m=yt(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||u&&m.authority!=="raster"&&u===512?"@2x":""}${r.k.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${r.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${r.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${r.e.TILE_URL_VERSION}${m.path}`);const g=this._customAccessToken||(function(x){for(const w of x){const A=w.match(/^access_token=(.*)$/);if(A)return A[1]}return null})(m.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,g)}canonicalizeTileURL(t,s){const u=yt(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let m="mapbox://";u.path.match(/^\/raster\/v1\//)?m+=`raster/${u.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${u.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${u.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let g=u.params;return s&&(g=g.filter((x=>!x.match(/^access_token=/)))),g.length&&(m+=`?${g.join("&")}`),m}canonicalizeTileset(t,s){const u=!!s&&r.h(s),m=[];for(const g of t.tiles||[])r.j(g)?m.push(this.canonicalizeTileURL(g,u)):m.push(g);return m}_makeAPIURL(t,s){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=yt(r.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return si(t);if(s=s||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter((g=>g.indexOf("access_token")===-1)),t.params.push(`access_token=${s||""}`),si(t)}}const At=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yt(h){const t=h.match(At);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function si(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const wt="mapbox.eventData";function Gi(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.l(t[1]))}catch{return null}}class Ti{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Gi(r.e.ACCESS_TOKEN);let u="";return u=s&&s.u?r.f(s.u):r.e.ACCESS_TOKEN||"",t?`${wt}.${t}:${u}`:`${wt}:${u}`}fetchEventData(){const t=r.s("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));const g=localStorage.getItem(u);g&&(this.anonId=g)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),s=this.getStorageKey(),u=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(u,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,u,m){if(!r.e.EVENTS_URL)return;const g=yt(r.e.EVENTS_URL);g.params.push(`access_token=${m||r.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},w=s?Object.assign(x,s):x,A={url:si(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=r.p(A,(R=>{this.pendingRequest=null,u(R),this.saveEventData(),this.processRequests(m)}))}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const di=new class extends Ti{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some((s=>r.h(s)||r.j(s)))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Gi(r.e.ACCESS_TOKEN),s=t?t.u:r.e.ACCESS_TOKEN;let u=s!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),u=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(m),w=(m-this.eventData.lastSuccess)/864e5;u=u||w>=1||w<-1||g.getDate()!==x.getDate()}else u=!0;u?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:j,skuId:He,"enabled.telemetry":!1,userId:this.anonId},(g=>{g||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)}),h):this.processRequests()}},ki=di.postTurnstileEvent.bind(di),dn=new class extends Ti{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,s,u){this.skuToken=t,this.errorCb=u,r.e.EVENTS_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},s):this.errorCb(new Error(ft)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:j,skuId:He,skuToken:this.skuToken,userId:this.anonId},(u=>{u?this.errorCb(u):t&&(this.success[t]=!0)}),h))}remove(){this.errorCb=null}},an=dn.postMapLoadEvent.bind(dn),mt=new class extends Ti{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=r.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:s,style:u,importedStyles:m}=t;if(!r.e.EVENTS_URL||!h&&!r.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(s),x={mapInstanceId:g,eventId:this.getEventId(g),style:u};m.length&&(x.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:x},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,(()=>{}),h)}},Pt=mt.postStyleLoadEvent.bind(mt),pi=new class extends Ti{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){r.e.EVENTS_URL&&(h||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),u=(function(m){const g=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),w=(function(V){const G={};if(V){for(const Z in V)if(Z!=="other")for(const ie of V[Z]){const J=`${Z}ResolveRangeMin`,ae=`${Z}ResolveRangeMax`,me=`${Z}RequestCount`,ye=`${Z}RequestCachedCount`;G[J]=Math.min(G[J]||1/0,ie.startTime),G[ae]=Math.max(G[ae]||-1/0,ie.responseEnd);const Pe=Ae=>{G[Ae]===void 0&&(G[Ae]=0),++G[Ae]};ie.transferSize!==void 0&&ie.transferSize===0&&Pe(ye),Pe(me)}}return G})((function(V,G){const Z={};if(V)for(const ie of V){const J=G(ie);Z[J]===void 0&&(Z[J]=[]),Z[J].push(ie)}return Z})(g,ee)),A=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=R?R.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},F=(V,G,Z)=>{Z!=null&&V.push({name:G,value:Z.toString()})};for(const V in w)F(U.counters,V,w[V]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(F(U.counters,"interactionRangeMin",m.interactionRange[0]),F(U.counters,"interactionRangeMax",m.interactionRange[1])),x)for(const V of Object.keys(H)){const G=H[V],Z=x.find((ie=>ie.name===G));Z&&F(U.counters,G,Z.startTime)}return F(U.counters,"visibilityHidden",m.visibilityHidden),F(U.attributes,"style",(function(V){if(V)for(const G of V){const Z=G.name.split("?")[0];if(r.i(Z)){const ie=Z.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}})(g)),F(U.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),F(U.attributes,"fogEnabled",m.fogEnabled?"true":"false"),F(U.attributes,"projection",m.projection),F(U.attributes,"zoom",m.zoom),F(U.metadata,"devicePixelRatio",A),F(U.metadata,"connectionEffectiveType",D),F(U.metadata,"navigatorUserAgent",navigator.userAgent),F(U.metadata,"screenWidth",window.screen.width),F(U.metadata,"screenHeight",window.screen.height),F(U.metadata,"windowWidth",window.innerWidth),F(U.metadata,"windowHeight",window.innerHeight),F(U.metadata,"mapWidth",m.width/A),F(U.metadata,"mapHeight",m.height/A),F(U.metadata,"webglRenderer",m.renderer),F(U.metadata,"webglVendor",m.vendor),F(U.metadata,"sdkVersion",j),F(U.metadata,"sdkIdentifier","mapbox-gl-js"),U})(s);for(const m of u.metadata);for(const m of u.counters);for(const m of u.attributes);this.postEvent(t,u,(()=>{}),h)}},Ui=pi.postPerformanceEvent.bind(pi),ei=new class extends Ti{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,s,u){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const m=yt(r.e.API_URL+r.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${u||r.e.ACCESS_TOKEN||""}`);const g={url:si(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(g,(x=>{this.pendingRequest=null,s(x),this.saveEventData(),this.processRequests(u)}))}getSessionAPI(h,t,s,u){this.skuToken=t,this.errorCb=u,r.e.SESSION_PATH&&r.e.API_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},s):this.errorCb(new Error(ft)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,(u=>{u?this.errorCb(u):t&&(this.success[t]=!0)}),h)}remove(){this.errorCb=null}},_i=ei.getSessionAPI.bind(ei),un=new Set;function Qi(h,t){t?un.add(h):un.delete(h)}class $e{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function lt(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class vt extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const u of s.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,s,m);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,u){this._validate(t,u)&&this.images.get(s).set(t.toString(),u)}_validate(t,s){let u=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,s){if(!t)return!0;let u=0;for(const m of t){if(m[0]<u||m[1]<m[0]||s<m[1])return!1;u=m[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,u){const m=this.images.get(s).get(t.toString());u.version=m.version+1,this.images.get(s).set(t.toString(),u),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const u=this.images.get(s),m=u.get(t.toString());u.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((s=>r.I.from(s)))}getImages(t,s,u){const m=[],g=[],x=this.imageProviders.get(s);for(const D of t){if(!D.iconsetId){m.push(D);continue}const U=x.get(D.iconsetId);U&&(this.getImage(D,s)?g.push(D):U.addPendingRequest(D))}if(m.length===0)return void this._notify(g,s,u);let w=!0;const A=!!this.loaded.get(s),R=this.images.get(s);if(!A)for(const D of m)R.has(D.toString())||(w=!1);A||w?this._notify(m,s,u):this.requestors.push({ids:m,scope:s,callback:u})}rasterizeImages(t,s){const u=new Map,{tasks:m,scope:g}=t;for(const[x,w]of m.entries()){const A=this.getImage(w.id,g);A&&u.set(x,{image:A,imageVariant:w})}this._rasterizeImages(g,u,s)}_rasterizeImages(t,s,u){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},u);else{const m=new Map;for(const[g,{image:x,imageVariant:w}]of s.entries())m.set(g,this.imageRasterizer.rasterize(w,x,t,0));u(void 0,m)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,u){const m=this.images.get(s),g=new Map;for(const x of t){if(!m.get(x.toString())){if(x.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:x.name}))}const w=m.get(x.toString());if(!w){r.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)};w.usvg&&Object.assign(A,{width:w.icon.usvg_tree.width,height:w.icon.usvg_tree.height}),g.set(r.I.toString(x),A)}u(null,g)}getPixelSize(t){const{width:s,height:u}=this.atlasImage.get(t);return{width:s,height:u}}getPattern(t,s,u){const m=t.toString(),g=this.patterns.get(s),x=g.get(m),w=this.getImage(t,s);if(!w)return null;if(x){if(x.position.version===w.version)return x.position;x.position.version=w.version}else{if(w.usvg&&!w.data){const A=this.getPatternInFlightId(m,s);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const R=new r.A(t).scaleSelf(r.o.devicePixelRatio),D=new Map([[R.toString(),{image:w,imageVariant:R}]]);return this._rasterizeImages(s,D,((U,F)=>this.storePatternImage(R,s,w,u,F))),null}this.storePattern(t,s,w)}return this._updatePatternAtlas(s,u),g.get(m).position}getPatternInFlightId(t,s){return r.B(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,u,m,g){const x=t.toString(),w=g?g.get(x):void 0;w&&(u.data=w,this.storePattern(t.id,s,u),this._updatePatternAtlas(s,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,u){const m={w:u.data.width+2*r.C,h:u.data.height+2*r.C,x:0,y:0},g=new r.F(m,u,r.C);this.patterns.get(s).set(t.toString(),{bin:m,position:g})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,s){const u=t.gl;let m=this.atlasTexture.get(s);m?this.dirty&&(m.update(this.atlasImage.get(s)),this.dirty=!1):(m=new r.T(t,this.atlasImage.get(s),u.RGBA8),this.atlasTexture.set(s,m)),m.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const u=this.patterns.get(t),m=Array.from(u.values()).map((({bin:R})=>R)),{w:g,h:x}=r.G(m),w=this.atlasImage.get(t);w.resize({width:g||1,height:x||1});const A=this.images.get(t);for(const[R,{bin:D,position:U}]of u.entries()){let F=U.padding;const V=D.x+F,G=D.y+F,Z=A.get(R).data,ie=Z.width,J=Z.height;F=F>1?F-1:F,r.q.copy(Z,w,{x:0,y:0},{x:V,y:G},{width:ie,height:J},s),r.q.copy(Z,w,{x:0,y:J-F},{x:V,y:G-F},{width:ie,height:F},s),r.q.copy(Z,w,{x:0,y:0},{x:V,y:G+J},{width:ie,height:F},s),r.q.copy(Z,w,{x:ie-F,y:0},{x:V-F,y:G},{width:F,height:J},s),r.q.copy(Z,w,{x:0,y:0},{x:V+ie,y:G},{width:F,height:J},s),r.q.copy(Z,w,{x:ie-F,y:J-F},{x:V-F,y:G-F},{width:F,height:F},s),r.q.copy(Z,w,{x:0,y:J-F},{x:V+ie,y:G-F},{width:F,height:F},s),r.q.copy(Z,w,{x:0,y:0},{x:V+ie,y:G+J},{width:F,height:F},s),r.q.copy(Z,w,{x:ie-F,y:0},{x:V-F,y:G+J},{width:F,height:F},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const u=this.images.get(s);for(const m of t){if(this.callbackDispatchedThisFrame.get(s).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(m.toString());const g=u.get(m.toString());lt(g)&&this.updateImage(m,s,g)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function ai(h){const t=h.value,s=h.valueSpec,u=h.style,m=h.styleSpec,g=h.key,x=h.arrayElementValidator||en;if(!Array.isArray(t))return[new r.V(g,t,`array expected, ${r.K(t)} found`)];if(s.length&&t.length!==s.length)return[new r.V(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new r.V(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let w={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(w.function=s.function),r.H(s.value)&&(w=s.value);let A=[];for(let R=0;R<t.length;R++)A=A.concat(x({array:t,arrayIndex:R,value:t[R],valueSpec:w,style:u,styleSpec:m,key:`${g}[${R}]`},!0));return A}function ii(h){const t=h.key,s=h.value,u=h.valueSpec;if(!r.L(s))return[new r.V(t,s,`number expected, ${r.K(s)} found`)];if(s!=s)return[new r.V(t,s,"number expected, NaN found")];if("minimum"in u){let m=u.minimum;if(Array.isArray(u.minimum)&&(m=u.minimum[h.arrayIndex]),s<m)return[new r.V(t,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if(Array.isArray(u.maximum)&&(m=u.maximum[h.arrayIndex]),s>m)return[new r.V(t,s,`${s} is greater than the maximum value ${m}`)]}return[]}function ci(h){const t=h.key,s=h.value;if(!r.H(s))return[new r.V(t,s,`object expected, ${r.K(s)} found`)];const u=h.valueSpec,m=r.J(s.type);let g,x,w,A={};const R=m!=="categorical"&&s.property===void 0,D=!R,U=(function(Z){const ie=Z.stops;return Array.isArray(ie)&&Array.isArray(ie[0])&&r.H(ie[0][0])})(s),F=Dn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Z){if(m==="identity")return[new r.V(Z.key,Z.value,'identity function may not have a "stops" property')];let ie=[];const J=Z.value;return ie=ie.concat(ai({key:Z.key,value:J,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:V})),Array.isArray(J)&&J.length===0&&ie.push(new r.V(Z.key,J,"array must have at least one stop")),ie},default:function(Z){return en({key:Z.key,value:Z.value,valueSpec:u,style:Z.style,styleSpec:Z.styleSpec})}}});return m==="identity"&&R&&F.push(new r.V(h.key,h.value,'missing required property "property"')),m==="identity"||s.stops||F.push(new r.V(h.key,h.value,'missing required property "stops"')),m==="exponential"&&u.expression&&!r.M(u)&&F.push(new r.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(D&&!r.N(u)?F.push(new r.V(h.key,h.value,"property functions not supported")):R&&!r.O(u)&&F.push(new r.V(h.key,h.value,"zoom functions not supported"))),m!=="categorical"&&!U||s.property!==void 0||F.push(new r.V(h.key,h.value,'"property" property is required')),F;function V(Z){let ie=[];const J=Z.value,ae=Z.key;if(!Array.isArray(J))return[new r.V(ae,J,`array expected, ${r.K(J)} found`)];if(J.length!==2)return[new r.V(ae,J,`array length 2 expected, length ${J.length} found`)];if(U){if(!r.H(J[0]))return[new r.V(ae,J,`object expected, ${r.K(J[0])} found`)];const me=J[0];if(me.zoom===void 0)return[new r.V(ae,J,"object stop key must have zoom")];if(me.value===void 0)return[new r.V(ae,J,"object stop key must have value")];const ye=r.J(me.zoom);if(typeof ye!="number")return[new r.V(ae,me.zoom,"stop zoom values must be numbers")];if(w&&w>ye)return[new r.V(ae,me.zoom,"stop zoom values must appear in ascending order")];ye!==w&&(w=ye,x=void 0,A={}),ie=ie.concat(Dn({key:`${ae}[0]`,value:J[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:ii,value:G}}))}else ie=ie.concat(G({key:`${ae}[0]`,value:J[0],style:Z.style,styleSpec:Z.styleSpec},J));return r.Q(r.S(J[1]))?ie.concat([new r.V(`${ae}[1]`,J[1],"expressions are not allowed in function stops.")]):ie.concat(en({key:`${ae}[1]`,value:J[1],valueSpec:u,style:Z.style,styleSpec:Z.styleSpec}))}function G(Z,ie){const J=r.K(Z.value),ae=r.J(Z.value),me=Z.value!==null?Z.value:ie;if(g){if(J!==g)return[new r.V(Z.key,me,`${J} stop domain type must match previous stop domain type ${g}`)]}else g=J;if(J!=="number"&&J!=="string"&&J!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new r.V(Z.key,me,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&m!=="categorical"){let ye=`number expected, ${J} found`;return r.N(u)&&m===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Z.key,me,ye)]}return m!=="categorical"||J!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?m!=="categorical"&&J==="number"&&typeof ae=="number"&&typeof x=="number"&&x!==void 0&&ae<x?[new r.V(Z.key,me,"stop domain values must appear in ascending order")]:(x=ae,m==="categorical"&&ae in A?[new r.V(Z.key,me,"stop domain values must be unique")]:(A[ae]=!0,[])):[new r.V(Z.key,me,`integer expected, found ${String(ae)}`)]}}function Ei(h){const t=(h.expressionContext==="property"?r.W:r.U)(r.S(h.value),h.valueSpec);if(t.result==="error")return t.value.map((u=>new r.V(`${h.key}${u.key}`,h.value,u.message)));const s=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!s.outputDefined())return[new r.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!r.Z(s))return[new r.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return bi(s,h);if(h.expressionContext==="appearance")return ui(s,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!r.X(s,["zoom","feature-state"]))return[new r.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!r.Y(s))return[new r.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bi(h,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];const u=[];return h instanceof r._&&s.has(h.name)?[new r.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild((m=>{u.push(...bi(m,t))})),u)}function ui(h,t){const s=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.add(m);if(s.size===0)return[];const u=[];return h instanceof r._&&!s.has(h.name)?[new r.V(t.key,t.value,`["${h.name}"] is not an allowed parameter`)]:(h.eachChild((m=>{u.push(...ui(m,t))})),u)}function vi(h){const t=h.key,s=h.value,u=h.valueSpec,m=[];return Array.isArray(u.values)?u.values.indexOf(r.J(s))===-1&&m.push(new r.V(t,s,`expected one of [${u.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(u.values).indexOf(r.J(s))===-1&&m.push(new r.V(t,s,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function sn(h){return r.a2(r.S(h.value))?Ei(Object.assign({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Hi(h)}function Hi(h){const t=h.value,s=h.key;if(!Array.isArray(t))return[new r.V(s,t,`array expected, ${r.K(t)} found`)];if(t.length<1)return[new r.V(s,t,"filter array must have at least 1 element")];const u=h.styleSpec;let m=vi({key:`${s}[0]`,value:t[0],valueSpec:u.filter_operator});switch(r.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.J(t[1])==="$type"&&m.push(new r.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new r.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r.a0(t[1])||m.push(new r.V(`${s}[1]`,t[1],`string expected, ${r.K(t[1])} found`)));for(let g=2;g<t.length;g++)r.J(t[1])==="$type"?m=m.concat(vi({key:`${s}[${g}]`,value:t[g],valueSpec:u.geometry_type})):r.a0(t[g])||r.L(t[g])||r.$(t[g])||m.push(new r.V(`${s}[${g}]`,t[g],`string, number, or boolean expected, ${r.K(t[g])} found.`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(Hi({key:`${s}[${g}]`,value:t[g],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":t.length!==2?m.push(new r.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):r.a0(t[1])||m.push(new r.V(`${s}[1]`,t[1],`string expected, ${r.K(t[1])} found`))}return m}function $i(h,t){const s=h.key,u=h.style,m=h.layer,g=h.styleSpec,x=h.value,w=h.objectKey,A=g[`${t}_${h.layerType}`];if(!A)return[];const R=w.match(/^(.*)-use-theme$/);if(R&&A[R[1]])return r.Q(x)?[].concat(en({key:h.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:w})):en({key:s,value:x,valueSpec:{type:"string"},style:u,styleSpec:g});const D=w.match(/^(.*)-transition$/);if(t==="paint"&&D&&A[D[1]]&&A[D[1]].transition)return en({key:s,value:x,valueSpec:g.transition,style:u,styleSpec:g});const U=h.valueSpec||A[w];if(!U)return[new r.a3(s,x,`unknown property "${w}"`)];let F;if(r.a0(x)&&r.N(U)&&!U.tokens&&(F=/^{([^}]+)}$/.exec(x))){const G=`\`{ "type": "identity", "property": ${F?JSON.stringify(F[1]):'"_"'} }\``;return[new r.V(s,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${G}.`)]}const V=[];if(h.layerType==="symbol")w!=="text-field"||!u||u.glyphs||u.imports||V.push(new r.V(s,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&r.a4(r.S(x))&&r.J(x.type)==="identity"&&V.push(new r.V(s,x,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&r.N(U)&&(r.a5(U)||r.O(U))){const G=r.W(r.S(x),U),Z=G.value.expression||G.value._styleExpression.expression;Z&&!r.X(Z,["measure-light"])&&(w==="model-emissive-strength"&&r.Y(Z)&&r.Z(Z)||V.push(new r.V(s,x,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return V.concat(en({key:h.key,value:x,valueSpec:U,style:u,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:w}))}function fn(h){return $i(h,"paint")}function Nn(h){return $i(h,"layout")}function br(h){let t=[];const s=h.value,u=h.key,m=h.style,g=h.styleSpec;if(!r.H(s))return[new r.V(u,s,"object expected")];s.type||s.ref||t.push(new r.V(u,s,'either "type" or "ref" is required'));let x=r.J(s.type);const w=r.J(s.ref);if(s.id){const A=r.J(s.id);for(let R=0;R<h.arrayIndex;R++){const D=m.layers[R];r.J(D.id)===A&&t.push(new r.V(u,s.id,`duplicate layer id "${A}", previously used at line ${D.id.__line__}`))}}if("ref"in s){let A;["type","source","source-layer","filter","layout"].forEach((R=>{R in s&&t.push(new r.V(u,s[R],`"${R}" is prohibited for ref layers`))})),m.layers.forEach((R=>{r.J(R.id)===w&&(A=R)})),A?A.ref?t.push(new r.V(u,s.ref,"ref cannot reference another ref layer")):x=r.J(A.type):typeof w=="string"&&t.push(new r.V(u,s.ref,`ref layer "${w}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(s.source)if(r.a0(s.source)){const A=m.sources&&m.sources[s.source],R=A&&r.J(A.type);A?R==="vector"&&x==="raster"?t.push(new r.V(u,s.source,`layer "${s.id}" requires a raster source`)):R==="raster"&&x!=="raster"?t.push(new r.V(u,s.source,`layer "${s.id}" requires a vector source`)):R!=="vector"||s["source-layer"]?R==="raster-dem"&&x!=="hillshade"?t.push(new r.V(u,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&R==="geojson"&&!A.lineMetrics?t.push(new r.V(u,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&R!=="raster-array"&&t.push(new r.V(u,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new r.V(u,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(u,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new r.V(u,s.source,`source "${s.source}" not found`))}else t.push(new r.V(`${u}.source`,s.source,'"source" must be a string'));else t.push(new r.V(u,s,'missing required property "source"'));return t=t.concat(Dn({key:u,value:s,valueSpec:g.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>en({key:`${u}.type`,value:s.type,valueSpec:g.layer.type,style:h.style,styleSpec:h.styleSpec,object:s,objectKey:"type"}),filter:A=>sn(Object.assign({layerType:x},A)),layout:A=>Dn({layer:s,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>Nn(Object.assign({layerType:x},R))}}),paint:A=>Dn({layer:s,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":R=>fn(Object.assign({layerType:x,layer:s},R))}}),appearances(A){const R=ai({key:A.key,value:A.value,valueSpec:A.valueSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:F=>(function(V){const{key:G,layer:Z,layerType:ie}=V,J=r.J(V.value),ae=r.J(J.name),me=r.J(J.condition),ye=Dn({key:G,value:J,valueSpec:V.styleSpec.appearance,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{condition:Pe=>(function(Ae){const Me=[];return Me.push(...Ei({key:Ae.key,value:Ae.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),Me})(Object.assign({layer:Z,layerType:ie},Pe)),properties:Pe=>(function(Ae){const Me=[],{styleSpec:Ie,layer:Ee,layerType:Re}=Ae,nt=Ie[`paint_${Re}`],We=Ie[`layout_${Re}`],gt=Ae.object[Ae.objectKey];for(const et in gt){const pt=et in nt?"paint":et in We?"layout":void 0;if(!pt){Me.push(new r.V(Ae.key,et,`unknown property "${et}" for layer type "${Re}"`));continue}const Kt=Object.assign({},Ae,{key:`${Ae.key}.${et}`,object:gt,objectKey:et,layer:Ee,layerType:Re,value:gt[et],valueSpec:pt==="paint"?nt[et]:We[et]});Me.push(...$i(Kt,pt))}return Me})(Object.assign({layer:Z,layerType:ie},Pe))}});return ae==="hidden"||me||ye.push(new r.V(V.key,"name",'Appearance with name different than "hidden" must have a condition')),ye})(Object.assign({layerType:x,layer:s},F))}),D=Array.isArray(A.value)?A.value:[],U=new Set;return D.forEach(((F,V)=>{const G=r.J(F.name);if(G)if(U.has(G)){const Z=r.J(s.id);R.push(new r.V(A.key,G,`Duplicated appearance name "${G}" for layer "${Z}"`))}else U.add(G)})),R}}})),t}function Xn({key:h,value:t}){return r.a0(t)?[]:[new r.V(h,t,`string expected, ${r.K(t)} found`)]}const is={promoteId:function h({key:t,value:s}){if(r.a0(s))return Xn({key:t,value:s});if(Array.isArray(s)){const m=[],g=r.S(s),x=r.U(g);return x.result==="error"&&x.value.forEach((w=>{m.push(new r.V(`${t}${w.key}`,null,`${w.message}`))})),r.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),m}if(!r.H(s))return[new r.V(t,s,`string, expression or object expected, "${r.K(s)}" found`)];const u=[];for(const m in s)u.push(...h({key:`${t}.${m}`,value:s[m]}));return u}};function Qn(h){const t=h.value,s=h.key,u=h.styleSpec,m=h.style;if(!r.H(t))return[new r.V(s,t,`object expected, ${r.K(t)} found`)];if(!("type"in t))return[new r.V(s,t,'"type" is required')];const g=r.J(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&("url"in t||"tiles"in t||x.push(new r.a3(s,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Dn({key:s,value:t,valueSpec:u[`source_${g.replace("-","_")}`],style:h.style,styleSpec:u,objectElementValidators:is})),x;case"geojson":if(x=Dn({key:s,value:t,valueSpec:u.source_geojson,style:m,styleSpec:u,objectElementValidators:is}),"cluster"in t&&"clusterProperties"in t){if(!r.H(t.clusterProperties))return[new r.V(`${s}.clusterProperties`,t,`object expected, ${r.K(t)} found`)];for(const w in t.clusterProperties){const A=t.clusterProperties[w];if(!Array.isArray(A))return[new r.V(`${s}.clusterProperties.${w}`,A,"array expected")];const[R,D]=A,U=typeof R=="string"?[R,["accumulated"],["get",w]]:R;x.push(...Ei({key:`${s}.${w}.map`,value:D,expressionContext:"cluster-map"})),x.push(...Ei({key:`${s}.${w}.reduce`,value:U,expressionContext:"cluster-reduce"}))}}return x;case"video":return Dn({key:s,value:t,valueSpec:u.source_video,style:m,styleSpec:u});case"image":return Dn({key:s,value:t,valueSpec:u.source_image,style:m,styleSpec:u});case"canvas":return[new r.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vi({key:`${s}.type`,value:t.type,valueSpec:{values:Wr(u)}})}}function Wr(h){return h.source.reduce(((t,s)=>{const u=h[s];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t}),[])}function ns(h){const t=h.value,s=h.styleSpec,u=s.light,m=h.style;if(t===void 0)return[];if(!r.H(t))return[new r.V("light",t,`object expected, ${r.K(t)} found`)];let g=[];for(const x in t){const w=x.match(/^(.*)-transition$/),A=x.match(/^(.*)-use-theme$/);g=g.concat(A&&u[A[1]]?en({key:x,value:t[x],valueSpec:{type:"string"},style:m,styleSpec:s}):w&&u[w[1]]&&u[w[1]].transition?en({key:x,value:t[x],valueSpec:s.transition,style:m,styleSpec:s}):u[x]?en({key:x,value:t[x],valueSpec:u[x],style:m,styleSpec:s}):[new r.V(x,t[x],`unknown property "${x}"`)])}return g}function Dr(h){const t=h.value;if(!t)return[];const s=h.key;if(!r.H(t))return[new r.V(s,t,`object expected, ${r.K(t)} found`)];let u=[];const m=h.styleSpec,g=m["light-3d"],x=h.style,w=h.style.lights;for(const D of["type","id"])if(!(D in t))return u=u.concat([new r.V(s,t,`missing property "${D}"`)]),u;if(!r.a0(t.type))return u=u.concat([new r.V(`${s}.type`,t.type,"string expected")]),u;if(w)for(let D=0;D<h.arrayIndex;D++){const U=r.J(t.type),F=w[D];r.J(F.type)===U&&u.push(new r.V(s,t.id,`duplicate light type "${t.type}", previously defined at line ${F.id.__line__}`))}const A=`properties_light_${t.type}`;if(!(A in m))return u=u.concat([new r.V(`${s}.type`,t,`Invalid light type ${t.type}`)]),u;const R=m[A];for(const D in t)if(D==="properties"){const U=t[D];if(!r.H(U))return u=u.concat([new r.V("properties",U,`object expected, ${r.K(U)} found`)]),u;for(const F in U){const V=F.match(/^(.*)-transition$/),G=F.match(/^(.*)-use-theme$/);u=u.concat(G&&R[G[1]]?en({key:D,value:U[F],valueSpec:{type:"string"},style:x,styleSpec:m}):V&&R[V[1]]&&R[V[1]].transition?en({key:D,value:t[D],valueSpec:m.transition,style:x,styleSpec:m}):R[F]?en({key:F,value:U[F],valueSpec:R[F],style:x,styleSpec:m}):[new r.a3(h.key,U[F],`unknown property "${F}"`)])}}else u=u.concat(g[D]?en({key:D,value:t[D],valueSpec:g[D],style:x,styleSpec:m}):[new r.a3(D,t[D],`unknown property "${D}"`)]);return u}function ds(h){const t=h.value,s=h.key,u=h.style,m=h.styleSpec,g=m.terrain;if(t==null)return[];if(!r.H(t))return[new r.V("terrain",t,`object expected, ${r.K(t)} found`)];let x=[];for(const w in t){const A=w.match(/^(.*)-transition$/),R=w.match(/^(.*)-use-theme$/);x=x.concat(R&&g[R[1]]?en({key:w,value:t[w],valueSpec:{type:"string"},style:u,styleSpec:m}):A&&g[A[1]]&&g[A[1]].transition?en({key:w,value:t[w],valueSpec:m.transition,style:u,styleSpec:m}):g[w]?en({key:w,value:t[w],valueSpec:g[w],style:u,styleSpec:m}):[new r.a3(w,t[w],`unknown property "${w}"`)])}if(t.source)if(r.a0(t.source)){const w=u.sources&&u.sources[t.source],A=w&&r.J(w.type);w?A!=="raster-dem"&&x.push(new r.V(`${s}.source`,t.source,`terrain cannot be used with a source of type ${A}, it only be used with a "raster-dem" source type`)):x.push(new r.V(`${s}.source`,t.source,`source "${t.source}" not found`))}else x.push(new r.V(`${s}.source`,t.source,"source must be a string"));else x.push(new r.V(s,t,'terrain is missing required property "source"'));return x}function Rt(h){const t=h.value,s=h.style,u=h.styleSpec,m=u.fog;if(t===void 0)return[];if(!r.H(t))return[new r.V("fog",t,`object expected, ${r.K(t)} found`)];let g=[];for(const x in t){const w=x.match(/^(.*)-transition$/),A=x.match(/^(.*)-use-theme$/);g=g.concat(A&&m[A[1]]?en({key:x,value:t[x],valueSpec:{type:"string"},style:s,styleSpec:u}):w&&m[w[1]]&&m[w[1]].transition?en({key:x,value:t[x],valueSpec:u.transition,style:s,styleSpec:u}):m[x]?en({key:x,value:t[x],valueSpec:m[x],style:s,styleSpec:u}):[new r.a3(x,t[x],`unknown property "${x}"`)])}return g}const Dt={"*":()=>[],array:ai,boolean:function(h){const t=h.value,s=h.key;return r.$(t)?[]:[new r.V(s,t,`boolean expected, ${r.K(t)} found`)]},number:ii,color:function({key:h,value:t}){return r.a0(t)?r.a1.parseCSSColor(t)===null?[new r.V(h,t,`color expected, "${t}" found`)]:[]:[new r.V(h,t,`color expected, ${r.K(t)} found`)]},enum:vi,filter:sn,function:ci,layer:br,object:Dn,source:Qn,model:r.a7,light:ns,"light-3d":Dr,terrain:ds,fog:Rt,string:Xn,formatted:function(h){return Xn(h).length===0?[]:Ei(h)},resolvedImage:function(h){return Xn(h).length===0?[]:Ei(h)},projection:function(h){const t=h.value,s=h.styleSpec,u=s.projection,m=h.style;if(r.H(t)){let g=[];for(const x in t)g=g.concat(en({key:x,value:t[x],valueSpec:u[x],style:m,styleSpec:s}));return g}return r.a0(t)?[]:[new r.V("projection",t,`object or string expected, ${r.K(t)} found`)]},import:function(h){const t=h.key,{value:s,styleSpec:u}=h;if(!r.H(s))return[new r.V(t,s,"import must be an object")];const{data:m,...g}=s;Object.defineProperty(g,"__line__",{value:s.__line__,enumerable:!1});let x=Dn(Object.assign({},h,{value:g,valueSpec:u.import}));return r.J(g.id)===""&&x.push(new r.V(`${h.key}.id`,g,"import id can't be an empty string")),m&&(x=x.concat(jn(m,u,{key:`${h.key}.data`}))),x},iconset:function(h){const t=h.value,s=h.key,u=h.styleSpec,m=h.style;if(!r.H(t))return[new r.V(s,t,"object expected")];if(!t.type)return[new r.V(s,t,'"type" is required')];const g=r.J(t.type);let x=[];if(x=x.concat(Dn({key:s,value:t,valueSpec:u[`iconset_${g}`],style:m,styleSpec:u})),(function(w,A){return!(w!=="source"||!A.source)})(g,t)){const w=m.sources&&m.sources[t.source],A=w&&r.J(w.type);w?A!=="raster-array"&&x.push(new r.V(s,t.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):x.push(new r.V(s,t.source,`source "${t.source}" not found`))}return x}};function en(h,t=!1){const s=h.value,u=h.valueSpec,m=h.styleSpec;if(u.expression){if(r.a4(r.J(s)))return ci(h);if(r.Q(r.S(s)))return Ei(h)}if(u.type&&Dt[u.type]){const g=Dt[u.type](h);return t===!0&&g.length>0&&Array.isArray(h.value)?Ei(h):g}return Dn(Object.assign({},h,{valueSpec:u.type?m[u.type]:u}))}function Dn(h){const t=h.key,s=h.value,u=h.valueSpec||{},m=h.objectElementValidators||{},g=h.style,x=h.styleSpec;if(!r.H(s))return[new r.V(t,s,`object expected, ${r.K(s)} found`)];let w=[];for(const A in s){const R=A.split(".")[0];let D;m[R]?D=m[R]:u[R]?D=en:m["*"]?D=m["*"]:u["*"]&&(D=en),D?w=w.concat(D({key:(t&&`${t}.`)+A,value:s[A],valueSpec:u[R]||u["*"],style:g,styleSpec:x,object:s,objectKey:A},s)):w.push(new r.a3(t,s[A],`unknown property "${A}"`))}for(const A in u)m[A]||u[A].required&&u[A].default===void 0&&s[A]===void 0&&w.push(new r.V(t,s,`missing required property "${A}"`));return w}function ir({key:h,value:t}){const s=Xn({key:h,value:t});if(s.length)return s;const u=t;return u.indexOf("{fontstack}")===-1&&s.push(new r.V(h,t,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&s.push(new r.V(h,t,'"glyphs" url must include a "{range}" token')),s}function jn(h,t=r.a6,s={}){return Dn({key:s.key||"",value:h,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:h,objectElementValidators:{glyphs:ir}})}function rs(h,t=r.a6){return ve(jn(h,t))}const Os=h=>ve(Qn(h)),fs=h=>ve(ns(h)),fo=h=>ve(Dr(h)),kt=h=>ve(ds(h)),ls=h=>ve(Rt(h)),Ss=h=>ve((function(t){const s=t.value,u=t.style,m=t.styleSpec,g=m.snow;if(s===void 0)return[];if(!r.H(s))return[new r.V("snow",s,`object expected, ${r.K(s)} found`)];let x=[];for(const w in s){const A=w.match(/^(.*)-transition$/);x=x.concat(A&&g[A[1]]&&g[A[1]].transition?en({key:w,value:s[w],valueSpec:m.transition,style:u,styleSpec:m}):g[w]?en({key:w,value:s[w],valueSpec:g[w],style:u,styleSpec:m}):[new r.a3(w,s[w],`unknown property "${w}"`)])}return x})(h)),wo=h=>ve((function(t){const s=t.value,u=t.style,m=t.styleSpec,g=m.rain;if(s===void 0)return[];if(!r.H(s))return[new r.V("rain",s,`object expected, ${r.K(s)} found`)];let x=[];for(const w in s){const A=w.match(/^(.*)-transition$/);x=x.concat(A&&g[A[1]]&&g[A[1]].transition?en({key:w,value:s[w],valueSpec:m.transition,style:u,styleSpec:m}):g[w]?en({key:w,value:s[w],valueSpec:g[w],style:u,styleSpec:m}):[new r.a3(w,s[w],`unknown property "${w}"`)])}return x})(h)),Xe=h=>ve(br(h)),Q=h=>ve(sn(h)),ne=h=>ve(fn(h)),be=h=>ve(Nn(h)),Fe=h=>ve(r.a7(h));function ve(h){return h.slice().sort(((t,s)=>t.line&&s.line?t.line-s.line:0))}function Le(h,t){let s=!1;if(t&&t.length)for(const u of t)u instanceof r.a3?r.w(u.message):(h.fire(new r.y(new Error(u.message))),s=!0);return s}let rt;class je extends r.E{constructor(t,s="flat"){super(),this._transitionable=new r.a8(rt||(rt=new r.a9({anchor:new r.aa(r.a6.light.anchor),position:new r.ab(r.a6.light.position),color:new r.aa(r.a6.light.color),intensity:new r.aa(r.a6.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,u={}){this._validate(fs,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u){return(!u||u.validate!==!1)&&Le(this,t.call(rs,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let st=class extends r.E{constructor(h,t,s,u,m){super(),this.scope=s,this._transitionable=new r.a8(new r.a9({source:new r.aa(r.a6.terrain.source),exaggeration:new r.aa(r.a6.terrain.exaggeration)}),s,u),this._transitionable.setTransitionOrValue(h,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=m}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new r.ac(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let s=-1,u=-1,m=1;for(const g of t.zoomStops)m=t.evaluate(new r.ac(g,{worldview:this.worldview})),m>.01?(s=g,u=-1):u=g;return m<.01&&s>0&&u>s?[s,u]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof r.ad}};const Nt=45,Ct=65,wi=.05;function qi(h,t,s,u){const m=r.ah(Nt,Ct,s),[g,x]=Ki(h,u);let w=1-Math.min(1,Math.exp((t-g)/(x-g)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*m*h.alpha}function Ki(h,t){const s=.5/Math.tan(.5*t);return[h.range[0]+s,h.range[1]+s]}function pn(h,t,s,u,m){const g=r.af([],[t,s,u],m.mercatorFogMatrix);return qi(h,r.ag(g),m.pitch,m._fov)}function Ji(h,t,s,u,m,g,x){const w=[[s,u,0],[m,u,0],[m,g,0],[s,g,0]];let A=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const D of w){const U=r.af([],D,t),F=r.ag(U);A=Math.min(A,F),R=Math.max(R,F)}return[qi(h,A,x.pitch,x._fov),qi(h,R,x.pitch,x._fov)]}class Mn extends r.E{constructor(t,s,u,m){super();const g=new r.a9({range:new r.aa(r.a6.fog.range),color:new r.aa(r.a6.fog.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(r.a6.fog["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(r.a6.fog["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(r.a6.fog["horizon-blend"]),"star-intensity":new r.aa(r.a6.fog["star-intensity"]),"vertical-range":new r.aa(r.a6.fog["vertical-range"])});this._transitionable=new r.a8(g,u,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new r.ai(g),this.scope=u}get state(){const t=this._transform,s=t.projection.name==="globe",u=r.aj(t.zoom),m=this.properties.get("range"),g=[.5,3];return{range:s?[r.ak(g[0],m[0],u),r.ak(g[1],m[1],u)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,u={}){if(this._validate(ls,t,u))return;const m=Object.assign({},t);for(const g of Object.keys(r.a6.fog))m[g]===void 0&&(m[g]=r.a6.fog[g].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(Nt,Ct,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?(function(u,m,g){const x=r.ae.fromLngLat(m),w=g.elevation?g.elevation.getAtPointOrZero(x):0;return pn(u,x.x,x.y,w,g)})(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ji(this.state,s,0,0,r.al,r.al,this._transform)}getOpacityForBounds(t,s,u,m,g){return this._transform.projection.supportsFog?Ji(this.state,t,s,u,m,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ki(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const u of s){const m=t.points[u];let g;if(m[2]>=0)g=m;else{const x=t.points[u-4];g=r.am(x,m,x[2]/(x[2]-m[2]))}if(pn(this.state,g[0],g[1],0,this._transform)>=wi)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,u){return(!u||u.validate!==!1)&&Le(this,t.call(rs,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let er,An,Mr,ss,zr=class extends r.E{constructor(h,t,s,u){super();const m=er||(er=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(m,s,new Map(u)),this.set(h,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(m),this.scope=s}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),u=r.an(s[0]),m=-Math.max(r.an(s[1]),.01),g=[Math.cos(u)*Math.cos(m),Math.sin(u)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette"),w=this.properties.get("vignette-color");return w.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*h),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(h,t,s={}){if(this._validate(Ss,h,s))return;const u=Object.assign({},h);for(const m of Object.keys(r.a6.snow))u[m]===void 0&&(u[m]=r.a6.snow[m].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,s){return(!s||s.validate!==!1)&&Le(this,h.call(rs,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},rr=class extends r.E{constructor(h,t,s,u){super();const m=An||(An=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(m,s,new Map(u)),this.set(h,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(m),this.scope=s}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),u=r.an(s[0]),m=-Math.max(r.an(s[1]),.01),g=[Math.cos(u)*Math.cos(m),Math.sin(u)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*h),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(h,t,s={}){if(this._validate(wo,h,s))return;const u=Object.assign({},h);for(const m of Object.keys(r.a6.rain))u[m]===void 0&&(u[m]=r.a6.rain[m].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,s){return(!s||s.validate!==!1)&&Le(this,h.call(rs,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Zn extends r.E{constructor(t,s,u,m){super(),this.scope=u,this._options=t,this.properties=new r.ai(s),this._transitionable=new r.a8(s,u,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class kr{constructor(t,s,u){this.screenBounds=t,this.cameraPoint=u.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=s,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,u)}static createFromScreenPoints(t,s){let u,m;if(t instanceof r.P||typeof t[0]=="number"){const g=r.P.convert(t);u=[g],m=s.isPointAboveHorizon(g)}else{const g=r.P.convert(t[0]),x=r.P.convert(t[1]),w=g.add(x)._div(2);u=[g,x],m=r.aq(g,x).every((A=>s.isPointAboveHorizon(A)))&&s.isPointAboveHorizon(w)}return new kr(u,m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.aq(s,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<u.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),r.ar(m,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.aq(s,u,t),g=this.cameraPoint.clone();switch(3*((g.y>s.y)+(g.y>u.y))+((g.x>s.x)+(g.x>u.x))){case 0:m[0]=g,m[4]=g.clone();break;case 1:m.splice(1,0,g);break;case 2:m[1]=g;break;case 3:m.splice(4,0,g);break;case 5:m.splice(2,0,g);break;case 6:m[3]=g;break;case 7:m.splice(3,0,g);break;case 8:m[2]=g}return m}containsTile(t,s,u,m=0){const g=t.queryPadding/s._pixelsPerMercatorPixel+1,x=u?this._bufferedCameraMercator(g,s):this._bufferedScreenMercator(g,s);let w=t.tileID.wrap+(x.unwrapped?m:0);const A=x.polygon.map((ie=>r.as(t.tileTransform,ie,w)));if(!r.at(A,0,0,r.al,r.al))return;w=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const R=this.screenGeometryMercator.polygon.map((ie=>r.au(t.tileTransform,ie,w))),D=R.map((ie=>new r.P(ie[0],ie[1]))),U=s.getFreeCameraOptions().position||new r.ae(0,0,0),F=r.au(t.tileTransform,U,w),V=R.map((ie=>{const J=r.av(ie,ie,F);return r.aw(J,J),new r.ax(F,J)})),G=r.ay(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:V,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(Z=r.az(A),Z.min.x=r.aA(Z.min.x,0,r.al),Z.min.y=r.aA(Z.min.y,0,r.al),Z.max.x=r.aA(Z.max.x,0,r.al),Z.max.y=r.aA(Z.max.y,0,r.al),Z),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:G};var Z}_bufferedScreenMercator(t,s){const u=ps(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map((g=>s.pointCoordinate3D(g))),unwrapped:!0},this._screenRaycastCache[u]=m,m}}_bufferedCameraMercator(t,s){const u=ps(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map((g=>s.pointCoordinate3D(g))),unwrapped:!0},this._cameraRaycastCache[u]=m,m}}_projectAndResample(t,s){const u=(function(g,x){const w=r.aB([],x.pixelMatrix,x.globeMatrix),A=[0,-r.aD,0,1],R=[0,r.aD,0,1],D=[0,0,0,1];r.aC(A,A,w),r.aC(R,R,w),r.aC(D,D,w);const U=new r.P(A[0]/A[3],A[1]/A[3]),F=new r.P(R[0]/R[3],R[1]/R[3]),V=r.aE(g,U)&&A[3]<D[3],G=r.aE(g,F)&&R[3]<D[3];if(!V&&!G)return null;const Z=(function(Me,Ie,Ee){for(let Re=1;Re<Me.length;Re++){const nt=Gn(Ie.pointCoordinate3D(Me[Re-1]).x),We=Gn(Ie.pointCoordinate3D(Me[Re]).x);if(Ee<0){if(nt<We)return{idx:Re,t:-nt/(We-1-nt)}}else if(We<nt)return{idx:Re,t:(1-nt)/(We+1-nt)}}return null})(g,x,V?-1:1);if(!Z)return null;const{idx:ie,t:J}=Z;let ae=ie>1?Rr(g.slice(0,ie),x):[],me=ie<g.length?Rr(g.slice(ie),x):[];ae=ae.map((Me=>new r.P(Gn(Me.x),Me.y))),me=me.map((Me=>new r.P(Gn(Me.x),Me.y)));const ye=[...ae];ye.length===0&&ye.push(me[me.length-1]);const Pe=r.ak(ye[ye.length-1].y,(me.length===0?ae[0]:me[0]).y,J);let Ae;return Ae=V?[new r.P(0,Pe),new r.P(0,0),new r.P(1,0),new r.P(1,Pe)]:[new r.P(1,Pe),new r.P(1,1),new r.P(0,1),new r.P(0,Pe)],ye.push(...Ae),me.length===0?ye.push(ae[0]):ye.push(...me),{polygon:ye.map((Me=>new r.ae(Me.x,Me.y))),unwrapped:!1}})(t,s);if(u)return u;const m=(function(g,x){let w=!1,A=-1/0,R=0;for(let U=0;U<g.length-1;U++)g[U].x>A&&(A=g[U].x,R=U);for(let U=0;U<g.length-1;U++){const F=(R+U)%(g.length-1),V=g[F],G=g[F+1];Math.abs(V.x-G.x)>.5&&(V.x<G.x?(V.x+=1,F===0&&(g[g.length-1].x+=1)):(G.x+=1,F+1===g.length-1&&(g[0].x+=1)),w=!0)}const D=r.aF(x.center.lng);return w&&D<Math.abs(D-1)&&g.forEach((U=>{U.x-=1})),{polygon:g,unwrapped:w}})(Rr(t,s).map((g=>new r.P(Gn(g.x),g.y))),s);return{polygon:m.polygon.map((g=>new r.ae(g.x,g.y))),unwrapped:m.unwrapped}}}function Rr(h,t){return r.aG(h,(s=>{const u=t.pointCoordinate3D(s);s.x=u.x,s.y=u.y}),1/256)}function Gn(h){return h<0?1+h%1:h%1}function ps(h){return 100*h|0}function gs(h,t,s,u,m){const g=function(w,A){if(w)return m(w);if(A){if(h.url&&A.tiles&&h.tiles&&delete h.tiles,A.variants){if(!Array.isArray(A.variants))return m(new Error("variants must be an array"));for(const D of A.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return m(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){A=Object.assign(A,D);break}}}const R=r.aH(Object.assign({},A,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=t.canonicalizeTileset(R,h.url),m(null,R)}},x=(function(w,A,R){if(!w)return null;if(!A&&!R)return w;R=R||w.worldview_default;const D=Object.values(w.language||{});if(D.length===0)return null;const U=Object.values(w.worldview||{});if(U.length===0)return null;const F=D.every((G=>G===A)),V=U.every((G=>G===R));return F&&V?w:A in(w.language_options||{})||R in(w.worldview_options||{})?null:w.language_options&&w.worldview_options?w:null})(h.data,s,u);return x?r.o.frame((()=>g(null,x))):h.url?r.m(t.transformRequest(t.normalizeSourceURL(h.url,null,s,u),r.R.Source),g):r.o.frame((()=>{const{data:w,...A}=h;g(null,A)}))}function zs(h,t){const s=Math.pow(2,t.z),u=Math.floor(r.aF(h.getWest())*s),m=Math.floor(r.aJ(h.getNorth())*s),g=Math.ceil(r.aF(h.getEast())*s),x=Math.ceil(r.aJ(h.getSouth())*s);return t.x>=u&&t.x<g&&t.y>=m&&t.y<x}class Hn{constructor(t,s,u){this.bounds=t?r.aI.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(r.aI.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!zs(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(zs(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new Hn(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class sr extends r.E{constructor(t,s,u,m){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(s,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new r.aK}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,s,u,((m,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new r.y(m));else if(g){if(Object.assign(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of g.vector_layers)this.vectorLayerIds.push(x.id),g.worldview&&g.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=Hn.fromTileJSON(g),ki(g.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,s){const u=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(u),g=this.map._requestManager.transformRequest(m,r.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,w=x?{image:x.image.clone()}:null,A={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:w,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&r.h(u)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",A,R.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,R.bind(this),void 0,!0);else{const D=r.aL.call({deduped:this._deduped},A,((U,F)=>{U||!F?R.call(this,U):(A.data={cacheControl:F.cacheControl,expires:F.expires,rawData:F.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,R.bind(this),void 0,!0))}),!0);t.request={cancel:D}}function R(D,U){return delete t.request,t.aborted?s(null):D&&D.status!==404?s(D):(U&&U.resourceTiming&&(t.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&t.setExpiryData(U),t.loadVectorData(U,this.map.painter),r.aM(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Wo extends r.E{constructor(t,s,u,m){super(),this.id=t,this.dispatcher=u,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},s),Object.assign(this,r.aH(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const s=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,null,s,((u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new r.y(u)):m&&(Object.assign(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map((g=>g.id))),this.tileBounds=Hn.fromTileJSON(m),ki(m.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(u)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const u=r.o.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=r.n(this.map._requestManager.transformRequest(m,r.R.Tile),((g,x,w,A)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):g?(t.state="errored",s(g)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:w,expires:A}),t.setTexture(x,this.map.painter),t.state="loaded",r.aM(this.dispatcher),void s(null)):s(null))))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function oa([h,t],s,u,{scaled:m=!0}={}){const{tileSize:g,buffer:x}=u,{x:w,y:A,z:R}=s;if(!isFinite(w)||!isFinite(A)||!isFinite(R))throw new Error("Invalid MRT header");const D=2**R,U=D*r.aF(h),F=D*r.aJ(t);return(function([V,G],Z,{scaled:ie=!0}={}){if(!Z)throw new Error("bandView is undefined");const{data:J,tileSize:ae,buffer:me,offset:ye,scale:Pe,dimension:Ae}=Z;if(V<-me||V>ae+me||G<-me||G>ae+me)throw new Error(`Point (${V}, ${G}) out of bounds for tileSize=${ae}, buffer=${me}`);const Me=(G+me)*(ae+2*me)+(V+me);if(new Uint32Array(J.buffer)[Me]===4294967295)return null;let Ie=[];Ie=ie?[]:new Z.data.constructor(Ae);for(let Ee=0;Ee<Ae;Ee++)Ie[Ee]=Math.round(1e12*(J[Ae*Me+Ee]*Pe+ye))/1e12;return Ie})([Math.min(Math.max(-x,Math.floor((U-w)*g)),g-1+x),Math.min(Math.max(-x,Math.floor((F-A)*g)),g-1+x)],u,{scaled:m})}class Xs extends Wo{constructor(t,s,u,m){super(t,s,u,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);s&&s.enabled&&u&&s._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(u,r.R.Tile),g={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const x=(w,A,R,D)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(w)return w.name==="AbortError"?void 0:(t.state="errored",s(w));if(this.map._refreshExpiredTiles&&A&&t.setExpiryData({cacheControl:R,expires:D}),this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!A)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=A}s(null)};t.request=this.partial?t.fetchHeader(void 0,x.bind(this)):t.actor.send("loadTile",g,x.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const u=t.texturePerLayer;if(t.flushAllQueues(),u.size){t.destroy(!0);for(const m of u.values())this.map.painter.saveTileTexture(m)}else t.destroy()}prepareTile(t,s,u,m){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(s,u,m,((g,x)=>{if(g)return t.state="errored",this.fire(new r.y(g)),void this.triggerRepaint(t);x&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(u,x,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find((({id:g})=>g===t)),u=s&&s.fields,m=u&&u.bands&&u.bands;return m?m[0]:0}getTextureDescriptor(t,s,u){if(!t)return;const m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let g=null;s instanceof r.aP?g=s.paint.get("raster-array-band"):s instanceof r.aQ&&(g=s.paint.get("raster-particle-array-band"));const x=g||this.getInitialBand(m);if(x==null)return;if(!t.textureDescriptorPerLayer.get(s.id))return void this.prepareTile(t,m,s.id,x);if(t.updateNeeded(s.id,x)&&!u)return;const w=t.textureDescriptorPerLayer.get(s.id);return Object.assign({},w,{texture:t.texturePerLayer.get(s.id)})}getImages(t,s){const u=new Map;for(const m of t)for(const g of s){const[x,w]=g.split("/"),A=m.getLayer(x);if(!A||!A.hasBand(w)||!A.hasDataForBand(w))continue;const{bytes:R,tileSize:D,buffer:U}=A.getBandView(w),F=D+2*U,V={data:new r.q({width:F,height:F},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(g,V)}return u}queryRasterArrayValueByBandId(t,s,u){const m=s._mrt;return new Promise((g=>{const x={},w=new Set;for(const[A,R]of Object.entries(m.layers)){if(u.layerName&&A!==u.layerName)continue;const D={};x[A]=D;for(const{bands:U}of R.dataIndex)for(const F of U)u.bands&&!u.bands.includes(F)||(w.add(r.B(A,F)),s.fetchBand(A,null,F,(V=>{r.o.frame((()=>{D[F]=V?null:oa([t.lng,t.lat],m,R.getBandView(F)),w.delete(r.B(A,F)),w.size===0&&g(x)}))}),!1))}w.size===0&&g(x)}))}_loadTileForQuery(t,s){if(this._loadTileLoaded[t.uid])return void s(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(s);this._loadTilePending[t.uid]=[s];const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(u,r.R.Tile);t.actor.send("loadTile",{request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((g,x,w,A)=>g?(this._loadTilePending[t.uid].forEach((R=>R(g,null))),void delete this._loadTilePending[t.uid]):x?(this.map._refreshExpiredTiles&&x&&t.setExpiryData({cacheControl:w,expires:A}),t._mrt=x,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((R=>R(null,x))),this._loadTileLoaded[t.uid]=!0,void delete this._loadTilePending[t.uid]):(this._loadTilePending[t.uid].forEach((R=>R(null,null))),void delete this._loadTilePending[t.uid])),void 0,!0)}queryRasterArrayValueByAllBands(t,s,u){return new Promise(((m,g)=>{this._loadTileForQuery(s,((x,w)=>{x?g(x):m(w?this.queryRasterArrayValueByBandId(t,s,u):null)}))}))}queryRasterArrayValue(t,s){const u=r.aR.convert(t),m=this.findLoadedParent(u);return m&&m._mrt?s.bands||!this.partial?this.queryRasterArrayValueByBandId(u,m,s):this.queryRasterArrayValueByAllBands(u,m,s):Promise.resolve(null)}findLoadedParent(t){const s=r.ae.fromLngLat(t,this.map.transform.tileSize),u=this.maxzoom+1,m=1<<u,g=Math.floor(s.x),x=Math.floor((s.x-g)*m),w=Math.floor(s.y*m),A=this.map.style.getSourceCache(this.id),R=new r.aO(u,g,u,x,w);return A.findLoadedParent(R,this.minzoom)}}const aa={vector:sr,raster:Wo,"raster-dem":class extends Wo{constructor(h,t,s,u){super(h,t,s,u),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const s=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(m,g){m&&(h.state="errored",t(m)),g&&(h.dem=g,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=r.n(this.map._requestManager.transformRequest(s,r.R.Tile),(function(m,g,x,w){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(m)h.state="errored",t(m);else if(g){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:x,expires:w});const A=ImageBitmap&&g instanceof ImageBitmap&&r.r(),R=1-(g.width-r.aN(g.width))/2;R<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const D=A?g:r.o.getImageData(g,R),U={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:R};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",U,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,s=Math.pow(2,t.z),u=(t.x-1+s)%s,m=t.x===0?h.wrap-1:h.wrap,g=(t.x+1+s)%s,x=t.x+1===s?h.wrap+1:h.wrap,w={};return w[new r.aO(h.overscaledZ,m,t.z,u,t.y).key]={backfilled:!1},w[new r.aO(h.overscaledZ,x,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(w[new r.aO(h.overscaledZ,m,t.z,u,t.y-1).key]={backfilled:!1},w[new r.aO(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},w[new r.aO(h.overscaledZ,x,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<s&&(w[new r.aO(h.overscaledZ,m,t.z,u,t.y+1).key]={backfilled:!1},w[new r.aO(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},w[new r.aO(h.overscaledZ,x,t.z,g,t.y+1).key]={backfilled:!1}),w}},"raster-array":Xs,geojson:class extends r.E{constructor(h,t,s,u){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(u),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:r.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of h.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,s,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:s},u),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:h},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(r.o.resolveURL(s),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new r.y(u));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(g.resourceTiming=m.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new r.z("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const h=r.B(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const s=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,m=u?{image:u.image.clone()}:null,g=this._partialReload,x={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:g,worldview:this.map.getWorldview()};h.request=this.actor.send(s,x,((w,A)=>g&&!A?(h.state="loaded",t(null)):(delete h.request,h.destroy(),h.aborted?t(null):w?t(w):(h.loadVectorData(A,this.map.painter,s==="reloadTile"),t(null)))),void 0,s==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aS{constructor(h,t,s,u){super(h,t,s,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aT(this.urls,((t,s)=>{this._loaded=!0,t?this.fire(new r.y(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aS,model:class extends r.E{constructor(h,t,s,u){super(),this.id=h,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const h=[];for(const t in this._options.models){const s=this._options.models[t],u=r.aV(this.map._requestManager.transformRequest(s.uri,r.R.Model).url).then((m=>{if(!m)return;const g=r.aW(m),x=new r.aX(t,s.position,s.orientation,g);x.computeBoundsAndApplyParent(),this.models.push(x)})).catch((m=>{this.fire(new r.y(new Error(`Could not load model ${t} from ${s.uri}: ${m.message}`)))}));h.push(u)}Promise.allSettled(h).then((()=>{this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this._loaded=!0,this.fire(new r.y(new Error(`Could not load models: ${t.message}`)))}))}onAdd(h){this.map=h,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(h,t){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(h,t,s,u){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=r.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(h)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=gs(this._options,this.map._requestManager,t,s,((u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new r.y(u))):m&&(Object.assign(this,m),m.bounds&&(this.tileBounds=new Hn(m.bounds,this.minzoom,this.maxzoom)),ki(m.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(u)}))}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const s=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(s,r.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const g=Object.values(h.buckets);for(const x of g)x.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",u,m.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",u,m.bind(this),void 0,!0);function m(g,x){return h.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&x&&h.setExpiryData(x),h.loadModelData(x,this.map.painter),h.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aS{constructor(h,t,s,u){super(h,t,s,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((m=>!Array.isArray(m)||m.length!==2||m.some((g=>typeof g!="number"))))||this.fire(new r.y(new r.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof r.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends r.E{constructor(h,t,s,u){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Hn(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:s,z:u}=h.canonical;return this._implementation.hasTile({x:t,y:s,z:u})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:s,y:u,z:m}=h.tileID.canonical,g=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:s,y:u,z:m},{signal:g.signal})).then((function(x){return delete h.request,h.aborted?(h.state="unloaded",t(null)):x===void 0?(h.state="errored",t(null)):x===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):(function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement})(x)?(this.loadTileData(h,x),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((x=>{x.name!=="AbortError"&&(h.state="errored",t(x))})),h.request.cancel=()=>g.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof r.T?(h.destroy(!0),h.texture&&h.texture instanceof r.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:s,y:u,z:m}=h.tileID.canonical;this._implementation.unloadTile({x:s,y:u,z:m})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z})))}_clearTiles(){const h=r.B(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Kn=function(h,t,s,u){const m=new aa[t.type](h,t,s,u);if(m.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${m.id}`);return r.aY(["load","abort","unload","serialize","prepare"],m),m};function Br(h,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${(function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:m,importId:g}=u;return`featureset:${m}${g?`:import:${g}`:""}`}})(h.target)}`}function po(h,t,s,u=""){if(h.uniqueFeatureID){const m=Br(h,t,u);if(s.has(m))return!0;s.add(m)}return!1}function ks(h,t,s,u,m=!1){const g=t.sourceCache.transform,x=t.sourceCache.tilesIn(h,t.has3DLayers,m);x.sort(Ia);const w=[];for(const A of x){const R=A.tile.queryRenderedFeatures(t,A,s,u,g,m);Object.keys(R).length&&w.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:R})}return w.length===0?{}:(function(A){const R={},D={};for(const U of A){const F=U.queryResults,V=U.wrappedTileID,G=D[V]=D[V]||{};for(const Z in F){const ie=F[Z],J=G[Z]=G[Z]||{},ae=R[Z]=R[Z]||[];for(const me of ie)J[me.featureIndex]||(J[me.featureIndex]=!0,ae.push(me))}}return R})(w)}function Ls(h,t,s,u,m,g){const x={},w=u.queryRenderedSymbols(h),A=[];for(const R of Object.keys(w).map(Number))A.push(m[R]);A.sort(Ia);for(const R of A){const D=R.featureIndex.lookupSymbolFeatures(w[R.bucketInstanceId],R.bucketIndex,R.sourceLayerIndex,t,s,g);for(const U in D){const F=x[U]=x[U]||[],V=D[U];V.sort(((G,Z)=>{const ie=R.featureSortOrder;if(ie){const J=ie.indexOf(G.featureIndex);return ie.indexOf(Z.featureIndex)-J}return Z.featureIndex-G.featureIndex}));for(const G of V)F.push(G)}}return x}function oo(h,t){const s=h.getRenderableIds().map((g=>h.getTileByID(g))),u=[],m={};for(let g=0;g<s.length;g++){const x=s[g],w=x.tileID.canonical.key;m[w]||(m[w]=!0,x.querySourceFeatures(u,t))}return u}function Ia(h,t){const s=h.tileID,u=t.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function Vo(h,t){const s={};if(!t)return s;for(const u of h){const m=u.layerIds.map((g=>t.getLayer(g))).filter(Boolean);if(m.length!==0){u.layers=m,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map((g=>m.filter((x=>x.id===g))[0])));for(const g of m)s[g.fqid]=u}}return s}const Or=32,Vs=33,mo=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,s=0,u=0,m=0,g=0,x=0,w=0;for(1&t?m=g=x=Or:s=u=w=Or;(t>>=1)>1;){const R=s+m>>1,D=u+g>>1;1&t?(m=s,g=u,s=x,u=w):(s=m,u=g,m=x,g=w),x=R,w=D}const A=4*h;mo[A+0]=s,mo[A+1]=u,mo[A+2]=m,mo[A+3]=g}const ao=new Uint16Array(2178),js=new Uint8Array(1089),_o=new Uint16Array(1089);function go(h){return h===0?-.03125:h===32?.03125:0}const To={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class ko{constructor(t,s,u,m,g,x){this.tileID=t,this.uid=r.b2(),this.uses=0,this.tileSize=s,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection),this.worldview=x}registerFadeDuration(t){const s=t+this.timeAdded;s<r.o.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Vo(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const g=this.buckets[m];if(g instanceof r.b4){if(this.hasSymbolBuckets=!0,!u)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const g=this.buckets[m];if(g instanceof r.b4&&g.hasRTLText){this.hasRTLText=!0,r.b5();break}}this.queryPadding=0;for(const m in this.buckets){const g=this.buckets[m],x=s.style.getOwnLayer(m);if(!x)continue;const w=x.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,w)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Vo(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(t)}const s=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new r.T(t,u.image,s.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=s.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,s,u,m,g,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const w=(function(A,R){const D=r.bq([],[.5*A.width,.5*-A.height,1]);return r.br(D,D,[1,-1,0]),r.aB(D,D,A.calculateProjMatrix(R.toUnwrapped())),Float32Array.from(D)})(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:w,transform:m,availableImages:u,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const m=u.loadVTLayers(),g=s?s.sourceLayer:"",x=m._geojsonTileLayer||m[g];if(!x)return;const w=r.b6(s&&s.filter),{z:A,x:R,y:D}=this.tileID.canonical,U={z:A,x:R,y:D};for(let F=0;F<x.length;F++){const V=x.feature(F);if(w.needGeometry){const ie=r.b7(V,!0);if(!w.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ie,this.tileID.canonical))continue}else if(!w.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),V))continue;const G=u.getId(V,g),Z=new r.b8(V,A,R,D,G);Z.tile=U,t.push(Z)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const u=r.b9(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let m=!1;if(this.expirationTime>u)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const g=this.expirationTime-s;g?this.expirationTime=u+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),g=t.style.getBrightness();for(const x in this.buckets){if(!t.style.hasLayer(x))continue;const w=this.buckets[x],A=w.layers[0],R=A.sourceLayer||"_geojsonTileLayer",D=u[R],U=t.style.getLayerSourceCache(A);let F={};U&&(F=U._state.getState(R,void 0));const V=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},G=Object.keys(F).length>0&&!s;(G&&w.stateDependentLayers.length!==0||s)&&w.update(F,D,m,V,G?w.stateDependentLayers:w.layers,s,g),(w instanceof r.ba||w instanceof r.bb)&&t._terrain&&t._terrain.enabled&&U&&w.uploadPending()&&t._terrain._clearRenderCacheForTile(U.id,this.tileID);const Z=t&&t.style&&t.style.getOwnLayer(x);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.o.now()+t}setTexture(t,s){const u=s.context,m=u.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(u,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,s){const u={};for(const m of s)u[m]=!0;this.dependencies[t]=u}hasDependency(t,s){for(const u of t){const m=this.dependencies[u];if(m){for(const g of s)if(m[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const u=r.bc(To,this.tileID.canonical,this.tileTransform)[0],m=new r.bd,g=new r.be;for(let x=0;x<u.length;x++){const{x:w,y:A}=u[x];m.emplaceBack(w,A),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(m,r.bf.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,m.length,g.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const u=r.bc(To,this.tileID.canonical,this.tileTransform)[0];let m,g;if(this.isRaster){const x=(function(w,A){const R=r.aZ(w,A),D=Math.pow(2,w.z);for(let ie=0;ie<Vs;ie++)for(let J=0;J<Vs;J++){const ae=r.a_((w.x+(J+go(J))/Or)/D),me=r.a$((w.y+(ie+go(ie))/Or)/D),ye=A.project(ae,me),Pe=ie*Vs+J;ao[2*Pe+0]=Math.round((ye.x*R.scale-R.x)*r.al),ao[2*Pe+1]=Math.round((ye.y*R.scale-R.y)*r.al)}js.fill(0),_o.fill(0);for(let ie=2045;ie>=0;ie--){const J=4*ie,ae=mo[J+0],me=mo[J+1],ye=mo[J+2],Pe=mo[J+3],Ae=ae+ye>>1,Me=me+Pe>>1,Ie=Ae+Me-me,Ee=Me+ae-Ae,Re=me*Vs+ae,nt=Pe*Vs+ye,We=Me*Vs+Ae,gt=Math.hypot((ao[2*Re+0]+ao[2*nt+0])/2-ao[2*We+0],(ao[2*Re+1]+ao[2*nt+1])/2-ao[2*We+1])>=16;js[We]=js[We]||(gt?1:0),ie<1022&&(js[We]=js[We]||js[(me+Ee>>1)*Vs+(ae+Ie>>1)]||js[(Pe+Ee>>1)*Vs+(ye+Ie>>1)])}const U=new r.b0,F=new r.b1;let V=0;function G(ie,J){const ae=J*Vs+ie;return _o[ae]===0&&(U.emplaceBack(ao[2*ae+0],ao[2*ae+1],ie*r.al/Or,J*r.al/Or),_o[ae]=++V),_o[ae]-1}function Z(ie,J,ae,me,ye,Pe){const Ae=ie+ae>>1,Me=J+me>>1;if(Math.abs(ie-ye)+Math.abs(J-Pe)>1&&js[Me*Vs+Ae])Z(ye,Pe,ie,J,Ae,Me),Z(ae,me,ye,Pe,Ae,Me);else{const Ie=G(ie,J),Ee=G(ae,me),Re=G(ye,Pe);F.emplaceBack(Ie,Ee,Re)}}return Z(0,0,Or,Or,Or,0),Z(Or,Or,0,0,0,Or),{vertices:U,indices:F}})(this.tileID.canonical,s);m=x.vertices,g=x.indices}else{m=new r.b0,g=new r.b1;for(const{x:w,y:A}of u)m.emplaceBack(w,A,0,0);const x=r.bh(m.int16.subarray(0,4*m.length),void 0,4);for(let w=0;w<x.length;w+=3)g.emplaceBack(x[w],x[w+1],x[w+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,r.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=r.bg.simpleSegment(0,0,m.length,g.length)}_makeGlobeTileDebugBuffers(t,s){const u=s.projection;if(!u||u.name!=="globe"||s.freezeTileCoverage)return;const m=this.tileID.canonical,g=r.bj(m,s),x=r.bk(g),w=r.aj(s.zoom);let A;w>0&&(A=r.bl(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,s,x,A,w),this._makeGlobeTileDebugTextBuffer(t,m,s,x,A,w)}_globePoint(t,s,u,m,g,x,w){let A=r.bm(t,s,u);if(x){const R=1<<u.z,D=r.aF(m.center.lng),U=r.aJ(m.center.lat),F=(u.x+.5)/R-D;let V=0;F>.5?V=-1:F<-.5&&(V=1);let G=(t/r.al+u.x)/R+V,Z=(s/r.al+u.y)/R;G=(G-D)*m._pixelsPerMercatorPixel+D,Z=(Z-U)*m._pixelsPerMercatorPixel+U;const ie=[G*m.worldSize,Z*m.worldSize,0];r.af(ie,ie,x),A=r.bn(A,ie,w)}return r.af(A,A,g)}_makeGlobeTileDebugBorderBuffer(t,s,u,m,g,x){const w=new r.bd,A=new r.be,R=new r.bo,D=(F,V,G,Z,ie)=>{const J=(G-F)/(ie-1),ae=(Z-V)/(ie-1),me=w.length;for(let ye=0;ye<ie;ye++){const Pe=F+ye*J,Ae=V+ye*ae;w.emplaceBack(Pe,Ae);const Me=this._globePoint(Pe,Ae,s,u,m,g,x);R.emplaceBack(Me[0],Me[1],Me[2]),A.emplaceBack(me+ye)}},U=r.al;D(0,0,U,0,16),D(U,0,U,U,16),D(U,U,0,U,16),D(0,U,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(w,r.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(R,r.bp.members),this._tileDebugSegments=r.bg.simpleSegment(0,0,w.length,A.length)}_makeGlobeTileDebugTextBuffer(t,s,u,m,g,x){const w=r.al/4,A=new r.bd,R=new r.b1,D=new r.bo,U=25;R.reserve(32),A.reserve(U),D.reserve(U);const F=(V,G)=>U*V+G;for(let V=0;V<U;V++){const G=V*w;for(let Z=0;Z<U;Z++){const ie=Z*w;A.emplaceBack(ie,G);const J=this._globePoint(ie,G,s,u,m,g,x);D.emplaceBack(J[0],J[1],J[2])}}for(let V=0;V<4;V++)for(let G=0;G<4;G++){const Z=F(V,G),ie=F(V,G+1),J=F(V+1,G),ae=F(V+1,G+1);R.emplaceBack(Z,ie,J),R.emplaceBack(J,ie,ae)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(R),this._tileDebugTextBuffer=t.createVertexBuffer(A,r.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(D,r.bp.members),this._tileDebugTextSegments=r.bg.simpleSegment(0,0,U,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bs.setPbf(r.bt);class _t extends ko{constructor(t,s,u,m,g){super(t,s,u,m,g),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,s,u){const m=u.context,g=m.gl;let x=this.texturePerLayer.get(t)||u.getTileTexture(s.width);x&&x instanceof r.T?x.update(s,{premultiply:!1}):x=new r.T(m,s,g.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,x)}flushQueues(t){const s=this._workQueuePerLayer.get(t)||[],u=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()();for(;u.length;)u.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const s=this._workQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const s=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}}fetchHeader(t=16384,s){const u=this._mrt=new r.bs(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bu(m,((g,x,w,A)=>{if(g)s(g);else try{const R=u.getHeaderLength(x);if(R>t)return void(this.request=this.fetchHeader(R,s));u.parseHeader(x),this._isHeaderLoaded=!0;let D=0;for(const U of Object.values(u.layers))D=Math.max(D,U.dataIndex[U.dataIndex.length-1].lastByte);x.byteLength>=D&&(this.entireBuffer=x),s(null,this.entireBuffer||x,w,A)}catch(R){s(R)}})),this.request}fetchBandForRender(t,s,u,m){this.fetchBand(t,s,u,(g=>{if(g)return void m(g);this.updateTextureDescriptor(t,s,u);const x=this.textureDescriptorPerLayer.get(s);m(null,x?x.img:null)}))}fetchBand(t,s,u,m,g=!0){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void m(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void m(new Error("Can't fetch tile band without an actor"));let A;const R=r.B(String(u),r.B(this.tileID.key,t));let D=this._taskQueue.get(R);D?D.add(m):(D=new Set,D.add(m),this._taskQueue.set(R,D));const U=(Z,ie)=>{A.complete(Z,ie),Z?m(Z):(D.values().forEach((J=>J(null,ie))),this._taskQueue.delete(R))},F=(Z,ie)=>{if(Z)return m(Z);const J=w.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ie,task:A},U,void 0,!0);if(s!==null){const ae=this._workQueuePerLayer.get(s)||[];ae.push((()=>{J&&J.cancel(),A.cancel()})),this._workQueuePerLayer.has(s)||this._workQueuePerLayer.set(s,ae)}};let V;try{V=x.getLayer(t)}catch(Z){if(this.state==="reloading")return;throw Z}if(!V)return void m(new Error(`Unknown sourceLayer "${t}"`));if(V.hasDataForBand(u))return D.values().forEach((Z=>Z(null,null))),void this._taskQueue.delete(R);const G=V.getDataRange([u]);if(A=x.createDecodingTask(G),!A||A.tasks.length)if(s!==null&&this.flushQueues(s),this.entireBuffer)F(null,this.entireBuffer.slice(G.firstByte,G.lastByte+1));else{const Z=Object.assign({},this.requestParams,{headers:{Range:`bytes=${G.firstByte}-${G.lastByte}`}}),ie=r.bu(Z,F);if(s!==null){const J=this._fetchQueuePerLayer.get(s)||[];J.push((()=>{ie.cancel(),A.cancel()})),this._fetchQueuePerLayer.has(s)||this._fetchQueuePerLayer.set(s,J)}}}updateNeeded(t,s){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==s||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,s,u){if(!this._mrt)return;const m=this._mrt.getLayer(t);if(!m||!m.hasBand(u)||!m.hasDataForBand(u))return;const{bytes:g,tileSize:x,buffer:w,offset:A,scale:R}=m.getBandView(u),D=x+2*w,U=new r.q({width:D,height:D},g),F=this.texturePerLayer.get(s);F&&F instanceof r.T&&F.update(U,{premultiply:!1}),this.textureDescriptorPerLayer.set(s,{layer:t,band:u,img:U,buffer:w,offset:A,tileSize:x,format:m.pixelFormat,mix:[R,256*R,65536*R,16777216*R]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const s of this.texturePerLayer.values())s&&s instanceof r.T&&s.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Jt{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,u){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const g={value:s,timeout:void 0};if(u!==void 0&&(g.timeout=setTimeout((()=>{this.remove(t,g)}),u)),this.data[m].push(g),this.order.push(m),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const u=t.wrapped().key,m=s===void 0?0:this.data[u].indexOf(s),g=this.data[u][m];return this.data[u].splice(m,1),g.timeout&&clearTimeout(g.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(g.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const u in this.data)for(const m of this.data[u])t(m.value)||s.push(m);for(const u of s)this.remove(u.value.tileID,u)}}class Pi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,u){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},Object.assign(this.stateChanges[t][m],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==m&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const g in this.state[t][m])u[g]||(this.deletedStates[t][m][g]=null)}else for(const g in u)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][g]===null&&delete this.deletedStates[t][m][g]}removeFeatureState(t,s,u){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][u]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(u in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][u]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const u=this.state[t]||{},m=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(s!==void 0){const w=String(s),A=Object.assign({},u[w],m[w]);if(g){const R=g[s];if(R===null)return{};for(const D in R)delete A[D]}return A}const x=Object.assign({},u,m);if(g)for(const w in g)delete x[w];return x}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const u={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const g={};for(const x in this.stateChanges[m])this.state[m][x]||(this.state[m][x]={}),Object.assign(this.state[m][x],this.stateChanges[m][x]),g[x]=this.state[m][x];u[m]=g}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const g={};if(this.deletedStates[m]===null)for(const x in this.state[m])g[x]={},this.state[m][x]={};else for(const x in this.deletedStates[m]){if(this.deletedStates[m][x]===null)this.state[m][x]={};else if(this.state[m][x])for(const w of Object.keys(this.deletedStates[m][x]))delete this.state[m][x][w];g[x]=this.state[m][x]}u[m]=u[m]||{},Object.assign(u[m],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const m in t)t[m].refreshFeatureState(s)}}class Fn extends r.E{constructor(t,s,u){super(),this.id=t,this._onlySymbols=u,s.on("data",(m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),s.on("error",(()=>{this._sourceErrored=!0})),this._source=s,this._tiles={},this._cache=new Jt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Pi,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(xr).map((t=>t.key))}getRenderableIds(t,s){const u=[];for(const m in this._tiles)this._isIdRenderable(+m,t,s)&&u.push(this._tiles[m]);return t?u.sort(((m,g)=>{const x=m.tileID,w=g.tileID,A=new r.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),R=new r.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-w.overscaledZ||R.y-A.y||R.x-A.x})).map((m=>m.tileID.key)):u.map((m=>m.tileID)).sort(xr).map((m=>m.key))}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=s),this._loadTile(u,this._tileLoaded.bind(this,u,t,s)))}_tileLoaded(t,s,u,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new r.y(m,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.o.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const g=s[m];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);u(t,x),u(x,t)}}function u(m,g){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-m.tileID.canonical.x;const w=g.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),R=g.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+A)===1?x+=A:Math.abs(x-A)===1&&(x-=A)),g.dem&&m.dem&&(m.dem.backfillBorder(g.dem,x,w),m.neighboringTiles&&m.neighboringTiles[R]&&(m.neighboringTiles[R].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,u,m){for(const g in this._tiles){let x=this._tiles[g];if(m[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>u)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const R=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[R.key],x&&x.hasData()&&(w=R)}let A=w;for(;A.overscaledZ>s;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){m[w.key]=w;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=t.overscaledZ-1;u>=s;u--){const m=t.scaledTo(u),g=this._getLoadedTile(m);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const u=Math.ceil(t.width/s)+1,m=Math.ceil(t.height/s)+1,g=Math.floor(u*m*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(w)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const u={};for(const m in this._tiles){const g=this._tiles[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),u[g.tileID.key]=g}this._tiles=u;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,s,u,m,g){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x=this._source.type==="batched-model";let w,A=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const F=R.attenuationRange()[0],V=Math.floor(F)-Math.log2(R.getDemUpscale());A>V&&(A=V)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((F=>new r.aO(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)));else if(this.tileCoverLift!==0){const F=t.clone();F.tileCoverLift=this.tileCoverLift,w=F.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&t.projection.name==="globe"&&(w.push(new r.aO(1,0,1,0,0)),w.push(new r.aO(1,0,1,1,0)),w.push(new r.aO(1,0,1,0,1)),w.push(new r.aO(1,0,1,1,1)))}else if(w=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);w=w.filter((V=>F(V)))}}else w=[];if(w.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Es(this._source.type)){const F=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),V=Math.min(F,this._source.maxzoom);if(x){const G=t.extendTileCover(w,V);for(const Z of G)w.push(Z)}else if(g){const G=t.extendTileCoverToNearPlane(w,this.transform.getFrustum(V),V);for(const Z of G)w.push(Z)}else if(this.castsShadows&&m){const G=t.extendTileCover(w,V,m);for(const Z of G)this._shadowCasterTiles[Z.key]=!0,w.push(Z)}}const D=this._updateRetainedTiles(w);if(Es(this._source.type)&&w.length!==0){const F={},V={},G=Object.keys(D);for(const ie of G){const J=D[ie],ae=this._tiles[ie];if(!ae||ae.fadeEndTime&&ae.fadeEndTime<=r.o.now())continue;const me=this.findLoadedParent(J,Math.max(J.overscaledZ-Fn.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),F[me.tileID.key]=me.tileID),V[ie]=J}const Z=w[w.length-1].overscaledZ;for(const ie in this._tiles){const J=this._tiles[ie];if(D[ie]||!J.hasData())continue;let ae=J.tileID;for(;ae.overscaledZ>Z;){ae=ae.scaledTo(ae.overscaledZ-1);const me=this._tiles[ae.key];if(me&&me.hasData()&&V[ae.key]){D[ie]=J.tileID;break}}}for(const ie in F)D[ie]||(this._coveredTiles[ie]=!0,D[ie]=F[ie])}for(const F in D)this._tiles[F].clearFadeHold();const U=r.bv(this._tiles,D);for(const F of U){const V=this._tiles[F];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const u={},m=t.reduce(((R,D)=>Math.min(R,D.overscaledZ)),1/0),g=t[0].overscaledZ,x=Math.max(g-Fn.maxOverzooming,this._source.minzoom),w=Math.max(g+Fn.maxUnderzooming,this._source.minzoom),A={};for(const R of t){const D=this._addTile(R);s[R.key]=R,D.hasData()||m<this._source.maxzoom&&(A[R.key]=R)}this._retainLoadedChildren(A,m,w,s);for(const R of t){let D=this._tiles[R.key];if(D.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const F=R.children(this._source.maxzoom)[0],V=this.getTile(F);if(V&&V.hasData()){s[F.key]=F;continue}}else{const F=R.children(this._source.maxzoom);if(s[F[0].key]&&s[F[1].key]&&s[F[2].key]&&s[F[3].key])continue}let U=D.wasRequested();for(let F=R.overscaledZ-1;F>=x;--F){const V=R.scaledTo(F);if(u[V.key]||(u[V.key]=!0,D=this.getTile(V),!D&&U&&(D=this._addTile(V)),D&&(s[V.key]=V,U=D.wasRequested(),D.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let u,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){u=this._loadedParentTiles[m.key];break}s.push(m.key);const g=m.scaledTo(m.overscaledZ-1);if(u=this._getLoadedTile(g),u)break;m=g}for(const g of s)this._loadedParentTiles[g]=u}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const u=!!s;if(!u){const m=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new _t(t,g,this.transform.tileZoom,m,this._isRaster):new ko(t,g,this.transform.tileZoom,m,this._isRaster,this._source.worldview),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,u||this._source.fire(new r.z("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=s.getExpiryTimeout();u&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),u))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,u){const m=[],g=this.transform;if(!g)return m;const x=g.projection.name==="globe",w=r.aF(g.center.lng);for(const A in this._tiles){const R=this._tiles[A];if(u&&R.clearQueryDebugViz(),R.holdingForFade())continue;let D;if(x){const U=R.tileID.canonical;if(U.z===0){const F=[Math.abs(r.aA(w,...In(U,-1))-w),Math.abs(r.aA(w,...In(U,1))-w)];D=[0,2*F.indexOf(Math.min(...F))-1]}else{const F=[Math.abs(r.aA(w,...In(U,-1))-w),Math.abs(r.aA(w,...In(U,0))-w),Math.abs(r.aA(w,...In(U,1))-w)];D=[F.indexOf(Math.min(...F))-1]}}else D=[0];for(const U of D){const F=t.containsTile(R,g,s,U);F&&m.push(F)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const u=this.getRenderableIds(t,s).map((g=>this._tiles[g].tileID)),m=this.transform.projection.name==="globe";for(const g of u)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=m?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return u}sortCoordinatesByDistance(t){const s=t.slice(),u=this.transform._camera.position,m=this.transform._camera.forward(),g={};for(const x of s){const w=1/(1<<x.canonical.z);g[x.key]=((x.canonical.x+.5)*w+x.wrap-u[0])*m[0]+((x.canonical.y+.5)*w-u[1])*m[1]-u[2]*m[2]}return s.sort(((x,w)=>g[x.key]-g[w.key])),s}hasTransition(){if(this._source.hasTransition())return!0;if(Es(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(t,s,u){this._state.updateState(t=t||"_geojsonTileLayer",s,u)}removeFeatureState(t,s,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,u)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,u){const m=this._tiles[t];m&&m.setDependencies(s,u)}reloadTilesForDependencies(t,s){for(const u in this._tiles)this._tiles[u].hasDependency(t,s)&&this._reloadTile(+u,"reloading");this._cache.filter((u=>!u.hasDependency(t,s)))}_preloadTiles(t,s){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,s))};return void this._source.on("data",A)}const u=new Map,m=Array.isArray(t)?t:[t],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const A of m){const R=A.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of R)u.set(D.key,D);this.usedForTerrain&&A.updateElevation(!1)}const w=Array.from(u.values());r.bw(w,((A,R)=>{const D=new ko(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,(U=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),R(U,D)}))}),s)}}function xr(h,t){const s=Math.abs(2*h.wrap)-+(h.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||u-s||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function Es(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function In(h,t){const s=1<<h.z;return[h.x/s+t,(h.x+1)/s+t]}Fn.maxOverzooming=10,Fn.maxUnderzooming=3;class fr{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const u in this.style._mergedLayers){const m=this.style._mergedLayers[u];if(m.type==="fill-extrusion"||m.type==="building")this.layers.push({layer:m,visible:t,visibilityChanged:s});else if(m.type==="model"){const g=this.style.getLayerSource(m);g&&g.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const u=s.layer;let m=!1;u.type==="fill-extrusion"?m=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="building"?m=!u.isHidden(t)&&u.paint.get("building-opacity")>0:u.type==="model"&&(m=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const m of this.layers){const g=m.layer,x=this.style.getLayerSourceCache(g);let w=1;g.type==="fill-extrusion"?w=m.visible?g.paint.get("fill-extrusion-vertical-scale"):0:g.type==="building"&&(w=m.visible?g.paint.get("building-vertical-scale"):0);let A=x?x.getTile(s):null;if(!A&&x)for(const R in x._tiles){const D=x._tiles[R];if(s.canonical.isChildOf(D.tileID.canonical)){A=D;break}}this.currentBuildingBuckets.push({bucket:A?A.getBucket(g):null,tileID:A?A.tileID:s,verticalScale:w})}t.hasAnyZOffset=!1;let u=!1;for(let m=0;m<t.symbolInstances.length;m++){const g=t.symbolInstances.get(m),x=g.zOffset,w=this._getHeightAtTileOffset(s,g.tileAnchorX,g.tileAnchorY);g.zOffset=w!==Number.NEGATIVE_INFINITY?w:x,u||x===g.zOffset||(u=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,u,m){let g=s,x=u;if(t.canonical.z!==m.canonical.z){const w=m.canonical,A=1/(1<<t.canonical.z-w.z);g=(s+t.canonical.x*r.al)*A-w.x*r.al|0,x=(u+t.canonical.y*r.al)*A-w.y*r.al|0}return{tileX:g,tileY:x}}_getHeightAtTileOffset(t,s,u){let m,g;for(let x=0;x<this.layers.length;++x){const w=this.layers[x].layer;if(w.type!=="fill-extrusion"&&w.type!=="building")continue;const{bucket:A,tileID:R,verticalScale:D}=this.currentBuildingBuckets[x];if(!A)continue;const{tileX:U,tileY:F}=this._mapCoordToOverlappingTile(t,s,u,R),V=A.getHeightAtTileCoord(U,F);V&&V.height!==void 0&&(V.hidden?m=V.height:g=Math.max(V.height*D,g||0))}if(g!==void 0)return g;for(let x=0;x<this.layers.length;++x){const w=this.layers[x];if(w.layer.type!=="model"||!w.visible)continue;const{bucket:A,tileID:R}=this.currentBuildingBuckets[x];if(!A)continue;const{tileX:D,tileY:U}=this._mapCoordToOverlappingTile(t,s,u,R),F=A.getHeightAtTileCoord(D,U);if(F&&!F.hidden)return F.height===void 0&&m!==void 0?Math.min(F.maxHeight,m)*F.verticalScale:F.height?F.height*F.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function pr(h,t){const s={};for(const u in h)u!=="ref"&&(s[u]=h[u]);return r.bx.forEach((u=>{u in t&&(s[u]=t[u])})),s}function Js(h){h=h.slice();const t=Object.create(null);for(let s=0;s<h.length;s++)t[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=pr(h[s],t[h[s].ref]));return h}const Pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ps(h,t,s){s.push({command:Pn.addSource,args:[h,t[h]]})}function Pa(h,t,s){t.push({command:Pn.removeSource,args:[h]}),s[h]=!0}function la(h,t,s,u){Pa(h,s,u),Ps(h,t,s)}function jo(h,t,s){let u;for(u in h[s])if(h[s].hasOwnProperty(u)&&u!=="data"&&!r.by(h[s][u],t[s][u]))return!1;for(u in t[s])if(t[s].hasOwnProperty(u)&&u!=="data"&&!r.by(h[s][u],t[s][u]))return!1;return!0}function Qs(h,t,s,u,m,g){let x;for(x in t=t||{},h=h||{})h.hasOwnProperty(x)&&(r.by(h[x],t[x])||s.push({command:g,args:[u,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!h.hasOwnProperty(x)&&(r.by(h[x],t[x])||s.push({command:g,args:[u,x,t[x],m]}))}function ms(h){return h.id}function Rn(h,t){return h[t.id]=t,h}function Fo(h,t,s){const u=t.createTileMatrix(h,h.worldSize,s.toUnwrapped());return r.aB(new Float32Array(16),h.projMatrix,u)}function Ca(h,t,s){if(t.projection.name===s.projection.name)return h.projMatrix;const u=s.clone();return u.setProjection(t.projection),Fo(u,t.getProjection(),h)}function ca(h,t,s){return t.name===s.projection.name?h.projMatrix:Fo(s,t,h)}class Qa{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aA(t,0,1);let s=1,u=this._distances[s];const m=t*this.paddedLength+this.padding;for(;u<m&&s<this._distances.length;)u=this._distances[++s];const g=s-1,x=this._distances[g],w=u-x,A=w>0?(m-x)/w:0;return this.points[g].mult(1-A).add(this.points[s].mult(A))}}class Ke{constructor(t,s,u){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(s/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,u,m,g){this._forEachCell(s,u,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(t,s,u,m){this._forEachCell(s-m,u-m,s+m,u+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(u),this.circles.push(m)}_insertBoxCell(t,s,u,m,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,u,m,g,x){this.circleCells[g].push(x)}_query(t,s,u,m,g,x){if(u<0||t>this.width||m<0||s>this.height)return!g&&[];const w=[];if(t<=0&&s<=0&&this.width<=u&&this.height<=m){if(g)return!0;for(let A=0;A<this.boxKeys.length;A++)w.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],D=this.circles[3*A+1],U=this.circles[3*A+2];w.push({key:this.circleKeys[A],x1:R-U,y1:D-U,x2:R+U,y2:D+U})}return x?w.filter(x):w}return this._forEachCell(t,s,u,m,this._queryCell,w,{hitTest:g,seenUids:{box:{},circle:{}}},x),g?w.length>0:w}_queryCircle(t,s,u,m,g){const x=t-u,w=t+u,A=s-u,R=s+u;if(w<0||x>this.width||R<0||A>this.height)return!m&&[];const D=[];return this._forEachCell(x,A,w,R,this._queryCellCircle,D,{hitTest:m,circle:{x:t,y:s,radius:u},seenUids:{box:{},circle:{}}},g),m?D.length>0:D}query(t,s,u,m,g){return this._query(t,s,u,m,!1,g)}hitTest(t,s,u,m,g){return this._query(t,s,u,m,!0,g)}hitTestCircle(t,s,u,m){return this._queryCircle(t,s,u,!0,m)}_queryCell(t,s,u,m,g,x,w,A){const R=w.seenUids,D=this.boxCells[g];if(D!==null){const F=this.bboxes;for(const V of D)if(!R.box[V]){R.box[V]=!0;const G=4*V;if(t<=F[G+2]&&s<=F[G+3]&&u>=F[G+0]&&m>=F[G+1]&&(!A||A(this.boxKeys[V]))){if(w.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[V],x1:F[G],y1:F[G+1],x2:F[G+2],y2:F[G+3]})}}}const U=this.circleCells[g];if(U!==null){const F=this.circles;for(const V of U)if(!R.circle[V]){R.circle[V]=!0;const G=3*V;if(this._circleAndRectCollide(F[G],F[G+1],F[G+2],t,s,u,m)&&(!A||A(this.circleKeys[V]))){if(w.hitTest)return x.push(!0),!0;{const Z=F[G],ie=F[G+1],J=F[G+2];x.push({key:this.circleKeys[V],x1:Z-J,y1:ie-J,x2:Z+J,y2:ie+J})}}}}}_queryCellCircle(t,s,u,m,g,x,w,A){const R=w.circle,D=w.seenUids,U=this.boxCells[g];if(U!==null){const V=this.bboxes;for(const G of U)if(!D.box[G]){D.box[G]=!0;const Z=4*G;if(this._circleAndRectCollide(R.x,R.y,R.radius,V[Z+0],V[Z+1],V[Z+2],V[Z+3])&&(!A||A(this.boxKeys[G])))return x.push(!0),!0}}const F=this.circleCells[g];if(F!==null){const V=this.circles;for(const G of F)if(!D.circle[G]){D.circle[G]=!0;const Z=3*G;if(this._circlesCollide(V[Z],V[Z+1],V[Z+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[G])))return x.push(!0),!0}}}_forEachCell(t,s,u,m,g,x,w,A){const R=this._convertToXCellCoord(t),D=this._convertToYCellCoord(s),U=this._convertToXCellCoord(u),F=this._convertToYCellCoord(m);for(let V=R;V<=U;V++)for(let G=D;G<=F;G++)if(g.call(this,t,s,u,m,this.xCellCount*G+V,x,w,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,u,m,g,x){const w=m-t,A=g-s,R=u+x;return R*R>w*w+A*A}_circleAndRectCollide(t,s,u,m,g,x,w){const A=(x-m)/2,R=Math.abs(t-(m+A));if(R>A+u)return!1;const D=(w-g)/2,U=Math.abs(s-(g+D));if(U>D+u)return!1;if(R<=A||U<=D)return!0;const F=R-A,V=U-D;return F*F+V*V<=u*u}}const Mt={unknown:0,flipRequired:1,flipNotRequired:2},Ai=Math.tan(85*Math.PI/180);function Ii(h,t,s,u,m,g,x){const w=r.bC();if(s)if(g.name==="globe"){const A=r.bD(m,t);r.aB(w,w,A)}else{const A=r.bE([],x);w[0]=A[0],w[1]=A[1],w[4]=A[2],w[5]=A[3],u||r.bB(w,w,m.angle)}else r.aB(w,m.labelPlaneMatrix,h);return w}function Xr(h,t,s,u,m,g,x){const w=Ii(h,t,s,u,m,g,x);return g.name==="globe"&&s||(w[2]=w[6]=w[10]=w[14]=0),w}function Un(h,t,s,u,m,g,x){if(s){if(g.name==="globe"){const w=Ii(h,t,s,u,m,g,x);return r.bl(w,w),r.aB(w,h,w),w}{const w=r.bz(h),A=r.bA([]);return A[0]=x[0],A[1]=x[1],A[4]=x[2],A[5]=x[3],r.aB(w,w,A),u||r.bB(w,w,-m.angle),w}}return m.glCoordMatrix}function wr(h,t,s,u){const m=[h,t,s,1];s?r.aC(m,m,u):va(m,m,u);const g=m[3];return m[0]/=g,m[1]/=g,m[2]/=g,m}function ys(h,t){return Math.min(.5+h/t*.5,1.5)}function Kr(h,t){const s=h[0]/h[3],u=h[1]/h[3];return s>=-t[0]&&s<=t[0]&&u>=-t[1]&&u<=t[1]}function _s(h,t,s,u,m,g,x,w,A,R){const D=s.transform,U=u?h.textSizeData:h.iconSizeData,F=r.bK(U,s.transform.zoom),V=D.projection.name==="globe",G=[256/s.width*2+1,256/s.height*2+1],Z=u?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;Z.clear();let ie=null;V&&(ie=u?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const J=h.lineVertexArray,ae=u?h.text.placedSymbolArray:h.icon.placedSymbolArray,me=s.transform.width/s.transform.height;let ye,Pe=!1;for(let Ae=0;Ae<ae.length;Ae++){const Me=ae.get(Ae),{numGlyphs:Ie,writingMode:Ee}=Me;if(Ee!==r.bL.vertical||Pe||ye===r.bL.horizontal||(Pe=!0),ye=Ee,(Me.hidden||Ee===r.bL.vertical)&&!Pe){Mi(Ie,Z);continue}Pe=!1;const Re=new r.P(Me.tileAnchorX,Me.tileAnchorY);let{x:nt,y:We,z:gt}=D.projection.projectTilePoint(Re.x,Re.y,R.canonical);if(A){const[Ut,Bi,Di]=A(Re);nt+=Ut,We+=Bi,gt+=Di}const et=[nt,We,gt,1];if(r.aC(et,et,t),!Kr(et,G)){Mi(Ie,Z);continue}const pt=et[3],Kt=ys(s.transform.getCameraToCenterDistance(D.projection),pt),it=r.bM(U,F,Me),Ve=x?it/Kt:it*Kt,bt=wr(nt,We,gt,m);if(bt[3]<=0){Mi(Ie,Z);continue}let ct={};const zt=r.an(h.layers[0].layout.get("text-max-angle")),Xt=Math.cos(zt),hi=x?null:A,qt=Cn(Me,Ve,!1,w,t,m,g,h.glyphOffsetArray,J,Z,ie,bt,Re,ct,me,hi,D.projection,R,x,Xt);Pe=qt.useVertical,hi&&qt.needsFlipping&&(ct={}),(qt.notEnoughRoom||Pe||qt.needsFlipping&&Cn(Me,Ve,!0,w,t,m,g,h.glyphOffsetArray,J,Z,ie,bt,Re,ct,me,hi,D.projection,R,x,Xt).notEnoughRoom)&&Mi(Ie,Z)}u?(h.text.dynamicLayoutVertexBuffer.updateData(Z),ie&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(ie)):(h.icon.dynamicLayoutVertexBuffer.updateData(Z),ie&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(ie))}function yo(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie){const{lineStartIndex:J,glyphStartIndex:ae,segment:me}=w,ye=ae+w.numGlyphs,Pe=J+w.lineLength,Ae=t.getoffsetX(ae),Me=t.getoffsetX(ye-1),Ie=Xo(h*Ae,s,u,m,g,x,me,J,Pe,A,R,D,U,F,!0,V,G,Z,ie);if(!Ie)return null;const Ee=Xo(h*Me,s,u,m,g,x,me,J,Pe,A,R,D,U,F,!0,V,G,Z,ie);return Ee?{first:Ie,last:Ee}:null}function Po(h,t,s,u){return h===r.bL.horizontal&&Math.abs(u)>Math.abs(s)?{useVertical:!0}:h===r.bL.vertical?u>0?{needsFlipping:!0}:null:t!==Mt.unknown&&(function(m,g){return m===0||Math.abs(g/m)>Ai})(s,u)?t===Mt.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Cn(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J,ae,me){const ye=t/24,Pe=h.lineOffsetX*ye,Ae=h.lineOffsetY*ye,{lineStartIndex:Me,glyphStartIndex:Ie,numGlyphs:Ee,segment:Re,writingMode:nt,flipState:We}=h,gt=Me+h.lineLength,et=pt=>{if(D){const[bt,ct,zt]=pt.up,Xt=R.length;r.bN(D,Xt+0,bt,ct,zt),r.bN(D,Xt+1,bt,ct,zt),r.bN(D,Xt+2,bt,ct,zt),r.bN(D,Xt+3,bt,ct,zt)}const[Kt,it,Ve]=pt.point;r.bO(R,Kt,it,Ve,pt.angle)};if(Ee>1){const pt=yo(ye,w,Pe,Ae,s,U,F,h,A,g,V,Z,!1,ie,J,ae,me);if(!pt)return{notEnoughRoom:!0};if(u&&!s){let[Kt,it,Ve]=pt.first.point,[bt,ct,zt]=pt.last.point;[Kt,it]=wr(Kt,it,Ve,x),[bt,ct]=wr(bt,ct,zt,x);const Xt=Po(nt,We,(bt-Kt)*G,ct-it);if(h.flipState=Xt&&Xt.needsFlipping?Mt.flipRequired:Mt.flipNotRequired,Xt)return Xt}et(pt.first);for(let Kt=Ie+1;Kt<Ie+Ee-1;Kt++){const it=Xo(ye*w.getoffsetX(Kt),Pe,Ae,s,U,F,Re,Me,gt,A,g,V,Z,!1,!1,ie,J,ae,me);if(!it)return R.length-=4*(Kt-Ie),{notEnoughRoom:!0};et(it)}et(pt.last)}else{if(u&&!s){const Kt=wr(F.x,F.y,0,m),it=Me+Re+1,Ve=new r.P(A.getx(it),A.gety(it)),bt=wr(Ve.x,Ve.y,0,m),ct=bt[3]>0?bt:So(F,Ve,Kt,1,m,void 0,ie,J.canonical),zt=Po(nt,We,(ct[0]-Kt[0])*G,ct[1]-Kt[1]);if(h.flipState=zt&&zt.needsFlipping?Mt.flipRequired:Mt.flipNotRequired,zt)return zt}const pt=Xo(ye*w.getoffsetX(Ie),Pe,Ae,s,U,F,Re,Me,gt,A,g,V,Z,!1,!1,ie,J,ae,me);if(!pt)return{notEnoughRoom:!0};et(pt)}return{}}function Co(h,t,s,u,m){const{x:g,y:x,z:w}=u.projectTilePoint(h.x,h.y,t);if(!m)return wr(g,x,w,s);const[A,R,D]=m(h);return wr(g+A,x+R,w+D,s)}function So(h,t,s,u,m,g,x,w){const A=Co(h.sub(t)._unit()._add(h),w,m,x,g);return r.av(A,s,A),r.aw(A,A),r.bH(A,s,A,u)}function Xo(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J,ae){const me=u?h-t:h+t;let ye=me>0?1:-1,Pe=0;u&&(ye*=-1,Pe=Math.PI),ye<0&&(Pe+=Math.PI);let Ae=w+x+(ye>0?0:1)|0,Me=m,Ie=m,Ee=0,Re=0;const nt=Math.abs(me),We=[],gt=[];let et=g,pt=et,Kt=r.bF([]);const it=()=>So(pt,et,Ie,nt-Ee+1,D,F,Z,ie.canonical);for(;Ee+Re<=nt;){if(Ae+=ye,Ae<w||Ae>=A)return null;if(Ie=Me,pt=et,We.push(Ie),V&&gt.push(pt),et=new r.P(R.getx(Ae),R.gety(Ae)),Me=U[Ae],!Me){const Di=Co(et,ie.canonical,D,Z,F);Me=Di[3]>0?U[Ae]=Di:it()}Ee+=Re;const Ut=r.av([],Me,Ie),Bi=r.bG(Ie,Me);if(s&&Bi>0&&Re>0&&r.bJ(Kt,Ut)/(Re*Bi)<ae)return null;Re=Bi,Kt=Ut}G&&F&&(U[Ae]&&(Me=it(),Re=r.bG(Ie,Me),Kt=r.av([],Me,Ie)),U[Ae]=Me);const Ve=(nt-Ee)/Re,bt=et.sub(pt)._mult(Ve)._add(pt),ct=r.bH([],Ie,Kt,Ve);let zt=[0,0,1],Xt=Kt[0],hi=Kt[1];if(J&&(zt=Z.upVector(ie.canonical,bt.x,bt.y),zt[0]!==0||zt[1]!==0||zt[2]!==1)){const Ut=[zt[2],0,-zt[0]],Bi=r.bI([],zt,Ut);r.aw(Ut,Ut),r.aw(Bi,Bi),Xt=r.bJ(Kt,Ut),hi=r.bJ(Kt,Bi)}if(s){const Ut=r.bI([],zt,Kt);r.aw(Ut,Ut),r.bH(ct,ct,Ut,s*ye)}const qt=Pe+Math.atan2(hi,Xt);return We.push(ct),V&&gt.push(bt),{point:ct,angle:qt,path:We,tilePath:gt,up:zt}}function Mi(h,t){const s=t.length,u=s+4*h;t.resize(u),t.float32.fill(-1/0,4*s,4*u)}function va(h,t,s){const u=t[0],m=t[1];return h[0]=s[0]*u+s[4]*m+s[12],h[1]=s[1]*u+s[5]*m+s[13],h[3]=s[3]*u+s[7]*m+s[15],h}const Eo=100;class Fs{constructor(t,s,u=new Ke(t.width+200,t.height+200,25),m=new Ke(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Eo,this.screenBottomBoundary=t.height+Eo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,u,m,g,x,w,A,R,D,U){let F=u.projectedAnchorX,V=u.projectedAnchorY,G=u.projectedAnchorZ;const Z=u.tileAnchorX,ie=u.tileAnchorY,J=u.elevation,ae=u.tileID,me=t.getProjection();if(J&&ae){const[gt,et,pt]=me.upVector(ae.canonical,u.tileAnchorX,u.tileAnchorY),Kt=me.upVectorScale(ae.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=gt*J*Kt,V+=et*J*Kt,G+=pt*J*Kt}const ye=t.projection.name==="globe",Pe=t.projection.name==="globe"?r.aj(this.transform.zoom):0;if(ae&&ye&&Pe<1&&!x){const gt=1<<ae.canonical.z,et=r.bP(Z,ie);r.bQ(et,et,1/r.al),r.bR(et,et,r.bP(ae.canonical.x,ae.canonical.y)),r.bQ(et,et,1/gt),r.bS(et,et,r.bP(m[0],m[1])),et[0]=r.bT(et[0],-.5,.5),r.bQ(et,et,r.al);const pt=r.bU(et[0],et[1],r.al/(2*Math.PI),1);r.aC(pt,pt,g),F=r.ak(F,pt[0],Pe),V=r.ak(V,pt[1],Pe),G=r.ak(G,pt[2],Pe)}const Ae=this.projectAndGetPerspectiveRatio(D,F,V,G,u.tileID,me.name==="globe"||!!J||this.transform.pitch>0,me),Me=R*Ae.perspectiveRatio,Ie=(u.x1*s+w.x-u.padding)*Me+Ae.point.x,Ee=(u.y1*s+w.y-u.padding)*Me+Ae.point.y,Re=(u.x2*s+w.x+u.padding)*Me+Ae.point.x,nt=(u.y2*s+w.y+u.padding)*Me+Ae.point.y,We=Ae.perspectiveRatio<=.55||Ae.occluded;return!this.isInsideGrid(Ie,Ee,Re,nt)||!A&&this.grid.hitTest(Ie,Ee,Re,nt,U)||We?{box:[],offscreen:!1,occluded:Ae.occluded}:{box:[Ie,Ee,Re,nt],offscreen:this.isOffscreen(Ie,Ee,Re,nt),occluded:!1}}placeCollisionCircles(t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z){const ie=[],J=this.transform.elevation,ae=t.getProjection(),me=J?J.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,ae):null,ye=new r.P(u.tileAnchorX,u.tileAnchorY);let{x:Pe,y:Ae,z:Me}=ae.projectTilePoint(ye.x,ye.y,Z.canonical);if(me){const[zt,Xt,hi]=me(ye);Pe+=zt,Ae+=Xt,Me+=hi}const Ie=ae.name==="globe",Ee=this.projectAndGetPerspectiveRatio(w,Pe,Ae,Me,Z,Ie||!!J||this.transform.pitch>0,ae),{perspectiveRatio:Re}=Ee,nt=(U?x/Re:x*Re)/r.bX,We=wr(Pe,Ae,Me,A),gt=u.lineOffsetX*nt,et=u.lineOffsetY*nt,pt=r.an(t.layers[0].layout.get("text-max-angle")),Kt=Math.cos(pt),it=Ee.signedDistanceFromCamera>0?yo(nt,g,gt,et,!1,We,ye,u,m,A,{},J&&!U?me:null,U&&!!J,ae,Z,U,Kt):null;let Ve=!1,bt=!1,ct=!0;if(it&&!Ee.occluded){const zt=.5*V*Re+G,Xt=new r.P(-100,-100),hi=new r.P(this.screenRightBoundary,this.screenBottomBoundary),qt=new Qa,{first:Ut,last:Bi}=it,Di=Ut.path.length;let Fi=[];for(let xn=Di-1;xn>=1;xn--)Fi.push(Ut.path[xn]);for(let xn=1;xn<Bi.path.length;xn++)Fi.push(Bi.path[xn]);const Ri=2.5*zt;R&&(Fi=Fi.map((([xn,wn,gr],hn)=>(me&&!Ie&&(gr=me(hn<Di-1?Ut.tilePath[Di-1-hn]:Bi.tilePath[hn-Di+2])[2]),wr(xn,wn,gr,R)))),Fi.some((xn=>xn[3]<=0))&&(Fi=[]));let on=[];if(Fi.length>0){let xn=1/0,wn=-1/0,gr=1/0,hn=-1/0;for(const nr of Fi)xn=Math.min(xn,nr[0]),gr=Math.min(gr,nr[1]),wn=Math.max(wn,nr[0]),hn=Math.max(hn,nr[1]);wn>=Xt.x&&xn<=hi.x&&hn>=Xt.y&&gr<=hi.y&&(on=[Fi.map((nr=>new r.P(nr[0],nr[1])))],(xn<Xt.x||wn>hi.x||gr<Xt.y||hn>hi.y)&&(on=r.bV(on,Xt.x,Xt.y,hi.x,hi.y)))}for(const xn of on){qt.reset(xn,.25*zt);let wn=0;wn=qt.length<=.5*zt?1:Math.ceil(qt.paddedLength/Ri)+1;for(let gr=0;gr<wn;gr++){const hn=gr/Math.max(wn-1,1),nr=qt.lerp(hn),mr=nr.x+Eo,Hr=nr.y+Eo;ie.push(mr,Hr,zt,0);const bn=mr-zt,ur=Hr-zt,lr=mr+zt,dr=Hr+zt;if(ct=ct&&this.isOffscreen(bn,ur,lr,dr),bt=bt||this.isInsideGrid(bn,ur,lr,dr),!s&&this.grid.hitTestCircle(mr,Hr,zt,F)&&(Ve=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!D&&Ve||!bt?[]:ie,offscreen:ct,collisionDetected:Ve,occluded:Ee.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let u=1/0,m=1/0,g=-1/0,x=-1/0;for(const D of t){const U=new r.P(D.x+Eo,D.y+Eo);u=Math.min(u,U.x),m=Math.min(m,U.y),g=Math.max(g,U.x),x=Math.max(x,U.y),s.push(U)}const w=this.grid.query(u,m,g,x).concat(this.ignoredGrid.query(u,m,g,x)),A={},R={};for(const D of w){const U=D.key;if(A[U.bucketInstanceId]===void 0&&(A[U.bucketInstanceId]={}),A[U.bucketInstanceId][U.featureIndex])continue;const F=[new r.P(D.x1,D.y1),new r.P(D.x2,D.y1),new r.P(D.x2,D.y2),new r.P(D.x1,D.y2)];r.bW(s,F)&&(A[U.bucketInstanceId][U.featureIndex]=!0,R[U.bucketInstanceId]===void 0&&(R[U.bucketInstanceId]=[]),R[U.bucketInstanceId].push(U.featureIndex))}return R}insertCollisionBox(t,s,u,m,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:m,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,u,m,g){const x=s?this.ignoredGrid:this.grid,w={bucketInstanceId:u,featureIndex:m,collisionGroupID:g};for(let A=0;A<t.length;A+=4)x.insertCircle(w,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,s,u,m,g,x,w){const A=[s,u,m,1];let R=!1;m||this.transform.pitch>0?(r.aC(A,A,t),this.fogState&&g&&w.name!=="globe"&&(R=(function(F,V,G,Z,ie,J){const ae=J.calculateFogTileMatrix(ie),me=[V,G,Z];return r.af(me,me,ae),qi(F,r.ag(me),J.pitch,J._fov)})(this.fogState,s,u,m,g.toUnwrapped(),this.transform)>.9)):va(A,A,t);const D=A[3];return{point:new r.P((A[0]/D+1)/2*this.transform.width+Eo,(-A[1]/D+1)/2*this.transform.height+Eo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/D*.5,1.5),signedDistanceFromCamera:D,occluded:x&&A[2]>D||R}}isOffscreen(t,s,u,m){return u<Eo||t>=this.screenRightBoundary||m<Eo||s>this.screenBottomBoundary}isInsideGrid(t,s,u,m){return u>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=r.bA([]);return r.br(t,t,[-100,-100,0]),t}}class Ma{constructor(t,s,u,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class xa{constructor(t,s,u,m,g,x=!1){this.text=new Ma(t?t.text:null,s,u,g),this.icon=new Ma(t?t.icon:null,s,m,g),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Oi{constructor(t,s,u,m=!1){this.text=t,this.icon=s,this.skipFade=u,this.clipped=m}}class or{constructor(){this.invProjMatrix=r.bC(),this.viewportMatrix=r.bC(),this.circles=[]}}class ar{constructor(t,s,u,m,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=m,this.tileID=g}}class Yr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[t]}}function ja(h,t,s,u,m){const{horizontalAlign:g,verticalAlign:x}=r.c0(h),w=-(g-.5)*t,A=-(x-.5)*s,R=r.c1(h,u);return new r.P(w+R[0]*m,A+R[1]*m)}function tr(h,t,s,u,m){const g=new r.P(h,t);return s&&g._rotate(u?m:-m),g}class ce{constructor(t,s,u,m,g,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Fs(this.transform,g),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Yr(u),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,u,m,g=1){const x=u.getBucket(s),w=u.latestFeatureIndex;if(!x||!w||s.fqid!==x.layerIds[0])return;const A=x.layers[0].layout,R=x.layers[0].paint,D=u.collisionBoxArray,U=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),F=u.tileSize/r.al,V=u.tileID.toUnwrapped();this.transform.setProjection(x.projection);const G=(Z=u.tileID,ie=x.getProjection(),J=this.transform,ie.name===this.projection?J.calculateProjMatrix(Z.toUnwrapped()):Fo(J,ie,Z));var Z,ie,J;const ae=A.get("text-pitch-alignment")==="map",me=A.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const ye=s.dynamicFilter(),Pe=s.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(u),Me=Xr(G,u.tileID.canonical,ae,me,this.transform,x.getProjection(),Ae);let Ie=null;const Ee=x.getProjection().createInversionMatrix(this.transform,u.tileID.canonical);if(ae){const Ve=Un(G,u.tileID.canonical,ae,me,this.transform,x.getProjection(),Ae);Ie=r.aB([],this.transform.labelPlaneMatrix,Ve)}let Re=null;ye&&u.latestFeatureIndex&&(Re={unwrappedTileID:V,dynamicFilter:ye,dynamicFilterNeedsFeature:Pe}),this.retainedQueryData[x.bucketInstanceId]=new ar(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,u.tileID);const[nt,We]=x.layers[0].layout.get("text-size-scale-range"),gt=r.aA(g,nt,We),[et,pt]=A.get("icon-size-scale-range"),Kt=r.aA(g,et,pt),it={bucket:x,layout:A,paint:R,posMatrix:G,invMatrix:Ee,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Me,labelToScreenMatrix:Ie,clippingData:Re,scale:U,textPixelRatio:F,holdingForFade:u.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:r.bK(x.textSizeData,this.transform.zoom,gt),partiallyEvaluatedIconSize:r.bK(x.iconSizeData,this.transform.zoom,Kt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(m)for(const Ve of x.sortKeyRanges){const{sortKey:bt,symbolInstanceStart:ct,symbolInstanceEnd:zt}=Ve;t.push({sortKey:bt,symbolInstanceStart:ct,symbolInstanceEnd:zt,parameters:it})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:it})}attemptAnchorPlacement(t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J,ae,me,ye,Pe){const{textOffset0:Ae,textOffset1:Me,crossTileID:Ie}=Z,Ee=[Ae,Me],Re=ja(t,x,w,Ee,A),nt=this.collisionIndex.placeCollisionBox(J,A,s,u,m,g,tr(Re.x,Re.y,R,D,this.transform.angle),G,U,F,V.predicate);if(me){const We=J.getSymbolInstanceIconSize(Pe,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,We,me,u,m,g,tr(Re.x,Re.y,R,D,this.transform.angle),G,U,F,V.predicate).box.length===0)return}if(nt.box.length>0){let We;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ie]&&this.prevPlacement.placements[Ie]&&this.prevPlacement.placements[Ie].text&&(We=this.prevPlacement.variableOffsets[Ie].anchor),this.variableOffsets[Ie]={textOffset:Ee,width:x,height:w,anchor:t,textScale:A,prevAnchor:We},this.markUsedJustification(J,t,Z,ae),J.allowVerticalPlacement&&(this.markUsedOrientation(J,ae,Z),this.placedOrientations[Ie]=ae),{shift:Re,placedGlyphBoxes:nt}}}placeLayerBucketPart(t,s,u,m,g=1){const{bucket:x,layout:w,paint:A,posMatrix:R,textLabelPlaneMatrix:D,labelToScreenMatrix:U,clippingData:F,textPixelRatio:V,mercatorCenter:G,invMatrix:Z,holdingForFade:ie,collisionBoxArray:J,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:me,collisionGroup:ye,latestFeatureIndex:Pe}=t.parameters,Ae=w.get("text-optional"),Me=w.get("icon-optional"),Ie=w.get("text-allow-overlap"),Ee=w.get("icon-allow-overlap"),Re=w.get("text-rotation-alignment")==="map",nt=w.get("icon-rotation-alignment")==="map",We=w.get("text-pitch-alignment")==="map",gt=A.get("symbol-z-offset"),et=w.get("symbol-elevation-reference")==="sea",pt=w.get("symbol-placement"),[Kt,it]=w.get("text-size-scale-range"),[Ve,bt]=w.get("icon-size-scale-range"),ct=r.aA(g,Kt,it),zt=r.aA(g,Ve,bt),Xt=w.get("text-variable-anchor"),hi=Re&&pt!=="point",qt=nt&&pt!=="point",Ut=Xt&&x.hasTextData(),Bi=x.hasIconTextFit()&&Ut&&x.hasIconData();this.transform.setProjection(x.projection);const Di=Ut||hi,Fi=qt||Bi;let Ri=Ie&&(Ee||!x.hasIconData()||Me),on=Ee&&(Ie||!x.hasTextData()||Ae);const xn=!gt.isConstant();!x.collisionArrays&&J&&x.deserializeCollisionBoxes(J),u&&m&&x.updateCollisionDebugBuffers(this.transform.zoom,J,ct,zt);const wn=(hn,nr,mr)=>{const{crossTileID:Hr,numVerticalGlyphVertices:bn}=hn;let ur=null;if(F&&F.dynamicFilterNeedsFeature||xn){const Is=this.retainedQueryData[x.bucketInstanceId];ur=Pe.loadFeature({featureIndex:hn.featureIndex,bucketIndex:Is.bucketIndex,sourceLayerIndex:Is.sourceLayerIndex,layoutVertexArrayOffset:0})}if(F&&!(0,F.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ur,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new r.P(hn.tileAnchorX,hn.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Hr]=new Oi(!1,!1,!1,!0),void s.add(Hr);const lr=gt.evaluate(ur,{});if(s.has(Hr))return;if(ie)return void(this.placements[Hr]=new Oi(!1,!1,!1));let dr=!1,Qr=!1,Cs=!0,vo=!1,es=!1,Tn=null,nn={box:null,offscreen:null,occluded:null},yr={box:null},bs=null,os=null,Zs=null,Oo=0,Ha=0,Za=0;mr.textFeatureIndex?Oo=mr.textFeatureIndex:hn.useRuntimeCollisionCircles&&(Oo=hn.featureIndex),mr.verticalTextFeatureIndex&&(Ha=mr.verticalTextFeatureIndex);const Da=Is=>{Is.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Ms=this.transform.elevation;Is.elevation=et?lr:lr+(Ms?Ms.getAtTileOffset(Is.tileID,Is.tileAnchorX,Is.tileAnchorY):0),Is.elevation+=hn.zOffset},za=mr.textBox;if(za){Da(za);const Is=as=>{let to=r.bL.horizontal;if(x.allowVerticalPlacement&&!as&&this.prevPlacement){const xo=this.prevPlacement.placedOrientations[Hr];xo&&(this.placedOrientations[Hr]=xo,to=xo,this.markUsedOrientation(x,to,hn))}return to},Ms=(as,to)=>{if(x.allowVerticalPlacement&&bn>0&&mr.verticalTextBox){for(const xo of x.writingModes)if(xo===r.bL.vertical?(nn=to(),yr=nn):nn=as(),nn&&nn.box&&nn.box.length)break}else nn=as()};if(Xt){let as=Xt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Hr]){const Us=this.prevPlacement.variableOffsets[Hr];as.indexOf(Us.anchor)>0&&(as=as.filter((qo=>qo!==Us.anchor)),as.unshift(Us.anchor))}const to=(Us,qo,Nl)=>{const cc=x.getSymbolInstanceTextSize(ae,hn,this.transform.zoom,nr),xl=(Us.x2-Us.x1)*cc+2*Us.padding,jc=(Us.y2-Us.y1)*cc+2*Us.padding,$c=hn.hasIconTextFit&&!Ee?qo:null;$c&&Da($c);let Ul={box:[],offscreen:!1,occluded:!1};const Ah=Ie?2*as.length:as.length;for(let uc=0;uc<Ah;++uc){const Vl=this.attemptAnchorPlacement(as[uc%as.length],Us,G,Z,Di,xl,jc,cc,Re,We,V,R,ye,uc>=as.length,hn,nr,x,Nl,$c,ae,me);if(Vl&&(Ul=Vl.placedGlyphBoxes,Ul&&Ul.box&&Ul.box.length)){dr=!0,Tn=Vl.shift;break}}return Ul};Ms((()=>to(za,mr.iconBox,r.bL.horizontal)),(()=>{const Us=mr.verticalTextBox;return Us&&Da(Us),x.allowVerticalPlacement&&!(nn&&nn.box&&nn.box.length)&&bn>0&&Us?to(Us,mr.verticalIconBox,r.bL.vertical):{box:null,offscreen:null,occluded:null}})),nn&&(dr=nn.box,Cs=nn.offscreen,vo=nn.occluded);const xo=Is(!(!nn||!nn.box));if(!dr&&this.prevPlacement){const Us=this.prevPlacement.variableOffsets[Hr];Us&&(this.variableOffsets[Hr]=Us,this.markUsedJustification(x,Us.anchor,hn,xo))}}else{const as=(to,xo)=>{const Us=x.getSymbolInstanceTextSize(ae,hn,this.transform.zoom,nr),qo=this.collisionIndex.placeCollisionBox(x,Us,to,G,Z,Di,new r.P(0,0),Ie,V,R,ye.predicate);return qo&&qo.box&&qo.box.length&&(this.markUsedOrientation(x,xo,hn),this.placedOrientations[Hr]=xo),qo};Ms((()=>as(za,r.bL.horizontal)),(()=>{const to=mr.verticalTextBox;return x.allowVerticalPlacement&&bn>0&&to?(Da(to),as(to,r.bL.vertical)):{box:null,offscreen:null,occluded:null}})),Is(!!(nn&&nn.box&&nn.box.length))}}if(bs=nn,dr=bs&&bs.box&&bs.box.length>0,Cs=bs&&bs.offscreen,vo=bs&&bs.occluded,hn.useRuntimeCollisionCircles){const Is=x.text.placedSymbolArray.get(hn.centerJustifiedTextSymbolIndex>=0?hn.centerJustifiedTextSymbolIndex:hn.verticalPlacedTextSymbolIndex),Ms=r.bM(x.textSizeData,ae,Is),as=w.get("text-padding");os=this.collisionIndex.placeCollisionCircles(x,Ie,Is,x.lineVertexArray,x.glyphOffsetArray,Ms,R,D,U,u,We,ye.predicate,hn.collisionCircleDiameter*Ms/r.bX,as,this.retainedQueryData[x.bucketInstanceId].tileID),dr=Ie||os.circles.length>0&&!os.collisionDetected,Cs=Cs&&os.offscreen,vo=os.occluded}if(mr.iconFeatureIndex&&(Za=mr.iconFeatureIndex),mr.iconBox){const Is=Ms=>{Da(Ms);const as=hn.hasIconTextFit&&Tn?tr(Tn.x,Tn.y,Re,We,this.transform.angle):new r.P(0,0),to=x.getSymbolInstanceIconSize(me,this.transform.zoom,hn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,to,Ms,G,Z,Fi,as,Ee,V,R,ye.predicate)};yr&&yr.box&&yr.box.length&&mr.verticalIconBox?(Zs=Is(mr.verticalIconBox),Qr=Zs.box.length>0):(Zs=Is(mr.iconBox),Qr=Zs.box.length>0),Cs=Cs&&Zs.offscreen,es=Zs.occluded}const pa=Ae||hn.numHorizontalGlyphVertices===0&&bn===0,ol=Me||hn.numIconVertices===0;if(pa||ol?ol?pa||(Qr=Qr&&dr):dr=Qr&&dr:Qr=dr=Qr&&dr,dr&&bs&&bs.box&&this.collisionIndex.insertCollisionBox(bs.box,w.get("text-ignore-placement"),x.bucketInstanceId,yr&&yr.box&&Ha?Ha:Oo,ye.ID),Qr&&Zs&&this.collisionIndex.insertCollisionBox(Zs.box,w.get("icon-ignore-placement"),x.bucketInstanceId,Za,ye.ID),os&&(dr&&this.collisionIndex.insertCollisionCircles(os.circles,w.get("text-ignore-placement"),x.bucketInstanceId,Oo,ye.ID),u)){const Is=x.bucketInstanceId;let Ms=this.collisionCircleArrays[Is];Ms===void 0&&(Ms=this.collisionCircleArrays[Is]=new or);for(let as=0;as<os.circles.length;as+=4)Ms.circles.push(os.circles[as+0]),Ms.circles.push(os.circles[as+1]),Ms.circles.push(os.circles[as+2]),Ms.circles.push(os.collisionDetected?1:0)}const vl=x.projection.name!=="globe";Ri=Ri&&(vl||!vo),on=on&&(vl||!es),this.placements[Hr]=new Oi(dr||Ri,Qr||on,Cs||x.justReloaded),s.add(Hr)},gr=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,gr),x.elevationType==="road"&&x.updateRoadElevation(gr.canonical),x.updateZOffset(),x.sortFeaturesByY){const hn=x.getSortedSymbolIndexes(this.transform.angle);for(let nr=hn.length-1;nr>=0;--nr){const mr=hn[nr];wn(x.symbolInstances.get(mr),mr,x.collisionArrays[mr])}x.hasAnyZOffset&&r.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const hn=x.getSortedIndexesByZOffset();for(let nr=0;nr<hn.length;++nr){const mr=hn[nr];wn(x.symbolInstances.get(mr),mr,x.collisionArrays[mr])}}else for(let hn=t.symbolInstanceStart;hn<t.symbolInstanceEnd;hn++)wn(x.symbolInstances.get(hn),hn,x.collisionArrays[hn]);if(u&&x.bucketInstanceId in this.collisionCircleArrays){const hn=this.collisionCircleArrays[x.bucketInstanceId];r.bl(hn.invProjMatrix,R),hn.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,s,u,m){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:A,crossTileID:R}=u,D=r.c2(s),U=m===r.bL.vertical?A:D==="left"?g:D==="center"?x:D==="right"?w:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=U>=0&&g!==U?0:R),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:R),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=U>=0&&w!==U?0:R),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:R)}markUsedOrientation(t,s,u){const m=s===r.bL.horizontal||s===r.bL.horizontalOnly?s:0,g=s===r.bL.vertical?s:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R}=u,D=t.text.placedSymbolArray;x>=0&&(D.get(x).placedOrientation=m),w>=0&&(D.get(w).placedOrientation=m),A>=0&&(D.get(A).placedOrientation=m),R>=0&&(D.get(R).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],D=g[A];D?(this.opacities[A]=new xa(D,m,R.text,R.icon,null,R.clipped),u=u||R.text!==D.text.placed||R.icon!==D.icon.placed):(this.opacities[A]=new xa(null,m,R.text,R.icon,R.skipFade,R.clipped),u=u||R.text||R.icon)}for(const A in g){const R=g[A];if(!this.opacities[A]){const D=new xa(R,m,!1,!1);D.isHidden()||(this.opacities[A]=D,u=u||R.text.placed||R.icon.placed)}}for(const A in x)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=x[A]);for(const A in w)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=w[A]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,u,m){const g=new Set;for(const x of s){const w=x.getBucket(t);w&&x.latestFeatureIndex&&t.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,g,x,x.collisionBoxArray,u,m,x.tileID,t.scope),w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,x.tileID),w.elevationType==="road"&&w.updateRoadElevation(x.tileID.canonical),w.updateZOffset())}}updateBucketOpacities(t,s,u,m,g,x,w,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const R=t.layers[0].layout,D=t.layers[0].paint,U=!!t.layers[0].dynamicFilter(),F=new xa(null,0,!1,!1,!0),V=R.get("text-allow-overlap"),G=R.get("icon-allow-overlap"),Z=R.get("text-variable-anchor"),ie=R.get("text-rotation-alignment")==="map",J=R.get("text-pitch-alignment")==="map",ae=D.get("symbol-z-offset"),me=R.get("symbol-elevation-reference")==="sea",ye=!ae.isConstant(),Pe=new xa(null,0,V&&(G||!t.hasIconData()||R.get("icon-optional")),G&&(V||!t.hasTextData()||R.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const Ae=(Ie,Ee,Re)=>{for(let nt=0;nt<Ee/4;nt++)Ie.opacityVertexArray.emplaceBack(Re)};let Me=0;x&&t.updateReplacement(w,x);for(let Ie=0;Ie<t.symbolInstances.length;Ie++){const Ee=t.symbolInstances.get(Ie),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:nt,crossTileID:We,numIconVertices:gt,tileAnchorX:et,tileAnchorY:pt}=Ee;let Kt=null;const it=this.retainedQueryData[t.bucketInstanceId];ye&&Ee&&it&&(Kt=u.latestFeatureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:it.bucketIndex,sourceLayerIndex:it.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ve=ae.evaluate(Kt,{}),bt=s.has(We);let ct=this.opacities[We];bt?ct=F:ct||(ct=Pe,this.opacities[We]=ct),s.add(We);const zt=Re>0||nt>0,Xt=gt>0,hi=this.placedOrientations[We],qt=hi===r.bL.vertical,Ut=hi===r.bL.horizontal||hi===r.bL.horizontalOnly;!zt&&!Xt||ct.isHidden()||Me++;let Bi=!1;if((zt||Xt)&&x)for(const Di of t.activeReplacements){if(r.bY(Di,g,r.bZ.Symbol,A)||Di.min.x>et||et>Di.max.x||Di.min.y>pt||pt>Di.max.y)continue;const Fi=r.b_(et,pt,w.canonical,Di.footprintTileId.canonical);if(Bi=r.b$(Fi,Di.footprint),Bi)break}if(zt){const Di=Bi?Pr:Ir(ct.text);Ae(t.text,Re,qt?Pr:Di),Ae(t.text,nt,Ut?Pr:Di);const Fi=ct.text.isHidden(),{leftJustifiedTextSymbolIndex:Ri,centerJustifiedTextSymbolIndex:on,rightJustifiedTextSymbolIndex:xn,verticalPlacedTextSymbolIndex:wn}=Ee,gr=t.text.placedSymbolArray,hn=Fi||qt?1:0;Ri>=0&&(gr.get(Ri).hidden=hn),on>=0&&(gr.get(on).hidden=hn),xn>=0&&(gr.get(xn).hidden=hn),wn>=0&&(gr.get(wn).hidden=Fi||Ut?1:0);const nr=this.variableOffsets[We];nr&&this.markUsedJustification(t,nr.anchor,Ee,hi);const mr=this.placedOrientations[We];mr&&(this.markUsedJustification(t,"left",Ee,mr),this.markUsedOrientation(t,mr,Ee))}if(Xt){const Di=Bi?Pr:Ir(ct.icon),{placedIconSymbolIndex:Fi,verticalPlacedIconSymbolIndex:Ri}=Ee,on=t.icon.placedSymbolArray,xn=ct.icon.isHidden()?1:0;Fi>=0&&(Ae(t.icon,gt,qt?Pr:Di),on.get(Fi).hidden=xn),Ri>=0&&(Ae(t.icon,Ee.numVerticalIconVertices,Ut?Pr:Di),on.get(Ri).hidden=xn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Di=t.collisionArrays[Ie];if(Di){let Fi=new r.P(0,0),Ri=!0;if(Di.textBox||Di.verticalTextBox){if(Z){const xn=this.variableOffsets[We];xn?(Fi=ja(xn.anchor,xn.width,xn.height,xn.textOffset,xn.textScale),ie&&Fi._rotate(J?this.transform.angle:-this.transform.angle)):Ri=!1}U&&(Ri=!ct.clipped),Di.textBox&&q(t.textCollisionBox.collisionVertexArray,ct.text.placed,!Ri||qt,Ve,me,Fi.x,Fi.y),Di.verticalTextBox&&q(t.textCollisionBox.collisionVertexArray,ct.text.placed,!Ri||Ut,Ve,me,Fi.x,Fi.y)}const on=Ri&&!!(!Ut&&Di.verticalIconBox);Di.iconBox&&q(t.iconCollisionBox.collisionVertexArray,ct.icon.placed,on,Ve,me,Ee.hasIconTextFit?Fi.x:0,Ee.hasIconTextFit?Fi.y:0),Di.verticalIconBox&&q(t.iconCollisionBox.collisionVertexArray,ct.icon.placed,!on,Ve,me,Ee.hasIconTextFit?Fi.x:0,Ee.hasIconTextFit?Fi.y:0)}}}if(t.fullyClipped=Me===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Ie=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Ie.invProjMatrix,t.placementViewportMatrix=Ie.viewportMatrix,t.collisionCircleArray=Ie.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function q(h,t,s,u,m,g,x){h.emplaceBack(t?1:0,s?1:0,g||0,x||0,u,m?1:0),h.emplaceBack(t?1:0,s?1:0,g||0,x||0,u,m?1:0),h.emplaceBack(t?1:0,s?1:0,g||0,x||0,u,m?1:0),h.emplaceBack(t?1:0,s?1:0,g||0,x||0,u,m?1:0)}const re=Math.pow(2,25),Ne=Math.pow(2,24),Qe=Math.pow(2,17),fi=Math.pow(2,16),Zi=Math.pow(2,9),vn=Math.pow(2,8),Bn=Math.pow(2,1);function Ir(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,s=Math.floor(127*h.opacity);return s*re+t*Ne+s*Qe+t*fi+s*Zi+t*vn+s*Bn+t}const Pr=0;class Bs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,u,m,g,x){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(w,m,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(((A,R)=>A.sortKey-R.sortKey)));this._currentPartIndex<w.length;){const A=w[this._currentPartIndex];if(s.placeLayerBucketPart(A,this._seenCrossTileIDs,u,A.symbolInstanceStart===0,x),this._currentPartIndex++,g())return!0}return!1}}class Ks{constructor(t,s,u,m,g,x,w,A,R){this.placement=new ce(t,g,x,w,A,R),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,u,m,g){const x=r.o.now(),w=()=>{const A=r.o.now()-x;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=s[t[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=R)&&(!A.maxzoom||A.maxzoom>R)){const D=A,U=D.layout.get("symbol-z-elevate"),F=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,V=D.layout.get("symbol-z-order"),G=V==="viewport-y"||V==="auto"&&!(V!=="viewport-y"&&F),Z=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),ie=G&&Z,J=this._inProgressLayer=this._inProgressLayer||new Bs(D),ae=r.B(A.source,A.scope);if(J.continuePlacement(U||ie?m[ae]:u[ae],this.placement,this._showCollisionBoxes,A,w,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ko=512/r.al/2;class Mo{constructor(t,s,u){this.tileID=t,this.bucketInstanceId=u,this.index=new r.c3(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*r.al,g=t.canonical.y*r.al;for(let x=0;x<s.length;x++){const{key:w,crossTileID:A,tileAnchorX:R,tileAnchorY:D}=s.get(x),U=Math.floor((m+R)*Ko),F=Math.floor((g+D)*Ko);this.index.add(U,F),this.keys.push(w),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,s,u){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),g=Ko/Math.pow(2,s.canonical.z-this.tileID.canonical.z),x=s.canonical.x*r.al,w=s.canonical.y*r.al;for(let A=0;A<t.length;A++){const R=t.get(A);if(R.crossTileID)continue;const{key:D,tileAnchorX:U,tileAnchorY:F}=R,V=Math.floor((x+U)*g),G=Math.floor((w+F)*g),Z=this.index.range(V-m,G-m,V+m,G+m).sort(((ie,J)=>ie-J));for(const ie of Z){const J=this.crossTileIDs[ie];if(this.keys[ie]===D&&!u.has(J)){u.add(J),R.crossTileID=J;break}}}}}class nh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class el{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const u in this.indexes){const m=this.indexes[u],g={};for(const x in m){const w=m[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),g[w.tileID.key]=w}this.indexes[u]=g}this.lng=t}addBucket(t,s,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const w in x){const A=x[w];A.tileID.isChildOf(t)&&A.findMatches(s.symbolInstances,t,m)}else{const w=x[t.scaledTo(Number(g)).key];w&&w.findMatches(s.symbolInstances,t,m)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=u.generate(),m.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Mo(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const u of s.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let s=!1;for(const u in this.indexes){const m=this.indexes[u];for(const g in m)t[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,m[g]),delete m[g],s=!0)}return s}}class $s{constructor(){this.layerIndexes={},this.crossTileIDs=new nh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,u,m){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new el);let x=!1;const w={};m.name!=="globe"&&g.handleWrapJump(u);for(const A of s){const R=A.getBucket(t);R&&t.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(A.tileID,R,this.crossTileIDs)&&(x=!0),w[R.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(x=!0),x}pruneUnusedLayers(t){const s={};t.forEach((u=>{s[u]=!0}));for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}const As=771;class cn{constructor(t,s,u,m){this.blendFunction=t,this.blendColor=s.toNonPremultipliedRenderColor(null),this.mask=u,this.blendEquation=m}}cn.Replace=[1,0,1,0],cn.disabled=new cn(cn.Replace,r.ao.transparent,[!1,!1,!1,!1]),cn.unblended=new cn(cn.Replace,r.ao.transparent,[!0,!0,!0,!0]),cn.alphaBlended=new cn([1,As,1,As],r.ao.transparent,[!0,!0,!0,!0]),cn.alphaBlendedNonPremultiplied=new cn([770,As,770,As],r.ao.transparent,[!0,!0,!0,!0]),cn.multiply=new cn([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]);class mi{constructor(t,s,u){this.func=t,this.mask=s,this.range=u}}mi.ReadOnly=!1,mi.ReadWrite=!0,mi.disabled=new mi(519,mi.ReadOnly,[0,1]);const $o=7680;class Xi{constructor(t,s,u,m,g,x){this.test=t,this.ref=s,this.mask=u,this.fail=m,this.depthFail=g,this.pass=x}}Xi.disabled=new Xi({func:519,mask:0},0,0,$o,$o,$o);const Yo=1029,tl=2305;class Wi{constructor(t,s,u){this.enable=t,this.mode=s,this.frontFace=u}}function Jl(h,t){const s=r.c9(h,3);r.cb(h,t),r.cf(h,3,s)}function il(h,t){const s=r.c6([]);return r.c7(s,s,-t),r.c8(s,s,-h),s}function Ql(h,t){const s=[h[0],h[1],0],u=[t[0],t[1],0];if(r.ag(s)>=1e-15){const x=r.aw([],s);r.c4(u,x,r.bJ(u,x)),t[0]=u[0],t[1]=u[1]}const m=r.bI([],t,h);if(r.c5(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return il(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),g)}Wi.disabled=new Wi(!1,Yo,tl),Wi.backCCW=new Wi(!0,Yo,tl),Wi.backCW=new Wi(!0,Yo,2304),Wi.frontCW=new Wi(!0,1028,2304),Wi.frontCCW=new Wi(!0,1028,tl);class Ra{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof r.ae?t:new r.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=r.bT(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const u=this.position,m=this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(t)):0,g=r.ae.fromLngLat(t,m),x=[g.x-u.x,g.y-u.y,g.z-u.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Ql(x,s)}setPitchBearing(t,s){this.orientation=il(r.an(t),r.an(-s))}}class dl{constructor(t,s){this._transform=r.bA([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new r.ae(t[0],t[1],t[2])}get position(){const t=r.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&r.cf(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.c6([]),t&&Jl(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=il(t,s),Jl(this._transform,this._orientation)}forward(){const t=r.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const u=new Float64Array(16);return r.bl(u,this.getWorldToCamera(t,s)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,u){const m=this.position;r.c4(m,m,-t);const g=new Float64Array(16);return r.bq(g,[u,u,u]),r.br(g,g,m),g[10]*=s,g}getWorldToCamera(t,s){const u=new Float64Array(16),m=new Float64Array(4),g=this.position;return r.ca(m,this._orientation),r.c4(g,g,-t),r.cb(u,m),r.br(u,u,g),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=s,u[9]*=s,u[10]*=s,u[11]*=s,u}getCameraToClipPerspective(t,s,u,m){const g=new Float64Array(16);return r.cc(g,t,s,u,m),g}getCameraToClipOrthographic(t,s,u,m,g,x){const w=new Float64Array(16);return r.cd(w,t,s,u,m,g,x),w}getDistanceToElevation(t,s=!1){const u=t===0?0:r.ce(t,s?r.a$(this.position[1]):this.position[1]),m=this.forward();return(u-this.position[2])/m[2]}clone(){return new dl([...this.position],[...this.orientation])}}const vs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ou{constructor(t=0,s=0,u=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=u,this.right=m}interpolate(t,s,u){return s.top!=null&&t.top!=null&&(this.top=r.ak(t.top,s.top,u)),s.bottom!=null&&t.bottom!=null&&(this.bottom=r.ak(t.bottom,s.bottom,u)),s.left!=null&&t.left!=null&&(this.left=r.ak(t.left,s.left,u)),s.right!=null&&t.right!=null&&(this.right=r.ak(t.right,s.right,u)),this}getCenter(t,s){const u=r.aA((this.left+t-this.right)/2,0,t),m=r.aA((this.top+s-this.bottom)/2,0,s);return new r.P(u,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ou(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const fl=15;class qs{constructor(t,s,u,m,g,x,w){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=u??0,this._maxPitch=m??60,this.setProjection(x),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new r.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ou,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new dl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new qs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<fl}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=r.cl(this.projectionOptions);const u=this.getProjection(),m=!r.by(s,u);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cl({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=r.cm(),r.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=r.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let m=0,g=0;for(let x=0;x<s.length;x++){const w=new r.P(s[x][0]*this.width,u+s[x][1]*(this.height-u)),A=t.pointCoordinate(w);if(!A)continue;const R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);m+=A[3]*R,g+=R}return g===0?NaN:m/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-u,g);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=r.ag(r.av([],this._camera.position,u));return r.aA(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!r.co(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];r.cp(u,this._camera.position)||(this._setCameraPosition(u),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new Ra;return s.position=new r.ae(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!r.cq(t))return!1;r.cr(t,t);const s=r.cs([],[0,0,-1],t),u=r.cs([],[0,-1,0],t);if(u[2]<0)return!1;const m=Ql(s,u);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=r.aA(t[2],m/u,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,u){this._unmodified=!1,this._edgeInsets.interpolate(t,s,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new r.ct(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new r.P(0,0)),m=this.pointCoordinate(new r.P(this.width,0)),g=this.pointCoordinate(new r.P(this.width,this.height)),x=this.pointCoordinate(new r.P(0,this.height)),w=Math.floor(Math.min(u.x,m.x,g.x,x.x)),A=Math.floor(Math.max(u.x,m.x,g.x,x.x)),R=1;for(let D=w-R;D<=A+R;D++)D!==0&&s.push(new r.ct(D,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,u){let m=[];const g=u!=null,x=!g;if(x&&this.zoom<s||g&&u[0]===0&&u[1]===0)return m;const w=new Set,A=(D,U,F,V,G)=>{const Z=r.cX(U,D,F,V,G);w.has(Z)||(m.push(new r.aO(D,U,F,V,G)),w.add(Z))};for(let D=0;D<t.length;D++){const U=t[D];if(x&&U.canonical.z!==s)continue;const F=U.canonical,V=U.overscaledZ,G=U.wrap,Z=1<<F.z,ie=F.x+1<Z,J=F.x>0,ae=F.y+1<Z,me=F.y>0,ye=U.wrap-(J?0:1),Pe=U.wrap+(ie?0:1),Ae=J?F.x-1:Z-1,Me=ie?F.x+1:0;if(g)u[0]<0?(A(V,Pe,F.z,Me,F.y),u[1]<0&&ae&&(A(V,G,F.z,F.x,F.y+1),A(V,Pe,F.z,Me,F.y+1)),u[1]>0&&me&&(A(V,G,F.z,F.x,F.y-1),A(V,Pe,F.z,Me,F.y-1))):u[0]>0?(A(V,ye,F.z,Ae,F.y),u[1]<0&&ae&&(A(V,G,F.z,F.x,F.y+1),A(V,ye,F.z,Ae,F.y+1)),u[1]>0&&me&&(A(V,G,F.z,F.x,F.y-1),A(V,ye,F.z,Ae,F.y-1))):u[1]<0&&ae?A(V,G,F.z,F.x,F.y+1):me&&A(V,G,F.z,F.x,F.y-1);else{const Ie=U.visibleQuadrants;1&Ie&&(A(V,ye,F.z,Ae,F.y),me&&(A(V,G,F.z,F.x,F.y-1),A(V,ye,F.z,Ae,F.y-1))),2&Ie&&(A(V,Pe,F.z,Me,F.y),me&&(A(V,G,F.z,F.x,F.y-1),A(V,Pe,F.z,Me,F.y-1))),4&Ie&&(A(V,ye,F.z,Ae,F.y),ae&&(A(V,G,F.z,F.x,F.y+1),A(V,ye,F.z,Ae,F.y+1))),8&Ie&&(A(V,Pe,F.z,Me,F.y),ae&&(A(V,G,F.z,F.x,F.y+1),A(V,Pe,F.z,Me,F.y+1)))}}const R=[];for(const D of m)m.some((U=>D.isChildOf(U)))||R.push(D);if(m=R.filter((D=>!t.some((U=>!!(D.overscaledZ<s&&U.isChildOf(D))||D.equals(U)||D.isChildOf(U))))),x){const D=1<<s,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=[D*U.x,D*U.y],V=4,G=V*V;m=m.filter((Z=>{const ie=Z.canonical.x+.5-F[0],J=Z.canonical.y+.5-F[1];return ie*ie+J*J<G}))}return m}extendTileCoverToNearPlane(t,s,u){const m=[],g=new Set;for(const ae of t)g.add(ae.key);const x=(ae,me,ye,Pe,Ae)=>{const Me=r.cX(me,ae,ye,Pe,Ae);g.has(Me)||(m.push(new r.aO(ae,me,ye,Pe,Ae)),g.add(Me))},w=t.reduce(((ae,me)=>Math.max(ae,me.overscaledZ)),u),A=1<<u,R=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],D=new r.P(0,0),U=new r.P(0,0),F=(ae,me)=>{const ye=Math.floor(ae[0]),Pe=Math.floor(ae[1]),Ae=(ae[0]-ye)*r.al,Me=(ae[1]-Pe)*r.al,Ie=Math.floor(me[0]),Ee=Math.floor(me[1]),Re=(me[0]-Ie)*r.al,nt=(me[1]-Ee)*r.al;for(let We=-1;We<=1;We++){const gt=ye+We;if(!(gt<0||gt>=A)){D.x=Ae-We*r.al,U.x=Re-(gt-Ie)*r.al;for(let et=-1;et<=1;et++){const pt=Pe+et;D.y=Me-et*r.al,U.y=nt-(pt-Ee)*r.al,r.cY(D,U,R)&&x(w,0,u,gt,pt)}}}},V=s.points,G=V[r.cu],Z=V[r.cv],ie=this._projectToGround(G,V[r.cw]),J=this._projectToGround(Z,V[r.cx]);return F(G,ie),F(Z,J),m}_projectToGround(t,s){return r.cy(r.cz(),t,s,t[2]/(t[2]-s[2]))}coveringTiles(t){let s=this.coveringZoomLevel(t);const u=s,m=this.elevation&&this.elevation.exaggeration(),g=m&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const w=this.locationCoordinate(this.center),A=this.center.lat,R=1<<s,D=[R*w.x,R*w.y,0],U=this.projection.name==="globe",F=!U,V=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,F),G=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=R*r.ce(1,this.center.lat),ie=this._camera.position[2]/r.ce(1,this.center.lat),J=[R*G.x,R*G.y,ie*(F?1:Z)],ae=U||m,me=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ye=this.isLODDisabled(!0)?s:0;let Pe;if(this._elevation&&t.isTerrainDEM)Pe=1e4*this._elevation.exaggeration();else if(this._elevation){const Ve=this._elevation.getMinMaxForVisibleTiles();Pe=Ve?Ve.max:this._centerAltitude}else Pe=this._centerAltitude;const Ae=t.isTerrainDEM?-Pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Me=this.projection.isReprojectedInTileSpace?r.cB(this):1,Ie=Ve=>{const ct=new r.ae(Ve.x+25e-6,Ve.y,Ve.z),zt=new r.ae(Ve.x,Ve.y+25e-6,Ve.z),Xt=Ve.toLngLat(),hi=ct.toLngLat(),qt=zt.toLngLat(),Ut=this.locationCoordinate(Xt),Bi=this.locationCoordinate(hi),Di=this.locationCoordinate(qt),Fi=Math.hypot(Bi.x-Ut.x,Bi.y-Ut.y),Ri=Math.hypot(Di.x-Ut.x,Di.y-Ut.y);return Math.sqrt(Fi*Ri)*Me/25e-6},Ee=Ve=>{const bt=Pe,ct=Ae;return{aabb:r.cE(this,R,0,0,0,Ve,ct,bt,this.projection),zoom:0,x:0,y:0,minZ:ct,maxZ:bt,wrap:Ve,fullyVisible:!1}},Re=[];let nt=[];const We=s,gt=t.reparseOverscaled?u:s,et=(ie-this._centerAltitude)*Z,pt=Ve=>{if(!this._elevation||!Ve.tileID||!x)return;const bt=this._elevation.getMinMaxForTile(Ve.tileID),ct=Ve.aabb;bt?(ct.min[2]=bt.min,ct.max[2]=bt.max,ct.center[2]=(ct.min[2]+ct.max[2])/2):(Ve.shouldSplit=it(Ve),Ve.shouldSplit||(ct.min[2]=ct.max[2]=ct.center[2]=this._centerAltitude))},Kt=(Ve,bt)=>{if(.707*bt<Ve)return 1;const ct=bt/Ve;return ct/(1.4144271570014144+(Math.pow(1.1,ct-1.4144271570014144+1)-1)/(1.1-1)-1)},it=Ve=>{if(Ve.zoom<ye)return!0;if(Ve.zoom===We)return!1;if(Ve.shouldSplit!=null)return Ve.shouldSplit;const bt=Ve.aabb.distanceX(J),ct=Ve.aabb.distanceY(J);let zt=et,Xt=1;if(U){zt=Ve.aabb.distanceZ(J);const Ri=Math.pow(2,Ve.zoom),on=r.a$((Ve.y+1)/Ri),xn=r.a$(Ve.y/Ri),wn=Math.min(Math.max(A,on),xn),gr=r.d0(wn)/r.d0(A);if(Xt=wn===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,gr/this._mercatorScaleRatio),this.zoom<=r.cZ&&Ve.zoom===We-1&&gr>=.9)return!0}else if(g&&(zt=Ve.aabb.distanceZ(J)*Z),this.projection.isReprojectedInTileSpace&&u<=5){const Ri=Math.pow(2,Ve.zoom),on=Ie(new r.ae((Ve.x+.5)/Ri,(Ve.y+.5)/Ri));Xt=on>.85?1:on}if(!x){const Ri=Math.sqrt(bt*bt+ct*ct+zt*zt);let on=(1<<We-Ve.zoom)*me*Xt;return on*=Kt(Math.max(zt,et),Ri),Ri<on}let hi=Number.MAX_VALUE,qt=0;const Ut=Ve.aabb.getCorners(),Bi=[];for(const Ri of Ut){r.av(Bi,Ri,J),U||(g?Bi[2]*=Z:Bi[2]=et);const on=r.bJ(Bi,this._camera.forward());on<hi&&(hi=on,qt=Math.abs(Bi[2]))}let Di=(1<<We-Ve.zoom)*me*Xt;if(Di*=Kt(Math.max(qt,et),hi),hi<Di)return!0;const Fi=Ve.aabb.closestPoint(D);return Fi[0]===D[0]&&Fi[1]===D[1]};if(this.renderWorldCopies)for(let Ve=1;Ve<=3;Ve++)Re.push(Ee(-Ve)),Re.push(Ee(Ve));for(Re.push(Ee(0));Re.length>0;){const Ve=Re.pop(),bt=Ve.x,ct=Ve.y;let zt=Ve.fullyVisible;const Xt=()=>this.projection.name==="globe"&&(Ve.y===0||Ve.y===(1<<Ve.zoom)-1);if(!zt){let hi=ae?Ve.aabb.intersects(V):Ve.aabb.intersectsFlat(V);if(hi===0&&Xt()){const qt=new r.cC(Ve.zoom,bt,ct);hi=r.cD(this,R,qt,!0).intersects(V)}if(hi===0)continue;zt=hi===2}if(Ve.zoom!==We&&it(Ve))for(let hi=0;hi<4;hi++){const qt=(bt<<1)+hi%2,Ut=(ct<<1)+(hi>>1),Bi={aabb:x?Ve.aabb.quadrant(hi):r.cE(this,R,Ve.zoom+1,qt,Ut,Ve.wrap,Ve.minZ,Ve.maxZ,this.projection),zoom:Ve.zoom+1,x:qt,y:Ut,wrap:Ve.wrap,fullyVisible:zt,tileID:void 0,shouldSplit:void 0,minZ:Ve.minZ,maxZ:Ve.maxZ};g&&!U&&(Bi.tileID=new r.aO(Ve.zoom+1===We?gt:Ve.zoom+1,Ve.wrap,Ve.zoom+1,qt,Ut),pt(Bi)),Re.push(Bi)}else{const hi=Ve.zoom===We?gt:Ve.zoom;if(t.minzoom&&t.minzoom>hi)continue;let qt=0;if(!zt){let Fi=ae?Ve.aabb.intersectsPrecise(V):Ve.aabb.intersectsPreciseFlat(V);if(Fi===0&&Xt()){const Ri=new r.cC(Ve.zoom,bt,ct);Fi=r.cD(this,R,Ri,!0).intersectsPrecise(V)}if(Fi===0)continue;if(t.calculateQuadrantVisibility)if(V.containsPoint(Ve.aabb.center))qt=15;else for(let Ri=0;Ri<4;Ri++)Ve.aabb.quadrant(Ri).intersects(V)!==0&&(qt|=1<<Ri)}const Ut=D[0]-(.5+bt+(Ve.wrap<<Ve.zoom))*(1<<s-Ve.zoom),Bi=D[1]-.5-ct,Di=Ve.tileID?Ve.tileID:new r.aO(hi,Ve.wrap,Ve.zoom,bt,ct);t.calculateQuadrantVisibility&&(Di.visibleQuadrants=qt),nt.push({tileID:Di,distanceSq:Ut*Ut+Bi*Bi})}}if(this.fogCullDistSq){const Ve=this.fogCullDistSq,bt=this.horizonLineFromTop();nt=nt.filter((ct=>{const zt=[0,0,0,1],Xt=[r.al,r.al,0,1],hi=this.calculateFogTileMatrix(ct.tileID.toUnwrapped());r.aC(zt,zt,hi),r.aC(Xt,Xt,hi);const qt=r.cF([],zt,Xt),Ut=r.cG([],zt,Xt),Bi=r.c_(qt,Ut);if(Bi===0)return!0;let Di=!1;const Fi=this._elevation;if(Fi&&Bi>Ve&&bt!==0){const Ri=this.calculateProjMatrix(ct.tileID.toUnwrapped());let on;t.isTerrainDEM||(on=Fi.getMinMaxForTile(ct.tileID)),on||(on={min:Ae,max:Pe});const xn=r.cH(this.rotation),wn=[xn[0]*r.al,xn[1]*r.al,on.max];r.af(wn,wn,Ri),Di=(1-wn[1])*this.height*.5<bt}return Bi<Ve||Di}))}return nt.sort(((Ve,bt)=>Ve.distanceSq-bt.distanceSq)).map((Ve=>Ve.tileID))}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const s=r.aA(t.lat,-r.cI,r.cI),u=this.projection.project(t.lng,s);return new r.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let u,m;const g=this.centerPoint;if(this.projection.name==="globe"){const w=this.worldSize;u=(s.x-g.x)/w,m=(s.y-g.y)/w}else{const w=this.pointCoordinate(s),A=this.pointCoordinate(g);u=w.x-A.x,m=w.y-A.y}const x=this.locationCoordinate(t);this.setLocation(new r.ae(x.x-u,x.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const u=s?r.ce(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new r.ae(m.x,m.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const u=s??this._centerAltitude,m=[t.x,t.y,0,1],g=[t.x,t.y,1,1];r.aC(m,m,this.pixelMatrixInverse),r.aC(g,g,this.pixelMatrixInverse);const x=g[3];r.cJ(m,m,1/m[3]),r.cJ(g,g,1/x);const w=m[2],A=g[2];return{p0:m,p1:g,t:w===A?0:(u-w)/(A-w)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return r.aC(s,s,this.pixelMatrixInverse),r.aC(u,u,this.pixelMatrixInverse),r.cJ(s,s,1/s[3]),r.cJ(u,u,1/u[3]),s[2]=r.ce(s[2],this._center.lat)*this.worldSize,u[2]=r.ce(u[2],this._center.lat)*this.worldSize,r.cJ(s,s,1/this.worldSize),r.cJ(u,u,1/this.worldSize),new r.ax([s[0],s[1],s[2]],r.aw([],r.av([],u,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:u,t:m}=t,g=r.ce(s[2],this._center.lat),x=r.ce(u[2],this._center.lat);return new r.ae(r.ak(s[0],u[0],m)/this.worldSize,r.ak(s[1],u[1],m)/this.worldSize,r.ak(g,x,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new r.ae(u[0],u[1],u[2]);let m=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,s);const x=.02*g,w=t.clone();for(let A=0;A<10&&g-m>x;A++){w.y=r.ak(m,g,.66);const R=this.projection.pointCoordinate3D(this,w.x,w.y);R?(g=w.y,u=R):m=w.y}return u?new r.ae(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cK)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const u=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return r.aC(m,m,this.pixelMatrix),m[3]>0?new r.P(m[0]/m[3],m[1]/m[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,g=this.pointLocation3D(new r.P(s,t)),x=this.pointLocation3D(new r.P(m,t)),w=this.pointLocation3D(new r.P(m,u)),A=this.pointLocation3D(new r.P(s,u));let R=Math.min(g.lng,x.lng,w.lng,A.lng),D=Math.max(g.lng,x.lng,w.lng,A.lng),U=Math.min(g.lat,x.lat,w.lat,A.lat),F=Math.max(g.lat,x.lat,w.lat,A.lat);const V=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,Z=(ie,J,ae,me,ye)=>{const Pe=(ie+ae)/2,Ae=(J+me)/2,Me=new r.P(Pe,Ae),{lng:Ie,lat:Ee}=this.pointLocation3D(Me),Re=Math.max(0,R-Ie,U-Ee,Ie-D,Ee-F);R=Math.min(R,Ie),D=Math.max(D,Ie),U=Math.min(U,Ee),F=Math.max(F,Ee),(ye<G||Re>V)&&(Z(ie,J,Pe,Ae,ye+1),Z(Pe,Ae,ae,me,ye+1))};if(Z(s,t,m,t,1),Z(m,t,m,u,1),Z(m,u,s,u,1),Z(s,u,s,t,1),this.projection.name==="globe"){const[ie,J]=r.cL(this);ie?(F=90,D=180,R=-180):J&&(U=-90,D=180,R=-180)}return new r.aI(new r.aR(R,U),new r.aR(D,F))}_getBoundsRectangular(t,s){const{top:u,left:m}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=new r.P(m,u),A=new r.P(x,u),R=new r.P(x,g),D=new r.P(m,g);let U=this.pointCoordinate(w,t),F=this.pointCoordinate(A,t);const V=this.pointCoordinate(R,s),G=this.pointCoordinate(D,s),Z=(ie,J)=>(J.y-ie.y)/(J.x-ie.x);return U.y>1&&F.y>=0?U=new r.ae((1-G.y)/Z(G,U)+G.x,1):U.y<0&&F.y<=1&&(U=new r.ae(-G.y/Z(G,U)+G.x,0)),F.y>1&&U.y>=0?F=new r.ae((1-V.y)/Z(V,F)+V.x,1):F.y<0&&U.y<=1&&(F=new r.ae(-V.y/Z(V,F)+V.x,0)),new r.aI().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(V))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce(((u,m)=>{if(m.dem){const g=m.dem.tree;u.min=Math.min(u.min,g.minimums[0]),u.max=Math.max(u.max,g.maximums[0])}return u}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.cI,this.maxLat=r.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,u=this._distanceTileDataCache;if(u[s])return u[s];const m=t.canonical,g=1/this.height,x=this.cameraWorldSize,w=x/this.zoomScale(m.z),A=(m.x+Math.pow(2,m.z)*t.wrap)*w,R=m.y*w,D=this.point;D.x*=x/this.worldSize,D.y*=x/this.worldSize;const U=this.angle,F=Math.sin(-U),V=-Math.cos(-U);return u[s]={bearing:[F,V],center:[(D.x-A)*g,(D.y-R)*g],scale:w/r.al*g},u[s]}calculateFogTileMatrix(t){const s=t.key,u=this._fogTileMatrixCache;if(u[s])return u[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.aB(m,this.worldToFogMatrix,m),u[s]=new Float32Array(m),u[s]}calculateProjMatrix(t,s=!1,u=!1){const m=t.key;let g;if(g=u?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,g[m])return g[m];const x=this.calculatePosMatrix(t,this.worldSize);let w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,r.aB(x,w,x),g[m]=new Float32Array(x),g[m]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[s])return u[s];const m=r.cM(t,this);return u[s]=m,u[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=r.bq([],[t,t,t]);return r.aB(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=r.ce(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(s),m=this._camera.forward(),g=r.ce(1,this._center.lat);u[2]/=g,m[2]/=g,r.aw(m,m);const x=t.raycast(u,m,t.exaggeration());if(x){const w=r.bH([],u,m,x),A=new r.ae(w[0],w[1],r.ce(w[2],r.a$(w[1]))),R=(A.z+r.ag([A.x-u[0],A.y-u[1],A.z-u[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,u=r.ce(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),g=s.getAtPointOrZero(new r.ae(...m)),x=this.pixelsPerMeter/this.worldSize*g,w=this._minimumHeightOverTerrain(),A=m[2]-x;if(A<=w)if(A<0||t){const R=this.locationCoordinate(this._center,this._centerAltitude),D=[m[0],m[1],R.z-m[2]],U=r.ag(D);D[2]-=(w-A)/this._pixelsPerMercatorPixel;const F=r.ag(D);if(F===0)return;r.c4(D,D,U/F*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],R.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const F=this.center;return F.lat=r.aA(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(F.lng=r.aA(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const s=this._unmodified,{x:u,y:m}=this.point;let g=0,x=u,w=m;const A=this.width/2,R=this.height/2,D=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(m-R<D&&(w=D+R),m+R>U&&(w=U-R),U-D<this.height&&(g=Math.max(g,this.height/(U-D)),w=(U+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,V=this.worldMaxX*this.scale,G=this.worldSize/2-(F+V)/2;x=(u+G+this.worldSize)%this.worldSize-G,x-A<F&&(x=F+A),x+A>V&&(x=V-A),V-F<this.width&&(g=Math.max(g,this.width/(V-F)),x=(V+F)/2)}x===u&&w===m||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(x,w))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ce(1,this.center.lat)/r.ce(1,r.d1));const m=r.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?u:1,x=this._camera.getWorldToCamera(this.worldSize,g);let w;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let Ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Re=Ee*this.aspect,nt=-Re,We=-Ee;Re-=t.x,nt-=t.x,Ee+=t.y,We+=t.y,w=this._camera.getCameraToClipOrthographic(nt,Re,We,Ee,this._nearZ,this._farZ),((gt,et,pt,Kt)=>{for(let it=0;it<16;it++)gt[it]=r.ak(et[it],pt[it],Kt)})(w,w,A,r.c$(this.pitch>=fl?1:this.pitch/fl))}else w=A;const R=r.cO([],A,x);let D=r.cO([],w,x);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),Re=r.bA([]);r.br(Re,Re,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),r.aB(Re,Re,r.cP(this)),r.br(Re,Re,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),r.aB(D,D,Re),r.aB(R,R,Re),this.inverseAdjustmentMatrix=r.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cR([],D,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=D,this.invProjMatrix=r.bl(new Float64Array(16),this.projMatrix),s){const Ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ee[8]=2*-t.x/this.width,Ee[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cO([],Ee,x)}else this.expandedFarZProjMatrix=this.projMatrix;const U=r.bl([],w);this.frustumCorners=r.cS.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const F=new Float32Array(16);r.bA(F),r.cR(F,F,[1,-1,1]),r.cT(F,F,this._pitch),r.bB(F,F,this.angle);const V=r.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bz(V);const G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;V[8]=2*-t.x/this.width,V[9]=2*(t.y+G)/this.height,this.skyboxMatrix=r.aB(F,V,F);const Z=this.point,ie=Z.x,J=Z.y,ae=this.width%2/2,me=this.height%2/2,ye=Math.cos(this.angle),Pe=Math.sin(this.angle),Ae=ie-Math.round(ie)+ye*ae+Pe*me,Me=J-Math.round(J)+ye*me+Pe*ae,Ie=new Float64Array(D);if(r.br(Ie,Ie,[Ae>.5?Ae-1:Ae,Me>.5?Me-1:Me,0]),this.alignedProjMatrix=Ie,D=r.bC(),r.cR(D,D,[this.width/2,-this.height/2,1]),r.br(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=r.bC(),r.cR(D,D,[1,-1,1]),r.br(D,D,[-1,-1,0]),r.cR(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},D=r.bl(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cU(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(Ee,Ee,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,u=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,s];r.c4(g,g,m),r.c4(u,u,-1),r.cV(u,u,g);const x=r.bC();r.br(x,x,u),r.cR(x,x,g),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),m=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-u[0]*g,m.y/this.worldSize-u[1]*g,t/this.worldSize*this._centerAltitude-u[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],m=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(g=Math.min((s-u)/m,1)),this._camera.position=r.bH([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:u,bearing:m}=this._camera.getPitchBearing(),g=r.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),w=Math.max((t[2]-g)/Math.cos(u),x),A=this._zoomFromMercatorZ(w);r.bH(t,t,s,w),this._pitch=r.aA(u,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bT(m,-Math.PI,Math.PI),this._setZoom(r.aA(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,u=r.cK,m=0,g=1/0;for(;u-s>1e-6&&u>s;){const x=s+.5*(u-s),w=this.tileSize*Math.pow(2,x),A=this.getCameraToCenterDistance(this.projection,x,w),R=this.scaleZoom(A/(Math.max(0,t)*this.tileSize)),D=Math.abs(x-R);D<g&&(g=D,m=x),x<R?s=x:u=x}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const u=Math.min(t.x,s.x),m=Math.max(t.x,s.x),g=Math.min(t.y,s.y),x=Math.max(t.y,s.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const w=[new r.P(u,g),new r.P(m,x),new r.P(u,x),new r.P(m,g)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const D of w){const U=this.pointRayIntersection(D);if(U.t<0)return!0;const F=this.rayIntersectionCoordinate(U);if(F.x<A||F.y<0||F.x>R||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,s){const u=r.ag(r.av([],this._camera.position,t)),m=this._zoomFromMercatorZ(u)+s;return u-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([s,u,m],g){const x=[s,u,m,1];r.aC(x,x,g);const w=x[3]=Math.max(x[3],1e-6);return x[0]/=w,x[1]/=w,x[2]/=w,x})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,u=this.worldSize){const m=r.cN(t,s,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,u,m);let x=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(x=r.ak(1,x,r.c$(this.pitch>=fl?1:this.pitch/fl))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(t,t,this.globeMatrix),t}getFrustum(t){return r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Cl=(h,t)=>{if(t>0&&h.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=h.transform,u=Math.max(Math.abs(s._zoom-(h.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?r.ah(60,45,s.pitch):r.ah(30,15,s.pitch),g=s._farZ-s._nearZ,x=t*s.height,w=((1-(A=m))*s.cameraToCenterDistance+A*(s._farZ+x))*u;var A;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(w-s._nearZ)/g,(w-x-s._nearZ)/g]}}},Gs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Zd{constructor(t,s){this.aabb=t,this.lastCascade=s}}class ba{add(t,s){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],s.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],s.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],s.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],s.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],s.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],s.max[2])):this.receivers[t.key]=new Zd(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,u){const m=r.d8.fromPoints(t.points);let g=0;for(const x in this.receivers){const w=this.receivers[x];if(!w||!m.intersectsAabb(w.aabb))continue;w.aabb.min=m.closestPoint(w.aabb.min),w.aabb.max=m.closestPoint(w.aabb.max);const A=w.aabb.getCorners();for(let R=0;R<u.length;R++){let D=!0;for(const U of A){const F=[U[0]*s,U[1]*s,U[2]];if(r.af(F,F,u[R].matrix),F[0]<-1||F[0]>1||F[1]<-1||F[1]>1){D=!1;break}}if(w.lastCascade=R,g=Math.max(g,R),D)break}}return g+1}}class rh{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ba,this._depthMode=new mi(t.context.gl.LEQUAL,mi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(Gs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Gs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Gs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=u.style.order.reduce(((G,Z)=>{const ie=u.style._mergedLayers[Z];return G+(ie.hasShadowPass()&&!ie.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=u.context,x=Gs.shadowMapResolution,w=Gs.shadowMapResolution;if(this._cascades.length===0||Gs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<Gs.cascadeCount;++G){const Z=u._shadowMapDebug,ie=g.gl,J=g.createFramebuffer(x,w,Z,"texture"),ae=new r.T(g,{width:x,height:w,data:null},ie.DEPTH_COMPONENT16);if(J.depthAttachment.set(ae.texture),Z){const me=new r.T(g,{width:x,height:w,data:null},ie.RGBA8);J.colorAttachment.set(me.texture)}this._cascades.push({framebuffer:J,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cA,scale:0})}}this.shadowDirection=Ml(s);let A=0;if(t.elevation){const G=t.elevation,Z=[1e4,-1e4];G.visibleDemTiles.filter((ie=>ie.dem)).forEach((ie=>{const J=ie.dem.tree;Z[0]=Math.min(Z[0],J.minimums[0]),Z[1]=Math.max(Z[1],J.maximums[0])})),Z[0]!==1e4&&(A=(Z[1]-Z[0])*G.exaggeration())}const R=1.5*t.cameraToCenterDistance,D=3*R,U=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){const Z=this._cascades[G];let ie=t.height/50,J=1;Gs.cascadeCount===1?J=D:G===0?J=R:(ie=R,J=D);const[ae,me]=Wh(t,this.shadowDirection,ie,J,Gs.shadowMapResolution,A);Z.scale=t.scale,Z.matrix=ae,Z.boundingSphereRadius=me,r.bl(U,Z.matrix),Z.frustum=r.cA.fromInvProjectionMatrix(U,1,0,!0),Z.far=J}const F=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[F].far,this._cascades[F].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Gs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Gs.shadowMapResolution,this._uniformValues.u_shadowmap_0=vs.ShadowMap0,this._uniformValues.u_shadowmap_1=vs.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const V=u.transform.elevation;for(const G of this._groundShadowTiles){let Z={min:0,max:0};if(V){const ie=V.getMinMaxForTile(G);ie&&(Z=ie)}this.addShadowReceiver(G.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const u=this.painter,m=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),m.viewport.set([0,0,Gs.shadowMapResolution,Gs.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){u.currentShadowCascade=g,m.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),m.clear({color:r.ao.white,depth:1});for(const x of t.order){const w=t._mergedLayers[x];if(!w.hasShadowPass()||w.isHidden(u.transform.zoom))continue;const A=t.getLayerSourceCache(w),R=A?s[A.id]:void 0;(w.type==="model"||R&&R.length)&&u.renderLayer(u,A,w,R)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,u=t.context,m=u.gl,g=s.directionalLight,x=s.ambientLight;if(!g||!x)return;const w=[],A=Cl(t,t.longestCutoffRange);A.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");const R=ua(s,g,x),D=new mi(m.LEQUAL,mi.ReadOnly,t.depthRangeFor3D),U=new Xi({func:m.EQUAL,mask:255},0,255,m.KEEP,m.KEEP,m.KEEP);for(const F of this._groundShadowTiles){const V=F.toUnwrapped(),G=t.isTileAffectedByFog(F),Z=t.getOrCreateProgram("groundShadow",{defines:w,overrideFog:G});this.setupShadows(V,Z),t.uploadCommonUniforms(u,Z,V,null,A);const ie={u_matrix:t.transform.calculateProjMatrix(V),u_ground_shadow_factor:R};Z.draw(t,m.TRIANGLES,D,U,cn.multiply,Wi.disabled,ie,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?cn.unblended:cn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,u=s.calculatePosMatrix(t,s.worldSize);return r.aB(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return r.aB(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,u){if(!this.enabled)return;const m=this.painter.transform,g=this.painter.context,x=g.gl,w=this._uniformValues,A=new Float64Array(16),R=m.calculatePosMatrix(t,m.worldSize);for(let D=0;D<this._cascades.length;D++)r.aB(A,this._cascades[D].matrix,R),w[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),g.activeTexture.set(x.TEXTURE0+vs.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!u,this.useNormalOffset){const D=r.d6(t.canonical),U=2/m.tileSize*r.al/Gs.shadowMapResolution,F=U*this._cascades[0].boundingSphereRadius,V=U*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(u==="vector-tile"?1:3)*(function(Z,ie,J,ae,me){const ye=r.aA((Z-22)/-22,0,1);return .125*(1-ye)+4*ye})(m.zoom);w.u_shadow_normal_offset=[D,F*G,V*G],w.u_shadow_bias=[1e-4,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(g,w)}setupShadowsFromMatrix(t,s,u=!1){if(!this.enabled)return;const m=this.painter.context,g=m.gl,x=this._uniformValues,w=new Float64Array(16);for(let A=0;A<Gs.cascadeCount;A++)r.aB(w,this._cascades[A].matrix,t),x[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),m.activeTexture.set(g.TEXTURE0+vs.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(g.LINEAR,g.LINEAR,g.CLAMP_TO_EDGE,g.CLAMP_TO_EDGE,g.GREATER);if(this.useNormalOffset=u,u){const A=Gs.normalOffset;x.u_shadow_normal_offset=[1,A,A],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(m,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,u,m){if(m[2]>=0)return{};const g=(function(A,R,D){const U=D/(1<<A.canonical.z);return new r.d8([A.canonical.x*U+A.wrap*D,A.canonical.y*U+A.wrap*D,0],[(A.canonical.x+1)*U+A.wrap*D,(A.canonical.y+1)*U+A.wrap*D,R])})(t,s,u).getCorners(),x=s/-m[2];m[0]<0?(r.d7(g[0],g[0],[m[0]*x,0,0]),r.d7(g[3],g[3],[m[0]*x,0,0])):m[0]>0&&(r.d7(g[1],g[1],[m[0]*x,0,0]),r.d7(g[2],g[2],[m[0]*x,0,0])),m[1]<0?(r.d7(g[0],g[0],[0,m[1]*x,0]),r.d7(g[1],g[1],[0,m[1]*x,0])):m[1]>0&&(r.d7(g[2],g[2],[0,m[1]*x,0]),r.d7(g[3],g[3],[0,m[1]*x,0]));const w={};return w.vertices=g,w.planes=[au(g[1],g[0],g[4]),au(g[2],g[1],g[5]),au(g[3],g[2],g[6]),au(g[0],g[3],g[7])],w}addShadowReceiver(t,s,u){this._receivers.add(t,r.d8.fromTileIdAndHeight(t,s,u))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function au(h,t,s){const u=r.av([],s,t),m=r.av([],h,t),g=r.bI([],u,m),x=r.ag(g);return x===0?[0,0,1,0]:(r.c4(g,g,1/x),[g[0],g[1],g[2],-r.bJ(g,t)])}function Ml(h){const t=h.properties.get("direction"),s=r.d3(t.x,t.y,t.z);s[2]=r.aA(s[2],0,75);const u=r.d5([s[0],s[1],s[2]]);return r.d4(u.x,u.y,u.z)}function ua(h,t,s){const u=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),g=t.properties.get("intensity"),x=t.properties.get("direction"),w=[x.x,x.y,x.z],A=s.properties.get("color-use-theme")==="none",R=s.properties.get("color"),D=s.properties.get("intensity"),U=Math.max(r.bJ([0,0,1],w),0),F=[0,0,0];r.c4(F,R.toPremultipliedRenderColor(A?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),D);const V=[0,0,0];return r.c4(V,m.toPremultipliedRenderColor(u?null:h.getLut(s.scope)).toArray01Linear().slice(0,3),U*g),r.da([F[0]>0?F[0]/(F[0]+V[0]):0,F[1]>0?F[1]/(F[1]+V[1]):0,F[2]>0?F[2]/(F[2]+V[2]):0])}function Wh(h,t,s,u,m,g){const x=h.zoom,w=h.scale,A=h.worldSize,R=1/A,D=h.aspect,U=Math.sqrt(1+D*D)*Math.tan(.5*h.fovX),F=U*U,V=u-s,G=u+s;let Z,ie;F>V/G?(Z=u,ie=u*U):(Z=.5*G*(1+F),ie=.5*Math.sqrt(V*V+2*(u*u+s*s)*F+G*G*F*F));const J=h.projection.pixelsPerMeter(h.center.lat,A),ae=h._camera.getCameraToWorldMercator(),me=[0,0,-Z*R];r.af(me,me,ae);let ye=ie*R;const Pe=h._edgeInsets;if(!(Pe.left===0&&Pe.top===0&&Pe.right===0&&Pe.bottom===0||Pe.left===Pe.right&&Pe.top===Pe.bottom)){const zt=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?J:1),Xt=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,s,u);Xt[8]=2*-h.centerOffset.x/h.width,Xt[9]=2*h.centerOffset.y/h.height;const hi=new Float64Array(16);r.cO(hi,Xt,zt);const qt=new Float64Array(16);r.bl(qt,hi);const Ut=r.cA.fromInvProjectionMatrix(qt,A,x,!0);for(const Bi of Ut.points){const Di=((Ae=Bi)[0]/=w,Ae[1]/=w,Ae[2]=r.ce(Ae[2],h._center.lat),Ae);ye=Math.max(ye,r.c5(r.d9([],me,Di)))}}var Ae;ye*=m/(m-1);const Me=Math.acos(t[2]),Ie=Math.atan2(-t[0],-t[1]),Ee=new dl;Ee.position=me,Ee.setPitchBearing(Me,Ie);const Re=Ee.getWorldToCamera(A,J),nt=ye*A,We=Math.min(h._mercatorZfromZoom(17)*A*-2,-2*nt),gt=Ee.getCameraToClipOrthographic(-nt,nt,-nt,nt,We,(nt+g*J)/t[2]),et=new Float64Array(16);r.aB(et,gt,Re);const pt=r.d4(Math.floor(1e6*me[0])/1e6*A,Math.floor(1e6*me[1])/1e6*A,0),Kt=.5*m,it=[0,0,0];r.af(it,pt,et),r.c4(it,it,Kt);const Ve=[Math.floor(it[0]),Math.floor(it[1]),Math.floor(it[2])],bt=[0,0,0];r.av(bt,it,Ve),r.c4(bt,bt,-1/Kt);const ct=new Float64Array(16);return r.bA(ct),r.br(ct,ct,bt),r.aB(et,ct,et),[et,nt]}class pl extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return r.aV(this.requestManager.transformRequest(s,r.R.Model).url).then((u=>{if(!u)return;const m=r.aW(u),g=new r.aX(t,void 0,void 0,m);return g.computeBoundsAndApplyParent(),g})).catch((u=>{if(u&&u.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${s}: ${u.message}`)))}))}load(t,s,u={forceReload:!1}){this.models[s]||(this.models[s]={});const m=Object.keys(t),g=[],x=[];for(const w of m){const A=t[w];this.hasURLBeenRequested(A)&&!u.forceReload||(this.modelByURL[A]={modelId:w,scope:s},g.push(this.loadModel(w,A)),x.push(w)),this.models[s][w]||(this.models[s][w]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+x.length,Promise.allSettled(g).then((w=>{for(let A=0;A<w.length;A++){const{status:R}=w[A];if(R==="rejected")continue;const{value:D}=w[A];this.models[s][x[A]]||(this.models[s][x[A]]={model:null,numReferences:1}),this.models[s][x[A]].model=D}this.numModelsLoading[s]-=x.length,this.fire(new r.z("data",{dataType:"style"}))})).catch((w=>{this.fire(new r.y(new Error(`Could not load models: ${w.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const m=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===m)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(m)){const{scope:g,modelId:x}=this.modelByURL[m];this.models[g][x].numReferences++}else this.modelUris[u][t]=m,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const u=this.modelUris[s];for(const m in t)u[m]=this.requestManager.normalizeModelURL(t[m])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const u={};for(const m of t)this.hasModel(m,s,{exactIdMatch:!0})||this.hasURLBeenRequested(m)?this.models[s][m].numReferences++:this.modelUris[s][m]&&!this.hasURLBeenRequested(m)?u[m]=this.modelUris[s][m]:!this.hasURLBeenRequested(m)&&r.db(m,!1)&&(this.modelUris[s][m]=this.requestManager.normalizeModelURL(m),u[m]=this.modelUris[s][m]);this.load(u,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,u=!1,m=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0||m)){const g=this.modelUris[s][t];u||delete this.modelUris[s][t],delete this.modelByURL[g];const x=this.models[s][t].model;if(!x)return;delete this.models[s][t],x.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const u=this.models[t][s].model;delete this.models[t][s],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const u in this.models[s])this.models[s][u].model&&this.models[s][u].model.upload(t.context)}}const ec=new r.a9({data:new r.aa(r.a6.colorTheme.data)});function tc(h){if(!h.metadata||!h.metadata.content_area)return;const t=r.o.devicePixelRatio,{left:s,top:u,width:m,height:g}=h.metadata.content_area,x=s*t,w=u*t;return[x,w,x+m*t,w+g*t]}function Ic(h){if(h)return h.map((([t,s])=>[t*r.o.devicePixelRatio,s*r.o.devicePixelRatio]))}class ml{constructor(t,s,u){this.id=t,this.scope=s,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof Xs))return t;const m=s.map((x=>this.sourceCache.getTile(x))),g=u.getImages(m,Array.from(this.pendingRequests));for(const[x,w]of g)t.set(r.I.from({name:x,iconsetId:this.id}),w),this.pendingRequests.delete(x);for(const x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),t}}const ic=(h,t)=>Le(h,t&&t.filter((s=>s.identifier!=="source.canvas"))),sh=r.aH(Pn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ep=r.aH(Pn,["setCenter","setZoom","setBearing","setPitch"]),lu=new Set(["background","sky","slot","custom"]),Wd={version:8,layers:[],sources:{}},cu={duration:300,delay:0};class Oa extends r.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=Object.assign({},cu),this._buildingIndex=new fr(this),this.crossTileSymbolIndex=new $s,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new $e,this.dispatcher=s.dispatcher?s.dispatcher:new r.D(r.dd(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new vt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new r.de(t._requestManager,s.localFontFamily?r.df.all:s.localIdeographFontFamily?r.df.ideographs:r.df.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new pl(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",r.dg());const u=this;this._rtlTextPluginCallback=Oa.registerForPluginStateChange((m=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},((g,x)=>{if(r.dh(g),x&&x.every((w=>w)))for(const w in u._sourceCaches){const A=u._sourceCaches[w],R=A.getSource().type;R!=="vector"&&R!=="geojson"||A.reload()}}))})),this.on("data",(m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getOwnSource(m.sourceId);if(g&&g.vectorLayerIds)for(const x in this._layers){const w=this._layers[x];w.source===g.id&&this._validateLayer(w)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.h(t))return t;const s=r.di(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${r.dj(JSON.stringify(t))}`}_diffStyle(t,s,u){this.globalId=this._getGlobalId(t);const m=(g,x)=>{try{x(null,this.setState(g,u))}catch(w){x(w,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(g,r.R.Style);r.m(x,((w,A)=>{w?this.fire(new r.y(w)):A&&m(A,s)}))}else typeof t=="object"&&m(t,s)}loadURL(t,s={}){this.fire(new r.z("dataloading",{dataType:"style"}));const u=typeof s.validate=="boolean"?s.validate:!r.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,u);const g=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.m(g,((x,w)=>{if(this._request=null,x)this.fire(new r.y(x));else if(w)return this.importsCache.set(t,w),this._load(w,u)}))}loadJSON(t,s={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.o.frame((()=>{this._request=null,this._load(t,s.validate!==!1)}))}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(Wd,!1)}_loadImports(t,s,u){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const g of t){const x=this._createFragmentStyle(g),w=new Promise((D=>{x.once("style.import.load",D),x.once("error",D)})).then((()=>this.mergeAll()));if(m.push(w),this.resolvedImports.has(g.url)){x.loadEmpty();continue}const A=g.data||this.importsCache.get(g.url);A?(x.loadJSON(A,{validate:s}),this._isInternalStyle(A)&&(x.globalId=null)):g.url?x.loadURL(g.url,{validate:s}):x.loadEmpty();const R={style:x,id:g.id,config:g.config};if(u){const D=this.fragments.findIndex((({id:U})=>U===u));this.fragments=this.fragments.slice(0,D).concat(R).concat(this.fragments.slice(D))}else this.fragments.push(R)}return Promise.allSettled(m)}getImportGlobalIds(t=this,s=new Set){for(const u of t.fragments)u.style.globalId&&s.add(u.style.globalId),this.getImportGlobalIds(u.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?r.B(t.id,this.scope):t.id;let u;const m=this._initialConfig&&this._initialConfig[s];(t.config||m)&&(u=Object.assign({},t.config,m));const g=new Oa(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){if(this._isInternalStyle(t)){const g=Object.assign({},Wd,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(g,s)}if(this.updateConfig(this._config,t.schema),s&&ic(this,rs(t)))return;this._loaded=!0,this.stylesheet=r.dk(t);const u=()=>{for(const A in t.sources)this.addSource(A,t.sources[A],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const A in t.iconsets)this.addIconset(A,t.iconsets[A]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const g=Js(this.stylesheet.layers);if(this._order=g.map((A=>A.id)),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const A=this.stylesheet.lights[0];this.light=new je(A.properties,A.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new je(this.stylesheet.light)),this._layers={};for(const A of g){const R=r.dq(A,this.scope,this._styleColorTheme.lut,this.options);R.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R;const D=this.getOwnLayerSourceCache(R),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&R.canCastShadows()&&U&&(D.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const w=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then((()=>{this._reloadImports(),this.fire(new r.z(w?"style.load":"style.import.load"))})).catch((A=>{this.fire(new r.y(new Error("Failed to load imports",A))),this.fire(new r.z(w?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new r.z(w?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const g=this._evaluateColorThemeData(m);this._loadColorTheme(g).then((()=>{u()})).catch((x=>{r.w(`Couldn't load color theme from the stylesheet: ${x}`),u()}))}else this._styleColorTheme.lut=null,u()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,u,m,g,x,w,A,R,D;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((F=>{if(F.stylesheet){if(F.light!=null&&(t=F.light),F.stylesheet.lights)for(const V of F.stylesheet.lights)V.type==="ambient"&&F.ambientLight!=null&&(s=F.ambientLight),V.type==="directional"&&F.directionalLight!=null&&(u=F.directionalLight);m=this._prioritizeTerrain(m,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(g=F.fog),F.stylesheet.snow&&F.snow!=null&&(x=F.snow),F.stylesheet.rain&&F.rain!=null&&(w=F.rain),F.stylesheet.camera!=null&&(D=F.stylesheet.camera),F.stylesheet.projection!=null&&(A=F.stylesheet.projection),F.stylesheet.transition!=null&&(R=F.stylesheet.transition),U[F.scope]=F._styleColorTheme}})),this.light=t,this.ambientLight=s,this.directionalLight=u,this.fog=g,this.snow=x,this.rain=w,this._styleColorThemeForScope=U,m===null?delete this.terrain:this.terrain=m,this.camera=D||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=Object.assign({},cu,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=u=>{for(const m of u.fragments)s(m.style);t(u)};s(this)}_prioritizeTerrain(t,s,u){const m=t&&t.drapeRenderMode===0;return u===null?s&&s.drapeRenderMode===0?s:m?t:null:s!=null&&(!t||m||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},u={};this.forEachFragmentStyle((m=>{for(const g in m._sourceCaches){const x=r.B(g,m.scope);t[x]=m._sourceCaches[g]}for(const g in m._otherSourceCaches){const x=r.B(g,m.scope);s[x]=m._otherSourceCaches[g]}for(const g in m._symbolSourceCaches){const x=r.B(g,m.scope);u[x]=m._symbolSourceCaches[g]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},s=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((x=>{for(const w of x._order){const A=x._layers[w];if(A.type==="slot"){const R=r.dl(w);if(t[R])continue;t[R]=[]}A.slot&&t[A.slot]?t[A.slot].push(A):s.push(A)}})),this._mergedOrder=[];let m=-1;const g=(x=[])=>{for(const w of x)if(w.type==="slot"){const A=r.dl(w.id);t[A]&&g(t[A]),this._mergedSlots.push(A)}else{const A=r.B(w.id,w.scope);this._mergedOrder.push(A),u[A]=w,w.is3D(!!this.terrain)&&(this._has3DLayers=!0,m=this._mergedOrder.length-1),w.type==="circle"&&(this._hasCircleLayers=!0),w.type==="symbol"&&(this._hasSymbolLayers=!0),w.type==="clip"&&(this._clipLayerPresent=!0)}};if(g(s),this._has3DLayers){const x={};for(let w=0;w<this._mergedOrder.length;++w){const A=this._mergedOrder[w];x[A]=w===m?1:w<m?u[A].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((w,A)=>x[w]-x[A]))}this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(s,u,m,g){const x=Object.assign({},u);for(const A of Object.keys(r.a6.colorTheme))x[A]===void 0&&(x[A]=r.a6.colorTheme[A].default);const w=new r.a8(ec,s,new Map(m));return w.setTransitionOrValue(x,m),w.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((u,m)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let x=t;x.startsWith(g)||(x=g+x);const w=r.I.from("mapbox-reserved-lut"),A=new Image;A.src=x,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void u();this._styleColorTheme.lutLoading=!1;const{width:R,height:D,data:U}=r.o.getImageData(A);if(D>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==D*D)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new r.q({width:R,height:D},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const F=this.imageManager.getImage(w,this.scope);F?(this._styleColorTheme.lut={image:F.data,data:t},u()):m(new Error("Missing LUT image."))}}))}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(s,u,m){let g,x,w;const A=r.o.devicePixelRatio>1?"@2x":"";let R=r.m(u.transformRequest(u.normalizeSpriteURL(s,A,".json"),r.R.SpriteJSON),((F,V)=>{R=null,w||(w=F,g=V,U())})),D=r.n(u.transformRequest(u.normalizeSpriteURL(s,A,".png"),r.R.SpriteImage),((F,V)=>{D=null,w||(w=F,x=V,U())}));function U(){if(w)m(w);else if(g&&x){const F=r.o.getImageData(x),V={};for(const G in g){const{width:Z,height:ie,x:J,y:ae,sdf:me,pixelRatio:ye,stretchX:Pe,stretchY:Ae,content:Me}=g[G],Ie=new r.q({width:Z,height:ie});r.q.copy(F,Ie,{x:J,y:ae},{x:0,y:0},{width:Z,height:ie},null),V[G]={data:Ie,pixelRatio:ye!==void 0?ye:1,sdf:me!==void 0&&me,stretchX:Pe,stretchY:Ae,content:Me,usvg:!1,version:0}}m(null,V)}}return{cancel(){R&&(R.cancel(),R=null),D&&(D.cancel(),D=null)}}})(t,this.map._requestManager,((s,u)=>{if(this._spriteRequest=null,s)this.fire(new r.y(s));else if(u){const m=new Map;for(const g in u)m.set(r.I.from(g),u[g]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))}))}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const u=this.getOwnSourceCache(s.source);if(!u)return void this.fire(new r.y(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const m=u.getSource();if(m.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const g=new ml(t,this.scope,u);this.imageManager.addImageProvider(g,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var u,m;this._spriteRequest=(m=(g,x)=>{if(this._spriteRequest=null,g)s?this._loadSprite(t):this.fire(new r.y(g));else if(x){const w=new Map;for(const A in x)w.set(r.I.from(A),x[A]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bu((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),r.R.Iconset),((g,x)=>{if(g)return void m(g);const w={},A=r.dc(new r.bt(x));for(const R of A.icons){const D={version:1,pixelRatio:r.o.devicePixelRatio,content:tc(R),stretchX:R.metadata?Ic(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?Ic(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};w[R.name]=D}m(null,w)})))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const u=t.sourceLayer;u&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(u)===-1)&&this.fire(new r.y(new Error(`Source layer "${u}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,s)=>{const u=this.fragments[s];return u&&u.style&&(t.data=u.style.serialize()),t}))}_serializeSources(){const t={};for(const s in this._sourceCaches){const u=this._sourceCaches[s].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const s=[];for(const u of t){const m=this._layers[u];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const u=this.map.painter;if(u)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const g=t.getProgramIds();if(g)for(const x of g){const w=t.getDefaultProgramParams(x,s.zoom,this._styleColorTheme.lut);w&&(u.style=this,this.fog&&(u._fogVisible=!0,w.overrideFog=!0,u.getOrCreateProgram(x,w)),u._fogVisible=!1,w.overrideFog=!1,u.getOrCreateProgram(x,w),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(w.overrideRtt=!0,u.getOrCreateProgram(x,w)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const u=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const A in w){const{updatedIds:R,removedIds:D}=w[A];(R||D)&&(this._updateWorkerLayers(A,R,D),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const w in this._mergedSourceCaches){const A=this._mergedSourceCaches[w];g[w]=A.used,A.used=!1,A.tileCoverLift=0}for(const w of this._mergedOrder){const A=this._mergedLayers[w];if(A.recalculate(t,this._availableImages),!A.isHidden(t.zoom)){const R=this.getLayerSourceCache(A);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(A,t)})):this.precompilePrograms(A,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const x=this.imageManager.getPendingImageProviders();for(const w of x)w.sourceCache.used=!0;for(const w in g){const A=this._mergedSourceCaches[w];g[w]!==A.used&&A.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const u=s.resolvePendingRequests(),m=this.getFragmentStyle(s.scope);m&&m.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const u=this._mergedSourceCaches[s].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,u){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:t,removedIds:u||[],options:m.options})}setState(t,s){if(this._checkLoaded(),ic(this,rs(t)))return!1;(t=r.dk(t)).layers=Js(t.layers);const u=(function(x,w){if(!x)return[{command:Pn.setStyle,args:[w]}];let A=[];try{if(!r.by(x.version,w.version))return[{command:Pn.setStyle,args:[w]}];if(r.by(x.center,w.center)||A.push({command:Pn.setCenter,args:[w.center]}),r.by(x.zoom,w.zoom)||A.push({command:Pn.setZoom,args:[w.zoom]}),r.by(x.bearing,w.bearing)||A.push({command:Pn.setBearing,args:[w.bearing]}),r.by(x.pitch,w.pitch)||A.push({command:Pn.setPitch,args:[w.pitch]}),r.by(x.sprite,w.sprite)||A.push({command:Pn.setSprite,args:[w.sprite]}),r.by(x.glyphs,w.glyphs)||A.push({command:Pn.setGlyphs,args:[w.glyphs]}),r.by(x.imports,w.imports)||(function(V=[],G=[],Z){G=G||[];const ie=(V=V||[]).map(ms),J=G.map(ms),ae=V.reduce(Rn,{}),me=G.reduce(Rn,{}),ye=ie.slice();let Pe,Ae,Me,Ie;for(Pe=0,Ae=0;Pe<ie.length;Pe++)Me=ie[Pe],me.hasOwnProperty(Me)?Ae++:(Z.push({command:Pn.removeImport,args:[Me]}),ye.splice(ye.indexOf(Me,Ae),1));for(Pe=0,Ae=0;Pe<J.length;Pe++)Me=J[J.length-1-Pe],ye[ye.length-1-Pe]!==Me&&(ae.hasOwnProperty(Me)?(Z.push({command:Pn.removeImport,args:[Me]}),ye.splice(ye.lastIndexOf(Me,ye.length-Ae),1)):Ae++,Ie=ye[ye.length-Pe],Z.push({command:Pn.addImport,args:[me[Me],Ie]}),ye.splice(ye.length-Pe,0,Me));for(const Ee of G){const Re=ae[Ee.id];Re&&(delete Re.data,r.by(Re,Ee)||Z.push({command:Pn.updateImport,args:[Ee.id,Ee]}))}})(x.imports,w.imports,A),r.by(x.transition,w.transition)||A.push({command:Pn.setTransition,args:[w.transition]}),r.by(x.light,w.light)||A.push({command:Pn.setLight,args:[w.light]}),r.by(x.fog,w.fog)||A.push({command:Pn.setFog,args:[w.fog]}),r.by(x.snow,w.snow)||A.push({command:Pn.setSnow,args:[w.snow]}),r.by(x.rain,w.rain)||A.push({command:Pn.setRain,args:[w.rain]}),r.by(x.projection,w.projection)||A.push({command:Pn.setProjection,args:[w.projection]}),r.by(x.lights,w.lights)||A.push({command:Pn.setLights,args:[w.lights]}),r.by(x.camera,w.camera)||A.push({command:Pn.setCamera,args:[w.camera]}),r.by(x.iconsets,w.iconsets)||(function(V,G,Z){let ie;for(ie in G=G||{},V=V||{})V.hasOwnProperty(ie)&&(G.hasOwnProperty(ie)||Z.push({command:Pn.removeIconset,args:[ie]}));for(ie in G){if(!G.hasOwnProperty(ie))continue;const J=G[ie];V.hasOwnProperty(ie)?r.by(V[ie],J)||(Z.push({command:Pn.removeIconset,args:[ie]}),Z.push({command:Pn.addIconset,args:[ie,J]})):Z.push({command:Pn.addIconset,args:[ie,J]})}})(x.iconsets,w.iconsets,A),!r.by(x["color-theme"],w["color-theme"]))return[{command:Pn.setStyle,args:[w]}];const R={},D=[];(function(V,G,Z,ie){let J;for(J in G=G||{},V=V||{})V.hasOwnProperty(J)&&(G.hasOwnProperty(J)||Pa(J,Z,ie));for(J in G){if(!G.hasOwnProperty(J))continue;const ae=G[J];V.hasOwnProperty(J)?r.by(V[J],ae)||(V[J].type==="geojson"&&ae.type==="geojson"&&jo(V,G,J)?Z.push({command:Pn.setGeoJSONSourceData,args:[J,ae.data]}):la(J,G,Z,ie)):Ps(J,G,Z)}})(x.sources,w.sources,D,R);const U=[];x.layers&&x.layers.forEach((V=>{V.source&&R[V.source]?A.push({command:Pn.removeLayer,args:[V.id]}):U.push(V)}));let F=x.terrain;F&&R[F.source]&&(A.push({command:Pn.setTerrain,args:[void 0]}),F=void 0),A=A.concat(D),r.by(F,w.terrain)||A.push({command:Pn.setTerrain,args:[w.terrain]}),(function(V,G,Z){G=G||[];const ie=(V=V||[]).map(ms),J=G.map(ms),ae=V.reduce(Rn,{}),me=G.reduce(Rn,{}),ye=ie.slice(),Pe=Object.create(null);let Ae,Me,Ie,Ee,Re,nt,We;for(Ae=0,Me=0;Ae<ie.length;Ae++)Ie=ie[Ae],me.hasOwnProperty(Ie)?Me++:(Z.push({command:Pn.removeLayer,args:[Ie]}),ye.splice(ye.indexOf(Ie,Me),1));for(Ae=0,Me=0;Ae<J.length;Ae++)Ie=J[J.length-1-Ae],ye[ye.length-1-Ae]!==Ie&&(ae.hasOwnProperty(Ie)?(Z.push({command:Pn.removeLayer,args:[Ie]}),ye.splice(ye.lastIndexOf(Ie,ye.length-Me),1)):Me++,nt=ye[ye.length-Ae],Z.push({command:Pn.addLayer,args:[me[Ie],nt]}),ye.splice(ye.length-Ae,0,Ie),Pe[Ie]=!0);for(Ae=0;Ae<J.length;Ae++)if(Ie=J[Ae],Ee=ae[Ie],Re=me[Ie],!Pe[Ie]&&!r.by(Ee,Re))if(r.by(Ee.source,Re.source)&&r.by(Ee["source-layer"],Re["source-layer"])&&r.by(Ee.type,Re.type)){for(We in Qs(Ee.layout,Re.layout,Z,Ie,null,Pn.setLayoutProperty),Qs(Ee.paint,Re.paint,Z,Ie,null,Pn.setPaintProperty),r.by(Ee.slot,Re.slot)||Z.push({command:Pn.setSlot,args:[Ie,Re.slot]}),r.by(Ee.filter,Re.filter)||Z.push({command:Pn.setFilter,args:[Ie,Re.filter]}),r.by(Ee.minzoom,Re.minzoom)&&r.by(Ee.maxzoom,Re.maxzoom)||Z.push({command:Pn.setLayerZoomRange,args:[Ie,Re.minzoom,Re.maxzoom]}),Ee)Ee.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&We!=="slot"&&(We.indexOf("paint.")===0?Qs(Ee[We],Re[We],Z,Ie,We.slice(6),Pn.setPaintProperty):r.by(Ee[We],Re[We])||Z.push({command:Pn.setLayerProperty,args:[Ie,We,Re[We]]}));for(We in Re)Re.hasOwnProperty(We)&&!Ee.hasOwnProperty(We)&&We!=="layout"&&We!=="paint"&&We!=="filter"&&We!=="metadata"&&We!=="minzoom"&&We!=="maxzoom"&&We!=="slot"&&(We.indexOf("paint.")===0?Qs(Ee[We],Re[We],Z,Ie,We.slice(6),Pn.setPaintProperty):r.by(Ee[We],Re[We])||Z.push({command:Pn.setLayerProperty,args:[Ie,We,Re[We]]}))}else Z.push({command:Pn.removeLayer,args:[Ie]}),nt=ye[ye.lastIndexOf(Ie)+1],Z.push({command:Pn.addLayer,args:[Re,nt]})})(U,w.layers,A)}catch(R){console.warn("Unable to compute style diff:",R),A=[{command:Pn.setStyle,args:[w]}]}return A})(this.serialize(),t).filter((x=>!(x.command in Ep)));if(u.length===0)return!1;const m=u.filter((x=>!(x.command in sh)));if(m.length>0)throw new Error(`Unimplemented: ${m.map((x=>x.command)).join(", ")}.`);const g=[];return u.forEach((x=>{g.push(this[x.command](...x.args))})),s&&Promise.all(g).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[s,u]of t.entries()){if(this.getImage(s))return this.fire(new r.y(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,u),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new r.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(t,s,u=!1){this.imageManager.updateImage(t,this.scope,s),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(t,s,u={}){return this._checkLoaded(),this._validate(Fe,`models.${t}`,s,null,u)||(this.modelManager.addModel(t,s,this.scope),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Os,`sources.${t}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=Kn(t,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id})));const g=x=>{const w=(x?"symbol:":"other:")+m.id,A=r.B(w,this.scope),R=this._sourceCaches[w]=new Fn(A,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=R,R.onAdd(this.map)};g(!1),s.type!=="vector"&&s.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find((([g,x])=>x.type==="source"&&x.source===t));if(m)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while iconset "${m[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const m of u){const g=r.dl(m.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(m.id),m.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const u=this.getOwnSourceCache(s);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const u=t[s]._tiles;for(const m in u){const g=u[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const g of t){if(this._validate(fo,"lights",g))return;switch(g.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(g),x.updateTransitions(s)}else this.ambientLight=new Zn(g,Mr||(Mr=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(g),x.updateTransitions(s)}else this.directionalLight=new Zn(g,ss||(ss=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=Object.assign(s,{worldview:this.map.getWorldview()}),m=new r.ac(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const u=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),m=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),g=t.properties.get("intensity"),x=t.properties.get("direction"),w=1-r.d3(x.x,x.y,x.z)[2]/90,A=u(m)*g*w,R=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=s.properties.get("intensity"),U=u(R)*D;return Number(((A+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.dm(t)){const s=r.dn(t),u=this.fragments.find((({id:g})=>g===s));if(!u)return;const m=r.dl(t);return u.style.getFragmentStyle(m)}{const s=this.fragments.find((({id:u})=>u===t));return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},u=(m,g="")=>`${m}::${g}`;this._featuresetSelectors={};for(const m in t){const g=this._featuresetSelectors[m]=[];for(const x of t[m].selectors){if(x.featureNamespace){const A=this.getOwnLayer(x.layer);if(!A){r.w(`Layer is undefined for selector: ${x.layer}`);continue}const R=u(A.source,A.sourceLayer);if(R in s&&s[R]!==x.featureNamespace){r.w(`"featureNamespace ${x.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}s[R]=x.featureNamespace}let w;if(x.properties)for(const A in x.properties){const R=r.U(x.properties[A]);R.result==="success"&&(w=w||{},w[A]=R.value)}g.push({layerId:x.layer,namespace:x.featureNamespace,properties:w,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const u=[];for(const m in s.stylesheet.featuresets)u.push({featuresetId:m,importId:s.scope?s.scope:void 0});return u}getFeaturesetLayers(t,s){const u=this.getFragmentStyle(s),m=u.stylesheet.featuresets;if(!m||!m[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const x of m[t].selectors){const w=u.getOwnLayer(x.layer);w&&g.push(w)}return g}getConfigProperty(t,s){const u=this.getFragmentStyle(t);if(!u)return null;const m=r.B(s,u.scope),g=u.options.get(m),x=g?g.value||g.default:null;return x?x.serialize():null}setConfigProperty(t,s,u){const m=this.getFragmentStyle(t);if(!m)return;const g=m.stylesheet.schema;if(!g||!g[s])return;const x=r.U(u);if(x.result!=="success")return void ic(this,x.value);const w=x.value.expression,A=r.B(s,m.scope),R=m.options.get(A);if(!R)return;let D;const{minValue:U,maxValue:F,stepValue:V,type:G,values:Z}=g[s],ie=r.U(g[s].default);ie.result==="success"&&(D=ie.value.expression),D?(this.options.set(A,Object.assign({},R,{value:w,default:D,minValue:U,maxValue:F,stepValue:V,type:G,values:Z})),this.updateConfigDependencies(s)):this.fire(new r.y(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const u=s.stylesheet.schema;if(!u)return null;const m={};for(const g in u){const x=r.B(g,s.scope),w=s.options.get(x),A=w?w.value||w.default:null;m[g]=A?A.serialize():null}return m}setConfig(t,s){const u=this.getFragmentStyle(t);u&&(u.updateConfig(s,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=s,u.updateConfig(u._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const u in s){let m,g;const x=r.U(s[u].default);if(x.result==="success"&&(m=x.value.expression),t&&t[u]!==void 0){const F=r.U(t[u]);F.result==="success"&&(g=F.value.expression)}const{minValue:w,maxValue:A,stepValue:R,type:D,values:U}=s[u];if(m){const F=r.B(u,this.scope);this.options.set(F,{default:m,value:g,minValue:w,maxValue:A,stepValue:R,type:D,values:U})}else this.fire(new r.y(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const u=this.getLayer(s);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((s=>{const u=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(u){const m=s._evaluateColorThemeData(u);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(u)}})),this._changes.setDirty()}addLayer(t,s,u={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new r.y(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(t.type==="custom"){if(ic(this,r.dp(t)))return;g=r.dq(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=r.dk(t),t=Object.assign(t,{source:m})),this._validate(Xe,`layers.${m}`,t,{arrayIndex:-1},u))return;g=r.dq(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let x=this._order.length;if(s){const D=this._order.indexOf(s);if(D===-1)return void this.fire(new r.y(new Error(`Layer with id "${s}" does not exist on this map.`)));g.slot===this._layers[s].slot?x=D:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const w=this.getOwnLayerSourceCache(g),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();w&&g.canCastShadows()&&A&&(w.castsShadows=!0);const R=this._changes.getRemovedLayer(g);if(R&&g.source&&w&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const D=r.B(g.source,g.scope);R.type!==g.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),w.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===s)return;const m=this._order.indexOf(t);this._order.splice(m,1);let g=this._order.length;if(s){const x=this._order.indexOf(s);if(x===-1)return void this.fire(new r.y(new Error(`Layer with id "${s}" does not exist on this map.`)));u.slot===this._layers[s].slot?g=x:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let g=!1;for(const x in this._layers)if(this._layers[x].source===s.source&&this._layers[x].canCastShadows()){g=!0;break}m.castsShadows=g}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,u){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===s&&m.maxzoom===u||(s!=null&&(m.minzoom=s),u!=null&&(m.maxzoom=u),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==s&&(u.slot=s,this._updateLayer(u))}setFilter(t,s,u={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!r.by(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(Q,`layers.${m.id}.filter`,s,{layerType:m.type},u)||(m.filter=r.dk(s),this._updateLayer(m)))}getFilter(t){const s=this._checkLayer(t);if(s)return r.dk(s.filter)}setLayoutProperty(t,s,u,m={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!r.by(g.getLayoutProperty(s),u)){if(u!=null&&(!m||m.validate!==!1)&&ic(g,be.call(rs,{key:`layers.${t}.layout.${s}`,layerType:g.type,objectKey:s,value:u,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(s,u),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,s){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(s)}setPaintProperty(t,s,u,m={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||r.by(g.getPaintProperty(s),u)||u!=null&&(!m||m.validate!==!1)&&ic(g,ne.call(rs,{key:`layers.${t}.paint.${s}`,layerType:g.type,objectKey:s,value:u,styleSpec:r.a6})))return;const x=g.setPaintProperty(s,u);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),x&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,s){const u=this._checkLayer(t);if(u)return u.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:R}=t.target,D=this.getFragmentStyle(R),U=D.getFeaturesetLayers(A);for(const{source:F,sourceLayer:V}of U)D.setFeatureState({id:t.id,source:F,sourceLayer:V},s)}else if("layerId"in t.target){const{layerId:A}=t.target,R=this.getLayer(A);this.setFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},s)}return}const u=t.source,m=t.sourceLayer,g=this._checkSource(u);if(!g)return;const x=g.type;if(x==="geojson"&&m)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const w=this.getOwnSourceCaches(u);for(const A of w)A.setFeatureState(m,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:R}=t.target,D=this.getFragmentStyle(R),U=D.getFeaturesetLayers(A);for(const{source:F,sourceLayer:V}of U)D.removeFeatureState({id:t.id,source:F,sourceLayer:V},s)}else if("layerId"in t.target){const{layerId:A}=t.target,R=this.getLayer(A);this.removeFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer},s)}return}const u=t.source,m=this._checkSource(u);if(!m)return;const g=m.type,x=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!x)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const w=this.getOwnSourceCaches(u);for(const A of w)A.removeFeatureState(x,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:x,importId:w}=t.target,A=this.getFragmentStyle(w),R=A.getFeaturesetLayers(x);for(const{source:D,sourceLayer:U}of R){const F=A.getFeatureState({id:t.id,source:D,sourceLayer:U});if(F&&!g)g=F;else if(!r.by(g,F))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,w=this.getLayer(x);g=this.getFeatureState({id:t.id,source:w.source,sourceLayer:w.sourceLayer})}return g}const s=t.source,u=t.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||u)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(u,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(u=>u!==void 0))}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),u=r.B(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[u]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=w=>this._mergedLayers[w].is3D(!!this.terrain),u=this.order,m={},g=[];for(let w=u.length-1;w>=0;w--){const A=u[w];if(s(A)){m[A]=w;for(const R of t){const D=R[A];if(D)for(const U of D)g.push(U)}}}g.sort(((w,A)=>A.intersectionZ-w.intersectionZ));const x=[];for(let w=u.length-1;w>=0;w--){const A=u[w];if(s(A))for(let R=g.length-1;R>=0;R--){const D=g[R].feature;if(D.layer&&m[D.layer.id]<w)break;x.push(D),g.pop()}else for(const R of t){const D=R[A];if(D)for(const U of D)x.push(U.feature)}}return x}queryRasterValue(t,s,u){const m=this.getOwnSource(t);return m?m.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):m.queryRasterArrayValue(s,u):(this.fire(new r.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,s,u){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Q,"queryRenderedFeatures.filter",s.filter,null,s),m=r.b6(s.filter));const g={},x=D=>{if(lu.has(D.type))return;const U=this.getOwnLayerSourceCache(D),F=g[U.id]=g[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(F.has3DLayers=!0),F.layers[D.fqid]=F.layers[D.fqid]||{styleLayer:D,targets:[]},F.layers[D.fqid].targets.push({filter:m})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const D of s.layers){const U=this._layers[D];if(!U)return this.fire(new r.y(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];x(U)}}else for(const D in this._layers)x(this._layers[D]);const w=this._queryRenderedFeatures(t,g,u),A=this._flattenAndSortRenderedFeatures(w),R=[];for(const D of A)r.ds(D.layer.id)===this.scope&&R.push(D);return R}queryRenderedFeatureset(t,s,u){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Q,"queryRenderedFeatures.filter",s.filter,null,s),m=r.b6(s.filter));const g="mock",x=[];if(s&&s.target)x.push(Object.assign({},s,{targetId:g,filter:m}));else{const D=this.getFeaturesetDescriptors();for(const U of D)x.push({targetId:g,filter:m,target:U});for(const{style:U}of this.fragments){const F=U.getFeaturesetDescriptors();for(const V of F)x.push({targetId:g,filter:m,target:V})}}const w=this.queryRenderedTargets(t,x,u),A=[],R=new Set;for(const D of w)for(const U of D.variants[g])po(U,D,R)||A.push(new r.dt(D,U));return A}queryRenderedTargets(t,s,u){const m={},g=(w,A,R,D)=>{const U=m[A.id]=m[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(U.layers[w.fqid]=U.layers[w.fqid]||{styleLayer:w,targets:[]},w.is3D(!!this.terrain)&&(U.has3DLayers=!0),!D)return R.uniqueFeatureID=!1,void U.layers[w.fqid].targets.push(R);U.layers[w.fqid].targets.push(Object.assign({},R,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const w of s)if("featuresetId"in w.target){const{featuresetId:A,importId:R}=w.target,D=this.getFragmentStyle(R);if(!D||!D._featuresetSelectors)continue;const U=D._featuresetSelectors[A];if(!U){this.fire(new r.y(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const F of U){const V=D.getOwnLayer(F.layerId);V&&!lu.has(V.type)&&g(V,D.getOwnLayerSourceCache(V),w,F)}}else if("layerId"in w.target){const{layerId:A}=w.target,R=this.getLayer(A);if(!R||lu.has(R.type))continue;g(R,this.getLayerSourceCache(R),w)}const x=this._queryRenderedFeatures(t,m,u);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,s,u){const m=[],g=!!this.map._showQueryGeometry,x=kr.createFromScreenPoints(t,u);for(const w in s){const A=ks(x,s[w],this._availableImages,u,g);Object.keys(A).length&&m.push(A)}if(this.placement)for(const w in s){if(!s[w].sourceCache._onlySymbols)continue;const A=Ls(x.screenGeometry,s[w],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&m.push(A)}return m}querySourceFeatures(t,s){const u=s&&s.filter;u&&this._validate(Q,"querySourceFeatures.filter",u,null,s);let m=[];const g=this.getOwnSourceCaches(t);for(const x of g)m=m.concat(oo(x,s));return m}addSourceType(t,s,u){return Oa.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(Oa.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,u={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const w in t)if(!r.by(t[w],m[w])){g=!0;break}if(!g)return;const x=this._getTransitionParameters();this.light.setLight(t,s,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const m=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const w="terrain-dem-src";this.addSource(w,u.source),u=r.dk(u),u=Object.assign(u,{source:w})}const g=Object.assign({},u),x={};if(this.terrain&&m){g.source=this.terrain.get().source;const w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(x.style=w.serialize())}if(this._validate(kt,"terrain",g,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,s),this.fire(new r.z("data",{dataType:"style"}))}else{const g=this.terrain,x=g.get();for(const w of Object.keys(r.a6.terrain))!u.hasOwnProperty(w)&&r.a6.terrain[w].default&&(u[w]=r.a6.terrain[w].default);for(const w in t)if(!r.by(t[w],x[w])){g.set(t,this.options),this.stylesheet.terrain=t;const A=this._getTransitionParameters({duration:0});g.updateTransitions(A),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Mn(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}_createSnow(t){const s=this.snow=new zr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}_createRain(t){const s=this.rain=new rr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!r.by(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!r.by(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!r.by(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const u=this._getTransitionParameters({duration:0});s.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(s);this._loadColorTheme(u).then((()=>{this.fire(new r.z("colorthemeset")),t()})).catch((m=>{r.w(`Couldn't set color theme: ${m}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=s,u._reloadColorTheme())}_getTransitionParameters(t){return{now:r.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):s.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const u=this.terrain=new st(t,s,this.scope,this.options,this.map.getWorldview());s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,u,m,g={}){if(g&&g.validate===!1)return!1;const x=Object.assign({},this.serialize());return ic(this,t.call(rs,Object.assign({key:s,style:x,value:u,styleSpec:r.a6},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const u of s)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const s=this._mergedLayers[t];s._clear&&s._clear()}}reloadSource(t){const s=this.getSourceCaches(t);for(const u of s)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let s;this.directionalLight&&(s=Ml(this.directionalLight));const u=new Set;for(const m in this._mergedLayers){const g=this._mergedLayers[m];g.hasElevation()&&!u.has(g.source)&&u.add(g.source)}for(const m in this._mergedSourceCaches){const g=this._mergedSourceCaches[m],x=u.has(g._source.id);g.update(t,void 0,void 0,s,x)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,u,m,g,x,w=!1){let A=!1,R=!1;const D={},U={};for(const F of this._mergedOrder){const V=this._mergedLayers[F];if(V.type!=="symbol")continue;const G=r.B(V.source,V.scope);let Z=D[G];if(!Z){const J=this.getLayerSourceCache(V);if(!J)continue;const ae=J.getRenderableIds(!0).map((me=>J.getTileByID(me)));U[G]=ae.slice(),Z=D[G]=ae.sort(((me,ye)=>ye.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ye.tileID)?-1:1)))}const ie=this.crossTileSymbolIndex.addLayer(V,Z,s.center.lng,s.projection);A=A||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),s.zoom))&&(this.pauseablePlacement=new Ks(s,this._mergedOrder,w,u,m,g,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),R=!0),A&&this.pauseablePlacement.placement.setStale()),R||A){this._buildingIndex.onNewFrame(s.zoom);for(let F=0;F<this._mergedOrder.length;F++){const V=this._mergedLayers[this._mergedOrder[F]];if(V.type!=="symbol")continue;const G=this.isLayerClipped(V);this.placement.updateLayerOpacities(V,D[r.B(V.source,V.scope)],F,G?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex((({id:g})=>g===t.id))!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return u.push(t),this._loadImports([t],!0);const m=u.findIndex((({id:g})=>g===s));return m===-1&&this.fire(new r.y(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,m).concat(t).concat(u.slice(m)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const u=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==u[m].url&&this.setImportUrl(t,s.url),r.by(s.config,u[m].config)||this.setImportConfig(t,s.config,s.data.schema),r.by(s.data,u[m].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let u=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const g=this.getImportIndex(s);if(g===-1)return this;const x=u[m],w=this.fragments[m];return u=u.filter((({id:A})=>A!==t)),this.fragments=this.fragments.filter((({id:A})=>A!==t)),this.stylesheet.imports=u.slice(0,g).concat(x).concat(u.slice(g)),this.fragments=this.fragments.slice(0,g).concat(w).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const u=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;u[m].url=s;const g=this.fragments[m];return g.style=this._createFragmentStyle(u[m]),g.style.on("style.import.load",(()=>this.mergeAll())),g.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const u=this.getImportIndex(t),m=this.stylesheet.imports||[];return u===-1?this:s?(this.fragments[u].style.setState(s),this._reloadImports(),this):(delete m[u].data,this.setImportUrl(t,m[u].url))}setImportConfig(t,s,u){this._checkLoaded();const m=this.getImportIndex(t),g=this.stylesheet.imports||[];if(m===-1)return this;s?g[m].config=s:delete g[m].config;const x=this.fragments[m];u&&x.style.stylesheet&&(x.style.stylesheet.schema=u);const w=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=s,x.style.updateConfig(s,w),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(s.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex((u=>u.id===t));return s===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[s];u&&t.push(u.getSource())}return t}getSource(t,s){const u=this.getSourceCache(t,s);return u&&u.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const u=r.B(t,s);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const s=r.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const u=t[s];u==="reload"?this.reloadSource(s):u==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const u of s){const m=this.getLayer(u);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,s,u){this.imageManager.getImages(s.images,s.scope,u),this._updateTilesForChangedImages();const m=x=>{if(x){const w=s.images.map((A=>r.I.toString(A)));x.setDependencies(s.tileID.key,s.type,w)}},g=r.B(s.source,s.scope);m(this._mergedOtherSourceCaches[g]),m(this._mergedSymbolSourceCaches[g]),s.images.some((x=>x.iconsetId))&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(t,s,u){this.imageManager.rasterizeImages(s,u)}getGlyphs(t,s,u){this.glyphManager.getGlyphs(s.stacks,u)}getResource(t,s,u){return r.dv(s,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):s.every((u=>u.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const u=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),m=t.type==="building";if(t.is3D(!!this.terrain)){if(u||m||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Oa.getSourceType=function(h){return aa[h]},Oa.setSourceType=function(h,t){aa[h]=t},Oa.registerForPluginStateChange=r.dw;class $a{execute(t){const s=this._makeBuildingsQueryArea(t),u=this._makeFloorsQueryArea(t),m=t.queryRenderedFeatures(s).reduce(((R,D)=>{const U=D.properties.id;return D.properties.type!=="building"||R.some((F=>F.properties.id===U))||R.push(D),R}),[]),g=t.queryRenderedFeatures(u).reduce(((R,D)=>{const U=D.properties.id;return D.properties.type!=="floor"||R.some((F=>F.properties.id===U))||R.push(D),R}),[]),x=[t.getCenter().lng,t.getCenter().lat],w=this._findBuildingAtCenter(x,m),A=m.length>0?m[0]:null;return{floors:g.map((R=>({id:R.properties.id,name:R.properties.name,isDefault:R.properties.is_default,zIndex:R.properties.z_index,connectedFloorIds:R.properties.connected_floor_ids,conflictedFloorIds:R.properties.conflicted_floor_ids,buildingIds:R.properties.building_ids}))),building:w?{id:w.properties.id,name:w.properties.name}:{id:A.properties.id,name:A.properties.name}}}_makeBuildingsQueryArea(t){const s=t.transform.width,u=t.transform.height,m=Math.min(s,u)*(1/8),g=.5*(s-m),x=.5*(u-m);return[new r.P(g,x),new r.P(g+m,x+m)]}_makeFloorsQueryArea(t){const s=t.transform.width,u=t.transform.height;return[new r.P(0,0),new r.P(s,u)]}_findBuildingAtCenter(t,s){for(const u of s)if(u.geometry.type==="Polygon"&&this._pointInPolygon(t,u.geometry.coordinates[0]))return u;return null}_pointInPolygon(t,s){let u=!1;for(let m=0,g=s.length-1;m<s.length;g=m++){const x=s[m][0],w=s[m][1],A=s[g][1];w>t[1]!=A>t[1]&&t[0]<(s[g][0]-x)*(t[1]-w)/(A-w)+x&&(u=!u)}return u}}class uu{constructor(){this._floors=new Map,this._buildings=new Map}append(t){const s=t.building;let u=!1;if(s){const m=s.id;m&&(this._buildings.set(m,s),u||this._buildings.has(m)||(u=!0))}return t.floors.forEach((m=>{const g=m.id;u||this._floors.has(g)||(u=!0),this._floors.set(g,m)})),u}clear(){this._floors.clear(),this._buildings.clear()}getFloors(t=null){const s=Array.from(this._floors.values());return t?s.filter((u=>{const m=u.buildingIds;return!!m&&m.split(";").includes(t)})):s}}class Xd{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new uu}setIndoorData(t){const s=this._featuresStorage.append(t);return this._selectedBuildingId=t.building?t.building.id:null,s}setFloorId(t){const s=this._selectedFloorId!==t;return s&&(this._selectedFloorId=t),s}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const t=this._featuresStorage.getFloors(this._selectedBuildingId),s=this.getActiveFloors().find((u=>{const m=u.buildingIds;if(!m)return!1;const g=m.split(";");return!!this._selectedBuildingId&&g.includes(this._selectedBuildingId)}));return{selectedFloorId:s?s.id:null,floors:t}}getActiveFloors(t=!1){const s=this._featuresStorage.getFloors(),u=s.find((A=>A.id===this._selectedFloorId)),m=s.filter((A=>A.isDefault===!0));let g=[];if(u)return g=this._calculateCurrentActiveFloors(s,u,m,t),g;if(m.length===0){const A=this._featuresStorage.getFloors(this._selectedBuildingId);g=A.length>0?[A[0]]:[]}else g=m;const x=this._getNonConflictingLastActiveFloors(g),w=[...g,...x];return this._lastActiveFloors=w,w}hasBuildingChanged(t){return this._selectedBuildingId!==(t.building?t.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(t,s,u,m){if(!s)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,u);const g=this._getConnectedFloors(s,t);return m?this._buildExplicitSelectionFloors(s,g,u):this._buildImplicitSelectionFloors(g,u)}_getConnectedFloors(t,s){const u=t.connectedFloorIds;if(!u)return[];const m=new Set(u.split(";"));return s.filter((g=>m.has(g.id)))}_buildExplicitSelectionFloors(t,s,u){const m=[t,...s],g=this._getNonConflictingLastActiveFloors(m),x=[...m,...g],w=this._deduplicateFloors(x),A=this._getConflictingFloorIdsFrom(w),R=u.filter((U=>!A.has(U.id))),D=[...w,...R];return this._lastActiveFloors=D,D}_buildImplicitSelectionFloors(t,s){const u=this._getConflictingFloorIdsFrom(this._lastActiveFloors),m=s.filter((x=>!u.has(x.id))),g=this._deduplicateFloors([...this._lastActiveFloors,...m]);return this._lastActiveFloors=g,g}_getNonConflictingDefaultFloors(t,s){const u=this._getConflictingFloorIdsFrom(t),m=s.filter((x=>!u.has(x.id))),g=this._deduplicateFloors([...t,...m]);return this._lastActiveFloors=g,g}_deduplicateFloors(t){const s=new Set;return t.filter((u=>{const m=u.id;return!s.has(m)&&(s.add(m),!0)}))}_getConflictingFloorIdsFrom(t){const s=new Set;return t.forEach((u=>{const m=u.conflictedFloorIds;m&&m.split(";").forEach((g=>s.add(g)))})),s}_getNonConflictingLastActiveFloors(t){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const s=new Set(t.map((m=>m.id))),u=this._getConflictingFloorIdsFrom(t);return this._lastActiveFloors.filter((m=>{const g=m.id;return!s.has(g)&&!u.has(g)}))}_isFloorConflicted(t,s){const u=t.id;return s.some((m=>{const g=m.conflictedFloorIds;return!!g&&g.split(";").includes(u)}))}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class nl extends r.E{constructor(t){super(),r.aY(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new Xd,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(t){this._floorSelectionState.setFloorId(t)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle((t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new r.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new $a))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const t=this._indoorDataQuery.execute(this._map);if(!t||t.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(t)){if(!t.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(t),t.building&&this._updateIndoorSelector()}else this._setIndoorData(t)}_setIndoorData(t){this._floorSelectionState.setIndoorData(t)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const t=this._floorSelectionState.getCurrentBuildingSelection(),s=t.floors.map((u=>({id:u.id,name:u.name,shortName:u.zIndex.toString(),levelOrder:u.zIndex})));this.fire(new r.z("indoorupdate",{selectedFloorId:t.selectedFloorId,floors:s}))}_updateIndoorConfig(t=!1){const s=this._floorSelectionState.getActiveFloors(t).map((u=>u.id))||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",s])}}var hu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,oh=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Xh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,rl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Rl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,du=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ha=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ah=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Zt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,lh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const nc=[];wa(hu,nc),wa(Xh,nc),wa(oh,nc);const sl={"_prelude_fog.vertex.glsl":Rl,"_prelude_terrain.vertex.glsl":Pc,"_prelude_shadow.vertex.glsl":Zt,"_prelude_fog.fragment.glsl":du,"_prelude_shadow.fragment.glsl":lh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ha,"_prelude_raster_particle.glsl":ah},fu={};Vn("",Pc),Vn(du,Rl),Vn(lh,Zt),Vn(ha,""),Vn(ah,"");const Ol=Vn(oh,Xh),da=hu;var pu={background:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Vn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Vn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Vn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Vn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Vn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Vn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Vn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Vn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Vn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Vn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Vn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Vn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Vn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Vn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Vn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Vn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rl),skyboxGradient:Vn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rl),skyboxCapture:Vn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Vn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Vn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Vn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Vn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Vn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Vn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function wa(h,t){const s=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of s)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=u.split(" ");for(const g of m)t.includes(g)||t.push(g)}}function Vn(h,t){const s=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,m={},g=[],x=[];if(h=h.replace(s,((A,R)=>(x.push(R),""))),(t=t.replace(s,((A,R)=>(g.push(R),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let w=[...nc];wa(h,w),wa(t,w);for(const A of[...g,...x])sl[A]||console.error(`Undefined include: ${A}`),fu[A]||(fu[A]=[],wa(sl[A],fu[A])),w=[...w,...fu[A]];return{fragmentSource:h=h.replace(u,((A,R,D,U,F)=>(m[F]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${D} ${U} ${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${D} ${U} ${F} = u_${F};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${D} ${U} ${F};
#endif
`:R==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(u,((A,R,D,U,F)=>{const V=U==="float"?"vec2":U,G=F.match(/color/)?"color":V;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${D} ${U} a_${F};
#endif
`:m[F]?R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${D} ${V} a_${F};
out ${D} ${U} ${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:R==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${D} ${U} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${G}(a_${F}, u_${F}_t);
#else
    ${D} ${U} ${F} = u_${F};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${D} ${U} a_${F};
    out ${D} ${U} ${F};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${D} ${V} a_${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:R==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${D} ${U} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${D} ${V} a_${F};
#else
uniform ${D} ${U} u_${F};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${D} ${U} ${F} = a_${F};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${D} ${U} ${F} = a_${F};
#else
    ${D} ${U} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${D} ${U} ${F} = unpack_mix_${G}(a_${F}, u_${F}_t);
#else
    ${D} ${U} ${F} = u_${F};
#endif
`})),usedDefines:w,vertexIncludes:g,fragmentIncludes:x}}class rc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,u,m,g,x,w,A){this.context=t;let R=this.boundPaintVertexBuffers.length!==m.length;for(let U=0;!R&&U<m.length;U++)this.boundPaintVertexBuffers[U]!==m[U]&&(R=!0);let D=this.boundDynamicVertexBuffers.length!==w.length;for(let U=0;!D&&U<w.length;U++)this.boundDynamicVertexBuffers[U]!==w[U]&&(D=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||R||D||this.boundIndexBuffer!==g||this.boundVertexOffset!==x)this.freshBind(s,u,m,g,x,w,A);else{t.bindVertexArrayOES.set(this.vao);for(const U of w)U&&(U.bind(),A&&U.instanceCount&&U.setVertexAttribDivisor(t.gl,s,A));g&&g.dynamicDraw&&g.bind()}}freshBind(t,s,u,m,g,x,w){const A=this.context,R=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=x,s.enableAttributes(R,t),s.bind(),s.setVertexAttribPointers(R,t,g);for(const D of u)D.enableAttributes(R,t),D.bind(),D.setVertexAttribPointers(R,t,g);for(const D of x)D&&(D.enableAttributes(R,t),D.bind(),D.setVertexAttribPointers(R,t,g),w&&D.instanceCount&&D.setVertexAttribDivisor(R,t,w));m&&m.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Kd(h,t){const s=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new r.ae(0,u/s).toLngLat().lat,new r.ae(0,(u+1)/s).toLngLat().lat]}function Yd(h,t,s,u,m,g,x){const w=h.context,A=w.gl,R=s.hillshadeFBO;if(!R)return;h.prepareDrawTile();const D=h.isTileAffectedByFog(t),U=h.getOrCreateProgram("hillshade",{overrideFog:D});w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());const F=((ie,J,ae,me)=>{const ye=ae.paint.get("hillshade-shadow-color"),Pe=ae.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=ae.paint.get("hillshade-highlight-color"),Me=ae.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ie=ae.paint.get("hillshade-accent-color"),Ee=ae.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Re=ae.paint.get("hillshade-emissive-strength");let nt=r.an(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")nt-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const gt=ie.style.directionalLight.properties.get("direction"),et=r.d3(gt.x,gt.y,gt.z);nt=r.an(et[1])}const We=!ie.options.moving;return{u_matrix:me||ie.transform.calculateProjMatrix(J.tileID.toUnwrapped(),We),u_image:0,u_latrange:Kd(0,J.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),nt],u_shadow:ye.toPremultipliedRenderColor(Pe?null:ae.lut),u_highlight:Ae.toPremultipliedRenderColor(Me?null:ae.lut),u_emissive_strength:Re,u_accent:Ie.toPremultipliedRenderColor(Ee?null:ae.lut)}})(h,s,u,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(w,U,t.toUnwrapped());const{tileBoundsBuffer:V,tileBoundsIndexBuffer:G,tileBoundsSegments:Z}=h.getTileBoundsBuffers(s);U.draw(h,A.TRIANGLES,m,g,x,Wi.disabled,F,u.id,V,G,Z)}function mu(h,t,s){if(!t.needsDEMTextureUpload)return;const u=h.context,m=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(s.stride);const g=s.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new r.T(u,g,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Jd(h,t,s){const u=h.context,m=u.gl;if(!t.dem)return;const g=t.dem;if(u.activeTexture.set(m.TEXTURE1),mu(h,t,g),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const x=g.dim;u.activeTexture.set(m.TEXTURE0);let w=t.hillshadeFBO;if(!w){const F=new r.T(u,{width:x,height:x,data:null},m.RGBA8);F.bind(m.LINEAR,m.CLAMP_TO_EDGE),w=t.hillshadeFBO=u.createFramebuffer(x,x,!0,"renderbuffer"),w.colorAttachment.set(F.texture)}u.bindFramebuffer.set(w.framebuffer),u.viewport.set([0,0,x,x]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:R,tileBoundsSegments:D}=h.getMercatorTileBoundsBuffers(),U=[];h.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),h.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(h,m.TRIANGLES,mi.disabled,Xi.disabled,cn.unblended,Wi.disabled,((F,V)=>{const G=V.stride,Z=r.bC();return r.cd(Z,0,r.al,-r.al,0,0,1),r.br(Z,Z,[0,-r.al,0]),{u_matrix:Z,u_image:1,u_dimension:[G,G],u_zoom:F.overscaledZ}})(t.tileID,g),s.id,A,R,D),t.needsHillshadePrepare=!1}class Jr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kh extends Jr{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ch extends Jr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Ap extends Jr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class _ extends Jr{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class E extends Jr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class z extends Jr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class $ extends Jr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class te extends Jr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ce extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class dt extends Jr{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vt extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Qt extends Jr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Li extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class mn extends Jr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class $n extends Jr{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _r extends Jr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Ro extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class lo extends Jr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Bo extends Jr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Jo=class extends Jr{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class Ll extends Jr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Qd extends Jr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Cc extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class uh extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class _u extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Yh extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class gu extends Jr{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Hs extends Jr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class yu extends Jr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class ef extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class tf extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Dl extends Jr{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class hh extends Dl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Jh extends Dl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ip extends Dl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Lv extends Jh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Pp=(h,t,s)=>({u_matrix:h,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),nf=(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:g,u_image0:0,u_frustum_tl:x,u_frustum_tr:w,u_frustum_br:A,u_frustum_bl:R,u_globe_pos:D,u_globe_radius:U,u_viewport:F,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:V,u_far_z_cutoff:G});function rf(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const Mc=new class{constructor(){this.operations={}}newMorphing(h,t,s,u,m){if(h in this.operations){const g=this.operations[h];g.to.tileID.key!==s.tileID.key&&(g.queued=s)}else this.operations[h]={startTime:u,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const s=this.operations[t];for(s.phase=(h-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Cp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Mp(h,t,s){if(t===0)return 0;const u=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*u}function Dv(h,t){const s=1<<h.z;return!t&&(h.x===0||h.x===s-1)||h.y===0||h.y===s-1}const vu=h=>({u_matrix:h});function xu(h,t,s,u,m){if(m>0){const g=r.o.now(),x=(g-h.timeAdded)/m,w=t?(g-t.timeAdded)/m:-1,A=s.getSource(),R=u.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!t||Math.abs(t.tileID.overscaledZ-R)>Math.abs(h.tileID.overscaledZ-R),U=D&&h.refreshedUponExpiration?1:r.aA(D?x:1-w,0,1);return t?{opacity:1,mix:1-U,isFading:x<1}:{opacity:U,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class q_ extends Fn{constructor(t){const s=Kn("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",s,!1),s.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class qa extends Fn{constructor(t){const s=Kn("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,u){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((g,x)=>{if(g[x.key]="",!this._tiles[x.key]){const w=new ko(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);w.state="loaded",this._tiles[x.key]=w}return g}),{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const u=Object.values(s);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class sf extends r.aO{constructor(t,s,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=u}}class Qh extends r.dH{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,m,g]=(function(A){const R=new r.bd,D=new r.b1,U=131;R.reserve(17161),D.reserve(33800);const F=r.al/128,V=r.al+F/2,G=V+F;for(let ie=-F;ie<G;ie+=F)for(let J=-F;J<G;J+=F){const ae=J<0||J>V||ie<0||ie>V?24575:0,me=r.aA(Math.round(J),0,r.al),ye=r.aA(Math.round(ie),0,r.al);R.emplaceBack(me+ae,ye)}const Z=(ie,J)=>{const ae=J*U+ie;D.emplaceBack(ae+1,ae,ae+U),D.emplaceBack(ae+U,ae+U+1,ae+1)};for(let ie=1;ie<129;ie++)for(let J=1;J<129;J++)Z(J,ie);return[0,129].forEach((ie=>{for(let J=0;J<130;J++)Z(J,ie),Z(ie,J)})),[R,D,32768]})(),x=t.context;this.gridBuffer=x.createVertexBuffer(u,r.bf.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=r.bg.simpleSegment(0,0,u.length,m.length),this.gridNoSkirtSegments=r.bg.simpleSegment(0,0,u.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new qa(s.map),this.orthoMatrix=r.bC(),r.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const w=x.gl;this._overlapStencilMode=new Xi({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new q_(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,s,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,g=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const w=t.terrain&&t.terrain.scope,A=m.get("source"),R=g?this._mockSourceCache:t.getSourceCache(A,w);if(!R)return void r.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=R,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(s,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),s.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const m=s!=null?u-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const g=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(g);let w=g-this._previousZoom;const A=this._previousUpdateTimestamp;let R=g;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(g-R)>.5&&(w=.5*(g-R+w)),w*m<0&&(R+=w)),this._evaluationZoom=R;const D=x.getExaggeration(R),U=D===x.getExaggeration(Math.max(0,R-.1));if(U&&Math.abs(D-this._exaggeration)<.01)return D;let F=Math.min(.1,.00375*(this._updateTimestamp-A));return(U||D<.1||Math.abs(w)<1e-4)&&(F=Math.min(.2,4*F)),r.ak(this._exaggeration,D,F)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map((A=>{const R=s.getTileByID(A).tileID;return R.projMatrix=u.calculateProjMatrix(R.toUnwrapped()),R}));(function(A,R){const D=R.transform.pointCoordinate(R.transform.getCameraPoint()),U=new r.P(D.x,D.y);A.sort(((F,V)=>{if(V.overscaledZ-F.overscaledZ)return V.overscaledZ-F.overscaledZ;const G=new r.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),Z=new r.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),ie=U.mult(1<<F.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(G)-ie.distSqr(Z)}))})(m,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},m.forEach((A=>{this.proxyToSource[A.key]={}})),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const A in x){const R=x[A];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,t[A],g),R.usedForTerrain))continue;const D=t[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[s.id]=m.map((A=>new sf(A,A.key,this.orthoMatrix))),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const w={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const R=this.terrainTileForTile[A.key];if(!R)continue;const D=R.tileID.key;D in w||(this._visibleDemTiles.push(R),w[D]=D)}}_assignTerrainTiles(t){this._initializing||t.forEach((s=>{if(this.terrainTileForTile[s.key])return;const u=this._findTileCoveringTileID(s,this.sourceCache);u&&(this.terrainTileForTile[s.key]=u)}))}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const u in this.terrainTileForTile){const m=this.terrainTileForTile[u],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),mu(this.painter,m,g))}}_prepareDemTileUniforms(t,s,u,m){if(!s||s.demTexture==null)return!1;const g=t.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-g.z),w=m||"";return u[`u_dem_tl${w}`]=[g.x*x%1,g.y*x%1],u[`u_dem_scale${w}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce(((u,m)=>{if(!m.dem)return u;const g=m.dem.tree.minimums[0];return g>0&&t++,u+g}),0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const u=this._getLoadedAreaMinimum(),m=new r.dI({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(m,{premultiply:!1}):g=this._emptyDEMTexture=new r.T(t,m,s.R32F,{premultiply:!1}),g}setupElevationDraw(t,s,u){const m=this.painter.context,g=m.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let w=null,A=null,R=1;if(u&&u.morphing&&this._useVertexMorphing){const V=u.morphing.srcDemTile,G=u.morphing.dstDemTile;R=u.morphing.phase,V&&G&&(this._prepareDemTileUniforms(t,V,x,"_prev")&&(A=V),this._prepareDemTileUniforms(t,G,x)&&(w=G))}const D=V=>V&&V.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let U=null;var F;if(this.enabled?A&&w?(U=w.demTexture,m.activeTexture.set(g.TEXTURE4),A.demTexture.bind(D(A),g.CLAMP_TO_EDGE),x.u_dem_lerp=R):(w=this.terrainTileForTile[t.tileID.key],U=this._prepareDemTileUniforms(t,w,x)?w.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,m.activeTexture.set(g.TEXTURE2),U&&(x.u_dem_size=(F=U).size[0]===1?1:F.size[0]-2,U.bind(D(w),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,s,x),u&&u.useMeterToDem&&w){const V=(1<<w.tileID.canonical.z)*r.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=V}if(u&&u.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),s.setTerrainUniformValues(m,x),this.painter.transform.projection.name==="globe"){const V=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,V)}}globeUniformValues(t,s,u){const m=t.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,r.al,0),u_tile_br_up:m.upVector(s,r.al,r.al),u_tile_bl_up:m.upVector(s,0,r.al),u_tile_up_scale:u?r.dJ(1):m.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(m,g,x,w,A){if(m.transform.projection.name==="globe")(function(R,D,U,F,V){const G=R.context,Z=G.gl;let ie,J;const ae=R.transform,me=r.dA(R,G,ae),ye=(gt,et)=>{if(J===et)return;const pt=[Cp[et],"PROJECTION_GLOBE_VIEW"];me&&pt.push("CUSTOM_ANTIALIASING");const Kt=R.isTileAffectedByFog(gt);ie=R.getOrCreateProgram("globeRaster",{defines:pt,overrideFog:Kt}),J=et},Pe=R.colorModeForRenderPass(),Ae=new mi(Z.LEQUAL,mi.ReadWrite,R.depthRangeFor3D);Mc.update(V);const Me=r.dB(ae),Ie=[r.aF(ae.center.lng),r.aJ(ae.center.lat)],Ee=R.globeSharedBuffers,Re=[ae.width*r.o.devicePixelRatio,ae.height*r.o.devicePixelRatio],nt=Float32Array.from(ae.globeMatrix),We={useDenormalizedUpVectorScale:!0};{const gt=R.transform,et=Mp(gt.zoom,D.exaggeration(),D.sourceCache._source.tileSize);J=-1;const pt=Z.TRIANGLES;for(const Kt of F){const it=U.getTile(Kt),Ve=Xi.disabled,bt=D.prevTerrainTileForTile[Kt.key],ct=D.terrainTileForTile[Kt.key];rf(bt,ct)&&Mc.newMorphing(Kt.key,bt,ct,V,250),G.activeTexture.set(Z.TEXTURE0),it.texture&&it.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const zt=Mc.getMorphValuesForProxy(Kt.key),Xt=zt?1:0;zt&&Object.assign(We,{morphing:{srcDemTile:zt.from,dstDemTile:zt.to,phase:r.dz(zt.phase)}});const hi=r.dC(Kt.canonical),qt=r.dD(hi.getCenter().lat),Ut=r.dE(Kt.canonical,hi,qt,gt.worldSize/gt._pixelsPerMercatorPixel),Bi=r.bk(r.dF(Kt.canonical)),Di=nf(gt.expandedFarZProjMatrix,nt,Me,Bi,r.aj(gt.zoom),Ie,gt.frustumCorners.TL,gt.frustumCorners.TR,gt.frustumCorners.BR,gt.frustumCorners.BL,gt.globeCenterInViewSpace,gt.globeRadius,Re,et,gt._farZ,Ut);if(ye(Kt,Xt),ie&&(D.setupElevationDraw(it,ie,We),R.uploadCommonUniforms(G,ie,Kt.toUnwrapped()),Ee)){const[Fi,Ri,on]=Ee.getGridBuffers(qt,et!==0);ie.draw(R,pt,Ae,Ve,Pe,Wi.backCCW,Di,"globe_raster",Fi,Ri,on)}}}if(Ee&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const gt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&gt.push("CUSTOM_ANTIALIASING"),ie=R.getOrCreateProgram("globeRaster",{defines:gt});for(const et of F){const{x:pt,y:Kt,z:it}=et.canonical,Ve=Kt===0,bt=Kt===(1<<it)-1,[ct,zt,Xt,hi]=Ee.getPoleBuffers(it,!1);if(hi&&(Ve||bt)){const qt=U.getTile(et);G.activeTexture.set(Z.TEXTURE0),qt.texture&&qt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let Ut=r.dG(it,pt,ae);const Bi=r.bk(r.dF(et.canonical)),Di=(Fi,Ri)=>Fi.draw(R,Z.TRIANGLES,Ae,Xi.disabled,Pe,Wi.disabled,nf(ae.expandedFarZProjMatrix,Ut,Ut,Bi,0,Ie,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Re,0,ae._farZ),"globe_pole_raster",Ri,Xt,hi);D.setupElevationDraw(qt,ie,We),R.uploadCommonUniforms(G,ie,et.toUnwrapped()),Ve&&R.renderDefaultNorthPole&&Di(ie,ct),bt&&R.renderDefaultSouthPole&&(Ut=r.cR(r.bC(),Ut,[1,-1,1]),Di(ie,zt))}}}})(m,g,x,w,A);else{const R=m.context,D=R.gl;let U,F;const V=m.shadowRenderer,G=Cl(m,m.longestCutoffRange),Z=Pe=>{if(F===Pe)return;const Ae=[];Ae.push(Cp[Pe]),G.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),V&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&Ae.push("NORMAL_OFFSET")),U=m.getOrCreateProgram("terrainRaster",{defines:Ae}),F=Pe},ie=m.colorModeForRenderPass(),J=new mi(D.LEQUAL,mi.ReadWrite,m.depthRangeFor3D);Mc.update(A);const ae=m.transform,me=Mp(ae.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ye=[0,0,0];if(V){const Pe=m.style.directionalLight,Ae=m.style.ambientLight;Pe&&Ae&&(ye=ua(m.style,Pe,Ae))}{F=-1;const Pe=D.TRIANGLES,[Ae,Me]=[g.gridIndexBuffer,g.gridSegments];for(const Ie of w){const Ee=x.getTile(Ie),Re=Xi.disabled,nt=g.prevTerrainTileForTile[Ie.key],We=g.terrainTileForTile[Ie.key];rf(nt,We)&&Mc.newMorphing(Ie.key,nt,We,A,250),R.activeTexture.set(D.TEXTURE0),Ee.texture&&Ee.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const gt=Mc.getMorphValuesForProxy(Ie.key),et=gt?1:0;let pt;gt&&(pt={morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:r.dz(gt.phase)}});const Kt=Pp(Ie.projMatrix,Dv(Ie.canonical,ae.renderWorldCopies)?me/10:me,ye);if(Z(et),!U)continue;g.setupElevationDraw(Ee,U,pt);const it=Ie.toUnwrapped();V&&V.setupShadows(it,U),m.uploadCommonUniforms(R,U,it,null,G),U.draw(m,Pe,J,Re,ie,Wi.backCCW,Kt,"terrain_raster",g.gridBuffer,Ae,Me)}}}})(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,u=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),w=s.style.order,A=[];let R=0;for(const D of g){const U=m.getTileByID(D.proxyTileKey),F=m.proxyCachedFBO[D.key]?m.proxyCachedFBO[D.key][t]:void 0,V=F!==void 0?m.renderCache[F]:this.pool[R++],G=F!==void 0;if(U.texture=V.tex,G&&!V.dirty){A.push(U.tileID);continue}let Z;u.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(u.clear({color:r.ao.transparent,stencil:0}),V.dirty=!1);for(let ie=x.start;ie<=x.end;++ie){const J=s.style._mergedLayers[w[ie]];if(J.isHidden(s.transform.zoom))continue;const ae=s.style.getLayerSourceCache(J),me=ae?this.proxyToSource[D.key][ae.id]:[D];if(!me)continue;const ye=me;u.viewport.set([0,0,V.fb.width,V.fb.height]),Z!==(ae?ae.id:null)&&(this._setupStencil(V,me,J,ae),Z=ae?ae.id:null),s.renderLayer(s,ae,J,ye)}if(this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const J=s.style._mergedLayers[w[ie]];if(J.isHidden(s.transform.zoom))continue;const ae=s.style.getLayerSourceCache(J),me=ae?this.proxyToSource[D.key][ae.id]:[D];if(!me)continue;const ye=me;u.viewport.set([0,0,V.fb.width,V.fb.height]),Z!==(ae?ae.id:null)&&(this._setupStencil(V,me,J,ae),Z=ae?ae.id:null),s.renderLayer(s,ae,J,ye)}this.renderedToTile?(V.dirty=!0,A.push(U.tileID)):G||--R,R===5&&(R=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let u=-1,m=s;for(let g=0;g<s;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?u=Math.max(u,g):m=Math.min(m,g);return m>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((s=>s.dem)).forEach((s=>{t=Math.min(t,s.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,s,u){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter((g=>g.dem)).map((g=>{const x=g.tileID,w=1<<x.overscaledZ,{x:A,y:R}=x.canonical,D=A/w,U=(A+1)/w,F=R/w,V=(R+1)/w;return{minx:D,miny:F,maxx:U,maxy:V,t:g.dem.tree.raycastRoot(D,F,U,V,t,s,u),tile:g}}));m.sort(((g,x)=>(g.t!==null?g.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE)));for(const g of m){if(g.t==null)return null;const x=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,s,u);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,s=t.gl,u=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new r.T(t,{width:u[0],height:u[1],data:null},s.RGBA8);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const g=t.createFramebuffer(u[0],u[1],!0,null);return g.colorAttachment.set(m.texture),g.depthAttachment=new Lv(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const s=this._style._mergedLayers[t],u=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!u&&s.shouldRedrape():!u&&s.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof sr){t=!0;break}if(!t)return;const s={};for(let u=0;u<this._style.order.length;++u){const m=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(m);if(g&&!s[g.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof r.ad){s[g.id]=!0;for(const x of this.proxyCoords){const w=this.proxyToSource[x.key][g.id];if(w)for(const A of w)this._clearRenderCacheForTile(g.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Wo){t=!0;break}if(!t)return;const s={};for(let u=0;u<this._style.order.length;++u){const m=this._style._mergedLayers[this._style.order[u]],g=this._style.getLayerSourceCache(m);if(!g||s[g.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const x=m.paint.get("raster-fade-duration");for(const w of this.proxyCoords){const A=this.proxyToSource[w.key][g.id];if(A)for(const R of A){const D=xu(g.getTile(R),g.findLoadedParent(R,0),g,this.painter.transform,x);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(g.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const u=[];this._pendingGroundEffectLayers=[];let m,g=0,x=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++g<s;)x=this._style._mergedLayers[t[g]];for(;g<s;++g){const w=this._style._mergedLayers[t[g]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?m===void 0&&(m=g):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),m!==void 0&&(u.push({start:m,end:g-1}),m=void 0)))}if(m!==void 0&&u.push({start:m,end:g-1}),u.length!==0){const w=u[u.length-1];this._pendingGroundEffectLayers.every((A=>A>w.end))||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let w=0;w<x.length;++w){const A=Object.values(x[w]);s.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,m=this._tilesDirty;for(let x=u.length-1;x>=0;x--){const w=u[x];if(s.getTileByID(w.key),s.proxyCachedFBO[w.key]!==void 0){const A=t[w.key],R=this.proxyToSource[w.key];let D=0;for(const U in R){const F=R[U],V=A[U];if(!V||V.length!==F.length||F.some(((G,Z)=>G!==V[Z]||m[U]&&m[U].hasOwnProperty(G.key)))){D=-1;break}++D}for(const U in s.proxyCachedFBO[w.key])s.renderCache[s.proxyCachedFBO[w.key][U]].dirty=D<0||D!==Object.values(A).length}}const g=[...this._drapedRenderBatches];g.sort(((x,w)=>w.end-w.start-(x.end-x.start)));for(const x of g)for(const w of u){if(s.proxyCachedFBO[w.key])continue;let A=s.renderCachePool.pop();A===void 0&&s.renderCache.length<50&&(A=s.renderCache.length,s.renderCache.push(this._createFBO())),A!==void 0&&(s.proxyCachedFBO[w.key]={},s.proxyCachedFBO[w.key][x.start]=A,s.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,u,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,x=g.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let w;if(u.isTileClipped())w=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Xi.disabled}_renderTileClippingMasks(t,s){const u=this.painter,m=this.painter.context,g=m.gl;u._tileClippingMaskIDs={},m.setColorMode(cn.disabled),m.setDepthMode(mi.disabled);const x=u.getOrCreateProgram("clippingMask");for(const w of t){const A=u._tileClippingMaskIDs[w.key]=--s;x.draw(u,g.TRIANGLES,mi.disabled,new Xi({func:g.ALWAYS,mask:0},A,255,g.KEEP,g.KEEP,g.REPLACE),cn.disabled,Wi.disabled,vu(w.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const u=[t.x,t.y,1,1];r.aC(u,u,s.pixelMatrixInverse),r.cJ(u,u,1/u[3]),u[0]/=s.worldSize,u[1]/=s.worldSize;const m=s._camera.position,g=r.ce(1,s.center.lat),x=[m[0],m[1],m[2]/g,0],w=r.d9([],u.slice(0,3),x);r.aw(w,w);const A=this.raycast(x,w,this._exaggeration);return A!==null&&A?(r.bH(x,x,w,A),x[3]=x[2],x[2]*=g,x):null}_setupProxiedCoordsForOrtho(t,s,u){if(t.getSource()instanceof r.aS)return this._setupProxiedCoordsForImageSource(t,s,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let A=0;A<g.length;A++){const R=g[A],D=this._findTileCoveringTileID(R,t);if(D){const U=this._createProxiedId(R,D,u[R.key]&&u[R.key][t.id]);m.push(U),this.proxyToSource[R.key][t.id]=[U]}}let x=!1;const w=new Set;for(let A=0;A<s.length;A++){const R=t.getTile(s[A]);if(!R||!R.hasData())continue;const D=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==R.tileID.canonical.z){const U=this.proxyToSource[D.tileID.key][t.id],F=this._createProxiedId(D.tileID,R,u[D.tileID.key]&&u[D.tileID.key][t.id]);U?U.splice(U.length-1,0,F):this.proxyToSource[D.tileID.key][t.id]=[F];const V=this.proxyToSource[D.tileID.key][t.id];w.has(V)||w.add(V),m.push(F),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const A of w)A.sort(((R,D)=>D.overscaledZ-R.overscaledZ))}_setupProxiedCoordsForImageSource(t,s,u){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords,x=t.getSource(),w=x.tileID;if(!w)return;const A=new r.P(w.x,w.y)._div(1<<w.z),R=x.coordinates.map(r.ae.fromLngLat).reduce(((U,F)=>(U.min.x=Math.min(U.min.x,F.x-A.x),U.min.y=Math.min(U.min.y,F.y-A.y),U.max.x=Math.max(U.max.x,F.x-A.x),U.max.y=Math.max(U.max.y,F.y-A.y),U)),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(U,F)=>{const V=U.wrap+U.canonical.x/(1<<U.canonical.z),G=U.canonical.y/(1<<U.canonical.z),Z=r.al/(1<<U.canonical.z),ie=F.wrap+F.canonical.x/(1<<F.canonical.z),J=F.canonical.y/(1<<F.canonical.z);return V+Z<ie+R.min.x||V>ie+R.max.x||G+Z<J+R.min.y||G>J+R.max.y};for(let U=0;U<g.length;U++){const F=g[U];for(let V=0;V<s.length;V++){const G=t.getTile(s[V]);if(!G||!G.hasData()||D(F,G.tileID))continue;const Z=this._createProxiedId(F,G,u[F.key]&&u[F.key][t.id]),ie=this.proxyToSource[F.key][t.id];ie?ie.push(Z):this.proxyToSource[F.key][t.id]=[Z],m.push(Z)}}}_createProxiedId(t,s,u){let m=this.orthoMatrix;if(u){const g=u.find((x=>x.key===s.tileID.key));if(g)return g}if(s.tileID.key!==t.key){const g=t.canonical.z-s.tileID.canonical.z;let x,w,A;m=r.bC();const R=s.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(x=r.al>>g,w=x*((s.tileID.canonical.x<<g)-t.canonical.x+R),A=x*((s.tileID.canonical.y<<g)-t.canonical.y)):(x=r.al<<-g,w=r.al*(s.tileID.canonical.x-(t.canonical.x+R<<-g)),A=r.al*(s.tileID.canonical.y-(t.canonical.y<<-g))),r.cd(m,0,x,0,x,0,1),r.br(m,m,[w,A,0])}return new sf(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let u=s.getTile(t);if(u&&u.hasData())return u;const m=this._findCoveringTileCache[s.id],g=m[t.key];if(u=g?s.getTileByID(g):null,u&&u.hasData()||g===null)return u;let x=u?u.tileID:t,w=x.overscaledZ;const A=s.getSource().minzoom,R=[];if(!g){const U=s.getSource().maxzoom;if(t.canonical.z>=U){const F=t.canonical.z-U;s.getSource().reparseOverscaled?(w=Math.max(t.canonical.z+2,s.transform.tileZoom),x=new r.aO(w,t.wrap,U,t.canonical.x>>F,t.canonical.y>>F)):F!==0&&(w=U,x=new r.aO(w,t.wrap,U,t.canonical.x>>F,t.canonical.y>>F))}x.key!==t.key&&(R.push(x.key),u=s.getTile(x))}const D=U=>{R.forEach((F=>{m[F]=U})),R.length=0};for(w-=1;w>=A&&(!u||!u.hasData());w--){u&&D(u.tileID.key);const U=x.calculateScaledKey(w);if(u=s.getTileByID(U),u&&u.hasData())break;const F=m[U];if(F===null)break;F===void 0?R.push(U):u=s.getTileByID(F)}return D(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[s.key]=!0}}function of(h,t,s){const u=(function(w,A,R){const D=r.bJ(A,w),U=r.bJ(R,[.2126,.7152,.0722]),F=(G,Z,ie)=>(1-ie)*G+ie*Z,V=F(1-.3*Math.min(U,1),1,Math.min(D+1,1));return F(.92,1,Math.asin(r.aA(A[2],-1,1))/Math.PI+.5)*V})(h,[0,0,1],t),m=[0,0,0];r.c4(m,s.slice(0,3),u);const g=[0,0,0];r.c4(g,t.slice(0,3),h[2]);const x=[0,0,0];return r.d7(x,m,g),r.da(x)}const Rp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Op=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class af{static cacheKey(t,s,u,m){let g=`${s}${m?m.cacheKey:""}`;for(const x of u)t.usedDefines.includes(x)&&(g+=`/${x}`);return g}constructor(t,s,u,m,g,x){const w=t.gl;this.program=w.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...x];let A=m?m.defines():[];A=A.concat(x.map((G=>`#define ${G}`)));const R=`#version 300 es
`;let D=R+A.concat("precision mediump float;",da,Ol.fragmentSource).join(`
`);for(const G of u.fragmentIncludes)D+=`
${sl[G]}`;D+=`
${u.fragmentSource}`;let U=R+A.concat("precision highp float;",da,Ol.vertexSource).join(`
`);for(const G of u.vertexIncludes)U+=`
${sl[G]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(U+=`
uniform int u_instanceID;
`),U+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(U=U.replaceAll("gl_InstanceID","u_instanceID"));const F=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(F,D),w.compileShader(F),w.attachShader(this.program,F);const V=w.createShader(w.VERTEX_SHADER);w.isContextLost()?this.failedToCreate=!0:(w.shaderSource(V,U),w.compileShader(V),w.attachShader(this.program,V),this.attributes={},w.linkProgram(this.program),w.deleteShader(V),w.deleteShader(F),this.fixedUniforms=g(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(G=>({u_instanceID:new r.cg(G)}))(t)),(x.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(G=>({u_dem:new r.cg(G),u_dem_prev:new r.cg(G),u_dem_tl:new r.cj(G),u_dem_scale:new r.ci(G),u_dem_tl_prev:new r.cj(G),u_dem_scale_prev:new r.ci(G),u_dem_size:new r.ci(G),u_dem_lerp:new r.ci(G),u_exaggeration:new r.ci(G),u_depth:new r.cg(G),u_depth_size_inv:new r.cj(G),u_depth_range_unpack:new r.cj(G),u_occluder_half_size:new r.ci(G),u_occlusion_depth_offset:new r.ci(G),u_meter_to_dem:new r.ci(G),u_label_plane_matrix_inv:new r.ck(G)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new r.ch(G),u_tile_tr_up:new r.ch(G),u_tile_br_up:new r.ch(G),u_tile_bl_up:new r.ch(G),u_tile_up_scale:new r.ci(G)}))(t)),x.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new r.ck(G),u_fog_range:new r.cj(G),u_fog_color:new r.d2(G),u_fog_horizon_blend:new r.ci(G),u_fog_vertical_limit:new r.cj(G),u_fog_temporal_offset:new r.ci(G),u_frustum_tl:new r.ch(G),u_frustum_tr:new r.ch(G),u_frustum_br:new r.ch(G),u_frustum_bl:new r.ch(G),u_globe_pos:new r.ch(G),u_globe_radius:new r.ci(G),u_globe_transition:new r.ci(G),u_is_globe:new r.cg(G),u_viewport:new r.cj(G)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new r.d2(G)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new r.ch(G),u_lighting_directional_dir:new r.ch(G),u_lighting_directional_color:new r.ch(G),u_ground_radiance:new r.ch(G)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new r.ck(G),u_light_matrix_1:new r.ck(G),u_fade_range:new r.cj(G),u_shadow_normal_offset:new r.ch(G),u_shadow_intensity:new r.ci(G),u_shadow_texel_size:new r.ci(G),u_shadow_map_resolution:new r.ci(G),u_shadow_direction:new r.ch(G),u_shadow_bias:new r.ch(G),u_shadowmap_0:new r.cg(G),u_shadowmap_1:new r.cg(G)}))(t)))}getAttributeLocation(t,s){let u=this.attributes[s];return u===void 0&&(u=this.attributes[s]=t.getAttribLocation(this.program,s)),u}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)u[m]&&u[m].set(this.program,m,s[m])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)u[m]&&u[m].set(this.program,m,s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)u[m].set(this.program,m,s[m])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)u[m].set(this.program,m,s[m])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)u[m].set(this.program,m,s[m])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const m in s)u[m].set(this.program,m,s[m])}_drawDebugWireframe(t,s,u,m,g,x,w,A,R,D){const U=t.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const F=t.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||t._terrain&&t._terrain.renderingToTexture||!Rp.includes(this.name))||!(!U.layers3D||!Op.includes(this.name))))return;const V=F.gl,G=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,F);if(!G)return;const Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");const ie=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});F.program.set(ie.program);const J=(ye,Pe,Ae)=>{if(Pe[ye]&&Ae[ye])for(const Me in Pe[ye])Ae[ye][Me]&&Ae[ye][Me].set(Ae.program,Me,Pe[ye][Me].current)};R&&R.setUniforms(ie.program,F,ie.binderUniforms,w,{zoom:A}),J("fixedUniforms",this,ie),J("terrainUniforms",this,ie),J("globeUniforms",this,ie),J("fogUniforms",this,ie),J("lightsUniforms",this,ie),J("shadowUniforms",this,ie),G.bind(),F.setColorMode(new cn([V.ONE,V.ONE_MINUS_SRC_ALPHA,V.ZERO,V.ONE],r.ao.transparent,[!0,!0,!0,!1])),F.setDepthMode(new mi(s.func===V.LESS?V.LEQUAL:s.func,mi.ReadOnly,s.range)),F.setStencilMode(Xi.disabled);const ae=3*x.primitiveLength*2,me=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=D||1;for(let Pe=0;Pe<ye;++Pe)ie.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pe),V.drawElements(V.LINES,ae,V.UNSIGNED_SHORT,me)}else D&&D>1?V.drawElementsInstanced(V.LINES,ae,V.UNSIGNED_SHORT,me,D):V.drawElements(V.LINES,ae,V.UNSIGNED_SHORT,me);g.bind(),F.program.set(this.program),F.setDepthMode(s),F.setStencilMode(u),F.setColorMode(m)}checkUniforms(t,s,u){if(this.fixedDefines.includes(s)){for(const m of Object.keys(u))if(!u[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${s} being defined`)}}draw(t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie){const J=t.context,ae=J.gl;if(this.failedToCreate)return;J.program.set(this.program),J.setDepthMode(u),J.setStencilMode(m),J.setColorMode(g),J.setCullFace(x);for(const Pe of Object.keys(this.fixedUniforms))this.fixedUniforms[Pe].set(this.program,Pe,w[Pe]);G&&G.setUniforms(this.program,J,this.binderUniforms,F,{zoom:V});const me={[ae.POINTS]:1,[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[s];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ye=ie&&ie>0?1:void 0;for(const Pe of U.get()){const Ae=Pe.vaos||(Pe.vaos={});if((Ae[A]||(Ae[A]=new rc)).bind(J,this,R,G?G.getPaintVertexBuffers():[],D,Pe.vertexOffset,Z||[],ye),this.forceManualRenderingForInstanceIDShaders){const Me=ie||1;for(let Ie=0;Ie<Me;++Ie)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ie),D?ae.drawElements(s,Pe.primitiveLength*me,ae.UNSIGNED_SHORT,Pe.primitiveOffset*me*2):ae.drawArrays(s,Pe.vertexOffset,Pe.vertexLength)}else ie&&ie>1?ae.drawElementsInstanced(s,Pe.primitiveLength*me,ae.UNSIGNED_SHORT,Pe.primitiveOffset*me*2,ie):D?ae.drawElements(s,Pe.primitiveLength*me,ae.UNSIGNED_SHORT,Pe.primitiveOffset*me*2):ae.drawArrays(s,Pe.vertexOffset,Pe.vertexLength);s===ae.TRIANGLES&&D&&this._drawDebugWireframe(t,u,m,g,D,Pe,F,V,G,ie)}}}function ed(h,t,s=0){const u=Math.pow(2,t.tileID.overscaledZ),m=t.tileSize*Math.pow(2,h.transform.tileZoom)/u,g=m*(t.tileID.canonical.x+t.tileID.wrap*u),x=m*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(t,1,h.transform.tileZoom),u_pixel_coord_upper:[g>>16,x>>16],u_pixel_coord_lower:[65535&g,65535&x],u_pattern_transition:s}}const dh={terrain:0,flat:1},Lp=r.bC(),td=(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J)=>{const ae=t.style.light,me=ae.properties.get("position"),ye=[me.x,me.y,me.z],Pe=r.dL();ae.properties.get("anchor")==="viewport"&&(r.dM(Pe,-t.transform.angle),r.dN(ye,ye,Pe));const Ae=ae.properties.get("color").toPremultipliedRenderColor(null),Me=t.transform,Ie={u_matrix:h,u_lightpos:ye,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+s,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:dh[R],u_base_type:dh[D],u_ao:m,u_edge_radius:g,u_width_scale:x,u_flood_light_color:G,u_vertical_scale:Z,u_flood_light_intensity:ie,u_ground_shadow_factor:J};return Me.projection.name==="globe"&&(Ie.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],Ie.u_zoom_transition=U,Ie.u_inv_rot_matrix=V,Ie.u_merc_center=F,Ie.u_up_dir=Me.projection.upVector(new r.cC(0,0,0),F[0]*r.al,F[1]*r.al),Ie.u_height_lift=A),Ie},Dp=(h,t,s,u,m,g)=>({u_matrix:h,u_edge_radius:t,u_width_scale:s,u_vertical_scale:u,u_height_type:dh[m],u_base_type:dh[g]}),G_=(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J)=>{const ae=td(h,t,s,u,m,g,x,w,R,D,U,F,V,G,Z,ie,1,[0,0,0]),me={u_height_factor:-Math.pow(2,w.overscaledZ)/A.tileSize/8};return Object.assign(ae,ed(t,A,J),me)},zp=(h,t,s)=>({u_matrix:h,u_emissive_strength:t,u_ground_shadow_factor:s}),bu=(h,t,s,u,m,g=0)=>Object.assign(zp(h,t,m),ed(s,u,g)),zv=(h,t,s,u)=>({u_matrix:h,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:u}),kv=(h,t,s,u,m,g,x=0)=>Object.assign(bu(h,t,s,u,g,x),{u_world:m}),Fv=(h,t)=>({u_matrix:h,u_ground_shadow_factor:t}),lf=(h,t,s,u,m)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:u,u_reset_depth:m}),Bv=(h,t,s,u,m,g,x)=>({u_matrix:h,u_normal_matrix:t,u_opacity:s,u_faux_facade_ao_intensity:u,u_camera_pos:m,u_tile_to_meter:g,u_facade_emissive_chance:x}),Nv=h=>({u_matrix:h}),kp=h=>({u_matrix:h}),Fp=(h,t,s,u,m,g,x,w)=>{const A=r.al/g.tileSize;return{u_matrix:h,u_inv_rot_matrix:t,u_camera_to_center_distance:s.getCameraToCenterDistance(w),u_extrude_scale:[s.pixelsToGLUnits[0]/A,s.pixelsToGLUnits[1]/A],u_zoom_transition:u,u_tile_id:x,u_merc_center:m}},Bp=(h,t,s=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:s}),fh=r.bC(),H_=(h,t,s,u,m,g,x)=>{const w=h.transform,A=w.projection.name==="globe",R=A?r.dO(w.zoom,t.canonical)*w._pixelsPerMercatorPixel:r.ay(s,1,g),D={u_matrix:t.projMatrix,u_extrude_scale:R,u_intensity:x,u_inv_rot_matrix:fh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=u,D.u_merc_center=m,D.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],D.u_zoom_transition=r.aj(w.zoom);const U=m[0]*r.al,F=m[1]*r.al;D.u_up_dir=w.projection.upVector(new r.cC(0,0,0),U,F)}return D};function Np(h,[t,s,u,m],[g,x]){if(g===x)return[0,0,0,0];const w=255*(h-1)/(h*(x-g));return[t*w,s*w,u*w,m*w]}function Up(h,t,[s,u]){return s===u?0:.5/h+(t-s)*(h-1)/(h*(u-s))}const cf=(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J,ae,me,ye)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:u,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:r.dQ(U.paint.get("raster-saturation")),u_contrast_factor:r.dP(U.paint.get("raster-contrast")),u_spin_weights:wu(U.paint.get("raster-hue-rotate")),u_perspective_transform:F,u_raster_elevation:V,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:A,u_colorization_mix:Np(r.dR,Z,J),u_colorization_offset:Up(r.dR,ie,J),u_color_ramp:G,u_texture_offset:[me/(ae+2*me),ae/(ae+2*me)],u_texture_res:[ae+2*me,ae+2*me],u_emissive_strength:ye});function wu(h){h*=Math.PI/180;const t=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Tu=.05,Rc=(h,t,s,u,m,g,x,w,A,R,D,U)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:u,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:R,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:x,u_merc_center:w,u_cutoff_params:A}),Vp=(h,t,s,u,m,g,x,w,A,R)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:u,u_color_ramp:g,u_velocity_res:m,u_max_speed:x,u_uv_offset:w,u_data_scale:[255*A[0],255*A[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[Tu,Tu]}),uf=(h,t,s,u,m,g,x,w,A,R)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:u,u_max_speed:m,u_speed_factor:g,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:[255*A[0],255*A[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[Tu,Tu]}),jp=r.bC(),$p=(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J,ae,me,ye,Pe,Ae,Me)=>{const Ie=m.transform,Ee={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Ie.getCameraToCenterDistance(ae),u_rotate_symbol:+s,u_aspect_ratio:Ie.width/Ie.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+R,u_elevation_from_sea:A?1:0,u_pitch_with_map:+u,u_texsize:D,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:jp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:jp,u_up_vector:[0,-1,0],u_color_adj_mat:Pe,u_icon_transition:Ae||0,u_gamma_scale:u?m.transform.getCameraToCenterDistance(ae)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Me||1,u_ground_shadow_factor:me,u_inv_matrix:r.bl(r.bC(),x),u_normal_scale:ye,u_lutTexture:vs.LUT};return ae.name==="globe"&&(Ee.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],Ee.u_zoom_transition=G,Ee.u_inv_rot_matrix=ie,Ee.u_merc_center=Z,Ee.u_camera_forward=Ie._camera.forward(),Ee.u_ecef_origin=r.dS(Ie.globeMatrix,V.toUnwrapped()),Ee.u_tile_matrix=Float32Array.from(Ie.globeMatrix),Ee.u_up_vector=J),Ee},hf=(h,t,s,u)=>({u_matrix:h,u_emissive_strength:t,u_opacity:s,u_color:u}),df=(h,t,s,u,m,g,x,w,A)=>Object.assign((function(R,D,U,F,V,G){const{width:Z,height:ie}=F.imageManager.getPixelSize(D),J=Math.pow(2,G.tileID.overscaledZ),ae=G.tileSize*Math.pow(2,F.transform.tileZoom)/J,me=ae*(G.tileID.canonical.x+G.tileID.wrap*J),ye=ae*G.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[Z,ie],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:V?[F.transform.width,-1*F.transform.height]:[1/r.ay(G,1,F.transform.tileZoom),1/r.ay(G,1,F.transform.tileZoom)],u_pixel_coord_upper:[me>>16,ye>>16],u_pixel_coord_lower:[65535&me,65535&ye]}})(0,g,x,u,w,A),{u_matrix:h,u_emissive_strength:t,u_opacity:s}),qp=new Float32Array(r.bA([])),ff=(h,t,s,u,m,g,x,w,A,R,D,U,F,V=[0,0,0],G)=>{const Z=m.style.light,ie=Z.properties.get("position"),J=[-ie.x,-ie.y,ie.z],ae=r.dL();Z.properties.get("anchor")==="viewport"&&(r.dM(ae,-m.transform.angle),r.dN(J,J,ae));const me=D.alphaMode==="MASK",ye=Z.properties.get("color").toNonPremultipliedRenderColor(null),Pe=F.paint.get("model-ambient-occlusion-intensity"),Ae=F.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return Ae.a=F.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:u||qp,u_lightpos:J,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:V,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+me,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:R,u_baseColorTexture:vs.BaseColor,u_metallicRoughnessTexture:vs.MetallicRoughness,u_normalTexture:vs.Normal,u_occlusionTexture:vs.Occlusion,u_emissionTexture:vs.Emission,u_lutTexture:vs.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Pe,u_emissive_strength:U,u_occlusionTextureTransform:G||[0,0,0,0]}},ph=(h,t=qp,s=qp)=>({u_matrix:h,u_instance:t,u_node_matrix:s}),Uv={fillExtrusion:h=>({u_matrix:new r.ck(h),u_lightpos:new r.ch(h),u_lightintensity:new r.ci(h),u_lightcolor:new r.ch(h),u_vertical_gradient:new r.ci(h),u_opacity:new r.ci(h),u_edge_radius:new r.ci(h),u_width_scale:new r.ci(h),u_ao:new r.cj(h),u_height_type:new r.cg(h),u_base_type:new r.cg(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_up_dir:new r.ch(h),u_height_lift:new r.ci(h),u_flood_light_color:new r.ch(h),u_vertical_scale:new r.ci(h),u_flood_light_intensity:new r.ci(h),u_ground_shadow_factor:new r.ch(h)}),fillExtrusionDepth:h=>({u_matrix:new r.ck(h),u_edge_radius:new r.ci(h),u_width_scale:new r.ci(h),u_vertical_scale:new r.ci(h),u_height_type:new r.cg(h),u_base_type:new r.cg(h)}),fillExtrusionPattern:h=>({u_matrix:new r.ck(h),u_lightpos:new r.ch(h),u_lightintensity:new r.ci(h),u_lightcolor:new r.ch(h),u_vertical_gradient:new r.ci(h),u_height_factor:new r.ci(h),u_edge_radius:new r.ci(h),u_width_scale:new r.ci(h),u_ao:new r.cj(h),u_height_type:new r.cg(h),u_base_type:new r.cg(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_up_dir:new r.ch(h),u_height_lift:new r.ci(h),u_image:new r.cg(h),u_texsize:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_tile_units_to_pixels:new r.ci(h),u_opacity:new r.ci(h),u_pattern_transition:new r.ci(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new r.ck(h),u_opacity:new r.ci(h),u_ao_pass:new r.ci(h),u_meter_to_tile:new r.ci(h),u_ao:new r.cj(h),u_flood_light_intensity:new r.ci(h),u_flood_light_color:new r.ch(h),u_attenuation:new r.ci(h),u_edge_radius:new r.ci(h),u_fb:new r.cg(h),u_fb_size:new r.ci(h),u_dynamic_offset:new r.ci(h)}),fill:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_ground_shadow_factor:new r.ch(h)}),fillPattern:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_image:new r.cg(h),u_texsize:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_tile_units_to_pixels:new r.ci(h),u_ground_shadow_factor:new r.ch(h),u_pattern_transition:new r.ci(h)}),fillOutline:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_world:new r.cj(h),u_ground_shadow_factor:new r.ch(h)}),fillOutlinePattern:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_world:new r.cj(h),u_image:new r.cg(h),u_texsize:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_tile_units_to_pixels:new r.ci(h),u_ground_shadow_factor:new r.ch(h),u_pattern_transition:new r.ci(h)}),building:h=>({u_matrix:new r.ck(h),u_normal_matrix:new r.ck(h),u_opacity:new r.ci(h),u_faux_facade_ao_intensity:new r.ci(h),u_camera_pos:new r.ch(h),u_tile_to_meter:new r.ci(h),u_facade_emissive_chance:new r.ci(h)}),buildingBloom:h=>({u_matrix:new r.ck(h)}),buildingDepth:h=>({u_matrix:new r.ck(h)}),elevatedStructuresDepth:h=>({u_matrix:new r.ck(h),u_depth_bias:new r.ci(h)}),elevatedStructures:h=>({u_matrix:new r.ck(h),u_ground_shadow_factor:new r.ch(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new r.ck(h),u_camera_pos:new r.ch(h),u_depth_bias:new r.ci(h),u_height_scale:new r.ci(h),u_reset_depth:new r.ci(h)}),circle:r.dV,collisionBox:h=>({u_matrix:new r.ck(h),u_inv_rot_matrix:new r.ck(h),u_camera_to_center_distance:new r.ci(h),u_extrude_scale:new r.cj(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_tile_id:new r.ch(h)}),collisionCircle:h=>({u_matrix:new r.ck(h),u_inv_matrix:new r.ck(h),u_camera_to_center_distance:new r.ci(h),u_viewport_size:new r.cj(h)}),debug:h=>({u_color:new r.dx(h),u_matrix:new r.ck(h),u_overlay:new r.cg(h),u_overlay_scale:new r.ci(h)}),clippingMask:h=>({u_matrix:new r.ck(h)}),heatmap:h=>({u_extrude_scale:new r.ci(h),u_intensity:new r.ci(h),u_matrix:new r.ck(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_up_dir:new r.ch(h)}),heatmapTexture:h=>({u_image:new r.cg(h),u_color_ramp:new r.cg(h),u_opacity:new r.ci(h)}),hillshade:h=>({u_matrix:new r.ck(h),u_image:new r.cg(h),u_latrange:new r.cj(h),u_light:new r.cj(h),u_shadow:new r.dx(h),u_highlight:new r.dx(h),u_emissive_strength:new r.ci(h),u_accent:new r.dx(h)}),hillshadePrepare:h=>({u_matrix:new r.ck(h),u_image:new r.cg(h),u_dimension:new r.cj(h),u_zoom:new r.ci(h)}),line:r.dU,linePattern:r.dT,raster:h=>({u_matrix:new r.ck(h),u_normalize_matrix:new r.ck(h),u_globe_matrix:new r.ck(h),u_merc_matrix:new r.ck(h),u_grid_matrix:new r.dy(h),u_tl_parent:new r.cj(h),u_scale_parent:new r.ci(h),u_fade_t:new r.ci(h),u_opacity:new r.ci(h),u_image0:new r.cg(h),u_image1:new r.cg(h),u_brightness_low:new r.ci(h),u_brightness_high:new r.ci(h),u_saturation_factor:new r.ci(h),u_contrast_factor:new r.ci(h),u_spin_weights:new r.ch(h),u_perspective_transform:new r.cj(h),u_raster_elevation:new r.ci(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_cutoff_params:new r.d2(h),u_colorization_mix:new r.d2(h),u_colorization_offset:new r.ci(h),u_color_ramp:new r.cg(h),u_texture_offset:new r.cj(h),u_texture_res:new r.cj(h),u_emissive_strength:new r.ci(h)}),rasterParticle:h=>({u_matrix:new r.ck(h),u_normalize_matrix:new r.ck(h),u_globe_matrix:new r.ck(h),u_merc_matrix:new r.ck(h),u_grid_matrix:new r.dy(h),u_tl_parent:new r.cj(h),u_scale_parent:new r.ci(h),u_fade_t:new r.ci(h),u_opacity:new r.ci(h),u_image0:new r.cg(h),u_image1:new r.cg(h),u_raster_elevation:new r.ci(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_cutoff_params:new r.d2(h)}),rasterParticleTexture:h=>({u_texture:new r.cg(h),u_opacity:new r.ci(h)}),rasterParticleDraw:h=>({u_particle_texture:new r.cg(h),u_particle_texture_side_len:new r.ci(h),u_tile_offset:new r.cj(h),u_velocity:new r.cg(h),u_color_ramp:new r.cg(h),u_velocity_res:new r.cj(h),u_max_speed:new r.ci(h),u_uv_offset:new r.cj(h),u_data_scale:new r.cj(h),u_data_offset:new r.ci(h),u_particle_pos_scale:new r.ci(h),u_particle_pos_offset:new r.cj(h)}),rasterParticleUpdate:h=>({u_particle_texture:new r.cg(h),u_particle_texture_side_len:new r.ci(h),u_velocity:new r.cg(h),u_velocity_res:new r.cj(h),u_max_speed:new r.ci(h),u_speed_factor:new r.ci(h),u_reset_rate:new r.ci(h),u_rand_seed:new r.ci(h),u_uv_offset:new r.cj(h),u_data_scale:new r.cj(h),u_data_offset:new r.ci(h),u_particle_pos_scale:new r.ci(h),u_particle_pos_offset:new r.cj(h)}),symbol:h=>({u_is_size_zoom_constant:new r.cg(h),u_is_size_feature_constant:new r.cg(h),u_size_t:new r.ci(h),u_size:new r.ci(h),u_camera_to_center_distance:new r.ci(h),u_rotate_symbol:new r.cg(h),u_aspect_ratio:new r.ci(h),u_fade_change:new r.ci(h),u_matrix:new r.ck(h),u_label_plane_matrix:new r.ck(h),u_coord_matrix:new r.ck(h),u_is_text:new r.cg(h),u_elevation_from_sea:new r.cg(h),u_pitch_with_map:new r.cg(h),u_texsize:new r.cj(h),u_texsize_icon:new r.cj(h),u_texture:new r.cg(h),u_texture_icon:new r.cg(h),u_gamma_scale:new r.ci(h),u_device_pixel_ratio:new r.ci(h),u_tile_id:new r.ch(h),u_zoom_transition:new r.ci(h),u_inv_rot_matrix:new r.ck(h),u_merc_center:new r.cj(h),u_camera_forward:new r.ch(h),u_tile_matrix:new r.ck(h),u_up_vector:new r.ch(h),u_ecef_origin:new r.ch(h),u_is_halo:new r.cg(h),u_icon_transition:new r.ci(h),u_color_adj_mat:new r.ck(h),u_scale_factor:new r.ci(h),u_ground_shadow_factor:new r.ch(h),u_inv_matrix:new r.ck(h),u_normal_scale:new r.ci(h),u_lutTexture:new r.cg(h)}),background:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_opacity:new r.ci(h),u_color:new r.dx(h)}),backgroundPattern:h=>({u_matrix:new r.ck(h),u_emissive_strength:new r.ci(h),u_opacity:new r.ci(h),u_image:new r.cg(h),u_pattern_tl:new r.cj(h),u_pattern_br:new r.cj(h),u_texsize:new r.cj(h),u_pattern_size:new r.cj(h),u_pixel_coord_upper:new r.cj(h),u_pixel_coord_lower:new r.cj(h),u_pattern_units_to_pixels:new r.cj(h)}),terrainRaster:h=>({u_matrix:new r.ck(h),u_image0:new r.cg(h),u_skirt_height:new r.ci(h),u_ground_shadow_factor:new r.ch(h)}),skybox:h=>({u_matrix:new r.ck(h),u_sun_direction:new r.ch(h),u_cubemap:new r.cg(h),u_opacity:new r.ci(h),u_temporal_offset:new r.ci(h)}),skyboxGradient:h=>({u_matrix:new r.ck(h),u_color_ramp:new r.cg(h),u_center_direction:new r.ch(h),u_radius:new r.ci(h),u_opacity:new r.ci(h),u_temporal_offset:new r.ci(h)}),skyboxCapture:h=>({u_matrix_3f:new r.dy(h),u_sun_direction:new r.ch(h),u_sun_intensity:new r.ci(h),u_color_tint_r:new r.d2(h),u_color_tint_m:new r.d2(h),u_luminance:new r.ci(h)}),globeRaster:h=>({u_proj_matrix:new r.ck(h),u_globe_matrix:new r.ck(h),u_normalize_matrix:new r.ck(h),u_merc_matrix:new r.ck(h),u_zoom_transition:new r.ci(h),u_merc_center:new r.cj(h),u_image0:new r.cg(h),u_grid_matrix:new r.dy(h),u_skirt_height:new r.ci(h),u_far_z_cutoff:new r.ci(h),u_frustum_tl:new r.ch(h),u_frustum_tr:new r.ch(h),u_frustum_br:new r.ch(h),u_frustum_bl:new r.ch(h),u_globe_pos:new r.ch(h),u_globe_radius:new r.ci(h),u_viewport:new r.cj(h)}),globeAtmosphere:h=>({u_frustum_tl:new r.ch(h),u_frustum_tr:new r.ch(h),u_frustum_br:new r.ch(h),u_frustum_bl:new r.ch(h),u_horizon:new r.ci(h),u_transition:new r.ci(h),u_fadeout_range:new r.ci(h),u_atmosphere_fog_color:new r.d2(h),u_high_color:new r.d2(h),u_space_color:new r.d2(h),u_temporal_offset:new r.ci(h),u_horizon_angle:new r.ci(h)}),model:h=>({u_matrix:new r.ck(h),u_lighting_matrix:new r.ck(h),u_normal_matrix:new r.ck(h),u_node_matrix:new r.ck(h),u_lightpos:new r.ch(h),u_lightintensity:new r.ci(h),u_lightcolor:new r.ch(h),u_camera_pos:new r.ch(h),u_opacity:new r.ci(h),u_baseColorFactor:new r.d2(h),u_emissiveFactor:new r.d2(h),u_metallicFactor:new r.ci(h),u_roughnessFactor:new r.ci(h),u_baseTextureIsAlpha:new r.cg(h),u_alphaMask:new r.cg(h),u_alphaCutoff:new r.ci(h),u_baseColorTexture:new r.cg(h),u_metallicRoughnessTexture:new r.cg(h),u_normalTexture:new r.cg(h),u_occlusionTexture:new r.cg(h),u_emissionTexture:new r.cg(h),u_lutTexture:new r.cg(h),u_color_mix:new r.d2(h),u_aoIntensity:new r.ci(h),u_emissive_strength:new r.ci(h),u_occlusionTextureTransform:new r.d2(h)}),modelDepth:h=>({u_matrix:new r.ck(h),u_instance:new r.ck(h),u_node_matrix:new r.ck(h)}),groundShadow:h=>({u_matrix:new r.ck(h),u_ground_shadow_factor:new r.ch(h)}),stars:h=>({u_matrix:new r.ck(h),u_up:new r.ch(h),u_right:new r.ch(h),u_intensity_multiplier:new r.ci(h)}),snowParticle:h=>({u_modelview:new r.ck(h),u_projection:new r.ck(h),u_time:new r.ci(h),u_cam_pos:new r.ch(h),u_velocityConeAperture:new r.ci(h),u_velocity:new r.ci(h),u_horizontalOscillationRadius:new r.ci(h),u_horizontalOscillationRate:new r.ci(h),u_boxSize:new r.ci(h),u_billboardSize:new r.ci(h),u_simpleShapeParameters:new r.cj(h),u_screenSize:new r.cj(h),u_thinningCenterPos:new r.cj(h),u_thinningShape:new r.ch(h),u_thinningAffectedRatio:new r.ci(h),u_thinningParticleOffset:new r.ci(h),u_particleColor:new r.d2(h),u_direction:new r.ch(h)}),rainParticle:h=>({u_modelview:new r.ck(h),u_projection:new r.ck(h),u_time:new r.ci(h),u_cam_pos:new r.ch(h),u_texScreen:new r.cg(h),u_velocityConeAperture:new r.ci(h),u_velocity:new r.ci(h),u_boxSize:new r.ci(h),u_rainDropletSize:new r.cj(h),u_distortionStrength:new r.ci(h),u_rainDirection:new r.ch(h),u_color:new r.d2(h),u_screenSize:new r.cj(h),u_thinningCenterPos:new r.cj(h),u_thinningShape:new r.ch(h),u_thinningAffectedRatio:new r.ci(h),u_thinningParticleOffset:new r.ci(h),u_shapeDirectionalPower:new r.ci(h),u_shapeNormalPower:new r.ci(h),u_mode:new r.ci(h)}),vignette:h=>({u_vignetteShape:new r.ch(h),u_vignetteColor:new r.d2(h)}),occlusion:h=>({u_matrix:new r.ck(h),u_anchorPos:new r.ch(h),u_screenSizePx:new r.cj(h),u_occluderSizePx:new r.cj(h),u_color:new r.d2(h)})};class Oc{constructor(t,s,u,m){this.id=Oc.uniqueIdxCounter,Oc.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Oc.uniqueIdxCounter,Oc.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Oc.uniqueIdxCounter=0;const Z_={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vv{constructor(t,s,u,m,g,x){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=x,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||g||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let u=0;u<this.attributes.length;u++){const m=s.getAttributeLocation(t,this.attributes[u].name);m!==-1&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,u){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],x=s.getAttributeLocation(t,g.name);x!==-1&&t.vertexAttribPointer(x,g.components,t[Z_[g.type]],!1,this.itemSize,g.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,s,u){for(let m=0;m<this.attributes.length;m++){const g=s.getAttributeLocation(t,this.attributes[m].name);g!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pf{constructor(t,s,u,m,g){this.context=t,this.width=s,this.height=u;const x=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new hh(t,x)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new Jh(t,x):new Ip(t,x))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class Gp{constructor(t,s){this.gl=t,this.clearColor=new Kh(this),this.clearDepth=new ch(this),this.clearStencil=new Ap(this),this.colorMask=new _(this),this.depthMask=new E(this),this.stencilMask=new z(this),this.stencilFunc=new $(this),this.stencilOp=new te(this),this.stencilTest=new Ce(this),this.depthRange=new dt(this),this.depthTest=new Vt(this),this.depthFunc=new Qt(this),this.blend=new Li(this),this.blendFunc=new mn(this),this.blendColor=new $n(this),this.blendEquation=new _r(this),this.cullFace=new Ro(this),this.cullFaceSide=new lo(this),this.frontFace=new Bo(this),this.program=new Jo(this),this.activeTexture=new Ll(this),this.viewport=new Qd(this),this.bindFramebuffer=new Cc(this),this.bindRenderbuffer=new uh(this),this.bindTexture=new _u(this),this.bindVertexBuffer=new Yh(this),this.bindElementBuffer=new gu(this),this.bindVertexArrayOES=new Hs(this),this.pixelStoreUnpack=new yu(this),this.pixelStoreUnpackPremultiplyAlpha=new ef(this),this.pixelStoreUnpackFlipY=new tf(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,u){return new Oc(this,t,s,u)}createVertexBuffer(t,s,u,m,g){return new Vv(this,t,s,u,m,g)}createRenderbuffer(t,s,u){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,t,s,u),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,u,m){return new pf(this,t,s,u,m)}clear({color:t,depth:s,stencil:u,colorMask:m}){const g=this.gl;let x=0;t&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),g.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.by(t.blendFunction,cn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let zl;function id(h,t,s,u,m,g,x){const w=h.context,A=w.gl,R=h.transform,D=[r.aF(R.center.lng),r.aJ(R.center.lat)],U=s.layout.get("symbol-placement"),F=s.layout.get("text-variable-anchor"),V=s.layout.get("icon-rotation-alignment")==="map",G=s.layout.get("text-rotation-alignment")==="map",Z=U!=="point",ie=[];let J=0,ae=0;for(let Ee=0;Ee<u.length;Ee++){const Re=u[Ee],nt=t.getTile(Re),We=nt.getBucket(s);if(!We)continue;const gt=We.getProjection().createInversionMatrix(R,Re.canonical),et=[],pt=Ca(Re,We,R),Kt=!x&&V&&Z,it=x&&G&&Z,Ve=F&&We.hasTextData(),bt=We.hasIconTextFit()&&Ve&&We.hasIconData(),ct=Kt||it||x&&Ve||bt,zt=We.projection.name==="globe",Xt=zt?r.aj(R.zoom):0;zt&&(et.push("PROJECTION_GLOBE_VIEW"),ct&&et.push("PROJECTED_POS_ON_VIEWPORT"));const hi=h.getOrCreateProgram("collisionBox",{defines:et});let qt=pt;m[0]===0&&m[1]===0||(qt=h.translatePosMatrix(pt,nt,m,g));const Ut=x?We.textCollisionBox:We.iconCollisionBox,Bi=We.collisionCircleArray;if(Bi.length>0){const Fi=r.bC(),Ri=qt;r.cO(Fi,We.placementInvProjMatrix,R.glCoordMatrix),r.cO(Fi,Fi,We.placementViewportMatrix),ie.push({circleArray:Bi,circleOffset:ae,transform:Ri,invTransform:Fi,projection:We.getProjection()}),J+=Bi.length/4,ae=J}if(!Ut)continue;h.terrain&&h.terrain.setupElevationDraw(nt,hi);const Di=zt?[Re.canonical.x,Re.canonical.y,1<<Re.canonical.z]:[0,0,0];hi.draw(h,A.LINES,mi.disabled,Xi.disabled,h.colorModeForRenderPass(),Wi.disabled,Fp(qt,gt,R,Xt,D,nt,Di,We.getProjection()),s.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,null,R.zoom,null,[Ut.collisionVertexBuffer,Ut.collisionVertexBufferExt])}if(!x||!ie.length)return;const me=h.getOrCreateProgram("collisionCircle"),ye=new r.dW;ye.resize(4*J),ye._trim();let Pe=0;for(const Ee of ie)for(let Re=0;Re<Ee.circleArray.length/4;Re++){const nt=4*Re,We=Ee.circleArray[nt+0],gt=Ee.circleArray[nt+1],et=Ee.circleArray[nt+2],pt=Ee.circleArray[nt+3];ye.emplace(Pe++,We,gt,et,pt,0),ye.emplace(Pe++,We,gt,et,pt,1),ye.emplace(Pe++,We,gt,et,pt,2),ye.emplace(Pe++,We,gt,et,pt,3)}(!zl||zl.length<2*J)&&(zl=(function(Ee){const Re=2*Ee,nt=new r.b1;nt.resize(Re),nt._trim();for(let We=0;We<Re;We++){const gt=6*We;nt.uint16[gt+0]=4*We+0,nt.uint16[gt+1]=4*We+1,nt.uint16[gt+2]=4*We+2,nt.uint16[gt+3]=4*We+2,nt.uint16[gt+4]=4*We+3,nt.uint16[gt+5]=4*We+0}return nt})(J));const Ae=w.createIndexBuffer(zl,!0),Me=w.createVertexBuffer(ye,r.dX.members,!0);for(const Ee of ie){const Re={u_matrix:Ee.transform,u_inv_matrix:Ee.invTransform,u_camera_to_center_distance:(Ie=R).getCameraToCenterDistance(Ee.projection),u_viewport_size:[Ie.width,Ie.height]};me.draw(h,A.TRIANGLES,mi.disabled,Xi.disabled,h.colorModeForRenderPass(),Wi.disabled,Re,s.id,Me,Ae,r.bg.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,R.zoom)}var Ie;Me.destroy(),Ae.destroy()}const Lc=r.bC();function Hp(h){const t=h._camera.getWorldToCamera(h.worldSize,1),s=r.aB([],t,h.globeMatrix);r.bl(s,s);const u=[0,0,0],m=[0,1,0,0];return r.aC(m,m,s),u[0]=m[0],u[1]=m[1],u[2]=m[2],r.aw(u,u),u}function mf({width:h,height:t,anchor:s,textOffset:u,textScale:m},g){const{horizontalAlign:x,verticalAlign:w}=r.c0(s),A=-(x-.5)*h,R=-(w-.5)*t,D=r.c1(s,u);return new r.P((A/m+D[0])*g,(R/m+D[1])*g)}function _f(h,t,s,u,m,g,x,w,A,R){const D=h.text.placedSymbolArray,U=h.text.dynamicLayoutVertexArray,F=h.icon.dynamicLayoutVertexArray,V={},G=h.getProjection(),Z=ca(x,G,m),ie=m.elevation,J=G.upVectorScale(x.canonical,m.center.lat,m.worldSize).metersToTile;U.clear();for(let ae=0;ae<D.length;ae++){const me=D.get(ae),{tileAnchorX:ye,tileAnchorY:Pe,numGlyphs:Ae}=me,Me=me.hidden||!me.crossTileID||h.allowVerticalPlacement&&!me.placedOrientation?null:u[me.crossTileID];if(Me){let Ie=0,Ee=0,Re=0;if(ie){const bt=ie?ie.getAtTileOffset(x,ye,Pe):0,[ct,zt,Xt]=G.upVector(x.canonical,ye,Pe);Ie=bt*ct*J,Ee=bt*zt*J,Re=bt*Xt*J}let[nt,We,gt,et]=wr(me.projectedAnchorX+Ie,me.projectedAnchorY+Ee,me.projectedAnchorZ+Re,s?Z:g);const pt=ys(m.getCameraToCenterDistance(G),et);let Kt=r.bM(h.textSizeData,A,me)*pt/r.bX;s&&(Kt*=h.tilePixelRatio/w);const it=mf(Me,Kt);s?({x:nt,y:We,z:gt}=G.projectTilePoint(ye+it.x,Pe+it.y,x.canonical),[nt,We,gt]=wr(nt+Ie,We+Ee,gt+Re,g)):(t&&it._rotate(-m.angle),nt+=it.x,We+=it.y,gt=0);const Ve=h.allowVerticalPlacement&&me.placedOrientation===r.bL.vertical?Math.PI/2:0;for(let bt=0;bt<Ae;bt++)r.bO(U,nt,We,gt,Ve);R&&me.associatedIconIndex>=0&&(V[me.associatedIconIndex]={x:nt,y:We,z:gt,angle:Ve})}else Mi(Ae,U)}if(R){F.clear();const ae=h.icon.placedSymbolArray;for(let me=0;me<ae.length;me++){const ye=ae.get(me),{numGlyphs:Pe}=ye,Ae=V[me];if(ye.hidden||!Ae)Mi(Pe,F);else{const{x:Me,y:Ie,z:Ee,angle:Re}=Ae;for(let nt=0;nt<Pe;nt++)r.bO(F,Me,Ie,Ee,Re)}}h.icon.dynamicLayoutVertexBuffer.updateData(F)}h.text.dynamicLayoutVertexBuffer.updateData(U)}function nd(h,t,s,u,m,g,x={}){const w=s.paint.get("icon-translate"),A=s.paint.get("text-translate"),R=s.paint.get("icon-translate-anchor"),D=s.paint.get("text-translate-anchor"),U=s.layout.get("icon-rotation-alignment"),F=s.layout.get("text-rotation-alignment"),V=s.layout.get("icon-pitch-alignment"),G=s.layout.get("text-pitch-alignment"),Z=s.layout.get("icon-keep-upright"),ie=s.layout.get("text-keep-upright"),J=s.paint.get("icon-color-saturation"),ae=s.paint.get("icon-color-contrast"),me=s.paint.get("icon-color-brightness-min"),ye=s.paint.get("icon-color-brightness-max"),Pe=s.layout.get("symbol-elevation-reference")==="sea",Ae=s.layout.get("icon-image-use-theme")==="none",Me=h.context,Ie=Me.gl,Ee=h.transform,Re=U==="map",nt=F==="map",We=V==="map",gt=G==="map",et=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let pt=!1;const Kt=h.depthModeForSublayer(0,mi.ReadOnly),it=new mi(h.context.gl.LEQUAL,mi.ReadOnly,h.depthRangeFor3D),Ve=[r.aF(Ee.center.lng),r.aJ(Ee.center.lat)],bt=s.layout.get("text-variable-anchor"),ct=Ee.projection.name==="globe",zt=[],Xt=[0,-1,0];for(const hi of u){const qt=t.getTile(hi),Ut=qt.getBucket(s);if(!Ut||Ut.projection.name==="mercator"&&ct||Ut.fullyClipped)continue;const Bi=Ut.projection.name==="globe",Di=Bi?r.aj(Ee.zoom):0,Fi=ca(hi,Ut.getProjection(),Ee),Ri=Ee.calculatePixelsToTileUnitsMatrix(qt),on=bt&&Ut.hasTextData(),xn=Ut.hasIconTextFit()&&on&&Ut.hasIconData(),wn=Ut.getProjection().createInversionMatrix(Ee,hi.canonical),gr=(1<<qt.tileID.canonical.z)*r.al/h.transform.worldSize,hn=es=>{let Tn=[0,0,0];if(es){const nn=h.style.directionalLight,yr=h.style.ambientLight;nn&&yr&&(Tn=ua(h.style,nn,yr))}return Tn},nr=es=>{Ee.depthOcclusionForSymbolsAndCircles&&(s.hasOcclusionOpacityProperties||h.terrain)&&(es.push("DEPTH_D24"),es.push("DEPTH_OCCLUSION"))},mr=es=>{s.lut&&!Ae&&(s.lut.texture||(s.lut.texture=new r.dY(h.context,s.lut.image,[s.lut.image.height,s.lut.image.height,s.lut.image.height],Me.gl.RGBA8)),Me.activeTexture.set(Me.gl.TEXTURE0+vs.LUT),s.lut.texture&&s.lut.texture.bind(Me.gl.LINEAR,Me.gl.CLAMP_TO_EDGE),es.push("APPLY_LUT_ON_GPU"))},Hr=()=>{const es=Re&&s.layout.get("symbol-placement")!=="point",Tn=[];nr(Tn),mr(Tn);const nn=es||xn,yr=Ut.elevationType==="road",bs=h.shadowRenderer,os=yr&&We&&!!bs&&bs.enabled,Zs=hn(os),Oo=yr&&We&&!h.terrain?it:Kt,Ha=s.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&We&&Tn.push("PITCH_WITH_MAP_TERRAIN"),Bi&&(Tn.push("PROJECTION_GLOBE_VIEW"),nn&&Tn.push("PROJECTED_POS_ON_VIEWPORT")),Ha>0&&Ut.hasAnySecondaryIcon&&Tn.push("ICON_TRANSITION"),!Ut.icon.zOffsetVertexBuffer||yr&&h.terrain||Tn.push("Z_OFFSET"),J===0&&ae===0&&me===0&&ye===1||Tn.push("COLOR_ADJUSTMENT"),Ut.sdfIcons&&Tn.push("RENDER_SDF"),os&&Tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yr&&We&&!h.terrain&&Ut.icon.orientationVertexBuffer&&Tn.push("ELEVATED_ROADS");const Za=Ut.icon.programConfigurations.get(s.id),Da=h.getOrCreateProgram("symbol",{config:Za,defines:Tn}),za=qt.imageAtlasTexture?qt.imageAtlasTexture.size:[0,0],pa=Ut.iconSizeData,ol=r.bK(pa,Ee.zoom),vl=We||!Ee.isOrthographic,Is=Ii(Fi,qt.tileID.canonical,We,Re,Ee,Ut.getProjection(),Ri),Ms=Un(Fi,qt.tileID.canonical,We,Re,Ee,Ut.getProjection(),Ri),as=h.translatePosMatrix(Ms,qt,w,R,!0),to=h.translatePosMatrix(Fi,qt,w,R),xo=nn?Lc:Is,Us=Re&&!We&&!es;let qo=Xt;!ct&&!Ee.mercatorFromTransition||Re||(qo=Hp(Ee));const Nl=Bi?qo:Xt,cc=s.getColorAdjustmentMatrix(J,ae,me,ye),xl=$p(pa.kind,ol,Us,We,h,to,xo,as,Pe,!1,za,[0,0],0,hi,Di,Ve,wn,Nl,Ut.getProjection(),Zs,gr,cc,Ha,null),jc=qt.imageAtlasTexture?qt.imageAtlasTexture:null,$c=s.layout.get("icon-size").constantOr(0)!==1||Ut.iconsNeedLinear,Ul=Ut.sdfIcons||h.options.rotating||h.options.zooming||$c||vl?Ie.LINEAR:Ie.NEAREST,Ah=Ut.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,uc=h.terrain&&We&&es?r.bl(r.bC(),Is):Lc;if(es&&Ut.icon){const Vl=Ee.elevation,hc=Vl?Vl.getAtTileOffsetFunc(hi,Ee.center.lat,Ee.worldSize,Ut.getProjection()):null,Ff=Xr(Fi,qt.tileID.canonical,We,Re,Ee,Ut.getProjection(),Ri);_s(Ut,Fi,h,!1,Ff,Ms,We,Z,hc,hi)}return{program:Da,buffers:Ut.icon,uniformValues:xl,atlasTexture:jc,atlasTextureIcon:null,atlasInterpolation:Ul,atlasInterpolationIcon:null,isSDF:Ut.sdfIcons,hasHalo:Ah,depthMode:Oo,tile:qt,renderWithShadows:os,labelPlaneMatrixInv:uc}},bn=()=>{const es=nt&&s.layout.get("symbol-placement")!=="point",Tn=[],nn=es||bt||xn,yr=Ut.elevationType==="road",bs=h.shadowRenderer,os=yr&&gt&&!!bs&&bs.enabled,Zs=hn(os),Oo=yr&&gt&&!h.terrain?it:Kt;h.terrainRenderModeElevated()&&gt&&Tn.push("PITCH_WITH_MAP_TERRAIN"),Bi&&(Tn.push("PROJECTION_GLOBE_VIEW"),nn&&Tn.push("PROJECTED_POS_ON_VIEWPORT")),!Ut.text.zOffsetVertexBuffer||yr&&h.terrain||Tn.push("Z_OFFSET"),Ut.iconsInText&&Tn.push("RENDER_TEXT_AND_SYMBOL"),Tn.push("RENDER_SDF"),os&&Tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),yr&&gt&&!h.terrain&&Ut.text.orientationVertexBuffer&&Tn.push("ELEVATED_ROADS"),nr(Tn);const Ha=Ut.text.programConfigurations.get(s.id),Za=h.getOrCreateProgram("symbol",{config:Ha,defines:Tn});let Da,za=[0,0],pa=null;const ol=Ut.textSizeData;Ut.iconsInText&&(za=qt.imageAtlasTexture?qt.imageAtlasTexture.size:[0,0],pa=qt.imageAtlasTexture?qt.imageAtlasTexture:null,Da=gt||!Ee.isOrthographic||h.options.rotating||h.options.zooming||ol.kind==="composite"||ol.kind==="camera"?Ie.LINEAR:Ie.NEAREST);const vl=qt.glyphAtlasTexture?qt.glyphAtlasTexture.size:[0,0],Is=s.layout.get("text-size-scale-range"),Ms=r.aA(h.scaleFactor,Is[0],Is[1]),as=r.bK(ol,Ee.zoom,Ms),to=Ii(Fi,qt.tileID.canonical,gt,nt,Ee,Ut.getProjection(),Ri),xo=Un(Fi,qt.tileID.canonical,gt,nt,Ee,Ut.getProjection(),Ri),Us=h.translatePosMatrix(xo,qt,A,D,!0),qo=h.translatePosMatrix(Fi,qt,A,D),Nl=nn?Lc:to,cc=nt&&!gt&&!es;let xl=Xt;!ct&&!Ee.mercatorFromTransition||nt||(xl=Hp(Ee));const jc=$p(ol.kind,as,cc,gt,h,qo,Nl,Us,Pe,!0,vl,za,0,hi,Di,Ve,wn,Bi?xl:Xt,Ut.getProjection(),Zs,gr,null,null,Ms),$c=qt.glyphAtlasTexture?qt.glyphAtlasTexture:null,Ul=Ie.LINEAR,Ah=s.paint.get("text-halo-width").constantOr(1)!==0,uc=h.terrain&&gt&&es?r.bl(r.bC(),to):Lc;if(es&&Ut.text){const Vl=Ee.elevation,hc=Vl?Vl.getAtTileOffsetFunc(hi,Ee.center.lat,Ee.worldSize,Ut.getProjection()):null,Ff=Xr(Fi,qt.tileID.canonical,gt,nt,Ee,Ut.getProjection(),Ri);_s(Ut,Fi,h,!0,Ff,xo,gt,ie,hc,hi)}return{program:Za,buffers:Ut.text,uniformValues:jc,atlasTexture:$c,atlasTextureIcon:pa,atlasInterpolation:Ul,atlasInterpolationIcon:Da,isSDF:!0,hasHalo:Ah,depthMode:Oo,tile:qt,renderWithShadows:os,labelPlaneMatrixInv:uc}},ur=Ut.icon.segments.get().length,lr=Ut.text.segments.get().length,dr=ur&&!x.onlyText?Hr():null,Qr=lr&&!x.onlyIcons?bn():null,Cs=s.paint.get("icon-opacity").constantOr(1),vo=s.paint.get("text-opacity").constantOr(1);if(et&&Ut.canOverlap){pt=!0;const es=Cs&&!x.onlyText?Ut.icon.segments.get():[],Tn=vo&&!x.onlyIcons?Ut.text.segments.get():[];for(const nn of es)zt.push({segments:new r.bg([nn]),sortKey:nn.sortKey,state:dr});for(const nn of Tn)zt.push({segments:new r.bg([nn]),sortKey:nn.sortKey,state:Qr})}else x.onlyText||zt.push({segments:Cs?Ut.icon.segments:new r.bg([]),sortKey:0,state:dr}),x.onlyIcons||zt.push({segments:vo?Ut.text.segments:new r.bg([]),sortKey:0,state:Qr})}pt&&zt.sort(((hi,qt)=>hi.sortKey-qt.sortKey));for(const hi of zt){const qt=hi.state;if(qt)if(h.terrain?h.terrain.setupElevationDraw(qt.tile,qt.program,{useDepthForOcclusion:Ee.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:qt.labelPlaneMatrixInv}):h.setupDepthForOcclusion(Ee.depthOcclusionForSymbolsAndCircles,qt.program),Me.activeTexture.set(Ie.TEXTURE0),qt.atlasTexture&&qt.atlasTexture.bind(qt.atlasInterpolation,Ie.CLAMP_TO_EDGE,!0),qt.atlasTextureIcon&&(Me.activeTexture.set(Ie.TEXTURE1),qt.atlasTextureIcon&&qt.atlasTextureIcon.bind(qt.atlasInterpolationIcon,Ie.CLAMP_TO_EDGE,!0)),qt.renderWithShadows&&h.shadowRenderer.setupShadows(qt.tile.tileID.toUnwrapped(),qt.program,"vector-tile"),h.uploadCommonLightUniforms(h.context,qt.program),qt.hasHalo){const Ut=qt.uniformValues;Ut.u_is_halo=1,gf(qt.buffers,hi.segments,s,h,qt.program,qt.depthMode,m,g,Ut,2),Ut.u_is_halo=0}else{if(qt.isSDF){const Ut=qt.uniformValues;qt.hasHalo&&(Ut.u_is_halo=1,gf(qt.buffers,hi.segments,s,h,qt.program,qt.depthMode,m,g,Ut,1)),Ut.u_is_halo=0}gf(qt.buffers,hi.segments,s,h,qt.program,qt.depthMode,m,g,qt.uniformValues,1)}}}function gf(h,t,s,u,m,g,x,w,A,R){const D=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];m.draw(u,u.context.gl.TRIANGLES,g,x,w,Wi.disabled,A,s.id,h.layoutVertexBuffer,h.indexBuffer,t,s.paint,u.transform.zoom,h.programConfigurations.get(s.id),D,R)}function W_(h,t){const s=1<<h.canonical.z,u=(t.x*s-h.canonical.x-h.wrap*s)*r.al,m=(t.y*s-h.canonical.y)*r.al,g=r.e5(t.z,t.y);return r.d4(u,m,g)}function Su(h,t,s,u,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const g=h.context.gl,x=new mi(h.context.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D),w=new mi(h.context.gl.GREATER,mi.ReadWrite,h.depthRangeFor3D),A=(function(V){let G=.01;return V.isOrthographic&&(G=r.ak(1e-4,G,r.c$(V.pitch>=fl?1:V.pitch/fl))),2*G})(h.transform),R=h.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",U=h.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),F=h.getOrCreateProgram(D);for(const V of u){const G=t.getTile(V),Z=G.getBucket(s);if(!Z)continue;const ie=Z.elevatedStructures;if(!ie)continue;const J=Z.elevationBufferData.heightRange,ae=W_(V.toUnwrapped(),R),me=h.translatePosMatrix(V.projMatrix,G,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let ye,Pe,Ae,Me;if(m==="initialize"){if(!J||J.min>=1||ie.depthSegments.segments[0].primitiveLength===0)continue;ye=lf(me,ae,A,1,0),Pe=x,Ae=ie.depthSegments,Me=U}else if(m==="reset"){if(!J||J.min>=0||ie.maskSegments.segments[0].primitiveLength===0)continue;ye=lf(me,ae,0,0,1),Pe=w,Ae=ie.maskSegments,Me=U}else if(m==="geometry"){if(ie.depthSegments.segments[0].primitiveLength===0)continue;ye=lf(me,ae,A,1,0),Pe=x,Ae=ie.depthSegments,Me=F}Me.draw(h,g.TRIANGLES,Pe,Xi.disabled,cn.disabled,Wi.disabled,ye,s.id,ie.vertexBuffer,ie.indexBuffer,Ae,s.paint,h.transform.zoom)}}function mh(h,t,s){const{painter:u,sourceCache:m,layer:g,coords:x,colorMode:w,elevationType:A,terrainEnabled:R,pass:D}=h,U=u.context.gl,F=g.paint.get("fill-pattern"),V=g.paint.get("fill-pattern-cross-fade"),G=F.constantOr(null);let Z=A;A!=="road"||t&&!R||(Z="none");const ie=Z==="road",J=h.painter.shadowRenderer,ae=ie&&!!J&&J.enabled,me=new mi(u.context.gl.LEQUAL,mi.ReadOnly,u.depthRangeFor3D);let ye=[0,0,0];if(ae){const Me=u.style.directionalLight,Ie=u.style.ambientLight;Me&&Ie&&(ye=ua(u.style,Me,Ie))}const Pe=F&&F.constantOr(1),Ae=(Me,Ie)=>{let Ee,Re,nt,We,gt;Ie?(Ee=Pe&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",nt=U.LINES):(Ee=Pe?"fillPattern":"fill",nt=U.TRIANGLES);for(const et of x){const pt=m.getTile(et);if(Pe&&!pt.patternsLoaded())continue;const Kt=pt.getBucket(g);if(!Kt)continue;const it=t?Kt.elevationBufferData:Kt.bufferData;if(it.isEmpty())continue;u.prepareDrawTile();const Ve=it.programConfigurations.get(g.id),bt=u.isTileAffectedByFog(et),ct=[],zt=[];ie&&(ct.push("ELEVATED_ROADS"),zt.push(it.elevatedLayoutVertexBuffer)),ae&&ct.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Pe&&(u.context.activeTexture.set(U.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ve.updatePaintBuffers());let Xt=!1;if(G&&pt.imageAtlas){const Di=pt.imageAtlas,Fi=r.e0.from(G),Ri=Fi.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),on=Fi.getSecondary(),xn=Di.patternPositions.get(Ri),wn=on?Di.patternPositions.get(on.scaleSelf(r.o.devicePixelRatio).toString()):null;Xt=!!xn&&!!wn,xn&&Ve.setConstantPatternPositions(xn,wn)}V>0&&(Xt||Ve.getPatternTransitionVertexBuffer("fill-pattern"))&&ct.push("FILL_PATTERN_TRANSITION");const hi=u.getOrCreateProgram(Ee,{config:Ve,overrideFog:bt,defines:ct}),qt=u.translatePosMatrix(et.projMatrix,pt,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));ae&&J.setupShadows(pt.tileID.toUnwrapped(),hi,"vector-tile");const Ut=g.paint.get("fill-emissive-strength");if(Ie){We=it.lineIndexBuffer,gt=it.lineSegments;const Di=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];Re=Ee==="fillOutlinePattern"&&Pe?kv(qt,Ut,u,pt,Di,ye,V):zv(qt,Ut,Di,ye)}else We=it.indexBuffer,gt=it.triangleSegments,Re=Pe?bu(qt,Ut,u,pt,ye,V):zp(qt,Ut,ye);u.uploadCommonUniforms(u.context,hi,et.toUnwrapped());let Bi=Me;(A==="road"&&!R||A==="offset")&&(Bi=me),hi.draw(u,nt,Bi,s||u.stencilModeForClipping(et),w,Wi.disabled,Re,g.id,it.layoutVertexBuffer,We,gt,g.paint,u.transform.zoom,Ve,zt)}};u.renderPass===D&&Ae(u.depthModeForSublayer(1,u.renderPass==="opaque"?mi.ReadWrite:mi.ReadOnly),!1),Z==="none"&&u.renderPass==="translucent"&&g.paint.get("fill-antialias")&&Ae(u.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,mi.ReadOnly),!0)}function yi(h,t,s,u,m,g,x,w){s.resetLayerRenderingStats(h);const A=h.context,R=A.gl,D=h.transform,U=s.paint.get("fill-extrusion-pattern"),F=s.paint.get("fill-extrusion-pattern-cross-fade"),V=U.constantOr(null),G=U.constantOr(1),Z=s.paint.get("fill-extrusion-opacity"),ie=h.style.enable3dLights(),J=s.paint.get(ie&&!G?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],me=s.layout.get("fill-extrusion-edge-radius"),ye=me>0&&!s.paint.get("fill-extrusion-rounded-roof"),Pe=ye?0:me,Ae=D.projection.name==="globe"?r.e8():0,Me=D.projection.name==="globe",Ie=Me?r.aj(D.zoom):0,Ee=[r.aF(D.center.lng),r.aJ(D.center.lat)],Re=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",nt=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Re?null:s.lut).toArray01().slice(0,3),We=s.paint.get("fill-extrusion-flood-light-intensity"),gt=s.paint.get("fill-extrusion-vertical-scale"),et=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,pt=s.paint.get("fill-extrusion-height-alignment"),Kt=s.paint.get("fill-extrusion-base-alignment"),it=Cl(h,s.paint.get("fill-extrusion-cutoff-fade-range")),Ve=[];let bt;Me&&Ve.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Ve.push("FAUX_AO"),ye&&Ve.push("ZERO_ROOF_RADIUS"),w&&Ve.push("HAS_CENTROID"),We>0&&Ve.push("FLOOD_LIGHT"),it.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),et&&Ve.push("RENDER_WALL_MODE");const ct=h.renderPass==="shadow",zt=h.shadowRenderer,Xt=ct&&!!zt,hi=ct?Wi.disabled:Wi.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let qt=[0,0,0];if(zt){const Di=h.style.directionalLight,Fi=h.style.ambientLight;Di&&Fi&&(qt=ua(h.style,Di,Fi)),ct||(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),zt.useNormalOffset&&Ve.push("NORMAL_OFFSET")),bt=Ve.concat(["SHADOWS_SINGLE_CASCADE"])}const Ut=Xt?"fillExtrusionDepth":G?"fillExtrusionPattern":"fillExtrusion",Bi=s.getLayerRenderingStats();for(const Di of u){const Fi=t.getTile(Di),Ri=Fi.getBucket(s);if(!Ri||Ri.projection.name!==D.projection.name)continue;let on=!1;zt&&(on=zt.getMaxCascadeForTile(Di.toUnwrapped())===0);const xn=h.isTileAffectedByFog(Di),wn=Ri.programConfigurations.get(s.id);let gr=!1;if(V&&Fi.imageAtlas){const lr=Fi.imageAtlas,dr=r.e0.from(V),Qr=dr.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Cs=dr.getSecondary(),vo=lr.patternPositions.get(Qr),es=Cs?lr.patternPositions.get(Cs.scaleSelf(r.o.devicePixelRatio).toString()):null;gr=!!vo&&!!es,vo&&wn.setConstantPatternPositions(vo,es)}F>0&&(gr||wn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ve.push("FILL_EXTRUSION_PATTERN_TRANSITION");const hn=h.getOrCreateProgram(Ut,{config:wn,defines:on?bt:Ve,overrideFog:xn});if(h.terrain&&h.terrain.setupElevationDraw(Fi,hn,{useMeterToDem:!0}),!Ri.centroidVertexBuffer){const lr=hn.getAttributeLocation(R,"a_centroid_pos");lr!==-1&&R.vertexAttrib2f(lr,0,0)}!ct&&zt&&zt.setupShadows(Fi.tileID.toUnwrapped(),hn,"vector-tile"),G&&(h.context.activeTexture.set(R.TEXTURE0),Fi.imageAtlasTexture&&Fi.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),wn.updatePaintBuffers());const nr=s.paint.get("fill-extrusion-vertical-gradient"),mr=1/Ri.tileToMeter;let Hr;if(ct&&zt){if(X_(Fi.tileID,Ri.maxHeight,h))continue;const lr=zt.calculateShadowPassMatrixFromTile(Fi.tileID.toUnwrapped());Hr=Dp(lr,Pe,mr,gt,pt,Kt)}else{const lr=h.translatePosMatrix(Di.expandedProjMatrix,Fi,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),dr=D.projection.createInversionMatrix(D,Di.canonical);Hr=G?G_(lr,h,nr,Z,ae,Pe,mr,Di,Fi,Ae,pt,Kt,Ie,Ee,dr,nt,gt,F):td(lr,h,nr,Z,ae,Pe,mr,Di,Ae,pt,Kt,Ie,Ee,dr,nt,gt,We,qt)}h.uploadCommonUniforms(A,hn,Di.toUnwrapped(),null,it);let bn=Ri.segments;if(D.projection.name==="mercator"&&!ct&&(bn=Ri.getVisibleSegments(Fi.tileID,h.terrain,h.transform.getFrustum(0)),!bn.get().length))continue;if(Bi)if(ct)for(const lr of bn.get())Bi.numRenderedVerticesInShadowPass+=lr.primitiveLength;else for(const lr of bn.get())Bi.numRenderedVerticesInTransparentPass+=lr.primitiveLength;const ur=[];(h.terrain||w)&&ur.push(Ri.centroidVertexBuffer),Me&&ur.push(Ri.layoutVertexExtBuffer),et&&ur.push(Ri.wallVertexBuffer),hn.draw(h,A.gl.TRIANGLES,m,g,x,hi,Hr,s.id,Ri.layoutVertexBuffer,Ri.indexBuffer,bn,s.paint,h.transform.zoom,wn,ur)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}class Zp{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function sc(h,t,s,u,m,g,x,w,A,R,D,U,F,V,G,Z,ie,J,ae,me){const ye=t.context,Pe=ye.gl,Ae=t.transform,Me=t.transform.zoom,Ie=[],Ee=h.translate,Re=h.translateAnchor,nt=h.edgeRadius,We=Cl(t,h.cutoffFadeRange);D==="clear"?(Ie.push("CLEAR_SUBPASS"),me&&(Ie.push("CLEAR_FROM_TEXTURE"),ye.activeTexture.set(Pe.TEXTURE0),me.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE))):D==="sdf"&&Ie.push("SDF_SUBPASS"),J&&Ie.push("HAS_CENTROID"),We.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");const gt=(et,pt,Kt,it,Ve)=>{const bt=pt.programConfigurations.get(u.id),ct=t.isTileAffectedByFog(et),zt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:bt,defines:Ie,overrideFog:ct}),Xt=((qt,Ut,Bi,Di,Fi,Ri,on,xn,wn,gr,hn)=>({u_matrix:Ut,u_opacity:Bi,u_ao_pass:Di?1:0,u_meter_to_tile:Fi,u_ao:Ri,u_flood_light_intensity:on,u_flood_light_color:xn,u_attenuation:wn,u_edge_radius:gr,u_fb:0,u_fb_size:hn,u_dynamic_offset:1}))(0,it,U,R,Ve,[F,V*Ve],G,Z,ie,Me>=17?0:nt*Ve,me?me.size[0]:0),hi=[];J&&hi.push(pt.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(ye,zt,et.toUnwrapped(),null,We),zt.draw(t,ye.gl.TRIANGLES,g,x,w,A,Xt,u.id,pt.vertexBuffer,pt.indexBuffer,Kt,u.paint,Me,bt,hi)};for(const et of m){const pt=s.getTile(et),Kt=pt.getBucket(u);if(!Kt||Kt.projection.name!==Ae.projection.name||!Kt.groundEffect||Kt.groundEffect&&!Kt.groundEffect.hasData())continue;const it=Kt.groundEffect,Ve=1/Kt.tileToMeter;{const bt=t.translatePosMatrix(et.projMatrix,pt,Ee,Re),ct=it.getDefaultSegment();gt(et,it,ct,bt,Ve)}if(ae)for(let bt=0;bt<4;bt++){const ct=r.e6[bt](et),zt=s.getTile(ct);if(!zt)continue;const Xt=zt.getBucket(u);if(!Xt||Xt.projection.name!==Ae.projection.name||!Xt.groundEffect||Xt.groundEffect&&!Xt.groundEffect.hasData())continue;const hi=Xt.groundEffect;let qt,Ut;bt===0?(qt=[-r.al,0,0],Ut=1):bt===1?(qt=[r.al,0,0],Ut=0):bt===2?(qt=[0,-r.al,0],Ut=3):(qt=[0,r.al,0],Ut=2);const Bi=hi.regionSegments[Ut];if(!Bi)continue;const Di=new Float32Array(16);r.br(Di,et.projMatrix,qt),gt(et,hi,Bi,t.translatePosMatrix(Di,pt,Ee,Re),Ve)}}}function Dc(h,t,s,u,m,g,x){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const w=g?g.findDEMTileFor(s):null;if(!(w&&w.dem||x))return;g&&w&&w.dem&&u.selfDEMTileTimestamp!==w.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=w.dem._timestamp);const A=J=>new r.P(Math.ceil((J+r.ea)*r.eb),0),R=J=>{const ae=t.getSource().minzoom,me=Pe=>{const Ae=t.getTileByID(Pe);if(Ae&&Ae.hasData())return Ae.getBucket(m)},ye=[0,-1,1];for(const Pe of ye){if(J.overscaledZ+Pe<ae)continue;const Ae=me(J.calculateScaledKey(J.overscaledZ+Pe));if(Ae)return Ae}},D=[0,0,0],U=(J,ae)=>(D[0]=Math.min(J.min.y,ae.min.y),D[1]=Math.max(J.max.y,ae.max.y),D[2]=r.al-ae.min.x>J.max.x?ae.min.x-r.al:J.max.x,D),F=(J,ae)=>(D[0]=Math.min(J.min.x,ae.min.x),D[1]=Math.max(J.max.x,ae.max.x),D[2]=r.al-ae.min.y>J.max.y?ae.min.y-r.al:J.max.y,D),V=[(J,ae)=>U(J,ae),(J,ae)=>U(ae,J),(J,ae)=>F(J,ae),(J,ae)=>F(ae,J)],G=(J,ae,me,ye,Pe,Ae,Me)=>{if(!g)return 0;const Ie=[[Ae?me:J,Ae?J:me,0],[Ae?me:ae,Ae?ae:me,0]],Ee=Me<0?r.al+Me:Me,Re=[Ae?Ee:(J+ae)/2,Ae?(J+ae)/2:Ee,0];return me===0&&Me<0||me!==0&&Me>0?g.getForTilePoints(Pe,[Re],!0,ye):Ie.push(Re),g.getForTilePoints(s,Ie,!0,w),Math.max(Ie[0][2],Ie[1][2],Re[2])/g.exaggeration()};for(let J=0;J<4;J++){const ae=u.borderFeatureIndices[J];if(ae.length===0)continue;const me=r.e6[J](s),ye=R(me);if(!(ye&&ye instanceof r.e7))continue;const Pe=g?g.findDEMTileFor(me):null;if(!(Pe&&Pe.dem||x)||(g&&Pe&&Pe.dem&&u.borderDEMTileTimestamp[J]!==Pe.dem._timestamp&&(u.borderDoneWithNeighborZ[J]=-1,u.borderDEMTileTimestamp[J]=Pe.dem._timestamp),u.borderDoneWithNeighborZ[J]===ye.canonical.z))continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const Ae=(J<2?1:5)-J,Me=ye.borderDoneWithNeighborZ[Ae]!==u.canonical.z,Ie=ye.borderFeatureIndices[Ae];let Ee=0;if(u.canonical.z!==ye.canonical.z){for(const Re of ae)u.showCentroid(u.featuresOnBorder[Re]);if(Me)for(const Re of Ie)ye.showCentroid(ye.featuresOnBorder[Re]);u.borderDoneWithNeighborZ[J]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ae]=u.canonical.z}for(const Re of ae){const nt=u.featuresOnBorder[Re],We=u.centroidData[nt.centroidDataIndex],gt=nt.borders[J];let et;for(;Ee<Ie.length;){et=ye.featuresOnBorder[Ie[Ee]];const pt=et.borders[Ae];if(pt[1]>gt[0]+3||pt[0]>gt[0]-3)break;ye.showCentroid(et),Ee++}if(et&&Ee<Ie.length){const pt=Ee;let Kt=0;for(;!(et.borders[Ae][0]>gt[1]-3)&&(Kt++,++Ee!==Ie.length);)et=ye.featuresOnBorder[Ie[Ee]];et=ye.featuresOnBorder[Ie[pt]];let it=!1;if(Kt>=1){const ct=et.borders[Ae];Math.abs(gt[0]-ct[0])<3&&Math.abs(gt[1]-ct[1])<3&&(Kt=1,it=!0,Ee=pt+1)}else if(Kt===0){u.showCentroid(nt);continue}const Ve=ye.centroidData[et.centroidDataIndex];x&&it&&(((Z=We).flags|(ie=Ve).flags)&r.e9?(Z.flags|=r.e9,ie.flags|=r.e9):(Z.flags&=~r.e9,ie.flags&=~r.e9));const bt=nt.intersectsCount()>1||et.intersectsCount()>1;if(Kt>1)Ee=pt,We.centroidXY=Ve.centroidXY=new r.P(0,0);else if(Pe&&Pe.dem&&!bt){const ct=V[J](We,Ve),zt=J%2?r.al-1:0,Xt=G(ct[0],Math.min(r.al-1,ct[1]),zt,Pe,me,J<2,ct[2]);We.centroidXY=Ve.centroidXY=A(Xt)}else bt?We.centroidXY=Ve.centroidXY=new r.P(0,0):(We.centroidXY=u.encodeBorderCentroid(nt),Ve.centroidXY=ye.encodeBorderCentroid(et));u.writeCentroidToBuffer(We),ye.writeCentroidToBuffer(Ve)}else u.showCentroid(nt)}u.borderDoneWithNeighborZ[J]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ae]=u.canonical.z}var Z,ie;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(h)}const zc=[1,0,0],Yi=[0,1,0],Wp=[0,0,1];function X_(h,t,s){const u=s.transform,m=s.shadowRenderer;if(!m)return!0;const g=h.toUnwrapped(),x=u.tileSize*m._cascades[s.currentShadowCascade].scale;let w=t;if(u.elevation){const Z=u.elevation.getMinMaxForTile(h);Z&&(w+=Z.max)}const A=[...m.shadowDirection];A[2]=-A[2];const R=m.computeSimplifiedTileShadowVolume(g,w,x,A);if(!R)return!1;const D=[zc,Yi,Wp,A,[A[0],0,A[2]],[0,A[1],A[2]]],U=u.projection.name==="globe",F=u.scaleZoom(x),V=r.cA.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,F,!U),G=m.getCurrentCascadeFrustum();return V.intersectsPrecise(R.vertices,R.planes,D)===0||G.intersectsPrecise(R.vertices,R.planes,D)===0}function yf(h){const{painter:t,source:s,layer:u,coords:m}=h;let g=h.defines;const x=t.context,w=t.renderPass==="shadow",A=t.renderPass==="light-beam",R=t.shadowRenderer,D=r.ec(t.transform.center.lat,t.transform.zoom),U=Cl(t,u.paint.get("building-cutoff-fade-range"));U.shouldRenderCutoff&&(g=g.concat("RENDER_CUTOFF"));for(const F of m){const V=s.getTile(F),G=V.getBucket(u);if(!G)continue;R&&R.getMaxCascadeForTile(F.toUnwrapped())===0&&(g=g.concat("SHADOWS_SINGLE_CASCADE"));const Z=G.programConfigurations.get(u.id);let ie,J,ae,me=t.translatePosMatrix(F.expandedProjMatrix,V,[0,0],"map");if(me=r.cR(r.bC(),me,[1,1,h.verticalScale]),w&&R){if(X_(V.tileID,G.maxHeight*D,t))continue;let Pe=R.calculateShadowPassMatrixFromTile(V.tileID.toUnwrapped());Pe=r.cR(r.bC(),Pe,[1,1,h.verticalScale]),ae=kp(Pe),ie=J=t.getOrCreateProgram("buildingDepth",{config:Z,defines:g,overrideFog:!1})}else if(A)ie=J=t.getOrCreateProgram("buildingBloom",{config:Z,defines:g,overrideFog:!1}),ae=Nv(me);else{const Pe=t.transform.calculatePosMatrix(F.toUnwrapped(),t.transform.worldSize);r.cR(Pe,Pe,[1,1,h.verticalScale]);const Ae=r.bC();r.cR(Ae,Pe,[1,-1,1/D]),r.bl(Ae,Ae),r.ed(Ae,Ae);const Me=t.transform.getFreeCameraOptions().position,Ie=1<<F.canonical.z;ae=Bv(me,Ae,h.opacity,h.facadeAOIntensity,[((Me.x-F.wrap)*Ie-F.canonical.x)*r.al,(Me.y*Ie-F.canonical.y)*r.al,Me.z*Ie*r.al],G.tileToMeter,h.facadeEmissiveChance),J=t.getOrCreateProgram("building",{config:Z,defines:g,overrideFog:!1});const Ee=g.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ie=t.getOrCreateProgram("building",{config:Z,defines:Ee,overrideFog:!1}),R&&(R.setupShadowsFromMatrix(Pe,J,!0),R.setupShadowsFromMatrix(Pe,ie,!0))}const ye=(Pe,Ae)=>{if(A){const Me=Pe.entranceBloom;Ae.draw(t,x.gl.TRIANGLES,h.depthMode,Xi.disabled,h.blendMode,Wi.disabled,ae,u.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segmentsBucket,u.paint,t.transform.zoom,Z,[Me.layoutAttenuationBuffer,Me.layoutColorBuffer])}else{const Me=Pe.segmentsBucket;let Ie=[Pe.layoutNormalBuffer,Pe.layoutCentroidBuffer,Pe.layoutColorBuffer];Pe.layoutFacadePaintBuffer&&(Ie=Ie.concat([Pe.layoutFacadeDataBuffer,Pe.layoutFacadeVerticalRangeBuffer,Pe.layoutFacadePaintBuffer])),Ae.draw(t,x.gl.TRIANGLES,h.depthMode,Xi.disabled,h.blendMode,w?Wi.disabled:Wi.backCW,ae,u.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Me,u.paint,t.transform.zoom,Z,Ie)}};t.uploadCommonUniforms(x,J,F.toUnwrapped(),null,U),G.buildingWithoutFacade&&ye(G.buildingWithoutFacade,J),ie!==J&&t.uploadCommonUniforms(x,ie,F.toUnwrapped(),null,U),G.buildingWithFacade&&ye(G.buildingWithFacade,ie)}}function vf(h){return[h[0]*r.ee,h[1]*r.ee,h[2]*r.ee,0]}function xf(h,t,s,u,m,g,x,w,A){const R=u.getSource(),D=s.globeSharedBuffers;if(!D)return;let U,F,V;if(t&&(U=u.getTile(t)),R instanceof r.aS?(F=R.texture,V=r.dG(0,0,s.transform)):U&&t&&(F=U.texture,V=r.dG(t.canonical.z,t.canonical.x,s.transform)),!F||!V)return;h||(V=r.cR(r.bC(),V,[1,-1,1]));const G=s.context,Z=G.gl,ie=m.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,J=s.colorModeForDrapableLayerRenderPass(g),ae=x.defines;ae.push("GLOBE_POLES");const me=new mi(Z.LEQUAL,mi.ReadWrite,s.depthRangeFor3D),ye=Float32Array.from(s.transform.expandedFarZProjMatrix),Pe=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),G.activeTexture.set(Z.TEXTURE0),F.bind(ie,Z.CLAMP_TO_EDGE),G.activeTexture.set(Z.TEXTURE1),F.bind(ie,Z.CLAMP_TO_EDGE),"useMipmap"in F&&G.extTextureFilterAnisotropic&&s.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const[Ae,Me,Ie,Ee]=t?D.getPoleBuffers(t.canonical.z,!1):D.getPoleBuffers(0,!0),Re=m.paint.get("raster-elevation");let nt;h?(nt=Ae,s.renderDefaultNorthPole=Re!==0):(nt=Me,s.renderDefaultSouthPole=Re!==0);const We=vf(x.mix),gt=((pt,Kt,it,Ve,bt,ct,zt,Xt,hi,qt,Ut,Bi,Di)=>cf(pt,Kt,it,new Float32Array(16),new Float32Array(9),[0,0],Ve,[0,0],[0,0,0,0],1,{opacity:1,mix:0},ct,[0,0],Xt,2,qt,Ut,Bi,1,0,Di))(ye,Pe,V,r.aj(s.transform.zoom),0,m,0,Re,0,We,x.offset,x.range,g),et=s.getOrCreateProgram("raster",{defines:ae});s.uploadCommonUniforms(G,et,null),et.draw(s,Z.TRIANGLES,me,A,J,w,gt,m.id,nt,Ie,Ee)}function jv(h){const t=h._nearZ,s=h.projection.farthestPixelDistance(h),u=s-t,m=.2*h.height,g=t+m;return[t,s,(g-m-t)/u,(g-t)/u]}function K_(h,t,s,u){if(h)return t instanceof Xs&&h instanceof _t?t.getTextureDescriptor(h,s,!0):{texture:h.texture,mix:vf(u.mix),offset:u.offset,buffer:0,tileSize:1}}var $v=r.ef([{name:"a_index",type:"Int16",components:1}]);class qv{constructor(t,s,u,m){const g={width:u[0],height:u[1],data:null},x=t.gl;this.targetColorTexture=new r.T(t,g,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,g,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,m),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,m=s.width*s.height;this.particleTexture0=new r.T(this.context,s,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,s,u.RGBA8,{premultiply:!1,useMipmap:!1});const g=new r.eg;g.reserve(m);for(let x=0;x<m;x++)g.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(g,$v.members,!0),this.particleSegment=r.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function La(h,t,s){if(!h)return null;const u=t.getTextureDescriptor(h,s,!0);if(!u)return null;let{texture:m,mix:g,offset:x,tileSize:w,buffer:A,format:R}=u;if(!m||!R)return null;let D=!1;return R==="uint32"&&(D=!0,g[3]=0,g=Np(r.eh,g,[0,s.paint.get("raster-particle-max-speed")]),x=Up(r.eh,x,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[A/(w+2*A),w/(w+2*A)],tileSize:w,scalarData:D,scale:g,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function Xp(h){const t=h._nearZ,s=h.projection.farthestPixelDistance(h),u=s-t,m=.2*h.height,g=t+m;return[t,s,(g-m-t)/u,(g-t)/u]}const fa=new r.ao(1,0,0,1),kc=new r.ao(0,1,0,1),Y_=new r.ao(0,0,1,1),Kp=new r.ao(1,0,1,1),Yp=new r.ao(0,1,1,1);function bf(h,t,s,u,m,g){for(let x=0;x<s.length;x++)if(m){const R=new r.ao(u.r*.8,u.g*.8,u.b*.8,1);Eu(h,t,s[x],u,-1,-1,g),Eu(h,t,s[x],u,-1,1,g),Eu(h,t,s[x],u,1,1,g),Eu(h,t,s[x],u,1,-1,g),Eu(h,t,s[x],R,0,0,g)}else Eu(h,t,s[x],u,0,0,g)}function Eu(h,t,s,u,m,g,x){const w=h.context,A=h.transform,R=w.gl,D=A.projection.name==="globe",U=D?["PROJECTION_GLOBE_VIEW"]:[];let F=r.bz(s.projMatrix);if(D&&r.aj(A.zoom)>0){const We=r.bj(s.canonical,A),gt=r.ei(We);F=r.aB(new Float32Array(16),A.globeMatrix,gt),r.aB(F,A.projMatrix,F)}const V=r.bC();V[12]+=2*m/(r.o.devicePixelRatio*A.width),V[13]+=2*g/(r.o.devicePixelRatio*A.height),r.aB(F,V,F);const G=h.getOrCreateProgram("debug",{defines:U}),Z=t.getTileByID(s.key);h.terrain&&h.terrain.setupElevationDraw(Z,G);const ie=mi.disabled,J=Xi.disabled,ae=h.colorModeForRenderPass(),me="$debug";w.activeTexture.set(R.TEXTURE0),h.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),D?Z._makeGlobeTileDebugBuffers(h.context,A):Z._makeDebugTileBoundsBuffers(h.context,A.projection);const ye=Z._tileDebugBuffer||h.debugBuffer,Pe=Z._tileDebugIndexBuffer||h.debugIndexBuffer,Ae=Z._tileDebugSegments||h.debugSegments;if(G.draw(h,R.LINE_STRIP,ie,J,ae,Wi.disabled,Bp(F,u.toPremultipliedRenderColor(null)),me,ye,Pe,Ae,null,null,null,[Z._globeTileDebugBorderBuffer]),x){const We=Z.latestRawTileData,gt=Math.floor((We&&We.byteLength||0)/1024);let et=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(et+=` => ${s.overscaledZ}`),et+=` ${Z.state}`,et+=` ${gt}kb`,(function(pt,Kt){pt.initDebugOverlayCanvas();const it=pt.debugOverlayCanvas,Ve=pt.context.gl,bt=pt.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,it.width,it.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(Kt,5,5),bt.strokeText(Kt,5,5),pt.debugOverlayTexture.update(it),pt.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)})(h,et)}const Me=t.getTile(s).tileSize,Ie=512/Math.min(Me,512)*(s.overscaledZ/A.zoom)*.5,Ee=Z._tileDebugTextBuffer||h.debugBuffer,Re=Z._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,nt=Z._tileDebugTextSegments||h.debugSegments;G.draw(h,R.TRIANGLES,ie,J,cn.alphaBlended,Wi.disabled,Bp(F,r.ao.transparent.toPremultipliedRenderColor(null),Ie),me,Ee,Re,nt,null,null,null,[Z._globeTileDebugTextBuffer])}function kl(h,t,s,u){Au(h,0,t+s/2,h.transform.width,s,u)}function Nr(h,t,s,u){Au(h,t-s/2,0,s,h.transform.height,u)}function Au(h,t,s,u,m,g){const x=h.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*r.o.devicePixelRatio,s*r.o.devicePixelRatio,u*r.o.devicePixelRatio,m*r.o.devicePixelRatio),x.clear({color:g}),w.disable(w.SCISSOR_TEST)}const Jp=r.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:J_}=Jp;function oc(h,t,s,u){h.emplaceBack(t,s,u)}class Qp{constructor(t){this.vertexArray=new r.ej,this.indices=new r.b1,oc(this.vertexArray,-1,-1,1),oc(this.vertexArray,1,-1,1),oc(this.vertexArray,-1,1,1),oc(this.vertexArray,1,1,1),oc(this.vertexArray,-1,-1,-1),oc(this.vertexArray,1,-1,-1),oc(this.vertexArray,-1,1,-1),oc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,J_),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bg.simpleSegment(0,0,36,12)}}function Iu(h,t,s,u,m,g){const x=h.context.gl,w=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),R=t.paint.get("sky-atmosphere-sun-intensity"),D=((U,F,V,G,Z)=>({u_matrix_3f:U,u_sun_direction:F,u_sun_intensity:V,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(r.el(r.dL(),u),m,R,w.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),s.draw(h,x.TRIANGLES,mi.disabled,Xi.disabled,cn.unblended,Wi.frontCW,D,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Pu=r.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Cu{constructor(t){const s=new r.em;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const u=new r.b1;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,Pu.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=r.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Wt=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class li{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class _h{constructor(t){this.colorModeAlphaBlendedWriteRGB=new cn([1,As,1,As],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new cn([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new li,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Cu(s);const u=this.params.sizeRange,m=this.params.intensityRange,g=(function(D){const U=r.eo(30),F=[];for(let V=0;V<D;++V){const G=2*Math.PI*U(),Z=Math.acos(1-2*U())-.5*Math.PI;F.push(r.d4(Math.cos(Z)*Math.cos(G),Math.cos(Z)*Math.sin(G),Math.sin(Z)))}return F})(this.params.starsCount),x=r.eo(300),w=new r.en,A=new r.b1;let R=0;for(let D=0;D<g.length;++D){const U=r.c4([],g[D],200),F=Math.max(0,1+.01*u*(1*x()-.5)),V=Math.max(0,1+.01*m*(1*x()-.5));w.emplaceBack(U[0],U[1],U[2],-1,-1,F,V),w.emplaceBack(U[0],U[1],U[2],1,-1,F,V),w.emplaceBack(U[0],U[1],U[2],1,1,F,V),w.emplaceBack(U[0],U[1],U[2],-1,1,F,V),A.emplaceBack(R+0,R+1,R+2),A.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=s.createVertexBuffer(w,Wt.members),this.starsIdx=s.createIndexBuffer(A),this.starsSegments=r.bg.simpleSegment(0,0,w.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const u=t.context,m=u.gl,g=t.transform,x=new mi(m.LEQUAL,mi.ReadOnly,[0,1]),w=r.aj(g.zoom),A=t.style.getLut(s.scope),R=s.properties.get("color-use-theme")==="none",D=s.properties.get("color").toNonPremultipliedRenderColor(R?null:A),U=s.properties.get("high-color-use-theme")==="none",F=s.properties.get("high-color").toNonPremultipliedRenderColor(U?null:A),V=s.properties.get("space-color-use-theme")==="none",G=s.properties.get("space-color").toNonPremultipliedRenderColor(V?null:A),Z=5e-4,ie=r.ep(s.properties.get("horizon-blend"),0,1,Z,.25),J=r.dA(t,u,g)&&ie===Z?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,ae=t.frameCounter/1e3%1,me=r.ag(g.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(me,2)-Math.pow(J,2)),Pe=Math.acos(ye/me),Ae=Me=>{const Ie=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Me&&Ie.push("ALPHA_PASS");const Ee=t.getOrCreateProgram("globeAtmosphere",{defines:Ie}),Re=((We,gt,et,pt,Kt,it,Ve,bt,ct,zt,Xt,hi)=>({u_frustum_tl:We,u_frustum_tr:gt,u_frustum_br:et,u_frustum_bl:pt,u_horizon:Kt,u_transition:it,u_fadeout_range:Ve,u_atmosphere_fog_color:bt.toArray01(),u_high_color:ct.toArray01(),u_space_color:zt.toArray01(),u_temporal_offset:Xt,u_horizon_angle:hi}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,w,ie,D,F,G,ae,Pe);t.uploadCommonUniforms(u,Ee);const nt=this.atmosphereBuffer;nt&&Ee.draw(t,m.TRIANGLES,x,Xi.disabled,Me?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Wi.backCW,Re,Me?"atmosphere_glow_alpha":"atmosphere_glow",nt.vertexBuffer,nt.indexBuffer,nt.segments)};Ae(!1),Ae(!0)}drawStars(t,s){const u=r.aA(s.properties.get("star-intensity"),0,1);if(u===0)return;const m=t.context,g=m.gl,x=t.transform,w=t.getOrCreateProgram("stars"),A=r.c6([]);r.c8(A,A,-x._pitch),r.c7(A,A,-x.angle),r.c8(A,A,r.an(x._center.lat)),r.eq(A,A,-r.an(x._center.lng));const R=r.cb(new Float32Array(16),A),D=r.aB([],x.starsProjMatrix,R),U=r.el([],R),F=r.er([],U),V=[0,1,0];r.dN(V,V,F),r.c4(V,V,this.params.sizeMultiplier);const G=[1,0,0];r.dN(G,G,F),r.c4(G,G,this.params.sizeMultiplier);const Z=(ie=V,J=G,ae=u,{u_matrix:Float32Array.from(D),u_up:ie,u_right:J,u_intensity_multiplier:ae});var ie,J,ae;t.uploadCommonUniforms(m,w),this.starsVx&&this.starsIdx&&w.draw(t,g.TRIANGLES,mi.disabled,Xi.disabled,this.colorModeAlphaBlendedWriteRGB,Wi.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class xs{constructor(){this.visibleTiles=[]}updateBorders(t,s){const u=[],m=[],g=t._getRenderableCoordinates(!1,!0);for(const A of g){const R=t.getTile(A);if(!R.hasData())continue;const D=R.getBucket(s);D&&(D.isEmpty()||(u.push(A.key),m.push({bucket:D,tileID:A.canonical})))}let x=u.length!==this.visibleTiles.length;if(!x){u.sort();for(let A=0;A<u.length;A++)if(u[A]!==this.visibleTiles[A]){x=!0;break}}if(!x)return;const w=new Set;this.visibleTiles=u,m.sort(((A,R)=>A.tileID.z-R.tileID.z||A.tileID.x-R.tileID.x||A.tileID.y-R.tileID.y));for(const A of m){const R=new Array,D=new Array,U=A.bucket;for(const F of U.featuresOnBorder)w.has(F.featureId)?D.push(F.footprintIndex):(w.add(F.featureId),R.push(F.footprintIndex));U.updateFootprintHiddenFlags(R,r.es,!1),U.updateFootprintHiddenFlags(D,r.es,!0)}}}function Ye(h,t){const s=[...h],u=t.cameraWorldSizeForFog/t.worldSize,m=r.bA([]);return r.cR(m,m,[u,u,1]),r.aB(s,m,s),r.aB(s,t.worldToFogMatrix,s),s}function wf(h,t,s,u,m){const g=s.material,x=u.context,{baseColorTexture:w,metallicRoughnessTexture:A}=g.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:D,emissionTexture:U}=g;function F(G,Z,ie){if(G&&(h.push(Z),x.activeTexture.set(x.gl.TEXTURE0+ie),G.gfxTexture)){const{minFilter:J,magFilter:ae,wrapS:me,wrapT:ye}=G.sampler;G.gfxTexture.bindExtraParam(J,ae,me,ye)}}F(w,"HAS_TEXTURE_u_baseColorTexture",vs.BaseColor),F(A,"HAS_TEXTURE_u_metallicRoughnessTexture",vs.MetallicRoughness),F(R,"HAS_TEXTURE_u_normalTexture",vs.Normal),F(D,"HAS_TEXTURE_u_occlusionTexture",vs.Occlusion),F(U,"HAS_TEXTURE_u_emissionTexture",vs.Emission),m&&(m.texture||(m.texture=new r.dY(u.context,m.image,[m.image.height,m.image.height,m.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+vs.LUT),m.texture&&m.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(h.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||h.push("DIFFUSE_SHADED");const V=u.shadowRenderer;V&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),V.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Mu(h,t,s,u,m,g){const x=s.paint.get("model-opacity").constantOr(1),w=t.context,A=new mi(t.context.gl.LEQUAL,mi.ReadWrite,t.depthRangeFor3D),R=t.transform,D=h.mesh,U=D.material,F=U.pbrMetallicRoughness,V=t.style.fog;let G;G=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:r.aB([],u.zScaleMatrix,h.nodeModelMatrix),r.aB(G,u.negCameraPosMatrix,G);const Z=r.bl([],G);r.ed(Z,Z);const ie=s.paint.get("model-color-use-theme").constantOr("default")==="none",J=s.paint.get("model-emissive-strength").constantOr(0),ae=ff(new Float32Array(h.worldViewProjection),new Float32Array(G),new Float32Array(Z),null,t,x,F.baseColorFactor,U.emissiveFactor,F.metallicFactor,F.roughnessFactor,U,J,s),me={defines:[]},ye=[],Pe=t.shadowRenderer;Pe&&(Pe.useNormalOffset=!1),wf(me.defines,ye,D,t,ie?null:s.lut);let Ae=null;if(V){const Ee=Ye(h.nodeModelMatrix,t.transform);if(Ae=new Float32Array(Ee),R.projection.name!=="globe"){const Re=D.aabb.min,nt=D.aabb.max,[We,gt]=V.getOpacityForBounds(Ee,Re[0],Re[1],nt[0],nt[1]);me.overrideFog=We>=wi||gt>=wi}}const Me=Cl(t,s.paint.get("model-cutoff-fade-range"));Me.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Ie=t.getOrCreateProgram("model",me);t.uploadCommonUniforms(w,Ie,null,Ae,Me),t.renderPass!=="shadow"&&Pe&&Pe.setupShadowsFromMatrix(h.nodeModelMatrix,Ie),Ie.draw(t,w.gl.TRIANGLES,A,m,g,D.material.doubleSided?Wi.disabled:Wi.backCCW,ae,s.id,D.vertexBuffer,D.indexBuffer,D.segments,s.paint,t.transform.zoom,void 0,ye)}function Tf(h,t,s,u,m,g,x){let w;w=h.projection.name==="globe"?r.eu(s,h):[...s],r.aB(w,w,t.matrix);const A=r.aB([],u,w);if(t.meshes)for(const R of t.meshes){if(R.material.alphaMode!=="BLEND"){x.push({mesh:R,depth:0,modelIndex:m,worldViewProjection:A,nodeModelMatrix:w});continue}const D=r.af([],R.centroid,A);!h.isOrthographic&&D[2]<=0||g.push({mesh:R,depth:D[2],modelIndex:m,worldViewProjection:A,nodeModelMatrix:w})}if(t.children)for(const R of t.children)Tf(h,R,s,u,m,g,x)}function rd(h,t,s,u){const m=s.shadowRenderer;if(!m)return;const g=m.getShadowPassDepthMode(),x=m.getShadowPassColorMode(),w=m.calculateShadowPassMatrixFromMatrix(t),A=ph(w);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,g,Xi.disabled,x,Wi.backCCW,A,u.id,h.vertexBuffer,h.indexBuffer,h.segments,u.paint,s.transform.zoom,void 0,void 0)}function Q_(h,t,s){const u=t.updateZoomBasedPaintProperties(),m=(function(g,x,w){let A,R,D,U=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&U>0){const F=g.terrain,V=F.findDEMTileFor(w);V&&V.dem?A=r.ew.create(F,w,V):U=0}if(U===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),U===x.validForExaggeration&&(U===0||A&&A._demTile&&A._demTile.tileID===x.validForDEMTile.id&&A._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const F in x.instancesPerModel){const V=x.instancesPerModel[F];for(let G=0;G<V.instancedDataArray.length;++G){const Z=(A?U*A.getElevationAt(0|V.instancedDataArray.float32[16*G],0|V.instancedDataArray.float32[16*G+1],!0,!0):0)+V.instancesEvaluatedElevation[G];V.instancedDataArray.float32[16*G+6]=Z,R=R?Math.min(x.terrainElevationMin,Z):Z,D=D?Math.max(x.terrainElevationMax,Z):Z}}return x.terrainElevationMin=R||0,x.terrainElevationMax=D||0,x.validForExaggeration=U,x.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0})(h,t,s);(u||m)&&(t.uploaded=!1,t.upload(h.context))}const _l={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d8([0,0,0],[r.al,r.al,0])};function gh(h,t){const s=1<<h.canonical.z,u=t.getFreeCameraOptions().position,m=t.elevation,g=h.canonical.x/s,x=(h.canonical.x+1)/s,w=h.canonical.y/s,A=(h.canonical.y+1)/s;let R=t._centerAltitude;if(m){const V=m.getMinMaxForTile(h);V&&V.max>R&&(R=V.max)}const D=r.aA(u.x,g,x)-u.x,U=r.aA(u.y,w,A)-u.y,F=r.ce(R,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(D*D+U*U+F*F))}function eg(h,t,s,u,m,g,x){const w=h.context,A=h.renderPass==="shadow",R=h.shadowRenderer,D=A&&R?R.getShadowPassDepthMode():new mi(w.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D),U=h.isTileAffectedByFog(g);if(s.meshes)for(const F of s.meshes){const V=["MODEL_POSITION_ON_GPU"],G=[];let Z,ie,J;u.instancedDataArray.length>20&&V.push("INSTANCED_ARRAYS");const ae=Cl(h,t.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&V.push("RENDER_CUTOFF"),A&&R)Z=h.getOrCreateProgram("modelDepth",{defines:V}),ie=ph(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(s.matrix)),J=R.getShadowPassColorMode();else{wf(V,G,F,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Z=h.getOrCreateProgram("model",{defines:V,overrideFog:U});const ye=F.material,Pe=ye.pbrMetallicRoughness,Ae=t.paint.get("model-opacity").constantOr(1),Me=t.paint.get("model-emissive-strength").constantOr(0);ie=ff(g.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,h,Ae,Pe.baseColorFactor,ye.emissiveFactor,Pe.metallicFactor,Pe.roughnessFactor,ye,Me,t,m),R&&(x.shadowUniformsInitialized?Z.setShadowUniformValues(w,R.getShadowUniformValues()):(R.setupShadows(g.toUnwrapped(),Z,"model-tile"),x.shadowUniformsInitialized=!0)),J=ae.shouldRenderCutoff||Ae<1||ye.alphaMode!=="OPAQUE"?cn.alphaBlended:cn.unblended}h.uploadCommonUniforms(w,Z,g.toUnwrapped(),null,ae);const me=F.material.doubleSided?Wi.disabled:Wi.backCCW;if(u.instancedDataArray.length>20)G.push(u.instancedDataBuffer),Z.draw(h,w.gl.TRIANGLES,D,Xi.disabled,J,me,ie,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,h.transform.zoom,void 0,G,u.instancedDataArray.length);else{const ye=A?"u_instance":"u_normal_matrix";for(let Pe=0;Pe<u.instancedDataArray.length;++Pe)ie[ye]=new Float32Array(u.instancedDataArray.arrayBuffer,64*Pe,16),Z.draw(h,w.gl.TRIANGLES,D,Xi.disabled,J,me,ie,t.id,F.vertexBuffer,F.indexBuffer,F.segments,t.paint,h.transform.zoom,void 0,G)}}if(s.children)for(const F of s.children)eg(h,t,F,u,m,g,x)}const Gv=[1,-1,1];function tg(h,t,s,u){if(!s.modelManager)return!0;const m=s.modelManager;if(!s.shadowRenderer)return!0;const g=s.shadowRenderer,x=t.aabb;let w=!0,A=h.maxHeight;if(A===0){let D=0;for(const U in h.instancesPerModel){const F=m.getModel(U,u);F?D=Math.max(D,Math.max(Math.max(F.aabb.max[0],F.aabb.max[1]),F.aabb.max[2])):w=!1}A=h.maxScale*D*1.41+h.maxVerticalOffset,w&&(h.maxHeight=A)}x.max[2]=A,x.min[2]+=h.terrainElevationMin,x.max[2]+=h.terrainElevationMax,r.af(x.min,x.min,t.tileMatrix),r.af(x.max,x.max,t.tileMatrix);const R=x.intersects(g.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=R===2),R===0}function Sf(h,t){const s=h.uniformValues.u_cutoff_params[0],u=h.uniformValues.u_cutoff_params[1],m=h.uniformValues.u_cutoff_params[2],g=h.uniformValues.u_cutoff_params[3];return u===s||g===m?1:r.aA(((t-s)/(u-s)-m)/(g-m),0,1)}function em(h,t,s,u){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();r.aB(m,m,h);const g=r.bU(s.min[0],s.min[1],s.min[2],1);let x=r.aC(r.ex(),g,m),w=x,A=x;g[1]=s.max[1],x=r.aC(r.ex(),g,m),w=x[1]<w[1]?x:w,A=x[1]>A[1]?x:A,g[0]=s.max[0],x=r.aC(r.ex(),g,m),w=x[1]<w[1]?x:w,A=x[1]>A[1]?x:A,g[1]=s.min[1],x=r.aC(r.ex(),g,m),w=x[1]<w[1]?x:w,A=x[1]>A[1]?x:A;const R=r.aA(u[0],0,1),D=100*t.pixelsPerMeter*r.aA(u[1],0,1),U=r.aA(u[2],0,1),F=r.ey(r.ex(),w,A,R),V=Math.tan(.5*t.fovX),G=-F[2]*V;if(D===0)return F[1]<-Math.abs(G)?U:1;const Z=(-Math.abs(G)-F[1])/D,ie=(ae,me,ye)=>(1-ye)*ae+ye*me,J=r.aA(ie(1,U,Z),U,1);return ie(1,J,r.aA((t.pitch-20)/20,0,1))}class ig{}class ng{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,u){{const U=this._storage.get(s.id);if(U)return U.lastUsedFrameIdx=t,U.buf}const m=u.gl,g=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),x=new ArrayBuffer(g),w=new Int16Array(x);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const A=new r.eA;for(let U=0;U<g/2;U+=3){const F=w[U],V=w[U+1],G=w[U+2];A.emplaceBack(F,V),A.emplaceBack(V,G),A.emplaceBack(G,F)}const R=u.bindVertexArrayOES.current,D=new ig;return D.buf=new Oc(u,A),D.lastUsedFrameIdx=t,this._storage.set(s.id,D),u.bindVertexArrayOES.set(R),D.buf}update(t){for(const[s,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class Ef{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const sd=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class yh{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class tm{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const rg=r.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class Hv{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new r.eB,w=new r.b1;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,rg.members),this.vignetteIdx=t.context.createIndexBuffer(w)}const m=r.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const x={u_vignetteShape:(g={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,mi.disabled,Xi.disabled,cn.alphaBlended,Wi.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,m)}var g}}class sg{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const u=t.getFreeCameraOptions().position,m=u.toAltitude(),g=u.toLngLat(),x=r.an(g.lng),w=r.an(g.lat),A=t.pixelsPerMeter/s,R=x*r.eD,D=r.eD*Math.log(Math.tan(Math.PI/4+w/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+D,F=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*A,this._accumulatedOffsetY+=U*A,this._accumulatedElevation+=F*A,this._offsetXPrev=R,this._offsetYPrev=D,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function og(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function Qo(h){const t=r.eo(1323123451230),s=[];for(let u=0;u<h;++u){const m=2*t()-1,g=2*t()-1,x=2*t()-1;s.push(r.d4(m,g,x))}return s}function Fc(h,t,s,u,m){const g=r.aA((m-s)/(u-s),0,1);return(1-g)*h+g*t}class vh{constructor(t){this._movement=new sg,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Hv,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const m=u.starsProjMatrix,g=r.c6([]);r.c8(g,g,r.an(90)-u._pitch),r.c7(g,g,-u.angle);const x=r.cb(new Float32Array(16),g),w=r.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=r.ed([],w),R=r.aB([],A,x),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*s,this._prevTime=D,{projectionMatrix:m,modelviewMatrix:R}}}class Gr extends vh{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new tm(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const u=Qo(this.particlesCount),m=new r.eE,g=new r.b1;let x=0;const w=r.eo(1323123451230);for(let A=0;A<u.length;++A){const R=u[A],D=[2*w()-1,w(),w(),w()];m.emplaceBack(R[0],R[1],R[2],-1,-1,...D),m.emplaceBack(R[0],R[1],R[2],1,-1,...D),m.emplaceBack(R[0],R[1],R[2],1,1,...D),m.emplaceBack(R[0],R[1],R[2],-1,1,...D),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,sd.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(s.revealStart>u)return;const m=Fc(0,1,s.revealStart,s.revealStart+s.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let x=[-g.direction.x,g.direction.y,-100];r.aw(x,x);const w=structuredClone(this._vignetteParams);w.strength*=m,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,w.strength=1,w.color=structuredClone(t.style.rain.state.vignetteColor));const A=this.updateOnRender(t,g.timeFactor),R=t.context,D=R.gl,U=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(R,{width:t.width,height:t.height,data:null},D.RGBA8)),g.distortionStrength>0&&(R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const F=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(R,F),R.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const V=[g.color.r,g.color.g,g.color.b,g.color.a],G=(Z,ie)=>{const J=og(this._movement.getPosition(),Z),ae=g.dropletSizeX,me=g.dropletSizeX*g.dropletSizeYScale,ye=t.width/2,Pe=t.height/2,Ae=Fc(0,g.screenThinning.start,0,1,g.screenThinning.intensity),Me=Fc(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),Ie=Fc(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),Ee=(Re={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:Z,rainDropletSize:[ae,me],distortionStrength:g.distortionStrength,rainDirection:x,color:V,screenSize:[U.width,U.height],thinningCenterPos:[ye,Pe],thinningShape:[Ae,Me,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:Ie,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:ie?0:1},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_texScreen:0,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_boxSize:Re.boxSize,u_rainDropletSize:Re.rainDropletSize,u_distortionStrength:Re.distortionStrength,u_rainDirection:Re.rainDirection,u_color:Re.color,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_shapeDirectionalPower:Re.shapeDirectionalPower,u_shapeNormalPower:Re.shapeNormalPower,u_mode:Re.mode});var Re;const nt=Math.round(g.intensity*this.particlesCount),We=r.bg.simpleSegment(0,0,4*nt,2*nt);F.draw(t,D.TRIANGLES,mi.disabled,Xi.disabled,cn.alphaBlended,Wi.disabled,Ee,"rain_particles",this.particlesVx,this.particlesIdx,We)};g.distortionStrength>0&&G(g.boxSize,!0),G(g.boxSize,!1),this._vignette.draw(t,w)}}const qn=r.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ag extends vh{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new tm(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const u=Qo(this.particlesCount),m=new r.eF,g=new r.b1;let x=0;const w=r.eo(1323123451230);for(let A=0;A<u.length;++A){const R=u[A],D=w(),U=w(),F=w(),V=[A/u.length,D,U,F],G=[w(),w()];m.emplaceBack(R[0],R[1],R[2],-1,-1,...V,...G),m.emplaceBack(R[0],R[1],R[2],1,-1,...V,...G),m.emplaceBack(R[0],R[1],R[2],1,1,...V,...G),m.emplaceBack(R[0],R[1],R[2],-1,1,...V,...G),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,qn.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let u=[-s.direction.x,s.direction.y,-100];r.aw(u,u);const m=structuredClone(this._vignetteParams),g=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(g.revealStart>x)return;const w=Fc(0,1,g.revealStart,g.revealStart+g.revealRange,x);m.strength*=w,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const A=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=t.context,D=R.gl,U=t.transform,F=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(R,F),((V,G,Z)=>{const ie=og(this._movement.getPosition(),V),J=U.width/2,ae=U.height/2,me=Fc(0,Z.screenThinning.start,0,1,Z.screenThinning.intensity),ye=Fc(.001,Z.screenThinning.range,0,1,Z.screenThinning.intensity),Pe=Fc(0,Z.screenThinning.particleOffset,0,1,Z.screenThinning.intensity),Ae=(Me={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:Z.velocityConeAperture,velocity:Z.velocity,horizontalOscillationRadius:Z.horizontalOscillationRadius,horizontalOscillationRate:Z.horizontalOscillationRate,boxSize:V,billboardSize:1*Z.billboardSize,simpleShapeParameters:[Z.shapeFadeStart,Z.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[J,ae],thinningShape:[me,ye,Math.pow(10,Z.screenThinning.fadePower)],thinningAffectedRatio:Z.screenThinning.affectedRatio,thinningParticleOffset:Pe,color:[Z.color.r,Z.color.g,Z.color.b,Z.color.a],direction:u},{u_modelview:Float32Array.from(Me.modelview),u_projection:Float32Array.from(Me.projection),u_time:Me.time,u_cam_pos:Me.camPos,u_velocityConeAperture:Me.velocityConeAperture,u_velocity:Me.velocity,u_horizontalOscillationRadius:Me.horizontalOscillationRadius,u_horizontalOscillationRate:Me.horizontalOscillationRate,u_boxSize:Me.boxSize,u_billboardSize:Me.billboardSize,u_simpleShapeParameters:Me.simpleShapeParameters,u_screenSize:Me.screenSize,u_thinningCenterPos:Me.thinningCenterPos,u_thinningShape:Me.thinningShape,u_thinningAffectedRatio:Me.thinningAffectedRatio,u_thinningParticleOffset:Me.thinningParticleOffset,u_particleColor:Me.color,u_direction:Me.direction});var Me;const Ie=Math.round(Z.intensity*this.particlesCount),Ee=r.bg.simpleSegment(0,0,4*Ie,2*Ie);this.particlesVx&&this.particlesIdx&&F.draw(t,D.TRIANGLES,mi.disabled,Xi.disabled,cn.alphaBlended,Wi.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Ee)})(s.boxSize,0,s),this._vignette.draw(t,m)}}const Bc={symbol:function(h,t,s,u,m){if(h.renderPass!=="translucent")return;const g=Xi.disabled,x=h.colorModeForRenderPass(),w=s.layout.get("text-variable-anchor"),A=s.layout.get("text-size-scale-range"),R=r.aA(h.scaleFactor,A[0],A[1]);w&&(function(F,V,G,Z,ie,J,ae,me){const ye=V.transform,Pe=ie==="map",Ae=J==="map";for(const Me of F){const Ie=Z.getTile(Me),Ee=Ie.getBucket(G);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const Re=r.bK(Ee.textSizeData,ye.zoom,me),nt=ca(Me,Ee.getProjection(),ye),We=ye.calculatePixelsToTileUnitsMatrix(Ie),gt=Ii(nt,Ie.tileID.canonical,Ae,Pe,ye,Ee.getProjection(),We),et=Ee.hasIconTextFit()&&Ee.hasIconData();Re&&_f(Ee,Pe,Ae,ae,ye,gt,Me,Math.pow(2,ye.zoom-Ie.tileID.overscaledZ),Re,et)}})(u,h,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m,R);const D=s.paint.get("icon-opacity").constantOr(1)!==0,U=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||U)?nd(h,t,s,u,g,x):(D&&nd(h,t,s,u,g,x,{onlyIcons:!0}),U&&nd(h,t,s,u,g,x,{onlyText:!0})),t.map.showCollisionBoxes&&(id(h,t,s,u,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),id(h,t,s,u,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,s,u){if(h.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),w=s.layout.get("circle-sort-key").constantOr(1)!==void 0,A=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const R=h.context,D=R.gl,U=h.transform,F=!(!h.terrain||!h.terrain.enabled),V=s.layout.get("circle-elevation-reference"),G=h.depthModeForSublayer(0,mi.ReadOnly),Z=new mi(h.context.gl.LEQUAL,mi.ReadOnly,h.depthRangeFor3D),ie=V==="none"||F?G:Z,J=Xi.disabled,ae=h.colorModeForDrapableLayerRenderPass(A),me=U.projection.name==="globe",ye=[r.aF(U.center.lng),r.aJ(U.center.lat)],Pe=[];for(let Me=0;Me<u.length;Me++){const Ie=u[Me],Ee=t.getTile(Ie),Re=Ee.getBucket(s);if(!Re||Re.projection.name!==U.projection.name)continue;const nt=Re.programConfigurations.get(s.id),We=Re.layoutVertexBuffer,gt=Re.globeExtVertexBuffer,et=Re.indexBuffer,pt=r.dZ(s),Kt=[gt],it=h.isTileAffectedByFog(Ie);me&&pt.push("PROJECTION_GLOBE_VIEW"),pt.push("DEPTH_D24"),h.terrain&&U.depthOcclusionForSymbolsAndCircles&&pt.push("DEPTH_OCCLUSION"),Re.hasElevation&&!h.terrain&&(pt.push("ELEVATED_ROADS"),Kt.push(Re.elevatedLayoutVertexBuffer));const Ve=h.getOrCreateProgram("circle",{config:nt,defines:pt,overrideFog:it}),bt=U.projection.createInversionMatrix(U,Ie.canonical),ct={programConfiguration:nt,program:Ve,layoutVertexBuffer:We,dynamicBuffers:Kt,indexBuffer:et,uniformValues:r.d_(h,Ie,Ee,bt,ye,s),tile:Ee};if(w){const zt=Re.segments.get();for(const Xt of zt)Pe.push({segments:new r.bg([Xt]),sortKey:Xt.sortKey,state:ct})}else Pe.push({segments:Re.segments,sortKey:0,state:ct})}w&&Pe.sort(((Me,Ie)=>Me.sortKey-Ie.sortKey));const Ae={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const Me of Pe){const{programConfiguration:Ie,program:Ee,layoutVertexBuffer:Re,dynamicBuffers:nt,indexBuffer:We,uniformValues:gt,tile:et}=Me.state,pt=Me.segments;h.terrain&&h.terrain.setupElevationDraw(et,Ee,Ae),h.uploadCommonUniforms(R,Ee,et.tileID.toUnwrapped()),Ee.draw(h,D.TRIANGLES,ie,J,ae,Wi.disabled,gt,s.id,Re,We,pt,s.paint,U.zoom,Ie,nt)}},heatmap:function(h,t,s,u){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const m=h.context,g=m.gl,x=Xi.disabled,w=new cn([g.ONE,g.ONE,g.ONE,g.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function(V,G,Z,ie){const J=V.gl,ae=G.width*ie,me=G.height*ie;V.activeTexture.set(J.TEXTURE1),V.viewport.set([0,0,ae,me]);let ye=Z.heatmapFbo;if(!ye||ye&&(ye.width!==ae||ye.height!==me)){ye&&ye.destroy();const Pe=J.createTexture();J.bindTexture(J.TEXTURE_2D,Pe),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),ye=Z.heatmapFbo=V.createFramebuffer(ae,me,!0,null),(function(Ae,Me,Ie,Ee,Re,nt){const We=Ae.gl;We.texImage2D(We.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?We.RGBA16F:We.RGBA,Re,nt,0,We.RGBA,Ae.extRenderToTextureHalfFloat?We.HALF_FLOAT:We.UNSIGNED_BYTE,null),Ee.colorAttachment.set(Ie)})(V,0,Pe,ye,ae,me)}else J.bindTexture(J.TEXTURE_2D,ye.colorAttachment.get()),V.bindFramebuffer.set(ye.framebuffer)})(m,h,s,h.transform.projection.name==="globe"?.5:.25),m.clear({color:r.ao.transparent});const A=h.transform,R=A.projection.name==="globe",D=R?["PROJECTION_GLOBE_VIEW"]:[],U=R?Wi.frontCCW:Wi.disabled,F=[r.aF(A.center.lng),r.aJ(A.center.lat)];for(let V=0;V<u.length;V++){const G=u[V];if(t.hasRenderableParent(G))continue;const Z=t.getTile(G),ie=Z.getBucket(s);if(!ie||ie.projection.name!==A.projection.name)continue;const J=h.isTileAffectedByFog(G),ae=ie.programConfigurations.get(s.id),me=h.getOrCreateProgram("heatmap",{config:ae,defines:D,overrideFog:J}),{zoom:ye}=h.transform;h.terrain&&h.terrain.setupElevationDraw(Z,me),h.uploadCommonUniforms(m,me,G.toUnwrapped());const Pe=A.projection.createInversionMatrix(A,G.canonical);me.draw(h,g.TRIANGLES,mi.disabled,x,w,U,H_(h,G,Z,Pe,F,ye,s.paint.get("heatmap-intensity")),s.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,s.paint,h.transform.zoom,ae,R?[ie.globeExtVertexBuffer]:null)}m.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),(function(m,g){const x=m.context,w=x.gl,A=g.heatmapFbo;if(!A)return;x.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,A.colorAttachment.get()),x.activeTexture.set(w.TEXTURE1);let R=g.colorRampTexture;R||(R=g.colorRampTexture=new r.T(x,g.colorRamp,w.RGBA8)),R.bind(w.LINEAR,w.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,w.TRIANGLES,mi.disabled,Xi.disabled,m.colorModeForRenderPass(),Wi.disabled,((D,U,F,V)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)})(h,s))},line:function(h,t,s,u){if(h.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const x=s.paint.get("line-emissive-strength"),w=s.paint.get("line-occlusion-opacity"),A=s.layout.get("line-elevation-reference"),R=s.layout.get("line-width-unit")==="meters",D=A==="sea",U=!(!h.terrain||!h.terrain.enabled),F=h.context,V=F.gl;if(s.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const G=s.layout.get("line-cross-slope"),Z=G!==void 0,ie=G<1,J=h.colorModeForDrapableLayerRenderPass(x),ae=h.terrain&&h.terrain.renderingToTexture,me=ae?1:r.o.devicePixelRatio,ye=s.paint.get("line-dasharray"),Pe=ye.constantOr(1),Ae=s.layout.get("line-cap"),Me=ye.constantOr(null),Ie=Ae.constantOr(null),Ee=s.paint.get("line-pattern"),Re=Ee.constantOr(1),nt=s.paint.get("line-pattern-cross-fade"),We=Ee.constantOr(null),gt=s.paint.get("line-opacity").constantOr(1);let et=!Re&&gt!==1||h.depthOcclusion&&w>0&&w<1;const pt=s.paint.get("line-gradient"),Kt=Re?"linePattern":"line",it=r.d$(s);let Ve;if(ae&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(et=!1),w!==0&&h.depthOcclusion){const Xt=s.paint._values["line-opacity"];Xt&&Xt.value&&Xt.value.kind==="constant"?Ve=Xt.value:r.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&it.push("VARIABLE_LINE_WIDTH");const bt=(Xt,hi,qt,Ut,Bi,Di)=>{for(const Fi of Xt){const Ri=t.getTile(Fi);if(Re&&!Ri.patternsLoaded())continue;const on=Ri.getBucket(s);if(!on||on.elevationType!=="none"&&!Bi||on.elevationType==="none"&&Bi)continue;h.prepareDrawTile();const xn=[...hi],wn=h.shadowRenderer,gr=on.elevationType==="road"&&!!wn&&wn.enabled;let hn=[0,0,0];if(gr){const Tn=h.style.directionalLight,nn=h.style.ambientLight;Tn&&nn&&(hn=ua(h.style,Tn,nn)),xn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const nr=on.programConfigurations.get(s.id);let mr=!1;if(We&&Ri.imageAtlas){const Tn=r.e0.from(We),nn=Tn.getPrimary().scaleSelf(me).toString(),yr=Ri.imageAtlas.patternPositions.get(nn),bs=Tn.getSecondary(),os=bs?Ri.imageAtlas.patternPositions.get(bs.scaleSelf(me).toString()):null;mr=!!yr&&!!os,yr&&nr.setConstantPatternPositions(yr,os)}nt>0&&(mr||nr.getPatternTransitionVertexBuffer("line-pattern"))&&xn.push("LINE_PATTERN_TRANSITION");const Hr=h.isTileAffectedByFog(Fi),bn=h.getOrCreateProgram(Kt,{config:nr,defines:xn,overrideFog:Hr});if(!Re&&Me&&Ie&&Ri.lineAtlas){const Tn=Ri.lineAtlas.getDash(Me,Ie);Tn&&nr.setConstantPatternPositions(Tn)}gr&&wn.setupShadows(Ri.tileID.toUnwrapped(),bn,"vector-tile");let[ur,lr]=s.paint.get("line-trim-offset");(Ie==="round"||Ie==="square")&&ur!==lr&&(ur===0&&(ur-=1),lr===1&&(lr+=1));const dr=ae?Fi.projMatrix:null,Qr=R?1/on.tileToMeter/r.ay(Ri,1,h.transform.zoom):1,Cs=R?1/on.tileToMeter/r.ay(Ri,1,Math.floor(h.transform.zoom)):1,vo=Re?r.e1(h,Ri,s,dr,me,Qr,Cs,[ur,lr],hn,nt):r.e2(h,Ri,s,dr,on.lineClipsArray.length,me,Qr,Cs,[ur,lr],hn);if(pt){const Tn=on.gradients[s.id];let nn=Tn.texture;if(s.gradientVersion!==Tn.version){let yr=256;if(s.stepInterpolant){const bs=t.getSource().maxzoom,os=Fi.canonical.z===bs?Math.ceil(1<<h.transform.maxZoom-Fi.canonical.z):1;yr=r.aA(r.e3(on.maxLineLength/r.al*1024*os),256,F.maxTextureSize)}Tn.gradient=r.e4({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:yr,image:Tn.gradient||void 0,clips:on.lineClipsArray}),Tn.texture?Tn.texture.update(Tn.gradient):Tn.texture=new r.T(F,Tn.gradient,V.RGBA8),Tn.version=s.gradientVersion,nn=Tn.texture}F.activeTexture.set(V.TEXTURE1),nn.bind(s.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}Pe&&(F.activeTexture.set(V.TEXTURE0),Ri.lineAtlasTexture&&Ri.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),nr.updatePaintBuffers()),Re&&(F.activeTexture.set(V.TEXTURE0),Ri.imageAtlasTexture&&Ri.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),nr.updatePaintBuffers()),Bi&&!D&&h.terrain.setupElevationDraw(Ri,bn),h.uploadCommonUniforms(F,bn,Fi.toUnwrapped());const es=Tn=>{Ve!=null&&(Ve.value=gt*w),bn.draw(h,V.TRIANGLES,qt,Tn,J,Wi.disabled,vo,s.id,on.layoutVertexBuffer,on.indexBuffer,on.segments,s.paint,h.transform.zoom,nr,[on.layoutVertexBuffer2,on.patternVertexBuffer,on.zOffsetVertexBuffer]),Ve!=null&&(Ve.value=gt)};if(et&&!Bi){const Tn=h.stencilModeForClipping(Fi).ref;Tn===0&&ae&&F.clear({stencil:0});const nn={func:V.EQUAL,mask:255};vo.u_alpha_discard_threshold=.8,es(new Xi(nn,Tn,255,V.KEEP,V.KEEP,V.INVERT)),vo.u_alpha_discard_threshold=0,es(new Xi(nn,Tn,255,V.KEEP,V.KEEP,V.KEEP))}else vo.u_alpha_discard_threshold=et&&Bi&&Di?.8:0,es(Bi?Ut:h.stencilModeForClipping(Fi))}};let ct=h.depthModeForSublayer(0,mi.ReadOnly);const zt=new mi(h.depthOcclusion?V.GREATER:V.LEQUAL,mi.ReadOnly,h.depthRangeFor3D);if(s.hasNonElevatedBuckets){const Xt=!ae&&h.terrain;w!==0&&Xt?r.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):Xt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):bt(u,it,ct,Xi.disabled,!1,!0)}if(s.hasElevatedBuckets){A==="hd-road-markup"?U||(ct=zt,it.push("ELEVATED_ROADS")):(it.push("ELEVATED"),ct=zt,Z&&it.push(ie?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&it.push("ELEVATION_REFERENCE_SEA"));const Xt=et?h.stencilModeFor3D():Xi.disabled;h.forceTerrainMode=!0,bt(u,it,ct,Xt,!0,!0),et&&bt(u,it,ct,Xt,!0,!1),h.forceTerrainMode=!1}et&&(h.resetStencilClippingMasks(),ae&&F.clear({stencil:0})),w===0||h.depthOcclusion||ae||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,s,u){const m=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=s.paint.get("fill-emissive-strength"),w=h.colorModeForDrapableLayerRenderPass(x),A=s.paint.get("fill-pattern"),R=h.opaquePassEnabledForLayer()&&!A.constantOr(1)&&m.constantOr(r.ao.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let D="none";s.layout.get("fill-elevation-reference")!=="none"?D="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const U=!(!h.terrain||!h.terrain.enabled),F={painter:h,sourceCache:t,layer:s,coords:u,colorMode:w,elevationType:D,terrainEnabled:U,pass:R};if(h.renderPass!=="shadow")if(D!=="offset"){if(mh(F,!1),D==="road"){const V=!U&&h.renderPass==="translucent";V&&Su(h,t,s,u,"geometry"),mh(F,!0,Xi.disabled),V&&(function(G){const{painter:Z,sourceCache:ie,layer:J,coords:ae,colorMode:me}=G,ye=Z.context.gl,Pe=G.painter.shadowRenderer,Ae=!!Pe&&Pe.enabled,Me=new mi(Z.context.gl.LEQUAL,mi.ReadOnly,Z.depthRangeFor3D);let Ie=[0,0,0];if(Ae){const Re=Z.style.directionalLight,nt=Z.style.ambientLight;Re&&nt&&(Ie=ua(Z.style,Re,nt))}const Ee=Re=>{for(const nt of ae){const We=ie.getTile(nt),gt=We.getBucket(J);if(!gt)continue;const et=gt.elevatedStructures;if(!et)continue;let pt,Kt;if(Re?(pt=et.renderableBridgeSegments,Kt=et.bridgeProgramConfigurations.get(J.id)):(pt=et.renderableTunnelSegments,Kt=et.tunnelProgramConfigurations.get(J.id)),!pt||pt.segments[0].primitiveLength===0)continue;Kt.updatePaintBuffers(),Z.prepareDrawTile();const it=Z.isTileAffectedByFog(nt),Ve=[];Ae&&Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const bt=Z.getOrCreateProgram("elevatedStructures",{config:Kt,overrideFog:it,defines:Ve}),ct=Z.translatePosMatrix(nt.projMatrix,We,J.paint.get("fill-translate"),J.paint.get("fill-translate-anchor"));Ae&&Pe.setupShadows(We.tileID.toUnwrapped(),bt,"vector-tile");const zt=Fv(ct,Ie);Z.uploadCommonUniforms(Z.context,bt,nt.toUnwrapped()),bt.draw(Z,ye.TRIANGLES,Me,Xi.disabled,me,Wi.backCCW,zt,J.id,et.vertexBuffer,et.indexBuffer,pt,J.paint,Z.transform.zoom,Kt,[et.vertexBufferNormal])}};Ee(!0),Ee(!1)})(F)}}else mh(F,!1,h.stencilModeFor3D());else h.shadowRenderer&&D==="road"&&!U&&(function(V){const{painter:G,sourceCache:Z,layer:ie,coords:J}=V,ae=G.context.gl,me=V.painter.shadowRenderer;for(const ye of J){const Pe=Z.getTile(ye),Ae=Pe.getBucket(ie);if(!Ae)continue;const Me=Ae.elevatedStructures;if(!Me||!Me.shadowCasterSegments||Me.shadowCasterSegments.segments[0].primitiveLength===0)continue;G.prepareDrawTile();const Ie=Ae.bufferData.programConfigurations.get(ie.id),Ee=G.isTileAffectedByFog(ye),Re=G.getOrCreateProgram("elevatedStructuresDepth",{config:Ie,overrideFog:Ee}),nt=me.calculateShadowPassMatrixFromTile(Pe.tileID.toUnwrapped());G.uploadCommonUniforms(G.context,Re,ye.toUnwrapped());const We={u_matrix:nt,u_depth_bias:0};Re.draw(G,ae.TRIANGLES,me.getShadowPassDepthMode(),Xi.disabled,me.getShadowPassColorMode(),Wi.disabled,We,ie.id,Me.vertexBuffer,Me.indexBuffer,Me.shadowCasterSegments,ie.paint,G.transform.zoom,Ie)}})(F)},"fill-extrusion":function(h,t,s,u){const m=s.paint.get("fill-extrusion-opacity"),g=h.context,x=g.gl,w=h.terrain,A=w&&w.renderingToTexture;if(m===0)return;const R=h.conflationActive&&h.style.isLayerClipped(s,t.getSource()),D=h.style.order.indexOf(s.fqid);if(R&&(function(U,F,V,G,Z){for(const ie of G){const J=F.getTile(ie).getBucket(V);J&&(J.updateReplacement(ie,U.replacementSource,Z),J.uploadCentroid(U.context))}})(h,t,s,u,D),w||R)for(const U of u){const F=t.getTile(U).getBucket(s);F&&Dc(h.context,t,U,F,s,w,R)}if(h.renderPass==="shadow"&&h.shadowRenderer){const U=h.shadowRenderer;if(w&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const F=U.getShadowPassDepthMode(),V=U.getShadowPassColorMode();yi(h,t,s,u,F,Xi.disabled,V,R)}else if(h.renderPass==="translucent"){const U=!s.paint.get("fill-extrusion-pattern").constantOr(1),F=s.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!A&&F.a!==0){const V=new mi(h.context.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D);m===1&&U?yi(h,t,s,u,V,Xi.disabled,cn.unblended,R):(yi(h,t,s,u,V,Xi.disabled,cn.disabled,R),yi(h,t,s,u,V,h.stencilModeFor3D(),h.colorModeForRenderPass(),R),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&U&&(!w&&h.transform.projection.name!=="globe"||A)){const V=s.paint.get("fill-extrusion-opacity"),G=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=s.paint.get("fill-extrusion-flood-light-intensity"),J=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ae=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(J?null:s.lut).toArray01().slice(0,3),me=G>0&&Z>0,ye=ie>0,Pe=(Ie,Ee,Re)=>(1-Re)*Ie+Re*Ee,Ae=new Zp;Ae.translate=s.paint.get("fill-extrusion-translate"),Ae.translateAnchor=s.paint.get("fill-extrusion-translate-anchor"),Ae.edgeRadius=s.layout.get("fill-extrusion-edge-radius"),Ae.cutoffFadeRange=s.paint.get("fill-extrusion-cutoff-fade-range");const Me=Ie=>{const Ee=h.depthModeForSublayer(1,mi.ReadOnly,x.LEQUAL,!0),Re=s.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),nt=Pe(.1,3,Re),We=h._showOverdrawInspector;if(!We){const gt=new Xi({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),et=new cn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0],x.MIN);sc(Ae,h,t,s,u,Ee,gt,et,Wi.disabled,Ie,"sdf",V,G,Z,ie,ae,nt,R,!1)}{const gt=We?Xi.disabled:new Xi({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),et=We?h.colorModeForRenderPass():new cn([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],r.ao.transparent,[!0,!0,!0,!0]);sc(Ae,h,t,s,u,Ee,gt,et,Wi.disabled,Ie,"color",V,G,Z,ie,ae,nt,R,!1)}};if(A){const Ie=(Ee,Re,nt)=>{const We=h.depthModeForSublayer(1,mi.ReadOnly,x.LEQUAL,!1),gt=s.paint.get(Ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),et=Pe(.1,3,gt);{const pt=new cn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0]);sc(Ae,h,t,s,u,We,Xi.disabled,pt,Wi.disabled,Ee,"clear",V,G,Z,ie,ae,et,R,Re)}{const pt=new Xi({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Kt=new cn([x.ONE,x.ONE,x.ONE,x.ONE],r.ao.transparent,[!1,!1,!1,!0],x.MIN);sc(Ae,h,t,s,u,We,pt,Kt,Wi.disabled,Ee,"sdf",V,G,Z,ie,ae,et,R,Re)}{const pt=Ee?x.ZERO:x.ONE_MINUS_DST_ALPHA,Kt=new Xi({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),it=new cn([pt,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],r.ao.transparent,[!0,!0,!0,!0]);sc(Ae,h,t,s,u,We,Kt,it,Wi.disabled,Ee,"color",V,G,Z,ie,ae,et,R,Re)}{const pt=new cn([x.ONE,x.ONE,x.ONE,Ee?x.ZERO:x.ONE],r.ao.transparent,[!1,!1,!1,!0],Ee?x.FUNC_ADD:x.MAX);sc(Ae,h,t,s,u,We,Xi.disabled,pt,Wi.disabled,Ee,"clear",V,G,Z,ie,ae,et,R,Re,nt)}};if(me||ye){let Ee;if(h.prepareDrawTile(),w){const Re=w.drapeBufferSize[0],nt=w.drapeBufferSize[1];Ee=w.framebufferCopyTexture,Ee&&(!Ee||Ee.size[0]===Re&&Ee.size[1]===nt)||(Ee&&Ee.destroy(),Ee=w.framebufferCopyTexture=new r.T(g,new r.q({width:Re,height:nt}),x.RGBA8)),Ee.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,Re,nt)}me&&Ie(!0,!1,Ee),ye&&Ie(!1,!0,Ee)}}else me&&Me(!0),ye&&Me(!1),(me||ye)&&h.resetStencilClippingMasks()}}},building:function(h,t,s,u){h.currentLayer<h.firstLightBeamLayer&&(h.firstLightBeamLayer=h.currentLayer);const m=s.paint.get("building-ambient-occlusion-ground-intensity"),g=s.paint.get("building-ambient-occlusion-ground-radius"),x=s.paint.get("building-ambient-occlusion-ground-attenuation"),w=s.paint.get("building-opacity");if(w<=0)return;let A=m>0&&g>0,R=!0;const D=s.paint.get("building-vertical-scale");(!h.shadowRenderer||D<1)&&(R=!1);const U=h.conflationActive&&h.style.isLayerClipped(s,t.getSource()),F=h.style.order.indexOf(s.fqid);if((function(V,G,Z,ie,J,ae){for(const me of ae){const ye=G.getTile(me).getBucket(Z);ye&&(J&&ye.updateReplacement(me,V.replacementSource,ie),ye.uploadUpdatedIndexBuffer(V.context))}})(h,t,s,F,U,u),(function(V,G,Z,ie){for(const J of ie){const ae=G.getTile(J).getBucket(Z);ae&&ae.needsEvaluation()&&ae.uploadUpdatedColorBuffer(V.context)}})(h,t,s,u),s.resetLayerRenderingStats(h),h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0),h.renderPass==="shadow"&&h.shadowRenderer){const V=h.shadowRenderer,G=[],Z=V.getShadowPassDepthMode();yf({painter:h,source:t,layer:s,coords:u,defines:G,blendMode:V.getShadowPassColorMode(),depthMode:Z,opacity:w,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(h.renderPass==="translucent"){let V=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];R&&(V=V.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),h.shadowRenderer&&h.shadowRenderer.useNormalOffset&&(V=V.concat("NORMAL_OFFSET"));const G=s.paint.get("building-facade-emissive-chance"),Z=s.paint.get("building-ambient-occlusion-intensity"),ie=new mi(h.context.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D);w<1&&yf({painter:h,source:t,layer:s,coords:u,defines:V,blendMode:cn.disabled,depthMode:ie,opacity:w,verticalScale:D,facadeEmissiveChance:G,facadeAOIntensity:Z});const J=h.colorModeForRenderPass();yf({painter:h,source:t,layer:s,coords:u,defines:V,blendMode:J,depthMode:ie,opacity:w,verticalScale:D,facadeEmissiveChance:G,facadeAOIntensity:Z}),A&&(function(ae,me,ye,Pe,Ae,Me,Ie,Ee,Re,nt,We,gt,et){const pt=ae.context.gl,Kt=ae.depthModeForSublayer(1,mi.ReadOnly,pt.LEQUAL,!0),it=.1*(1-(Ve=We))+3*Ve;var Ve;const bt=ae._showOverdrawInspector,ct=gt,zt=new Zp;bt||sc(zt,ae,me,ye,Pe,Kt,new Xi({func:pt.ALWAYS,mask:255},255,255,pt.KEEP,pt.KEEP,pt.REPLACE),new cn([pt.ONE,pt.ONE,pt.ONE,pt.ONE],r.ao.transparent,[!1,!1,!1,!0],pt.MIN),Wi.disabled,Ae,"sdf",Me,Ie,Ee,0,nt,it,ct,!1);{const Xt=bt?Xi.disabled:new Xi({func:pt.EQUAL,mask:255},255,255,pt.KEEP,pt.DECR,pt.DECR),hi=bt?ae.colorModeForRenderPass():new cn([pt.ONE_MINUS_DST_ALPHA,pt.DST_ALPHA,pt.ONE,pt.ONE],r.ao.transparent,[!0,!0,!0,!0]);sc(zt,ae,me,ye,Pe,Kt,Xt,hi,Wi.disabled,Ae,"color",Me,Ie,Ee,0,nt,it,ct,!1)}})(h,t,s,u,!0,w,m,g,0,[0,0,0],x,U)}else if(h.renderPass==="light-beam"){const V=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],G=new mi(h.context.gl.LEQUAL,mi.ReadOnly,h.depthRangeFor3D);yf({painter:h,source:t,layer:s,coords:u,defines:V,blendMode:cn.alphaBlended,depthMode:G,opacity:w,verticalScale:D,facadeEmissiveChance:0,facadeAOIntensity:0})}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1),h.resetStencilClippingMasks()},hillshade:function(h,t,s,u){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const m=h.context,g=h.terrain&&h.terrain.renderingToTexture,[x,w]=h.renderPass!=="translucent"||g?[{},u]:h.stencilConfigForOverlap(u);for(const A of w){const R=t.getTile(A);if(R.needsHillshadePrepare&&h.renderPass==="offscreen")Jd(h,R,s);else if(h.renderPass==="translucent"){const D=h.depthModeForSublayer(0,mi.ReadOnly),U=s.paint.get("hillshade-emissive-strength"),F=h.colorModeForDrapableLayerRenderPass(U),V=g&&h.terrain?h.terrain.stencilModeForRTTOverlap(A):x[A.overscaledZ];Yd(h,A,R,s,D,V,F)}}m.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,s,u,m,g){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const x=h.transform.projection.name==="globe",w=s.paint.get("raster-elevation")!==0,A=w&&x;if(h.renderElevatedRasterBackface&&!A)return;const R=h.context,D=R.gl,U=t.getSource(),F=(function(Ae,Me,Ie,Ee){const Re=Me.paint.get("raster-color"),nt=Ae.type==="raster-array",We=[],gt=Me.paint.get("raster-resampling"),et=Me.paint.get("raster-color-mix");let pt=Me.paint.get("raster-color-range");const Kt=[et[0],et[1],et[2],0],it=et[3];let Ve=gt==="nearest"?Ee.NEAREST:Ee.LINEAR;if(nt&&(We.push("RASTER_ARRAY"),Re||We.push("RASTER_COLOR"),gt==="linear"&&We.push("RASTER_ARRAY_LINEAR"),Ve=Ee.NEAREST,!pt&&Ae.rasterLayers)){const bt=Ae.rasterLayers.find((({id:ct})=>ct===Me.sourceLayer));bt&&bt.fields&&bt.fields.range&&(pt=bt.fields.range)}if(pt=pt||[0,1],Re){We.push("RASTER_COLOR"),Ie.activeTexture.set(Ee.TEXTURE2),Me.updateColorRamp(pt);let bt=Me.colorRampTexture;bt||(bt=Me.colorRampTexture=new r.T(Ie,Me.colorRamp,Ee.RGBA8)),bt.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}return{mix:Kt,range:pt,offset:it,defines:We,resampling:Ve}})(U,s,R,D);if(U instanceof r.aS&&!u.length&&!x)return;const V=s.paint.get("raster-emissive-strength"),G=h.colorModeForDrapableLayerRenderPass(V),Z=h.terrain&&h.terrain.renderingToTexture,ie=!h.options.moving,J=s.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(U instanceof r.aS&&!u.length&&(U.onNorthPole||U.onSouthPole)){const Ae=w?h.stencilModeFor3D():Xi.disabled;return void xf(!!U.onNorthPole,null,h,t,s,V,F,Wi.disabled,Ae)}if(!u.length)return;const[ae,me]=U instanceof r.aS||Z?[{},u]:h.stencilConfigForOverlap(u),ye=me[me.length-1].overscaledZ;A&&F.defines.push("PROJECTION_GLOBE_VIEW"),w&&F.defines.push("RENDER_CUTOFF");const Pe=(Ae,Me,Ie)=>{for(const Ee of Ae){const Re=Ee.toUnwrapped(),nt=t.getTile(Ee);if(Z&&(!nt||!nt.hasData()))continue;R.activeTexture.set(D.TEXTURE0);const We=K_(nt,U,s,F);if(!We||!We.texture)continue;const{texture:gt,mix:et,offset:pt,tileSize:Kt,buffer:it}=We;let Ve,bt;Z?(Ve=mi.disabled,bt=Ee.projMatrix):w?(Ve=new mi(D.LEQUAL,mi.ReadWrite,h.depthRangeFor3D),bt=x?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Re,ie)):(Ve=h.depthModeForSublayer(Ee.overscaledZ-ye,s.paint.get("raster-opacity")===1?mi.ReadWrite:mi.ReadOnly,D.LESS),bt=h.transform.calculateProjMatrix(Re,ie));const ct=h.terrain&&Z?h.terrain.stencilModeForRTTOverlap(Ee):ae[Ee.overscaledZ],zt=g?0:s.paint.get("raster-fade-duration");nt.registerFadeDuration(zt);const Xt=t.findLoadedParent(Ee,0),hi=xu(nt,Xt,t,h.transform,zt);let qt,Ut;!hi.isFading&&nt.refreshedUponExpiration&&(nt.refreshedUponExpiration=!1),h.terrain&&h.terrain.prepareDrawTile(),R.activeTexture.set(D.TEXTURE0),gt.bind(J,D.CLAMP_TO_EDGE),R.activeTexture.set(D.TEXTURE1),Xt?(Xt.texture&&Xt.texture.bind(J,D.CLAMP_TO_EDGE),qt=Math.pow(2,Xt.tileID.overscaledZ-nt.tileID.overscaledZ),Ut=[nt.tileID.canonical.x*qt%1,nt.tileID.canonical.y*qt%1]):gt.bind(J,D.CLAMP_TO_EDGE),"useMipmap"in gt&&R.extTextureFilterAnisotropic&&h.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const Bi=h.transform;let Di;const Fi=w?jv(Bi):[0,0,0,0];let Ri,on,xn,wn,gr,hn=0;if(A&&U instanceof r.aS&&U.coordinates.length>3)Ri=Float32Array.from(r.bk(r.dF(new r.cC(0,0,0)))),on=Float32Array.from(Bi.globeMatrix),xn=Float32Array.from(r.dB(Bi)),wn=[r.aF(Bi.center.lng),r.aJ(Bi.center.lat)],Di=U.elevatedGlobePerspectiveTransform,gr=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const bn=r.dC(Ee.canonical);hn=r.dD(bn.getCenter().lat),Ri=Float32Array.from(r.bk(r.dF(Ee.canonical))),on=Float32Array.from(Bi.globeMatrix),xn=Float32Array.from(r.dB(Bi)),wn=[r.aF(Bi.center.lng),r.aJ(Bi.center.lat)],Di=[0,0],gr=Float32Array.from(r.dE(Ee.canonical,bn,hn,Bi.worldSize/Bi._pixelsPerMercatorPixel))}else Di=U instanceof r.aS?U.perspectiveTransform:[0,0],Ri=new Float32Array(16),on=new Float32Array(9),xn=new Float32Array(16),wn=[0,0],gr=new Float32Array(9);const nr=cf(bt,Ri,on,xn,gr,Ut||[0,0],r.aj(h.transform.zoom),wn,Fi,qt||1,hi,s,Di,w?s.paint.get("raster-elevation"):0,2,et,pt,F.range,Kt,it,V),mr=h.isTileAffectedByFog(Ee),Hr=h.getOrCreateProgram("raster",{defines:F.defines,overrideFog:mr});if(h.uploadCommonUniforms(R,Hr,Re),U instanceof r.aS){const bn=U.elevatedGlobeVertexBuffer,ur=U.elevatedGlobeIndexBuffer;if(Z||!x)U.boundsBuffer&&U.boundsSegments&&Hr.draw(h,D.TRIANGLES,Ve,Xi.disabled,G,Wi.disabled,nr,s.id,U.boundsBuffer,h.quadTriangleIndexBuffer,U.boundsSegments);else if(bn&&ur){const lr=Bi.zoom<=r.cZ?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Bi.center.lng);lr&&Hr.draw(h,D.TRIANGLES,Ve,Xi.disabled,G,Me,nr,s.id,bn,ur,lr)}}else if(A){Ve=new mi(D.LEQUAL,mi.ReadOnly,h.depthRangeFor3D);const bn=h.globeSharedBuffers;if(bn){const[ur,lr,dr]=bn.getGridBuffers(hn,!1);Hr.draw(h,D.TRIANGLES,Ve,Ie||ct,h.colorModeForRenderPass(),Me,nr,s.id,ur,lr,dr)}}else{const{tileBoundsBuffer:bn,tileBoundsIndexBuffer:ur,tileBoundsSegments:lr}=h.getTileBoundsBuffers(nt);Hr.draw(h,D.TRIANGLES,Ve,ct,G,Wi.disabled,nr,s.id,bn,ur,lr)}}if(!(U instanceof r.aS)&&A)for(const Ee of Ae){const Re=Ee.canonical.y===(1<<Ee.canonical.z)-1;Ee.canonical.y===0&&xf(!0,Ee,h,t,s,V,F,Me,Ie||Xi.disabled),Re&&xf(!1,Ee,h,t,s,V,F,Me===Wi.frontCW?Wi.backCW:Wi.frontCW,Ie||Xi.disabled)}};A?Pe(me,h.renderElevatedRasterBackface?Wi.backCW:Wi.frontCW,h.stencilModeFor3D()):Pe(me,Wi.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,s,u,m,g){h.renderPass==="offscreen"&&(function(x,w,A,R){if(!R.length)return;const D=x.context,U=D.gl,F=w.getSource();if(!(F instanceof Xs))return;const V=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let G=A.particlePositionRGBAImage;if(!G||G.width!==V){const me=(function(ye){const Pe=ye*ye,Ae=new Uint8Array(4*Pe),Me=function(Ee){return Ee|=0,Ee=Math.imul(2747636419^Ee,2654435769),Ee=Math.imul(Ee^Ee>>>16,2654435769),((Ee=Math.imul(Ee^Ee>>>16,2654435769))>>>0)/4294967296},Ie=1/1.1;for(let Ee=0;Ee<Pe;Ee++){const Re=Ie*(Me(2*Ee+0)+Tu),nt=Ie*(Me(2*Ee+1)+Tu),We=255*Re%1,gt=255*nt%1,et=We,pt=nt-gt/255,Kt=gt;Ae[4*Ee+0]=255*(Re-We/255),Ae[4*Ee+1]=255*et,Ae[4*Ee+2]=255*pt,Ae[4*Ee+3]=255*Kt}return Ae})(V);G=A.particlePositionRGBAImage=new r.q({width:V,height:V},me)}let Z=A.particleFramebuffer;Z?Z.width!==V&&(Z.destroy(),Z=A.particleFramebuffer=D.createFramebuffer(V,V,!0,null)):Z=A.particleFramebuffer=D.createFramebuffer(V,V,!0,null);const ie=[];for(const me of R){const ye=w.getTile(me);if(!(ye instanceof _t))continue;const Pe=La(ye,F,A);if(!Pe)continue;const Ae=[ye.tileSize,ye.tileSize];let Me=A.tileFramebuffer;Me||(Me=A.tileFramebuffer=D.createFramebuffer(Ae[0],Ae[1],!0,null));let Ie=ye.rasterParticleState;Ie||(Ie=ye.rasterParticleState=new qv(D,me,Ae,G));const Ee=Ie.update(A.lastInvalidatedAt);Ie.particleTextureDimension!==V&&Ie.updateParticleTexture(me,G);const Re=Ie.targetColorTexture;Ie.targetColorTexture=Ie.backgroundColorTexture,Ie.backgroundColorTexture=Re;const nt=Ie.particleTexture0;Ie.particleTexture0=Ie.particleTexture1,Ie.particleTexture1=nt,ie.push([me,Pe,Ie,Ee])}if(ie.length===0)return;const J=r.o.now(),ae=A.previousDrawTimestamp?.001*(J-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=J,A.hasColorMap()){D.activeTexture.set(U.TEXTURE0+2);let me=A.colorRampTexture;me||(me=A.colorRampTexture=new r.T(D,A.colorRamp,U.RGBA8)),me.bind(U.LINEAR,U.CLAMP_TO_EDGE)}D.bindFramebuffer.set(A.tileFramebuffer.framebuffer),(function(me,ye,Pe){const Ae=me.context,Me=Ae.gl,Ie=ye.tileFramebuffer;Ae.activeTexture.set(Me.TEXTURE0);const Ee={u_texture:0,u_opacity:1.05*(nt=ye.paint.get("raster-particle-fade-opacity-factor"))/(nt+.05)},Re=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var nt;for(const We of Pe){const[,,gt,et]=We;Ie.colorAttachment.set(gt.targetColorTexture.texture),Ae.viewport.set([0,0,Ie.width,Ie.height]),Ae.clear({color:r.ao.transparent}),et&&(gt.backgroundColorTexture.bind(Me.NEAREST,Me.CLAMP_TO_EDGE),Re.draw(me,Me.TRIANGLES,mi.disabled,Xi.disabled,cn.alphaBlended,Wi.disabled,Ee,ye.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}})(x,A,ie),(function(me,ye,Pe,Ae){const Me=me.context,Ie=Me.gl,Ee=Pe.tileFramebuffer,Re=me.transform.projection.name==="globe",nt=Pe.paint.get("raster-particle-max-speed");for(const We of Ae){const[gt,et,pt]=We;Me.activeTexture.set(Ie.TEXTURE0+0),et.texture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Ee.colorAttachment.set(pt.targetColorTexture.texture);const Kt=me.getOrCreateProgram("rasterParticleDraw",{defines:et.defines,overrideFog:!1});Me.activeTexture.set(Ie.TEXTURE0+1);const it=et.scalarData?[]:[0,1,2,3].map((ct=>r.e6[ct](gt)));it.push(gt);const Ve=gt.canonical.x,bt=gt.canonical.y;for(const ct of it){const zt=ye.getTile(Re?ct.wrapped():ct);if(!zt)continue;const Xt=zt.rasterParticleState;if(!Xt)continue;const hi=ct.canonical.x+(1<<ct.canonical.z)*(ct.wrap-gt.wrap),qt=ct.canonical.y;Xt.particleTexture0.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE);const Ut=Vp(1,Xt.particleTexture0.size[0],[hi-Ve,qt-bt],0,et.texture.size,2,nt,et.textureOffset,et.scale,et.offset);Kt.draw(me,Ie.POINTS,mi.disabled,Xi.disabled,cn.alphaBlended,Wi.disabled,Ut,Pe.id,Xt.particleIndexBuffer,void 0,Xt.particleSegment)}}})(x,w,A,ie),D.bindFramebuffer.set(A.particleFramebuffer.framebuffer),(function(me,ye,Pe,Ae){const Me=me.context,Ie=Me.gl,Ee=ye.paint.get("raster-particle-max-speed"),Re=Ae*ye.paint.get("raster-particle-speed-factor")*.15,nt=(function(gt){return Math.pow(gt,6)})(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),We=ye.particleFramebuffer;Me.viewport.set([0,0,We.width,We.height]);for(const gt of Pe){const[,et,pt]=gt;Me.activeTexture.set(Ie.TEXTURE0+0),et.texture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),Me.activeTexture.set(Ie.TEXTURE0+1);const Kt=pt.particleTexture0;Kt.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE);const it=uf(1,Kt.size[0],0,et.texture.size,Ee,Re,nt,et.textureOffset,et.scale,et.offset);We.colorAttachment.set(pt.particleTexture1.texture),Me.clear({color:r.ao.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:et.defines}).draw(me,Ie.TRIANGLES,mi.disabled,Xi.disabled,cn.unblended,Wi.disabled,it,ye.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}})(x,A,ie,ae)})(h,t,s,u),h.renderPass==="translucent"&&((function(x,w,A,R,D){const U=x.context,F=U.gl,V=w.getSource().tileSize,G=5*(1-r.ah(r.cK,r.cK+1,x.transform.zoom))*V+A.paint.get("raster-particle-elevation"),Z=!x.options.moving,ie=x.transform.projection.name==="globe";if(!R.length)return;const[J,ae]=x.stencilConfigForOverlap(R),me=[];ie&&me.push("PROJECTION_GLOBE_VIEW");const ye=x.stencilModeFor3D();for(const Pe of ae){const Ae=Pe.toUnwrapped(),Me=w.getTile(Pe);if(!Me.rasterParticleState)continue;const Ie=Me.rasterParticleState,Ee=100;Me.registerFadeDuration(Ee);const Re=w.findLoadedParent(Pe,0),nt=xu(Me,Re,w,x.transform,Ee);let We,gt;x.terrain&&x.terrain.prepareDrawTile(),U.activeTexture.set(F.TEXTURE0),Ie.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),U.activeTexture.set(F.TEXTURE1),Re&&Re.rasterParticleState?(Re.rasterParticleState.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),We=Math.pow(2,Re.tileID.overscaledZ-Me.tileID.overscaledZ),gt=[Me.tileID.canonical.x*We%1,Me.tileID.canonical.y*We%1]):Ie.targetColorTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const et=ie?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(Ae,Z),pt=x.transform,Kt=Xp(pt),it=r.dC(Pe.canonical),Ve=r.dD(it.getCenter().lat);let bt,ct,zt,Xt,hi;ie?(bt=Float32Array.from(r.bk(r.dF(Pe.canonical))),ct=Float32Array.from(pt.globeMatrix),zt=Float32Array.from(r.dB(pt)),Xt=[r.aF(pt.center.lng),r.aJ(pt.center.lat)],hi=Float32Array.from(r.dE(Pe.canonical,it,Ve,pt.worldSize/pt._pixelsPerMercatorPixel))):(bt=new Float32Array(16),ct=new Float32Array(9),zt=new Float32Array(16),Xt=[0,0],hi=new Float32Array(9));const qt=Rc(et,bt,ct,zt,hi,gt||[0,0],r.aj(x.transform.zoom),Xt,Kt,We||1,nt,G),Ut=x.isTileAffectedByFog(Pe),Bi=x.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:Ut});if(x.uploadCommonUniforms(U,Bi,Ae),ie){const Di=new mi(F.LEQUAL,mi.ReadOnly,x.depthRangeFor3D),Fi=0,Ri=x.globeSharedBuffers;if(Ri){const[on,xn,wn]=Ri.getGridBuffers(Ve,Fi!==0);Bi.draw(x,F.TRIANGLES,Di,ye,cn.alphaBlended,x.renderElevatedRasterBackface?Wi.frontCCW:Wi.backCCW,qt,A.id,on,xn,wn)}}else{const Di=x.depthModeForSublayer(0,mi.ReadOnly),Fi=J[Pe.overscaledZ],{tileBoundsBuffer:Ri,tileBoundsIndexBuffer:on,tileBoundsSegments:xn}=x.getTileBoundsBuffers(Me);Bi.draw(x,F.TRIANGLES,Di,Fi,cn.alphaBlended,Wi.disabled,qt,A.id,Ri,on,xn)}}x.resetStencilClippingMasks()})(h,t,s,u),h.style.map.triggerRepaint())},background:function(h,t,s,u){const m=s.paint.get("background-color"),g=s.paint.get("background-color-use-theme").constantOr("default")==="none",x=s.paint.get("background-opacity"),w=s.paint.get("background-emissive-strength"),A=s.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const R=h.context,D=R.gl,U=h.transform,F=U.tileSize,V=s.paint.get("background-pattern");let G;if(V!==void 0&&(V===null||(G=h.imageManager.getPattern(r.I.from(V.toString()),s.scope,h.style.getLut(s.scope)),!G)))return;const Z=!V&&m.a===1&&x===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==Z)return;const ie=Xi.disabled,J=h.depthModeForSublayer(0,Z==="opaque"?mi.ReadWrite:mi.ReadOnly),ae=h.colorModeForDrapableLayerRenderPass(w),me=V?"backgroundPattern":"background";let ye,Pe=u;if(Pe||(ye=h.getBackgroundTiles(),Pe=Object.values(ye).map((Ae=>Ae.tileID))),V&&(R.activeTexture.set(D.TEXTURE0),h.imageManager.bind(h.context,s.scope)),A){const Ae=h.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),Me=new Float32Array(r.bA([])),Ie=new r.aO(0,0,0,0,0),Ee=V?df(Me,w,x,h,0,s.scope,G,A,{tileID:Ie,tileSize:F}):hf(Me,w,x,m.toPremultipliedRenderColor(g?null:s.lut));Ae.draw(h,D.TRIANGLES,J,ie,ae,Wi.disabled,Ee,s.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const Ae of Pe){const Me=h.isTileAffectedByFog(Ae),Ie=h.getOrCreateProgram(me,{overrideFog:Me}),Ee=Ae.toUnwrapped(),Re=u?Ae.projMatrix:h.transform.calculateProjMatrix(Ee);h.prepareDrawTile();const nt=t?t.getTile(Ae):ye?ye[Ae.key]:new ko(Ae,F,U.zoom,h),We=V?df(Re,w,x,h,0,s.scope,G,A,{tileID:Ae,tileSize:F}):hf(Re,w,x,m.toPremultipliedRenderColor(g?null:s.lut));h.uploadCommonUniforms(R,Ie,Ee);const{tileBoundsBuffer:gt,tileBoundsIndexBuffer:et,tileBoundsSegments:pt}=h.getTileBoundsBuffers(nt);Ie.draw(h,D.TRIANGLES,J,ie,ae,Wi.disabled,We,s.id,gt,et,pt)}},sky:function(h,t,s){const u=h._atmosphere?r.aj(h.transform.zoom):1,m=s.paint.get("sky-opacity")*u;if(m===0)return;const g=h.context,x=s.paint.get("sky-type"),w=new mi(g.gl.LEQUAL,mi.ReadOnly,[0,1]),A=h.frameCounter/1e3%1;x==="atmosphere"?h.renderPass==="offscreen"?s.needsSkyboxCapture(h)&&((function(R,D,U,F){const V=R.context,G=V.gl;let Z=D.skyboxFbo;if(!Z){Z=D.skyboxFbo=V.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Qp(V),D.skyboxTexture=V.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,D.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let me=0;me<6;++me)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}V.bindFramebuffer.set(Z.framebuffer),V.viewport.set([0,0,32,32]);const ie=D.getCenter(R,!0),J=R.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);r.bA(ae),r.ek(ae,ae,.5*-Math.PI),Iu(R,D,J,ae,ie,0),r.bA(ae),r.ek(ae,ae,.5*Math.PI),Iu(R,D,J,ae,ie,1),r.bA(ae),r.cT(ae,ae,.5*-Math.PI),Iu(R,D,J,ae,ie,2),r.bA(ae),r.cT(ae,ae,.5*Math.PI),Iu(R,D,J,ae,ie,3),r.bA(ae),Iu(R,D,J,ae,ie,4),r.bA(ae),r.ek(ae,ae,Math.PI),Iu(R,D,J,ae,ie,5),V.viewport.set([0,0,R.width,R.height])})(h,s),s.markSkyboxValid(h)):h.renderPass==="sky"&&(function(R,D,U,F,V){const G=R.context,Z=G.gl,ie=R.transform,J=R.getOrCreateProgram("skybox");G.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,D.skyboxTexture);const ae=((me,ye,Pe,Ae,Me)=>({u_matrix:me,u_sun_direction:ye,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Me}))(ie.skyboxMatrix,D.getCenter(R,!1),0,F,V);R.uploadCommonUniforms(G,J),J.draw(R,Z.TRIANGLES,U,Xi.disabled,R.colorModeForRenderPass(),Wi.backCW,ae,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)})(h,s,w,m,A):x==="gradient"&&h.renderPass==="sky"&&(function(R,D,U,F,V){const G=R.context,Z=G.gl,ie=R.transform,J=R.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Qp(G)),G.activeTexture.set(Z.TEXTURE0);let ae=D.colorRampTexture;ae||(ae=D.colorRampTexture=new r.T(G,D.colorRamp,Z.RGBA8)),ae.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const me=((ye,Pe,Ae,Me,Ie)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Pe,u_radius:r.an(Ae),u_opacity:Me,u_temporal_offset:Ie}))(ie.skyboxMatrix,D.getCenter(R,!1),D.paint.get("sky-gradient-radius"),F,V);R.uploadCommonUniforms(G,J),J.draw(R,Z.TRIANGLES,U,Xi.disabled,R.colorModeForRenderPass(),Wi.backCW,me,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)})(h,s,w,m,A)},custom:function(h,t,s,u){const m=h.context,g=s.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&s.isDraped(t)){if(h.renderPass==="offscreen"){const x=g.prerender;if(x){if(h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const w=h.transform.pointMerc;x.call(g,m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.aj(h.transform.zoom),[w.x,w.y],h.transform.pixelsPerMeterRatio)}else x.call(g,m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const w=g.renderToTile;if(w){const A=u[0].canonical,R={x:A.x+u[0].wrap*(g.wrapTileId?0:1<<A.z),y:A.y,z:A.z};m.setDepthMode(mi.disabled),m.setStencilMode(Xi.disabled),m.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),w.call(g,m.gl,R),m.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),m.setColorMode(h.colorModeForRenderPass()),m.setStencilMode(Xi.disabled);const x=g.renderingMode==="3d"?new mi(h.context.gl.LEQUAL,mi.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,mi.ReadOnly);if(m.setDepthMode(x),h.transform.projection.name==="globe"){const w=h.transform.pointMerc;g.render(m.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),r.aj(h.transform.zoom),[w.x,w.y],h.transform.pixelsPerMeterRatio)}else g.render(m.gl,h.transform.customLayerMatrix());m.setDirty(),h.setBaseState(),m.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,s,u){if(h.renderPass==="opaque")return;const m=s.paint.get("model-opacity").constantOr(1);if(m===0)return;const g=s.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!g||h.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const x=h.shadowRenderer,w=s.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,w||(x.enabled=!1));const A=()=>{x&&(x.useNormalOffset=!0,w||(x.enabled=!0))},R=t.getSource();if(h.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return(function(J,ae,me,ye,Pe){const Ae=J.transform;if(Ae.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Me=Ae.getFreeCameraOptions().position;if(!J.modelManager)return;const Ie=J.modelManager;me.modelManager=Ie;const Ee=J.shadowRenderer;if(!me._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Re=me._unevaluatedLayout._values["model-id"],nt=Object.assign({},me.layout.get("model-id").parameters),We=J.style.order.indexOf(me.fqid);for(const gt of ye){const et=ae.getTile(gt).getBucket(me);if(!et||et.projection.name!==Ae.projection.name)continue;const pt=et.getModelUris();pt&&!et.modelsRequested&&(Ie.addModelsFromBucket(pt,Pe),et.modelsRequested=!0);const Kt=gh(gt,Ae);nt.zoom=Kt;const it=Re.possiblyEvaluate(nt);if(Q_(J,et,gt),_l.shadowUniformsInitialized=!1,_l.useSingleShadowCascade=!!Ee&&Ee.getMaxCascadeForTile(gt.toUnwrapped())===0,J.renderPass==="shadow"&&Ee){if(J.currentShadowCascade===1&&et.isInsideFirstShadowMapFrustum)continue;const ct=Ae.calculatePosMatrix(gt.toUnwrapped(),Ae.worldSize);if(_l.tileMatrix.set(ct),_l.shadowTileMatrix=Float32Array.from(Ee.calculateShadowPassMatrixFromMatrix(ct)),_l.aabb.min=[0,0,0],_l.aabb.max[0]=_l.aabb.max[1]=r.al,_l.aabb.max[2]=0,tg(et,_l,J,me.scope))continue}const Ve=1<<gt.canonical.z,bt=[((Me.x-gt.wrap)*Ve-gt.canonical.x)*r.al,(Me.y*Ve-gt.canonical.y)*r.al,Me.z*Ve*r.al];J.conflationActive&&Object.keys(et.instancesPerModel).length>0&&J.style.isLayerClipped(me,ae.getSource())&&et.updateReplacement(gt,J.replacementSource,We,Pe)&&(et.uploaded=!1,et.upload(J.context));for(let ct in et.instancesPerModel){const zt=et.instancesPerModel[ct];zt.features.length>0&&(ct=it.evaluate(zt.features[0].feature,{}));const Xt=Ie.getModel(ct,Pe);if(Xt||Ie.hasURLBeenRequested(ct)||et.modelUris.includes(ct)||(et.modelUris.push(ct),et.modelsRequested=!1),Xt&&Xt.uploaded)for(const hi of Xt.nodes)eg(J,me,hi,zt,bt,gt,_l)}}})(h,t,s,u,R.type==="vector"?s.scope:""),void A();if(!R.loaded())return;if(R.type==="batched-model")return(function(J,ae,me,ye){me.resetLayerRenderingStats(J);const Pe=J.context,Ae=J.transform,Me=J.style.fog,Ie=J.shadowRenderer;if(Ae.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Ee=J.transform.getFreeCameraOptions().position,Re=r.c4([],[Ee.x,Ee.y,Ee.z],J.transform.worldSize),nt=r.et([],Re),We=r.bA([]),gt=r.ec(Ae.center.lat,Ae.zoom),et=r.bq([],[1,1,1/gt]);r.br(We,We,nt);const pt=me.paint.get("model-opacity").constantOr(1),Kt=new mi(Pe.gl.LEQUAL,mi.ReadWrite,J.depthRangeFor3D),it=new mi(Pe.gl.LEQUAL,mi.ReadOnly,J.depthRangeFor3D),Ve=new r.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),bt=J.renderPass==="shadow",ct=bt&&Ie?Ie.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),zt=me.paint.get("model-front-cutoff"),Xt=zt[2]<1,hi=Cl(J,me.paint.get("model-cutoff-fade-range")),qt=me.getLayerRenderingStats();(function(Ut,Bi,Di,Fi){const Ri=Ut.terrain?Ut.terrain.exaggeration():0,on=Ut.transform.zoom;for(const xn of Fi){const wn=Bi.getTile(xn).getBucket(Di);wn&&(wn.setFilter(Di.filter),Ut.conflationActive&&wn.updateReplacement(xn,Ut.replacementSource),wn.evaluateTransform(Ut,Di),Ut.terrain&&Ri>0&&wn.elevationUpdate(Ut.terrain,Ri,xn,Di.source),wn.needsReEvaluation(Ut,on,Di)&&wn.evaluate(Di))}})(J,ae,me,ye),(function(){let Ut,Bi,Di;Xt?(Ut=ye.length-1,Bi=-1,Di=-1):(Ut=0,Bi=ye.length,Di=1);const Fi=new Float64Array(16),Ri=r.cz(),on=new r.P(0,0);for(let xn=Ut;xn!==Bi;xn+=Di){const wn=ye[xn],gr=ae.getTile(wn).getBucket(me);if(!gr||!gr.uploaded)continue;let hn=!1;Ie&&(hn=Ie.getMaxCascadeForTile(wn.toUnwrapped())===0);const nr=Ae.calculatePosMatrix(wn.toUnwrapped(),Ae.worldSize),mr=gr.modelTraits;!bt&&Xt&&(r.bl(Fi,nr),r.af(Ri,Re,Fi),on.x=Ri[0],on.y=Ri[1]);const Hr=[];gr.setFilter(me.filter);for(const bn of gr.getNodesInfo()){if(bn.hiddenByReplacement||!bn.node.meshes)continue;const ur=bn.node;let lr=0;J.terrain&&ur.elevation&&(lr=ur.elevation*J.terrain.exaggeration());const dr=(()=>{const Oo=bn.aabb;return Ve.min=[...Oo.min],Ve.max=[...Oo.max],Ve.min[2]+=lr,Ve.max[2]+=lr,r.af(Ve.min,Ve.min,nr),r.af(Ve.max,Ve.max,nr),Ve})(),Qr=bn.evaluatedScale;if(Qr[0]<=1&&Qr[1]<=1&&Qr[2]<=1&&dr.intersects(ct)===0)continue;if(!bt&&Xt){const Oo=.16666666666666666;bn.cameraCollisionOpacity=Re[0]>dr.min[0]&&Re[0]<dr.max[0]&&Re[1]>dr.min[1]&&Re[1]<dr.max[1]&&Re[2]*gt<dr.max[2]&&ur.footprint&&r.b$(on,ur.footprint)?Math.max(bn.cameraCollisionOpacity-Oo,0):Math.min(1,bn.cameraCollisionOpacity+Oo)}const Cs=[...nr],vo=1/r.d6(wn.canonical),es=ur.anchor?ur.anchor[0]:0,Tn=ur.anchor?ur.anchor[1]:0;r.br(Cs,Cs,[es*(Qr[0]-1)+bn.evaluatedTranslation[0]*vo,Tn*(Qr[1]-1)+bn.evaluatedTranslation[1]*vo,lr+bn.evaluatedTranslation[2]]),r.cp(Qr,r.ev)||r.cR(Cs,Cs,Qr);const nn=r.aB([],Cs,ur.matrix),yr=r.aB([],Ae.expandedFarZProjMatrix,nn),bs=r.aB([],Ae.expandedFarZProjMatrix,Cs),os=r.aC([],[es,Tn,lr,1],yr)[2];ur.hidden=!1;let Zs=pt;bt||(Xt&&(Zs*=bn.cameraCollisionOpacity,Zs*=em(Cs,Ae,bn.aabb,zt)),Zs*=Sf(hi,os)),Zs!==0?Hr.push({nodeInfo:bn,depth:os,opacity:Zs,wvpForNode:yr,wvpForTile:bs,nodeModelMatrix:nn,tileModelMatrix:Cs}):ur.hidden=!0}bt||Hr.sort(((bn,ur)=>!Xt||bn.opacity===1&&ur.opacity===1?bn.depth<ur.depth?-1:1:bn.opacity===1?-1:ur.opacity===1?1:bn.depth>ur.depth?-1:1));for(const bn of Hr){const ur=bn.nodeInfo,lr=ur.node;let dr=r.aB([],et,bn.tileModelMatrix);r.aB(dr,We,dr);const Qr=r.bl([],dr);r.ed(Qr,Qr),r.cR(Qr,Qr,Gv),dr=r.aB(dr,dr,lr.matrix);const Cs=J.renderPass==="light-beam",vo=me.paint.get("model-color-use-theme").constantOr("default")==="none",es=mr&r.ez.HasMapboxMeshFeatures,Tn=es?0:ur.evaluatedRMEA[0][2];for(let nn=0;nn<lr.meshes.length;++nn){const yr=lr.meshes[nn],bs=nn===lr.lightMeshIndex;let os=bn.wvpForNode;if(bs){if(!Cs&&!J.terrain&&J.shadowRenderer){J.currentLayer<J.firstLightBeamLayer&&(J.firstLightBeamLayer=J.currentLayer);continue}os=bn.wvpForTile}else if(Cs)continue;const Zs={defines:[]},Oo=[];if(!bt&&Ie&&(Ie.useNormalOffset=!!yr.normalBuffer),wf(Zs.defines,Oo,yr,J,vo?null:me.lut),es||Zs.defines.push("DIFFUSE_SHADED"),hn&&Zs.defines.push("SHADOWS_SINGLE_CASCADE"),qt&&(bt?qt.numRenderedVerticesInShadowPass+=yr.vertexArray.length:qt.numRenderedVerticesInTransparentPass+=yr.vertexArray.length),bt){rd(yr,bn.nodeModelMatrix,J,me);continue}let Ha=null;if(Me){const vl=Ye(bn.nodeModelMatrix,J.transform);if(Ha=new Float32Array(vl),Ae.projection.name!=="globe"){const Is=yr.aabb.min,Ms=yr.aabb.max,[as,to]=Me.getOpacityForBounds(vl,Is[0],Is[1],Ms[0],Ms[1]);Zs.overrideFog=as>=wi||to>=wi}}const Za=yr.material;let Da;Za.occlusionTexture&&Za.occlusionTexture.offsetScale&&(Da=Za.occlusionTexture.offsetScale,Zs.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const za=J.getOrCreateProgram("model",Zs);!bt&&Ie&&Ie.setupShadowsFromMatrix(bn.tileModelMatrix,za,Ie.useNormalOffset),J.uploadCommonUniforms(Pe,za,null,Ha);const pa=Za.pbrMetallicRoughness;pa.metallicFactor=.9,pa.roughnessFactor=.5;const ol=ff(new Float32Array(os),new Float32Array(dr),new Float32Array(Qr),new Float32Array(lr.matrix),J,bn.opacity,pa.baseColorFactor,Za.emissiveFactor,pa.metallicFactor,pa.roughnessFactor,Za,Tn,me,[0,0,0],Da);!bs&&(ur.hasTranslucentParts||bn.opacity<1)&&za.draw(J,Pe.gl.TRIANGLES,Kt,Xi.disabled,cn.disabled,Wi.backCCW,ol,me.id,yr.vertexBuffer,yr.indexBuffer,yr.segments,me.paint,J.transform.zoom,void 0,Oo),za.draw(J,Pe.gl.TRIANGLES,bs?it:Kt,Xi.disabled,bs||bn.opacity<1||ur.hasTranslucentParts?cn.alphaBlended:cn.unblended,Wi.backCCW,ol,me.id,yr.vertexBuffer,yr.indexBuffer,yr.segments,me.paint,J.transform.zoom,void 0,Oo)}}}})()})(h,t,s,u),void A();if(R.type!=="model")return;const D=R.getModels(),U=[],F=h.transform.getFreeCameraOptions().position,V=r.c4([],[F.x,F.y,F.z],h.transform.worldSize);r.et(V,V);const G=[],Z=[];let ie=0;for(const J of D){const ae=s.paint.get("model-rotation").constantOr(null),me=s.paint.get("model-scale").constantOr(null),ye=s.paint.get("model-translation").constantOr(null);J.computeModelMatrix(h,ae,me,ye,!0,!0,!1);const Pe=r.bA([]),Ae=r.ec(J.position.lat,h.transform.zoom),Me=r.bq([],[1,1,1/Ae]);r.br(Pe,Pe,V),U.push({zScaleMatrix:Me,negCameraPosMatrix:Pe});for(const Ie of J.nodes)Tf(h.transform,Ie,J.matrix,h.transform.expandedFarZProjMatrix,ie,G,Z);ie++}if(G.sort(((J,ae)=>ae.depth-J.depth)),h.renderPass!=="shadow"){if(m===1)for(const J of Z)Mu(J,h,s,U[J.modelIndex],Xi.disabled,h.colorModeForRenderPass());else{for(const J of Z)Mu(J,h,s,U[J.modelIndex],Xi.disabled,cn.disabled);for(const J of Z)Mu(J,h,s,U[J.modelIndex],h.stencilModeFor3D(),h.colorModeForRenderPass());h.resetStencilClippingMasks()}for(const J of G)Mu(J,h,s,U[J.modelIndex],Xi.disabled,h.colorModeForRenderPass());A()}else{for(const J of Z)rd(J.mesh,J.nodeModelMatrix,h,s);for(const J of G)rd(J.mesh,J.nodeModelMatrix,h,s);A()}}},Ru={line:function(h,t,s){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const m of u){const g=t.getTile(m).getBucket(h);if(g&&(g.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,s){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,u.type==="vector"?h.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const m=u.getModels();for(const g of m)g.upload(s.context)},raster:function(h,t,s){const u=t.getSource();if(!(u instanceof Xs&&u.loaded()))return;const m=h.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!m)return;const g=h.paint.get("raster-array-band")||u.getInitialBand(m);if(g==null)return;const x=t.getIds().map((w=>t.getTileByID(w)));for(const w of x)w.updateNeeded(h.id,g)&&u.prepareTile(w,m,h.id,g)},"raster-particle":function(h,t,s){const u=t.getSource();if(!(u instanceof Xs&&u.loaded()))return;const m=h.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!m)return;const g=h.paint.get("raster-particle-array-band")||u.getInitialBand(m);if(g==null)return;const x=t.getIds().map((w=>t.getTileByID(w)));for(const w of x)w.updateNeeded(h.id,g)&&u.prepareTile(w,m,h.id,g)}},Ou={fill:Su},Nc={fill:function(h,t,s,u){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const m=h.context.gl,g=new mi(m.LEQUAL,mi.ReadOnly,h.depthRangeFor3D),x=new Xi({func:m.ALWAYS,mask:255},255,255,m.KEEP,m.KEEP,m.REPLACE),w=h.transform.getFreeCameraOptions().position,A=h.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const R of u){const D=t.getTile(R),U=D.getBucket(s);if(!U)continue;const F=U.elevatedStructures;if(!F||F.depthSegments.segments[0].primitiveLength===0)continue;const V=W_(R.toUnwrapped(),w),G=h.translatePosMatrix(R.projMatrix,D,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),Z=lf(G,V,0,1,0);A.draw(h,m.TRIANGLES,g,x,cn.disabled,Wi.disabled,Z,s.id,F.vertexBuffer,F.indexBuffer,F.depthSegments,s.paint,h.transform.zoom)}}};class im{constructor(t,s,u,m,g,x){this.context=new Gp(t,s),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of w)this._debugParams.enabledLayers[R]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of w)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new Ef(g),this.setup(),this.numSublayers=Fn.maxUnderzooming+Fn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new rh(this),this._wireframeDebugCache=new ng,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,A,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m,this.worldview=x}updateTerrain(t,s){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Qh(this,t));const m=this._terrain;this.transform.elevation=u?m:null,m.update(t,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,m]=s.getFovAdjustedRange(this.transform._fov);if(u>m)return void(this.transform.fogCullDistSq=null);const g=u+.78*(m-u);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Qh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*r.o.devicePixelRatio,this.height=s*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,s=new r.bd;s.emplaceBack(0,0),s.emplaceBack(r.al,0),s.emplaceBack(0,r.al),s.emplaceBack(r.al,r.al),this.tileExtentBuffer=t.createVertexBuffer(s,r.bf.members),this.tileExtentSegments=r.bg.simpleSegment(0,0,4,2);const u=new r.bd;u.emplaceBack(0,0),u.emplaceBack(r.al,0),u.emplaceBack(0,r.al),u.emplaceBack(r.al,r.al),this.debugBuffer=t.createVertexBuffer(u,r.bf.members),this.debugSegments=r.bg.simpleSegment(0,0,4,5);const m=new r.bd;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,r.bf.members),this.viewportSegments=r.bg.simpleSegment(0,0,4,2);const g=new r.b0;g.emplaceBack(0,0,0,0),g.emplaceBack(r.al,0,r.al,0),g.emplaceBack(0,r.al,0,r.al),g.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=t.createVertexBuffer(g,r.bi.members),this.mercatorBoundsSegments=r.bg.simpleSegment(0,0,4,2);const x=new r.b1;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const w=new r.be;for(const R of[0,1,3,2,0])w.emplaceBack(R);this.debugIndexBuffer=t.createIndexBuffer(w),this.emptyTexture=new r.T(t,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bC();const A=this.context.gl;this.stencilClearMode=new Xi({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,mi.disabled,this.stencilClearMode,cn.disabled,Wi.disabled,vu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,u){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(const A of u)if(this._tileClippingMaskIDs[A.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=s.id;const m=this.context,g=m.gl;this.nextStencilID+u.length>256&&this.clearStencil(),m.setColorMode(cn.disabled),m.setDepthMode(mi.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of u){const A=s.getTile(w),R=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:U,tileBoundsSegments:F}=this.getTileBoundsBuffers(A);x.draw(this,g.TRIANGLES,mi.disabled,new Xi({func:g.ALWAYS,mask:0},R,255,g.KEEP,g.KEEP,g.REPLACE),cn.disabled,Wi.disabled,vu(w.projMatrix),"$clipping",D,U,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Xi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new Xi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,u=t.sort(((x,w)=>w.overscaledZ-x.overscaledZ)),m=u[u.length-1].overscaledZ,g=u[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let w=0;w<g;w++)x[w+m]=new Xi({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,u]}return[{[m]:Xi.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new cn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cn.unblended:cn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new cn([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,u,m=!1){if(this.depthOcclusion)return new mi(this.context.gl.GREATER,mi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return mi.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new mi(u||this.context.gl.LEQUAL,s,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),u=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&u!==0&&(this.depthFBO=new pf(this.context,s,u,!1,"texture"),this.depthTexture=new r.T(this.context,{width:s,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,u,0,0,s,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,s)=>t+s/this._fpsHistory.length),0))}render(t,s){const u=r.o.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const m=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(g).filter((it=>{const Ve=m[it];return!(Ve.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ve.type]}));let w=x(),A=!1,R=!1,D=null;for(const it of w){const Ve=m[it];Ve.type==="circle"?A=!0:Ve.type==="building"?D=Ve:Ve.type==="symbol"&&(Ve.hasOcclusionOpacityProperties?R=!0:A=!0)}let U=w.map((it=>m[it]));const F=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();let V=0,G=!1;for(const it in F){const Ve=F[it];Ve.used&&(Ve.prepare(this.context),Ve.getSource().usedInConflation&&++V)}let Z=!1;for(const it of U)it.isHidden(this.transform.zoom)||(it.type==="clip"&&(Z=!0),this.prepareLayer(it));const ie={},J={},ae={},me={},ye={};for(const it in F){const Ve=F[it];ie[it]=Ve.getVisibleCoordinates(),J[it]=ie[it].slice().reverse(),ae[it]=Ve.getVisibleCoordinates(!0).reverse(),me[it]=Ve.getShadowCasterCoordinates(),ye[it]=Ve.sortCoordinatesByDistance(ie[it])}const Pe=it=>{const Ve=this.style.getLayerSourceCache(it);return Ve&&Ve.used?Ve.getSource():null};if(V||Z||this._clippingActiveLastFrame){const it=[],Ve=[];let bt=0;for(const ct of U)this.isSourceForClippingOrConflation(ct,Pe(ct))&&(it.push(ct),Ve.push(bt)),bt++;if(it&&(Z||it.length>1)||this._clippingActiveLastFrame){Z=!1;const ct=[];for(let zt=0;zt<it.length;zt++){const Xt=it[zt],hi=Ve[zt],qt=this.style.getLayerSourceCache(Xt);if(!qt||!qt.used||!qt.getSource().usedInConflation&&Xt.type!=="clip"&&Xt.type!=="building")continue;let Ut=r.eH,Bi=r.bZ.None;const Di=[];let Fi=!0;if(Xt.type==="building")Ut=r.eJ;else if(Xt.type==="clip"){Ut=hi;for(const Ri of Xt.layout.get("clip-layer-types"))Bi|=Ri==="model"?r.bZ.Model:Ri==="symbol"?r.bZ.Symbol:r.bZ.FillExtrusion;for(const Ri of Xt.layout.get("clip-layer-scope"))Di.push(Ri);Xt.isHidden(this.transform.zoom)?Fi=!1:Z=!0}Fi&&ct.push({layer:Xt.fqid,cache:qt,order:Ut,clipMask:Bi,clipScope:Di})}this.replacementSource.setSources(ct),G=!0}}this._clippingActiveLastFrame=Z,G||this.replacementSource.clear(),this.conflationActive=G,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let it=0;it<U.length;it++){const Ve=U[it],bt=Ve.cutoffRange();if(this.longestCutoffRange=Math.max(bt,this.longestCutoffRange),bt>0){const ct=Pe(Ve);ct&&(this.minCutoffZoom=Math.max(ct.minzoom,this.minCutoffZoom)),Ve.minzoom&&(this.minCutoffZoom=Math.max(Ve.minzoom,this.minCutoffZoom))}Ve.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=it),this._lastOcclusionLayer=it)}const Ae=this.style&&this.style.fog;Ae?(this._fogVisible=Ae.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ae.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ae),this.opaquePassCutoff=0,w=x(),U=w.map((it=>m[it])));const Me=this._shadowRenderer;if(Me){Me.updateShadowParameters(this.transform,this.style.directionalLight);for(const it in F)for(const Ve of ie[it]){let bt={min:0,max:0};this.terrain&&(bt=this.terrain.getMinMaxForTile(Ve)||bt),Me.addShadowReceiver(Ve.toUnwrapped(),bt.min,bt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new _h(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ie=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ee=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ie&&!this._snow&&(this._snow=new ag(this)),!Ie&&this._snow&&(this._snow.destroy(),delete this._snow),Ee&&!this._rain&&(this._rain=new Gr(this)),!Ee&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),D){this.buildingTileBorderManager||(this.buildingTileBorderManager=new xs);const it=this.style.getLayerSourceCache(D);this.buildingTileBorderManager.updateBorders(it,D)}if(!un.has(this.context.gl))return;this.renderPass="offscreen";for(const it of U){const Ve=t.getLayerSourceCache(it);if(!it.hasOffscreenPass()||it.isHidden(this.transform.zoom))continue;const bt=Ve?J[Ve.id]:void 0;(it.type==="custom"||it.type==="raster"||it.type==="raster-particle"||it.isSky()||bt&&bt.length)&&this.renderLayer(this,Ve,it,bt)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Re=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),nt=(()=>{if(s.showOverdrawInspector)return r.ao.black;const it=this.style.fog;if(it&&this.transform.projection.supportsFog){const Ve=this.style.getLut(it.scope);if(!Re){const bt=it.properties.get("color-use-theme")==="none",ct=it.properties.get("color").toNonPremultipliedRenderColor(bt?null:Ve).toArray01();return new r.ao(...ct)}if(Re){const bt=it.properties.get("space-color-use-theme")==="none",ct=it.properties.get("space-color").toNonPremultipliedRenderColor(bt?null:Ve).toArray01();return new r.ao(...ct)}}return r.ao.transparent})();if(this.context.clear({color:nt,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const it=U[this.currentLayer],Ve=t.getLayerSourceCache(it);if(it.isSky())continue;const bt=Ve?(it.is3D(g)?ye:J)[Ve.id]:void 0;this._renderTileClippingMasks(it,Ve,bt),this.renderLayer(this,Ve,it,bt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const it=U[this.currentLayer],Ve=t.getLayerSourceCache(it);it.isSky()&&this.renderLayer(this,Ve,it,Ve?J[Ve.id]:void 0)}function We(it,Ve){let bt;return Ve&&(bt=(it.type==="symbol"?ae:it.is3D(g)?ye:J)[Ve.id]),bt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const it=U[this.currentLayer];if(it.type==="raster"||it.type==="raster-particle"){const Ve=t.getLayerSourceCache(it);this.renderLayer(this,Ve,it,We(it,Ve))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let gt=0;Me&&(gt=Me.getShadowCastingLayerCount());let et=!1,pt=-1;for(let it=0;it<w.length;++it){const Ve=U[it];Ve.isHidden(this.transform.zoom)||Ve.is3D(g)&&(pt=it)}R&&pt===-1&&(A=!0);let Kt=!1;for(;this.currentLayer<w.length;){const it=U[this.currentLayer],Ve=t.getLayerSourceCache(it);if(it.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(it)){if(it.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Kt&&it.is3D(g)&&!g){const bt=this.currentLayer,ct=zt=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const Xt=U[this.currentLayer];if(Ou[Xt.type]){const hi=this.style.getLayerSourceCache(Xt);Ou[Xt.type](this,hi,Xt,We(Xt,hi),zt)}}};ct("initialize"),ct("reset"),this.currentLayer=bt,Kt=!0}if(A&&!et&&this.terrain&&!this.transform.isOrthographic&&(et=!0,this.blitDepth()),R&&pt!==-1&&this.currentLayer===pt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(it,Ve,Ve?ie[Ve.id]:void 0),this.renderLayer(this,Ve,it,We(it,Ve)),!this.terrain&&Me&&gt>0&&it.hasShadowPass()&&--gt==0){{this.clearStencil(),this.resetStencilClippingMasks();const bt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const ct=U[this.currentLayer];if(Nc[ct.type]){const zt=this.style.getLayerSourceCache(ct);Nc[ct.type](this,zt,ct,We(ct,zt))}}this.currentLayer=bt}if(Me.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const bt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=bt;this.currentLayer++){const ct=U[this.currentLayer];if(!ct.hasLightBeamPass())continue;const zt=t.getLayerSourceCache(ct);this.renderLayer(this,zt,ct,zt?J[zt.id]:void 0)}this.currentLayer=bt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const bt=this.currentLayer;this.depthOcclusion=!0;for(const ct of this.layersWithOcclusionOpacity){this.currentLayer=ct;const zt=U[this.currentLayer],Xt=t.getLayerSourceCache(zt),hi=Xt?J[Xt.id]:void 0;this.terrain||this._renderTileClippingMasks(zt,Xt,Xt?ie[Xt.id]:void 0),this.renderLayer(this,Xt,zt,hi)}this.depthOcclusion=!1,this.currentLayer=bt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let it=null;U.forEach((Ve=>{const bt=t.getLayerSourceCache(Ve);bt&&!Ve.isHidden(this.transform.zoom)&&bt.getVisibleCoordinates().length&&(!it||it.getSource().maxzoom<bt.getSource().maxzoom)&&(it=bt)})),it&&this.options.showTileBoundaries&&bf(this,it,it.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&bf(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(it){const Ve=it.transform.padding;kl(it,it.transform.height-(Ve.top||0),3,fa),kl(it,Ve.bottom||0,3,kc),Nr(it,Ve.left||0,3,Y_),Nr(it,it.transform.width-(Ve.right||0),3,Kp);const bt=it.transform.centerPoint;(function(ct,zt,Xt,hi){Au(ct,zt-1,Xt-10,2,20,hi),Au(ct,zt-10,Xt-1,20,2,hi)})(it,bt.x,it.transform.height-bt.y,Yp)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),G||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,u=!s||!s.includes(t.type);if(Ru[t.type]&&(u||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);Ru[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,s,u,m){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||m&&m.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Bc[u.type](t,s,u,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,u=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),m.calls++,u.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,u=s.createQuery();this.deferredRenderGpuTimeQueries.push(u),s.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const u in t){const m=t[u],g=this.context.extTimerQuery,x=g.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(m.query),s[u]=x}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let u=0;for(const m of t)u+=s.getQueryParameter(m,s.QUERY_RESULT)/1e6,s.deleteQuery(m);return u}translatePosMatrix(t,s,u,m,g){if(!u[0]&&!u[1])return t;const x=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const R=Math.sin(x),D=Math.cos(x);u=[u[0]*D-u[1]*R,u[0]*R+u[1]*D]}const w=[g?u[0]:r.ay(s,u[0],this.transform.zoom),g?u[1]:r.ay(s,u[1],this.transform.zoom),0],A=new Float32Array(16);return r.br(A,t,w),A}saveTileTexture(t){if(t.context!==this.context)return;const s=t.size[0],u=this._tileTextures[s];u?u.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,u){const m=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||g.push("FOG","FOG_DITHERING"),m&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,s){this.cache=this.cache||{};const u=s&&s.defines||[],m=s&&s.config,g=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(u),x=af.cacheKey(pu[t],t,g,m);return this.cache[x]||(this.cache[x]=new af(this.context,t,pu[t],m,Uv[t],g)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const u=this.style.directionalLight,m=this.style.ambientLight;if(u&&m){const g=((x,w,A)=>{const R=x.properties.get("direction"),D=x.properties.get("color-use-theme")==="none",U=x.properties.get("color").toNonPremultipliedRenderColor(D?null:A.getLut(x.scope)).toArray01(),F=x.properties.get("intensity"),V=w.properties.get("color-use-theme")==="none",G=w.properties.get("color").toNonPremultipliedRenderColor(V?null:A.getLut(w.scope)).toArray01(),Z=w.properties.get("intensity"),ie=[R.x,R.y,R.z],J=r.dK(G,Z),ae=r.dK(U,F);return{u_lighting_ambient_color:J,u_lighting_directional_dir:ie,u_lighting_directional_color:ae,u_ground_radiance:of(ie,ae,J)}})(u,m,this.style);s.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,s,u,m,g){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const w=x.getOpacity(this.transform.pitch),A=((R,D,U,F,V,G,Z,ie,J,ae,me,ye)=>{const Pe=R.transform,Ae=D.properties.get("color-use-theme")==="none",Me=D.properties.get("color").toNonPremultipliedRenderColor(Ae?null:R.style.getLut(D.scope)).toArray01();Me[3]=F;const Ie=R.frameCounter/1e3%1,[Ee,Re]=D.properties.get("vertical-range");return{u_fog_matrix:U?Pe.calculateFogTileMatrix(U):ye||R.identityMat,u_fog_range:D.getFovAdjustedRange(Pe._fov),u_fog_color:Me,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,Re),Re],u_fog_temporal_offset:Ie,u_frustum_tl:V,u_frustum_tr:G,u_frustum_br:Z,u_frustum_bl:ie,u_globe_pos:J,u_globe_radius:ae,u_viewport:me,u_globe_transition:r.aj(Pe.zoom),u_is_globe:+(Pe.projection.name==="globe")}})(this,x,u,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],m);s.setFogUniformValues(t,A)}g&&s.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const m of u)s[m.key]=t[m.key]||new ko(m,512,this.transform.tileZoom,this,void 0,this.worldview);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=wi||s[1]>=wi}setupDepthForOcclusion(t,s,u){const m=this.context,g=m.gl,x=!!u;var w;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((w=this.depthRangeFor3D)[1]-w[0]),-1-2*w[0]/(w[1]-w[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE0),x||s.setTerrainUniformValues(m,u)}}function Af(h,t){let s=!1,u=null;const m=()=>{u=null,s&&(h(),u=setTimeout(m,t),s=!1)};return()=>(s=!0,u||m(),u)}class nm{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Af(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=If(t);if(this._hashName){const u=this._hashName;let m=!1;const g=location.hash.slice(1).split("&").map((x=>{const w=x.split("=")[0];return w===u?(m=!0,`${w}=${s}`):x})).filter((x=>x));return m||g.push(`${u}=${s}`),`#${g.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map((u=>u.split("="))).forEach((u=>{u[0]===this._hashName&&(s=u)})),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some((u=>isNaN(Number(u))))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function If(h,t){const s=h.getCenter(),u=Math.round(100*h.getZoom())/100,m=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),x=Math.round(s.lng*g)/g,w=Math.round(s.lat*g)/g,A=h.getBearing(),R=h.getPitch();let D=t?`/${x}/${w}/${u}`:`${u}/${w}/${x}`;return(A||R)&&(D+="/"+Math.round(10*A)/10),R&&(D+=`/${Math.round(R)}`),D}const Ta={linearity:.3,easing:r.eK(0,0,.3,1)},Uc=Object.assign({deceleration:2500,maxSpeed:1400},Ta),xh=Object.assign({deceleration:20,maxSpeed:1400},Ta),Pf=Object.assign({deceleration:1e3,maxSpeed:360},Ta),rm=Object.assign({deceleration:1e3,maxSpeed:90},Ta);class sm{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=r.o.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const g=bh(s.pan.mag(),u,Object.assign({},Uc,t||{}));m.offset=s.pan.mult(g.amount/s.pan.mag()),m.center=this._map.transform.center,gl(m,g)}if(s.zoom){const g=bh(s.zoom,u,xh);m.zoom=this._map.transform.zoom+g.amount,gl(m,g)}if(s.bearing){const g=bh(s.bearing,u,Pf);m.bearing=this._map.transform.bearing+r.aA(g.amount,-179,179),gl(m,g)}if(s.pitch){const g=bh(s.pitch,u,rm);m.pitch=this._map.transform.pitch+g.amount,gl(m,g)}if(m.zoom||m.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function gl(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function bh(h,t,s){const{maxSpeed:u,linearity:m,deceleration:g}=s,x=r.aA(h*m/(t/1e3),-u,u),w=Math.abs(x)/(g*m);return{easing:s.easing,duration:1e3*w,amount:x*(w/2)}}class eo extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u,m={}){const g=ot(s.getCanvasContainer(),u),x=s.unproject(g);super(t,Object.assign({point:g,lngLat:x,originalEvent:u},m)),this._defaultPrevented=!1,this.target=s}}class wh extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,u){const m=t==="touchend"?u.changedTouches:u.touches,g=Be(s.getCanvasContainer(),m),x=g.map((A=>s.unproject(A))),w=g.reduce(((A,R,D,U)=>A.add(R.div(U.length))),new r.P(0,0));super(t,{points:g,point:w,lngLats:x,lngLat:s.unproject(w),originalEvent:u}),this._defaultPrevented=!1}}class Cf extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class om{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Cf(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new eo(t.type,this._map,t))}mouseup(t){this._map.fire(new eo(t.type,this._map,t))}preclick(t){const s=new MouseEvent("preclick",t);this._map.fire(new eo(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new eo(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new eo(t.type,this._map,t))}mouseover(t){this._map.fire(new eo(t.type,this._map,t))}mouseout(t){this._map.fire(new eo(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wh(t.type,this._map,t))}touchmove(t){this._map.fire(new wh(t.type,this._map,t))}touchend(t){this._map.fire(new wh(t.type,this._map,t))}touchcancel(t){this._map.fire(new wh(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class am{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new eo(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new eo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new eo(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class co{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ge(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const u=s,m=this._startPos,g=this._lastPos;if(!m||!g||g.equals(u)||!this._box&&u.dist(m)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=he("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(m.x,u.x),w=Math.max(m.x,u.x),A=Math.min(m.y,u.y),R=Math.max(m.y,u.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${x}px,${A}px)`,this._box.style.width=w-x+"px",this._box.style.height=R-A+"px")}))}mouseupWindow(t,s){if(!this._active)return;const u=this._startPos,m=s;if(u&&t.button===0){if(this.reset(),It(),u.x!==m.x||u.y!==m.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(u,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ge(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new r.z(t,{originalEvent:s}))}}function od(h,t){const s={};for(let u=0;u<h.length;u++)s[h[u].identifier]=t[u];return s}class lm{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=(function(m){const g=new r.P(0,0);for(const x of m)g._add(x);return g.div(m.length)})(s),this.touches=od(u,s)))}touchmove(t,s,u){if(this.aborted||!this.centroid)return;const m=od(u,s);for(const g in this.touches){const x=m[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class ad{constructor(t){this.singleTap=new lm(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,u){this.singleTap.touchstart(t,s,u)}touchmove(t,s,u){this.singleTap.touchmove(t,s,u)}touchend(t,s,u){const m=this.singleTap.touchend(t,s,u);if(m){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Lu{constructor(){this._zoomIn=new ad({numTouches:1,numTaps:2}),this._zoomOut=new ad({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,u){this._zoomIn.touchstart(t,s,u),this._zoomOut.touchstart(t,s,u)}touchmove(t,s,u){this._zoomIn.touchmove(t,s,u),this._zoomOut.touchmove(t,s,u)}touchend(t,s,u){const m=this._zoomIn.touchend(t,s,u),g=this._zoomOut.touchend(t,s,u);return m?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const cm={0:1,2:2},Mf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class ld{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const u=De(t);this._correctButton(t,u)&&(this._lastPoint=s,this._eventButton=u)}mousemoveWindow(t,s){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&(function(m,g){const x=cm[g];return m.buttons===void 0||(m.buttons&x)!==x})(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(u,s)}}mouseupWindow(t){this._lastPoint&&De(t)===this._eventButton&&(this._moved&&It(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Th extends ld{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Rf extends ld{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Mf[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const u=.8*(s.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Of extends ld{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Mf[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const u=-.5*(s.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class um{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,s,u){return this._calculateTransform(t,s,u)}touchmove(t,s,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!r.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,u)}}touchend(t,s,u){this._calculateTransform(t,s,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,u){u.length>0&&(this._active=!0);const m=od(u,s),g=new r.P(0,0),x=new r.P(0,0);let w=0;for(const R in m){const D=m[R],U=this._touches[R];U&&(g._add(D),x._add(D.sub(U)),w++,m[R]=D)}if(this._touches=m,w<this._minTouches||!x.mag())return;const A=x.div(w);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=he("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Sh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,u){return{}}touchstart(t,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,u){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[g,x]=m,w=Eh(u,s,g),A=Eh(u,s,x);if(!w||!A)return;const R=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],R,t)}touchend(t,s,u){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,x=Eh(u,s,m),w=Eh(u,s,g);x&&w||(this._active&&It(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Eh(h,t,s){for(let u=0;u<h.length;u++)if(h[u].identifier===s)return t[u]}function Lf(h,t){return Math.log2(h/t)}class lg extends Sh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Lf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lf(this._distance,u),pinchAround:s}}}function hm(h,t){return 180*h.angleWith(t)/Math.PI}class cg extends Sh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:hm(this._vector,u),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const m=hm(t,u);return Math.abs(m)<s}}function Df(h){return Math.abs(h.y)>Math.abs(h.x)}class ug extends Sh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Df(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,u){const m=this._lastPoints;if(!m)return;const g=t[0].sub(m[0]),x=t[1].sub(m[1]);return this._map._cooperativeGestures&&!r.eL()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(g,x,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5})}gestureBeginsVertically(t,s,u){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,g=s.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Df(t)&&Df(s)&&x}}const hg={panStep:100,bearingStep:15,pitchStep:10};class dg{constructor(){const t=hg;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,u=0,m=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,m=0),{cameraAnimation:w=>{const A=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:fg,zoom:s?Math.round(A)+s*(t.shiftKey?2:1):A,bearing:w.getBearing()+u*this._bearingStep,pitch:w.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:w.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fg(h){return h*(2-h)}const dm=4.000244140625,pg=1/450;class mg{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=pg,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=r.o.now(),m=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%dm==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ot(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>dm?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&D!==0&&(D=1/D);const U=s(),F=Math.pow(2,U),V=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(V*D))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,g=this._easing;let x,w=!1;if(this._type==="wheel"&&m&&g){const R=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),D=g(R);x=r.ak(m,u,D),R<1?this._frameId||(this._frameId=!0):w=!0}else x=u,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let A=x-s();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=r.eM;if(this._prevEase){const u=this._prevEase,m=(r.o.now()-u.start)/u.duration,g=u.easing(m+.01)-u.easing(m),x=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-x*x);s=r.eK(x,w,.25,1)}return this._prevEase={start:r.o.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=he("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class _g{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class gg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zv{constructor(){this._tap=new ad({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=s[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,s,u))}touchmove(t,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const m=s[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,u)}touchend(t,s,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,s,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wv{constructor(t,s,u){this._el=t,this._mousePan=s,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xv{constructor(t,s,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cs{constructor(t,s,u,m){this._el=t,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const cd=h=>h.zoom||h.drag||h.pitch||h.rotate;class Kv extends r.z{}class Yv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const u=r.av([],s,t);this.radius=r.ag(u[2]<0?r.eO([],u,this.constants):[u[0],u[1],0])}projectRay(t){r.eO(t,t,this.constants),r.aw(t,t),r.eP(t,t,this.constants);const s=r.c4([],t,this.radius);if(s[2]>0){const u=r.c4([],[0,0,1],r.bJ(s,[0,0,1])),m=r.c4([],r.aw([],[s[0],s[1],0]),this.radius),g=r.d7([],s,r.c4([],r.av([],r.d7([],m,u),s),2));s[0]=g[0],s[1]=g[1]}return s}}function zf(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class ud{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sm(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Yv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),r.aY(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,g,x]of this._listeners){const w=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(g,w,x)}}destroy(){for(const[t,s,u]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,m,u)}}_addDefaultHandlers(t){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new om(s,t));const m=s.boxZoom=new co(s,t);this._add("boxZoom",m);const g=new Lu,x=new gg;s.doubleClickZoom=new _g(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const w=new Zv;this._add("tapDragZoom",w);const A=s.touchPitch=new ug(s);this._add("touchPitch",A);const R=new Rf(t),D=new Of(t);s.dragRotate=new Xv(t,R,D),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const U=new Th(t),F=new um(s,t);s.dragPan=new Wv(u,U,F),this._add("mousePan",U),this._add("touchPan",F,["touchZoom","touchRotate"]);const V=new cg,G=new lg;s.touchZoomRotate=new cs(u,G,V,w),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new am(s));const Z=s.scrollZoom=new mg(s,this);this._add("scrollZoom",Z,["mousePan"]);const ie=s.keyboard=new dg;this._add("keyboard",ie);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[J]&&s[J].enable(t[J])}_add(t,s,u){this._handlers.push({handlerName:t,handler:s,allowed:u}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!cd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,u){for(const m in t)if(m!==u&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const u of t)this._el.contains(u.target)&&s.push(u);return s}handleEvent(t,s){this._updatingCamera=!0;const u=t.type==="renderFrame",m=u?void 0:t,g={needsRenderFrame:!1},x={},w={},A=t.touches?this._getMapTouches(t.touches):void 0,R=A?Be(this._el,A):u?void 0:ot(this._el,t);for(const{handlerName:F,handler:V,allowed:G}of this._handlers){if(!V.isEnabled())continue;let Z;this._blockedByActive(w,G,F)?V.reset():V[s||t.type]&&(Z=V[s||t.type](t,R,A),this.mergeHandlerResult(g,x,Z,F,m),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||V.isActive())&&(w[F]=V)}const D={};for(const F in this._previousActiveHandlers)w[F]||(D[F]=m);this._previousActiveHandlers=w,(Object.keys(D).length||zf(g))&&(this._changes.push([g,x,D]),this._triggerRenderFrame()),(Object.keys(w).length||zf(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=g;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,s,u,m,g){if(!u)return;Object.assign(t,u);const x={handlerName:m,originalEvent:u.originalEvent||g};u.zoomDelta!==void 0&&(s.zoom=x),u.panDelta!==void 0&&(s.drag=x),u.pitchDelta!==void 0&&(s.pitch=x),u.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},u={};for(const[m,g,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),Object.assign(s,g),Object.assign(u,x);this._updateMapTransform(t,s,u),this._changes=[]}_updateMapTransform(t,s,u){const m=this._map,g=m.transform,x=ae=>[ae.x,ae.y,ae.z];if((ae=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!zf(t)){const ae=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),ae!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&m._stop(!0),!zf(t))return void this._fireEvents(s,u,!0);let{panDelta:w,zoomDelta:A,bearingDelta:R,pitchDelta:D,around:U,aroundCoord:F,pinchAround:V}=t;g._isCameraConstrained&&(A>0&&(A=0),g._isCameraConstrained=!1),V!==void 0&&(U=V),(A||(ae=>s[ae]&&!this._eventsInProgress[ae])("drag"))&&U&&(this._dragOrigin=x(g.pointCoordinate3D(U)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),U=U||m.transform.centerPoint,R&&(g.bearing+=R),D&&(g.pitch+=D),g._updateCameraState();const G=[0,0,0];if(w)if(g.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(U).dir),me=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(U.sub(w)).dir);G[0]=me[0]-ae[0],G[1]=me[1]-ae[1]}else{const ae=g.pointCoordinate(U);if(g.projection.name==="globe"){w=w.rotate(-g.angle);const me=g._pixelsPerMercatorPixel/g.worldSize;G[0]=-w.x*r.eN(r.a$(ae.y))*me,G[1]=-w.y*r.eN(g.center.lat)*me}else{const me=g.pointCoordinate(U.sub(w));ae&&me&&(G[0]=me.x-ae.x,G[1]=me.y-ae.y)}}const Z=g.zoom,ie=[0,0,0];if(A){const ae=x(F||g.pointCoordinate3D(U)),me={dir:r.aw([],r.av([],ae,g._camera.position))};if(me.dir[2]<0){const ye=g.zoomDeltaToMovement(ae,A);r.c4(ie,me.dir,ye)}}const J=r.d7(G,G,ie);g._translateCameraConstrained(J),A&&Math.abs(g.zoom-Z)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,u,!0)}_fireEvents(t,s,u){const m=cd(this._eventsInProgress),g=cd(t),x={};for(const D in t){const{originalEvent:U}=t[D];this._eventsInProgress[D]||(x[`${D}start`]=U),this._eventsInProgress[D]=t[D]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const D in x)this._fireEvent(D,x[D]);g&&this._fireEvent("move",g.originalEvent);for(const D in t){const{originalEvent:U}=t[D];this._fireEvent(D,U)}const w={};let A;for(const D in this._eventsInProgress){const{handlerName:U,originalEvent:F}=this._eventsInProgress[D];this._handlersById[U].isActive()||(delete this._eventsInProgress[D],A=s[U]||F,w[`${D}end`]=A)}for(const D in w)this._fireEvent(D,w[D]);const R=cd(this._eventsInProgress);if(u&&(m||g)&&!R){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;D?(U(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:A})):(this._map.fire(new r.z("moveend",{originalEvent:A})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new r.z(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Kv("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const fm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class pm extends r.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,u){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},s),u)}panTo(t,s,u){return this.easeTo(Object.assign({center:t},s),u)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,u){return this.easeTo(Object.assign({zoom:t},s),u)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,u){return this.easeTo(Object.assign({bearing:t},s),u)}resetNorth(t,s){return this.rotateTo(0,Object.assign({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=r.aI.convert(t);const u=s&&s.bearing||0,m=s&&s.pitch||0,g=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,g,x,u,m,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},s,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const u=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return u/m>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,u,m,g,x){const w=t.clone(),A=this._extendCameraOptions(x);w.bearing=m,w.pitch=g;const R=r.aR.convert(s),D=r.aR.convert(u),U=.5*(R.lat+D.lat),F=.5*(R.lng+D.lng),V=r.eQ(U,F),G=r.aw([],V),Z=r.aw([],r.bI([],G,[0,1,0])),ie=r.bI([],Z,G),J=[Z[0],Z[1],Z[2],0,ie[0],ie[1],ie[2],0,G[0],G[1],G[2],0,0,0,0,1],ae=[V,r.eQ(R.lat,R.lng),r.eQ(D.lat,R.lng),r.eQ(D.lat,D.lng),r.eQ(R.lat,D.lng),r.eQ(U,R.lng),r.eQ(U,D.lng),r.eQ(R.lat,F),r.eQ(D.lat,F)];let me=r.d8.fromPoints(ae.map((ct=>[r.bJ(Z,ct),r.bJ(ie,ct),r.bJ(G,ct)])));const ye=r.af([],me.center,J);r.eR(ye)===0&&r.eS(ye,0,0,1),r.aw(ye,ye),r.c4(ye,ye,r.aD),w.center=r.eT(ye);const Pe=w.getWorldToCameraMatrix(),Ae=r.bl(new Float64Array(16),Pe);me=r.d8.applyTransform(me,r.aB([],Pe,J));const Me=this._extendAABB(me,w,A,m);if(!Me)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Me,r.af(ye,ye,Pe);const Ie=.5*(me.max[2]-me.min[2]),Ee=this._minimumAABBFrustumDistance(w,me),Re=r.c4([],[0,0,1],Ie),nt=r.d7(Re,ye,Re),We=Ee+(w.pitch===0?0:r.bG(ye,nt)),gt=w.globeCenterInViewSpace,et=r.av([],ye,[gt[0],gt[1],gt[2]]);r.aw(et,et),r.c4(et,et,We);const pt=r.d7([],ye,et);r.af(pt,pt,Ae);const Kt=r.eD/r.aD,it=r.ag(pt),Ve=r.ce(Math.max(it*Kt-r.eD,Number.EPSILON),0),bt=Math.min(w.zoomFromMercatorZAdjusted(Ve),A.maxZoom);return bt>.5*(r.cZ+r.cK)?(w.setProjection({name:"mercator"}),w.zoom=bt,this._cameraForBounds(w,s,u,m,g,x)):{center:w.center,zoom:bt,bearing:m,pitch:g}}_extendAABB(t,s,u,m){const g=.5*((u.padding.left||0)+(u.padding.right||0)),x=.5*((u.padding.top||0)+(u.padding.bottom||0)),w=x,A=g,R=g,D=x,U=s.width-(A+R),F=s.height-(w+D),V=r.av([],t.max,t.min),G=Math.min(U/V[0],F/V[1]),Z=Math.min(s.scaleZoom(s.scale*G),u.maxZoom);if(isNaN(Z))return null;const ie=s.scale/s.zoomScale(Z),J=new r.d8([t.min[0]-A*ie,t.min[1]-D*ie,t.min[2]],[t.max[0]+R*ie,t.max[1]+w*ie,t.max[2]]),ae=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new r.P(u.offset.x,u.offset.y):r.P.convert(u.offset)).rotate(-r.an(m));return J.center[0]-=ae.x*ie,J.center[1]+=ae.y*ie,J}queryTerrainElevation(t,s){const u=this.transform.elevation;return u?(s=Object.assign({},{exaggerated:!0},s),u.getAtPoint(r.ae.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,u,m,g,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,u,m,g,x);const w=t.clone(),A=this._extendCameraOptions(x);w.bearing=m,w.pitch=g;const R=r.aR.convert(s),D=r.aR.convert(u),U=new r.aR(R.lng,D.lat),F=new r.aR(D.lng,R.lat),V=w.project(R),G=w.project(D),Z=this.queryTerrainElevation(R),ie=this.queryTerrainElevation(D),J=this.queryTerrainElevation(U),ae=this.queryTerrainElevation(F),me=[[V.x,V.y,Math.min(Z||0,ie||0,J||0,ae||0)],[G.x,G.y,Math.max(Z||0,ie||0,J||0,ae||0)]];let ye=r.d8.fromPoints(me);const Pe=w.getWorldToCameraMatrix(),Ae=r.bl(new Float64Array(16),Pe);ye=r.d8.applyTransform(ye,Pe);const Me=this._extendAABB(ye,w,A,m);if(!Me)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Me;const Ie=.5*r.av([],ye.max,ye.min)[2],Ee=this._minimumAABBFrustumDistance(w,ye),Re=[0,0,1,0];r.aC(Re,Re,Pe),r.eU(Re,Re);const nt=r.c4([],Re,Ee+Ie),We=r.d7([],ye.center,nt);r.af(ye.center,ye.center,Ae),r.af(We,We,Ae);const gt=w.unproject(new r.P(ye.center[0],ye.center[1])),et=r.eV(w.projection,gt),pt=Math.pow(2,et),Kt=Math.min(w._zoomFromMercatorZ(We[2]*w.pixelsPerMeter*pt/w.worldSize),A.maxZoom);return w.mercatorFromTransition&&Kt<.5*(r.cZ+r.cK)?(w.setProjection({name:"globe"}),w.zoom=Kt,this._cameraForBounds(w,s,u,m,g,x)):{center:gt,zoom:Kt,bearing:m,pitch:g}}fitBounds(t,s,u){const m=this.cameraForBounds(t,s);return this._fitInternal(m,s,u)}fitScreenCoordinates(t,s,u,m,g){const x=r.P.convert(t),w=r.P.convert(s),A=new r.P(Math.min(x.x,w.x),Math.min(x.y,w.y)),R=new r.P(Math.max(x.x,w.x),Math.max(x.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,w))return this;const D=this.transform.pointLocation3D(A),U=this.transform.pointLocation3D(R),F=this.transform.pointLocation3D(new r.P(A.x,R.y)),V=this.transform.pointLocation3D(new r.P(R.x,A.y)),G=[Math.min(D.lng,U.lng,F.lng,V.lng),Math.min(D.lat,U.lat,F.lat,V.lat)],Z=[Math.max(D.lng,U.lng,F.lng,V.lng),Math.max(D.lat,U.lat,F.lat,V.lat)],ie=m&&m.pitch?m.pitch:this.getPitch(),J=this._cameraForBounds(this.transform,G,Z,u,ie,m);return this._fitInternal(J,m,g)}_fitInternal(t,s,u){return t?(s=Object.assign(t,s)).linear?this.easeTo(s,u):this.flyTo(s,u):this}jumpTo(t,s){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let m=!1,g=!1,x=!1;"zoom"in t&&u.zoom!==+t.zoom&&(m=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=r.aR.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(g=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(x=!0,u.pitch=+t.pitch);const w=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(w))if(t.retainPadding===!1){const A=u.clone();A.padding=w,u.setLocationAtPoint(u.center,A.centerPoint)}else u.padding=w;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new r.z("movestart",s)).fire(new r.z("move",s)),m&&this.fire(new r.z("zoomstart",s)).fire(new r.z("zoom",s)).fire(new r.z("zoomend",s)),g&&this.fire(new r.z("rotatestart",s)).fire(new r.z("rotate",s)).fire(new r.z("rotateend",s)),x&&this.fire(new r.z("pitchstart",s)).fire(new r.z("pitch",s)).fire(new r.z("pitchend",s)),this.fire(new r.z("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(fm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const u=this.transform;if(!u.projection.supportsFreeCamera)return r.w(fm),this;this.stop();const m=u.zoom,g=u.pitch,x=u.bearing;u.setFreeCameraOptions(t);const w=m!==u.zoom,A=g!==u.pitch,R=x!==u.bearing;return this.fire(new r.z("movestart",s)).fire(new r.z("move",s)),w&&this.fire(new r.z("zoomstart",s)).fire(new r.z("zoom",s)).fire(new r.z("zoomend",s)),R&&this.fire(new r.z("rotatestart",s)).fire(new r.z("rotate",s)).fire(new r.z("rotateend",s)),A&&this.fire(new r.z("pitchstart",s)).fire(new r.z("pitch",s)).fire(new r.z("pitchend",s)),this.fire(new r.z("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:r.eM},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),A="zoom"in t?+t.zoom:m,R="bearing"in t?this._normalizeBearing(t.bearing,g):g,D="pitch"in t?+t.pitch:x,U=this._extendPadding(t.padding),F=r.P.convert(t.offset);let V,G,Z;if(u.projection.name==="globe"){const Re=r.ae.fromLngLat(u.center),nt=F.rotate(-u.angle);Re.x+=nt.x/u.worldSize,Re.y+=nt.y/u.worldSize;const We=Re.toLngLat(),gt=r.aR.convert(t.center||We);this._normalizeCenter(gt),V=u.centerPoint.add(nt),G=new r.P(Re.x,Re.y).mult(u.worldSize),Z=new r.P(r.aF(gt.lng),r.aJ(gt.lat)).mult(u.worldSize).sub(G)}else{V=u.centerPoint.add(F);const Re=u.pointLocation(V),nt=r.aR.convert(t.center||Re);this._normalizeCenter(nt),G=u.project(Re),Z=u.project(nt).sub(G)}const ie=u.zoomScale(A-m);let J,ae;t.around&&(J=r.aR.convert(t.around),ae=u.locationPoint(J));const me=this._zooming||A!==m,ye=this._rotating||g!==R,Pe=this._pitching||D!==x,Ae=!u.isPaddingEqual(U),Me=t.retainPadding===!1?u.clone():u,Ie=Re=>nt=>{if(me&&(Re.zoom=r.ak(m,A,nt)),ye&&(Re.bearing=r.ak(g,R,nt)),Pe&&(Re.pitch=r.ak(x,D,nt)),Ae&&(Me.interpolatePadding(w,U,nt),V=Me.centerPoint.add(F)),J)Re.setLocationAtPoint(J,ae);else{const We=Re.zoomScale(Re.zoom-m),gt=A>m?Math.min(2,ie):Math.max(.5,ie),et=Math.pow(gt,1-nt),pt=Re.unproject(G.add(Z.mult(nt*et)).mult(We));Re.setLocationAtPoint(Re.renderWorldCopies?pt.wrap():pt,V)}return t.preloadOnly||this._fireMoveEvents(s),Re};if(t.preloadOnly){const Re=this._emulate(Ie,t.duration,u);return this._preloadTiles(Re),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=ye,this._pitching=Pe,this._padding=Ae,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Ee),this._ease(Ie(u),(Re=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(s,Re)}),t),this}_prepareEase(t,s,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||u.moving||this.fire(new r.z("movestart",t)),this._zooming&&!u.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new r.z("zoomend",t)),m&&this.fire(new r.z("rotateend",t)),g&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const ct=r.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(ct,s)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eM},t);const u=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),w=this.getPadding(),A="zoom"in t?r.aA(+t.zoom,u.minZoom,u.maxZoom):m,R="bearing"in t?this._normalizeBearing(t.bearing,g):g,D="pitch"in t?+t.pitch:x,U=this._extendPadding(t.padding),F=u.zoomScale(A-m),V=r.P.convert(t.offset);let G=u.centerPoint.add(V);const Z=u.pointLocation(G),ie=r.aR.convert(t.center||Z);this._normalizeCenter(ie);const J=u.project(Z),ae=u.project(ie).sub(J);let me=t.curve;const ye=Math.max(u.width,u.height),Pe=ye/F,Ae=ae.mag();if("minZoom"in t){const ct=r.aA(Math.min(t.minZoom,m,A),u.minZoom,u.maxZoom),zt=ye/u.zoomScale(ct-m);me=Math.sqrt(zt/Ae*2)}const Me=me*me;function Ie(ct){const zt=(Pe*Pe-ye*ye+(ct?-1:1)*Me*Me*Ae*Ae)/(2*(ct?Pe:ye)*Me*Ae);return Math.log(Math.sqrt(zt*zt+1)-zt)}function Ee(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function Re(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const nt=Ie(0);let We=function(ct){return Re(nt)/Re(nt+me*ct)},gt=function(ct){return ye*((Re(nt)*(Ee(zt=nt+me*ct)/Re(zt))-Ee(nt))/Me)/Ae;var zt},et=(Ie(1)-nt)/me;if(Math.abs(Ae)<1e-6||!isFinite(et)){if(Math.abs(ye-Pe)<1e-6)return this.easeTo(t,s);const ct=Pe<ye?-1:1;et=Math.abs(Math.log(Pe/ye))/me,gt=function(){return 0},We=function(zt){return Math.exp(ct*me*zt)}}t.duration="duration"in t?+t.duration:1e3*et/("screenSpeed"in t?+t.screenSpeed/me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const pt=g!==R,Kt=D!==x,it=!u.isPaddingEqual(U),Ve=t.retainPadding===!1?u.clone():u,bt=ct=>zt=>{const Xt=zt*et,hi=1/We(Xt);ct.zoom=zt===1?A:m+ct.scaleZoom(hi),pt&&(ct.bearing=r.ak(g,R,zt)),Kt&&(ct.pitch=r.ak(x,D,zt)),it&&(Ve.interpolatePadding(w,U,zt),G=Ve.centerPoint.add(V));const qt=zt===1?ie:ct.unproject(J.add(ae.mult(gt(Xt))).mult(hi));return ct.setLocationAtPoint(ct.renderWorldCopies?qt.wrap():qt,G),ct._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),ct};if(t.preloadOnly){const ct=this._emulate(bt,t.duration,u);return this._preloadTiles(ct),this}return this._zooming=!0,this._rotating=pt,this._pitching=Kt,this._padding=it,this._prepareEase(s,!1),this._ease(bt(u),(()=>this._afterEase(s)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,s)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,s,u){u.animate===!1||u.duration===0?(t(1),s()):(this._easeStart=r.o.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=r.bT(t,-180,180);const u=Math.abs(t-s);return Math.abs(t-360-s)<u&&(t-=360),Math.abs(t+360-s)<u&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const u=t.lng-s.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,u){const m=Math.ceil(15*s/1e3),g=[],x=t(u.clone());for(let w=0;w<=m;w++){const A=x(w/m);g.push(A.clone())}return g}_preloadTiles(t,s){}}class hd{constructor(t={}){this.options=t,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=he("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const m=he("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",u),this._innerContainer=he("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const u=s.reduce(((m,g,x)=>(g.value&&(m+=`${g.key}=${g.value}${x<s.length-1?"&":""}`),m)),"?");t.href=`${r.e.FEEDBACK_URL}/${u}#${If(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._mergedSourceCaches;for(const m in s){const g=s[m];if(g.used){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort(((m,g)=>m.length-g.length)),t=t.filter(((m,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fl{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=he("div","mapboxgl-ctrl");const s=he("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const u=t[s].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class dd{constructor(){r.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(s=>this._onIndoorUpdate({selectedFloorId:s.selectedFloorId,floors:s.floors}))),this._container}_createButton(t,s){const u=he("button",t,this._container);return u.type="button",u.addEventListener("click",s),u}_createSeparator(){return he("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,s){this._map&&(t.setAttribute("aria-label",s),t.textContent=s)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return void(this._container.style.display="none");const s=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const u=t.floors.sort(((m,g)=>g.levelOrder-m.levelOrder));s?(Array.from(this._container.children).forEach((m=>m.remove())),this.addCurrentFloors(u)):this.addCurrentFloors(u)}addCurrentFloors(t){for(let s=0;s<t.length;s++){const u=t[s],m=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(u.id),this._model&&(this._model.selectedFloorId=u.id),Array.from(this._container.children).forEach((g=>{g.classList.contains("mapboxgl-ctrl-level-button")&&g.classList.remove("mapboxgl-ctrl-level-button-selected")})),m.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(m,u.shortName),this._model&&u.id===this._model.selectedFloorId&&m.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(m),s<t.length-1&&this._createSeparator()}}}class Ns{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const m of u)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Bl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=r.dz((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,u){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+u}}const fd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class pd extends r.z{constructor(t,s,u,m){const{point:g,lngLat:x,originalEvent:w,target:A}=t;super(t.type,{point:g,lngLat:x,originalEvent:w,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=u,this.feature=m}}class yg{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=s.filter;let m=s.type;u&&this.filters.set(t,r.b6(u)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const g=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):g.size===0&&this.map.on(m,this.handleType),g.size===0&&this.interactionsByType.set(m,g),g.set(t,s),this.typeById.set(t,m)}get(t){const s=this.typeById.get(t);if(!s)return;const u=this.interactionsByType.get(s);return u?u.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(s);u&&(u.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const u=[];for(const[m,g]of s)g.target&&u.push({targetId:m,target:g.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const u=new Map;for(const[m,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||u.set(g.id,g);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map((({feature:u})=>u));s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const u=t.type==="mouseenter";if(u&&!this.interactionsByType.has(t.type))return void r.w("mouseenter interaction required for mouseleave to work.");const m=Array.from(this.interactionsByType.get(t.type)).reverse(),g=!!s;s=s||this.queryTargets(t.point,m);let x=!1;const w=new Set;for(const A of s){for(const[R,D]of m){if(!D.target)continue;const U=A.variants?A.variants[R]:null;if(U){for(const F of U){if(po(F,A,w,R))continue;const V=new r.dt(A,F),G=Br(F,A,R);g&&(V.state=this.map.getFeatureState(V));const Z=u?this.prevHoveredFeatures.get(G):null,ie=new pd(t,R,D,V),J=Z?Z.stop:D.handler(ie);if(u&&this.hoveredFeatures.set(G,{feature:A,stop:J}),J!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[A,R]of m){const{handler:D,target:U}=R;if(!U&&D(new pd(t,A,R,null))!==!1)break}}}function Jv(h,t){if(Array.isArray(h)&&Array.isArray(t)){const s=new Set(h),u=new Set(t);return s.size===u.size&&h.every((m=>u.has(m)))}return r.by(h,t)}const md={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Qv={showCompass:!0,showZoom:!0,visualizePitch:!1};class ex{constructor(t,s,u=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Rf({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Of({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),ge()}move(t,s){const u=this.map,m=this.mouseRotate.mousemoveWindow(t,s),g=m&&m.bearingDelta;if(g&&u.setBearing(u.getBearing()+g),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,s),w=x&&x.pitchDelta;w&&u.setPitch(u.getPitch()+w)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ge(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ot(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ot(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Be(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Be(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function kf(h,t,s){if(h=new r.aR(h.lng,h.lat),t){const u=new r.aR(h.lng-360,h.lat),m=new r.aR(h.lng+360,h.lat),g=360*Math.ceil(Math.abs(h.lng-s.center.lng)/360),x=s.locationPoint3D(h).distSqr(t),w=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(u).distSqr(t)<x&&(w||Math.abs(u.lng-s.center.lng)<g)?h=u:s.locationPoint3D(m).distSqr(t)<x&&(w||Math.abs(m.lng-s.center.lng)<g)&&(h=m)}for(;Math.abs(h.lng-s.center.lng)>180;){const u=s.locationPoint3D(h);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const _d={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ga={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Du extends r.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=Object.assign({element:t},s)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:m="#3FB1CE",scale:g=1,draggable:x=!1,clickTolerance:w=0,rotation:A=Ga.rotation,rotationAlignment:R=Ga.rotationAlignment,pitchAlignment:D=Ga.pitchAlignment,occludedOpacity:U=Ga.occludedOpacity,altitude:F=Ga.altitude}=t||{};this._anchor=u,this._color=m,this._scale=g,this._draggable=x,this._clickTolerance=w,this._rotation=A,this._rotationAlignment=R,this._pitchAlignment=D,this._occludedOpacity=U,this._altitude=F,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(Z=>{Z.preventDefault()})),this._element.addEventListener("mousedown",(Z=>{Z.preventDefault()}));const V=this._element.classList;for(const Z in _d)V.remove(`mapboxgl-marker-anchor-${Z}`);V.add(`mapboxgl-marker-anchor-${this._anchor}`);const G=t&&t.className?t.className.trim().split(/\s+/):[];V.add(...G),this._popup=null}_createDefaultMarker(){const t=he("div"),s=Te("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=Te("radialGradient",{id:"shadowGradient"},Te("defs",{},s));Te("stop",{offset:"10%","stop-opacity":.4},u),Te("stop",{offset:"100%","stop-opacity":.05},u),Te("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return Te("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),Te("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),Te("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.aR.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ga.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,u=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,u=this._element;this._popup&&(s===u||u.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const u=t.unproject(s,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const g=m.position.toLngLat();return g.distanceTo(u)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(s,this._altitude);let m;t._showingGlobe()&&r.eY(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${_d[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,u=this.getPitchAlignment();if(!s||!t||u!=="map")return"";if(!s._showingGlobe()){const A=s.getPitch();return A?`rotateX(${A}deg)`:""}const m=r.cW(r.eZ(s.transform,this._lngLat)),g=t.sub(r.e_(s.transform)),x=Math.abs(g.x)+Math.abs(g.y);if(x===0)return"";const w=m/x;return`rotateX(${-g.y*w}deg) rotateY(${g.x*w}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let u=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const g=s.project(new r.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=s.project(new r.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);u=r.cW(Math.atan2(x.y,x.x))-90}else u=-s.getBearing();else if(m==="horizon"){const g=r.ah(4,6,s.getZoom()),x=r.e_(s.transform);x.y+=g*s.transform.height;const w=t.sub(x),A=r.cW(Math.atan2(w.y,w.x));u=(A>90?A-270:A+90)*(1-g)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=kf(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),s._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const u=this._pointerdownPos,m=this._positionDelta;if(u&&m){if(!this._isDragging){const g=this._clickTolerance||s._clickTolerance;if(t.point.dist(u)<g)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,u=this._pos;s&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ga.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ga.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ga.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ga.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ac={maxWidth:100,unit:"metric"},lc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},zu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},yl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vg(h=new r.P(0,0),t="bottom"){if(typeof h=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new r.P(0,h);case"top-left":return new r.P(s,s);case"top-right":return new r.P(-s,s);case"bottom":return new r.P(0,-h);case"bottom-left":return new r.P(s,-s);case"bottom-right":return new r.P(-s,-s);case"left":return new r.P(h,0);case"right":return new r.P(-h,0)}return new r.P(0,0)}return h instanceof r.P||Array.isArray(h)?r.P.convert(h):r.P.convert(h[t]||[0,0])}return{version:j,supported:se.supported,setRTLTextPlugin:r.f2,getRTLTextPluginStatus:r.f1,Map:class extends pm{constructor(h){W.mark(H.create);const t=h;if((h=Object.assign({},md,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&r.eW(window)&&(h.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new qs(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Ns,this._domRenderTaskQueue=new Ns,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b2(),this._locale=Object.assign({},fd,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new tt(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const s=document.getElementById(h.container);if(!s)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=s}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new yh),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ud(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||r.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this.indoor=new nl(this),h.hash&&(this._hash=new nm(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const s=h.bounds;s&&(this.resize(),this.fitBounds(s,Object.assign({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new hd({customAttribution:h.customAttribution})),this._logoControl=new Fl,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(s=>{this._update(s.dataType==="style"),this.fire(new r.z(`${s.dataType}data`,s))})),this.on("dataloading",(s=>{this.fire(new r.z(`${s.dataType}dataloading`,s))})),this._interactions=new yg(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",h)).fire(new r.z("move",h)),this.fire(new r.z("resize",h)),t&&this.fire(new r.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(r.aI.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map((t=>t==="auto"?navigator.language:t)):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let s;t==="globe"&&h.zoom>=r.cK?(h.setMercatorFromTransition(),s=!0):t==="mercator"&&h.zoom<r.cK&&(h.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;return t=h.name==="globe"&&this.transform.zoom>=r.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(r.aR.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(r.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,s){const u=m=>{let g=[];if(Array.isArray(t)){const x=t.filter((w=>this.getLayer(w)));g=x.length?this.queryRenderedFeatures(m,{layers:x}):[]}else g=this.queryRenderedFeatures(m,{target:t});return g};if(h==="mouseenter"||h==="mouseover"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:x=>{const w=u(x.point);w.length?m||(m=!0,s.call(this,new eo(h,this,x.originalEvent,{features:w}))):m=!1},mouseout:()=>{m=!1}}}}if(h==="mouseleave"||h==="mouseout"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:w=>{u(w.point).length?m=!0:m&&(m=!1,s.call(this,new eo(h,this,w.originalEvent)))},mouseout:w=>{m&&(m=!1,s.call(this,new eo(h,this,w.originalEvent)))}}}}{const m=g=>{const x=u(g.point);x.length&&(g.features=x,s.call(this,g),delete g.features)};return{listener:s,targets:t,delegates:{[h]:m}}}}on(h,t,s){if(typeof t=="function"||s===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(h,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(u);for(const m in u.delegates)this.on(m,u.delegates[m]);return this}once(h,t,s){if(typeof t=="function"||s===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(h,t,s);for(const m in u.delegates)this.once(m,u.delegates[m]);return this}off(h,t,s){if(typeof t=="function"||s===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[h]:void 0;return u&&(m=>{for(let g=0;g<m.length;g++){const x=m[g];if(x.listener===s&&Jv(x.targets,t)){for(const w in x.delegates)this.off(w,x.delegates[w]);return m.splice(g,1),this}}})(u),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof r.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(h,void 0,this.transform),x=this.style.queryRenderedFeatureset(h,void 0,this.transform);return g.concat(x)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let m=[];return u&&(m=m.concat(this.style.queryRenderedFeatures(h,t,this.transform))),s&&(m=m.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),m}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}queryRasterValue(h,t,s){return this._isValidId(h)?this.style.queryRasterValue(h,t,s):Promise.resolve(null)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,((s,u)=>{if(s){const m=typeof s=="string"?s:s instanceof Error?s.message:s.error;r.w(`Unable to perform style diff: ${m}. Rebuilding the style from scratch.`),this._updateStyle(h,t)}else u&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const s=Object.assign({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new Oa(this,s).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Oa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dm(h)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,s)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:s=1,sdf:u=!1,stretchX:m,stretchY:g,content:x}={}){this._lazyInitEmptyStyle();const w=r.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:A,height:R,data:D}=r.o.getImageData(t);this.style.addImage(w,{data:new r.q({width:A,height:R},D),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:R}=t,D=t;this.style.addImage(w,{data:new r.q({width:A,height:R},new Uint8Array(D.data)),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:u,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const s=r.I.from(h),u=this.style.getImage(s);if(!u)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.o.getImageData(t):t,{width:g,height:x,data:w}=m;if(g===void 0||x===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||x!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${g}, ${x})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const A=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let R=!1;u.usvg?(u.data=new r.q({width:g,height:x},new Uint8Array(w)),u.usvg=!1,u.icon=void 0,R=!0):u.data.replace(w,A),this.style.updateImage(s,u,R)}hasImage(h){return h?!!this.style&&!!this.style.getImage(r.I.from(h)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(r.I.from(h))}loadImage(h,t){r.n(this._requestManager.transformRequest(h,r.R.Image),((s,u)=>{t(s,u instanceof HTMLImageElement?r.o.getImageData(u):u)}))}listImages(){return this.style.listImages().map((h=>h.name))}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t).catch((s=>this.fire(new r.y(new Error("Failed to add import",s))))),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,s){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,s),this._update(!0)):this}setFilter(h,t,s={}){return this._isValidId(h)?(this.style.setFilter(h,t,s),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,s,u={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,s,u),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,s,u={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,s,u),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,s){return this.style.setConfigProperty(h,t,s),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aR.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_selectIndoorFloor(h){this.indoor.selectFloor(h)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new dd),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,u,m,g=this._container;for(;g&&(!u||!m);){const x=window.getComputedStyle(g).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(u=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),g=g.parentElement}this._containerWidth=u?Math.abs(h/u):h,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=he("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=he("div","mapboxgl-canvas-container",h);this._canvas=he("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=he("div","mapboxgl-control-container",h),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((m=>{u[m]=he("div",`mapboxgl-ctrl-${m}`,s)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const s=r.o.devicePixelRatio||1;this._canvas.width=s*Math.ceil(h),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=Object.assign({},se.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(Qi(t,!0),this.painter=new im(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),r.k.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new r.z("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,u=r.o.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,D=this.transform.pitch,U=r.o.now(),F=new r.ac(R,{now:U,fadeDuration:g,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(u);const w=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),w&&(this._placementDirty=w.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,W.mark(H.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const R=r.o.now()-u;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout((()=>{const D=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:R,gpuTime:D}))}),50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout((()=>{const D=this.painter.queryGpuTimers(R);this.fire(new r.z("gpu-timing-layer",{layerTimes:D}))}),50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const D=this.painter.queryGpuTimeDeferredRender(R);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:D}))}),50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(A||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(x=this._updateAverageElevation(u,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,W.mark(H.fullLoad),this._performanceMetricsCollection&&Ui(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const m=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=h;const x=Math.abs(m-g);if(x>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(g),s(g);this._averageElevation.easeTo(g,h,300)}else if(x>1e-4)return this._averageElevation.jumpTo(g),s(g)}return!!this._averageElevation.isEasing(h)&&s(this._averageElevation.getValue(h))}_authenticate(){_i(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(h=>{if(h&&(h.message===ft||h.status===401)){const t=this.painter.context.gl;Qi(t,!1),this._logoControl instanceof Fl&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),an(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Pt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,u=s.createFramebuffer();function m(g){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,g,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,u),this._canvasPixelComparison(m(h),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(h,t,s){let u=s[1]-s[0];const m=h.length/4;for(let g=0;g<t.length;g++){const x=t[g];let w=0;for(let A=0;A<x.length;A+=4)x[A]===h[A]&&x[A+1]===h[A+1]&&x[A+2]===h[A+2]&&x[A+3]===h[A+3]&&(w+=1);u+=(s[g+2]-s[g+1])*(1-w/m)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),un.delete(this.painter.context.gl),ei.remove(),dn.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=r.o.frame((t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)})))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return r.bw(t,((s,u)=>s._preloadTiles(h,u)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this._tp.refreshUI(),h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,this._tp.refreshUI(),h&&this._update())}_setCacheLimits(h,t){r.eX(h,t)}get version(){return j}},NavigationControl:class{constructor(h={}){this.options=Object.assign({},Qv,h),this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),he("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),he("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))})),this._compassIcon=he("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),s=t===h.getMaxZoom(),u=t===h.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ex(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const s=he("button",h,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(h,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",s),h.firstElementChild&&h.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends r.E{constructor(h={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Vc,h),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Af(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,h(s)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((s=>t(s.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),s=h.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",h)),this._finish()}}_updateCamera(h){const t=new r.aR(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,u=this._map.getBearing(),m=Object.assign({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new r.aR(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=r.ce(1,h._center.lat)*h.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=he("button","mapboxgl-ctrl-geolocate",this._container),he("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he("div","mapboxgl-user-location"),this._dotElement.appendChild(he("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(he("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Du({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=he("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Du({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))}))}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&h()})).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hd,ScaleControl:class{constructor(h={}){this.options=Object.assign({},ac,h),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,u=t._containerWidth/2-h/2,m=t.unproject([u,s]),g=t.unproject([u+h,s]),x=m.distanceTo(g);if(this.options.unit==="imperial"){const w=3.2808*x;w>5280?this._setScale(h,w/5280,"mile"):this._setScale(h,w,"foot")}else this.options.unit==="nautical"?this._setScale(h,x/1852,"nautical-mile"):x>=1e3?this._setScale(h,x/1e3,"kilometer"):this._setScale(h,x,"meter")}_setScale(h,t,s){this._map._requestDomTask((()=>{const u=(function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let w=g/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(A){const R=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*R)/R})(w),x*w})(t),m=u/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(u):`${u}&nbsp;${lc[s]}`,this._container.style.width=h*m+"px"}))}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=he("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=he("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=he("button","mapboxgl-ctrl-fullscreen",this._controlContainer);he("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:dd,Popup:class extends r.E{constructor(h){super(),this.options=Object.assign(Object.create(zu),h),this._altitude=this.options.altitude,r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=r.aR.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=h;u=s.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=he("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const s=this._closeButton=he("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,u=this._pos;if(!t||!s||!u)return"bottom";const m=s.offsetWidth,g=s.offsetHeight,x=u.x<m/2,w=u.x>t.transform.width-m/2;if(u.y+h<g)return x?"top-left":w?"top-right":"top";if(u.y>t.transform.height-g){if(x)return"bottom-left";if(w)return"bottom-right"}return x?"left":w?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let u=this._container;if(u||(u=this._container=he("div","mapboxgl-popup",t.getContainer()),this._tip=he("div","mapboxgl-popup-tip",u),u.appendChild(s)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=kf(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const m=this._pos=this._trackPointer&&h instanceof r.P?h:t.project(this._lngLat,this._altitude),g=vg(this.options.offset),x=this._anchor=this._getAnchor(g.y),w=vg(this.options.offset,x),A=m.add(w).round();t._requestDomTask((()=>{this._container&&x&&(this._container.style.transform=`${_d[x]} translate(${A.x}px,${A.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const m=r.eY(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(yl);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Du,Style:Oa,LngLat:r.aR,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:Ra,Evented:r.E,config:r.e,prewarm:r.f0,clearPrewarmedResources:r.e$,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(h){r.e.ACCESS_TOKEN=h},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(h){r.e.API_URL=h},get workerCount(){return r.f9.workerCount},set workerCount(h){r.f9.workerCount=h},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){r.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){r.f8(h)},get workerUrl(){return r.f7.workerUrl},set workerUrl(h){r.f7.workerUrl=h},get workerClass(){return r.f7.workerClass},set workerClass(h){r.f7.workerClass=h},get workerParams(){return r.f7.workerParams},set workerParams(h){r.f7.workerParams=h},get dracoUrl(){return r.f6()},set dracoUrl(h){r.f5(h)},get meshoptUrl(){return r.f4()},set meshoptUrl(h){r.f3(h)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}}));var k=P;return k}))})(By)),By.exports}var S6=T6();const oR=dv(S6);function Iy(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rb={exports:{}},zP;function E6(){return zP||(zP=1,(function(a,d){(function(y){a.exports=y()})(function(){return(function(){function y(S,P,M){function k(H,W){if(!P[H]){if(!S[H]){var ee=typeof Iy=="function"&&Iy;if(!W&&ee)return ee(H,!0);if(r)return r(H,!0);var le=new Error("Cannot find module '"+H+"'");throw le.code="MODULE_NOT_FOUND",le}var pe=P[H]={exports:{}};S[H][0].call(pe.exports,function(se){var he=S[H][1][se];return k(he||se)},pe,pe.exports,y,S,P,M)}return P[H].exports}for(var r=typeof Iy=="function"&&Iy,j=0;j<M.length;j++)k(M[j]);return k}return y})()({1:[function(y,S,P){var M=y("./toPropertyKey.js");function k(r,j,H){return j=M(j),j in r?Object.defineProperty(r,j,{value:H,enumerable:!0,configurable:!0,writable:!0}):r[j]=H,r}S.exports=k,S.exports.__esModule=!0,S.exports.default=S.exports},{"./toPropertyKey.js":4}],2:[function(y,S,P){var M=y("./defineProperty.js");function k(j,H){var W=Object.keys(j);if(Object.getOwnPropertySymbols){var ee=Object.getOwnPropertySymbols(j);H&&(ee=ee.filter(function(le){return Object.getOwnPropertyDescriptor(j,le).enumerable})),W.push.apply(W,ee)}return W}function r(j){for(var H=1;H<arguments.length;H++){var W=arguments[H]!=null?arguments[H]:{};H%2?k(Object(W),!0).forEach(function(ee){M(j,ee,W[ee])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(W)):k(Object(W)).forEach(function(ee){Object.defineProperty(j,ee,Object.getOwnPropertyDescriptor(W,ee))})}return j}S.exports=r,S.exports.__esModule=!0,S.exports.default=S.exports},{"./defineProperty.js":1}],3:[function(y,S,P){var M=y("./typeof.js").default;function k(r,j){if(M(r)!=="object"||r===null)return r;var H=r[Symbol.toPrimitive];if(H!==void 0){var W=H.call(r,j||"default");if(M(W)!=="object")return W;throw new TypeError("@@toPrimitive must return a primitive value.")}return(j==="string"?String:Number)(r)}S.exports=k,S.exports.__esModule=!0,S.exports.default=S.exports},{"./typeof.js":5}],4:[function(y,S,P){var M=y("./typeof.js").default,k=y("./toPrimitive.js");function r(j){var H=k(j,"string");return M(H)==="symbol"?H:String(H)}S.exports=r,S.exports.__esModule=!0,S.exports.default=S.exports},{"./toPrimitive.js":3,"./typeof.js":5}],5:[function(y,S,P){function M(k){"@babel/helpers - typeof";return S.exports=M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},S.exports.__esModule=!0,S.exports.default=S.exports,M(k)}S.exports=M,S.exports.__esModule=!0,S.exports.default=S.exports},{}],6:[function(y,S,P){var M={};function k(H){return Math.floor(Math.abs(H)+.5)*(H>=0?1:-1)}function r(H,W,ee){H=k(H*ee),W=k(W*ee);var le=H-W;le<<=1,H-W<0&&(le=~le);for(var pe="";le>=32;)pe+=String.fromCharCode((32|le&31)+63),le>>=5;return pe+=String.fromCharCode(le+63),pe}M.decode=function(H,W){for(var ee=0,le=0,pe=0,se=[],he=0,Te=0,Se=null,fe,oe,ge=Math.pow(10,Number.isInteger(W)?W:5);ee<H.length;){Se=null,he=0,Te=0;do Se=H.charCodeAt(ee++)-63,Te|=(Se&31)<<he,he+=5;while(Se>=32);fe=Te&1?~(Te>>1):Te>>1,he=Te=0;do Se=H.charCodeAt(ee++)-63,Te|=(Se&31)<<he,he+=5;while(Se>=32);oe=Te&1?~(Te>>1):Te>>1,le+=fe,pe+=oe,se.push([le/ge,pe/ge])}return se},M.encode=function(H,W){if(!H.length)return"";for(var ee=Math.pow(10,Number.isInteger(W)?W:5),le=r(H[0][0],0,ee)+r(H[0][1],0,ee),pe=1;pe<H.length;pe++){var se=H[pe],he=H[pe-1];le+=r(se[0],he[0],ee),le+=r(se[1],he[1],ee)}return le};function j(H){for(var W=[],ee=0;ee<H.length;ee++){var le=H[ee].slice();W.push([le[1],le[0]])}return W}M.fromGeoJSON=function(H,W){if(H&&H.type==="Feature"&&(H=H.geometry),!H||H.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return M.encode(j(H.coordinates),W)},M.toGeoJSON=function(H,W){var ee=M.decode(H,W);return{type:"LineString",coordinates:j(ee)}},typeof S=="object"&&S.exports&&(S.exports=M)},{}],7:[function(y,S,P){var M=typeof Reflect=="object"?Reflect:null,k=M&&typeof M.apply=="function"?M.apply:function(De,Oe,He){return Function.prototype.apply.call(De,Oe,He)},r;M&&typeof M.ownKeys=="function"?r=M.ownKeys:Object.getOwnPropertySymbols?r=function(De){return Object.getOwnPropertyNames(De).concat(Object.getOwnPropertySymbols(De))}:r=function(De){return Object.getOwnPropertyNames(De)};function j(Be){console&&console.warn&&console.warn(Be)}var H=Number.isNaN||function(De){return De!==De};function W(){W.init.call(this)}S.exports=W,S.exports.once=xt,W.EventEmitter=W,W.prototype._events=void 0,W.prototype._eventsCount=0,W.prototype._maxListeners=void 0;var ee=10;function le(Be){if(typeof Be!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Be)}Object.defineProperty(W,"defaultMaxListeners",{enumerable:!0,get:function(){return ee},set:function(Be){if(typeof Be!="number"||Be<0||H(Be))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Be+".");ee=Be}}),W.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},W.prototype.setMaxListeners=function(De){if(typeof De!="number"||De<0||H(De))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+De+".");return this._maxListeners=De,this};function pe(Be){return Be._maxListeners===void 0?W.defaultMaxListeners:Be._maxListeners}W.prototype.getMaxListeners=function(){return pe(this)},W.prototype.emit=function(De){for(var Oe=[],He=1;He<arguments.length;He++)Oe.push(arguments[He]);var ft=De==="error",tt=this._events;if(tt!==void 0)ft=ft&&tt.error===void 0;else if(!ft)return!1;if(ft){var At;if(Oe.length>0&&(At=Oe[0]),At instanceof Error)throw At;var yt=new Error("Unhandled error."+(At?" ("+At.message+")":""));throw yt.context=At,yt}var si=tt[De];if(si===void 0)return!1;if(typeof si=="function")k(si,this,Oe);else for(var wt=si.length,Gi=oe(si,wt),He=0;He<wt;++He)k(Gi[He],this,Oe);return!0};function se(Be,De,Oe,He){var ft,tt,At;if(le(Oe),tt=Be._events,tt===void 0?(tt=Be._events=Object.create(null),Be._eventsCount=0):(tt.newListener!==void 0&&(Be.emit("newListener",De,Oe.listener?Oe.listener:Oe),tt=Be._events),At=tt[De]),At===void 0)At=tt[De]=Oe,++Be._eventsCount;else if(typeof At=="function"?At=tt[De]=He?[Oe,At]:[At,Oe]:He?At.unshift(Oe):At.push(Oe),ft=pe(Be),ft>0&&At.length>ft&&!At.warned){At.warned=!0;var yt=new Error("Possible EventEmitter memory leak detected. "+At.length+" "+String(De)+" listeners added. Use emitter.setMaxListeners() to increase limit");yt.name="MaxListenersExceededWarning",yt.emitter=Be,yt.type=De,yt.count=At.length,j(yt)}return Be}W.prototype.addListener=function(De,Oe){return se(this,De,Oe,!1)},W.prototype.on=W.prototype.addListener,W.prototype.prependListener=function(De,Oe){return se(this,De,Oe,!0)};function he(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Te(Be,De,Oe){var He={fired:!1,wrapFn:void 0,target:Be,type:De,listener:Oe},ft=he.bind(He);return ft.listener=Oe,He.wrapFn=ft,ft}W.prototype.once=function(De,Oe){return le(Oe),this.on(De,Te(this,De,Oe)),this},W.prototype.prependOnceListener=function(De,Oe){return le(Oe),this.prependListener(De,Te(this,De,Oe)),this},W.prototype.removeListener=function(De,Oe){var He,ft,tt,At,yt;if(le(Oe),ft=this._events,ft===void 0)return this;if(He=ft[De],He===void 0)return this;if(He===Oe||He.listener===Oe)--this._eventsCount===0?this._events=Object.create(null):(delete ft[De],ft.removeListener&&this.emit("removeListener",De,He.listener||Oe));else if(typeof He!="function"){for(tt=-1,At=He.length-1;At>=0;At--)if(He[At]===Oe||He[At].listener===Oe){yt=He[At].listener,tt=At;break}if(tt<0)return this;tt===0?He.shift():ge(He,tt),He.length===1&&(ft[De]=He[0]),ft.removeListener!==void 0&&this.emit("removeListener",De,yt||Oe)}return this},W.prototype.off=W.prototype.removeListener,W.prototype.removeAllListeners=function(De){var Oe,He,ft;if(He=this._events,He===void 0)return this;if(He.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):He[De]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete He[De]),this;if(arguments.length===0){var tt=Object.keys(He),At;for(ft=0;ft<tt.length;++ft)At=tt[ft],At!=="removeListener"&&this.removeAllListeners(At);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Oe=He[De],typeof Oe=="function")this.removeListener(De,Oe);else if(Oe!==void 0)for(ft=Oe.length-1;ft>=0;ft--)this.removeListener(De,Oe[ft]);return this};function Se(Be,De,Oe){var He=Be._events;if(He===void 0)return[];var ft=He[De];return ft===void 0?[]:typeof ft=="function"?Oe?[ft.listener||ft]:[ft]:Oe?Ge(ft):oe(ft,ft.length)}W.prototype.listeners=function(De){return Se(this,De,!0)},W.prototype.rawListeners=function(De){return Se(this,De,!1)},W.listenerCount=function(Be,De){return typeof Be.listenerCount=="function"?Be.listenerCount(De):fe.call(Be,De)},W.prototype.listenerCount=fe;function fe(Be){var De=this._events;if(De!==void 0){var Oe=De[Be];if(typeof Oe=="function")return 1;if(Oe!==void 0)return Oe.length}return 0}W.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]};function oe(Be,De){for(var Oe=new Array(De),He=0;He<De;++He)Oe[He]=Be[He];return Oe}function ge(Be,De){for(;De+1<Be.length;De++)Be[De]=Be[De+1];Be.pop()}function Ge(Be){for(var De=new Array(Be.length),Oe=0;Oe<De.length;++Oe)De[Oe]=Be[Oe].listener||Be[Oe];return De}function xt(Be,De){return new Promise(function(Oe,He){function ft(At){Be.removeListener(De,tt),He(At)}function tt(){typeof Be.removeListener=="function"&&Be.removeListener("error",ft),Oe([].slice.call(arguments))}ot(Be,De,tt,{once:!0}),De!=="error"&&It(Be,ft,{once:!0})})}function It(Be,De,Oe){typeof Be.on=="function"&&ot(Be,"error",De,Oe)}function ot(Be,De,Oe,He){if(typeof Be.on=="function")He.once?Be.once(De,Oe):Be.on(De,Oe);else if(typeof Be.addEventListener=="function")Be.addEventListener(De,function ft(tt){He.once&&Be.removeEventListener(De,ft),Oe(tt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Be)}},{}],8:[function(y,S,P){(function(){var M=this,k={};typeof P<"u"?S.exports=k:M.fuzzy=k,k.simpleFilter=function(r,j){return j.filter(function(H){return k.test(r,H)})},k.test=function(r,j){return k.match(r,j)!==null},k.match=function(r,j,H){H=H||{};var W=0,ee=[],le=j.length,pe=0,se=0,he=H.pre||"",Te=H.post||"",Se=H.caseSensitive&&j||j.toLowerCase(),fe;r=H.caseSensitive&&r||r.toLowerCase();for(var oe=0;oe<le;oe++)fe=j[oe],Se[oe]===r[W]?(fe=he+fe+Te,W+=1,se+=1+se):se=0,pe+=se,ee[ee.length]=fe;return W===r.length?(pe=Se===r?1/0:pe,{rendered:ee.join(""),score:pe}):null},k.filter=function(r,j,H){return!j||j.length===0?[]:typeof r!="string"?j:(H=H||{},j.reduce(function(W,ee,le,pe){var se=ee;H.extract&&(se=H.extract(ee));var he=k.match(r,se,H);return he!=null&&(W[W.length]={string:he.rendered,score:he.score,index:le,original:ee}),W},[]).sort(function(W,ee){var le=ee.score-W.score;return le||W.index-ee.index}))}})()},{}],9:[function(y,S,P){var M=/<%=([\s\S]+?)%>/g;S.exports=M},{}],10:[function(y,S,P){(function(M){(function(){var k="Expected a function",r=NaN,j="[object Symbol]",H=/^\s+|\s+$/g,W=/^[-+]0x[0-9a-f]+$/i,ee=/^0b[01]+$/i,le=/^0o[0-7]+$/i,pe=parseInt,se=typeof M=="object"&&M&&M.Object===Object&&M,he=typeof self=="object"&&self&&self.Object===Object&&self,Te=se||he||Function("return this")(),Se=Object.prototype,fe=Se.toString,oe=Math.max,ge=Math.min,Ge=function(){return Te.Date.now()};function xt(Oe,He,ft){var tt,At,yt,si,wt,Gi,Ti=0,di=!1,ki=!1,dn=!0;if(typeof Oe!="function")throw new TypeError(k);He=De(He)||0,It(ft)&&(di=!!ft.leading,ki="maxWait"in ft,yt=ki?oe(De(ft.maxWait)||0,He):yt,dn="trailing"in ft?!!ft.trailing:dn);function an($e){var lt=tt,vt=At;return tt=At=void 0,Ti=$e,si=Oe.apply(vt,lt),si}function mt($e){return Ti=$e,wt=setTimeout(Ui,He),di?an($e):si}function Pt($e){var lt=$e-Gi,vt=$e-Ti,ai=He-lt;return ki?ge(ai,yt-vt):ai}function pi($e){var lt=$e-Gi,vt=$e-Ti;return Gi===void 0||lt>=He||lt<0||ki&&vt>=yt}function Ui(){var $e=Ge();if(pi($e))return ei($e);wt=setTimeout(Ui,Pt($e))}function ei($e){return wt=void 0,dn&&tt?an($e):(tt=At=void 0,si)}function _i(){wt!==void 0&&clearTimeout(wt),Ti=0,tt=Gi=At=wt=void 0}function un(){return wt===void 0?si:ei(Ge())}function Qi(){var $e=Ge(),lt=pi($e);if(tt=arguments,At=this,Gi=$e,lt){if(wt===void 0)return mt(Gi);if(ki)return wt=setTimeout(Ui,He),an(Gi)}return wt===void 0&&(wt=setTimeout(Ui,He)),si}return Qi.cancel=_i,Qi.flush=un,Qi}function It(Oe){var He=typeof Oe;return!!Oe&&(He=="object"||He=="function")}function ot(Oe){return!!Oe&&typeof Oe=="object"}function Be(Oe){return typeof Oe=="symbol"||ot(Oe)&&fe.call(Oe)==j}function De(Oe){if(typeof Oe=="number")return Oe;if(Be(Oe))return r;if(It(Oe)){var He=typeof Oe.valueOf=="function"?Oe.valueOf():Oe;Oe=It(He)?He+"":He}if(typeof Oe!="string")return Oe===0?Oe:+Oe;Oe=Oe.replace(H,"");var ft=ee.test(Oe);return ft||le.test(Oe)?pe(Oe.slice(2),ft?2:8):W.test(Oe)?r:+Oe}S.exports=xt}).call(this)}).call(this,typeof Jc<"u"?Jc:typeof self<"u"?self:typeof window<"u"?window:{})},{}],11:[function(y,S,P){(function(M){(function(){var k=200,r="__lodash_hash_undefined__",j=1,H=2,W=9007199254740991,ee="[object Arguments]",le="[object Array]",pe="[object AsyncFunction]",se="[object Boolean]",he="[object Date]",Te="[object Error]",Se="[object Function]",fe="[object GeneratorFunction]",oe="[object Map]",ge="[object Number]",Ge="[object Null]",xt="[object Object]",It="[object Promise]",ot="[object Proxy]",Be="[object RegExp]",De="[object Set]",Oe="[object String]",He="[object Symbol]",ft="[object Undefined]",tt="[object WeakMap]",At="[object ArrayBuffer]",yt="[object DataView]",si="[object Float32Array]",wt="[object Float64Array]",Gi="[object Int8Array]",Ti="[object Int16Array]",di="[object Int32Array]",ki="[object Uint8Array]",dn="[object Uint8ClampedArray]",an="[object Uint16Array]",mt="[object Uint32Array]",Pt=/[\\^$.*+?()[\]{}|]/g,pi=/^\[object .+?Constructor\]$/,Ui=/^(?:0|[1-9]\d*)$/,ei={};ei[si]=ei[wt]=ei[Gi]=ei[Ti]=ei[di]=ei[ki]=ei[dn]=ei[an]=ei[mt]=!0,ei[ee]=ei[le]=ei[At]=ei[se]=ei[yt]=ei[he]=ei[Te]=ei[Se]=ei[oe]=ei[ge]=ei[xt]=ei[Be]=ei[De]=ei[Oe]=ei[tt]=!1;var _i=typeof M=="object"&&M&&M.Object===Object&&M,un=typeof self=="object"&&self&&self.Object===Object&&self,Qi=_i||un||Function("return this")(),$e=typeof P=="object"&&P&&!P.nodeType&&P,lt=$e&&typeof S=="object"&&S&&!S.nodeType&&S,vt=lt&&lt.exports===$e,ai=vt&&_i.process,ii=(function(){try{return ai&&ai.binding&&ai.binding("util")}catch{}})(),ci=ii&&ii.isTypedArray;function Ei(Ke,Mt){for(var Ai=-1,Ii=Ke==null?0:Ke.length,Xr=0,Un=[];++Ai<Ii;){var wr=Ke[Ai];Mt(wr,Ai,Ke)&&(Un[Xr++]=wr)}return Un}function bi(Ke,Mt){for(var Ai=-1,Ii=Mt.length,Xr=Ke.length;++Ai<Ii;)Ke[Xr+Ai]=Mt[Ai];return Ke}function ui(Ke,Mt){for(var Ai=-1,Ii=Ke==null?0:Ke.length;++Ai<Ii;)if(Mt(Ke[Ai],Ai,Ke))return!0;return!1}function vi(Ke,Mt){for(var Ai=-1,Ii=Array(Ke);++Ai<Ke;)Ii[Ai]=Mt(Ai);return Ii}function sn(Ke){return function(Mt){return Ke(Mt)}}function Hi(Ke,Mt){return Ke.has(Mt)}function $i(Ke,Mt){return Ke?.[Mt]}function fn(Ke){var Mt=-1,Ai=Array(Ke.size);return Ke.forEach(function(Ii,Xr){Ai[++Mt]=[Xr,Ii]}),Ai}function Nn(Ke,Mt){return function(Ai){return Ke(Mt(Ai))}}function br(Ke){var Mt=-1,Ai=Array(Ke.size);return Ke.forEach(function(Ii){Ai[++Mt]=Ii}),Ai}var Xn=Array.prototype,is=Function.prototype,Qn=Object.prototype,Wr=Qi["__core-js_shared__"],ns=is.toString,Dr=Qn.hasOwnProperty,ds=(function(){var Ke=/[^.]+$/.exec(Wr&&Wr.keys&&Wr.keys.IE_PROTO||"");return Ke?"Symbol(src)_1."+Ke:""})(),Rt=Qn.toString,Dt=RegExp("^"+ns.call(Dr).replace(Pt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),en=vt?Qi.Buffer:void 0,Dn=Qi.Symbol,ir=Qi.Uint8Array,jn=Qn.propertyIsEnumerable,rs=Xn.splice,Os=Dn?Dn.toStringTag:void 0,fs=Object.getOwnPropertySymbols,fo=en?en.isBuffer:void 0,kt=Nn(Object.keys,Object),ls=To(Qi,"DataView"),Ss=To(Qi,"Map"),wo=To(Qi,"Promise"),Xe=To(Qi,"Set"),Q=To(Qi,"WeakMap"),ne=To(Object,"create"),be=fr(ls),Fe=fr(Ss),ve=fr(wo),Le=fr(Xe),rt=fr(Q),je=Dn?Dn.prototype:void 0,st=je?je.valueOf:void 0;function Nt(Ke){var Mt=-1,Ai=Ke==null?0:Ke.length;for(this.clear();++Mt<Ai;){var Ii=Ke[Mt];this.set(Ii[0],Ii[1])}}function Ct(){this.__data__=ne?ne(null):{},this.size=0}function wi(Ke){var Mt=this.has(Ke)&&delete this.__data__[Ke];return this.size-=Mt?1:0,Mt}function qi(Ke){var Mt=this.__data__;if(ne){var Ai=Mt[Ke];return Ai===r?void 0:Ai}return Dr.call(Mt,Ke)?Mt[Ke]:void 0}function Ki(Ke){var Mt=this.__data__;return ne?Mt[Ke]!==void 0:Dr.call(Mt,Ke)}function pn(Ke,Mt){var Ai=this.__data__;return this.size+=this.has(Ke)?0:1,Ai[Ke]=ne&&Mt===void 0?r:Mt,this}Nt.prototype.clear=Ct,Nt.prototype.delete=wi,Nt.prototype.get=qi,Nt.prototype.has=Ki,Nt.prototype.set=pn;function Ji(Ke){var Mt=-1,Ai=Ke==null?0:Ke.length;for(this.clear();++Mt<Ai;){var Ii=Ke[Mt];this.set(Ii[0],Ii[1])}}function Mn(){this.__data__=[],this.size=0}function er(Ke){var Mt=this.__data__,Ai=Br(Mt,Ke);if(Ai<0)return!1;var Ii=Mt.length-1;return Ai==Ii?Mt.pop():rs.call(Mt,Ai,1),--this.size,!0}function An(Ke){var Mt=this.__data__,Ai=Br(Mt,Ke);return Ai<0?void 0:Mt[Ai][1]}function Mr(Ke){return Br(this.__data__,Ke)>-1}function ss(Ke,Mt){var Ai=this.__data__,Ii=Br(Ai,Ke);return Ii<0?(++this.size,Ai.push([Ke,Mt])):Ai[Ii][1]=Mt,this}Ji.prototype.clear=Mn,Ji.prototype.delete=er,Ji.prototype.get=An,Ji.prototype.has=Mr,Ji.prototype.set=ss;function zr(Ke){var Mt=-1,Ai=Ke==null?0:Ke.length;for(this.clear();++Mt<Ai;){var Ii=Ke[Mt];this.set(Ii[0],Ii[1])}}function rr(){this.size=0,this.__data__={hash:new Nt,map:new(Ss||Ji),string:new Nt}}function Zn(Ke){var Mt=go(this,Ke).delete(Ke);return this.size-=Mt?1:0,Mt}function kr(Ke){return go(this,Ke).get(Ke)}function Rr(Ke){return go(this,Ke).has(Ke)}function Gn(Ke,Mt){var Ai=go(this,Ke),Ii=Ai.size;return Ai.set(Ke,Mt),this.size+=Ai.size==Ii?0:1,this}zr.prototype.clear=rr,zr.prototype.delete=Zn,zr.prototype.get=kr,zr.prototype.has=Rr,zr.prototype.set=Gn;function ps(Ke){var Mt=-1,Ai=Ke==null?0:Ke.length;for(this.__data__=new zr;++Mt<Ai;)this.add(Ke[Mt])}function gs(Ke){return this.__data__.set(Ke,r),this}function zs(Ke){return this.__data__.has(Ke)}ps.prototype.add=ps.prototype.push=gs,ps.prototype.has=zs;function Hn(Ke){var Mt=this.__data__=new Ji(Ke);this.size=Mt.size}function sr(){this.__data__=new Ji,this.size=0}function Wo(Ke){var Mt=this.__data__,Ai=Mt.delete(Ke);return this.size=Mt.size,Ai}function oa(Ke){return this.__data__.get(Ke)}function Xs(Ke){return this.__data__.has(Ke)}function aa(Ke,Mt){var Ai=this.__data__;if(Ai instanceof Ji){var Ii=Ai.__data__;if(!Ss||Ii.length<k-1)return Ii.push([Ke,Mt]),this.size=++Ai.size,this;Ai=this.__data__=new zr(Ii)}return Ai.set(Ke,Mt),this.size=Ai.size,this}Hn.prototype.clear=sr,Hn.prototype.delete=Wo,Hn.prototype.get=oa,Hn.prototype.has=Xs,Hn.prototype.set=aa;function Kn(Ke,Mt){var Ai=Pn(Ke),Ii=!Ai&&Js(Ke),Xr=!Ai&&!Ii&&Pa(Ke),Un=!Ai&&!Ii&&!Xr&&Fo(Ke),wr=Ai||Ii||Xr||Un,ys=wr?vi(Ke.length,String):[],Kr=ys.length;for(var _s in Ke)Dr.call(Ke,_s)&&!(wr&&(_s=="length"||Xr&&(_s=="offset"||_s=="parent")||Un&&(_s=="buffer"||_s=="byteLength"||_s=="byteOffset")||Pi(_s,Kr)))&&ys.push(_s);return ys}function Br(Ke,Mt){for(var Ai=Ke.length;Ai--;)if(pr(Ke[Ai][0],Mt))return Ai;return-1}function po(Ke,Mt,Ai){var Ii=Mt(Ke);return Pn(Ke)?Ii:bi(Ii,Ai(Ke))}function ks(Ke){return Ke==null?Ke===void 0?ft:Ge:Os&&Os in Object(Ke)?ko(Ke):In(Ke)}function Ls(Ke){return Rn(Ke)&&ks(Ke)==ee}function oo(Ke,Mt,Ai,Ii,Xr){return Ke===Mt?!0:Ke==null||Mt==null||!Rn(Ke)&&!Rn(Mt)?Ke!==Ke&&Mt!==Mt:Ia(Ke,Mt,Ai,Ii,oo,Xr)}function Ia(Ke,Mt,Ai,Ii,Xr,Un){var wr=Pn(Ke),ys=Pn(Mt),Kr=wr?le:Jt(Ke),_s=ys?le:Jt(Mt);Kr=Kr==ee?xt:Kr,_s=_s==ee?xt:_s;var yo=Kr==xt,Po=_s==xt,Cn=Kr==_s;if(Cn&&Pa(Ke)){if(!Pa(Mt))return!1;wr=!0,yo=!1}if(Cn&&!yo)return Un||(Un=new Hn),wr||Fo(Ke)?mo(Ke,Mt,Ai,Ii,Xr,Un):ao(Ke,Mt,Kr,Ai,Ii,Xr,Un);if(!(Ai&j)){var Co=yo&&Dr.call(Ke,"__wrapped__"),So=Po&&Dr.call(Mt,"__wrapped__");if(Co||So){var Xo=Co?Ke.value():Ke,Mi=So?Mt.value():Mt;return Un||(Un=new Hn),Xr(Xo,Mi,Ai,Ii,Un)}}return Cn?(Un||(Un=new Hn),js(Ke,Mt,Ai,Ii,Xr,Un)):!1}function Vo(Ke){if(!ms(Ke)||xr(Ke))return!1;var Mt=jo(Ke)?Dt:pi;return Mt.test(fr(Ke))}function Or(Ke){return Rn(Ke)&&Qs(Ke.length)&&!!ei[ks(Ke)]}function Vs(Ke){if(!Es(Ke))return kt(Ke);var Mt=[];for(var Ai in Object(Ke))Dr.call(Ke,Ai)&&Ai!="constructor"&&Mt.push(Ai);return Mt}function mo(Ke,Mt,Ai,Ii,Xr,Un){var wr=Ai&j,ys=Ke.length,Kr=Mt.length;if(ys!=Kr&&!(wr&&Kr>ys))return!1;var _s=Un.get(Ke);if(_s&&Un.get(Mt))return _s==Mt;var yo=-1,Po=!0,Cn=Ai&H?new ps:void 0;for(Un.set(Ke,Mt),Un.set(Mt,Ke);++yo<ys;){var Co=Ke[yo],So=Mt[yo];if(Ii)var Xo=wr?Ii(So,Co,yo,Mt,Ke,Un):Ii(Co,So,yo,Ke,Mt,Un);if(Xo!==void 0){if(Xo)continue;Po=!1;break}if(Cn){if(!ui(Mt,function(Mi,va){if(!Hi(Cn,va)&&(Co===Mi||Xr(Co,Mi,Ai,Ii,Un)))return Cn.push(va)})){Po=!1;break}}else if(!(Co===So||Xr(Co,So,Ai,Ii,Un))){Po=!1;break}}return Un.delete(Ke),Un.delete(Mt),Po}function ao(Ke,Mt,Ai,Ii,Xr,Un,wr){switch(Ai){case yt:if(Ke.byteLength!=Mt.byteLength||Ke.byteOffset!=Mt.byteOffset)return!1;Ke=Ke.buffer,Mt=Mt.buffer;case At:return!(Ke.byteLength!=Mt.byteLength||!Un(new ir(Ke),new ir(Mt)));case se:case he:case ge:return pr(+Ke,+Mt);case Te:return Ke.name==Mt.name&&Ke.message==Mt.message;case Be:case Oe:return Ke==Mt+"";case oe:var ys=fn;case De:var Kr=Ii&j;if(ys||(ys=br),Ke.size!=Mt.size&&!Kr)return!1;var _s=wr.get(Ke);if(_s)return _s==Mt;Ii|=H,wr.set(Ke,Mt);var yo=mo(ys(Ke),ys(Mt),Ii,Xr,Un,wr);return wr.delete(Ke),yo;case He:if(st)return st.call(Ke)==st.call(Mt)}return!1}function js(Ke,Mt,Ai,Ii,Xr,Un){var wr=Ai&j,ys=_o(Ke),Kr=ys.length,_s=_o(Mt),yo=_s.length;if(Kr!=yo&&!wr)return!1;for(var Po=Kr;Po--;){var Cn=ys[Po];if(!(wr?Cn in Mt:Dr.call(Mt,Cn)))return!1}var Co=Un.get(Ke);if(Co&&Un.get(Mt))return Co==Mt;var So=!0;Un.set(Ke,Mt),Un.set(Mt,Ke);for(var Xo=wr;++Po<Kr;){Cn=ys[Po];var Mi=Ke[Cn],va=Mt[Cn];if(Ii)var Eo=wr?Ii(va,Mi,Cn,Mt,Ke,Un):Ii(Mi,va,Cn,Ke,Mt,Un);if(!(Eo===void 0?Mi===va||Xr(Mi,va,Ai,Ii,Un):Eo)){So=!1;break}Xo||(Xo=Cn=="constructor")}if(So&&!Xo){var Fs=Ke.constructor,Ma=Mt.constructor;Fs!=Ma&&"constructor"in Ke&&"constructor"in Mt&&!(typeof Fs=="function"&&Fs instanceof Fs&&typeof Ma=="function"&&Ma instanceof Ma)&&(So=!1)}return Un.delete(Ke),Un.delete(Mt),So}function _o(Ke){return po(Ke,Ca,_t)}function go(Ke,Mt){var Ai=Ke.__data__;return Fn(Mt)?Ai[typeof Mt=="string"?"string":"hash"]:Ai.map}function To(Ke,Mt){var Ai=$i(Ke,Mt);return Vo(Ai)?Ai:void 0}function ko(Ke){var Mt=Dr.call(Ke,Os),Ai=Ke[Os];try{Ke[Os]=void 0;var Ii=!0}catch{}var Xr=Rt.call(Ke);return Ii&&(Mt?Ke[Os]=Ai:delete Ke[Os]),Xr}var _t=fs?function(Ke){return Ke==null?[]:(Ke=Object(Ke),Ei(fs(Ke),function(Mt){return jn.call(Ke,Mt)}))}:ca,Jt=ks;(ls&&Jt(new ls(new ArrayBuffer(1)))!=yt||Ss&&Jt(new Ss)!=oe||wo&&Jt(wo.resolve())!=It||Xe&&Jt(new Xe)!=De||Q&&Jt(new Q)!=tt)&&(Jt=function(Ke){var Mt=ks(Ke),Ai=Mt==xt?Ke.constructor:void 0,Ii=Ai?fr(Ai):"";if(Ii)switch(Ii){case be:return yt;case Fe:return oe;case ve:return It;case Le:return De;case rt:return tt}return Mt});function Pi(Ke,Mt){return Mt=Mt??W,!!Mt&&(typeof Ke=="number"||Ui.test(Ke))&&Ke>-1&&Ke%1==0&&Ke<Mt}function Fn(Ke){var Mt=typeof Ke;return Mt=="string"||Mt=="number"||Mt=="symbol"||Mt=="boolean"?Ke!=="__proto__":Ke===null}function xr(Ke){return!!ds&&ds in Ke}function Es(Ke){var Mt=Ke&&Ke.constructor,Ai=typeof Mt=="function"&&Mt.prototype||Qn;return Ke===Ai}function In(Ke){return Rt.call(Ke)}function fr(Ke){if(Ke!=null){try{return ns.call(Ke)}catch{}try{return Ke+""}catch{}}return""}function pr(Ke,Mt){return Ke===Mt||Ke!==Ke&&Mt!==Mt}var Js=Ls((function(){return arguments})())?Ls:function(Ke){return Rn(Ke)&&Dr.call(Ke,"callee")&&!jn.call(Ke,"callee")},Pn=Array.isArray;function Ps(Ke){return Ke!=null&&Qs(Ke.length)&&!jo(Ke)}var Pa=fo||Qa;function la(Ke,Mt){return oo(Ke,Mt)}function jo(Ke){if(!ms(Ke))return!1;var Mt=ks(Ke);return Mt==Se||Mt==fe||Mt==pe||Mt==ot}function Qs(Ke){return typeof Ke=="number"&&Ke>-1&&Ke%1==0&&Ke<=W}function ms(Ke){var Mt=typeof Ke;return Ke!=null&&(Mt=="object"||Mt=="function")}function Rn(Ke){return Ke!=null&&typeof Ke=="object"}var Fo=ci?sn(ci):Or;function Ca(Ke){return Ps(Ke)?Kn(Ke):Vs(Ke)}function ca(){return[]}function Qa(){return!1}S.exports=la}).call(this)}).call(this,typeof Jc<"u"?Jc:typeof self<"u"?self:typeof window<"u"?window:{})},{}],12:[function(y,S,P){(function(M){(function(){var k=y("lodash._reinterpolate"),r=y("lodash.templatesettings"),j=800,H=16,W=9007199254740991,ee="[object Arguments]",le="[object Array]",pe="[object AsyncFunction]",se="[object Boolean]",he="[object Date]",Te="[object DOMException]",Se="[object Error]",fe="[object Function]",oe="[object GeneratorFunction]",ge="[object Map]",Ge="[object Number]",xt="[object Null]",It="[object Object]",ot="[object Proxy]",Be="[object RegExp]",De="[object Set]",Oe="[object String]",He="[object Symbol]",ft="[object Undefined]",tt="[object WeakMap]",At="[object ArrayBuffer]",yt="[object DataView]",si="[object Float32Array]",wt="[object Float64Array]",Gi="[object Int8Array]",Ti="[object Int16Array]",di="[object Int32Array]",ki="[object Uint8Array]",dn="[object Uint8ClampedArray]",an="[object Uint16Array]",mt="[object Uint32Array]",Pt=/\b__p \+= '';/g,pi=/\b(__p \+=) '' \+/g,Ui=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ei=/[\\^$.*+?()[\]{}|]/g,_i=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,un=/^\[object .+?Constructor\]$/,Qi=/^(?:0|[1-9]\d*)$/,$e=/($^)/,lt=/['\n\r\u2028\u2029\\]/g,vt={};vt[si]=vt[wt]=vt[Gi]=vt[Ti]=vt[di]=vt[ki]=vt[dn]=vt[an]=vt[mt]=!0,vt[ee]=vt[le]=vt[At]=vt[se]=vt[yt]=vt[he]=vt[Se]=vt[fe]=vt[ge]=vt[Ge]=vt[It]=vt[Be]=vt[De]=vt[Oe]=vt[tt]=!1;var ai={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ii=typeof M=="object"&&M&&M.Object===Object&&M,ci=typeof self=="object"&&self&&self.Object===Object&&self,Ei=ii||ci||Function("return this")(),bi=typeof P=="object"&&P&&!P.nodeType&&P,ui=bi&&typeof S=="object"&&S&&!S.nodeType&&S,vi=ui&&ui.exports===bi,sn=vi&&ii.process,Hi=(function(){try{var _t=ui&&ui.require&&ui.require("util").types;return _t||sn&&sn.binding&&sn.binding("util")}catch{}})(),$i=Hi&&Hi.isTypedArray;function fn(_t,Jt,Pi){switch(Pi.length){case 0:return _t.call(Jt);case 1:return _t.call(Jt,Pi[0]);case 2:return _t.call(Jt,Pi[0],Pi[1]);case 3:return _t.call(Jt,Pi[0],Pi[1],Pi[2])}return _t.apply(Jt,Pi)}function Nn(_t,Jt){for(var Pi=-1,Fn=_t==null?0:_t.length,xr=Array(Fn);++Pi<Fn;)xr[Pi]=Jt(_t[Pi],Pi,_t);return xr}function br(_t,Jt){for(var Pi=-1,Fn=Array(_t);++Pi<_t;)Fn[Pi]=Jt(Pi);return Fn}function Xn(_t){return function(Jt){return _t(Jt)}}function is(_t,Jt){return Nn(Jt,function(Pi){return _t[Pi]})}function Qn(_t){return"\\"+ai[_t]}function Wr(_t,Jt){return _t?.[Jt]}function ns(_t,Jt){return function(Pi){return _t(Jt(Pi))}}var Dr=Function.prototype,ds=Object.prototype,Rt=Ei["__core-js_shared__"],Dt=Dr.toString,en=ds.hasOwnProperty,Dn=(function(){var _t=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||"");return _t?"Symbol(src)_1."+_t:""})(),ir=ds.toString,jn=Dt.call(Object),rs=RegExp("^"+Dt.call(en).replace(ei,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Os=vi?Ei.Buffer:void 0,fs=Ei.Symbol,fo=ns(Object.getPrototypeOf,Object),kt=ds.propertyIsEnumerable,ls=fs?fs.toStringTag:void 0,Ss=(function(){try{var _t=Mr(Object,"defineProperty");return _t({},"",{}),_t}catch{}})(),wo=Os?Os.isBuffer:void 0,Xe=ns(Object.keys,Object),Q=Math.max,ne=Date.now,be=fs?fs.prototype:void 0,Fe=be?be.toString:void 0;function ve(_t,Jt){var Pi=oa(_t),Fn=!Pi&&Wo(_t),xr=!Pi&&!Fn&&aa(_t),Es=!Pi&&!Fn&&!xr&&Vo(_t),In=Pi||Fn||xr||Es,fr=In?br(_t.length,String):[],pr=fr.length;for(var Js in _t)(Jt||en.call(_t,Js))&&!(In&&(Js=="length"||xr&&(Js=="offset"||Js=="parent")||Es&&(Js=="buffer"||Js=="byteLength"||Js=="byteOffset")||zr(Js,pr)))&&fr.push(Js);return fr}function Le(_t,Jt,Pi){var Fn=_t[Jt];(!(en.call(_t,Jt)&&sr(Fn,Pi))||Pi===void 0&&!(Jt in _t))&&rt(_t,Jt,Pi)}function rt(_t,Jt,Pi){Jt=="__proto__"&&Ss?Ss(_t,Jt,{configurable:!0,enumerable:!0,value:Pi,writable:!0}):_t[Jt]=Pi}function je(_t){return _t==null?_t===void 0?ft:xt:ls&&ls in Object(_t)?ss(_t):Gn(_t)}function st(_t){return Ls(_t)&&je(_t)==ee}function Nt(_t){if(!ks(_t)||Zn(_t))return!1;var Jt=Br(_t)?rs:un;return Jt.test(Hn(_t))}function Ct(_t){return Ls(_t)&&po(_t.length)&&!!vt[je(_t)]}function wi(_t){if(!kr(_t))return Xe(_t);var Jt=[];for(var Pi in Object(_t))en.call(_t,Pi)&&Pi!="constructor"&&Jt.push(Pi);return Jt}function qi(_t){if(!ks(_t))return Rr(_t);var Jt=kr(_t),Pi=[];for(var Fn in _t)Fn=="constructor"&&(Jt||!en.call(_t,Fn))||Pi.push(Fn);return Pi}function Ki(_t,Jt){return gs(ps(_t,Jt,To),_t+"")}var pn=Ss?function(_t,Jt){return Ss(_t,"toString",{configurable:!0,enumerable:!1,value:go(Jt),writable:!0})}:To;function Ji(_t){if(typeof _t=="string")return _t;if(oa(_t))return Nn(_t,Ji)+"";if(Ia(_t))return Fe?Fe.call(_t):"";var Jt=_t+"";return Jt=="0"&&1/_t==-1/0?"-0":Jt}function Mn(_t,Jt,Pi,Fn){var xr=!Pi;Pi||(Pi={});for(var Es=-1,In=Jt.length;++Es<In;){var fr=Jt[Es],pr=Fn?Fn(Pi[fr],_t[fr],fr,Pi,_t):void 0;pr===void 0&&(pr=_t[fr]),xr?rt(Pi,fr,pr):Le(Pi,fr,pr)}return Pi}function er(_t){return Ki(function(Jt,Pi){var Fn=-1,xr=Pi.length,Es=xr>1?Pi[xr-1]:void 0,In=xr>2?Pi[2]:void 0;for(Es=_t.length>3&&typeof Es=="function"?(xr--,Es):void 0,In&&rr(Pi[0],Pi[1],In)&&(Es=xr<3?void 0:Es,xr=1),Jt=Object(Jt);++Fn<xr;){var fr=Pi[Fn];fr&&_t(Jt,fr,Fn,Es)}return Jt})}function An(_t,Jt,Pi,Fn){return _t===void 0||sr(_t,ds[Pi])&&!en.call(Fn,Pi)?Jt:_t}function Mr(_t,Jt){var Pi=Wr(_t,Jt);return Nt(Pi)?Pi:void 0}function ss(_t){var Jt=en.call(_t,ls),Pi=_t[ls];try{_t[ls]=void 0;var Fn=!0}catch{}var xr=ir.call(_t);return Fn&&(Jt?_t[ls]=Pi:delete _t[ls]),xr}function zr(_t,Jt){var Pi=typeof _t;return Jt=Jt??W,!!Jt&&(Pi=="number"||Pi!="symbol"&&Qi.test(_t))&&_t>-1&&_t%1==0&&_t<Jt}function rr(_t,Jt,Pi){if(!ks(Pi))return!1;var Fn=typeof Jt;return(Fn=="number"?Xs(Pi)&&zr(Jt,Pi.length):Fn=="string"&&Jt in Pi)?sr(Pi[Jt],_t):!1}function Zn(_t){return!!Dn&&Dn in _t}function kr(_t){var Jt=_t&&_t.constructor,Pi=typeof Jt=="function"&&Jt.prototype||ds;return _t===Pi}function Rr(_t){var Jt=[];if(_t!=null)for(var Pi in Object(_t))Jt.push(Pi);return Jt}function Gn(_t){return ir.call(_t)}function ps(_t,Jt,Pi){return Jt=Q(Jt===void 0?_t.length-1:Jt,0),function(){for(var Fn=arguments,xr=-1,Es=Q(Fn.length-Jt,0),In=Array(Es);++xr<Es;)In[xr]=Fn[Jt+xr];xr=-1;for(var fr=Array(Jt+1);++xr<Jt;)fr[xr]=Fn[xr];return fr[Jt]=Pi(In),fn(_t,this,fr)}}var gs=zs(pn);function zs(_t){var Jt=0,Pi=0;return function(){var Fn=ne(),xr=H-(Fn-Pi);if(Pi=Fn,xr>0){if(++Jt>=j)return arguments[0]}else Jt=0;return _t.apply(void 0,arguments)}}function Hn(_t){if(_t!=null){try{return Dt.call(_t)}catch{}try{return _t+""}catch{}}return""}function sr(_t,Jt){return _t===Jt||_t!==_t&&Jt!==Jt}var Wo=st((function(){return arguments})())?st:function(_t){return Ls(_t)&&en.call(_t,"callee")&&!kt.call(_t,"callee")},oa=Array.isArray;function Xs(_t){return _t!=null&&po(_t.length)&&!Br(_t)}var aa=wo||ko;function Kn(_t){if(!Ls(_t))return!1;var Jt=je(_t);return Jt==Se||Jt==Te||typeof _t.message=="string"&&typeof _t.name=="string"&&!oo(_t)}function Br(_t){if(!ks(_t))return!1;var Jt=je(_t);return Jt==fe||Jt==oe||Jt==pe||Jt==ot}function po(_t){return typeof _t=="number"&&_t>-1&&_t%1==0&&_t<=W}function ks(_t){var Jt=typeof _t;return _t!=null&&(Jt=="object"||Jt=="function")}function Ls(_t){return _t!=null&&typeof _t=="object"}function oo(_t){if(!Ls(_t)||je(_t)!=It)return!1;var Jt=fo(_t);if(Jt===null)return!0;var Pi=en.call(Jt,"constructor")&&Jt.constructor;return typeof Pi=="function"&&Pi instanceof Pi&&Dt.call(Pi)==jn}function Ia(_t){return typeof _t=="symbol"||Ls(_t)&&je(_t)==He}var Vo=$i?Xn($i):Ct;function Or(_t){return _t==null?"":Ji(_t)}var Vs=er(function(_t,Jt,Pi,Fn){Mn(Jt,ao(Jt),_t,Fn)});function mo(_t){return Xs(_t)?ve(_t):wi(_t)}function ao(_t){return Xs(_t)?ve(_t,!0):qi(_t)}function js(_t,Jt,Pi){var Fn=r.imports._.templateSettings||r;Pi&&rr(_t,Jt,Pi)&&(Jt=void 0),_t=Or(_t),Jt=Vs({},Jt,Fn,An);var xr=Vs({},Jt.imports,Fn.imports,An),Es=mo(xr),In=is(xr,Es),fr,pr,Js=0,Pn=Jt.interpolate||$e,Ps="__p += '",Pa=RegExp((Jt.escape||$e).source+"|"+Pn.source+"|"+(Pn===k?_i:$e).source+"|"+(Jt.evaluate||$e).source+"|$","g"),la=en.call(Jt,"sourceURL")?"//# sourceURL="+(Jt.sourceURL+"").replace(/[\r\n]/g," ")+`
`:"";_t.replace(Pa,function(ms,Rn,Fo,Ca,ca,Qa){return Fo||(Fo=Ca),Ps+=_t.slice(Js,Qa).replace(lt,Qn),Rn&&(fr=!0,Ps+=`' +
__e(`+Rn+`) +
'`),ca&&(pr=!0,Ps+=`';
`+ca+`;
__p += '`),Fo&&(Ps+=`' +
((__t = (`+Fo+`)) == null ? '' : __t) +
'`),Js=Qa+ms.length,ms}),Ps+=`';
`;var jo=en.call(Jt,"variable")&&Jt.variable;jo||(Ps=`with (obj) {
`+Ps+`
}
`),Ps=(pr?Ps.replace(Pt,""):Ps).replace(pi,"$1").replace(Ui,"$1;"),Ps="function("+(jo||"obj")+`) {
`+(jo?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(fr?", __e = _.escape":"")+(pr?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ps+`return __p
}`;var Qs=_o(function(){return Function(Es,la+"return "+Ps).apply(void 0,In)});if(Qs.source=Ps,Kn(Qs))throw Qs;return Qs}var _o=Ki(function(_t,Jt){try{return fn(_t,void 0,Jt)}catch(Pi){return Kn(Pi)?Pi:new Error(Pi)}});function go(_t){return function(){return _t}}function To(_t){return _t}function ko(){return!1}S.exports=js}).call(this)}).call(this,typeof Jc<"u"?Jc:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9,"lodash.templatesettings":13}],13:[function(y,S,P){(function(M){(function(){var k=y("lodash._reinterpolate"),r="[object Symbol]",j=/[&<>"'`]/g,H=RegExp(j.source),W=/<%-([\s\S]+?)%>/g,ee=/<%([\s\S]+?)%>/g,le={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},pe=typeof M=="object"&&M&&M.Object===Object&&M,se=typeof self=="object"&&self&&self.Object===Object&&self,he=pe||se||Function("return this")();function Te(ft){return function(tt){return ft?.[tt]}}var Se=Te(le),fe=Object.prototype,oe=fe.toString,ge=he.Symbol,Ge=ge?ge.prototype:void 0,xt=Ge?Ge.toString:void 0,It={escape:W,evaluate:ee,interpolate:k,variable:"",imports:{_:{escape:He}}};function ot(ft){if(typeof ft=="string")return ft;if(De(ft))return xt?xt.call(ft):"";var tt=ft+"";return tt=="0"&&1/ft==-1/0?"-0":tt}function Be(ft){return!!ft&&typeof ft=="object"}function De(ft){return typeof ft=="symbol"||Be(ft)&&oe.call(ft)==r}function Oe(ft){return ft==null?"":ot(ft)}function He(ft){return ft=Oe(ft),ft&&H.test(ft)?ft.replace(j,Se):ft}S.exports=It}).call(this)}).call(this,typeof Jc<"u"?Jc:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9}],14:[function(y,S,P){const M=y("is-plain-obj"),{hasOwnProperty:k}=Object.prototype,{propertyIsEnumerable:r}=Object,j=(fe,oe,ge)=>Object.defineProperty(fe,oe,{value:ge,writable:!0,enumerable:!0,configurable:!0}),H=this,W={concatArrays:!1,ignoreUndefined:!1},ee=fe=>{const oe=[];for(const ge in fe)k.call(fe,ge)&&oe.push(ge);if(Object.getOwnPropertySymbols){const ge=Object.getOwnPropertySymbols(fe);for(const Ge of ge)r.call(fe,Ge)&&oe.push(Ge)}return oe};function le(fe){return Array.isArray(fe)?pe(fe):M(fe)?se(fe):fe}function pe(fe){const oe=fe.slice(0,0);return ee(fe).forEach(ge=>{j(oe,ge,le(fe[ge]))}),oe}function se(fe){const oe=Object.getPrototypeOf(fe)===null?Object.create(null):{};return ee(fe).forEach(ge=>{j(oe,ge,le(fe[ge]))}),oe}const he=(fe,oe,ge,Ge)=>(ge.forEach(xt=>{typeof oe[xt]>"u"&&Ge.ignoreUndefined||(xt in fe&&fe[xt]!==Object.getPrototypeOf(fe)?j(fe,xt,Se(fe[xt],oe[xt],Ge)):j(fe,xt,le(oe[xt])))}),fe),Te=(fe,oe,ge)=>{let Ge=fe.slice(0,0),xt=0;return[fe,oe].forEach(It=>{const ot=[];for(let Be=0;Be<It.length;Be++)k.call(It,Be)&&(ot.push(String(Be)),It===fe?j(Ge,xt++,It[Be]):j(Ge,xt++,le(It[Be])));Ge=he(Ge,It,ee(It).filter(Be=>!ot.includes(Be)),ge)}),Ge};function Se(fe,oe,ge){return ge.concatArrays&&Array.isArray(fe)&&Array.isArray(oe)?Te(fe,oe,ge):!M(oe)||!M(fe)?le(oe):he(fe,oe,ee(oe),ge)}S.exports=function(...fe){const oe=Se(le(W),this!==H&&this||{},W);let ge={_:{}};for(const Ge of fe)if(Ge!==void 0){if(!M(Ge))throw new TypeError("`"+Ge+"` is not an Option Object");ge=Se(ge,{_:Ge},oe)}return ge._}},{"is-plain-obj":15}],15:[function(y,S,P){S.exports=M=>{if(Object.prototype.toString.call(M)!=="[object Object]")return!1;const k=Object.getPrototypeOf(M);return k===null||k===Object.prototype}},{}],16:[function(y,S,P){var M=S.exports={},k,r;function j(){throw new Error("setTimeout has not been defined")}function H(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?k=setTimeout:k=j}catch{k=j}try{typeof clearTimeout=="function"?r=clearTimeout:r=H}catch{r=H}})();function W(ge){if(k===setTimeout)return setTimeout(ge,0);if((k===j||!k)&&setTimeout)return k=setTimeout,setTimeout(ge,0);try{return k(ge,0)}catch{try{return k.call(null,ge,0)}catch{return k.call(this,ge,0)}}}function ee(ge){if(r===clearTimeout)return clearTimeout(ge);if((r===H||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(ge);try{return r(ge)}catch{try{return r.call(null,ge)}catch{return r.call(this,ge)}}}var le=[],pe=!1,se,he=-1;function Te(){!pe||!se||(pe=!1,se.length?le=se.concat(le):he=-1,le.length&&Se())}function Se(){if(!pe){var ge=W(Te);pe=!0;for(var Ge=le.length;Ge;){for(se=le,le=[];++he<Ge;)se&&se[he].run();he=-1,Ge=le.length}se=null,pe=!1,ee(ge)}}M.nextTick=function(ge){var Ge=new Array(arguments.length-1);if(arguments.length>1)for(var xt=1;xt<arguments.length;xt++)Ge[xt-1]=arguments[xt];le.push(new fe(ge,Ge)),le.length===1&&!pe&&W(Se)};function fe(ge,Ge){this.fun=ge,this.array=Ge}fe.prototype.run=function(){this.fun.apply(null,this.array)},M.title="browser",M.browser=!0,M.env={},M.argv=[],M.version="",M.versions={};function oe(){}M.on=oe,M.addListener=oe,M.once=oe,M.off=oe,M.removeListener=oe,M.removeAllListeners=oe,M.emit=oe,M.prependListener=oe,M.prependOnceListener=oe,M.listeners=function(ge){return[]},M.binding=function(ge){throw new Error("process.binding is not supported")},M.cwd=function(){return"/"},M.chdir=function(ge){throw new Error("process.chdir is not supported")},M.umask=function(){return 0}},{}],17:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;function M(j){var H=function(ee){var le=ee.dispatch,pe=ee.getState;return function(se){return function(he){return typeof he=="function"?he(le,pe,j):se(he)}}};return H}var k=M();k.withExtraArgument=M;var r=k;P.default=r},{}],18:[function(y,S,P){(function(M){(function(){Object.defineProperty(P,"__esModule",{value:!0});var k=y("@babel/runtime/helpers/objectSpread2");function r(tt){return tt&&typeof tt=="object"&&"default"in tt?tt:{default:tt}}var j=r(k);function H(tt){return"Minified Redux error #"+tt+"; visit https://redux.js.org/Errors?code="+tt+" for the full message or use the non-minified dev environment for full errors. "}var W=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})(),ee=function(){return Math.random().toString(36).substring(7).split("").join(".")},le={INIT:"@@redux/INIT"+ee(),REPLACE:"@@redux/REPLACE"+ee(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+ee()}};function pe(tt){if(typeof tt!="object"||tt===null)return!1;for(var At=tt;Object.getPrototypeOf(At)!==null;)At=Object.getPrototypeOf(At);return Object.getPrototypeOf(tt)===At}function se(tt){if(tt===void 0)return"undefined";if(tt===null)return"null";var At=typeof tt;switch(At){case"boolean":case"string":case"number":case"symbol":case"function":return At}if(Array.isArray(tt))return"array";if(Se(tt))return"date";if(Te(tt))return"error";var yt=he(tt);switch(yt){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return yt}return At.slice(8,-1).toLowerCase().replace(/\s/g,"")}function he(tt){return typeof tt.constructor=="function"?tt.constructor.name:null}function Te(tt){return tt instanceof Error||typeof tt.message=="string"&&tt.constructor&&typeof tt.constructor.stackTraceLimit=="number"}function Se(tt){return tt instanceof Date?!0:typeof tt.toDateString=="function"&&typeof tt.getDate=="function"&&typeof tt.setDate=="function"}function fe(tt){var At=typeof tt;return M.env.NODE_ENV!=="production"&&(At=se(tt)),At}function oe(tt,At,yt){var si;if(typeof At=="function"&&typeof yt=="function"||typeof yt=="function"&&typeof arguments[3]=="function")throw new Error(M.env.NODE_ENV==="production"?H(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof At=="function"&&typeof yt>"u"&&(yt=At,At=void 0),typeof yt<"u"){if(typeof yt!="function")throw new Error(M.env.NODE_ENV==="production"?H(1):"Expected the enhancer to be a function. Instead, received: '"+fe(yt)+"'");return yt(oe)(tt,At)}if(typeof tt!="function")throw new Error(M.env.NODE_ENV==="production"?H(2):"Expected the root reducer to be a function. Instead, received: '"+fe(tt)+"'");var wt=tt,Gi=At,Ti=[],di=Ti,ki=!1;function dn(){di===Ti&&(di=Ti.slice())}function an(){if(ki)throw new Error(M.env.NODE_ENV==="production"?H(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return Gi}function mt(ei){if(typeof ei!="function")throw new Error(M.env.NODE_ENV==="production"?H(4):"Expected the listener to be a function. Instead, received: '"+fe(ei)+"'");if(ki)throw new Error(M.env.NODE_ENV==="production"?H(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var _i=!0;return dn(),di.push(ei),function(){if(_i){if(ki)throw new Error(M.env.NODE_ENV==="production"?H(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");_i=!1,dn();var Qi=di.indexOf(ei);di.splice(Qi,1),Ti=null}}}function Pt(ei){if(!pe(ei))throw new Error(M.env.NODE_ENV==="production"?H(7):"Actions must be plain objects. Instead, the actual type was: '"+fe(ei)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(typeof ei.type>"u")throw new Error(M.env.NODE_ENV==="production"?H(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(ki)throw new Error(M.env.NODE_ENV==="production"?H(9):"Reducers may not dispatch actions.");try{ki=!0,Gi=wt(Gi,ei)}finally{ki=!1}for(var _i=Ti=di,un=0;un<_i.length;un++){var Qi=_i[un];Qi()}return ei}function pi(ei){if(typeof ei!="function")throw new Error(M.env.NODE_ENV==="production"?H(10):"Expected the nextReducer to be a function. Instead, received: '"+fe(ei));wt=ei,Pt({type:le.REPLACE})}function Ui(){var ei,_i=mt;return ei={subscribe:function(Qi){if(typeof Qi!="object"||Qi===null)throw new Error(M.env.NODE_ENV==="production"?H(11):"Expected the observer to be an object. Instead, received: '"+fe(Qi)+"'");function $e(){Qi.next&&Qi.next(an())}$e();var lt=_i($e);return{unsubscribe:lt}}},ei[W]=function(){return this},ei}return Pt({type:le.INIT}),si={dispatch:Pt,subscribe:mt,getState:an,replaceReducer:pi},si[W]=Ui,si}var ge=oe;function Ge(tt){typeof console<"u"&&typeof console.error=="function"&&console.error(tt);try{throw new Error(tt)}catch{}}function xt(tt,At,yt,si){var wt=Object.keys(At),Gi=yt&&yt.type===le.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(wt.length===0)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!pe(tt))return"The "+Gi+' has unexpected type of "'+fe(tt)+'". Expected argument to be an object with the following '+('keys: "'+wt.join('", "')+'"');var Ti=Object.keys(tt).filter(function(di){return!At.hasOwnProperty(di)&&!si[di]});if(Ti.forEach(function(di){si[di]=!0}),!(yt&&yt.type===le.REPLACE)&&Ti.length>0)return"Unexpected "+(Ti.length>1?"keys":"key")+" "+('"'+Ti.join('", "')+'" found in '+Gi+". ")+"Expected to find one of the known reducer keys instead: "+('"'+wt.join('", "')+'". Unexpected keys will be ignored.')}function It(tt){Object.keys(tt).forEach(function(At){var yt=tt[At],si=yt(void 0,{type:le.INIT});if(typeof si>"u")throw new Error(M.env.NODE_ENV==="production"?H(12):'The slice reducer for key "'+At+`" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(typeof yt(void 0,{type:le.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(M.env.NODE_ENV==="production"?H(13):'The slice reducer for key "'+At+'" returned undefined when probed with a random type. '+("Don't try to handle '"+le.INIT+`' or other actions in "redux/*" `)+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")})}function ot(tt){for(var At=Object.keys(tt),yt={},si=0;si<At.length;si++){var wt=At[si];M.env.NODE_ENV!=="production"&&typeof tt[wt]>"u"&&Ge('No reducer provided for key "'+wt+'"'),typeof tt[wt]=="function"&&(yt[wt]=tt[wt])}var Gi=Object.keys(yt),Ti;M.env.NODE_ENV!=="production"&&(Ti={});var di;try{It(yt)}catch(ki){di=ki}return function(dn,an){if(dn===void 0&&(dn={}),di)throw di;if(M.env.NODE_ENV!=="production"){var mt=xt(dn,yt,an,Ti);mt&&Ge(mt)}for(var Pt=!1,pi={},Ui=0;Ui<Gi.length;Ui++){var ei=Gi[Ui],_i=yt[ei],un=dn[ei],Qi=_i(un,an);if(typeof Qi>"u"){var $e=an&&an.type;throw new Error(M.env.NODE_ENV==="production"?H(14):"When called with an action of type "+($e?'"'+String($e)+'"':"(unknown type)")+', the slice reducer for key "'+ei+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}pi[ei]=Qi,Pt=Pt||Qi!==un}return Pt=Pt||Gi.length!==Object.keys(dn).length,Pt?pi:dn}}function Be(tt,At){return function(){return At(tt.apply(this,arguments))}}function De(tt,At){if(typeof tt=="function")return Be(tt,At);if(typeof tt!="object"||tt===null)throw new Error(M.env.NODE_ENV==="production"?H(16):"bindActionCreators expected an object or a function, but instead received: '"+fe(tt)+`'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?`);var yt={};for(var si in tt){var wt=tt[si];typeof wt=="function"&&(yt[si]=Be(wt,At))}return yt}function Oe(){for(var tt=arguments.length,At=new Array(tt),yt=0;yt<tt;yt++)At[yt]=arguments[yt];return At.length===0?function(si){return si}:At.length===1?At[0]:At.reduce(function(si,wt){return function(){return si(wt.apply(void 0,arguments))}})}function He(){for(var tt=arguments.length,At=new Array(tt),yt=0;yt<tt;yt++)At[yt]=arguments[yt];return function(si){return function(){var wt=si.apply(void 0,arguments),Gi=function(){throw new Error(M.env.NODE_ENV==="production"?H(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},Ti={getState:wt.getState,dispatch:function(){return Gi.apply(void 0,arguments)}},di=At.map(function(ki){return ki(Ti)});return Gi=Oe.apply(void 0,di)(wt.dispatch),j.default(j.default({},wt),{},{dispatch:Gi})}}}function ft(){}M.env.NODE_ENV!=="production"&&typeof ft.name=="string"&&ft.name!=="isCrushed"&&Ge('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),P.__DO_NOT_USE__ActionTypes=le,P.applyMiddleware=He,P.bindActionCreators=De,P.combineReducers=ot,P.compose=Oe,P.createStore=oe,P.legacy_createStore=ge}).call(this)}).call(this,y("_process"))},{"@babel/runtime/helpers/objectSpread2":2,_process:16}],19:[function(y,S,P){var M=y("./src/suggestions");S.exports=M,typeof window<"u"&&(window.Suggestions=M)},{"./src/suggestions":21}],20:[function(y,S,P){var M=function(k){return this.component=k,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,k.el.parentNode.insertBefore(this.wrapper,k.el.nextSibling),this};M.prototype.show=function(){this.element.style.display="block"},M.prototype.hide=function(){this.element.style.display="none"},M.prototype.add=function(k){this.items.push(k)},M.prototype.clear=function(){this.items=[],this.active=0},M.prototype.isEmpty=function(){return!this.items.length},M.prototype.isVisible=function(){return this.element.style.display==="block"},M.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var k=0;k<this.items.length;k++)this.drawItem(this.items[k],this.active===k);this.show()},M.prototype.drawItem=function(k,r){var j=document.createElement("li"),H=document.createElement("a");r&&(j.className+=" active"),H.innerHTML=k.string,j.appendChild(H),this.element.appendChild(j),j.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),j.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,k)}).bind(this))},M.prototype.handleMouseUp=function(k){this.selectingListItem=!1,this.component.value(k.original),this.clear(),this.draw()},M.prototype.move=function(k){this.active=k,this.draw()},M.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},M.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},M.prototype.drawError=function(k){var r=document.createElement("li");r.innerHTML=k,this.element.appendChild(r),this.show()},S.exports=M},{}],21:[function(y,S,P){var M=y("xtend"),k=y("fuzzy"),r=y("./list"),j=function(H,W,ee){return ee=ee||{},this.options=M({minLength:2,limit:5,filter:!0,hideOnBlur:!0},ee),this.el=H,this.data=W||[],this.list=new r(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(le){this.handleKeyUp(le.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(le){this.handleKeyDown(le)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(le){this.handlePaste(le)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};j.prototype.handleKeyUp=function(H){H===40||H===38||H===27||H===13||H===9||this.handleInputChange(this.el.value)},j.prototype.handleKeyDown=function(H){switch(H.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&H.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},j.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},j.prototype.handlePaste=function(H){if(H.clipboardData)this.handleInputChange(H.clipboardData.getData("Text"));else{var W=this;setTimeout(function(){W.handleInputChange(H.target.value)},100)}},j.prototype.handleInputChange=function(H){if(this.query=this.normalize(H),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(W){for(var ee=0;ee<W.length&&(this.list.add(W[ee]),ee!==this.options.limit-1);ee++);this.list.draw()}).bind(this))},j.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},j.prototype.update=function(H){this.data=H,this.handleKeyUp()},j.prototype.clear=function(){this.data=[],this.list.clear()},j.prototype.normalize=function(H){return H=H.toLowerCase(),H},j.prototype.match=function(H,W){return H.indexOf(W)>-1},j.prototype.value=function(H){if(this.selected=H,this.el.value=this.getItemValue(H),document.createEvent){var W=document.createEvent("HTMLEvents");W.initEvent("change",!0,!1),this.el.dispatchEvent(W)}else this.el.fireEvent("onchange")},j.prototype.getCandidates=function(H){var W={pre:"<strong>",post:"</strong>",extract:(function(le){return this.getItemValue(le)}).bind(this)},ee;this.options.filter?(ee=k.filter(this.query,this.data,W),ee=ee.map((function(le){return{original:le.original,string:this.render(le.original,le.string)}}).bind(this))):ee=this.data.map((function(le){var pe=this.render(le);return{original:le,string:pe}}).bind(this)),H(ee)},j.prototype.getItemValue=function(H){return H},j.prototype.render=function(H,W){if(W)return W;for(var ee=H.original?this.getItemValue(H.original):this.getItemValue(H),le=this.normalize(ee),pe=le.lastIndexOf(this.query);pe>-1;){var se=pe+this.query.length;ee=ee.slice(0,pe)+"<strong>"+ee.slice(pe,se)+"</strong>"+ee.slice(se),pe=le.slice(0,pe).lastIndexOf(this.query)}return ee},j.prototype.renderError=function(H){this.list.drawError(H)},S.exports=j},{"./list":20,fuzzy:8,xtend:24}],22:[function(y,S,P){var M=y("turf-meta").coordEach;S.exports=function(k){var r=[1/0,1/0,-1/0,-1/0];return M(k,function(j){r[0]>j[0]&&(r[0]=j[0]),r[1]>j[1]&&(r[1]=j[1]),r[2]<j[0]&&(r[2]=j[0]),r[3]<j[1]&&(r[3]=j[1])}),r}},{"turf-meta":23}],23:[function(y,S,P){function M(H,W,ee){var le,pe,se,he,Te,Se,fe,oe,ge=0,Ge,xt=H.type==="FeatureCollection",It=H.type==="Feature",ot=xt?H.features.length:1;for(le=0;le<ot;le++)for(oe=xt?H.features[le].geometry:It?H.geometry:H,Ge=oe.type==="GeometryCollection",Se=Ge?oe.geometries.length:1,he=0;he<Se;he++)if(Te=Ge?oe.geometries[he]:oe,fe=Te.coordinates,ge=ee&&(Te.type==="Polygon"||Te.type==="MultiPolygon")?1:0,Te.type==="Point")W(fe);else if(Te.type==="LineString"||Te.type==="MultiPoint")for(pe=0;pe<fe.length;pe++)W(fe[pe]);else if(Te.type==="Polygon"||Te.type==="MultiLineString")for(pe=0;pe<fe.length;pe++)for(se=0;se<fe[pe].length-ge;se++)W(fe[pe][se]);else if(Te.type==="MultiPolygon")for(pe=0;pe<fe.length;pe++)for(se=0;se<fe[pe].length;se++)for(l=0;l<fe[pe][se].length-ge;l++)W(fe[pe][se][l]);else throw new Error("Unknown Geometry Type")}S.exports.coordEach=M;function k(H,W,ee,le){return M(H,function(pe){ee=W(ee,pe)},le),ee}S.exports.coordReduce=k;function r(H,W){var ee;switch(H.type){case"FeatureCollection":for(features=H.features,ee=0;ee<H.features.length;ee++)W(H.features[ee].properties);break;case"Feature":W(H.properties);break}}S.exports.propEach=r;function j(H,W,ee){return r(H,function(le){ee=W(ee,le)}),ee}S.exports.propReduce=j},{}],24:[function(y,S,P){S.exports=k;var M=Object.prototype.hasOwnProperty;function k(){for(var r={},j=0;j<arguments.length;j++){var H=arguments[j];for(var W in H)M.call(H,W)&&(r[W]=H[W])}return r}},{}],25:[function(y,S,P){function M(mt){"@babel/helpers - typeof";return M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Pt){return typeof Pt}:function(Pt){return Pt&&typeof Symbol=="function"&&Pt.constructor===Symbol&&Pt!==Symbol.prototype?"symbol":typeof Pt},M(mt)}Object.defineProperty(P,"__esModule",{value:!0}),P.addWaypoint=Ti,P.clearDestination=De,P.clearOrigin=Be,P.createDestination=At,P.createOrigin=tt,P.eventEmit=an,P.eventSubscribe=dn,P.hoverMarker=He,P.queryDestination=xt,P.queryDestinationCoordinates=ot,P.queryOrigin=Ge,P.queryOriginCoordinates=It,P.removeWaypoint=ki,P.reverse=si,P.setDestinationFromCoordinates=Gi,P.setOptions=Oe,P.setOriginFromCoordinates=wt,P.setProfile=yt,P.setRouteIndex=ft,P.setWaypoint=di;var k=W(y("../constants/action_types")),r=j(y("../utils"));function j(mt){return mt&&mt.__esModule?mt:{default:mt}}function H(mt){if(typeof WeakMap!="function")return null;var Pt=new WeakMap,pi=new WeakMap;return(H=function(ei){return ei?pi:Pt})(mt)}function W(mt,Pt){if(mt&&mt.__esModule)return mt;if(mt===null||M(mt)!=="object"&&typeof mt!="function")return{default:mt};var pi=H(Pt);if(pi&&pi.has(mt))return pi.get(mt);var Ui={},ei=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _i in mt)if(_i!=="default"&&Object.prototype.hasOwnProperty.call(mt,_i)){var un=ei?Object.getOwnPropertyDescriptor(mt,_i):null;un&&(un.get||un.set)?Object.defineProperty(Ui,_i,un):Ui[_i]=mt[_i]}return Ui.default=mt,pi&&pi.set(mt,Ui),Ui}function ee(mt){return function(Pt){var pi=r.default.createPoint(mt,{id:"origin","marker-symbol":"A"});Pt({type:k.ORIGIN,origin:pi}),Pt(an("origin",{feature:pi}))}}function le(mt){return function(Pt){var pi=r.default.createPoint(mt,{id:"destination","marker-symbol":"B"});Pt({type:k.DESTINATION,destination:pi}),Pt(an("destination",{feature:pi}))}}function pe(mt){return function(Pt){Pt({type:k.DIRECTIONS_REQUEST_START,request:mt})}}function se(mt){return function(Pt){Pt({type:k.DIRECTIONS,directions:mt}),Pt(an("route",{route:mt}))}}function he(mt){return{type:k.WAYPOINTS,waypoints:mt}}function Te(mt){return{type:k.HOVER_MARKER,hoverMarker:mt}}function Se(){return function(mt,Pt){var pi=Pt(),Ui=pi.api,ei=pi.accessToken,_i=pi.routeIndex,un=pi.profile,Qi=pi.alternatives,$e=pi.congestion,lt=pi.destination,vt=pi.language,ai=pi.exclude,ii=pi.fetchDirectionsRequest;if(lt&&lt.geometry){ii&&ii.abort();var ci=fe(Pt),Ei=[];Ei.push("geometries=polyline"),Qi&&Ei.push("alternatives=true"),$e&&Ei.push("annotations=congestion"),Ei.push("steps=true"),Ei.push("overview=full"),vt&&Ei.push("language="+vt),ai&&Ei.push("exclude="+ai),ei&&Ei.push("access_token="+ei);var bi=new XMLHttpRequest;bi.open("GET","".concat(Ui).concat(un,"/").concat(ci,".json?").concat(Ei.join("&")),!0),mt(pe(bi)),bi.onload=function(){if(bi.status>=200&&bi.status<400){var ui=JSON.parse(bi.responseText);if(ui.error)return mt(se([])),mt(ge(ui.error));if(ui.message==="No route found")return mt(ge("No route found"));mt(ge(null)),ui.routes[_i]||mt(ft(0)),mt(se(ui.routes)),mt(ee(ui.waypoints[0].location)),mt(le(ui.waypoints[ui.waypoints.length-1].location))}else return mt(se([])),mt(ge(JSON.parse(bi.responseText).message))},bi.onerror=function(){return mt(se([])),bi.responseText?mt(ge(JSON.parse(bi.responseText).message)):mt(ge("Error"))},bi.send()}}}function fe(mt){var Pt=mt(),pi=Pt.origin,Ui=Pt.destination,ei=Pt.waypoints,_i=[];return _i.push(pi.geometry.coordinates.join(",")),_i.push(";"),ei.length&&ei.forEach(function(un){_i.push(un.geometry.coordinates.join(",")),_i.push(";")}),_i.push(Ui.geometry.coordinates.join(",")),encodeURIComponent(_i.join(""))}function oe(mt){var Pt={id:"waypoint"};return Object.assign(mt,{properties:mt.properties?Object.assign(mt.properties,Pt):Pt})}function ge(mt){return function(Pt){Pt({type:"ERROR",error:mt}),mt&&Pt(an("error",{error:mt}))}}function Ge(mt){return{type:k.ORIGIN_QUERY,query:mt}}function xt(mt){return{type:k.DESTINATION_QUERY,query:mt}}function It(mt){return{type:k.ORIGIN_FROM_COORDINATES,coordinates:mt}}function ot(mt){return{type:k.DESTINATION_FROM_COORDINATES,coordinates:mt}}function Be(){return function(mt){mt({type:k.ORIGIN_CLEAR}),mt(an("clear",{type:"origin"})),mt(ge(null))}}function De(){return function(mt,Pt){var pi=Pt(),Ui=pi.fetchDirectionsRequest;Ui&&Ui.abort(),mt({type:k.DESTINATION_CLEAR}),mt(an("clear",{type:"destination"})),mt(ge(null))}}function Oe(mt){return{type:k.SET_OPTIONS,options:mt}}function He(mt){return function(Pt){var pi=mt?r.default.createPoint(mt,{id:"hover"}):{};Pt(Te(pi))}}function ft(mt){return{type:k.ROUTE_INDEX,routeIndex:mt}}function tt(mt){return function(Pt,pi){var Ui=pi(),ei=Ui.destination;Pt(ee(mt)),ei.geometry&&Pt(Se())}}function At(mt){return function(Pt,pi){var Ui=pi(),ei=Ui.origin;Pt(le(mt)),ei.geometry&&Pt(Se())}}function yt(mt){return function(Pt,pi){var Ui=pi(),ei=Ui.origin,_i=Ui.destination;Pt({type:k.DIRECTIONS_PROFILE,profile:mt}),Pt(an("profile",{profile:mt})),ei.geometry&&_i.geometry&&Pt(Se())}}function si(){return function(mt,Pt){var pi=Pt();pi.destination.geometry&&mt(ee(pi.destination.geometry.coordinates)),pi.origin.geometry&&mt(le(pi.origin.geometry.coordinates)),pi.origin.geometry&&pi.destination.geometry&&mt(Se());for(var Ui=document.getElementsByClassName("suggestions"),ei=0;ei<Ui.length;ei++)Ui[ei].style.visibility="hidden"}}function wt(mt){return function(Pt){if(r.default.validCoords(mt)||(mt=[r.default.wrap(mt[0]),r.default.wrap(mt[1])]),isNaN(mt[0])&&isNaN(mt[1]))return Pt(ge(new Error("Coordinates are not valid")));Pt(It(mt)),Pt(tt(mt))}}function Gi(mt){return function(Pt){if(r.default.validCoords(mt)||(mt=[r.default.wrap(mt[0]),r.default.wrap(mt[1])]),isNaN(mt[0])&&isNaN(mt[1]))return Pt(ge(new Error("Coordinates are not valid")));Pt(At(mt)),Pt(ot(mt))}}function Ti(mt,Pt){return function(pi,Ui){var ei=Ui(),_i=ei.destination,un=ei.waypoints;un.splice(mt,0,oe(Pt)),pi(he(un)),_i.geometry&&pi(Se())}}function di(mt,Pt){return function(pi,Ui){var ei=Ui(),_i=ei.destination,un=ei.waypoints;un[mt]=oe(Pt),pi(he(un)),_i.geometry&&pi(Se())}}function ki(mt){return function(Pt,pi){var Ui=pi(),ei=Ui.destination,_i=Ui.waypoints;_i=_i.filter(function(un){return!r.default.coordinateMatch(un,mt)}),Pt(he(_i)),ei.geometry&&Pt(Se())}}function dn(mt,Pt){return function(pi,Ui){var ei=Ui(),_i=ei.events;return _i[mt]=_i[mt]||[],_i[mt].push(Pt),{type:k.EVENTS,events:_i}}}function an(mt,Pt){var pi=this;return function(Ui,ei){var _i=ei(),un=_i.events;if(!un[mt])return{type:k.EVENTS,events:un};for(var Qi=un[mt].slice(),$e=0;$e<Qi.length;$e++)Qi[$e].call(pi,Pt)}}},{"../constants/action_types":26,"../utils":34}],26:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.WAYPOINTS=P.SET_OPTIONS=P.ROUTE_INDEX=P.ORIGIN_QUERY=P.ORIGIN_FROM_COORDINATES=P.ORIGIN_CLEAR=P.ORIGIN=P.HOVER_MARKER=P.EVENTS=P.ERROR=P.DIRECTIONS_REQUEST_START=P.DIRECTIONS_PROFILE=P.DIRECTIONS=P.DESTINATION_QUERY=P.DESTINATION_FROM_COORDINATES=P.DESTINATION_CLEAR=P.DESTINATION=void 0;var M="DESTINATION";P.DESTINATION=M;var k="DESTINATION_CLEAR";P.DESTINATION_CLEAR=k;var r="DESTINATION_QUERY";P.DESTINATION_QUERY=r;var j="DESTINATION_FROM_COORDINATES";P.DESTINATION_FROM_COORDINATES=j;var H="DIRECTIONS";P.DIRECTIONS=H;var W="DIRECTIONS_REQUEST_START";P.DIRECTIONS_REQUEST_START=W;var ee="DIRECTIONS_PROFILE";P.DIRECTIONS_PROFILE=ee;var le="EVENTS";P.EVENTS=le;var pe="ERROR";P.ERROR=pe;var se="HOVER_MARKER";P.HOVER_MARKER=se;var he="ORIGIN";P.ORIGIN=he;var Te="ORIGIN_CLEAR";P.ORIGIN_CLEAR=Te;var Se="ORIGIN_QUERY";P.ORIGIN_QUERY=Se;var fe="ORIGIN_FROM_COORDINATES";P.ORIGIN_FROM_COORDINATES=fe;var oe="ROUTE_INDEX";P.ROUTE_INDEX=oe;var ge="SET_OPTIONS";P.SET_OPTIONS=ge;var Ge="WAYPOINTS";P.WAYPOINTS=Ge},{}],27:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var M=H(y("suggestions")),k=H(y("lodash.debounce")),r=y("events"),j=H(y("../utils"));function H(Se){return Se&&Se.__esModule?Se:{default:Se}}function W(Se){"@babel/helpers - typeof";return W=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(fe){return typeof fe}:function(fe){return fe&&typeof Symbol=="function"&&fe.constructor===Symbol&&fe!==Symbol.prototype?"symbol":typeof fe},W(Se)}function ee(Se,fe){if(!(Se instanceof fe))throw new TypeError("Cannot call a class as a function")}function le(Se,fe){for(var oe=0;oe<fe.length;oe++){var ge=fe[oe];ge.enumerable=ge.enumerable||!1,ge.configurable=!0,"value"in ge&&(ge.writable=!0),Object.defineProperty(Se,se(ge.key),ge)}}function pe(Se,fe,oe){return fe&&le(Se.prototype,fe),Object.defineProperty(Se,"prototype",{writable:!1}),Se}function se(Se){var fe=he(Se,"string");return W(fe)==="symbol"?fe:String(fe)}function he(Se,fe){if(W(Se)!=="object"||Se===null)return Se;var oe=Se[Symbol.toPrimitive];if(oe!==void 0){var ge=oe.call(Se,fe);if(W(ge)!=="object")return ge;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Se)}var Te=(function(){function Se(fe){ee(this,Se),this._ev=new r.EventEmitter,this.options=fe,this.api=fe&&fe.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return pe(Se,[{key:"onAdd",value:function(oe){this._map=oe,this.request=new XMLHttpRequest;var ge=document.createElement("div");ge.className="mapboxgl-ctrl-geocoder";var Ge=document.createElement("span");Ge.className="geocoder-icon geocoder-icon-search";var xt=this._inputEl=document.createElement("input");xt.type="text",xt.placeholder=this.options.placeholder,xt.addEventListener("keydown",(0,k.default)((function(De){if(!De.target.value)return this._clearEl.classList.remove("active");De.metaKey||[9,27,37,39,13,38,40].indexOf(De.keyCode)!==-1||this._queryFromInput(De.target.value)}).bind(this)),200),xt.addEventListener("change",(function(De){De.target.value&&this._clearEl.classList.add("active");var Oe=this._typeahead.selected;if(Oe){if(this.options.flyTo)if(Oe.bbox&&Oe.context&&Oe.context.length<=3||Oe.bbox&&!Oe.context){var He=Oe.bbox;oe.fitBounds([[He[0],He[1]],[He[2],He[3]]])}else oe.flyTo({center:Oe.center,zoom:this.options.zoom});this._input=Oe,this.fire("result",{result:Oe})}}).bind(this));var It=document.createElement("div");It.classList.add("geocoder-pin-right");var ot=this._clearEl=document.createElement("button");ot.className="geocoder-icon geocoder-icon-close",ot.addEventListener("click",this._clear.bind(this));var Be=this._loadingEl=document.createElement("span");return Be.className="geocoder-icon geocoder-icon-loading",It.appendChild(ot),It.appendChild(Be),ge.appendChild(Ge),ge.appendChild(xt),ge.appendChild(It),this.options.container&&(this.options.position=!1),this._typeahead=new M.default(xt,[],{filter:!1}),this._typeahead.getItemValue=function(De){return De.place_name},ge}},{key:"_geocode",value:function(oe,ge){this._loadingEl.classList.add("active"),this.fire("loading");var Ge=this.options,xt=["placeholder","zoom","flyTo","accessToken","api"],It=Object.keys(this.options).filter(function(Be){return xt.indexOf(Be)===-1}).map(function(Be){return Be+"="+Ge[Be]}),ot=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;It.push("access_token="+ot),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(oe.trim())+".json?"+It.join("&"),!0),this.request.onload=(function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var Be=JSON.parse(this.request.responseText);return Be.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:Be.features}),this._typeahead.update(Be.features),ge(Be.features)}else this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.onerror=(function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.send()}},{key:"_queryFromInput",value:function(oe){oe=oe.trim(),oe||this._clear(),oe.length>2&&this._geocode(oe,(function(ge){this._results=ge}).bind(this))}},{key:"_change",value:function(){var oe=document.createEvent("HTMLEvents");oe.initEvent("change",!0,!1),this._inputEl.dispatchEvent(oe)}},{key:"_query",value:function(oe){oe&&(W(oe)==="object"&&oe.length&&(oe=[j.default.wrap(oe[0]),j.default.wrap(oe[1])].join()),this._geocode(oe,(function(ge){if(ge.length){var Ge=ge[0];this._results=ge,this._typeahead.selected=Ge,this._inputEl.value=Ge.place_name,this._change()}}).bind(this)))}},{key:"_setInput",value:function(oe){oe&&(W(oe)==="object"&&oe.length&&(oe=[j.default.roundWithOriginalPrecision(j.default.wrap(oe[0]),oe[0]),j.default.roundWithOriginalPrecision(j.default.wrap(oe[1]),oe[1])].join()),this._inputEl.value=oe,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(oe){return this._query(oe),this}},{key:"setInput",value:function(oe){return this._setInput(oe),this}},{key:"on",value:function(oe,ge){return this._ev.on(oe,ge),this._ev.on("error",function(Ge){console.log(Ge)}),this}},{key:"fire",value:function(oe,ge){return this._ev.emit(oe,ge),this}},{key:"off",value:function(oe,ge){return this._ev.removeListener(oe,ge),this}}]),Se})();P.default=Te},{"../utils":34,events:7,"lodash.debounce":10,suggestions:19}],28:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var M=H(y("./geocoder")),k=H(y("lodash.template")),r=H(y("lodash.isequal")),j=H(y("turf-extent"));function H(fe){return fe&&fe.__esModule?fe:{default:fe}}function W(fe){"@babel/helpers - typeof";return W=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe},W(fe)}function ee(fe,oe){if(!(fe instanceof oe))throw new TypeError("Cannot call a class as a function")}function le(fe,oe){for(var ge=0;ge<oe.length;ge++){var Ge=oe[ge];Ge.enumerable=Ge.enumerable||!1,Ge.configurable=!0,"value"in Ge&&(Ge.writable=!0),Object.defineProperty(fe,se(Ge.key),Ge)}}function pe(fe,oe,ge){return oe&&le(fe.prototype,oe),Object.defineProperty(fe,"prototype",{writable:!1}),fe}function se(fe){var oe=he(fe,"string");return W(oe)==="symbol"?oe:String(oe)}function he(fe,oe){if(W(fe)!=="object"||fe===null)return fe;var ge=fe[Symbol.toPrimitive];if(ge!==void 0){var Ge=ge.call(fe,oe);if(W(Ge)!=="object")return Ge;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(fe)}var Te=(0,k.default)(`<div class='mapbox-directions-component mapbox-directions-inputs'>
  <div class='mapbox-directions-component-keyline'>
    <div class='mapbox-directions-origin'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-depart'></span>
      </label>
      <div id='mapbox-directions-origin-input'></div>
    </div>

    <button
      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'
      title='Reverse origin &amp; destination'>
    </button>

    <div class='mapbox-directions-destination'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-arrive'></span>
      </label>
      <div id='mapbox-directions-destination-input'></div>
    </div>
  </div>

  <% if (controls.profileSwitcher) { %>
  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input
      id='mapbox-directions-profile-driving-traffic'
      type='radio'
      name='profile'
      value='mapbox/driving-traffic'
      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>
    <input
      id='mapbox-directions-profile-driving'
      type='radio'
      name='profile'
      value='mapbox/driving'
      <% if (profile === 'mapbox/driving') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving'>Driving</label>
    <input
      id='mapbox-directions-profile-walking'
      type='radio'
      name='profile'
      value='mapbox/walking'
      <% if (profile === 'mapbox/walking') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-walking'>Walking</label>
    <input
      id='mapbox-directions-profile-cycling'
      type='radio'
      name='profile'
      value='mapbox/cycling'
      <% if (profile === 'mapbox/cycling') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-cycling'>Cycling</label>
  </div>
  <% } %>
</div>
`),Se=(function(){function fe(oe,ge,Ge,xt){ee(this,fe);var It=ge.getState(),ot=It.originQuery,Be=It.destinationQuery,De=It.profile,Oe=It.controls;oe.innerHTML=Te({originQuery:ot,destinationQuery:Be,profile:De,controls:Oe}),this.container=oe,this.actions=Ge,this.store=ge,this._map=xt,this.onAdd(),this.render()}return pe(fe,[{key:"animateToCoordinates",value:function(ge,Ge){var xt=this.store.getState(),It=xt.origin,ot=xt.destination,Be=xt.routePadding;if(It.geometry&&ot.geometry&&!(0,r.default)(It.geometry,ot.geometry)){var De=(0,j.default)({type:"FeatureCollection",features:[It,ot]});this._map.fitBounds([[De[0],De[1]],[De[2],De[3]]],{padding:Be})}else this._map.flyTo({center:Ge})}},{key:"onAdd",value:function(){var ge=this,Ge=this.actions,xt=Ge.clearOrigin,It=Ge.clearDestination,ot=Ge.createOrigin,Be=Ge.createDestination,De=Ge.setProfile,Oe=Ge.reverse,He=this.store.getState(),ft=He.geocoder,tt=He.accessToken,At=He.flyTo,yt=He.placeholderOrigin,si=He.placeholderDestination,wt=He.zoom;this.originInput=new M.default(Object.assign({},{accessToken:tt},ft,{flyTo:At,placeholder:yt,zoom:wt}));var Gi=this.originInput.onAdd(this._map),Ti=this.container.querySelector("#mapbox-directions-origin-input");Ti.appendChild(Gi),this.destinationInput=new M.default(Object.assign({},{accessToken:tt},ft,{flyTo:At,placeholder:si,zoom:wt}));var di=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(di),this.originInput.on("result",function(dn){var an=dn.result.center;ot(an),ge.animateToCoordinates("origin",an)}),this.originInput.on("clear",xt),this.destinationInput.on("result",function(dn){var an=dn.result.center;Be(an),ge.animateToCoordinates("destination",an)}),this.destinationInput.on("clear",It);var ki=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(ki,function(dn){dn.addEventListener("change",function(){De(dn.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var dn=ge.store.getState(),an=dn.origin,mt=dn.destination;an&&ge.actions.queryDestination(an.geometry.coordinates),mt&&ge.actions.queryOrigin(mt.geometry.coordinates),Oe()})}},{key:"render",value:function(){var ge=this;this.store.subscribe(function(){var Ge=ge.store.getState(),xt=Ge.originQuery,It=Ge.destinationQuery,ot=Ge.originQueryCoordinates,Be=Ge.destinationQueryCoordinates;xt&&(ge.originInput.query(xt),ge.actions.queryOrigin(null)),It&&(ge.destinationInput.query(It),ge.actions.queryDestination(null)),ot&&(ge.originInput.setInput(ot),ge.animateToCoordinates("origin",ot),ge.actions.queryOriginCoordinates(null)),Be&&(ge.destinationInput.setInput(Be),ge.animateToCoordinates("destination",Be),ge.actions.queryDestinationCoordinates(null))})}}]),fe})();P.default=Se},{"./geocoder":27,"lodash.isequal":11,"lodash.template":12,"turf-extent":22}],29:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var M=j(y("../utils")),k=j(y("lodash.template")),r=j(y("lodash.isequal"));function j(fe){return fe&&fe.__esModule?fe:{default:fe}}function H(fe){"@babel/helpers - typeof";return H=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe},H(fe)}function W(fe,oe){if(!(fe instanceof oe))throw new TypeError("Cannot call a class as a function")}function ee(fe,oe){for(var ge=0;ge<oe.length;ge++){var Ge=oe[ge];Ge.enumerable=Ge.enumerable||!1,Ge.configurable=!0,"value"in Ge&&(Ge.writable=!0),Object.defineProperty(fe,pe(Ge.key),Ge)}}function le(fe,oe,ge){return oe&&ee(fe.prototype,oe),Object.defineProperty(fe,"prototype",{writable:!1}),fe}function pe(fe){var oe=se(fe,"string");return H(oe)==="symbol"?oe:String(oe)}function se(fe,oe){if(H(fe)!=="object"||fe===null)return fe;var ge=fe[Symbol.toPrimitive];if(ge!==void 0){var Ge=ge.call(fe,oe);if(H(Ge)!=="object")return Ge;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(fe)}var he=(0,k.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>
    <% if (routes > 1) { %>
    <div class='mapbox-directions-routes mapbox-directions-clearfix'>
      <% for (var i = 0; i < routes; i++) { %>
        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>
        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>
      <% } %>
    </div>
    <% } %>
    <h1><%- duration %></h1>
    <span><%- distance %></span>
  </div>

  <div class='mapbox-directions-instructions'>
    <div class='mapbox-directions-instructions-wrapper'>
      <ol class='mapbox-directions-steps'>
        <% steps.forEach(function(step) { %>
          <%
            var distance = step.distance ? format(step.distance) : false;
            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();

            if (['arrive', 'depart', 'waypoint'].includes(step.maneuver.type)) {
              icon = step.maneuver.type;
            }

            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {
              icon = 'roundabout';
            }

            var lng = step.maneuver.location[0];
            var lat = step.maneuver.location[1];
          %>
          <li
            data-lat='<%= lat %>'
            data-lng='<%= lng %>'
            class='mapbox-directions-step'>
            <span class='directions-icon directions-icon-<%= icon %>'></span>
            <div class='mapbox-directions-step-maneuver'>
              <%= step.maneuver.instruction %>
            </div>
            <% if (distance) { %>
              <div class='mapbox-directions-step-distance'>
                <%= distance %>
              </div>
            <% } %>
          </li>
        <% }); %>
      </ol>
    </div>
  </div>
</div>
`),Te=(0,k.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-error'>
    <%= error %>
  </div>
</div>
`),Se=(function(){function fe(oe,ge,Ge,xt){W(this,fe),this.container=oe,this.actions=Ge,this.store=ge,this._map=xt,this.directions={},this.render()}return le(fe,[{key:"render",value:function(){var ge=this;this.store.subscribe(function(){var Ge=ge.actions,xt=Ge.hoverMarker,It=Ge.setRouteIndex,ot=ge.store.getState(),Be=ot.routeIndex,De=ot.unit,Oe=ot.directions,He=ot.error,ft=ot.compile,tt=ot.instructions,At=!(0,r.default)(Oe[Be],ge.directions);if(He){ge.container.innerHTML=Te({error:He});return}var yt=tt.showWaypointInstructions?void 0:function(di){return di.maneuver.type!=="waypoint"};if(Oe.length&&At){var si=ge.directions=Oe[Be],wt=M.default.getAllSteps(si,yt);ft&&si.legs.forEach(function(di){di.steps.forEach(function(ki){ki.maneuver.instruction=ft("en",ki)})}),ge.container.innerHTML=he({routeIndex:Be,routes:Oe.length,steps:wt,format:M.default.format[De],duration:M.default.format.duration(si.duration),distance:M.default.format[De](si.distance)});var Gi=ge.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(Gi,function(di){var ki=di.getAttribute("data-lng"),dn=di.getAttribute("data-lat");di.addEventListener("mouseover",function(){xt([ki,dn])}),di.addEventListener("mouseout",function(){xt(null)}),di.addEventListener("click",function(){ge._map.flyTo({center:[ki,dn],zoom:16})})});var Ti=ge.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Ti,function(di){di.addEventListener("change",function(ki){It(parseInt(ki.target.id,10))})})}else ge.container.innerHTML&&At&&(ge.container.innerHTML="")})}}]),fe})();P.default=Se},{"../utils":34,"lodash.isequal":11,"lodash.template":12}],30:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var M=y("redux"),k=Te(y("redux-thunk")),r=y("@mapbox/polyline"),j=Te(y("./utils")),H=Te(y("./reducers")),W=he(y("./actions")),ee=Te(y("./directions_style")),le=Te(y("./controls/inputs")),pe=Te(y("./controls/instructions"));function se(ot){if(typeof WeakMap!="function")return null;var Be=new WeakMap,De=new WeakMap;return(se=function(He){return He?De:Be})(ot)}function he(ot,Be){if(ot&&ot.__esModule)return ot;if(ot===null||Se(ot)!=="object"&&typeof ot!="function")return{default:ot};var De=se(Be);if(De&&De.has(ot))return De.get(ot);var Oe={},He=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ft in ot)if(ft!=="default"&&Object.prototype.hasOwnProperty.call(ot,ft)){var tt=He?Object.getOwnPropertyDescriptor(ot,ft):null;tt&&(tt.get||tt.set)?Object.defineProperty(Oe,ft,tt):Oe[ft]=ot[ft]}return Oe.default=ot,De&&De.set(ot,Oe),Oe}function Te(ot){return ot&&ot.__esModule?ot:{default:ot}}function Se(ot){"@babel/helpers - typeof";return Se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Be){return typeof Be}:function(Be){return Be&&typeof Symbol=="function"&&Be.constructor===Symbol&&Be!==Symbol.prototype?"symbol":typeof Be},Se(ot)}function fe(ot,Be){if(!(ot instanceof Be))throw new TypeError("Cannot call a class as a function")}function oe(ot,Be){for(var De=0;De<Be.length;De++){var Oe=Be[De];Oe.enumerable=Oe.enumerable||!1,Oe.configurable=!0,"value"in Oe&&(Oe.writable=!0),Object.defineProperty(ot,Ge(Oe.key),Oe)}}function ge(ot,Be,De){return Be&&oe(ot.prototype,Be),Object.defineProperty(ot,"prototype",{writable:!1}),ot}function Ge(ot){var Be=xt(ot,"string");return Se(Be)==="symbol"?Be:String(Be)}function xt(ot,Be){if(Se(ot)!=="object"||ot===null)return ot;var De=ot[Symbol.toPrimitive];if(De!==void 0){var Oe=De.call(ot,Be);if(Se(Oe)!=="object")return Oe;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ot)}var It=(function(){function ot(Be){fe(this,ot),this._directions=null,this._stateSnapshot=null,this._store=this._initStore(),this.actions=(0,M.bindActionCreators)(W,this._store.dispatch),this.actions.setOptions(Be||{}),this.options=Be||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return ge(ot,[{key:"onAdd",value:function(De){var Oe=this;this._map=De;var He=this._store.getState(),ft=He.controls,tt=this.container=document.createElement("div");tt.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var At=document.createElement("div");At.className="directions-control directions-control-inputs",new le.default(At,this._store,this.actions,this._map);var yt=document.createElement("div");return yt.className="directions-control directions-control-instructions",new pe.default(yt,this._store,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),ft.inputs&&tt.appendChild(At),ft.instructions&&tt.appendChild(yt),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return Oe.mapState()}),tt}},{key:"onRemove",value:function(De){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),De.off("mousedown",this.onDragDown),De.off("mousemove",this.move),De.off("touchstart",this.onDragDown),De.off("touchstart",this.move),De.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),ee.default.forEach(function(Oe){De.getLayer(Oe.id)&&De.removeLayer(Oe.id)}),De.getSource("directions")&&De.removeSource("directions"),De.getSource("directions:markers")&&De.removeSource("directions:markers"),this._map=null,this}},{key:"mapState",value:function(){var De=this,Oe=this._store.getState(),He=Oe.profile;Oe.alternatives,Oe.congestion;var ft=Oe.styles,tt=Oe.interactive;Oe.compile,this.actions.eventEmit("profile",{profile:He});var At={type:"geojson",data:{type:"FeatureCollection",features:[]}};this._map.addSource("directions",At),this._map.addSource("directions:markers",At),ft&&ft.length&&ft.forEach(function(yt){return De._map.addLayer(yt)}),ee.default.forEach(function(yt){De._map.getLayer(yt.id)||De._map.addLayer(yt)}),tt&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"_areMarkersChangedOnly",value:function(De){var Oe=this,He=[];return this._stateSnapshot?(ot.SUBSCRIPTION_FIELDS.forEach(function(ft){Oe._stateSnapshot[ft]!==De[ft]&&He.push(ft)}),He.length<=ot.MARKER_FIELDS.length&&He.every(function(ft){return ot.MARKER_FIELDS.includes(ft)})):!1}},{key:"subscribedActions",value:function(){var De=this;this.storeUnsubscribe=this._store.subscribe(function(){var Oe=De._store.getState(),He=Oe.origin,ft=Oe.destination,tt=Oe.hoverMarker,At=Oe.directions,yt=Oe.routeIndex,si=De._areMarkersChangedOnly(Oe);De._stateSnapshot=Oe;var wt={type:"FeatureCollection",features:[He,ft,tt].filter(function(Ti){return Ti.geometry})};if(De._map.style&&De._map.getSource("directions:markers")&&De._map.getSource("directions:markers").setData(wt),!si){var Gi={type:"FeatureCollection",features:[]};At.length&&At.forEach(function(Ti,di){var ki=[],dn=(0,r.decode)(Ti.geometry,5).map(function(mt){return mt.reverse()}),an=j.default.getAllSteps(Ti);dn.forEach(function(mt,Pt){var pi=ki[ki.length-1],Ui=Ti.legs[0].annotation&&Ti.legs[0].annotation.congestion&&Ti.legs[0].annotation.congestion[Pt-1];if(pi&&(!Ui||pi.properties.congestion===Ui))pi.geometry.coordinates.push(mt);else{var ei={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":di,route:di===yt?"selected":"alternate"}};pi&&ei.geometry.coordinates.push(pi.geometry.coordinates[pi.geometry.coordinates.length-1]),ei.geometry.coordinates.push(mt),Ui&&(ei.properties.congestion=Ti.legs[0].annotation.congestion[Pt-1]),ki.push(ei)}}),Gi.features=Gi.features.concat(ki),di===yt&&an.forEach(function(mt){mt.maneuver.type==="waypoint"&&Gi.features.push({type:"Feature",geometry:{type:"Point",coordinates:mt.maneuver.location},properties:{id:"waypoint"}})})}),De._map.style&&De._map.getSource("directions")&&De._map.getSource("directions").setData(Gi)}})}},{key:"_initStore",value:function(){var De=(0,M.applyMiddleware)(k.default)(M.createStore);return De(H.default)}},{key:"_clickHandler",value:function(){var De=null,Oe=250;return function(He){if(De)clearTimeout(De),De=null,this._map.zoomIn();else{var ft=this._onSingleClick.bind(this);De=setTimeout(function(){ft(He),De=null},Oe)}}}},{key:"_onSingleClick",value:function(De){var Oe=this,He=this._store.getState(),ft=He.origin,tt=[De.lngLat.lng,De.lngLat.lat];if(!ft.geometry)this.actions.setOriginFromCoordinates(tt);else{var At=this._map.queryRenderedFeatures(De.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});if(At.length){if(At.forEach(function(si){si.layer.id==="directions-waypoint-point"&&Oe.actions.removeWaypoint(si)}),At[0].properties.route==="alternate"){var yt=At[0].properties["route-index"];this.actions.setRouteIndex(yt)}}else this.actions.setDestinationFromCoordinates(tt),this._map.flyTo({center:tt})}}},{key:"_move",value:function(De){var Oe=this,He=this._store.getState(),ft=He.hoverMarker,tt=this._map.queryRenderedFeatures(De.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=tt.length?"pointer":"",tt.length?(this.isCursorOverPoint=tt[0],this._map.dragPan.disable(),tt.forEach(function(At){At.layer.id==="directions-route-line"?Oe.actions.hoverMarker([De.lngLat.lng,De.lngLat.lat]):ft.geometry&&Oe.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){this.isCursorOverPoint&&(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(De){if(this.isDragging){var Oe=[De.lngLat.lng,De.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(Oe);break;case"directions-destination-point":this.actions.createDestination(Oe);break;case"directions-hover-point":this.actions.hoverMarker(Oe);break}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var De=this._store.getState(),Oe=De.hoverMarker,He=De.origin,ft=De.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(He.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(ft.geometry.coordinates);break;case"directions-hover-point":Oe.geometry&&!j.default.coordinateMatch(this.isDragging,Oe)&&this.actions.addWaypoint(0,Oe);break}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(De){return De?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return this._store.getState().origin}},{key:"setOrigin",value:function(De){return typeof De=="string"?this.actions.queryOrigin(De):this.actions.setOriginFromCoordinates(De),this}},{key:"getDestination",value:function(){return this._store.getState().destination}},{key:"setDestination",value:function(De){return typeof De=="string"?this.actions.queryDestination(De):this.actions.setDestinationFromCoordinates(De),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(De,Oe){return Oe.type||(Oe=j.default.createPoint(Oe,{id:"waypoint"})),this.actions.addWaypoint(De,Oe),this}},{key:"setWaypoint",value:function(De,Oe){return Oe.type||(Oe=j.default.createPoint(Oe,{id:"waypoint"})),this.actions.setWaypoint(De,Oe),this}},{key:"removeWaypoint",value:function(De){var Oe=this._store.getState(),He=Oe.waypoints;return this.actions.removeWaypoint(He[De]),this}},{key:"getWaypoints",value:function(){return this._store.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(De,Oe){return this.actions.eventSubscribe(De,Oe),this}}]),ot})();P.default=It,It.MARKER_FIELDS=["origin","destination","hoverMarker"],It.SUBSCRIPTION_FIELDS=["origin","destination","hovedMarker","directions","routeIndex"]},{"./actions":25,"./controls/inputs":28,"./controls/instructions":29,"./directions_style":31,"./reducers":33,"./utils":34,"@mapbox/polyline":6,redux:18,"redux-thunk":17}],31:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var M=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions:markers",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions:markers",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}],k=M;P.default=k},{}],32:[function(y,S,P){var M=k(y("./directions"));function k(r){return r&&r.__esModule?r:{default:r}}S.exports=M.default},{"./directions":30}],33:[function(y,S,P){function M(se){"@babel/helpers - typeof";return M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(he){return typeof he}:function(he){return he&&typeof Symbol=="function"&&he.constructor===Symbol&&he!==Symbol.prototype?"symbol":typeof he},M(se)}Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;var k=W(y("../constants/action_types.js")),r=j(y("merge-options"));function j(se){return se&&se.__esModule?se:{default:se}}function H(se){if(typeof WeakMap!="function")return null;var he=new WeakMap,Te=new WeakMap;return(H=function(fe){return fe?Te:he})(se)}function W(se,he){if(se&&se.__esModule)return se;if(se===null||M(se)!=="object"&&typeof se!="function")return{default:se};var Te=H(he);if(Te&&Te.has(se))return Te.get(se);var Se={},fe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var oe in se)if(oe!=="default"&&Object.prototype.hasOwnProperty.call(se,oe)){var ge=fe?Object.getOwnPropertyDescriptor(se,oe):null;ge&&(ge.get||ge.set)?Object.defineProperty(Se,oe,ge):Se[oe]=se[oe]}return Se.default=se,Te&&Te.set(se,Se),Se}var ee=function(){return{api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},instructions:{showWaypointInstructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],fetchDirectionsRequest:null,routeIndex:0,routePadding:80}};function le(){var se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ee(),he=arguments.length>1?arguments[1]:void 0;switch(he.type){case k.SET_OPTIONS:return(0,r.default)({},se,he.options);case k.DIRECTIONS_PROFILE:return Object.assign({},se,{profile:he.profile});case k.ORIGIN:return Object.assign({},se,{origin:he.origin,hoverMarker:{}});case k.DESTINATION:return Object.assign({},se,{destination:he.destination,hoverMarker:{}});case k.HOVER_MARKER:return Object.assign({},se,{hoverMarker:he.hoverMarker});case k.WAYPOINTS:return Object.assign({},se,{waypoints:he.waypoints});case k.ORIGIN_QUERY:return Object.assign({},se,{originQuery:he.query});case k.DESTINATION_QUERY:return Object.assign({},se,{destinationQuery:he.query});case k.ORIGIN_FROM_COORDINATES:return Object.assign({},se,{originQueryCoordinates:he.coordinates});case k.DESTINATION_FROM_COORDINATES:return Object.assign({},se,{destinationQueryCoordinates:he.coordinates});case k.ORIGIN_CLEAR:return Object.assign({},se,{origin:{},originQuery:"",waypoints:[],directions:[]});case k.DESTINATION_CLEAR:return Object.assign({},se,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case k.DIRECTIONS_REQUEST_START:return Object.assign({},se,{fetchDirectionsRequest:he.request});case k.DIRECTIONS:return Object.assign({},se,{directions:he.directions,fetchDirectionsRequest:null});case k.ROUTE_INDEX:return Object.assign({},se,{routeIndex:he.routeIndex});case k.ERROR:return Object.assign({},se,{error:he.error});default:return se}}var pe=le;P.default=pe},{"../constants/action_types.js":26,"merge-options":14}],34:[function(y,S,P){Object.defineProperty(P,"__esModule",{value:!0}),P.default=void 0;function M(pe){return pe[0]>=-180&&pe[0]<=180&&pe[1]>=-90&&pe[1]<=90}function k(pe,se){return pe=pe.geometry.coordinates,se=se.geometry.coordinates,pe.join()===se.join()||pe[0].toFixed(3)===se[0].toFixed(3)&&pe[1].toFixed(3)===se[1].toFixed(3)}function r(pe){var se=360,he=((pe- -180)%se+se)%se+-180;return he===-180?180:he}function j(pe,se){var he=0;return Math.floor(se)!==se&&(he=se.toString().split(".")[1].length),pe.toFixed(Math.min(he,5))}function H(pe,se){return{type:"Feature",geometry:{type:"Point",coordinates:pe},properties:se||{}}}function W(pe,se){return pe.legs.reduce(function(he,Te,Se){Se>0&&(he[he.length-1].maneuver.type="waypoint",Te.steps[0].maneuver.type="");var fe=he.concat(Te.steps);return se?fe.filter(se):fe},[])}var ee={duration:function(se){var he=Math.floor(se/60),Te=Math.floor(he/60);return se%=60,he%=60,Te===0&&he===0?se+"s":Te===0?he+"min":Te+"h "+he+"min"},imperial:function(se){var he=se/1609.344;return he>=100?he.toFixed(0)+"mi":he>=10?he.toFixed(1)+"mi":he>=.1?he.toFixed(2)+"mi":(he*5280).toFixed(0)+"ft"},metric:function(se){return se>=1e5?(se/1e3).toFixed(0)+"km":se>=1e4?(se/1e3).toFixed(1)+"km":se>=100?(se/1e3).toFixed(2)+"km":se.toFixed(0)+"m"}},le={format:ee,coordinateMatch:k,createPoint:H,validCoords:M,wrap:r,roundWithOriginalPrecision:j,getAllSteps:W};P.default=le},{}]},{},[32])(32)})})(Rb)),Rb.exports}var A6=E6();const I6=dv(A6),P6=String.prototype.replace,C6=/%20/g,aR={RFC1738:"RFC1738",RFC3986:"RFC3986"},hw={RFC1738:function(a){return P6.call(a,C6,"+")},RFC3986:function(a){return String(a)}},M6=aR.RFC1738,lR=aR.RFC3986,Ob=Object.prototype.hasOwnProperty,Pd=Array.isArray,Kc=(function(){const a=[];for(let d=0;d<256;++d)a.push("%"+((d<16?"0":"")+d.toString(16)).toUpperCase());return a})(),R6=function(d){for(;d.length>1;){const y=d.pop(),S=y.obj[y.prop];if(Pd(S)){const P=[];for(let M=0;M<S.length;++M)typeof S[M]<"u"&&P.push(S[M]);y.obj[y.prop]=P}}},O6=function(d,y){const S=y&&y.plainObjects?Object.create(null):{};for(let P=0;P<d.length;++P)typeof d[P]<"u"&&(S[P]=d[P]);return S},L6=function a(d,y,S){if(!y)return d;if(typeof y!="object"){if(Pd(d))d.push(y);else if(d&&typeof d=="object")(S&&(S.plainObjects||S.allowPrototypes)||!Ob.call(Object.prototype,y))&&(d[y]=!0);else return[d,y];return d}if(!d||typeof d!="object")return[d].concat(y);let P=d;return Pd(d)&&!Pd(y)&&(P=O6(d,S)),Pd(d)&&Pd(y)?(y.forEach(function(M,k){if(Ob.call(d,k)){const r=d[k];r&&typeof r=="object"&&M&&typeof M=="object"?d[k]=a(r,M,S):d.push(M)}else d[k]=M}),d):Object.keys(y).reduce(function(M,k){const r=y[k];return Ob.call(M,k)?M[k]=a(M[k],r,S):M[k]=r,M},P)},D6=function(a,d,y){const S=a.replace(/\+/g," ");if(y==="iso-8859-1")return S.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(S)}catch{return S}},Lb=1024,z6=function(d,y,S,P,M){if(d.length===0)return d;let k=d;if(typeof d=="symbol"?k=Symbol.prototype.toString.call(d):typeof d!="string"&&(k=String(d)),S==="iso-8859-1")return escape(k).replace(/%u[0-9a-f]{4}/gi,function(j){return"%26%23"+parseInt(j.slice(2),16)+"%3B"});let r="";for(let j=0;j<k.length;j+=Lb){const H=k.length>=Lb?k.slice(j,j+Lb):k,W=[];for(let ee=0;ee<H.length;++ee){let le=H.charCodeAt(ee);if(le===45||le===46||le===95||le===126||le>=48&&le<=57||le>=65&&le<=90||le>=97&&le<=122||M===M6&&(le===40||le===41)){W[W.length]=H.charAt(ee);continue}if(le<128){W[W.length]=Kc[le];continue}if(le<2048){W[W.length]=Kc[192|le>>6]+Kc[128|le&63];continue}if(le<55296||le>=57344){W[W.length]=Kc[224|le>>12]+Kc[128|le>>6&63]+Kc[128|le&63];continue}ee+=1,le=65536+((le&1023)<<10|H.charCodeAt(ee)&1023),W[W.length]=Kc[240|le>>18]+Kc[128|le>>12&63]+Kc[128|le>>6&63]+Kc[128|le&63]}r+=W.join("")}return r},k6=function(d){const y=[{obj:{o:d},prop:"o"}],S=[];for(let P=0;P<y.length;++P){const M=y[P],k=M.obj[M.prop],r=Object.keys(k);for(let j=0;j<r.length;++j){const H=r[j],W=k[H];typeof W=="object"&&W!==null&&S.indexOf(W)===-1&&(y.push({obj:k,prop:H}),S.push(W))}}return R6(y),d},F6=function(d){return!d||typeof d!="object"?!1:!!(d.constructor&&d.constructor.isBuffer&&d.constructor.isBuffer(d))},B6=function(d,y){return[].concat(d,y)},dw=function(d,y){if(Pd(d)){const S=[];for(let P=0;P<d.length;P+=1)S.push(y(d[P]));return S}return y(d)},N6=Object.prototype.hasOwnProperty,cR={brackets:function(d){return d+"[]"},comma:"comma",indices:function(d,y){return d+"["+y+"]"},repeat:function(d){return d}},tu=Array.isArray,U6=Array.prototype.push,uR=function(a,d){U6.apply(a,tu(d)?d:[d])},V6=Date.prototype.toISOString,kP=lR,ta={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:z6,encodeValuesOnly:!1,format:kP,formatter:hw[kP],indices:!1,serializeDate:function(d){return V6.call(d)},skipNulls:!1,strictNullHandling:!1},j6=function(d){return typeof d=="string"||typeof d=="number"||typeof d=="boolean"||typeof d=="symbol"||typeof d=="bigint"},Db={},hR=function(d,y,S,P,M,k,r,j,H,W,ee,le,pe,se,he,Te,Se,fe){let oe=d,ge=fe,Ge=0,xt=!1;for(;(ge=ge.get(Db))!==void 0&&!xt;){const Oe=ge.get(d);if(Ge+=1,typeof Oe<"u"){if(Oe===Ge)throw new RangeError("Cyclic object value");xt=!0}typeof ge.get(Db)>"u"&&(Ge=0)}if(typeof W=="function"?oe=W(y,oe):oe instanceof Date?oe=pe(oe):S==="comma"&&tu(oe)&&(oe=dw(oe,function(Oe){return Oe instanceof Date?pe(Oe):Oe})),oe===null){if(k)return H&&!Te?H(y,ta.encoder,Se,"key",se):y;oe=""}if(j6(oe)||F6(oe)){if(H){const Oe=Te?y:H(y,ta.encoder,Se,"key",se);return[he(Oe)+"="+he(H(oe,ta.encoder,Se,"value",se))]}return[he(y)+"="+he(String(oe))]}const It=[];if(typeof oe>"u")return It;let ot;if(S==="comma"&&tu(oe))Te&&H&&(oe=dw(oe,H)),ot=[{value:oe.length>0?oe.join(",")||null:void 0}];else if(tu(W))ot=W;else{const Oe=Object.keys(oe);ot=ee?Oe.sort(ee):Oe}const Be=j?y.replace(/\./g,"%2E"):y,De=P&&tu(oe)&&oe.length===1?Be+"[]":Be;if(M&&tu(oe)&&oe.length===0)return De+"[]";for(let Oe=0;Oe<ot.length;++Oe){const He=ot[Oe],ft=typeof He=="object"&&typeof He.value<"u"?He.value:oe[He];if(r&&ft===null)continue;const tt=le&&j?He.replace(/\./g,"%2E"):He,At=tu(oe)?typeof S=="function"?S(De,tt):De:De+(le?"."+tt:"["+tt+"]");fe.set(d,Ge);const yt=new WeakMap;yt.set(Db,fe),uR(It,hR(ft,At,S,P,M,k,r,j,S==="comma"&&Te&&tu(oe)?null:H,W,ee,le,pe,se,he,Te,Se,yt))}return It},$6=function(d){if(!d)return ta;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.encodeDotInKeys<"u"&&typeof d.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(d.encoder!==null&&typeof d.encoder<"u"&&typeof d.encoder!="function")throw new TypeError("Encoder has to be a function.");const y=d.charset||ta.charset;if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let S=lR;if(typeof d.format<"u"){if(!N6.call(hw,d.format))throw new TypeError("Unknown format option provided.");S=d.format}const P=hw[S];let M=ta.filter;(typeof d.filter=="function"||tu(d.filter))&&(M=d.filter);let k;if(d.arrayFormat in cR?k=d.arrayFormat:"indices"in d?k=d.indices?"indices":"repeat":k=ta.arrayFormat,"commaRoundTrip"in d&&typeof d.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const r=typeof d.allowDots>"u"?d.encodeDotInKeys===!0?!0:ta.allowDots:!!d.allowDots;return{addQueryPrefix:typeof d.addQueryPrefix=="boolean"?d.addQueryPrefix:ta.addQueryPrefix,allowDots:r,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:ta.allowEmptyArrays,arrayFormat:k,charset:y,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:ta.charsetSentinel,commaRoundTrip:d.commaRoundTrip,delimiter:typeof d.delimiter>"u"?ta.delimiter:d.delimiter,encode:typeof d.encode=="boolean"?d.encode:ta.encode,encodeDotInKeys:typeof d.encodeDotInKeys=="boolean"?d.encodeDotInKeys:ta.encodeDotInKeys,encoder:typeof d.encoder=="function"?d.encoder:ta.encoder,encodeValuesOnly:typeof d.encodeValuesOnly=="boolean"?d.encodeValuesOnly:ta.encodeValuesOnly,filter:M,format:S,formatter:P,serializeDate:typeof d.serializeDate=="function"?d.serializeDate:ta.serializeDate,skipNulls:typeof d.skipNulls=="boolean"?d.skipNulls:ta.skipNulls,sort:typeof d.sort=="function"?d.sort:null,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:ta.strictNullHandling}};function q6(a,d){let y=a;const S=$6(d);let P,M;typeof S.filter=="function"?(M=S.filter,y=M("",y)):tu(S.filter)&&(M=S.filter,P=M);const k=[];if(typeof y!="object"||y===null)return"";const r=cR[S.arrayFormat],j=r==="comma"&&S.commaRoundTrip;P||(P=Object.keys(y)),S.sort&&P.sort(S.sort);const H=new WeakMap;for(let le=0;le<P.length;++le){const pe=P[le];S.skipNulls&&y[pe]===null||uR(k,hR(y[pe],pe,r,j,S.allowEmptyArrays,S.strictNullHandling,S.skipNulls,S.encodeDotInKeys,S.encode?S.encoder:null,S.filter,S.sort,S.allowDots,S.serializeDate,S.format,S.formatter,S.encodeValuesOnly,S.charset,H))}const W=k.join(S.delimiter);let ee=S.addQueryPrefix===!0?"?":"";return S.charsetSentinel&&(S.charset==="iso-8859-1"?ee+="utf8=%26%2310003%3B&":ee+="utf8=%E2%9C%93&"),W.length>0?ee+W:""}const fw=Object.prototype.hasOwnProperty,G6=Array.isArray,Ny={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:D6,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},H6=function(a){return a.replace(/&#(\d+);/g,function(d,y){return String.fromCharCode(parseInt(y,10))})},dR=function(a,d){return a&&typeof a=="string"&&d.comma&&a.indexOf(",")>-1?a.split(","):a},Z6="utf8=%26%2310003%3B",W6="utf8=%E2%9C%93",X6=function(d,y){const S={__proto__:null},P=y.ignoreQueryPrefix?d.replace(/^\?/,""):d,M=y.parameterLimit===1/0?void 0:y.parameterLimit,k=P.split(y.delimiter,M);let r=-1,j,H=y.charset;if(y.charsetSentinel)for(j=0;j<k.length;++j)k[j].indexOf("utf8=")===0&&(k[j]===W6?H="utf-8":k[j]===Z6&&(H="iso-8859-1"),r=j,j=k.length);for(j=0;j<k.length;++j){if(j===r)continue;const W=k[j],ee=W.indexOf("]="),le=ee===-1?W.indexOf("="):ee+1;let pe,se;le===-1?(pe=y.decoder(W,Ny.decoder,H,"key"),se=y.strictNullHandling?null:""):(pe=y.decoder(W.slice(0,le),Ny.decoder,H,"key"),se=dw(dR(W.slice(le+1),y),function(Te){return y.decoder(Te,Ny.decoder,H,"value")})),se&&y.interpretNumericEntities&&H==="iso-8859-1"&&(se=H6(se)),W.indexOf("[]=")>-1&&(se=G6(se)?[se]:se);const he=fw.call(S,pe);he&&y.duplicates==="combine"?S[pe]=B6(S[pe],se):(!he||y.duplicates==="last")&&(S[pe]=se)}return S},K6=function(a,d,y,S){let P=S?d:dR(d,y);for(let M=a.length-1;M>=0;--M){let k;const r=a[M];if(r==="[]"&&y.parseArrays)k=y.allowEmptyArrays&&P===""?[]:[].concat(P);else{k=y.plainObjects?Object.create(null):{};const j=r.charAt(0)==="["&&r.charAt(r.length-1)==="]"?r.slice(1,-1):r,H=y.decodeDotInKeys?j.replace(/%2E/g,"."):j,W=parseInt(H,10);!y.parseArrays&&H===""?k={0:P}:!isNaN(W)&&r!==H&&String(W)===H&&W>=0&&y.parseArrays&&W<=y.arrayLimit?(k=[],k[W]=P):H!=="__proto__"&&(k[H]=P)}P=k}return P},Y6=function(d,y,S,P){if(!d)return;const M=S.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,k=/(\[[^[\]]*])/,r=/(\[[^[\]]*])/g;let j=S.depth>0&&k.exec(M);const H=j?M.slice(0,j.index):M,W=[];if(H){if(!S.plainObjects&&fw.call(Object.prototype,H)&&!S.allowPrototypes)return;W.push(H)}let ee=0;for(;S.depth>0&&(j=r.exec(M))!==null&&ee<S.depth;){if(ee+=1,!S.plainObjects&&fw.call(Object.prototype,j[1].slice(1,-1))&&!S.allowPrototypes)return;W.push(j[1])}return j&&W.push("["+M.slice(j.index)+"]"),K6(W,y,S,P)},J6=function(d){return Ny};function Q6(a,d){const y=J6();if(a===""||a===null||typeof a>"u")return y.plainObjects?Object.create(null):{};const S=typeof a=="string"?X6(a,y):a;let P=y.plainObjects?Object.create(null):{};const M=Object.keys(S);for(let k=0;k<M.length;++k){const r=M[k],j=Y6(r,S[r],y,typeof a=="string");P=L6(P,j,y)}return y.allowSparse===!0?P:k6(P)}function Sl(){return Sl=Object.assign?Object.assign.bind():function(a){for(var d=1;d<arguments.length;d++){var y=arguments[d];for(var S in y)({}).hasOwnProperty.call(y,S)&&(a[S]=y[S])}return a},Sl.apply(null,arguments)}class zb{constructor(d,y,S){var P,M;this.name=d,this.definition=y,this.bindings=(P=y.bindings)!=null?P:{},this.wheres=(M=y.wheres)!=null?M:{},this.config=S}get template(){const d=`${this.origin}/${this.definition.uri}`.replace(/\/+$/,"");return d===""?"/":d}get origin(){return this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}get parameterSegments(){var d,y;return(d=(y=this.template.match(/{[^}?]+\??}/g))==null?void 0:y.map(S=>({name:S.replace(/{|\??}/g,""),required:!/\?}$/.test(S)})))!=null?d:[]}matchesUrl(d){var y;if(!this.definition.methods.includes("GET"))return!1;const S=this.template.replace(/[.*+$()[\]]/g,"\\$&").replace(/(\/?){([^}?]*)(\??)}/g,(r,j,H,W)=>{var ee;const le=`(?<${H}>${((ee=this.wheres[H])==null?void 0:ee.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return W?`(${j}${le})?`:`${j}${le}`}).replace(/^\w+:\/\//,""),[P,M]=d.replace(/^\w+:\/\//,"").split("?"),k=(y=new RegExp(`^${S}/?$`).exec(P))!=null?y:new RegExp(`^${S}/?$`).exec(decodeURI(P));if(k){for(const r in k.groups)k.groups[r]=typeof k.groups[r]=="string"?decodeURIComponent(k.groups[r]):k.groups[r];return{params:k.groups,query:Q6(M)}}return!1}compile(d){return this.parameterSegments.length?this.template.replace(/{([^}?]+)(\??)}/g,(y,S,P)=>{var M,k;if(!P&&[null,void 0].includes(d[S]))throw new Error(`Ziggy error: '${S}' parameter is required for route '${this.name}'.`);if(this.wheres[S]&&!new RegExp(`^${P?`(${this.wheres[S]})?`:this.wheres[S]}$`).test((k=d[S])!=null?k:""))throw new Error(`Ziggy error: '${S}' parameter '${d[S]}' does not match required format '${this.wheres[S]}' for route '${this.name}'.`);return encodeURI((M=d[S])!=null?M:"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}).replace(this.config.absolute?/(\.[^/]+?)(\/\/)/:/(^)(\/\/)/,"$1/").replace(/\/+$/,""):this.template}}class e8 extends String{constructor(d,y,S=!0,P){if(super(),this.t=P??(typeof Ziggy<"u"?Ziggy:globalThis?.Ziggy),!this.t&&typeof document<"u"&&document.getElementById("ziggy-routes-json")&&(globalThis.Ziggy=JSON.parse(document.getElementById("ziggy-routes-json").textContent),this.t=globalThis.Ziggy),this.t=Sl({},this.t,{absolute:S}),d){if(!this.t.routes[d])throw new Error(`Ziggy error: route '${d}' is not in the route list.`);this.i=new zb(d,this.t.routes[d],this.t),this.o=this.u(y)}}toString(){const d=Object.keys(this.o).filter(y=>!this.i.parameterSegments.some(({name:S})=>S===y)).filter(y=>y!=="_query").reduce((y,S)=>Sl({},y,{[S]:this.o[S]}),{});return this.i.compile(this.o)+q6(Sl({},d,this.o._query),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(y,S)=>typeof y=="boolean"?Number(y):S(y)})}h(d){d?this.t.absolute&&d.startsWith("/")&&(d=this.l().host+d):d=this.m();let y={};const[S,P]=Object.entries(this.t.routes).find(([M,k])=>y=new zb(M,k,this.t).matchesUrl(d))||[void 0,void 0];return Sl({name:S},y,{route:P})}m(){const{host:d,pathname:y,search:S}=this.l();return(this.t.absolute?d+y:y.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+S}current(d,y){const{name:S,params:P,query:M,route:k}=this.h();if(!d)return S;const r=new RegExp(`^${d.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(S);if([null,void 0].includes(y)||!r)return r;const j=new zb(S,k,this.t);y=this.u(y,j);const H=Sl({},P,M);if(Object.values(y).every(ee=>!ee)&&!Object.values(H).some(ee=>ee!==void 0))return!0;const W=(ee,le)=>Object.entries(ee).every(([pe,se])=>Array.isArray(se)&&Array.isArray(le[pe])?se.every(he=>le[pe].includes(he)||le[pe].includes(decodeURIComponent(he))):typeof se=="object"&&typeof le[pe]=="object"&&se!==null&&le[pe]!==null?W(se,le[pe]):le[pe]==se||le[pe]==decodeURIComponent(se));return W(y,H)}l(){var d,y,S,P,M,k;const{host:r="",pathname:j="",search:H=""}=typeof window<"u"?window.location:{};return{host:(d=(y=this.t.location)==null?void 0:y.host)!=null?d:r,pathname:(S=(P=this.t.location)==null?void 0:P.pathname)!=null?S:j,search:(M=(k=this.t.location)==null?void 0:k.search)!=null?M:H}}get params(){const{params:d,query:y}=this.h();return Sl({},d,y)}get routeParams(){return this.h().params}get queryParams(){return this.h().query}has(d){return this.t.routes.hasOwnProperty(d)}u(d={},y=this.i){d!=null||(d={}),d=["string","number"].includes(typeof d)?[d]:d;const S=y.parameterSegments.filter(({name:P})=>!this.t.defaults[P]);return Array.isArray(d)?d=d.reduce((P,M,k)=>Sl({},P,S[k]?{[S[k].name]:M}:typeof M=="object"?M:{[M]:""}),{}):S.length!==1||d[S[0].name]||!d.hasOwnProperty(Object.values(y.bindings)[0])&&!d.hasOwnProperty("id")||(d={[S[0].name]:d}),Sl({},this.p(y),this.$(d,y))}p(d){return d.parameterSegments.filter(({name:y})=>this.t.defaults[y]).reduce((y,{name:S},P)=>Sl({},y,{[S]:this.t.defaults[S]}),{})}$(d,{bindings:y,parameterSegments:S}){return Object.entries(d).reduce((P,[M,k])=>{if(!k||typeof k!="object"||Array.isArray(k)||!S.some(({name:r})=>r===M))return Sl({},P,{[M]:k});if(!k.hasOwnProperty(y[M])){if(!k.hasOwnProperty("id"))throw new Error(`Ziggy error: object passed as '${M}' parameter is missing route model binding key '${y[M]}'.`);y[M]="id"}return Sl({},P,{[M]:k[y[M]]})},{})}valueOf(){return this.toString()}}function t8(a,d,y,S){const P=new e8(a,d,y,S);return a?P.toString():P}const i8={install(a,d){const y=(S,P,M,k=d)=>t8(S,P,M,k);parseInt(a.version)>2?(a.config.globalProperties.route=y,a.provide("route",y)):a.mixin({methods:{route:y}})}};window.mapboxgl=oR;window.MapboxDirections=I6;oR.accessToken="pk.eyJ1IjoiemluMjYiLCJhIjoiY21nZ25kOTV0MGlnczJrb3BnMXkzMWY1diJ9.c-WyqAN36N96qj3FEfRFiw";delete rR.Icon.Default.prototype._getIconUrl;rR.Icon.Default.mergeOptions({iconRetinaUrl:new URL("/build/assets/marker-icon-2x-_ZA0WGCc.png",import.meta.url).href,iconUrl:new URL("/build/assets/marker-icon-hN30_KVU.png",import.meta.url).href,shadowUrl:new URL("/build/assets/marker-shadow-f7SaPCxT.png",import.meta.url).href});pj({resolve:a=>_j(`./pages/${a}.vue`,Object.assign({"./pages/admin/Facility.vue":()=>$l(()=>import("./Facility-K91Zdm22.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])),"./pages/admin/Index.vue":()=>$l(()=>import("./Index-BmrlDCKw.js"),__vite__mapDeps([13,1,2,3,4,12])),"./pages/auth/LoginPage.vue":()=>$l(()=>import("./LoginPage-q_Xv03tr.js"),__vite__mapDeps([14,2,15,12])),"./pages/auth/Register.vue":()=>$l(()=>import("./Register-DzJ3daAE.js"),__vite__mapDeps([16,2,15,12])),"./pages/auth/profile/Profile.vue":()=>$l(()=>import("./Profile-qHtD3rh1.js"),__vite__mapDeps([17,1,2,3,4,5,12])),"./pages/feedback/Feedback.vue":()=>$l(()=>import("./Feedback-BlUMXJ_f.js"),__vite__mapDeps([18,1,2,3,4,7,10,19,12])),"./pages/guest/Index.vue":()=>$l(()=>import("./Index-DmW4C8GX.js"),__vite__mapDeps([20,2,3,7,6,21,12])),"./pages/logs/SearchLogs.vue":()=>$l(()=>import("./SearchLogs-BAVYl9R_.js"),__vite__mapDeps([22,1,2,3,4,6,7,8,23,12])),"./pages/map/Map.vue":()=>$l(()=>import("./Map-3y7D33lL.js"),__vite__mapDeps([24,1,2,3,4,5,6,7,25,12])),"./pages/notes/Notes.vue":()=>$l(()=>import("./Notes-CDqL6xhF.js"),__vite__mapDeps([26,1,2,3,4,7,10,27,12])),"./pages/reports/ReportDetail.vue":()=>$l(()=>import("./ReportDetail-BZos6XlJ.js"),__vite__mapDeps([28,1,2,3,4,29,30,12])),"./pages/reports/ReportsDashboard.vue":()=>$l(()=>import("./ReportsDashboard-5-4EUktr.js"),__vite__mapDeps([31,1,2,3,4,9,29,10,7,8,6,32,12]))})),setup({el:a,App:d,props:y,plugin:S}){const P=VC({render:()=>Bd(d,y)});P.use(S),P.use(i8),P.use(y6,{position:"top-right",timeout:3e3,closeOnClick:!0,pauseOnHover:!0}),P.use(gj()),P.mount(a)}});export{Bd as A,$F as B,O8 as C,Dw as D,tC as E,na as F,f_ as G,gF as H,D8 as I,Uo as J,a3 as K,rR as L,zw as M,Jc as N,Iy as O,F_ as P,C8 as Q,Tv as R,kw as S,R8 as T,z8 as U,k8 as V,qd as a,Hl as b,xc as c,bc as d,ra as e,P8 as f,C0 as g,U2 as h,l3 as i,wA as j,d3 as k,V_ as l,ya as m,jh as n,Do as o,Io as p,M8 as q,Vd as r,L8 as s,Ew as t,F8 as u,XA as v,U_ as w,o3 as x,t8 as y,uj as z};
